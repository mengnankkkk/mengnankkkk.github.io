<!DOCTYPE html><html lang="zh-CN" data-theme="dark"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"><title>JUC-线程池 | mengnankkのblog</title><meta name="keywords" content="java,juc"><meta name="author" content="mengnankkzhou"><meta name="copyright" content="mengnankkzhou"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#18171d"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-touch-fullscreen" content="yes"><meta name="apple-mobile-web-app-title" content="JUC-线程池"><meta name="application-name" content="JUC-线程池"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="#18171d"><meta property="og:type" content="article"><meta property="og:title" content="JUC-线程池"><meta property="og:url" content="https://blog.tokenlen.top/2025/05/09/java-stack/juc1/index.html"><meta property="og:site_name" content="mengnankkのblog"><meta property="og:description" content="前置知识 JUC是java.util.concurrent包的简称，在Java5.0添加，目的就是为了更好的支持高并发任务。让开发者进行多线程编程时减少竞争条件和死锁的问题！ 进程：一个运行中的程序的集合; 一个进程往往可以包含多个线程,至少包含一个线程 Java默认有几个线程? 两个 main线程"><meta property="og:locale" content="zh-CN"><meta property="og:image" content="https://skymirror-1322372781.cos.ap-beijing.myqcloud.com/202410051722379.jpg?_r_=1bbcfc74-6e7b-1ac1-c223-0d258ea2d32c"><meta property="article:author" content="mengnankkzhou"><meta property="article:tag"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://skymirror-1322372781.cos.ap-beijing.myqcloud.com/202410051722379.jpg?_r_=1bbcfc74-6e7b-1ac1-c223-0d258ea2d32c"><meta name="description" content="前置知识 JUC是java.util.concurrent包的简称，在Java5.0添加，目的就是为了更好的支持高并发任务。让开发者进行多线程编程时减少竞争条件和死锁的问题！ 进程：一个运行中的程序的集合; 一个进程往往可以包含多个线程,至少包含一个线程 Java默认有几个线程? 两个 main线程"><link rel="shortcut icon" href="/favicon.ico"><link rel="canonical" href="https://blog.tokenlen.top/2025/05/09/java-stack/juc1/"><link rel="preconnect" href="//cdn.cbd.int"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="google-site-verification" content="xxx"/><meta name="baidu-site-verification" content="code-xxx"/><meta name="msvalidate.01" content="xxx"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/swiper/swiper.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  linkPageTop: undefined,
  peoplecanvas: undefined,
  postHeadAiDescription: {"enable":true,"gptName":"AnZhiYu","mode":"local","switchBtn":false,"btnLink":"https://afdian.net/item/886a79d4db6711eda42a52540025c377","randomNum":3,"basicWordCount":1000,"key":"xxxx","Referer":"https://xx.xx/"},
  diytitle: {"enable":true,"leaveTitle":"w(ﾟДﾟ)w 不要走啊，那种事情不要啊","backTitle":"♪(^∇^*)欢迎回家！！！！"},
  LA51: undefined,
  greetingBox: {"enable":"ture","default":"晚上好👋","list":[{"greeting":"晚安😴","startTime":0,"endTime":5},{"greeting":"早上好鸭👋, 祝你一天好心情！","startTime":6,"endTime":9},{"greeting":"上午好👋, 状态很好，鼓励一下～","startTime":10,"endTime":10},{"greeting":"11点多啦, 在坚持一下就吃饭啦～","startTime":11,"endTime":11},{"greeting":"午安👋, 宝贝","startTime":12,"endTime":14},{"greeting":"🌈充实的一天辛苦啦！","startTime":14,"endTime":18},{"greeting":"19点喽, 奖励一顿丰盛的大餐吧🍔。","startTime":19,"endTime":19},{"greeting":"晚上好👋, 在属于自己的时间好好放松😌~","startTime":20,"endTime":24}]},
  twikooEnvId: 'https://comment.tokenlen.top/',
  commentBarrageConfig:{"enable":true,"maxBarrage":1,"barrageTime":4000,"accessToken":"\tbd9428de12b54b96b2f1b4e69aeee81f","mailMd5":"F37442226DA71492"},
  root: '/',
  preloader: {"source":3},
  friends_vue_info: undefined,
  navMusic: true,
  mainTone: undefined,
  authorStatus: {"skills":["🤖️ 数码科技爱好者","🔍 分享与热心帮助","🏠 智能家居小能手","🔨 设计开发一条龙","🤝 专修交互与设计","🏃 脚踏实地行动派","🧱 团队小组发动机","💢 壮汉人狠话不多"]},
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简","rightMenuMsgToTraditionalChinese":"转为繁体","rightMenuMsgToSimplifiedChinese":"转为简体"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":330},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: true,
    simplehomepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"copy":true,"copyrightEbable":false,"limitCount":50,"languages":{"author":"作者: mengnankkzhou","link":"链接: ","source":"来源: mengnankkのblog","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。","copySuccess":"复制成功，复制和转载请标注本文地址"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#425AEF","bgDark":"#1f1f1f","position":"top-center"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.min.js',
      css: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false,
  shortcutKey: undefined,
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  configTitle: 'mengnankkのblog',
  title: 'JUC-线程池',
  postAI: '',
  pageFillDescription: '前置知识, 线程的方法, JUC结构, tool, executor, atomic, locks, collection, lock（top）, synchronized, synchronized vs Lock 区别总结(top), Condition 精准线程通信（生产者-消费者模型）, 线程共享和线程安全, 线程安全, list, set, hashmap, 单线程, 线程共享, callable, FutureTask, 辅助类–tool, CountDownLatch（倒计时锁）, CyclicBarrier（循环屏障）, Semaphore（信号量）, 阻塞, 概念, 四类API, 常见实现类, 小结, TLS, ThreadLocal, 线程池, 3大创建方式, 手动创建, 关闭策略, 四大拒绝策略, 常见面试问题前置知识是包的简称在添加目的就是为了更好的支持高并发任务让开发者进行多线程编程时减少竞争条件和死锁的问题进程一个运行中的程序的集合一个进程往往可以包含多个线程至少包含一个线程默认有几个线程两个线程线程线程线程是操作系统能够进行运算调度的最小单位并发多线程操作同一个资源交替执行一核模拟出来多条线程天下武功唯快不破快速交替并行多个人一起行走同时进行多核多个线程同时进行使用线程池操作线程实现主要分为三类用户级线程内核级线程和混合型线程实现线程实现主要分为三类用户级线程内核级线程和混合型线程实现轻量级进程不是线程的实现方式而是操作系统内核用来支持线程运行的一种机制分析三种线程实现方式用户级线程线程的创建调度和管理都由用户程序完成操作系统对线程一无所知优点是切换开销小缺点是无法利用多处理器内核级线程线程的创建调度和管理都由内核完成操作系统直接对线程进行调度优点是可以利用多处理器缺点是系统调用开销大混合线程结合了和的优点用户级线程与内核级线程进行多对多映射既保证了系统调用的效率又可以充分利用多处理器线程的六种状态和的区别来自不同的类来自类来自线程类关于锁的释放会释放锁不会释放锁使用的范围不同必须在同步代码块中可以在任何地方睡眠线程的方法新建线程调用方法后线程并不会立即进入运行状态线程的状态变化是新建就绪运行调用方法后线程会进入就绪状态等待调度才能进入运行状态这取决于线程调度器的调度策略方法会创建新的线程并执行方法而直接调用方法只会在当前线程中执行不会启动新线程方法是定义线程执行体的核心方法当我们创建一个线程类时必须重写类的方法或实现接口的方法在其中编写具体的线程执行逻辑可以实现线程之间通知和唤醒的方法是方法方法会让线程池进入关闭状态此时不再接受新的任务提交但会继续执行队列中的任务直到完成这是一种平缓的关闭方式如果需要等待任务执行完成需要配合使用方法立刻终止正在执行的所有任务并返回等待执行的任务列表这些任务是尚未开始执行的任务是阻塞方法它会等待直到以下三种情况之一发生所有任务执行完成到达指定的超时时间当前线程被中断这个方法常用于确保线程池完全关闭结构多线程实现有两种主要方式继承类和实现接口继承类直接继承类重写方法创建线程对象后调用方法启动线程优点是编码简单直观缺点是不支持多继承如果类已经继承了其他类就不能再继承实现接口实现接口实现方法将实现类实例传入构造函数创建线程对象调用方法启动线程优点是可以避免单继承限制更适合多个线程共享同一个资源的情况这是更常用的方式又称信号量三兄弟分为三个闭锁是一个同步辅助类在完成一组线程操作之前允许一个或多个线程等待典型应用并发执行多个任务后统一汇总结果栅栏允许一组线程互相等待直到都达到一个公共屏障点支持循环使用释放后可重用典型应用分布式计算中任务拆分后合并信号量控制对某个资源的访问线程数量相当于共享锁提供方法尝试获取许可无则阻塞等待释放持有的许可典型应用限制并发访问数比如控制数据库连接池数量是里面线程池的顶级接口但它只是一个执行线程的工具真正的线程池接口是里面包含的类有解决那些需要任务重复执行的问题周期性执行或者延迟任务周期性任务调度的类实现定时任务调度是提供的一组原子操作类包含有等原子变量类他们的实现原理大多是持有它们各自的对应的类型变量而且被关键字修饰了借助类实现原子性因为并不能保证原子性这样来保证每次一个线程要使用它都会拿到最新的值变量在每次被线程访问时都强制从主内存中重新读取最新值而不是使用线程工作内存中的值这确保了变量的可见性根据线程获取锁的抢占机制锁可以分为公平锁和非公平锁根据锁只能被单个线程持有还是能被多个线程共同持有锁可以分为独占锁和共享锁当线程因为抢占式调度而停止运行时会被放入可运行队列的前面这是为了保证被抢占的线程能够优先得到下一次执行机会体现了调度的公平性是提供的锁机制相比关键字来进行同步锁功能更加强大它为锁提供了一个框架该框架允许更灵活地使用锁包含的实现类有它是独占锁是指只能被独自占领即同一个时间点只能被一个线程锁获取到的锁可以被主动打断可以调用方法实现多个条件变量可以重入有公平和非公平模式它包括子类和是共享锁而是独占锁读锁共享锁多个线程可以同时读不会互相影响写锁独占锁写线程是排他的写的时候不能读也不能写写线程写线程读线程读线程缓存类使用读写锁保证线程安全写操作加写锁写入写入完成读操作加读锁读取读取完成它具备阻塞线程和解除阻塞线程的功能并且不会引发死锁主要是提供线程安全的集合比如对应的高并发类是对应的高并发类是对应的高并发类是对应的高并发类是这里还有一类特殊的集合内部基于和控制线程安全和阻塞操作它们都属于阻塞队列的一种实现适用于多线程生产者消费者模型两者构造方法中可以设置容量上限有界限定最大容量为如果使用无参构造默认容量是理论上无界所以从默认行为看是无界的但实际上可以设置为有界队列阻塞队列线程安全基于链表结构支持先进先出操作插入满了会阻塞移除空了也会阻塞常用于生产者消费者模型支持一个方向的插入和移除头出尾进使用实现线程安全使用两个锁避免入队和出队相互阻塞线程安全基于链表结构双端阻塞队列支持两端操作既可以作为队列也可以作为栈使用能实现队列模型也能实现栈模型是中的关键字是一种内置的同步锁用于实现线程间的互斥访问可以修饰修饰一个代码块被修饰的代码块称为同步语句块其作用的范围是大括号括起来的代码作用的对象是调用这个代码块的对象修饰一个方法被修饰的方法称为同步方法其作用的范围是整个方法作用的对象是调用这个方法的对象修改一个静态的方法其作用的范围是整个静态方法作用的对象是这个类的所有对象修改一个类其作用的范围是后面括号括起来的部分作用主的对象是这个类的所有对象提供的显示锁机制使用时需显式地加锁和释放锁实现类构造器默认是非公平锁可设置是否公平类型特点公平锁先进先出排队机制谁先来谁先得非公平锁可能插队性能更好默认实例购得第张票剩余张票模拟异常情况增加线程交替区别总结比较点如本质关键字类接口获取锁状态无法判断可以用判断是否获取成功自动释放锁出现异常时自动释放必须手动否则易死锁可中断性不支持中断等待锁支持公平性支持默认非公平可选公平非公平适用范围少量代码同步场景更复杂灵活的并发控制场景条件变量支持不支持条件队列支持多个可精确唤醒特性类型是否可重入是是是读锁和写锁都支持公平性选择否默认非公平可选构造函数可设可选构造函数可设是否支持中断不支持支持支持读写锁都支持中断是否支持超时尝试获取锁不支持支持支持是否为读写分离不支持不支持支持读锁共享写锁独占是否需要手动释放不需要自动释放需要需要分别释放读锁和写锁性能中优化较好高更灵活适合复杂控制非常高读多写少的场景性能最好使用简单性非常简单相对复杂需要手动释放更复杂需区分读写锁精准线程通信生产者消费者模型方法对应方法是个接口基本的方法就是和方法调用的和方法都必须在保护之内就是说必须在和之间才可以使用常用中中是条件捕捉异常执行解锁实例唤醒其他等待线程必须释放锁线程之间使用精准控制等待和唤醒线程共享和线程安全线程安全使用线程安全效率低使用同步包装器提供的工具类使用推荐核心机制写时复制简称写数据时先复制出一个新数组把数据添加到新数组然后再用新数组替换原数组读数据时直接读旧数组不会受写操作影响做到了读写分离底层就是而线程不安全因此也不安全使用使用线程安全不是线程安全的并发环境中容易出现死循环数据丢失键值覆盖推荐使用分段锁机制后使用优化支持高并发场景性能远优于或者是使用还有老版本的实现线程安全所有方法都被修饰不允许键或值不保证顺序已被替代在现代项目中已很少使用单线程线程环境是线程安全的因为没有竞争单例模式中的双重检查需要修饰变量防止指令重排序是非线程安全的当多个线程同时使用同一个对象时可能会导致解析和格式化错误这是因为的设计中包含了可变的成员变量在多线程环境下会相互影响推荐每线程一个实例使用线程共享线程共享区域方法区类型信息静态变量常量等堆对象实例的主要内存区域线程私有区域程序计数器记录当前线程执行位置虚拟机栈每个线程有独立方法栈存局部变量等信息多线程的另一种实验方式还可以使用使用接口接口的方法确实可以返回值并且能够抛出异常这是它区别于接口方法的重要特征方法既不能返回值也不能抛出受检异常实例创建一个包装一个对象启动线程实际执行的是内部会调用方法阻塞等待执行结果返回自定义一个线程任务实现接口正在执行特性是否有返回值没有有返回值是否抛异常不能抛异常可以抛异常方法名执行方式一般配合使用是的实现类可以传入一个通过执行它可以用获取返回值该方法会阻塞直到任务执行完毕辅助类倒计时锁初始化计数器为执行完后调用等待计数器归零线程继续执行每调用一次计数器减阻塞等待直到计数器为再往下执行多个子任务完成后主线程才执行比如并行加载资源全部完成主线程继续循环屏障召唤神龙成功等待所有线程到齐所有线程都调用等数量满后触发回调可选同时释放所有线程可以重复使用循环屏障多个线程并发阶段性同步如多线程分批写入数据库每批完成后统一提交信号量同时只能有个线程访问请求许可占坑执行业务逻辑释放许可离开申请资源没资源就阻塞释放资源唤醒等待的线程控制同时访问资源的线程数比如限流数据库连接池停车场个车位辆车示例等和确实都可以让一组线程等待其他线程用于让一组线程互相等待直到所有线程都到达某个公共屏障点则允许一个或多个线程等待其他线程完成一组操作阻塞概念接口特点当队列空时取元素的操作会阻塞等待当队列满时存元素的操作会阻塞等待典型场景生产者消费者模型线程池内部任务队列并发限流令牌桶等队满队空的时候会阻塞四类分组插入移除检查抛异常特殊值阻塞超时阻塞抛异常组队满时抛队空时抛队空时抛特殊值组队满时返回否则返回队空时返回队空时返回阻塞组队满时阻塞直到有空间队空时阻塞直到有元素超时阻塞组等待指定时间仍满则返回等待指定时间仍空则返回常见实现类实现类特点有界阻塞队列基于数组可选有界无界基于双向链表吞吐量高无界支持优先级排序不允许延迟队列元素只有到期后才能取出零容量队列每个必须等待支持操作的无界队列容量为不存储元素每一次必须等待另一个线程来否则一直阻塞典型用于直接交替的场景例如线程间直接交换数据或线程池的手动切换策略生产线程阻塞直到被取消费线程意思就是生成完不消费的话就会一直小结线程池内部使用来缓存任务生产者消费者高效的线程间传递数据限流令牌桶控制并发量或速率直接交互做快速交替传递线程局部存储是一种特殊的存储机制它为每个线程提供独立的变量副本避免多线程访问冲突每个线程只能访问自己的变量副本其他线程无法访问注意如果变量操作涉及多个步骤或访问共享资源仍然需要同步机制中的是的具体实现是实现线程本地存储的重要机制设计的目的是为了保证线程安全每个线程内部维护一个哈希表存储自己的变量副本本质避免多线程共享数据每个线程有自己的数据副本实现数据隔离每个线程访问变量时实际是在操作自己的中的副本不是继承类不实现接口使用了开放定址法解决哈希冲突线程池就是一个可以复用线程的技术原理分为工作线程和任务队列两部分任务是一个实现或者的对象会控制任务的数量和线程的数量不会占用过多的资源大创建方式方法含义特点固定大小线程池核心线程数固定任务队列无界容易单线程线程池一个核心线程顺序执行串行任务执行可伸缩线程池无限线程数有空线程就复用容易线程爆炸这三种方法不推荐在生产使用因为队列是无界的容易导致内存溢出缺少参数控制维护困难手动创建核心线程数最大线程数线程最大空闲时间时间单位任务队列线程工厂可选自定义命名拒绝策略创建线程池核心线程数为最大线程数为保持空闲线程时间为秒任务队列容量为核心线程数最大线程数线程空闲保持时间时间单位阻塞队列容量为提交任务到线程池关闭线程池防止新任务提交但会执行完已提交的任务等待线程池中任务完成实战模板容量为拒绝策略注意事项临时线程什么时候创建新任务提交的时候核心线程都在忙任务队列满了并还可以创建新的临时线程才会创建临时线程什么时候会开始拒绝新任务核心线程和临时线程都在忙任务队列也满了新的任务才会开始拒绝新任务核心线程数量应该是多少计算密集的密集的关闭策略方法会让线程池进入关闭状态此时不再接受新的任务提交但会继续执行队列中的任务直到完成这是一种平缓的关闭方式方法会尝试终止所有正在执行的任务并返回等待执行的任务列表这些任务是尚未开始执行的任务是阻塞方法它会等待直到以下三种情况之一发生所有任务执行完成到达指定的超时时间当前线程被中断这个方法常用于确保线程池完全关闭四大拒绝策略策略类策略说明默认抛出异常谁提交谁执行回退给调用线程直接丢弃任务不抛异常丢弃最早的任务然后尝试加入新任务常见面试问题线程池执行流程当前线程数创建新线程执行任务队列未满放入阻塞队列当前线程数创建非核心线程处理启动拒绝策略为什么不用创建线程池和使用的都是无界阻塞队列如在任务积压时会无限添加任务导致内存溢出使用的是无界线程数短时间大量任务可能创建海量线程导致被打爆或内存溢出因此生产推荐使用并指定参数用手动创建更好核心线程与最大线程的区别是核心线程数线程池创建后优先使用核心线程核心线程默认是常驻线程即使空闲也不回收除非设置是线程池能容纳的最大线程数当核心线程队列都满后才会创建非核心线程超过该数量后再有任务就触发拒绝策略线程池如何避免资源耗尽合理设置和合理设置队列大小如选择合适的拒绝策略如可回退执行限制任务提交速率限流或增加监控报警机制线程池为什么需要用于控制非核心线程的生存时间线程在空闲超过这个时间后会被回收避免线程长时间闲置浪费资源可通过让核心线程也参与超时机制提升资源利用率如何定位线程池满的情况可从以下几个方面进行排查日志中会抛出默认拒绝策略设置自定义拒绝策略中记录日志或告警使用线程池监控工具如查看线程池状态活跃线程数任务队列长度等通过的等方法动态采集指标并写入监控系统如',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2025-05-23 23:14:04',
  postMainColor: '',
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#18171d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#f7f9fe')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(e => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 7.2.0"><link rel="alternate" href="/rss2.xml" title="mengnankkのblog" type="application/rss+xml">
</head><body data-type="anzhiyu"><div id="web_bg"></div><div id="an_music_bg"></div><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><img class="loading-img nolazyload" alt="加载头像" src="https://skymirror-1322372781.cos.ap-beijing.myqcloud.com/202407230955363.jpg"/><div class="loading-image-dot"></div></div></div><script>const preloader = {
  endLoading: () => {
    document.getElementById('loading-box').classList.add("loaded");
  },
  initLoading: () => {
    document.getElementById('loading-box').classList.remove("loaded")
  }
}
window.addEventListener('load',()=> { preloader.endLoading() })
setTimeout(function(){preloader.endLoading();},10000)

if (true) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.10/progress_bar/progress_bar.css"/><script async="async" src="https://cdn.cbd.int/pace-js@1.2.4/pace.min.js" data-pace-options="{ &quot;restartOnRequestAfter&quot;:false,&quot;eventLag&quot;:false}"></script><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><div id="nav-group"><span id="blog_name"><div class="back-home-button"><i class="anzhiyufont anzhiyu-icon-grip-vertical"></i><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" href="https://blog.tokenlen.top/" title="博客"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="博客"/><span class="back-menu-item-text">博客</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="http://img.mengnankk.top:9001/" title="图床"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="图床"/><span class="back-menu-item-text">图床</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">项目</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="http://img.mengnankk.top:9001/" title="mengnankk图床"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/08/13/64d8c2653332e.ico" alt="mengnankk图床"/><span class="back-menu-item-text">mengnankk图床</span></a></div></div></div></div><a id="site-name" href="/" accesskey="h"><div class="title">mengnankkのblog</div><i class="anzhiyufont anzhiyu-icon-house-chimney"></i></a><div id="he-plugin-simple"></div><script>var WIDGET = {
  "CONFIG": {
    "modules": "0124",
    "background": "2",
    "tmpColor": "FFFFFF",
    "tmpSize": "16",
    "cityColor": "FFFFFF",
    "citySize": "16",
    "aqiColor": "E8D87B",
    "aqiSize": "16",
    "weatherIconSize": "24",
    "alertIconSize": "18",
    "padding": "10px 10px 10px 10px",
    "shadow": "0",
    "language": "auto",
    "borderRadius": "20",
    "fixed": "true",
    "vertical": "top",
    "horizontal": "left",
    "left": "20",
    "top": "7.1",
    "key": "df245676fb434a0691ead1c63341cd94"
  }
}
</script><link rel="stylesheet" href="https://widget.qweather.net/simple/static/css/he-simple.css?v=1.4.0"/><script src="https://widget.qweather.net/simple/static/js/he-simple.js?v=1.4.0"></script></span><div class="mask-name-container"><div id="name-container"><a id="page-name" href="javascript:anzhiyu.scrollToDest(0, 500)">PAGE_NAME</a></div></div><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size: 0.9em;"></i><span> 隧道</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 生活</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/album/"><i class="anzhiyufont anzhiyu-icon-images faa-tada" style="font-size: 0.9em;"></i><span> 相册集</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/essay/"><i class="anzhiyufont anzhiyu-icon-lightbulb faa-tada" style="font-size: 0.9em;"></i><span> 闲言碎语</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/music/"><i class="anzhiyufont anzhiyu-icon-music faa-tada" style="font-size: 0.9em;"></i><span> 音乐馆</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 我的</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><i class="anzhiyufont anzhiyu-icon-link faa-tada" style="font-size: 0.9em;"></i><span> 友人帐</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size: 0.9em;"></i><span> 关于本人</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/Message/"><i class="anzhiyufont anzhiyu-icon-envelope faa-tada" style="font-size: 0.9em;"></i><span> 留言</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 其他</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" target="_blank" rel="noopener" href="https://home.tokenlen.top/"><i class="anzhiyufont anzhiyu-icon-envelope faa-tada" style="font-size: 0.9em;"></i><span> home</span></a></li><li><a class="site-page child faa-parent animated-hover" target="_blank" rel="noopener" href="https://status.mengnankk.asia/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 站点检测</span></a></li><li><a class="site-page child faa-parent animated-hover" target="_blank" rel="noopener" href="https://home.tokenlen.top/"><i class="anzhiyufont anzhiyu-icon-lightbulb faa-tada" style="font-size: 0.9em;"></i><span> 心里话</span></a></li></ul></div></div></div><div id="nav-right"><div class="nav-button only-home" id="travellings_button" title="随机前往一个开往项目网站"><a class="site-page" onclick="anzhiyu.totraveling()" title="随机前往一个开往项目网站" href="javascript:void(0);" rel="external nofollow" data-pjax-state="external"><i class="anzhiyufont anzhiyu-icon-train"></i></a></div><div class="nav-button" id="randomPost_button"><a class="site-page" onclick="toRandomPost()" title="随机前往一个文章" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-dice"></i></a></div><div class="nav-button" id="search-button"><a class="site-page social-icon search" href="javascript:void(0);" title="搜索🔍" accesskey="s"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span> 搜索</span></a></div><input id="center-console" type="checkbox"/><label class="widget" for="center-console" title="中控台" onclick="anzhiyu.switchConsole();"><i class="left"></i><i class="widget center"></i><i class="widget right"></i></label><div id="console"><div class="console-card-group-reward"><ul class="reward-all console-card"><li class="reward-item"><a href="https://imgbed.mengnankk.asia/202407021650088.jpg" target="_blank"><img class="post-qr-code-img" alt="微信" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imgbed.mengnankk.asia/202407021650088.jpg"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png" target="_blank"><img class="post-qr-code-img" alt="支付宝" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div><div class="console-card-group"><div class="console-card-group-left"><div class="console-card" id="card-newest-comments"><div class="card-content"><div class="author-content-item-tips">互动</div><span class="author-content-item-title"> 最新评论</span></div><div class="aside-list"><span>正在加载中...</span></div></div></div><div class="console-card-group-right"><div class="console-card tags"><div class="card-content"><div class="author-content-item-tips">兴趣点</div><span class="author-content-item-title">寻找你感兴趣的领域</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/BF/" style="font-size: 1.05rem;">BF<sup>1</sup></a><a href="/tags/BigData/" style="font-size: 1.05rem;">BigData<sup>1</sup></a><a href="/tags/C/" style="font-size: 1.05rem;">C<sup>4</sup></a><a href="/tags/CE/" style="font-size: 1.05rem;">CE<sup>1</sup></a><a href="/tags/CSRF/" style="font-size: 1.05rem;">CSRF<sup>1</sup></a><a href="/tags/English/" style="font-size: 1.05rem;">English<sup>9</sup></a><a href="/tags/FI/" style="font-size: 1.05rem;">FI<sup>1</sup></a><a href="/tags/Hadoop/" style="font-size: 1.05rem;">Hadoop<sup>1</sup></a><a href="/tags/Linux/" style="font-size: 1.05rem;">Linux<sup>12</sup></a><a href="/tags/XSS/" style="font-size: 1.05rem;">XSS<sup>1</sup></a><a href="/tags/css/" style="font-size: 1.05rem;">css<sup>2</sup></a><a href="/tags/football/" style="font-size: 1.05rem;">football<sup>1</sup></a><a href="/tags/html/" style="font-size: 1.05rem;">html<sup>1</sup></a><a href="/tags/java/" style="font-size: 1.05rem;">java<sup>35</sup></a><a href="/tags/juc/" style="font-size: 1.05rem;">juc<sup>2</sup></a><a href="/tags/leetcode/" style="font-size: 1.05rem;">leetcode<sup>6</sup></a><a href="/tags/markdown/" style="font-size: 1.05rem;">markdown<sup>1</sup></a><a href="/tags/mysql/" style="font-size: 1.05rem;">mysql<sup>16</sup></a><a href="/tags/net/" style="font-size: 1.05rem;">net<sup>4</sup></a><a href="/tags/paper/" style="font-size: 1.05rem;">paper<sup>1</sup></a><a href="/tags/php/" style="font-size: 1.05rem;">php<sup>5</sup></a><a href="/tags/pip/" style="font-size: 1.05rem;">pip<sup>1</sup></a><a href="/tags/python/" style="font-size: 1.05rem;">python<sup>3</sup></a><a href="/tags/redis/" style="font-size: 1.05rem;">redis<sup>3</sup></a><a href="/tags/shell/" style="font-size: 1.05rem;">shell<sup>4</sup></a><a href="/tags/spring/" style="font-size: 1.05rem;">spring<sup>2</sup></a><a href="/tags/spring-boot/" style="font-size: 1.05rem;">spring boot<sup>6</sup></a><a href="/tags/sql/" style="font-size: 1.05rem;">sql<sup>4</sup></a><a href="/tags/web/" style="font-size: 1.05rem;">web<sup>3</sup></a><a href="/tags/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/" style="font-size: 1.05rem;">操作系统<sup>1</sup></a><a href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93%E5%8E%9F%E7%90%86/" style="font-size: 1.05rem;">数据库原理<sup>3</sup></a><a href="/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" style="font-size: 1.05rem;">数据结构<sup>16</sup></a><a href="/tags/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/" style="font-size: 1.05rem;">正则表达式<sup>2</sup></a><a href="/tags/%E6%AF%9B%E9%80%89/" style="font-size: 1.05rem;">毛选<sup>1</sup></a><a href="/tags/%E7%AE%97%E6%B3%95/" style="font-size: 1.05rem;">算法<sup>8</sup></a><a href="/tags/%E9%9D%A2%E8%AF%95/" style="font-size: 1.05rem;">面试<sup>8</sup></a></div></div><hr/></div></div><div class="console-card history"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-box-archiv"></i><span>文章</span></div><div class="card-archives"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-archive"></i><span>归档</span><a class="card-more-btn" href="/archives/" title="查看更多">
    <i class="anzhiyufont anzhiyu-icon-angle-right"></i></a></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/05/"><span class="card-archive-list-date">五月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">13</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/04/"><span class="card-archive-list-date">四月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">7</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/03/"><span class="card-archive-list-date">三月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">5</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/02/"><span class="card-archive-list-date">二月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">4</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/01/"><span class="card-archive-list-date">一月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">5</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/12/"><span class="card-archive-list-date">十二月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">4</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/11/"><span class="card-archive-list-date">十一月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">3</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2024/10/"><span class="card-archive-list-date">十月 2024</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">14</span><span>篇</span></div></a></li></ul></div><hr/></div></div></div><div class="button-group"><div class="console-btn-item"><a class="darkmode_switchbutton" title="显示模式切换" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-moon"></i></a></div><div class="console-btn-item" id="consoleHideAside" onclick="anzhiyu.hideAsideBtn()" title="边栏显示控制"><a class="asideSwitch"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></a></div><div class="console-btn-item on" id="consoleCommentBarrage" onclick="anzhiyu.switchCommentBarrage()" title="热评开关"><a class="commentBarrage"><i class="anzhiyufont anzhiyu-icon-message"></i></a></div><div class="console-btn-item" id="consoleMusic" onclick="anzhiyu.musicToggle()" title="音乐开关"><a class="music-switch"><i class="anzhiyufont anzhiyu-icon-music"></i></a></div></div><div class="console-mask" onclick="anzhiyu.hideConsole()" href="javascript:void(0);"></div></div><div class="nav-button" id="nav-totop"><a class="totopbtn" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i><span id="percent" onclick="anzhiyu.scrollToDest(0,500)">0</span></a></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" title="切换"><i class="anzhiyufont anzhiyu-icon-bars"></i></a></div></div></div></nav><div id="post-info"><div id="post-firstinfo"><div class="meta-firstline"><a class="post-meta-original">原创</a><span class="post-meta-categories"><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-inbox post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E6%8A%80%E6%9C%AF%E6%A0%88/" itemprop="url">技术栈</a></span><span class="article-meta tags"><a class="article-meta__tags" href="/tags/java/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>java</span></a><a class="article-meta__tags" href="/tags/juc/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>juc</span></a></span></div></div><h1 class="post-title" itemprop="name headline">JUC-线程池</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="anzhiyufont anzhiyu-icon-calendar-days post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" itemprop="dateCreated datePublished" datetime="2025-05-08T16:00:00.000Z" title="发表于 2025-05-09 00:00:00">2025-05-09</time><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-history post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" itemprop="dateCreated datePublished" datetime="2025-05-23T15:14:04.746Z" title="更新于 2025-05-23 23:14:04">2025-05-23</time></span></div><div class="meta-secondline"><span class="post-meta-separator"></span><span class="post-meta-wordcount"><i class="anzhiyufont anzhiyu-icon-file-word post-meta-icon" title="文章字数"></i><span class="post-meta-label" title="文章字数">字数总计:</span><span class="word-count" title="文章字数">7.1k</span><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-clock post-meta-icon" title="阅读时长"></i><span class="post-meta-label" title="阅读时长">阅读时长:</span><span>25分钟</span></span><span class="post-meta-separator"></span><span id="" data-flag-title="JUC-线程池"><i class="anzhiyufont anzhiyu-icon-fw-eye post-meta-icon"></i><span class="post-meta-label" title="阅读量">阅读量:</span><span id="twikoo_visitors" title="访问量"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-spin"></i></span></span><span class="post-meta-separator">       </span><span class="post-meta-position" title="作者IP属地为济南"><i class="anzhiyufont anzhiyu-icon-location-dot"></i>济南</span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section><div id="post-top-cover"><img class="nolazyload" id="post-top-bg" src="https://skymirror-1322372781.cos.ap-beijing.myqcloud.com/202410051722379.jpg?_r_=1bbcfc74-6e7b-1ac1-c223-0d258ea2d32c"></div></header><main id="blog-container"><div class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container" itemscope itemtype="https://blog.tokenlen.top/2025/05/09/java-stack/juc1/"><header><a class="post-meta-categories" href="/categories/%E6%8A%80%E6%9C%AF%E6%A0%88/" itemprop="url">技术栈</a><a href="/tags/java/" tabindex="-1" itemprop="url">java</a><a href="/tags/juc/" tabindex="-1" itemprop="url">juc</a><h1 id="CrawlerTitle" itemprop="name headline">JUC-线程池</h1><span itemprop="author" itemscope itemtype="http://schema.org/Person">mengnankkzhou</span><time itemprop="dateCreated datePublished" datetime="2025-05-08T16:00:00.000Z" title="发表于 2025-05-09 00:00:00">2025-05-09</time><time itemprop="dateCreated datePublished" datetime="2025-05-23T15:14:04.746Z" title="更新于 2025-05-23 23:14:04">2025-05-23</time></header><h1>前置知识</h1>
<p>JUC是java.util.concurrent包的简称，在Java5.0添加，目的就是为了更好的支持<strong>高并发</strong>任务。让开发者进行多线程编程时减少竞争条件和死锁的问题！</p>
<p>进程：<strong>一个运行中的程序的集合</strong>; 一个进程往往可以包含多个线程,至少包含一个线程</p>
<p>Java默认有几个线程? 两个 main线程 gc线程</p>
<p>线程：线程（thread）是操作系统能够进行运算调度的最小单位。</p>
<p>并发(多线程操作同一个资源,交替执行)<br>
CPU一核, 模拟出来多条线程,天下武功,唯快不破,快速交替<br>
并行(多个人一起行走, 同时进行)<br>
CPU多核,多个线程同时进行 ; 使用线程池操作</p>
<p>线程实现主要分为三类:<strong>用户级线程(ULT)、内核级线程(KLT)和混合型线程</strong>实现。</p>
<p>线程实现主要分为三类:用户级线程(ULT)、内核级线程(KLT)和混合型线程实现。轻量级进程(LWP)不是线程的实现方式,而是操作系统内核用来支持线程运行的一种机制。</p>
<p>分析三种线程实现方式:</p>
<p>\1. 用户级线程(ULT):<br>
- 线程的创建、调度和管理都由用户程序完成<br>
- 操作系统对线程一无所知<br>
- 优点是切换开销小,缺点是无法利用多处理器</p>
<p>\2. 内核级线程(KLT):<br>
- 线程的创建、调度和管理都由内核完成<br>
- 操作系统直接对线程进行调度<br>
- 优点是可以利用多处理器,缺点是系统调用开销大</p>
<p>\3. 混合线程:<br>
- 结合了ULT和KLT的优点<br>
- 用户级线程与内核级线程进行多对多映射<br>
- 既保证了系统调用的效率,又可以充分利用多处理器</p>
<p>线程的六种状态：</p>
<p><strong>new runnable blocked waiting time_waiting terminated</strong></p>
<p><strong>wait和sleep的区别：</strong></p>
<ol>
<li>来自不同的类： wait来自object类, sleep来自线程类</li>
<li>关于锁的释放：wait会释放锁, sleep不会释放锁</li>
<li>使用的范围不同： wait必须在同步代码块中， sleep可以在任何地方睡眠</li>
</ol>
<h2 id="线程的方法">线程的方法</h2>
<p>新建线程调用<strong>start()方法后</strong>，线程并不会立即进入运行状态。线程的状态变化是：<strong>新建→就绪→运行</strong>。调用start()方法后，线程会进入就绪状态，等待CPU调度才能进入运行状态。这取决于线程调度器的调度策略。start()方法会<strong>创建新的线程并执行run()方法</strong>，而直接调用run()方法只会在<strong>当前线程中执行</strong>，不会启动新线程。</p>
<p><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://uploadfiles.nowcoder.com/images/20250422/59_1745314586904/AB85F6C1A80F74538F959A181704EA92" alt=""></p>
<p>run（）方法是定义线程执行体的核心方法。当我们创建一个线程类时,必须重写Thread类的run()方法或实现Runnable接口的run()方法,在其中编写具体的线程执行逻辑。</p>
<p>可以实现线程之间通知和唤醒的方法是：</p>
<p>Object.wait/notify/notifyAll</p>
<p>Condition.await/signal/signalAll</p>
<p>**shutdown方法：**shutdown()方法会让线程池进入&quot;关闭&quot;状态,<strong>此时不再接受新的任务提交,但会继续执行队列中的任务直到完成。这是一种平缓的关闭方式。</strong></p>
<p>如果需要等待任务执行完成,需要配合使用a**waitTermination()**方法</p>
<p>shutdownNOw()立刻终止正在执行的所有任务，并返回等待执行的任务列表(List)。这些任务是尚未开始执行的任务。</p>
<p><strong>awaitTermination</strong>(long timeout, TimeUnit unit)是阻塞方法,它会等待直到以下三种情况之一发生:<br>
- 所有任务执行完成<br>
- 到达指定的超时时间<br>
- 当前线程被中断<br>
这个方法常用于确保线程池完全关闭。</p>
<h1>JUC结构</h1>
<p>Java多线程实现有两种主要方式:<strong>继承Thread类和实现Runnable接口</strong></p>
<p>继承Thread类<br>
- 直接继承Thread类<br>
- 重写run()方法<br>
- 创建线程对象后调用start()方法启动线程<br>
- 优点是编码简单直观<br>
- 缺点是Java不支持多继承,如果类已经继承了其他类就不能再继承Thread</p>
<p>实现Runnable接口<br>
- 实现Runnable接口<br>
- 实现run()方法<br>
- 将实现类实例传入Thread构造函数创建线程对象<br>
- 调用start()方法启动线程<br>
- 优点是可以避免单继承限制,更适合多个线程共享同一个资源的情况<br>
- <strong>这是更常用的方式</strong></p>
<h2 id="tool">tool</h2>
<p>又称“信号量三兄弟”，分为三个</p>
<p><strong>CountDownLatch（闭锁）</strong></p>
<ul>
<li>是一个同步辅助类，在<strong>完成一组线程操作之前</strong>，允许<strong>一个或多个线程等待</strong>。</li>
<li><strong>典型应用：并发执行多个任务后统一汇总结果。</strong></li>
</ul>
<p><strong>CyclicBarrier（栅栏）</strong></p>
<ul>
<li>允许一组线程互相等待，直到<strong>都达到一个公共屏障点</strong>。</li>
<li><strong>支持循环使用</strong>（释放后可重用）。</li>
<li><strong>典型应用：分布式计算中任务拆分后合并。</strong></li>
</ul>
<p><strong>Semaphore（信号量）</strong></p>
<ul>
<li>控制对某个资源的<strong>访问线程数量</strong>，相当于“共享锁”。</li>
<li>提供方法：
<ul>
<li><code>acquire()</code>：尝试获取许可，<strong>无则阻塞等待</strong>。</li>
<li><code>release()</code>：释放持有的许可。</li>
</ul>
</li>
<li><strong>典型应用：限制并发访问数，比如控制数据库连接池数量。</strong></li>
</ul>
<h2 id="executor">executor</h2>
<p>是Java里面线程池的顶级接口，但它只是一个执行线程的工具，真正的线程池接口是<strong>ExecutorService</strong>，里面包含的类有：</p>
<p>1）ScheduledExecutorService 解决那些需要任务重复执行的问题</p>
<p><strong>周期性执行或者延迟任务</strong></p>
<p>2）ScheduledThreadPoolExecutor 周期性任务调度的类实现</p>
<p><strong>定时任务调度</strong></p>
<h2 id="atomic">atomic</h2>
<p>是JDK提供的一组原子操作类，</p>
<p>包含有AtomicBoolean、AtomicInteger、AtomicIntegerArray等原子变量类，他们的实现原理大多是<strong>持有它们各自的对应的类型变量value，而且被volatile关键字修饰了</strong>。借助 <code>Unsafe</code> 类 + CAS 实现原子性。因为volatile并不能保证原子性，这样来保证每次一个线程要使用它都会拿到<strong>最新的值。</strong></p>
<p>volatile变量在每次被线程访问时，<strong>都强制从主内存中重新读取最新值，而不是使用线程工作内存中的值。这确保了变量的可见性。</strong></p>
<h2 id="locks">locks</h2>
<p>根据线程获取<strong>锁的抢占机制</strong>,锁可以分为<strong>公平锁和非公平锁</strong>。根据锁只能被单个线程<strong>持有还是能被多个线程共同持有</strong>，锁可以分为<strong>独占锁和共享锁。</strong></p>
<p>当线程因为抢占式调度而停止运行时,<strong>会被放入可运行队列的前面</strong>。这是为了保证被抢占的线程能够优先得到下一次执行机会,<strong>体现了调度的公平性。</strong></p>
<p>是JDK提供的锁机制，相比synchronized关键字来进行同步锁，功能更加强大，它为锁提供了一个框架，该框架允许更灵活地使用锁包含的实现类有：</p>
<p>1）<strong>ReentrantLock</strong> 它是<strong>独占锁</strong>，是指只能被独自占领，即同一个时间点只能被一个线程锁获取到的锁。可以被主动打断，可以调用<strong>newCondition</strong>方法实现多个条件变量。可以重入，有公平和非公平模式</p>
<p>2）<strong>ReentrantReadWriteLock</strong> 它包括子类ReadLock和WriteLock。ReadLock是共享锁，而WriteLock是独占锁。</p>
<p>🔍 <strong>读锁（共享锁）</strong>：多个线程可以<strong>同时读</strong>，不会互相影响。</p>
<p>✍️ <strong>写锁（独占锁）</strong>：写线程是<strong>排他的</strong>，写的时候不能读也不能写。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ReadWriteLockDemo</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">MyCache</span> <span class="variable">myCache</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyCache</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 写线程</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= <span class="number">5</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">final</span> <span class="type">int</span> <span class="variable">temp</span> <span class="operator">=</span> i;</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">                myCache.put(temp + <span class="string">&quot;&quot;</span>, temp + <span class="string">&quot;&quot;</span>);</span><br><span class="line">            &#125;, <span class="string">&quot;写线程&quot;</span> + i).start();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 读线程</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= <span class="number">5</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">final</span> <span class="type">int</span> <span class="variable">temp</span> <span class="operator">=</span> i;</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">                myCache.get(temp + <span class="string">&quot;&quot;</span>);</span><br><span class="line">            &#125;, <span class="string">&quot;读线程&quot;</span> + i).start();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 缓存类，使用读写锁保证线程安全</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyCache</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Map&lt;String, String&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">ReentrantReadWriteLock</span> <span class="variable">rwLock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReentrantReadWriteLock</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 写操作：加写锁</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">put</span><span class="params">(String key, String value)</span> &#123;</span><br><span class="line">        rwLock.writeLock().lock();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot; 写入 &quot;</span> + key);</span><br><span class="line">            TimeUnit.MILLISECONDS.sleep(<span class="number">300</span>);</span><br><span class="line">            map.put(key, value);</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot; 写入完成&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            rwLock.writeLock().unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 读操作：加读锁</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">get</span><span class="params">(String key)</span> &#123;</span><br><span class="line">        rwLock.readLock().lock();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot; 读取 &quot;</span> + key);</span><br><span class="line">            TimeUnit.MILLISECONDS.sleep(<span class="number">300</span>);</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot; 读取完成: &quot;</span> + map.get(key));</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            rwLock.readLock().unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>3）<strong>LockSupport</strong> 它具<strong>备阻塞线程和解除阻塞线程</strong>的功能，并且不会引发死锁。</p>
<h2 id="collection">collection</h2>
<p>主要是提供线程安全的集合， 比如：</p>
<p>1）ArrayList对应的高并发类是<strong>CopyOnWrite</strong>ArrayList，</p>
<p>2）HashSet对应的高并发类是 CopyOnWriteArraySet，</p>
<p>3）HashMap对应的高并发类是ConcurrentHashMap</p>
<p>4）Queue对应的高并发类是ConcurrentLinkedQueue</p>
<p>这里还有一类特殊的集合，内部基于**<code>ReentrantLock</code>** 和 <strong><code>Condition</code></strong> 控制线程安全和阻塞操作。</p>
<p>它们都属于 <strong>阻塞队列（Blocking Queue）的一种实现</strong>，适用于多线程生产者-消费者模型。</p>
<p>两者构造方法中可以设置<strong>容量上限</strong>（有界）。</p>
<ul>
<li><code>new LinkedBlockingQueue&lt;&gt;(1000)</code> 限定最大容量为 1000。</li>
</ul>
<p>如果使用无参构造，默认容量是：<code>Integer.MAX_VALUE</code>，<strong>理论上无界</strong>。</p>
<p>所以 <strong>从默认行为看是无界的</strong>，但实际上 <strong>可以设置为有界队列</strong>。</p>
<hr>
<p>LinkedBlockingQueue</p>
<ul>
<li><strong>阻塞队列，线程安全</strong></li>
<li><strong>基于链表结构</strong></li>
<li><strong>支持 FIFO（先进先出）操作</strong></li>
<li>插入满了会阻塞，移除空了也会阻塞</li>
<li><strong>常用于生产者-消费者模型</strong></li>
<li>支持一个方向的插入和移除（头出尾进）。</li>
</ul>
<p>使用 <strong><code>ReentrantLock</code></strong> 实现线程安全</p>
<p>使用两个锁：<strong>takeLock、putLock</strong>，避免入队和出队相互阻塞</p>
<p>LinkedBlockingDeque</p>
<p><strong>线程安全</strong></p>
<p><strong>基于链表结构</strong></p>
<p><strong>双端阻塞队列</strong>（支持两端操作）</p>
<p>既可以作为 <strong>队列（FIFO）</strong>，也可以作为 <strong>栈（LIFO）</strong> 使用</p>
<p>能实现 <strong>队列模型</strong>（tail add，head remove）</p>
<p>也能实现 <strong>栈模型</strong>（head add，head remove）</p>
<h1>lock（top）</h1>
<h2 id="synchronized">synchronized</h2>
<p>synchronized是Java中的关键字,是一种<strong>内置的同步锁</strong>，用于实现线程间的互斥访问。</p>
<p>可以修饰：：：：：</p>
<ol>
<li>修饰一个代码块，<strong>被修饰的代码块称为同步语句块</strong>，其作用的范围是大括号{}括起来的代码，<strong>作用的对象是调用这个代码块的对象</strong>；<br>
　　2. 修饰一个方法，被修饰的方法称为<strong>同步方法</strong>，其作用的范围是整个方法，作用的对象是<strong>调用这个方法的对象</strong>；<br>
　　3. 修改一个静态的方法，<strong>其作用的范围是整个静态方法</strong>，作用的对象是<strong>这个类的所有对象；</strong></li>
<li>修改一个类，其作用的范围是synchronized后面括号括起来的部分，<strong>作用主的对象是这个类的所有对象。</strong></li>
</ol>
<p>JDK 提供的显示锁机制，使用时需显式地加锁和释放锁。</p>
<p>实现类：<strong><code>ReentrantLock</code></strong></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 构造器</span></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">ReentrantLock</span><span class="params">()</span> &#123;</span><br><span class="line">    sync = <span class="keyword">new</span> <span class="title class_">NonfairSync</span>();  <span class="comment">// 默认是非公平锁</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="title function_">ReentrantLock</span><span class="params">(<span class="type">boolean</span> fair)</span> &#123;</span><br><span class="line">    sync = fair ? <span class="keyword">new</span> <span class="title class_">FairSync</span>() : <span class="keyword">new</span> <span class="title class_">NonfairSync</span>();  <span class="comment">// 可设置是否公平</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>类型</th>
<th>特点</th>
</tr>
</thead>
<tbody>
<tr>
<td>公平锁</td>
<td><strong>先进先出排队机制，谁先来谁先得</strong></td>
</tr>
<tr>
<td>非公平锁</td>
<td><strong>可能插队，性能更好（默认）</strong></td>
</tr>
</tbody>
</table>
<p>实例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SaleTicketDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Ticket</span> <span class="variable">ticket</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Ticket</span>();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123; <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">40</span>; i++) ticket.sale(); &#125;, <span class="string">&quot;a&quot;</span>).start();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123; <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">40</span>; i++) ticket.sale(); &#125;, <span class="string">&quot;b&quot;</span>).start();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123; <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">40</span>; i++) ticket.sale(); &#125;, <span class="string">&quot;c&quot;</span>).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Ticket</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">ticketNum</span> <span class="operator">=</span> <span class="number">30</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">Lock</span> <span class="variable">lock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReentrantLock</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sale</span><span class="params">()</span> &#123;</span><br><span class="line">        lock.lock();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (ticketNum &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                System.out.println(Thread.currentThread().getName() + <span class="string">&quot; 购得第 &quot;</span> + ticketNum-- + <span class="string">&quot; 张票, 剩余 &quot;</span> + ticketNum + <span class="string">&quot; 张票&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            Thread.sleep(<span class="number">10</span>); <span class="comment">// 模拟异常情况，增加线程交替</span></span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="synchronized-vs-Lock-区别总结-top"><strong><code>synchronized</code> vs <code>Lock</code> 区别总结</strong>(top)</h3>
<table>
<thead>
<tr>
<th>比较点</th>
<th><code>synchronized</code></th>
<th><code>Lock</code>（如 <code>ReentrantLock</code>）</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>本质</th>
<th>Java 关键字</th>
<th>Java 类（接口）</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>获取锁状态</th>
<th>❌ 无法判断</th>
<th>✅ 可以用 <code>tryLock()</code> 判断是否获取成功</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>自动释放锁</th>
<th>✅ 出现异常时自动释放</th>
<th>❌ 必须手动 <code>unlock()</code>，否则易死锁</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>可中断性</th>
<th>❌ 不支持中断等待锁</th>
<th>✅ 支持（<code>lockInterruptibly()</code>）</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>公平性支持</th>
<th>❌ 默认非公平</th>
<th>✅ 可选公平/非公平</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>适用范围</th>
<th>少量代码同步场景</th>
<th>更复杂、灵活的并发控制场景</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>条件变量支持</th>
<th>❌ 不支持条件队列</th>
<th>✅ 支持多个 <code>Condition</code>，可精确唤醒</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>特性 / 类型</th>
<th><code>synchronized</code></th>
<th><code>Lock</code>（ReentrantLock）</th>
<th><code>ReadWriteLock</code>（ReentrantReadWriteLock）</th>
</tr>
</thead>
<tbody>
<tr>
<td>是否可重入</td>
<td>✅ 是</td>
<td>✅ 是</td>
<td>✅ 是（读锁和写锁都支持）</td>
</tr>
<tr>
<td>公平性选择</td>
<td>❌ 否（默认非公平）</td>
<td>✅ 可选（构造函数可设）</td>
<td>✅ 可选（构造函数可设）</td>
</tr>
<tr>
<td>是否支持中断</td>
<td>❌ 不支持</td>
<td>✅ 支持 <code>lockInterruptibly()</code></td>
<td>✅ 支持（读/写锁都支持中断）</td>
</tr>
<tr>
<td>是否支持超时尝试获取锁</td>
<td>❌ 不支持</td>
<td>✅ 支持 <code>tryLock(timeout)</code></td>
<td>✅ 支持</td>
</tr>
<tr>
<td>是否为读写分离</td>
<td>❌ 不支持</td>
<td>❌ 不支持</td>
<td>✅ 支持，读锁共享，写锁独占</td>
</tr>
<tr>
<td>是否需要手动释放</td>
<td>❌ 不需要（自动释放）</td>
<td>✅ 需要 <code>unlock()</code></td>
<td>✅ 需要分别释放读锁和写锁</td>
</tr>
<tr>
<td>性能</td>
<td>中（JVM 优化较好）</td>
<td>高（更灵活，适合复杂控制）</td>
<td>非常高（读多写少的场景性能最好）</td>
</tr>
<tr>
<td>使用简单性</td>
<td>✅ 非常简单</td>
<td>⛔ 相对复杂（需要手动释放）</td>
<td>⛔ 更复杂（需区分读写锁）</td>
</tr>
</tbody>
</table>
<h3 id="Condition-精准线程通信（生产者-消费者模型）"><code>Condition</code> 精准线程通信（生产者-消费者模型）</h3>
<table>
<thead>
<tr>
<th>Object方法</th>
<th>Condition对应方法</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>wait()</code></td>
<td><code>await()</code></td>
</tr>
<tr>
<td><code>notify()</code></td>
<td><code>signal()</code></td>
</tr>
<tr>
<td><code>notifyAll()</code></td>
<td><code>signalAll()</code></td>
</tr>
</tbody>
</table>
<p>Condition是个接口，基本的方法就是await()和signal()方法；</p>
<p>调用Condition的await()和signal()方法，都必须在lock保护之内，就是说必须在<strong>lock.lock()和lock.unlock</strong>之间才可以使用</p>
<p>常用try tatch finally中</p>
<p>try中是条件，catch捕捉异常，finally执行解锁</p>
<p>实例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">SharedResource</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">number</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">Lock</span> <span class="variable">lock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReentrantLock</span>();</span><br><span class="line">    <span class="keyword">private</span> <span class="type">Condition</span> <span class="variable">condition</span> <span class="operator">=</span> lock.newCondition();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">increment</span><span class="params">()</span> &#123;</span><br><span class="line">        lock.lock();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">while</span> (number != <span class="number">0</span>) &#123;</span><br><span class="line">                condition.await();<span class="comment">//wait</span></span><br><span class="line">            &#125;</span><br><span class="line">            number++;</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot; &gt;&gt; &quot;</span> + number);</span><br><span class="line">            condition.signalAll();<span class="comment">//唤醒其他等待线程</span></span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            lock.unlock();<span class="comment">// 必须释放锁</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">decrement</span><span class="params">()</span> &#123;</span><br><span class="line">        lock.lock();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">while</span> (number != <span class="number">1</span>) &#123;</span><br><span class="line">                condition.await();</span><br><span class="line">            &#125;</span><br><span class="line">            number--;</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot; &gt;&gt; &quot;</span> + number);</span><br><span class="line">            condition.signalAll();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>线程之间使用 <code>Condition</code> 精准控制等待和唤醒</p>
<h1>线程共享和线程安全</h1>
<h2 id="线程安全">线程安全</h2>
<h3 id="list">list</h3>
<p>使用 <code>Vector</code>（线程安全，效率低）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;String&gt; list = new Vector&lt;&gt;();</span><br></pre></td></tr></table></figure>
<p>使用同步包装器（JDK 提供的工具类）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;String&gt; list = Collections.synchronizedList(new ArrayList&lt;&gt;());</span><br></pre></td></tr></table></figure>
<p>使用 <strong>CopyOnWriteArrayList</strong> ✅ 推荐！</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">List&lt;String&gt; list = new CopyOnWriteArrayList&lt;&gt;();</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><strong>核心机制：写时复制（Copy-On-Write，简称 COW）</strong></p>
<ul>
<li>写数据时：先复制出一个新数组，把数据添加到新数组，<strong>然后再用新数组替换原数组</strong></li>
<li>读数据时：直接读旧数组，不会受写操作影响，做到了<strong>读写分离</strong></li>
</ul>
<h3 id="set">set</h3>
<p><code>HashSet</code> 底层就是 <code>HashMap</code>，而 <code>HashMap</code> 线程不安全，因此 <code>HashSet</code> 也不安全</p>
<p>使用Collections.synchronizedSet</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Set&lt;String&gt; set = Collections.synchronizedSet(new HashSet&lt;&gt;());</span><br></pre></td></tr></table></figure>
<p>使用 CopyOnWriteArraySet（线程安全）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Set&lt;String&gt; set = new CopyOnWriteArraySet&lt;&gt;();</span><br></pre></td></tr></table></figure>
<h3 id="hashmap">hashmap</h3>
<p>不是线程安全的，并发环境中，<code>HashMap</code> 容易出现：</p>
<ul>
<li>死循环（JDK 1.7）</li>
<li>数据丢失</li>
<li>键值覆盖</li>
</ul>
<p>推荐使用ConcurrentHashMap</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Map&lt;String, String&gt; map = new ConcurrentHashMap&lt;&gt;();</span><br></pre></td></tr></table></figure>
<p>分段锁机制（JDK 1.7）→ JDK 1.8 后使用 <strong>CAS + synchronized</strong> 优化</p>
<p>支持高并发场景，性能远优于 <code>Hashtable</code></p>
<p>或者是使用<code>Collections.synchronizedMap</code></p>
<p>还有Hashtable</p>
<p>老版本的 Map 实现，<strong>线程安全</strong>，所有方法都被 <code>synchronized</code> 修饰。</p>
<p>不允许 <strong>null 键或 null 值</strong>。</p>
<p><strong>不保证顺序</strong>。</p>
<p>已被 <code>ConcurrentHashMap</code> 替代，在现代项目中已很少使用。</p>
<h3 id="单线程">单线程</h3>
<p><strong>线程环境是线程安全的</strong>（因为没有竞争）</p>
<p><strong>单例模式中的双重检查（DCL）</strong>：</p>
<ul>
<li>需要 <code>volatile</code> 修饰变量，防止 <strong>指令重排序</strong>。</li>
</ul>
<p><strong>SimpleDateFormat 是非线程安全的</strong>：</p>
<p>当多个线程同时使用同一个SimpleDateFormat对象时,可能会导致解析和格式化错误。这是因为SimpleDateFormat的设计中包含了可变的成员变量,在多线程环境下会相互影响。</p>
<ul>
<li>推荐：每线程一个实例 or 使用 <code>ThreadLocal&lt;SimpleDateFormat&gt;</code>。</li>
</ul>
<h2 id="线程共享">线程共享</h2>
<p><strong>线程共享区域：</strong></p>
<ul>
<li><strong>方法区</strong>：类型信息、静态变量、常量等。</li>
<li><strong>Java 堆</strong>：对象实例的主要内存区域。</li>
</ul>
<p><strong>线程私有区域：</strong></p>
<ul>
<li><strong>程序计数器</strong>：记录当前线程执行位置。</li>
<li><strong>虚拟机栈</strong>：每个线程有独立方法栈，存局部变量等信息。</li>
</ul>
<h1>callable</h1>
<p>多线程的另一种实验方式</p>
<p><strong>还可以使用使用Callable接口</strong>，Callable接口的<strong>call()方法确实可以返回值，并且能够抛出异常</strong>。这是它区别于Runnable接口run()方法的重要特征。run()方法既不能返回值，也不能抛出受检异常。</p>
<p>实例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.concurrent.Callable;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ExecutionException;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.FutureTask;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CallableTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ExecutionException, InterruptedException &#123;</span><br><span class="line">        <span class="comment">// 创建一个 FutureTask，包装一个 Callable 对象</span></span><br><span class="line">        FutureTask&lt;Integer&gt; futureTask = <span class="keyword">new</span> <span class="title class_">FutureTask</span>&lt;&gt;(<span class="keyword">new</span> <span class="title class_">MyThread</span>());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 启动线程，实际执行的是 futureTask.run()，内部会调用 call() 方法</span></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(futureTask, <span class="string">&quot;a&quot;</span>).start();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 阻塞等待 call() 执行结果返回</span></span><br><span class="line">        System.out.println(futureTask.get());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 自定义一个线程任务，实现 Callable 接口</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyThread</span> <span class="keyword">implements</span> <span class="title class_">Callable</span>&lt;Integer&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Integer <span class="title function_">call</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        System.out.println(Thread.currentThread().getName() + <span class="string">&quot; 正在执行&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">123</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<table>
<thead>
<tr>
<th>特性</th>
<th>Runnable</th>
<th>Callable</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>是否有返回值</th>
<th>❌ 没有</th>
<th>✅ 有返回值</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>是否抛异常</th>
<th>❌ 不能抛 checked 异常</th>
<th>✅ 可以抛异常</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>方法名</th>
<th><code>run()</code></th>
<th><code>call()</code></th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<table>
<thead>
<tr>
<th>执行方式</th>
<th><code>Thread</code> / <code>ExecutorService</code></th>
<th>一般配合 <code>FutureTask</code> 使用</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<h2 id="FutureTask"><code>FutureTask</code></h2>
<ul>
<li>是 <code>Runnable</code> + <code>Future</code> 的实现类</li>
<li>可以传入一个 <code>Callable</code>，通过 <code>Thread</code> 执行它</li>
<li>可以用 <code>.get()</code> 获取返回值，<strong>该方法会阻塞，直到任务执行完毕</strong></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BigStar</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ExecutionException, InterruptedException &#123;</span><br><span class="line">        Callable&lt;String&gt; callable = <span class="keyword">new</span> <span class="title class_">Test</span>(<span class="number">100</span>);</span><br><span class="line">        FutureTask&lt;String&gt; futureTask = <span class="keyword">new</span> <span class="title class_">FutureTask</span>&lt;&gt;(callable);</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(futureTask).start();</span><br><span class="line">        <span class="type">String</span> <span class="variable">rs</span> <span class="operator">=</span> futureTask.get();</span><br><span class="line">        System.out.println(rs);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1>辅助类–tool</h1>
<h2 id="CountDownLatch（倒计时锁）"><code>CountDownLatch</code>（倒计时锁）</h2>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">CountDownLatch</span> <span class="variable">latch</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CountDownLatch</span>(<span class="number">5</span>); <span class="comment">// 初始化计数器为5</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">        <span class="comment">// 执行完后调用 countDown</span></span><br><span class="line">        latch.countDown();</span><br><span class="line">    &#125;).start();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">latch.await(); <span class="comment">// 等待计数器归零</span></span><br><span class="line">System.out.println(<span class="string">&quot;main线程继续执行&quot;</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><code>countDown()</code>：每调用一次，计数器减1。</p>
<p><code>await()</code>：阻塞等待，直到计数器为0再往下执行。</p>
<p>多个子任务完成后主线程才执行（比如：并行加载资源 → 全部完成 → 主线程继续）。</p>
<h2 id="CyclicBarrier（循环屏障）"><code>CyclicBarrier</code>（循环屏障）</h2>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">CyclicBarrier</span> <span class="variable">barrier</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CyclicBarrier</span>(<span class="number">7</span>, () -&gt; &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;召唤神龙成功！&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">7</span>; i++) &#123;</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">        barrier.await(); <span class="comment">// 等待所有线程到齐</span></span><br><span class="line">    &#125;).start();</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>所有线程都调用 <code>await()</code>，等数量满后触发回调（可选），<strong>同时释放所有线程</strong>。</p>
<p><strong>可以重复使用（循环屏障）</strong>。</p>
<p>多个线程<strong>并发阶段性同步</strong>，如：多线程分批写入数据库，每批完成后统一提交。</p>
<h2 id="Semaphore（信号量）"><code>Semaphore</code>（信号量）</h2>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Semaphore</span> <span class="variable">semaphore</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Semaphore</span>(<span class="number">3</span>); <span class="comment">// 同时只能有3个线程访问</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">6</span>; i++) &#123;</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">        semaphore.acquire(); <span class="comment">// 请求许可（占坑）</span></span><br><span class="line">        <span class="comment">// 执行业务逻辑</span></span><br><span class="line">        semaphore.release(); <span class="comment">// 释放许可（离开）</span></span><br><span class="line">    &#125;).start();</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><code>acquire()</code>：申请资源，没资源就阻塞。</p>
<p><code>release()</code>：释放资源，唤醒等待的线程。</p>
<p>控制同时访问资源的线程数，比如：限流、数据库连接池、停车场3个车位6辆车示例等。</p>
<p><strong>CyclicBarrier和CountDownLatch</strong>确实都可以让<strong>一组线程等待其他线程</strong>。CyclicBarrier用于让一组线程互相等待，直到所有线程都到达某个公共屏障点。CountDownLatch则允许一个或多个线程等待其他线程完成一组操作。</p>
<h1>阻塞</h1>
<h2 id="概念">概念</h2>
<ul>
<li><strong>接口</strong>：<code>java.util.concurrent.BlockingQueue&lt;E&gt;</code></li>
<li><strong>特点</strong>：当队列空时，取元素的操作会<strong>阻塞等待</strong>；当队列满时，存元素的操作会<strong>阻塞等待</strong>。</li>
<li><strong>典型场景</strong>：生产者–消费者模型、线程池内部任务队列、并发限流（令牌桶）等。</li>
</ul>
<p>队满队空的时候会阻塞</p>
<h2 id="四类API">四类API</h2>
<table>
<thead>
<tr>
<th>分组</th>
<th>插入（Add）</th>
<th>移除（Remove）</th>
<th>检查（Examine）</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>1. 抛异常</strong></td>
<td><code>add(e)</code></td>
<td><code>remove()</code> / <code>remove(e)</code></td>
<td><code>element()</code></td>
</tr>
<tr>
<td><strong>2. 特殊值</strong></td>
<td><code>offer(e)</code></td>
<td><code>poll()</code></td>
<td><code>peek()</code></td>
</tr>
<tr>
<td><strong>3. 阻塞</strong></td>
<td><code>put(e)</code></td>
<td><code>take()</code></td>
<td>—</td>
</tr>
<tr>
<td><strong>4. 超时阻塞</strong></td>
<td><code>offer(e, timeout)</code></td>
<td><code>poll(timeout)</code></td>
<td>—</td>
</tr>
</tbody>
</table>
<p>抛异常组：</p>
<p><strong><code>add(e)</code></strong>：队满时抛 <code>IllegalStateException</code></p>
<p><strong><code>remove()</code></strong>：队空时抛 <code>NoSuchElementException</code></p>
<p><strong><code>element()</code></strong>：队空时抛 <code>NoSuchElementException</code></p>
<p>特殊值组：</p>
<p><strong><code>offer(e)</code></strong>：队满时返回 <code>false</code>，否则返回 <code>true</code></p>
<p><strong><code>poll()</code></strong>：队空时返回 <code>null</code></p>
<p><strong><code>peek()</code></strong>：队空时返回 <code>null</code></p>
<p>阻塞组：</p>
<p><strong><code>put(e)</code></strong>：队满时<strong>阻塞</strong>直到有空间</p>
<p><strong><code>take()</code></strong>：队空时<strong>阻塞</strong>直到有元素</p>
<p>超时阻塞组：</p>
<ul>
<li><strong><code>offer(e, timeout, unit)</code></strong>：等待指定时间仍满则返回 <code>false</code></li>
<li><strong><code>poll(timeout, unit)</code></strong>：等待指定时间仍空则返回 <code>null</code></li>
</ul>
<h2 id="常见实现类">常见实现类</h2>
<table>
<thead>
<tr>
<th>实现类</th>
<th>特点</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>ArrayBlockingQueue</code></td>
<td><strong>有界</strong>阻塞队列，基于数组，<strong>FIFO</strong></td>
</tr>
<tr>
<td><code>LinkedBlockingQueue</code></td>
<td>可选有界/无界，基于双向链表，<strong>吞吐量高</strong></td>
</tr>
<tr>
<td><code>PriorityBlockingQueue</code></td>
<td><strong>无界</strong>，支持<strong>优先级排序</strong>，不允许null</td>
</tr>
<tr>
<td><code>DelayQueue</code></td>
<td><strong>延迟队列</strong>，元素只有到期后才能取出</td>
</tr>
<tr>
<td><code>SynchronousQueue</code></td>
<td><strong>零容量</strong>队列，每个 <code>put</code> 必须等待 <code>take</code></td>
</tr>
<tr>
<td><code>LinkedTransferQueue</code></td>
<td>支持 <strong>transfer</strong> 操作的无界队列</td>
</tr>
</tbody>
</table>
<p><strong>SynchronousQueue：</strong></p>
<p><strong>容量为 0</strong>，不存储元素。</p>
<p>每一次 <code>put(e)</code> 必须等待另一个线程来 <code>take()</code>，否则<strong>一直阻塞</strong>。</p>
<p>典型用于<strong>直接交替</strong>的场景，例如：线程间<strong>直接交换数据</strong>，或线程池的手动切换策略。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">SynchronousQueue&lt;String&gt; queue = <span class="keyword">new</span> <span class="title class_">SynchronousQueue</span>&lt;&gt;();</span><br><span class="line"><span class="comment">// 生产线程</span></span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;T1 put 1&quot;</span>);</span><br><span class="line">    queue.put(<span class="string">&quot;1&quot;</span>);   <span class="comment">// 阻塞直到被取</span></span><br><span class="line">    System.out.println(<span class="string">&quot;T1 put 2&quot;</span>);</span><br><span class="line">    queue.put(<span class="string">&quot;2&quot;</span>);</span><br><span class="line">&#125;, <span class="string">&quot;T1&quot;</span>).start();</span><br><span class="line"></span><br><span class="line"><span class="comment">// 消费线程</span></span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">    TimeUnit.SECONDS.sleep(<span class="number">3</span>);</span><br><span class="line">    System.out.println(<span class="string">&quot;T2 take=&gt; &quot;</span> + queue.take());</span><br><span class="line">    TimeUnit.SECONDS.sleep(<span class="number">3</span>);</span><br><span class="line">    System.out.println(<span class="string">&quot;T2 take=&gt; &quot;</span> + queue.take());</span><br><span class="line">&#125;, <span class="string">&quot;T2&quot;</span>).start();</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>意思就是生成完不消费的话，就会一直block</p>
<h2 id="小结">小结</h2>
<p><strong>线程池</strong>：<code>ThreadPoolExecutor</code> 内部使用 <code>BlockingQueue&lt;Runnable&gt;</code> 来缓存任务。</p>
<p><strong>生产者–消费者</strong>：高效的线程间传递数据。</p>
<p><strong>限流/令牌桶</strong>：控制并发量或速率。</p>
<p><strong>直接交互</strong>：<code>SynchronousQueue</code> 做快速交替传递。</p>
<h1>TLS</h1>
<p>TLS(线程局部存储)是一种特殊的存储机制，它为每个线程提供<strong>独立的变量副本</strong></p>
<p>避免多线程访问冲突</p>
<p>每个线程只能访问自己的变量副本，<strong>其他线程无法访问</strong>。</p>
<p>注意：如果变量操作涉及多个步骤或访问共享资源，<strong>仍然需要同步机制</strong>。</p>
<p>Java 中的 <strong><code>ThreadLocal</code></strong> 是 TLS 的具体实现。</p>
<h2 id="ThreadLocal">ThreadLocal</h2>
<p><code>ThreadLocal</code> 是 Java 实现 <strong>线程本地存储</strong> 的重要机制。设计的目的是为了保证线程安全</p>
<p>每个线程内部维护一个 <strong><code>ThreadLocalMap</code> 哈希表</strong>，存储自己的变量副本。</p>
<p>本质：<strong>避免多线程共享数据</strong>，每个线程有自己的数据副本，实现数据隔离。</p>
<p>每个线程访问ThreadLocal变量时，实际是在<strong>操作自己的ThreadLocalMap中的副本。</strong></p>
<p><code>ThreadLocal</code>：</p>
<ul>
<li><strong>不是继承 Thread 类</strong></li>
<li><strong>不实现 Runnable 接口</strong></li>
</ul>
<p>使用了 <strong>开放定址法</strong> 解决哈希冲突。</p>
<h1>线程池</h1>
<p>就是一个可以<strong>复用线程</strong>的技术</p>
<p>原理：</p>
<p>分为工作线程和任务队列两部分</p>
<p>任务是一个实现Runnable或者Callable的对象</p>
<p>会控制任务的数量和线程的数量，不会占用过多的资源</p>
<h2 id="3大创建方式">3大创建方式</h2>
<table>
<thead>
<tr>
<th>方法</th>
<th>含义</th>
<th>特点</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>Executors.newFixedThreadPool(int n)</code></td>
<td>固定大小线程池</td>
<td>核心线程数固定，任务队列无界，<strong>容易 OOM</strong></td>
</tr>
<tr>
<td><code>Executors.newSingleThreadExecutor()</code></td>
<td>单线程线程池</td>
<td>一个核心线程，顺序执行，<strong>串行任务执行</strong></td>
</tr>
<tr>
<td><code>Executors.newCachedThreadPool()</code></td>
<td>可伸缩线程池</td>
<td>无限线程数，有空线程就复用，<strong>容易线程爆炸</strong></td>
</tr>
</tbody>
</table>
<p>这三种方法不推荐在生产使用！因为：</p>
<ul>
<li>队列是无界的，容易导致 <strong>内存溢出</strong></li>
<li>缺少参数控制，维护困难</li>
</ul>
<h2 id="手动创建">手动创建</h2>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="title function_">ThreadPoolExecutor</span><span class="params">(</span></span><br><span class="line"><span class="params">    <span class="type">int</span> corePoolSize,              // <span class="number">1.</span> 核心线程数</span></span><br><span class="line"><span class="params">    <span class="type">int</span> maximumPoolSize,           // <span class="number">2.</span> 最大线程数</span></span><br><span class="line"><span class="params">    <span class="type">long</span> keepAliveTime,            // <span class="number">3.</span> 线程最大空闲时间</span></span><br><span class="line"><span class="params">    TimeUnit unit,                 // <span class="number">4.</span> 时间单位</span></span><br><span class="line"><span class="params">    BlockingQueue&lt;Runnable&gt; workQueue, // <span class="number">5.</span> 任务队列</span></span><br><span class="line"><span class="params">    ThreadFactory threadFactory,   // <span class="number">6.</span> 线程工厂（可选：自定义命名）</span></span><br><span class="line"><span class="params">    RejectedExecutionHandler handler // <span class="number">7.</span> 拒绝策略</span></span><br><span class="line"><span class="params">)</span></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BigStar</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// 创建线程池，核心线程数为2，最大线程数为4，保持空闲线程时间为60秒，任务队列容量为10</span></span><br><span class="line">        <span class="type">ThreadPoolExecutor</span> <span class="variable">executor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ThreadPoolExecutor</span>(</span><br><span class="line">                <span class="number">2</span>, <span class="comment">// 核心线程数</span></span><br><span class="line">                <span class="number">4</span>, <span class="comment">// 最大线程数</span></span><br><span class="line">                <span class="number">60</span>, <span class="comment">// 线程空闲保持时间</span></span><br><span class="line">                TimeUnit.SECONDS, <span class="comment">// 时间单位</span></span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">ArrayBlockingQueue</span>&lt;&gt;(<span class="number">10</span>) <span class="comment">// 阻塞队列容量为10</span></span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 提交任务到线程池</span></span><br><span class="line">        executor.execute(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt;= <span class="number">5</span>; i++) &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;aaa&quot;</span> + i);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        executor.execute(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt;= <span class="number">5</span>; i++) &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;bbb&quot;</span> + i);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        executor.execute(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt;= <span class="number">5</span>; i++) &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;ccc&quot;</span> + i);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 关闭线程池，防止新任务提交，但会执行完已提交的任务</span></span><br><span class="line">        executor.shutdown();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 等待线程池中任务完成</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (!executor.awaitTermination(<span class="number">60</span>, TimeUnit.SECONDS)) &#123;</span><br><span class="line">                executor.shutdownNow();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            executor.shutdownNow();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>实战模板：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ExecutorService</span> <span class="variable">threadPool</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ThreadPoolExecutor</span>(</span><br><span class="line">    <span class="number">2</span>, <span class="comment">// corePoolSize</span></span><br><span class="line">    <span class="number">5</span>, <span class="comment">// maximumPoolSize</span></span><br><span class="line">    <span class="number">3</span>, TimeUnit.SECONDS, <span class="comment">// keepAliveTime</span></span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">LinkedBlockingQueue</span>&lt;&gt;(<span class="number">3</span>), <span class="comment">// workQueue 容量为3</span></span><br><span class="line">    Executors.defaultThreadFactory(), <span class="comment">// threadFactory</span></span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">ThreadPoolExecutor</span>.CallerRunsPolicy() <span class="comment">// 拒绝策略</span></span><br><span class="line">);</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>注意事项：</p>
<ul>
<li><strong>临时线程什么时候创建</strong>？新任务提交的时候核心线程都在忙，任务队列满了，并还可以创建新的临时线程，才会创建临时线程</li>
<li><strong>什么时候会开始拒绝新任务</strong>？核心线程和临时线程都在忙，任务队列也满了，新的任务才会开始拒绝新任务</li>
</ul>
<p>核心线程数量应该是多少？</p>
<ul>
<li>计算密集的 cpu+1</li>
<li>IO密集的 cpu*2</li>
</ul>
<h2 id="关闭策略">关闭策略</h2>
<p>shutdown()方法会让线程池进入&quot;关闭&quot;状态,此时不再接受新的任务提交,但会继续执行队列中的任务直到完成。这是一种<strong>平缓的关闭方式。</strong></p>
<p>shutdownNow()方法会<strong>尝试终止所有正在执行的任务,并返回等待执行的任务列表(List)</strong>。这些任务是尚未开始执行的任务。</p>
<p>awaitTermination(long timeout, TimeUnit unit)是阻塞方法,它会等待直到以下三种情况之一发生:<br>
- 所有任务执行完成<br>
- 到达指定的超时时间<br>
- 当前线程被中断<br>
这个方法常用于<strong>确保线程池完全关闭</strong>。</p>
<h2 id="四大拒绝策略">四大拒绝策略</h2>
<table>
<thead>
<tr>
<th>策略类</th>
<th>策略说明</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>AbortPolicy</code>（默认）</td>
<td>抛出 <code>RejectedExecutionException</code> 异常</td>
</tr>
<tr>
<td><code>CallerRunsPolicy</code></td>
<td><strong>谁提交谁执行</strong>（回退给调用线程）</td>
</tr>
<tr>
<td><code>DiscardPolicy</code></td>
<td>直接丢弃任务，不抛异常</td>
</tr>
<tr>
<td><code>DiscardOldestPolicy</code></td>
<td>丢弃最早的任务，然后尝试加入新任务</td>
</tr>
</tbody>
</table>
<h2 id="常见面试问题">常见面试问题</h2>
<p><strong>线程池执行流程</strong>：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (当前线程数 &lt; corePoolSize)</span><br><span class="line">    创建新线程执行任务</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (队列未满)</span><br><span class="line">    放入阻塞队列</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (当前线程数 &lt; maximumPoolSize)</span><br><span class="line">    创建非核心线程处理</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    启动拒绝策略</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><strong>为什么不用 Executors 创建线程池？</strong></p>
<p><code>Executors.newFixedThreadPool</code> 和 <code>newSingleThreadExecutor</code> 使用的都是<strong>无界阻塞队列</strong>（如 <code>LinkedBlockingQueue</code>），在任务积压时会无限添加任务导致内存溢出（OOM）</p>
<p><code>newCachedThreadPool</code> 使用的是<strong>无界线程数</strong>，短时间大量任务可能创建海量线程，导致 <strong>CPU 被打爆或内存溢出</strong>。因此生产推荐使用 <code>ThreadPoolExecutor</code> 并指定参数</p>
<p>用手动创建更好</p>
<p><strong>核心线程与最大线程的区别？</strong></p>
<p><code>corePoolSize</code> 是核心线程数，线程池创建后<strong>优先使用核心线程</strong>；核心线程默认是常驻线程，即使空闲也不回收（除非设置 <code>allowCoreThreadTimeOut(true)</code>）。<br>
<code>maximumPoolSize</code> 是线程池能容纳的<strong>最大线程数</strong>，当核心线程+队列都满后才会创建非核心线程，超过该数量后再有任务就触发拒绝策略。</p>
<p><strong>线程池如何避免资源耗尽？</strong></p>
<p>1）合理设置 <code>corePoolSize</code> 和 <code>maximumPoolSize</code>；<br>
2）合理设置队列大小（如 <code>ArrayBlockingQueue</code>）；<br>
3）选择合适的 <code>RejectedExecutionHandler</code> 拒绝策略（如 <code>CallerRunsPolicy</code> 可回退执行）；<br>
4）限制任务提交速率（限流）或增加监控报警机制。</p>
<p><strong>线程池为什么需要 keepAliveTime？</strong></p>
<p><code>keepAliveTime</code> 用于控制<strong>非核心线程的生存时间</strong>：线程在空闲超过这个时间后会被回收，避免线程长时间闲置浪费资源。可通过 <code>allowCoreThreadTimeOut(true)</code> 让核心线程也参与超时机制，提升资源利用率。</p>
<p><strong>如何定位线程池满的情况？</strong></p>
<p>可从以下几个方面进行排查：<br>
1）日志中会抛出 <code>RejectedExecutionException</code>（默认拒绝策略）；<br>
2）设置自定义拒绝策略中记录日志或告警；<br>
3）使用线程池监控工具如 <strong>Arthas</strong>、<strong>JFR (Java Flight Recorder)</strong>、<strong>VisualVM</strong>，查看线程池状态：活跃线程数、任务队列长度等；<br>
4）通过 <code>ThreadPoolExecutor</code> 的 <code>getPoolSize()</code>、<code>getActiveCount()</code>、<code>getQueue().size()</code> 等方法动态采集指标并写入监控系统（如 Prometheus + Grafana）。</p>
</article><div class="post-copyright"><div class="copyright-cc-box"><i class="anzhiyufont anzhiyu-icon-copyright"></i></div><div class="post-copyright__author_box"><a class="post-copyright__author_img" href="/" title="头像"><img class="post-copyright__author_img_back" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://skymirror-1322372781.cos.ap-beijing.myqcloud.com/202407230955363.jpg" title="头像" alt="头像"><img class="post-copyright__author_img_front" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://skymirror-1322372781.cos.ap-beijing.myqcloud.com/202407230955363.jpg" title="头像" alt="头像"></a><div class="post-copyright__author_name">mengnankkzhou</div><div class="post-copyright__author_desc">不要走捏</div></div><div class="post-copyright__post__info"><a class="post-copyright__original" title="该文章为原创文章，注意版权协议" href="https://blog.tokenlen.top/2025/05/09/java-stack/juc1/">原创</a><a class="post-copyright-title"><span onclick="rm.copyPageUrl('https://blog.tokenlen.top/2025/05/09/java-stack/juc1/')">JUC-线程池</span></a></div><div class="post-tools" id="post-tools"><div class="post-tools-left"><div class="rewardLeftButton"></div><div class="shareRight"><div class="share-link mobile"><div class="share-qrcode"><div class="share-button" title="使用手机访问这篇文章"><i class="anzhiyufont anzhiyu-icon-qrcode"></i></div><div class="share-main"><div class="share-main-all"><div id="qrcode" title="https://blog.tokenlen.top/2025/05/09/java-stack/juc1/"></div><div class="reward-dec">使用手机访问这篇文章</div></div></div></div></div><div class="share-link weibo"><a class="share-button" target="_blank" href="https://service.weibo.com/share/share.php?title=JUC-线程池&amp;url=https://blog.tokenlen.top/2025/05/09/java-stack/juc1/&amp;pic=https://skymirror-1322372781.cos.ap-beijing.myqcloud.com/202410051722379.jpg?_r_=1bbcfc74-6e7b-1ac1-c223-0d258ea2d32c" rel="external nofollow noreferrer noopener"><i class="anzhiyufont anzhiyu-icon-weibo"></i></a></div><script>function copyCurrentPageUrl() {
  var currentPageUrl = window.location.href;
  var input = document.createElement("input");
  input.setAttribute("value", currentPageUrl);
  document.body.appendChild(input);
  input.select();
  input.setSelectionRange(0, 99999);
  document.execCommand("copy");
  document.body.removeChild(input);
}</script><div class="share-link copyurl"><div class="share-button" id="post-share-url" title="复制链接" onclick="copyCurrentPageUrl()"><i class="anzhiyufont anzhiyu-icon-link"></i></div></div></div></div></div><div class="post-copyright__notice"><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://blog.tokenlen.top" target="_blank">mengnankkのblog</a>！</span></div></div><div class="post-tools-right"><div class="tag_share"><div class="post-meta__box"><div class="post-meta__box__category-list"><a class="post-meta__box__categoryes" href="/categories/%E6%8A%80%E6%9C%AF%E6%A0%88/"><span class="categoryes-punctuation"> <i class="anzhiyufont anzhiyu-icon-inbox"></i></span>技术栈<span class="categoryesPageCount">8</span></a></div><div class="post-meta__box__tag-list"><a class="post-meta__box__tags" href="/tags/java/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>java<span class="tagsPageCount">35</span></a><a class="post-meta__box__tags" href="/tags/juc/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>juc<span class="tagsPageCount">2</span></a></div></div><div class="post_share"><div class="social-share" data-image="https://skymirror-1322372781.cos.ap-beijing.myqcloud.com/202407230955363.jpg?_r_=1b493498-3441-11f1-b47d-f977bba4a1b1" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"/><script src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer="defer"></script></div></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2025/05/09/leetcode/leetcodetotal/"><img class="prev-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://skymirror-1322372781.cos.ap-beijing.myqcloud.com/202407221838345.jpg?_r_=1c9b17e7-a864-bfd7-708b-687dfe6e6aff" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Leetcode各类题目模板分析题目总结</div></div></a></div><div class="next-post pull-right"><a href="/2025/05/12/leetcode/leetcode3/"><img class="next-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://skymirror-1322372781.cos.ap-beijing.myqcloud.com/202408081510678.jpg?_r_=8be359cd-f910-868f-7ee0-5b838c851ea0" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Leetcode双指针</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="anzhiyufont anzhiyu-icon-thumbs-up fa-fw" style="font-size: 1.5rem; margin-right: 4px"></i><span>喜欢这篇文章的人也看了</span></div><div class="relatedPosts-list"><div><a href="/2025/05/22/java-stack/juc2/" title="JUC-线程池面试题hot"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://skymirror-1322372781.cos.ap-beijing.myqcloud.com/202408081510095.jpg?_r_=d5827e55-7e86-ab55-64e5-81af4a735871" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-05-22</div><div class="title">JUC-线程池面试题hot</div></div></a></div><div><a href="/2025/04/01/leetcode/leetcodedayone/" title="Leetcode 每日一题"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://skymirror-1322372781.cos.ap-beijing.myqcloud.com/202407221837602.jpg?_r_=af0f1789-7dfb-a35b-5ec5-d39488b129d8" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-04-01</div><div class="title">Leetcode 每日一题</div></div></a></div><div><a href="/2025/03/02/leetcode/leetcodehot/" title="Leetcode HOT100题"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://skymirror-1322372781.cos.ap-beijing.myqcloud.com/20250126175712177.jpg?_r_=3dce0275-672f-01e5-e5c8-9172fc4348c5" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-03-02</div><div class="title">Leetcode HOT100题</div></div></a></div><div><a href="/2025/05/23/javase/javase3/" title="javase面试题目hot2"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://skymirror-1322372781.cos.ap-beijing.myqcloud.com/202407230955363.jpg?_r_=1b493498-3441-11f1-b47d-f977bba4a1b1" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-05-23</div><div class="title">javase面试题目hot2</div></div></a></div><div><a href="/2025/05/21/workmenu/tcpfile/" title="tcpfile上传"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://skymirror-1322372781.cos.ap-beijing.myqcloud.com/20250126175712178.jpg?_r_=14b3fb81-e100-934e-8c70-45ecd479d388" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-05-21</div><div class="title">tcpfile上传</div></div></a></div><div><a href="/2025/05/19/javase/javase1/" title="javase知识总结"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://skymirror-1322372781.cos.ap-beijing.myqcloud.com/202408081510678.jpg?_r_=42c8e194-fdba-1627-eb1e-c31458e5ef2f" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-05-19</div><div class="title">javase知识总结</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="anzhiyufont anzhiyu-icon-comments"></i><span> 评论</span></div><div class="comment-randomInfo"><a onclick="anzhiyu.addRandomCommentInfo()" href="javascript:void(0)">匿名评论</a><a href="/privacy" style="margin-left: 4px">隐私政策</a></div><div class="comment-switch"><span class="first-comment">Twikoo</span><span id="switch-btn"></span><span class="second-comment">Valine</span></div><div class="comment-tips" id="comment-tips"><span>✅ 你无需删除空行，直接评论以获取最佳展示效果</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div><div><div class="vcomment" id="vcomment"></div></div></div></div><div class="comment-barrage"></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-content"><div class="author-info__sayhi" id="author-info__sayhi" onclick="anzhiyu.changeSayHelloText()"></div><div class="author-info-avatar"><img class="avatar-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://skymirror-1322372781.cos.ap-beijing.myqcloud.com/202407230955363.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-status"><img class="g-status" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/08/24/64e6ce9c507bb.png" alt="status"/></div></div><div class="author-info__description">清风拂柳影，碧水映花香。</div><div class="author-info__bottom-group"><a class="author-info__bottom-group-left" href="/"><h1 class="author-info__name">mengnankkzhou</h1><div class="author-info__desc">不要走捏</div></a><div class="card-info-social-icons is-center"><a class="social-icon faa-parent animated-hover" href="https://github.com/mengnankkkk" target="_blank" title="Github"><i class="anzhiyufont anzhiyu-icon-github"></i></a><a class="social-icon faa-parent animated-hover" href="https://space.bilibili.com/440831872" target="_blank" title="BiliBili"><i class="anzhiyufont anzhiyu-icon-bilibili"></i></a></div></div></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bullhorn anzhiyu-shake"></i><span>公告</span></div><div class="announcement_content">欢迎来看我的博客鸭~</div></div><div class="card-widget anzhiyu-right-widget" id="card-wechat" onclick="null"><div id="flip-wrapper"><div id="flip-content"><div class="face" style="background: url(https://bu.dusays.com/2023/01/13/63c02edf44033.png) center center / 100% no-repeat"></div><div class="back face" style="background: url(https://skymirror-1322372781.cos.ap-beijing.myqcloud.com/202410021212939.jpg) center center / 100% no-repeat"></div></div></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bars"></i><span>文章目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">1.</span> <span class="toc-text">前置知识</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BA%BF%E7%A8%8B%E7%9A%84%E6%96%B9%E6%B3%95"><span class="toc-number">1.1.</span> <span class="toc-text">线程的方法</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">2.</span> <span class="toc-text">JUC结构</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#tool"><span class="toc-number">2.1.</span> <span class="toc-text">tool</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#executor"><span class="toc-number">2.2.</span> <span class="toc-text">executor</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#atomic"><span class="toc-number">2.3.</span> <span class="toc-text">atomic</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#locks"><span class="toc-number">2.4.</span> <span class="toc-text">locks</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#collection"><span class="toc-number">2.5.</span> <span class="toc-text">collection</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">3.</span> <span class="toc-text">lock（top）</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#synchronized"><span class="toc-number">3.1.</span> <span class="toc-text">synchronized</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#synchronized-vs-Lock-%E5%8C%BA%E5%88%AB%E6%80%BB%E7%BB%93-top"><span class="toc-number">3.1.1.</span> <span class="toc-text">synchronized vs Lock 区别总结(top)</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Condition-%E7%B2%BE%E5%87%86%E7%BA%BF%E7%A8%8B%E9%80%9A%E4%BF%A1%EF%BC%88%E7%94%9F%E4%BA%A7%E8%80%85-%E6%B6%88%E8%B4%B9%E8%80%85%E6%A8%A1%E5%9E%8B%EF%BC%89"><span class="toc-number">3.1.2.</span> <span class="toc-text">Condition 精准线程通信（生产者-消费者模型）</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">4.</span> <span class="toc-text">线程共享和线程安全</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BA%BF%E7%A8%8B%E5%AE%89%E5%85%A8"><span class="toc-number">4.1.</span> <span class="toc-text">线程安全</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#list"><span class="toc-number">4.1.1.</span> <span class="toc-text">list</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#set"><span class="toc-number">4.1.2.</span> <span class="toc-text">set</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#hashmap"><span class="toc-number">4.1.3.</span> <span class="toc-text">hashmap</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8D%95%E7%BA%BF%E7%A8%8B"><span class="toc-number">4.1.4.</span> <span class="toc-text">单线程</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E7%BA%BF%E7%A8%8B%E5%85%B1%E4%BA%AB"><span class="toc-number">4.2.</span> <span class="toc-text">线程共享</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">5.</span> <span class="toc-text">callable</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#FutureTask"><span class="toc-number">5.1.</span> <span class="toc-text">FutureTask</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">6.</span> <span class="toc-text">辅助类–tool</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#CountDownLatch%EF%BC%88%E5%80%92%E8%AE%A1%E6%97%B6%E9%94%81%EF%BC%89"><span class="toc-number">6.1.</span> <span class="toc-text">CountDownLatch（倒计时锁）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#CyclicBarrier%EF%BC%88%E5%BE%AA%E7%8E%AF%E5%B1%8F%E9%9A%9C%EF%BC%89"><span class="toc-number">6.2.</span> <span class="toc-text">CyclicBarrier（循环屏障）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Semaphore%EF%BC%88%E4%BF%A1%E5%8F%B7%E9%87%8F%EF%BC%89"><span class="toc-number">6.3.</span> <span class="toc-text">Semaphore（信号量）</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">7.</span> <span class="toc-text">阻塞</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%A6%82%E5%BF%B5"><span class="toc-number">7.1.</span> <span class="toc-text">概念</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%9B%E7%B1%BBAPI"><span class="toc-number">7.2.</span> <span class="toc-text">四类API</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B8%B8%E8%A7%81%E5%AE%9E%E7%8E%B0%E7%B1%BB"><span class="toc-number">7.3.</span> <span class="toc-text">常见实现类</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B0%8F%E7%BB%93"><span class="toc-number">7.4.</span> <span class="toc-text">小结</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">8.</span> <span class="toc-text">TLS</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#ThreadLocal"><span class="toc-number">8.1.</span> <span class="toc-text">ThreadLocal</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">9.</span> <span class="toc-text">线程池</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#3%E5%A4%A7%E5%88%9B%E5%BB%BA%E6%96%B9%E5%BC%8F"><span class="toc-number">9.1.</span> <span class="toc-text">3大创建方式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%89%8B%E5%8A%A8%E5%88%9B%E5%BB%BA"><span class="toc-number">9.2.</span> <span class="toc-text">手动创建</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%85%B3%E9%97%AD%E7%AD%96%E7%95%A5"><span class="toc-number">9.3.</span> <span class="toc-text">关闭策略</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%9B%9B%E5%A4%A7%E6%8B%92%E7%BB%9D%E7%AD%96%E7%95%A5"><span class="toc-number">9.4.</span> <span class="toc-text">四大拒绝策略</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%B8%B8%E8%A7%81%E9%9D%A2%E8%AF%95%E9%97%AE%E9%A2%98"><span class="toc-number">9.5.</span> <span class="toc-text">常见面试问题</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-history"></i><span>最近发布</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2025/05/23/javase/javase3/" title="javase面试题目hot2"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://skymirror-1322372781.cos.ap-beijing.myqcloud.com/202407230955363.jpg?_r_=1b493498-3441-11f1-b47d-f977bba4a1b1" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="javase面试题目hot2"/></a><div class="content"><a class="title" href="/2025/05/23/javase/javase3/" title="javase面试题目hot2">javase面试题目hot2</a><time datetime="2025-05-22T16:00:00.000Z" title="发表于 2025-05-23 00:00:00">2025-05-23</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/05/22/java-stack/juc2/" title="JUC-线程池面试题hot"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://skymirror-1322372781.cos.ap-beijing.myqcloud.com/202408081510095.jpg?_r_=d5827e55-7e86-ab55-64e5-81af4a735871" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="JUC-线程池面试题hot"/></a><div class="content"><a class="title" href="/2025/05/22/java-stack/juc2/" title="JUC-线程池面试题hot">JUC-线程池面试题hot</a><time datetime="2025-05-21T16:00:00.000Z" title="发表于 2025-05-22 00:00:00">2025-05-22</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/05/21/mysql/mysqlstack/" title="Mysql进阶技术栈"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://skymirror-1322372781.cos.ap-beijing.myqcloud.com/202407221837602.jpg?_r_=8a9e3b0d-8a67-b7ae-8ddb-f35526c9d556" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="Mysql进阶技术栈"/></a><div class="content"><a class="title" href="/2025/05/21/mysql/mysqlstack/" title="Mysql进阶技术栈">Mysql进阶技术栈</a><time datetime="2025-05-20T16:00:00.000Z" title="发表于 2025-05-21 00:00:00">2025-05-21</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/05/21/workmenu/tcpfile/" title="tcpfile上传"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://skymirror-1322372781.cos.ap-beijing.myqcloud.com/20250126175712178.jpg?_r_=14b3fb81-e100-934e-8c70-45ecd479d388" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="tcpfile上传"/></a><div class="content"><a class="title" href="/2025/05/21/workmenu/tcpfile/" title="tcpfile上传">tcpfile上传</a><time datetime="2025-05-20T16:00:00.000Z" title="发表于 2025-05-21 00:00:00">2025-05-21</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/05/19/javase/javase1/" title="javase知识总结"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://skymirror-1322372781.cos.ap-beijing.myqcloud.com/202408081510678.jpg?_r_=42c8e194-fdba-1627-eb1e-c31458e5ef2f" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="javase知识总结"/></a><div class="content"><a class="title" href="/2025/05/19/javase/javase1/" title="javase知识总结">javase知识总结</a><time datetime="2025-05-18T16:00:00.000Z" title="发表于 2025-05-19 00:00:00">2025-05-19</time></div></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="footer_custom_text"><p><a style="margin-inline:5px" target="_blank" href="https://hexo.io/">
  <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shields.io/badge/Framework-Hexo-4e88f8?style=flat&logo=hexo" 
       title="博客框架为 Hexo" alt="Hexo">
</a>
<a style="margin-inline:5px" target="_blank" href="https://github.com/">
  <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shields.io/badge/Source-Github-24292f?style=flat&logo=github" 
       title="本站项目由 GitHub 托管" alt="GitHub">
</a>
<a style="margin-inline:5px" target="_blank" href="https://vercel.com/">
  <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shields.io/badge/Cloud-Vercel-000000?style=flat&logo=vercel" 
       title="使用 Vercel 部署" alt="Vercel">
</a>
<a style="margin-inline:5px" target="_blank" href="https://www.qlu.edu.cn/">
  <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shields.io/badge/University-齐鲁工业大学-0056a2?style=flat&logo=university" 
       title="齐鲁工业大学" alt="齐鲁工业大学">
</a>
<a style="margin-inline:5px" target="_blank" href="https://www.aliyun.com/">
  <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shields.io/badge/Cloud-阿里云-ff6a00?style=flat&logo=aliyun" 
       title="使用阿里云服务" alt="阿里云">
</a>
<a style="margin-inline:5px" target="_blank" href="https://cloud.tencent.com/">
  <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shields.io/badge/Cloud-腾讯云-0a73b8?style=flat&logo=tencent-cloud" 
       title="使用腾讯云服务" alt="腾讯云">
</a></p>
</div></div><div id="footer-bar"><div class="footer-bar-links"><div class="footer-bar-left"><div id="footer-bar-tips"><div class="copyright">&copy;2023 - 2025 By <a class="footer-bar-link" href="/" title="mengnankkzhou" target="_blank">mengnankkzhou</a></div></div><div id="footer-type-tips"></div></div><div class="footer-bar-right"><a class="footer-bar-link" target="_blank" rel="noopener" href="https://beian.miit.gov.cn/" title="鲁ICP备2024110758号">鲁ICP备2024110758号</a><a class="footer-bar-link" href="https://blog.tokenlen.top/rss2.xml" title="Rss">Rss</a><a class="footer-bar-link cc" href="/pravite" title="cc协议"><i class="anzhiyufont anzhiyu-icon-copyright-line"></i><i class="anzhiyufont anzhiyu-icon-creative-commons-by-line"></i><i class="anzhiyufont anzhiyu-icon-creative-commons-nc-line"></i><i class="anzhiyufont anzhiyu-icon-creative-commons-nd-line"></i></a></div></div></div></footer></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="sidebar-site-data site-data is-center"><a href="/archives/" title="archive"><div class="headline">文章</div><div class="length-num">117</div></a><a href="/tags/" title="tag"><div class="headline">标签</div><div class="length-num">36</div></a><a href="/categories/" title="category"><div class="headline">分类</div><div class="length-num">18</div></a></div><span class="sidebar-menu-item-title">功能</span><div class="sidebar-menu-item"><a class="darkmode_switchbutton menu-child" href="javascript:void(0);" title="显示模式"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span>显示模式</span></a></div><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" href="https://blog.tokenlen.top/" title="博客"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="博客"/><span class="back-menu-item-text">博客</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="http://img.mengnankk.top:9001/" title="图床"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="图床"/><span class="back-menu-item-text">图床</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">项目</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="http://img.mengnankk.top:9001/" title="mengnankk图床"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/08/13/64d8c2653332e.ico" alt="mengnankk图床"/><span class="back-menu-item-text">mengnankk图床</span></a></div></div></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size: 0.9em;"></i><span> 隧道</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 生活</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/album/"><i class="anzhiyufont anzhiyu-icon-images faa-tada" style="font-size: 0.9em;"></i><span> 相册集</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/essay/"><i class="anzhiyufont anzhiyu-icon-lightbulb faa-tada" style="font-size: 0.9em;"></i><span> 闲言碎语</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/music/"><i class="anzhiyufont anzhiyu-icon-music faa-tada" style="font-size: 0.9em;"></i><span> 音乐馆</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 我的</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><i class="anzhiyufont anzhiyu-icon-link faa-tada" style="font-size: 0.9em;"></i><span> 友人帐</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size: 0.9em;"></i><span> 关于本人</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/Message/"><i class="anzhiyufont anzhiyu-icon-envelope faa-tada" style="font-size: 0.9em;"></i><span> 留言</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 其他</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" target="_blank" rel="noopener" href="https://home.tokenlen.top/"><i class="anzhiyufont anzhiyu-icon-envelope faa-tada" style="font-size: 0.9em;"></i><span> home</span></a></li><li><a class="site-page child faa-parent animated-hover" target="_blank" rel="noopener" href="https://status.mengnankk.asia/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 站点检测</span></a></li><li><a class="site-page child faa-parent animated-hover" target="_blank" rel="noopener" href="https://home.tokenlen.top/"><i class="anzhiyufont anzhiyu-icon-lightbulb faa-tada" style="font-size: 0.9em;"></i><span> 心里话</span></a></li></ul></div></div><span class="sidebar-menu-item-title">标签</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/BF/" style="font-size: 0.88rem;">BF<sup>1</sup></a><a href="/tags/BigData/" style="font-size: 0.88rem;">BigData<sup>1</sup></a><a href="/tags/C/" style="font-size: 0.88rem;">C<sup>4</sup></a><a href="/tags/CE/" style="font-size: 0.88rem;">CE<sup>1</sup></a><a href="/tags/CSRF/" style="font-size: 0.88rem;">CSRF<sup>1</sup></a><a href="/tags/English/" style="font-size: 0.88rem;">English<sup>9</sup></a><a href="/tags/FI/" style="font-size: 0.88rem;">FI<sup>1</sup></a><a href="/tags/Hadoop/" style="font-size: 0.88rem;">Hadoop<sup>1</sup></a><a href="/tags/Linux/" style="font-size: 0.88rem;">Linux<sup>12</sup></a><a href="/tags/XSS/" style="font-size: 0.88rem;">XSS<sup>1</sup></a><a href="/tags/css/" style="font-size: 0.88rem;">css<sup>2</sup></a><a href="/tags/football/" style="font-size: 0.88rem;">football<sup>1</sup></a><a href="/tags/html/" style="font-size: 0.88rem;">html<sup>1</sup></a><a href="/tags/java/" style="font-size: 0.88rem;">java<sup>35</sup></a><a href="/tags/juc/" style="font-size: 0.88rem;">juc<sup>2</sup></a><a href="/tags/leetcode/" style="font-size: 0.88rem;">leetcode<sup>6</sup></a><a href="/tags/markdown/" style="font-size: 0.88rem;">markdown<sup>1</sup></a><a href="/tags/mysql/" style="font-size: 0.88rem;">mysql<sup>16</sup></a><a href="/tags/net/" style="font-size: 0.88rem;">net<sup>4</sup></a><a href="/tags/paper/" style="font-size: 0.88rem;">paper<sup>1</sup></a><a href="/tags/php/" style="font-size: 0.88rem;">php<sup>5</sup></a><a href="/tags/pip/" style="font-size: 0.88rem;">pip<sup>1</sup></a><a href="/tags/python/" style="font-size: 0.88rem;">python<sup>3</sup></a><a href="/tags/redis/" style="font-size: 0.88rem;">redis<sup>3</sup></a><a href="/tags/shell/" style="font-size: 0.88rem;">shell<sup>4</sup></a><a href="/tags/spring/" style="font-size: 0.88rem;">spring<sup>2</sup></a><a href="/tags/spring-boot/" style="font-size: 0.88rem;">spring boot<sup>6</sup></a><a href="/tags/sql/" style="font-size: 0.88rem;">sql<sup>4</sup></a><a href="/tags/web/" style="font-size: 0.88rem;">web<sup>3</sup></a><a href="/tags/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/" style="font-size: 0.88rem;">操作系统<sup>1</sup></a><a href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93%E5%8E%9F%E7%90%86/" style="font-size: 0.88rem;">数据库原理<sup>3</sup></a><a href="/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" style="font-size: 0.88rem;">数据结构<sup>16</sup></a><a href="/tags/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/" style="font-size: 0.88rem;">正则表达式<sup>2</sup></a><a href="/tags/%E6%AF%9B%E9%80%89/" style="font-size: 0.88rem;">毛选<sup>1</sup></a><a href="/tags/%E7%AE%97%E6%B3%95/" style="font-size: 0.88rem;">算法<sup>8</sup></a><a href="/tags/%E9%9D%A2%E8%AF%95/" style="font-size: 0.88rem;">面试<sup>8</sup></a></div></div><hr/></div></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="anzhiyufont anzhiyu-icon-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="anzhiyufont anzhiyu-icon-gear"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="anzhiyufont anzhiyu-icon-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="anzhiyufont anzhiyu-icon-comments"></i></a><a id="switch-commentBarrage" href="javascript:anzhiyu.switchCommentBarrage();" title="开关弹幕"><i class="anzhiyufont anzhiyu-icon-danmu"></i></a><button id="go-up" type="button" title="回到顶部"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><div id="nav-music"><a id="nav-music-hoverTips" onclick="anzhiyu.musicToggle()" accesskey="m">播放音乐</a><div id="console-music-bg"></div><meting-js id="8152976493" server="netease" type="playlist" mutex="true" preload="none" theme="var(--anzhiyu-main)" data-lrctype="0" order="random" volume="0.7"></meting-js></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="anzhiyufont anzhiyu-icon-xmark"></i></button></nav><div class="is-center" id="loading-database"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-pulse-icon"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><div class="rightMenu-item" id="menu-backward"><i class="anzhiyufont anzhiyu-icon-arrow-left"></i></div><div class="rightMenu-item" id="menu-forward"><i class="anzhiyufont anzhiyu-icon-arrow-right"></i></div><div class="rightMenu-item" id="menu-refresh"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right" style="font-size: 1rem;"></i></div><div class="rightMenu-item" id="menu-top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></div></div><div class="rightMenu-group rightMenu-line rightMenuPlugin"><div class="rightMenu-item" id="menu-copytext"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制选中文本</span></div><div class="rightMenu-item" id="menu-pastetext"><i class="anzhiyufont anzhiyu-icon-paste"></i><span>粘贴文本</span></div><a class="rightMenu-item" id="menu-commenttext"><i class="anzhiyufont anzhiyu-icon-comment-medical"></i><span>引用到评论</span></a><div class="rightMenu-item" id="menu-newwindow"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开</span></div><div class="rightMenu-item" id="menu-copylink"><i class="anzhiyufont anzhiyu-icon-link"></i><span>复制链接地址</span></div><div class="rightMenu-item" id="menu-copyimg"><i class="anzhiyufont anzhiyu-icon-images"></i><span>复制此图片</span></div><div class="rightMenu-item" id="menu-downloadimg"><i class="anzhiyufont anzhiyu-icon-download"></i><span>下载此图片</span></div><div class="rightMenu-item" id="menu-newwindowimg"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开图片</span></div><div class="rightMenu-item" id="menu-search"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>站内搜索</span></div><div class="rightMenu-item" id="menu-searchBaidu"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>百度搜索</span></div><div class="rightMenu-item" id="menu-music-toggle"><i class="anzhiyufont anzhiyu-icon-play"></i><span>播放音乐</span></div><div class="rightMenu-item" id="menu-music-back"><i class="anzhiyufont anzhiyu-icon-backward"></i><span>切换到上一首</span></div><div class="rightMenu-item" id="menu-music-forward"><i class="anzhiyufont anzhiyu-icon-forward"></i><span>切换到下一首</span></div><div class="rightMenu-item" id="menu-music-playlist" onclick="window.open(&quot;https://y.qq.com/n/ryqq/playlist/8802438608&quot;, &quot;_blank&quot;);" style="display: none;"><i class="anzhiyufont anzhiyu-icon-radio"></i><span>查看所有歌曲</span></div><div class="rightMenu-item" id="menu-music-copyMusicName"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制歌名</span></div></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item menu-link" id="menu-randomPost"><i class="anzhiyufont anzhiyu-icon-shuffle"></i><span>随便逛逛</span></a><a class="rightMenu-item menu-link" href="/categories/"><i class="anzhiyufont anzhiyu-icon-cube"></i><span>博客分类</span></a><a class="rightMenu-item menu-link" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags"></i><span>文章标签</span></a></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item" id="menu-copy" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制地址</span></a><a class="rightMenu-item" id="menu-commentBarrage" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-message"></i><span class="menu-commentBarrage-text">关闭热评</span></a><a class="rightMenu-item" id="menu-darkmode" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span class="menu-darkmode-text">深色模式</span></a><a class="rightMenu-item" id="menu-translate" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-language"></i><span>轉為繁體</span></a></div></div><div id="rightmenu-mask"></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.umd.js"></script><script src="https://cdn.cbd.int/instant.page@5.2.0/instantpage.js" type="module"></script><script src="https://cdn.cbd.int/vanilla-lazyload@17.8.5/dist/lazyload.iife.min.js"></script><script src="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.js"></script><script>function panguFn () {
  if (typeof pangu === 'object') pangu.autoSpacingPage()
  else {
    getScript('https://cdn.cbd.int/pangu@4.0.7/dist/browser/pangu.min.js')
      .then(() => {
        pangu.autoSpacingPage()
      })
  }
}

function panguInit () {
  if (true){
    GLOBAL_CONFIG_SITE.isPost && panguFn()
  } else {
    panguFn()
  }
}

document.addEventListener('DOMContentLoaded', panguInit)</script><canvas id="universe"></canvas><script async src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/dark/dark.js"></script><script>// 消除控制台打印
var HoldLog = console.log;
console.log = function () {};
let now1 = new Date();
queueMicrotask(() => {
  const Log = function () {
    HoldLog.apply(console, arguments);
  }; //在恢复前输出日志
  const grt = new Date("04/01/2021 00:00:00"); //此处修改你的建站时间或者网站上线时间
  now1.setTime(now1.getTime() + 250);
  const days = (now1 - grt) / 1000 / 60 / 60 / 24;
  const dnum = Math.floor(days);
  const ascll = [
    `欢迎使用安知鱼!`,
    `生活明朗, 万物可爱`,
    `
        
       █████╗ ███╗   ██╗███████╗██╗  ██╗██╗██╗   ██╗██╗   ██╗
      ██╔══██╗████╗  ██║╚══███╔╝██║  ██║██║╚██╗ ██╔╝██║   ██║
      ███████║██╔██╗ ██║  ███╔╝ ███████║██║ ╚████╔╝ ██║   ██║
      ██╔══██║██║╚██╗██║ ███╔╝  ██╔══██║██║  ╚██╔╝  ██║   ██║
      ██║  ██║██║ ╚████║███████╗██║  ██║██║   ██║   ╚██████╔╝
      ╚═╝  ╚═╝╚═╝  ╚═══╝╚══════╝╚═╝  ╚═╝╚═╝   ╚═╝    ╚═════╝
        
        `,
    "已上线",
    dnum,
    "天",
    "©2023 By 安知鱼 V1.6.12",
  ];
  const ascll2 = [`NCC2-036`, `调用前置摄像头拍照成功，识别为【小笨蛋】.`, `Photo captured: `, `🤪`];

  setTimeout(
    Log.bind(
      console,
      `\n%c${ascll[0]} %c ${ascll[1]} %c ${ascll[2]} %c${ascll[3]}%c ${ascll[4]}%c ${ascll[5]}\n\n%c ${ascll[6]}\n`,
      "color:#425AEF",
      "",
      "color:#425AEF",
      "color:#425AEF",
      "",
      "color:#425AEF",
      ""
    )
  );
  setTimeout(
    Log.bind(
      console,
      `%c ${ascll2[0]} %c ${ascll2[1]} %c \n${ascll2[2]} %c\n${ascll2[3]}\n`,
      "color:white; background-color:#4fd953",
      "",
      "",
      'background:url("https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/tinggge.gif") no-repeat;font-size:450%'
    )
  );

  setTimeout(Log.bind(console, "%c WELCOME %c 你好，小笨蛋.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(
      console,
      "%c ⚡ Powered by 安知鱼 %c 你正在访问 mengnankkzhou 的博客.",
      "color:white; background-color:#f0ad4e",
      ""
    )
  );

  setTimeout(Log.bind(console, "%c W23-12 %c 你已打开控制台.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(console, "%c S013-782 %c 你现在正处于监控中.", "color:white; background-color:#d9534f", "")
  );
});</script><script async src="/anzhiyu/random.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>if (!window.MathJax) {
  window.MathJax = {
    tex: {
      inlineMath: [['$', '$'], ['\\(', '\\)']],
      tags: 'ams'
    },
    chtml: {
      scale: 1.1
    },
    options: {
      renderActions: {
        findScript: [10, doc => {
          for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
            const display = !!node.type.match(/; *mode=display/)
            const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display)
            const text = document.createTextNode('')
            node.parentNode.replaceChild(text, node)
            math.start = {node: text, delim: '', n: 0}
            math.end = {node: text, delim: '', n: 0}
            doc.math.push(math)
          }
        }, '']
      }
    }
  }
  
  const script = document.createElement('script')
  script.src = 'https://cdn.cbd.int/mathjax@3.2.2/es5/tex-mml-chtml.js'
  script.id = 'MathJax-script'
  script.async = true
  document.head.appendChild(script)
} else {
  MathJax.startup.document.state(0)
  MathJax.texReset()
  MathJax.typesetPromise()
}</script><script>(() => {
  const init = () => {
    twikoo.init(Object.assign({
      el: '#twikoo-wrap',
      envId: 'https://comment.tokenlen.top/',
      region: '',
      onCommentLoaded: () => {
        anzhiyu.loadLightbox(document.querySelectorAll('#twikoo .tk-content img:not(.tk-owo-emotion)'))
      }
    }, "siu~~~~~"))
  }

  const loadTwikoo = () => {
    if (typeof twikoo === 'object') setTimeout(runFn,0)
    else getScript('https://cdn.cbd.int/twikoo@1.6.25/dist/twikoo.all.min.js').then(runFn)
  }

  const getCount = () => {
    const countELement = document.getElementById('twikoo-count')
    if(!countELement) return
    twikoo.getCommentsCount({
      envId: 'https://comment.tokenlen.top/',
      region: '',
      urls: [window.location.pathname],
      includeReply: false
    }).then(res => {
      countELement.textContent = res[0].count
    }).catch(err => {
      console.error(err)
    })
  }

  const runFn = () => {
    init();
    
  }

  if ('Twikoo' === 'Twikoo' || !false) {
    if (false) anzhiyu.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else {
      loadTwikoo()
    }
  } else {
    window.loadOtherComment = loadTwikoo
  }
})()</script><script>(() => {
  const initValine = () => {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: '3ZpuzQHHKWfFH59QFYmcuCvr-gzGzoHsz',
      appKey: '8DIvljObQp853ueQMZzpb9Gx',
      avatar: 'mp',
      serverURLs: '',
      emojiMaps: "",
      path: window.location.pathname,
      visitor: false
    }, null))
  }

  const loadValine = async () => {
    if (typeof Valine === 'function') initValine()
    else {
      await getScript('https://cdn.cbd.int/valine@1.5.1/dist/Valine.min.js')
      initValine()
    }
  }

  if ('Twikoo' === 'Valine' || !false) {
    if (false) anzhiyu.loadComment(document.getElementById('vcomment'),loadValine)
    else setTimeout(loadValine, 0)
  } else {
    window.loadOtherComment = loadValine
  }
})()</script><input type="hidden" name="page-type" id="page-type" value="post"></div><script>window.addEventListener('load', () => {
  const changeContent = (content) => {
    if (content === '') return content

    content = content.replace(/<img.*?src="(.*?)"?[^\>]+>/ig, '[图片]') // replace image link
    content = content.replace(/<a[^>]+?href=["']?([^"']+)["']?[^>]*>([^<]+)<\/a>/gi, '[链接]') // replace url
    content = content.replace(/<pre><code>.*?<\/pre>/gi, '[代码]') // replace code
    content = content.replace(/<[^>]+>/g,"") // remove html tag

    if (content.length > 150) {
      content = content.substring(0,150) + '...'
    }
    return content
  }

  const getComment = () => {
    const runTwikoo = () => {
      twikoo.getRecentComments({
        envId: 'https://comment.tokenlen.top/',
        region: '',
        pageSize: 6,
        includeReply: true
      }).then(function (res) {
        const twikooArray = res.map(e => {
          return {
            'content': changeContent(e.comment),
            'avatar': e.avatar,
            'nick': e.nick,
            'url': e.url + '#' + e.id,
            'date': new Date(e.created).toISOString()
          }
        })

        saveToLocal.set('twikoo-newest-comments', JSON.stringify(twikooArray), 10/(60*24))
        generateHtml(twikooArray)
      }).catch(function (err) {
        const $dom = document.querySelector('#card-newest-comments .aside-list')
        $dom.textContent= "无法获取评论，请确认相关配置是否正确"
      })
    }

    if (typeof twikoo === 'object') {
      runTwikoo()
    } else {
      getScript('https://cdn.cbd.int/twikoo@1.6.25/dist/twikoo.all.min.js').then(runTwikoo)
    }
  }

  const generateHtml = array => {
    let result = ''

    if (array.length) {
      for (let i = 0; i < array.length; i++) {
        result += '<div class=\'aside-list-item\'>'

        if (true) {
          const name = 'data-lazy-src'
          result += `<a href='${array[i].url}' class='thumbnail'><img ${name}='${array[i].avatar}' alt='${array[i].nick}'><div class='name'><span>${array[i].nick} </span></div></a>`
        }
        
        result += `<div class='content'>
        <a class='comment' href='${array[i].url}' title='${array[i].content}'>${array[i].content}</a>
        <time datetime="${array[i].date}">${anzhiyu.diffDate(array[i].date, true)}</time></div>
        </div>`
      }
    } else {
      result += '没有评论'
    }

    let $dom = document.querySelector('#card-newest-comments .aside-list')
    $dom && ($dom.innerHTML= result)
    window.lazyLoadInstance && window.lazyLoadInstance.update()
    window.pjax && window.pjax.refresh($dom)
  }

  const newestCommentInit = () => {
    if (document.querySelector('#card-newest-comments .aside-list')) {
      const data = saveToLocal.get('twikoo-newest-comments')
      if (data) {
        generateHtml(JSON.parse(data))
      } else {
        getComment()
      }
    }
  }

  newestCommentInit()
  document.addEventListener('pjax:complete', newestCommentInit)
})</script><script async data-pjax src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.1/bubble/bubble.js"></script><script>var visitorMail = "";
</script><script async data-pjax src="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/waterfall/waterfall.js"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/qrcodejs/1.0.0/qrcode.min.js"></script><script src="/js/anzhiyu/right_click_menu.js"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.9/icon/ali_iconfont_css.css"><script defer="defer" id="fluttering_ribbon" mobile="true" src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/dist/canvas-fluttering-ribbon.min.js"></script><script id="click-show-text" src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/dist/click-show-text.min.js" data-mobile="false" data-text="I,LOVE,YOU" data-fontsize="15px" data-random="false" async="async"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/aplayer/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.cbd.int/anzhiyu-blog-static@1.0.1/js/APlayer.min.js"></script><script src="https://cdn.cbd.int/hexo-anzhiyu-music@1.0.1/assets/js/Meting2.min.js"></script><script src="https://cdn.cbd.int/pjax@0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["meta[property=\"og:image\"]","meta[property=\"og:title\"]","meta[property=\"og:url\"]","meta[property=\"og:type\"]","meta[property=\"og:site_name\"]","meta[property=\"og:description\"]","head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]
var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {
  // removeEventListener scroll 
  anzhiyu.removeGlobalFnEvent('pjax')
  anzhiyu.removeGlobalFnEvent('themeChange')

  document.getElementById('rightside').classList.remove('rightside-show')
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script charset="UTF-8" src="https://cdn.cbd.int/anzhiyu-theme-static@1.1.5/accesskey/accesskey.js"></script></div><div id="popup-window"><div class="popup-window-title">通知</div><div class="popup-window-divider"></div><div class="popup-window-content"><div class="popup-tip">你好呀</div><div class="popup-link"><i class="anzhiyufont anzhiyu-icon-arrow-circle-right"></i></div></div></div></body></html>