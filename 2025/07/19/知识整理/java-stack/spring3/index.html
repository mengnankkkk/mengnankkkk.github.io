<!DOCTYPE html><html lang="zh-CN" data-theme="dark"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"><title>Spring面试题hot2-源码分析 | mengnankkのblog</title><meta name="keywords" content="java,面试,spring"><meta name="author" content="mengnankkzhou"><meta name="copyright" content="mengnankkzhou"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#18171d"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-touch-fullscreen" content="yes"><meta name="apple-mobile-web-app-title" content="Spring面试题hot2-源码分析"><meta name="application-name" content="Spring面试题hot2-源码分析"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="#18171d"><meta property="og:type" content="article"><meta property="og:title" content="Spring面试题hot2-源码分析"><meta property="og:url" content="https://blog.tokenlen.top/2025/07/19/%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/java-stack/spring3/index.html"><meta property="og:site_name" content="mengnankkのblog"><meta property="og:description" content="基础 1.什么是 IOC？ IOC就是控制反转，反转之前是啥，，，反转之后是啥。。。。实现核心就是反射，设计模式是工厂模式 然后IOC和核心就是DI，几种实现方式，循环依赖的解决方式。 @bean的生命周期，@PostConstruct @PreDestroy，bean的作用域，单例，原型，webs"><meta property="og:locale" content="zh-CN"><meta property="og:image" content="https://skymirror-1322372781.cos.ap-beijing.myqcloud.com/202408081510494.jpg?_r_=57d05052-4f6f-e7fd-6fa7-231c0276d639"><meta property="article:author" content="mengnankkzhou"><meta property="article:tag"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://skymirror-1322372781.cos.ap-beijing.myqcloud.com/202408081510494.jpg?_r_=57d05052-4f6f-e7fd-6fa7-231c0276d639"><meta name="description" content="基础 1.什么是 IOC？ IOC就是控制反转，反转之前是啥，，，反转之后是啥。。。。实现核心就是反射，设计模式是工厂模式 然后IOC和核心就是DI，几种实现方式，循环依赖的解决方式。 @bean的生命周期，@PostConstruct @PreDestroy，bean的作用域，单例，原型，webs"><link rel="shortcut icon" href="/favicon.ico"><link rel="canonical" href="https://blog.tokenlen.top/2025/07/19/%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/java-stack/spring3/"><link rel="preconnect" href="//cdn.cbd.int"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="google-site-verification" content="xxx"/><meta name="baidu-site-verification" content="code-xxx"/><meta name="msvalidate.01" content="xxx"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/swiper/swiper.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  linkPageTop: undefined,
  peoplecanvas: undefined,
  postHeadAiDescription: {"enable":true,"gptName":"AnZhiYu","mode":"local","switchBtn":false,"btnLink":"https://afdian.net/item/886a79d4db6711eda42a52540025c377","randomNum":3,"basicWordCount":1000,"key":"xxxx","Referer":"https://xx.xx/"},
  diytitle: {"enable":true,"leaveTitle":"w(ﾟДﾟ)w 不要走啊，那种事情不要啊","backTitle":"♪(^∇^*)欢迎回家！！！！"},
  LA51: undefined,
  greetingBox: {"enable":"ture","default":"晚上好👋","list":[{"greeting":"晚安😴","startTime":0,"endTime":5},{"greeting":"早上好鸭👋, 祝你一天好心情！","startTime":6,"endTime":9},{"greeting":"上午好👋, 状态很好，鼓励一下～","startTime":10,"endTime":10},{"greeting":"11点多啦, 在坚持一下就吃饭啦～","startTime":11,"endTime":11},{"greeting":"午安👋, 宝贝","startTime":12,"endTime":14},{"greeting":"🌈充实的一天辛苦啦！","startTime":14,"endTime":18},{"greeting":"19点喽, 奖励一顿丰盛的大餐吧🍔。","startTime":19,"endTime":19},{"greeting":"晚上好👋, 在属于自己的时间好好放松😌~","startTime":20,"endTime":24}]},
  twikooEnvId: 'https://comment.tokenlen.top/',
  commentBarrageConfig:{"enable":true,"maxBarrage":1,"barrageTime":4000,"accessToken":"\tbd9428de12b54b96b2f1b4e69aeee81f","mailMd5":"F37442226DA71492"},
  root: '/',
  preloader: {"source":3},
  friends_vue_info: undefined,
  navMusic: true,
  mainTone: undefined,
  authorStatus: {"skills":["🤖️ 数码科技爱好者","🔍 分享与热心帮助","🏠 智能家居小能手","🔨 设计开发一条龙","🤝 专修交互与设计","🏃 脚踏实地行动派","🧱 团队小组发动机","💢 壮汉人狠话不多"]},
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简","rightMenuMsgToTraditionalChinese":"转为繁体","rightMenuMsgToSimplifiedChinese":"转为简体"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":330},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: true,
    simplehomepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"copy":true,"copyrightEbable":false,"limitCount":50,"languages":{"author":"作者: mengnankkzhou","link":"链接: ","source":"来源: mengnankkのblog","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。","copySuccess":"复制成功，复制和转载请标注本文地址"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#425AEF","bgDark":"#1f1f1f","position":"top-center"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.min.js',
      css: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false,
  shortcutKey: undefined,
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  configTitle: 'mengnankkのblog',
  title: 'Spring面试题hot2-源码分析',
  postAI: '',
  pageFillDescription: '基础, 1.什么是 IOC？, 2.什么是spring Aop, 3.spring的常用注解, 4.@Bean, 5.spring事务, 6.spring MVC, 7.springboot, spring源码分析, bean, 设计模式, 实例化, 注入, bean管理, bean组件的扩展, bean的初始化和销毁, Aware, FactoryBeanampBean的作用域, 事件, 动态代理基础什么是就是控制反转反转之前是啥反转之后是啥实现核心就是反射设计模式是工厂模式然后和核心就是几种实现方式循环依赖的解决方式的生命周期的作用域单例原型的单例不一定是线程安全的这个跟我们的业务逻辑有关如果没有一个可变的成员变量那么他就是无状态的也就是线程安全的我们为了保证线程安全可以改变作作用域为或者使用或者是用锁容器和都是的容器但后者是前者的超集提供了更强大的功能继承了所以它具备的所有能力同时还提供了更多面向企业应用的功能它的预加载机制能帮助你在应用启动时就发现配置错误而不是等到运行时才报错特性推荐使用核心定位容器的基础接口是底层基础设施容器的高级接口是的子接口加载懒加载只有当被调用时才会去实例化预加载容器启动时会一次性实例化所有作用域的功能丰富度功能较少主要提供的注册和获取功能非常丰富除了的所有功能外还提供了国际化支持事件发布与传播机制集成自动识别并配置等环境支持如资源访问如前缀的资源加载使用场景对内存消耗要求极高的场景如移动设备在现代企业应用开发中几乎不直接使用绝大多数应用和所有应用的默认选择什么是是啥作用实现的原理动态代理几个概念切面连接点通知切点织入通过织入将切面中的通知应用到由切点匹配到的连接点所对应的目标对象上通知类型用了代理这个设计模式代理对象接管了对目标对象的访问所有外部调用都必须先经过代理对象代理对象在将调用请求转发给真正的目标对象之前或之后有机会执行额外的操作这些额外的操作就是我们之前说的通知也就是切面逻辑的核心是基于动态代理实现的它利用代理模式在运行时为我们的目标动态地创建一个代理对象这个代理对象拦截了对原始方法的所有调用并在调用前后织入了我们定义的切面逻辑比如日志事务等从而在不修改源代码的情况下实现了功能的增强这个只能作用在方法上所以非的方法会失效通知注解包裹在目标方法的整个执行过程周围它是功能最强大最灵活的通知环绕通知的第一个参数必须是它有一个方法你可以在调用方法之前执行逻辑等同于你可以决定是否调用方法从而决定是否执行目标方法你可以在调用方法之后执行逻辑等同于你可以修改目标方法的参数或返回值你可以捕获并处理目标方法抛出的异常等同于的常用注解组件标记为一个组件生成一个业务层的组件注解层的组件注解但是能让自动转换特定于平台的数据库异常为统一的层的组件注解定义的作用域最常用的两个是默认值在整个应用中只有一个实例每次请求获取时都会创建一个新的实例和初始化合销毁按类型自动注入依赖如果找到多个相同类型的会尝试按名称匹配如果还找不到就会报错指定的名称注入多个相同的默认按名称注入找不到就按类型注入专门写的指定从请求的的中获取参数从路径里面获取参数把发过来的请求体变成一个对象配置就是启用的自动配置机制内部使用注解是自动装配的核心每发现一个自动配置类就使用条件判断来确实是不是满足导入条件自动创建所选将项目中包下的所有组件注册到容器中自动扫描启动类所在包及其子包下的所有组件配置文件读取值作用方法上表明配置类创建实例化填充属性初始化可用和销毁实例化当客户端请求一个或者在容器启动时容器会查找的定义利用的反射机制或者工厂方法创建一个原始的填充属性容器识别的依赖关系比如从容器中查找对应的通过反射将依赖注入到的属性中初始化最重要的点扩展点最多的执行接口的方法实现了特定的接口比如执行的前置处理调用所有的方法执行注解的方法调用使用了的方法执行接口的方法实现了接口会调用它的方法执行自定义的如果在配置或注解中指定了会调用这个自定义的初始化方法执行的后置处理调用所有的方法的动态代理就是在这个阶段通过包装原始实例并返回一个代理对象来实现的我们平时拿到的很多时候其实是这一步处理后的代理对象可用和销毁当容器关闭时或者对于非作用域的当其作用域结束时按照顺序执行执行注解的方法如果的方法上使用了注解会调用这个方法这也是推荐的销毁回调方式执行接口的方法如果实现了接口会调用它的方法执行自定义的如果在配置或注解中指定了会调用这个方法扩展点作用时机在容器加载了所有的定义信息但尚未创建任何实例之前能力允许你读取并修改的定义元数据例如你可以动态地修改某个的属性值甚至更改它的作用域通俗理解给你一个机会在蓝图阶段修改设计图纸而不是等房子建好了再去敲墙比如是在中使用占位符的功能的它会扫描接口并将其注册为定义作用时机在实例化和属性填充之后初始化方法的前后能力包含两个方法在初始化之前干预在初始化之后干预的就是通过它实现的在此处返回的代理对象通俗理解在房子建好实例化并装修完填充属性之后在主人入住可用前后给你机会对房子进行精装修或改造如加装监控系统系列接口作用时机在的初始化阶段之前能力让能感知并获取到容器自身的资源如等通俗理解让知道自己身在何处以及叫什么名字和作用时机初始化和销毁阶段的特定回调能力提供和方法用于自定义初始化和销毁逻辑通俗理解的出生仪式和临终遗言的固定写法现在更推荐使用和注解因为无代码侵入事务事务分为声明型事务和编程型事务声明型事务通过注解来声明他的底层是基于实现的容器在启动时会为标记了的创建一个代理对象当外部调用这个代理对象的方法时代理逻辑会先被触发事务开始代理逻辑会负责开启事务例如禁用数据库连接的自动提交执行业务然后代理对象再调用你编写的原始业务方法事务提交回滚如果业务方法正常执行完毕代理逻辑会提交事务如果业务方法抛出运行时异常或代理逻辑会回滚事务优点对业务代码无侵入将事务管理代码与业务逻辑彻底解耦使得代码非常清晰编程型事务在业务代码中通过手动调用或的来精确地控制事务的边界然后调用方法自己进行手动的提交和手动的回滚提供了极高的灵活性可以实现非常精细的事务控制比如在一个方法内实现多次提交或回滚但是高耦合事务的隔离级别跟的事务的隔离级别相同多了一个这是注解的默认值它表示使用数据库本身设置的默认隔离级别一般数据库的事务的隔离级别就是或者但是事务会失效的事务失效的场景如下代理有关的方法不是的原因的代理机制在为类创建代理时只会代理其方法如果你将注解用在或方法上事务不会生效也不会有任何报错一句话总结代理对象无法覆盖非公有方法方法被修饰原因被修饰的方法无法被子类重写的动态代理是通过创建目标类的子类来实现的因此无法代理方法一句话总结方法无法被代理同一个类中的方法调用调用原因这是最常见也最隐蔽的失效场景当你在一个的中调用同一个类中的有注解时这个调用是通过指针直接发生的绕过了代理对象事务增强逻辑是存在于代理对象中的所以事务会失效跟运行时异常有关的异常被捕获了原因声明式事务默认只在遇到或时才会回滚如果你在事务方法内部用捕获了异常并且没有在块中重新抛出那么的事务代理就无法感知到异常的发生从而会正常提交事务一句话总结异常没有传播到代理层代理以为一切正常指定了不回滚的异常类型原因在中指定了某个异常类那么当这个异常发生时事务将不会回滚示例事务有关的数据库引擎不支持事务原因例如的引擎就不支持事务如果表使用了不支持事务的引擎所有事务相关的操作都会被静默忽略一句话总结底层基础不支持上层框架无能为力事务的传播类型设置的不对比如不支持事务事务的传播机制需要描述这是默认的传播特性如果当前存在一个事务那么新方法就加入到这个事务中如果当前没有事务就新建一个事务场景绝大多数情况下的选择支持描述如果当前存在一个事务就加入如果当前没有事务就以非事务的方式执行场景用于那些可有可无的事务方法比如一些只读查询操作强制描述强制要求当前必须存在一个事务如果当前没有事务就会抛出异常它不会自己创建事务场景用于那些必须在事务环境下执行的核心操作起到一种校验作用需要新的描述总是创建一个全新的独立的事务如果当前已经存在一个事务会把当前事务挂起然后执行新事务新事务执行完毕后再恢复被挂起的事务场景希望某些操作的事务结果独立于外部事务不受其影响比如在一个大的下单流程中记录操作日志无论下单成功与否日志都必须成功入库不支持描述以非事务的方式执行如果当前存在一个事务会把当前事务挂起场景用于那些明确不希望在事务中运行的方法从不描述以非事务的方式执行如果当前存在一个事务就会抛出异常场景用于和相对的校验场景嵌套描述如果当前存在一个事务就在这个事务中创建一个嵌套事务保存点嵌套事务独立于外部事务进行提交或回滚如果外部事务回滚嵌套事务也会回滚但嵌套事务的回滚不影响外部事务如果当前没有事务行为等同于注意这是一个部分数据库才支持的特性如需要底层驱动和数据库的支持设计模式作用实现模式的解耦它提供了一套清晰的架构将处理请求的控制器业务逻辑的模型和展示用的视图分离开来极大地提高了代码的可维护性可扩展性和可测试性简化开发它基于构建但极大地简化了底层的等对象的直接操作开发者可以用简单的注解如来处理复杂的请求与生态无缝集成它可以非常方便地使用核心的和功能轻松整合层层以及事务管理等提供强大的功能内置了强大的参数绑定数据校验风格支持拦截器国际化文件上传等一系列开发所需的核心功能核心组件执行过程常用注解那几个参数绑定的那几个深入知识统一异常处理作用通过创建一个带有注解的类可以在其中定义多个方法来集中处理整个应用中由抛出的特定异常这避免了在每个中都写实现了优雅的全局异常处理示例捕获所有并返回一个自定义的错误拦截器作用提供了在请求处理的生命周期中方法执行前后织入自定义逻辑的能力它比更精细因为它能访问到即将执行的信息三大方法在方法执行之前调用可以进行权限验证日志记录等返回则中断后续流程在方法执行之后视图渲染之前调用可以修改中的数据在整个请求处理完成包括视图渲染之后调用主要用于资源清理与的区别是规范的一部分作用范围更广能处理所有请求是的一部分只能处理经过的请求但能获取到的上下文信息数据绑定与类型转换能自动将请求参数都是字符串转换为方法参数所需的类型如这个过程就是数据绑定我们可以通过实现接口并将其注册到中来定义自定义的类型转换逻辑例如将字符串转换为对象跨域请求处理作用简单方便地解决开发中常见的跨域资源共享问题可以直接在类或方法上使用注解来允许来自特定域的跨域请求是啥四大特性自动配置内嵌服务器无需配置常用的本质上是一个依赖描述符它的作用是将实现某一特定功能所需的所有依赖项打包在一起并触发与该功能相关的自动配置启动热部署工作原理当检测到下的文件发生变化时它会触发应用快速重启不是完全重启速度很快它通过维护两个类加载器一个加载不变的第三方库一个加载你自己的代码来实现这一点只重新加载你自己写的代码从而大大加快了速度与普通的区别特性普通内容只包含你项目自己编译的文件和资源文件包含所有内容你的代码资源文件以及项目所需的所有第三方依赖库的包大小非常小非常大因此也叫胖运行方式不能直接运行除非配置了且无外部依赖通常是作为其他项目的库被引用可以通过命令直接运行因为它内置了所有依赖和启动逻辑结构标准结构特殊的结构解压后会看到一个目录里面包含了你的代码和所有依赖的包还有一个目录这是的启动加载器自动装配原理的自动装配核心在于注解而这个注解又是一个组合注解其中最关键的是这个注解是自动配置的开关内部通过注解导入了这个类这个类的核心作用是去加载和筛选需要被激活的自动配置类扫描它会扫描项目中所有包的文件这个文件中定义了所有可能的自动配置类为按需加载会根据条件注解等来判断这些自动配置类是否满足生效条件比如只有在下存在时才会生效注入最终满足条件的自动配置类被加载到容器中它们内部定义的各种如就被创建并注入了注解是框架提供的基础注解它比更强大通常用于批量导入或者导入配置类它有三种主要使用方式而的自动配置正是利用了第三种导入普通的类会将注册为一个导入配置类会加载这个配置类以及它内部定义的所有导入实现类这是最关键的用法会实例化并调用它的方法该方法返回一个字符串数组数组里的每一个类名都会被注册为的自动配置就是通过这种方式动态地可选择地加载了大量的配置类源码分析凡是可以存放数据的具体数据结构实现都可以称之为容器在容器的场景下我们需要一种可以用于存放和名称索引式的数据结构所以选择是最合适不过的是一种基于扰动函数负载因子红黑树转换等技术内容形成的拉链寻址的数据结构它能让数据更加散列的分布在哈希桶以及碰撞时形成的链表和红黑树上它的数据结构会尽可能最大限度的让整个数据读取的复杂度在之间当然在极端情况下也会有链表查找数据较多的情况不过我们经过万数据的扰动函数再寻址验证测试数据会均匀的散列在各个哈希桶索引上所以非常适合用在的容器实现上但是我们实际上应用的是因为他是线程安全的我们的不可能只是单线程进行操作的他是一个弱一致性迭代器避免了并发的修改异常一个简单的容器实现还需的定义注册获取三个基本步骤定义可能这是你在查阅源码时经常看到的一个类例如它会包括等注册这个过程就相当于我们把数据存放到中只不过现在在我们注册阶段里面存储的是获取最后就是获取对象的名字就是容器初始化好以后就可以直接获取了实例化完成之后里面存储的才是实例我们解决循环依赖的三级缓存就是这么设计的是的名字是的实例容器的整个实现内容非常简单也仅仅是包括了一个简单的和用于定义实例化信息现在的实现是以一个存放对象可以继续添加属性比如以及信息代表了对象的工厂可以存放定义到中以及获取是容器的基石它是的一切元数据类名作用域构造函数参数属性等的载体是面向接口编程思想的体现容器操作的是而非直接操作中这个所有加载的都存储于此将的定义信息封装成一个标准化的数据结构使得容器上层逻辑可以统一处理与的来源注解解耦在工厂的实现中包括了的注册这里注册的是的定义信息同时在这个类中还包括了获取的操作然后我们使用的时候是先初始化容器然后通过来创建一个然后去通过去获取我们注册的然后去使用里面封装的方法这个时候才会实例化然后实际我们使用的容器比如说是他是继承了然后实现了里面包括存储的容器存储定义名词的列表一级缓存已经完成初始化的单例二级缓存早期的引用三级缓存单例工厂我们注册的时候并没有实例化直到获取的时候才会实例化这就是懒加载获取的时候先从一级缓存获取缓存没有才创建顶层接口定义了等核心方法扩展接口提供枚举所有的能力体系的终极接口几乎包含了所有功能继承了和其他多个高级接口核心中的核心其方法定义了容器启动的完整流程方法加载的一个链路注解从构造函数出发扫描路径找到符合条件的类检查是否包含等注解路径从的构造函数出发将转为解析并注册设计模式职责分清一个接口只关注一个核心的职责通过组合来实现多种能力这样的话方便我们的后续扩展和维护比如我们的只负责获取只负责单例的管理只负责定义注册模板方法模式所有子类都遵循相同的获取流程子类只需实现特定的抽象方法通用逻辑在父类中实现比如一个抽象的基类定义了获取的标准流程先去看一级缓存中有没有没有的话获取一个然后创建实例化这个然后剩下的方法只是定义完具体的逻辑留给子类实现分层架构每一层都该干属于自己的事情比如接口层定义契约和规范然后抽象类层实现通用的逻辑和模板方法实现类层实现具体的业务逻辑实现然后在我们的项目中比如说实现一个支付的实现的话我们可以先创建一个支付接口定义一个执行方法然后创建一个所有的支付类共同的抽象类实现支付的基本逻辑先检验参数然后执行获取执行结果返回执行结果然后子类具体的去实现这个执行的逻辑比如支付宝的具体的实现逻辑比如说我们在项目中可以根据我们的类型来选择我们要实例化的模式一般就是普通的代理或者是代理可以在属性中里面设定然后我们根据属性的设定来选择我们具体是选择哪一种策略实例化实例化首先通过获取信息这个信息是在定义的时候传递进去的然后看我们获取的信息是不是空的空的就是无构造函数实例化不是空的就是有构造函数实例化这里我们重点关注有构造函数的实例化实例化方式为把入参信息传递给进行实例化比较简单适用于简单的对象实例化先是构建设置目标为父类设置回溯使用就是说明不需要额外的处理可以设置等其他回调来实现功能如果信息为空就默认的创建不为空的话就创建我们指定的构造器的类型支持动态代理适用于需要进行增强的对象运行的时候动态的生成新的文件比如需要事务代理需要缓存代理的特性反射动态代理实现原理原生反射字节码动态生成性能表现反射调用开销较小首次创建开销大后续调用快功能扩展仅支持实例化支持方法拦截增强依赖要求无额外依赖需要和库代理限制无法代理类方法无法代理类方法注入属性填充的时机实在对象创建后立刻进行属性值载体属性集合管理对象依赖标识延迟解析不是直接存储对象而是存储名称递归创建在属性填充时才真正创建依赖的循环依赖预留为后续处理循环依赖留下接口属性填充方法内部使用递归检测到类型调用获取他的依赖的名字使用递归获取被依赖的创建完成后返回用创建好的对象填充当前的属性框架自动处理依赖关系开发者无需关心创建顺序只有真正需要这个的时候才会创建提高了性能然后我们创建后的会被缓存避免重复创建这是缓存的思想处理循环依赖使用三级缓存架构来解决一级缓存完整的二级缓存实例化没有进行属性的填充三级缓存的工厂对象用于解决代理的问题缓存级别存储内容作用时机一级缓存完整的对象存放完全初始化好的创建完成后二级缓存早期对象存放实例化但未填充属性的解决循环依赖时三级缓存用于创建代理对象实例化后立即放入扩展支持一级一级的调用先去找一次缓存没有标记为正在创建然后再找二级缓存允许早期引用没有就从三级缓存中获取还没有的话通过创建然后放入二级缓存从三级缓存中删除实体类方法实例化后立刻放入三级缓存然后进行填充属性然后初始化成功之后放入一级缓存标记为完成流程创建一级缓存为空标记正在创建实例化对象添加到三级缓存开始填充属性触发创建创建一级缓存为空标记正在创建实例化对象添加到三级缓存开始填充属性再次请求循环依赖解析执行三级缓存查找一级缓存二级缓存三级缓存找到返回早期对象放入二级缓存移除三级缓存返回早期对象给属性填充完成初始化完成添加到一级缓存返回给属性填充完成初始化完成添加到一级缓存这就是我们所说的提前暴露的问题管理使用配置文件来管理我们的添加一个资源解释器也就是能读取本地文件和云文件的配置内容里面会包括对象的描述和属性信息在读取配置文件信息后接下来就是对配置文件中的描述信息解析后进行注册操作把对象注册到容器中从配置文件层资源加载层解析注册层容器层资源加载定义接口提供获取流的方法然后策略实现类多种的实现策略资源加载通过读取下的文件信息具体的读取过程主要是打包后的配置文件包内的测试资源下的配置文件类路径资源与文件同目录的配置文件文件系统资源加载通过指定文件路径的方式读取文件信息外部配置文件用户自定义配置绝对路径资源资源加载通过的方式读取云服务的文件我们也可以把配置文件放到或者上使用远程配置中心云端配置文件动态配置从配置中心实时拉取智能资源定位器按照资源加载的不同方式资源加载器可以把这些方式集中到统一的类服务下进行处理外部用户只需要传递资源地址即可使用的顺序是先去从进行获取然后再去获取资源都没有的话采取获取默认的文件系统资源定义读取器通过这个抽象类的具体实现就可以把解析后的文件中的信息注册到容器去了以前我们是通过单元测试使用调用完成的注册现在可以放到中操作了解析处理注册基础自抽象类将文件映射为我们需要的代码然后进行在容器中的注册组件的扩展在实际工作中当我们开发基于的技术组件如中间件等时经常需要修改的信息添加日志打印监控处理数据库路由和数据源切换给服务连接注册中心实现切面功能这些都需要在的生命周期中插入自定义逻辑这就是扩展机制的核心价值定义后置处理器在加载完之后实例化之前可以去修改的属性信息相当于我们去建筑的蓝图用于配置属性修改定义动态调整比如场景动态修改的属性值场景根据环境调整配置场景添加额外的定义实例后置处理器实例化和属性注入后初始化方法调用前执行他有前置和后置的类型我们一般在后置进行增加的更多比如代理增强属性修改依赖检查权限校验和监控应用上下文架构为了避免繁琐的操作他是我们最常用的一个容器简洁的上下文操作接口体系接口层次结构基础工厂可列举的工厂应用上下文接口可配置的应用上下文实现层次结构资源加载能力上下文抽象实现可刷新的上下文配置支持类路径上下文在里面最重要的方法就是方法创建然后加载然后我们去获取执行修改然后注册为后续的处理进行准备然后提前实例化单例的完整的生命周期注册执行修改实例化属性注入增强初始化方法执行代理创建就绪放入容器应用运行容器关闭时执行销毁方法应用场景配置中心集成动态读取远程配置修改属性环境相关配置根据环境调整配置属性占位符解析解析占位符条件化注册根据条件动态注册应用场景实现就是通过此接口创建代理对象中间件集成如的监控和日志自动添加监控日志功能依赖注入增强如注解的实现数据源路由动态数据源切换中哪些功能使用了这些扩展机制的应用属性占位符解析的属性解析类处理的应用注解处理等注解处理代理创建的初始化和销毁完整的生命周期定义注册执行实例化属性注入接口方式初始化执行配置方式初始化就绪状态容器关闭触发接口方式销毁执行配置方式销毁在这个里面和他们也是要配置来进行的所以也要通过加载配置信息到中两个接口方法还是比较常用的在一些需要结合实现的组件中经常会使用这两个方法来做一些参数的初始化和销毁操作比如接口暴漏数据库数据读取配置文件加载等等在方法中主要分为两块来执行实现了接口的操作处理方法另外一个是判断配置信息是否存在执行反射调用这两种方式都可以在对象初始化过程中进行处理加载对象中的初始化操作让使用者可以额外新增加自己想要的动作先执行接口方式再执行配置方式通过反射避免重复执行同名方法方法跟上面的差不多都是先实现接口然后配置信息判断是为了避免二次执行销毁虚拟机关闭钩子首先我们需要在接口中定义注册虚拟机钩子的方法和手动执行关闭的方法在抽象实现类里面进行实现注册关闭构造的时候是初始化方法和构造函数的区别主要的区别在于执行的实际和功能定位构造函数执行的时候依赖注入还没完成无法进行初始化初始化方法执行的时候所有属性已经完成可以使用依赖对象进行初始化比如建立数据库连接池缓存预热注册到注册中心然后构造函数主要用于对象创建基本属性设置初始化方法主要使用依赖就绪后的业务初始化为什么需要销毁方法不能依赖吗只能回收内存不能处理资源的释放比如连接文件流数据库连接等比如线程池定时器还有注册中心中哪些组件使用了初始化销毁机制几乎所有核心组件都有应用比如数据源组件初始化连接池销毁连接池缓存组件初始化缓存预热关闭连接消息队列启动监听消息队列停止监听关闭消息队列如何保证初始化方法的执行顺序使用注解就是一个前置条件确保和先初始化注解配合数字越小约先执行实现接口然后确定高优先级的初始化如何处理初始化方法的异常快速失败关键资源初始化失败时立即抛异常优雅降级非关键失败时使用备用方案延迟重试网络等临时性失败可以重试是提供的一种容器感知机制让能够获取容器中的各种资源和服务它是一个标记接口通过实现不同的子接口可以感知到名称以及其他容器资源继承的接口包括和在具体的接口实现过程中你可以看到一部分在的文件夹下另外是在的中这是因为不同的内容获取需要在不同的包下提供所以在的具体实现中会用到向添加内容的操作最后由创建时处理相应的调用操作接口在中有特别多类似这样的标记接口的设计方式它们的存在就像是一种标签一样可以方便统一摘取出属于此类接口的实现类通常会有一起判断使用标记模式类似于接口用于标识具有某种特性的类判断通过统一识别和处理统一管理将所有感知接口归类到一个体系下四大核心感知接口感知感知感知名称感知调用感知首先在中通过判断调用了三个接口方法这样就能通知到已经实现了此接口的类另外我们还向中添加了此时在这个方法中也会被调用到具体的类实现得到一个属性确保获得感知能力后再进行业务初始化比较特殊他要单独去执行在方法中进行在中不可直接获取需要在容器启动时注册专门的处理器体现了分层架构的设计思想在其他的他们在层实现在层创建将注册到中利用机制在初始化时注入题目接口的作用是什么接口提供了获取容器资源的标准机制容器感知让能够感知到容器的存在资源获取提供获取容器内部资源的标准方式扩展能力为开发中间件和框架提供扩展点解耦设计通过接口回调而非静态方法获取资源比如方法可以获取容器中的其他的发布应用事件可以获取环境配置方法可以动态获取检查是不是存在不同接口的执行顺序是什么如果实现如果实现如果在中如果在中如果在中如果在中自身信息先设置容器环境信息后设置等应用层面信息最后设置等最后是我们的机制与的区别对比维度接口注入对象容器内部资源业务对象执行时机初始化阶段属性注入阶段耦合度与框架耦合相对解耦使用场景框架扩展中间件开发业务依赖注入灵活性可以获取容器的动态能力静态依赖关系的作用域是提供的一种创建复杂对象的工厂接口它允许我们自定义的创建逻辑特别适用于代理对象创建如的代理复杂对象初始化需要多步骤构建的对象第三方框架集成将外部框架的对象纳入管理作用域机制支持多种作用域单例模式默认容器中只有一个实例原型模式每次获取都创建新实例环境中的作用域单例模式和原型模式的区别就在于是否存放到内存中如果是原型模式那么就不会存放到内存中每次获取都重新创建对象这就是我们常说的五大作用域设计获取对象对象类型以及是否是单例对象比如我们的代理创建就是我们自定义的一个使用将接口注册为代理对象启动时会把接口方法解析成存入中运行时由通过反射动态执行还有数据源代理等等作用域就是我们定义在中的一个常量然后我们通过指定字段来定义然后解析回去里获取作用域然后设置的信息和的区别对比维度性质容器的根接口用户可实现的工厂接口作用管理的生命周期创建复杂的对象使用者框架内部使用开发者实现和使用获取方式通过通过获取其产品如何获取本身而不是它创建的对象使用的前缀符表示我们需要的是然后内部处理去掉前缀获取本身正常获取创建的对象在什么场景下使用代理对象的创建复杂对象初始化第三方框架集成比如中设置的运行的参数和序列化方式的生命周期是怎样的有双重生命周期一个是他本身的生命周期一个是他产品对象的生命周期事件机制在复杂的业务系统中直接调用会导致紧耦合问题用户注册直接调用发送邮件赠送积分风控检查等服务订单支付直接调用库存扣减物流发货积分计算等服务文章发布直接调用消息推送索引更新缓存刷新等服务这种方式会导致代码耦合度高核心业务逻辑与辅助功能混杂扩展性差新增功能需要修改核心代码维护困难一个环节出错影响整个流程性能问题同步执行所有操作响应慢我们可以通过观察者模式进行解耦用户注册成功发布多个监听器异步处理发送欢迎邮件赠送新人礼包风控分析数据统计定义出事件类事件监听事件发布事件广播器我们事件类是构建一个基本的抽象类然后其他的具体事件继承这个抽象类事件广播器定义了添加监听和删除监听的方法和添加广播的方法最终推送时间消息也会经过这个接口方法来处理谁该接收事件那我们怎么处理事件广播的并发处理呢监听器隔离一个监听器异常不影响其他监听器异步执行可配置同步或异步处理顺序控制支持监听器执行顺序然后我们怎么去确定某个事件如何被监听器处理我们使用泛型参数匹配来实现我们先去获取监听的然后如果存在代理的话我们处理代理中可能被代理需要获取真实类型就是他的父类然后获取泛型接口提取泛型参数获取事件的类型然后判断事件是否匹配就是判断和是不是子类和父类的关系事件发布器初始化事件发布者主要用于实例化一个这是一个事件广播器注册事件监听器通过方法获取到所有从中加载到的事件配置对象发布容器刷新完成事件发布了第一个服务器启动完成后的事件这个事件通过发布出去其实也就是调用了方法问题事件执行的流程事件定义继承创建事件类监听器注册实现并注册到容器事件发布通过发布事件广播接收事件监听器匹配根据泛型参数匹配感兴趣的监听器事件处理调用匹配监听器的方法如何保证处理的事务一致性使用事件同步机制事务提交后执行事务监听器发送邮件通知等然后事务回滚的时候发送清理操作通过的状态来确定然后失败之后通过补偿机制动态代理动态代理是我们的的主要就是解耦他将跟核心业务没关系的业务比如权限日志等业务的抽离出来一般都是以注释的形式然后方法只执行业务核心方法动态代理分为动态代理和动态代理动态代理基于接口代理实现了接口的类在运行时动态生成代理类的字节码速度较快不需要生成新的字节码实现了获取代理方式获取当前线程的类加载器然后通知通知添加目标接口然后执行实现然后使用方法执行代理检查方法是不是匹配切点表达式匹配成功后执行方法拦截器拦截然后换取我们自己实现的如果不匹配的话我们就执行原来的方法动态是基于继承目标类生成子类代理使用了使用字节码技术除了都可以代理速度较慢需要生成字节码但是性能较好方法是通过设置我们的需要代理的类然后设置接口设置回调处理器',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2025-09-07 19:03:13',
  postMainColor: '',
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#18171d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#f7f9fe')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(e => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 7.2.0"><link rel="alternate" href="/rss2.xml" title="mengnankkのblog" type="application/rss+xml">
</head><body data-type="anzhiyu"><div id="web_bg"></div><div id="an_music_bg"></div><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><img class="loading-img nolazyload" alt="加载头像" src="https://skymirror-1322372781.cos.ap-beijing.myqcloud.com/202407230955363.jpg"/><div class="loading-image-dot"></div></div></div><script>const preloader = {
  endLoading: () => {
    document.getElementById('loading-box').classList.add("loaded");
  },
  initLoading: () => {
    document.getElementById('loading-box').classList.remove("loaded")
  }
}
window.addEventListener('load',()=> { preloader.endLoading() })
setTimeout(function(){preloader.endLoading();},10000)

if (true) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.10/progress_bar/progress_bar.css"/><script async="async" src="https://cdn.cbd.int/pace-js@1.2.4/pace.min.js" data-pace-options="{ &quot;restartOnRequestAfter&quot;:false,&quot;eventLag&quot;:false}"></script><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><div id="nav-group"><span id="blog_name"><div class="back-home-button"><i class="anzhiyufont anzhiyu-icon-grip-vertical"></i><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" href="https://blog.tokenlen.top/" title="博客"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="博客"/><span class="back-menu-item-text">博客</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="http://img.mengnankk.top:9001/" title="图床"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="图床"/><span class="back-menu-item-text">图床</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">项目</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="http://img.mengnankk.top:9001/" title="mengnankk图床"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/08/13/64d8c2653332e.ico" alt="mengnankk图床"/><span class="back-menu-item-text">mengnankk图床</span></a></div></div></div></div><a id="site-name" href="/" accesskey="h"><div class="title">mengnankkのblog</div><i class="anzhiyufont anzhiyu-icon-house-chimney"></i></a><div id="he-plugin-simple"></div><script>var WIDGET = {
  "CONFIG": {
    "modules": "0124",
    "background": "2",
    "tmpColor": "FFFFFF",
    "tmpSize": "16",
    "cityColor": "FFFFFF",
    "citySize": "16",
    "aqiColor": "E8D87B",
    "aqiSize": "16",
    "weatherIconSize": "24",
    "alertIconSize": "18",
    "padding": "10px 10px 10px 10px",
    "shadow": "0",
    "language": "auto",
    "borderRadius": "20",
    "fixed": "true",
    "vertical": "top",
    "horizontal": "left",
    "left": "20",
    "top": "7.1",
    "key": "df245676fb434a0691ead1c63341cd94"
  }
}
</script><link rel="stylesheet" href="https://widget.qweather.net/simple/static/css/he-simple.css?v=1.4.0"/><script src="https://widget.qweather.net/simple/static/js/he-simple.js?v=1.4.0"></script></span><div class="mask-name-container"><div id="name-container"><a id="page-name" href="javascript:anzhiyu.scrollToDest(0, 500)">PAGE_NAME</a></div></div><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size: 0.9em;"></i><span> 隧道</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 生活</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/album/"><i class="anzhiyufont anzhiyu-icon-images faa-tada" style="font-size: 0.9em;"></i><span> 相册集</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/essay/"><i class="anzhiyufont anzhiyu-icon-lightbulb faa-tada" style="font-size: 0.9em;"></i><span> 闲言碎语</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/music/"><i class="anzhiyufont anzhiyu-icon-music faa-tada" style="font-size: 0.9em;"></i><span> 音乐馆</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 我的</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><i class="anzhiyufont anzhiyu-icon-link faa-tada" style="font-size: 0.9em;"></i><span> 友人帐</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size: 0.9em;"></i><span> 关于本人</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/Message/"><i class="anzhiyufont anzhiyu-icon-envelope faa-tada" style="font-size: 0.9em;"></i><span> 留言</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 其他</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" target="_blank" rel="noopener" href="https://home.tokenlen.top/"><i class="anzhiyufont anzhiyu-icon-envelope faa-tada" style="font-size: 0.9em;"></i><span> home</span></a></li><li><a class="site-page child faa-parent animated-hover" target="_blank" rel="noopener" href="https://status.mengnankk.asia/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 站点检测</span></a></li><li><a class="site-page child faa-parent animated-hover" target="_blank" rel="noopener" href="https://home.tokenlen.top/"><i class="anzhiyufont anzhiyu-icon-lightbulb faa-tada" style="font-size: 0.9em;"></i><span> 心里话</span></a></li></ul></div></div></div><div id="nav-right"><div class="nav-button only-home" id="travellings_button" title="随机前往一个开往项目网站"><a class="site-page" onclick="anzhiyu.totraveling()" title="随机前往一个开往项目网站" href="javascript:void(0);" rel="external nofollow" data-pjax-state="external"><i class="anzhiyufont anzhiyu-icon-train"></i></a></div><div class="nav-button" id="randomPost_button"><a class="site-page" onclick="toRandomPost()" title="随机前往一个文章" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-dice"></i></a></div><div class="nav-button" id="search-button"><a class="site-page social-icon search" href="javascript:void(0);" title="搜索🔍" accesskey="s"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span> 搜索</span></a></div><input id="center-console" type="checkbox"/><label class="widget" for="center-console" title="中控台" onclick="anzhiyu.switchConsole();"><i class="left"></i><i class="widget center"></i><i class="widget right"></i></label><div id="console"><div class="console-card-group-reward"><ul class="reward-all console-card"><li class="reward-item"><a href="https://imgbed.mengnankk.asia/202407021650088.jpg" target="_blank"><img class="post-qr-code-img" alt="微信" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imgbed.mengnankk.asia/202407021650088.jpg"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png" target="_blank"><img class="post-qr-code-img" alt="支付宝" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div><div class="console-card-group"><div class="console-card-group-left"><div class="console-card" id="card-newest-comments"><div class="card-content"><div class="author-content-item-tips">互动</div><span class="author-content-item-title"> 最新评论</span></div><div class="aside-list"><span>正在加载中...</span></div></div></div><div class="console-card-group-right"><div class="console-card tags"><div class="card-content"><div class="author-content-item-tips">兴趣点</div><span class="author-content-item-title">寻找你感兴趣的领域</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/BF/" style="font-size: 1.05rem;">BF<sup>1</sup></a><a href="/tags/BigData/" style="font-size: 1.05rem;">BigData<sup>1</sup></a><a href="/tags/C/" style="font-size: 1.05rem;">C<sup>4</sup></a><a href="/tags/CE/" style="font-size: 1.05rem;">CE<sup>1</sup></a><a href="/tags/CSRF/" style="font-size: 1.05rem;">CSRF<sup>1</sup></a><a href="/tags/English/" style="font-size: 1.05rem;">English<sup>9</sup></a><a href="/tags/FI/" style="font-size: 1.05rem;">FI<sup>1</sup></a><a href="/tags/Go/" style="font-size: 1.05rem;">Go<sup>1</sup></a><a href="/tags/Hadoop/" style="font-size: 1.05rem;">Hadoop<sup>1</sup></a><a href="/tags/Linux/" style="font-size: 1.05rem;">Linux<sup>12</sup></a><a href="/tags/XSS/" style="font-size: 1.05rem;">XSS<sup>1</sup></a><a href="/tags/css/" style="font-size: 1.05rem;">css<sup>2</sup></a><a href="/tags/football/" style="font-size: 1.05rem;">football<sup>1</sup></a><a href="/tags/html/" style="font-size: 1.05rem;">html<sup>1</sup></a><a href="/tags/java/" style="font-size: 1.05rem;">java<sup>61</sup></a><a href="/tags/juc/" style="font-size: 1.05rem;">juc<sup>2</sup></a><a href="/tags/jvm/" style="font-size: 1.05rem;">jvm<sup>2</sup></a><a href="/tags/leetcode/" style="font-size: 1.05rem;">leetcode<sup>10</sup></a><a href="/tags/markdown/" style="font-size: 1.05rem;">markdown<sup>1</sup></a><a href="/tags/mysql/" style="font-size: 1.05rem;">mysql<sup>17</sup></a><a href="/tags/net/" style="font-size: 1.05rem;">net<sup>7</sup></a><a href="/tags/paper/" style="font-size: 1.05rem;">paper<sup>1</sup></a><a href="/tags/php/" style="font-size: 1.05rem;">php<sup>5</sup></a><a href="/tags/pip/" style="font-size: 1.05rem;">pip<sup>1</sup></a><a href="/tags/python/" style="font-size: 1.05rem;">python<sup>3</sup></a><a href="/tags/redis/" style="font-size: 1.05rem;">redis<sup>4</sup></a><a href="/tags/shell/" style="font-size: 1.05rem;">shell<sup>4</sup></a><a href="/tags/spring/" style="font-size: 1.05rem;">spring<sup>4</sup></a><a href="/tags/spring-boot/" style="font-size: 1.05rem;">spring boot<sup>14</sup></a><a href="/tags/sql/" style="font-size: 1.05rem;">sql<sup>5</sup></a><a href="/tags/web/" style="font-size: 1.05rem;">web<sup>3</sup></a><a href="/tags/%E5%8E%8B%E6%B5%8B/" style="font-size: 1.05rem;">压测<sup>1</sup></a><a href="/tags/%E6%95%B0%E5%AD%97%E9%80%BB%E8%BE%91/" style="font-size: 1.05rem;">数字逻辑<sup>1</sup></a><a href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93%E5%8E%9F%E7%90%86/" style="font-size: 1.05rem;">数据库原理<sup>3</sup></a><a href="/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" style="font-size: 1.05rem;">数据结构<sup>20</sup></a><a href="/tags/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/" style="font-size: 1.05rem;">正则表达式<sup>2</sup></a><a href="/tags/%E6%AF%9B%E9%80%89/" style="font-size: 1.05rem;">毛选<sup>1</sup></a><a href="/tags/%E6%B1%87%E7%BC%96%E8%AF%AD%E8%A8%80/" style="font-size: 1.05rem;">汇编语言<sup>1</sup></a><a href="/tags/%E7%AE%97%E6%B3%95/" style="font-size: 1.05rem;">算法<sup>9</sup></a><a href="/tags/%E9%9D%A2%E8%AF%95/" style="font-size: 1.05rem;">面试<sup>46</sup></a></div></div><hr/></div></div><div class="console-card history"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-box-archiv"></i><span>文章</span></div><div class="card-archives"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-archive"></i><span>归档</span><a class="card-more-btn" href="/archives/" title="查看更多">
    <i class="anzhiyufont anzhiyu-icon-angle-right"></i></a></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/10/"><span class="card-archive-list-date">十月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">1</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/09/"><span class="card-archive-list-date">九月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">25</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/08/"><span class="card-archive-list-date">八月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">9</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/07/"><span class="card-archive-list-date">七月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">15</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/06/"><span class="card-archive-list-date">六月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">16</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/05/"><span class="card-archive-list-date">五月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">22</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/04/"><span class="card-archive-list-date">四月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">7</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/03/"><span class="card-archive-list-date">三月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">5</span><span>篇</span></div></a></li></ul></div><hr/></div></div></div><div class="button-group"><div class="console-btn-item"><a class="darkmode_switchbutton" title="显示模式切换" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-moon"></i></a></div><div class="console-btn-item" id="consoleHideAside" onclick="anzhiyu.hideAsideBtn()" title="边栏显示控制"><a class="asideSwitch"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></a></div><div class="console-btn-item on" id="consoleCommentBarrage" onclick="anzhiyu.switchCommentBarrage()" title="热评开关"><a class="commentBarrage"><i class="anzhiyufont anzhiyu-icon-message"></i></a></div><div class="console-btn-item" id="consoleMusic" onclick="anzhiyu.musicToggle()" title="音乐开关"><a class="music-switch"><i class="anzhiyufont anzhiyu-icon-music"></i></a></div></div><div class="console-mask" onclick="anzhiyu.hideConsole()" href="javascript:void(0);"></div></div><div class="nav-button" id="nav-totop"><a class="totopbtn" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i><span id="percent" onclick="anzhiyu.scrollToDest(0,500)">0</span></a></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" title="切换"><i class="anzhiyufont anzhiyu-icon-bars"></i></a></div></div></div></nav><div id="post-info"><div id="post-firstinfo"><div class="meta-firstline"><a class="post-meta-original">原创</a><span class="post-meta-categories"><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-inbox post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E6%8A%80%E6%9C%AF%E6%A0%88/" itemprop="url">技术栈</a></span><span class="article-meta tags"><a class="article-meta__tags" href="/tags/java/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>java</span></a><a class="article-meta__tags" href="/tags/%E9%9D%A2%E8%AF%95/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>面试</span></a><a class="article-meta__tags" href="/tags/spring/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>spring</span></a></span></div></div><h1 class="post-title" itemprop="name headline">Spring面试题hot2-源码分析</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="anzhiyufont anzhiyu-icon-calendar-days post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" itemprop="dateCreated datePublished" datetime="2025-07-18T16:00:00.000Z" title="发表于 2025-07-19 00:00:00">2025-07-19</time><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-history post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" itemprop="dateCreated datePublished" datetime="2025-09-07T11:03:13.134Z" title="更新于 2025-09-07 19:03:13">2025-09-07</time></span></div><div class="meta-secondline"><span class="post-meta-separator"></span><span class="post-meta-wordcount"><i class="anzhiyufont anzhiyu-icon-file-word post-meta-icon" title="文章字数"></i><span class="post-meta-label" title="文章字数">字数总计:</span><span class="word-count" title="文章字数">13k</span><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-clock post-meta-icon" title="阅读时长"></i><span class="post-meta-label" title="阅读时长">阅读时长:</span><span>41分钟</span></span><span class="post-meta-separator"></span><span id="" data-flag-title="Spring面试题hot2-源码分析"><i class="anzhiyufont anzhiyu-icon-fw-eye post-meta-icon"></i><span class="post-meta-label" title="阅读量">阅读量:</span><span id="twikoo_visitors" title="访问量"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-spin"></i></span></span><span class="post-meta-separator">       </span><span class="post-meta-position" title="作者IP属地为济南"><i class="anzhiyufont anzhiyu-icon-location-dot"></i>济南</span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section><div id="post-top-cover"><img class="nolazyload" id="post-top-bg" src="https://skymirror-1322372781.cos.ap-beijing.myqcloud.com/202408081510494.jpg?_r_=57d05052-4f6f-e7fd-6fa7-231c0276d639"></div></header><main id="blog-container"><div class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container" itemscope itemtype="https://blog.tokenlen.top/2025/07/19/%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/java-stack/spring3/"><header><a class="post-meta-categories" href="/categories/%E6%8A%80%E6%9C%AF%E6%A0%88/" itemprop="url">技术栈</a><a href="/tags/java/" tabindex="-1" itemprop="url">java</a><a href="/tags/%E9%9D%A2%E8%AF%95/" tabindex="-1" itemprop="url">面试</a><a href="/tags/spring/" tabindex="-1" itemprop="url">spring</a><h1 id="CrawlerTitle" itemprop="name headline">Spring面试题hot2-源码分析</h1><span itemprop="author" itemscope itemtype="http://schema.org/Person">mengnankkzhou</span><time itemprop="dateCreated datePublished" datetime="2025-07-18T16:00:00.000Z" title="发表于 2025-07-19 00:00:00">2025-07-19</time><time itemprop="dateCreated datePublished" datetime="2025-09-07T11:03:13.134Z" title="更新于 2025-09-07 19:03:13">2025-09-07</time></header><h1>基础</h1>
<h2 id="1-什么是-IOC？">1.什么是 IOC？</h2>
<p>IOC就是控制反转，反转之前是啥，，，反转之后是啥。。。。实现核心就是反射，设计模式是工厂模式</p>
<p>然后IOC和核心就是DI，几种实现方式，循环依赖的解决方式。</p>
<p>@bean的生命周期，@PostConstruct @PreDestroy，bean的作用域，单例，原型，websocket,session,request,application</p>
<p>bean的单例不一定是线程安全的，这个跟我们的业务逻辑有关，如果bean没有一个可变的成员变量，那么他就是无状态的，也就是线程安全的</p>
<p>我们为了保证线程安全可以改变作作用域为prototype，或者使用ThreadLocal，或者是用锁</p>
<p>IOC容器：</p>
<p><code>BeanFactory</code> 和 <code>ApplicationContext</code> 都是Spring的IoC容器，但后者是前者的超集，提供了更强大的功能。</p>
<p><code>ApplicationContext</code>继承了<code>BeanFactory</code>，所以它具备<code>BeanFactory</code>的所有能力，同时还提供了更多面向企业应用的功能。它的预加载机制能帮助你在应用启动时就发现配置错误，而不是等到运行时才报错。</p>
<table>
<thead>
<tr>
<th style="text-align:left">特性</th>
<th style="text-align:left"><strong>BeanFactory</strong></th>
<th style="text-align:left"><strong>ApplicationContext (推荐使用)</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><strong>核心定位</strong></td>
<td style="text-align:left">Spring IoC容器的<strong>基础接口</strong>，是“底层基础设施”。</td>
<td style="text-align:left">IoC容器的<strong>高级接口</strong>，是<code>BeanFactory</code>的子接口。</td>
</tr>
<tr>
<td style="text-align:left"><strong>Bean加载</strong></td>
<td style="text-align:left"><strong>懒加载 (Lazy-loading)</strong>：只有当<code>getBean()</code>被调用时，才会去实例化Bean。</td>
<td style="text-align:left"><strong>预加载 (Eager-loading)</strong>：容器启动时，会一次性实例化所有<code>singleton</code>作用域的Bean。</td>
</tr>
<tr>
<td style="text-align:left"><strong>功能丰富度</strong></td>
<td style="text-align:left">功能较少，主要提供Bean的注册和获取。</td>
<td style="text-align:left"><strong>功能非常丰富</strong>，除了<code>BeanFactory</code>的所有功能外，还提供了：</td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
<td style="text-align:left">- <strong>国际化支持 (i18n)</strong></td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
<td style="text-align:left">- <strong>事件发布与传播机制 (ApplicationEvent)</strong></td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
<td style="text-align:left">- <strong>AOP集成</strong>（自动识别并配置<code>BeanPostProcessor</code>等）</td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
<td style="text-align:left">- <strong>Web环境支持</strong>（如<code>WebApplicationContext</code>）</td>
</tr>
<tr>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
<td style="text-align:left">- <strong>资源访问</strong>（如<code>classpath:</code>、<code>file:</code>前缀的资源加载）</td>
</tr>
<tr>
<td style="text-align:left"><strong>使用场景</strong></td>
<td style="text-align:left">对内存消耗要求极高的场景（如移动设备）。在现代企业应用开发中<strong>几乎不直接使用</strong>。</td>
<td style="text-align:left"><strong>绝大多数Spring应用和所有Spring Boot应用</strong>的默认选择。</td>
</tr>
</tbody>
</table>
<h2 id="2-什么是spring-Aop">2.什么是spring Aop</h2>
<p>AOP是啥，作用</p>
<p>实现的原理，动态代理，jdk,cgilb</p>
<p>几个概念，切面，连接点，通知，切点，织入</p>
<p>AOP通过<strong>织入(Weaving)</strong>，将<strong>切面(Aspect)<strong>中的</strong>通知(Advice)</strong>，应用到由**切点(Pointcut)<strong>匹配到的</strong>连接点(Join Point)<strong>所对应的</strong>目标对象(Target)**上。</p>
<p>通知类型，用了代理这个设计模式</p>
<p>代理对象（Proxy）接管了对目标对象（Target）的访问。所有外部调用都必须先经过代理对象。</p>
<p>代理对象在将调用请求转发给真正的目标对象<strong>之前</strong>或<strong>之后</strong>，有机会执行额外的操作。这些额外的操作，就是我们之前说的<strong>通知（Advice）</strong>，也就是切面逻辑。</p>
<p><strong>pring AOP的核心是基于动态代理实现的。它利用代理模式，在运行时为我们的目标Bean动态地创建一个代理对象。这个代理对象拦截了对原始Bean方法的所有调用，并在调用前后织入了我们定义的切面逻辑（比如日志、事务等），从而在不修改源代码的情况下，实现了功能的增强。</strong></p>
<p>这个只能作用在public方法上，所以非public的方法会失效</p>
<p>通知注解，@Around<strong>包裹</strong>在目标方法的整个执行过程周围。它是功能最强大、最灵活的通知。</p>
<p>环绕通知的第一个参数必须是<code>ProceedingJoinPoint</code>，它有一个<code>proceed()</code>方法。</p>
<ul>
<li>你可以在<strong>调用<code>proceed()</code>方法之前</strong>执行逻辑（等同于<code>@Before</code>）。</li>
<li>你可以<strong>决定是否调用<code>proceed()</code>方法</strong>，从而决定是否执行目标方法。</li>
<li>你可以在<strong>调用<code>proceed()</code>方法之后</strong>执行逻辑（等同于<code>@AfterReturning</code>）。</li>
<li>你可以<strong>修改目标方法的参数或返回值</strong>。</li>
<li>你可以<strong>捕获并处理目标方法抛出的异常</strong>（等同于<code>@AfterThrowing</code>）。</li>
</ul>
<h2 id="3-spring的常用注解">3.spring的常用注解</h2>
<p>组件：</p>
<p><strong><code>@Component</code></strong>，标记为一个组件，生成一个bean</p>
<p><strong><code>@Service</code></strong>，业务层的组件注解</p>
<p><strong><code>@Repository</code></strong>，DTO层的组件注解，但是能让Spring<strong>自动转换特定于平台的数据库异常</strong>为统一的<code>DataAccessException</code>。</p>
<p><strong><code>@Controller</code></strong>，controller层的组件注解</p>
<p><strong><code>@Scope</code></strong>，定义Bean的作用域。最常用的两个是：</p>
<ul>
<li><code>singleton</code>：（默认值）在整个应用中只有一个实例。</li>
<li><code>prototype</code>：每次请求（获取）时都会创建一个新的实例。request，websocket,context,session</li>
</ul>
<p><strong><code>@PostConstruct</code></strong> 和 <strong><code>@PreDestroy</code></strong>,初始化合销毁</p>
<p>DI</p>
<p><strong><code>@Autowired</code></strong>，按**类型（byType）<strong>自动注入依赖。如果找到多个相同类型的Bean，会尝试按</strong>名称（byName）**匹配。如果还找不到就会报错。</p>
<p><strong><code>@Qualifier(&quot;beanName&quot;)</code></strong>，指定bean的名称注入，多个bean相同的</p>
<p><strong><code>@Resource(name = &quot;beanName&quot;)</code></strong>，默认按名称注入，找不到就按类型注入</p>
<p>web</p>
<p><strong><code>@RestController</code></strong>，专门写API的</p>
<p><strong><code>@RequestMapping(&quot;/path&quot;)</code></strong>，指定URL</p>
<p><strong><code>@RequestParam</code></strong>，从请求的URL的？中获取参数</p>
<p><strong><code>@PathVariable</code></strong>，从URL路径里面获取参数</p>
<p><strong><code>@RequestBody</code></strong>，把发过来的JSON请求体变成一个Java对象</p>
<p>配置</p>
<p><strong><code>@SpringBootApplication</code></strong>=</p>
<ul>
<li><code>@SpringBootConfiguration</code>: (就是<code>@Configuration</code>)</li>
<li><code>@EnableAutoConfiguration</code>: 启用Spring Boot的自动配置机制。内部使用@Import注解是自动装配的核心，每发现一个自动配置类，就Selector使用条件判断来确实是不是满足导入条件，自动创建所选bean</li>
<li>@AutoConfigurationPackage，将项目src中main包下的所有组件注册到容器中</li>
<li><code>@ComponentScan</code>: 自动扫描启动类所在包及其子包下的所有组件。</li>
</ul>
<p><strong><code>@Value</code></strong>，配置文件读取值</p>
<p><strong><code>@Bean</code></strong>，作用方法上</p>
<p><strong><code>@Configuration</code></strong>，表明配置类</p>
<h2 id="4-Bean">4.@Bean</h2>
<p>创建-&gt;实例化-&gt;填充属性-&gt;初始化-&gt;可用和销毁</p>
<p>实例化：当客户端请求一个Bean，或者在容器启动时，Spring容器会查找Bean的定义。利用java的反射机制或者工厂方法创建一个原始的bean</p>
<p>填充属性，IOC容器识别bean的依赖关系，比如@Autowired@Resource。从容器中查找对应的bean，通过反射将依赖注入到bean的属性中</p>
<p>初始化，最重要的点，扩展点最多的。</p>
<p><strong>执行Aware接口的方法</strong>，实现了特定的<code>Aware</code>接口，比如BeanNameAware<code>, </code>BeanFactoryAware<code>, </code>ApplicationContextAware</p>
<p><strong>执行<code>BeanPostProcessor</code>的前置处理</strong>，调用所有<code>BeanPostProcessor</code>的<code>postProcessBeforeInitialization</code>方法。</p>
<p><strong>执行<code>@PostConstruct</code>注解的方法</strong>，调用使用了@postConstruct的方法</p>
<p><strong>执行<code>InitializingBean</code>接口的方法</strong>，实现了<code>InitializingBean</code>接口，Spring会调用它的<code>afterPropertiesSet()</code>方法。</p>
<p><strong>执行自定义的<code>init-method</code></strong>，如果在XML配置或<code>@Bean</code>注解中指定了<code>init-method</code>，Spring会调用这个自定义的初始化方法。</p>
<p><strong>执行<code>BeanPostProcessor</code>的后置处理</strong>，调用所有<code>BeanPostProcessor</code>的<code>postProcessAfterInitialization</code>方法。</p>
<p>Spring的**AOP（动态代理）**就是在这个阶段通过包装原始Bean实例，并返回一个代理对象来实现的。我们平时拿到的Bean，很多时候其实是这一步处理后的代理对象。</p>
<p>可用和销毁，当Spring容器关闭时（或者对于非<code>singleton</code>作用域的Bean，当其作用域结束时）。按照顺序执行</p>
<ul>
<li><strong>执行<code>@PreDestroy</code>注解的方法</strong>：如果Bean的方法上使用了<code>@PreDestroy</code>注解，Spring会调用这个方法。这也是<strong>推荐</strong>的销毁回调方式。</li>
<li><strong>执行<code>DisposableBean</code>接口的方法</strong>：如果Bean实现了<code>DisposableBean</code>接口，Spring会调用它的<code>destroy()</code>方法。</li>
<li><strong>执行自定义的<code>destroy-method</code></strong>：如果在XML配置或<code>@Bean</code>注解中指定了<code>destroy-method</code>，Spring会调用这个方法。</li>
</ul>
<p>扩展点</p>
<p><strong><code>BeanFactoryPostProcessor</code></strong></p>
<ul>
<li><strong>作用时机</strong>：在Spring容器<strong>加载了所有Bean的定义信息（BeanDefinition），但尚未创建任何Bean实例之前</strong>。</li>
<li><strong>能力</strong>：允许你<strong>读取并修改Bean的定义元数据</strong>。例如，你可以动态地修改某个Bean的属性值，甚至更改它的作用域。</li>
<li><strong>通俗理解</strong>：给你一个机会在“蓝图”阶段修改设计图纸，而不是等房子建好了再去敲墙。</li>
</ul>
<p>比如是在<code>application.properties</code>中使用占位符 <code>$&#123;...&#125;</code> 的功能(<code>PropertySourcesPlaceholderConfigurer</code>)。MyBatis的<code>MapperScannerConfigurer</code>，它会扫描接口并将其注册为Bean定义。</p>
<p><strong><code>BeanPostProcessor</code></strong></p>
<ul>
<li>
<p><strong>作用时机</strong>：在Bean<strong>实例化和属性填充之后，初始化方法（<code>init-method</code>, <code>@PostConstruct</code>）的前后</strong>。</p>
</li>
<li>
<p>能力</p>
<p>：包含两个方法：</p>
<ul>
<li><code>postProcessBeforeInitialization</code>: 在初始化之前干预。</li>
<li><code>postProcessAfterInitialization</code>: 在初始化之后干预。<strong>Spring的AOP就是通过它实现的</strong>，在此处返回Bean的代理对象。</li>
</ul>
</li>
<li>
<p><strong>通俗理解</strong>：在房子建好（实例化）并装修完（填充属性）之后，在主人入住（可用）前后，给你机会对房子进行“精装修”或“改造”（如加装监控系统-AOP）。</p>
</li>
</ul>
<p><strong><code>Aware</code>系列接口</strong>:</p>
<ul>
<li><strong>作用时机</strong>：在Bean的初始化阶段，<code>BeanPostProcessor</code>之前。</li>
<li><strong>能力</strong>：让Bean能“感知”并获取到Spring容器自身的资源，如<code>ApplicationContext</code>、<code>BeanFactory</code>、<code>BeanName</code>等。</li>
<li><strong>通俗理解</strong>：让Bean知道自己“身在何处”以及“叫什么名字”。</li>
</ul>
<p><strong><code>InitializingBean</code>和<code>DisposableBean</code></strong>:</p>
<ul>
<li><strong>作用时机</strong>：初始化和销毁阶段的特定回调。</li>
<li><strong>能力</strong>：提供<code>afterPropertiesSet()</code>和<code>destroy()</code>方法，用于自定义初始化和销毁逻辑。</li>
<li><strong>通俗理解</strong>：Bean的“出生仪式”和“临终遗言”的固定写法。（现在更推荐使用<code>@PostConstruct</code>和<code>@PreDestroy</code>注解，因为无代码侵入）</li>
</ul>
<h2 id="5-spring事务">5.spring事务</h2>
<p>事务分为声明型事务和编程型事务</p>
<p>声明型事务，通过注解**<code>@Transactional</code>**来声明，他的底层是基于AOP实现的</p>
<ul>
<li>
<ol>
<li>Spring容器在启动时，会为标记了<code>@Transactional</code>的Bean创建一个<strong>代理对象 (Proxy)</strong>。</li>
<li>当外部调用这个代理对象的方法时，代理逻辑会先被触发。</li>
<li><strong>事务开始</strong>：代理逻辑会负责开启事务（例如，禁用数据库连接的自动提交 <code>connection.setAutoCommit(false)</code>）。</li>
<li><strong>执行业务</strong>：然后，代理对象再调用你编写的原始业务方法。</li>
<li>事务提交/回滚：
<ul>
<li>如果业务方法正常执行完毕，代理逻辑会<strong>提交</strong>事务。</li>
<li>如果业务方法抛出<strong>运行时异常 (RuntimeException)</strong> 或 <strong>Error</strong>，代理逻辑会<strong>回滚</strong>事务。</li>
</ul>
</li>
</ol>
</li>
<li><strong>优点</strong>：对业务代码<strong>无侵入</strong>，将事务管理代码与业务逻辑彻底解耦，使得代码非常清晰。</li>
</ul>
<p>编程型事务，在业务代码中，通过手动调用<code>TransactionTemplate</code>或<code>PlatformTransactionManager</code>的API来精确地控制事务的边界。</p>
<p>然后调用方法，自己进行手动的提交和手动的回滚</p>
<p>提供了极高的灵活性，可以实现非常精细的事务控制，比如在一个方法内实现多次提交或回滚。但是高耦合</p>
<p>事务的隔离级别跟mysql的事务的隔离级别相同。多了一个**<code>DEFAULT</code><strong>：这是<code>@Transactional</code>注解的</strong>默认值**。它表示使用数据库本身设置的默认隔离级别。一般数据库的事务的隔离级别就是rr</p>
<p>或者rc?</p>
<p>但是事务会失效的，事务失效的场景如下：</p>
<p>AOP代理有关的</p>
<ol>
<li><strong>方法不是<code>public</code>的</strong>
<ul>
<li><strong>原因</strong>：Spring AOP的代理机制在为类创建代理时，只会代理其<code>public</code>方法。如果你将<code>@Transactional</code>注解用在<code>protected</code>、<code>private</code>或<code>package-private</code>方法上，事务不会生效，也不会有任何报错。</li>
<li><strong>一句话总结</strong>：<strong>代理对象无法覆盖非公有方法</strong>。</li>
</ul>
</li>
<li><strong>方法被<code>final</code>修饰</strong>
<ul>
<li><strong>原因</strong>：被<code>final</code>修饰的方法无法被子类重写（Override）。Spring的CGLIB动态代理是通过创建目标类的子类来实现的，因此无法代理<code>final</code>方法。</li>
<li><strong>一句话总结</strong>：<strong>final方法无法被代理</strong>。</li>
</ul>
</li>
<li><strong>同一个类中的方法调用（<code>this</code>调用）</strong>
<ul>
<li><strong>原因</strong>：这是最常见也最隐蔽的失效场景。当你在一个Bean的<code>methodA</code>中调用同一个类中的<code>methodB</code>（<code>methodB</code>有<code>@Transactional</code>注解）时，这个调用是通过<code>this</code>指针直接发生的，<strong>绕过了代理对象</strong>。事务增强逻辑是存在于代理对象中的，所以事务会失效。</li>
</ul>
</li>
</ol>
<p>跟运行时异常有关的</p>
<ol>
<li><strong>异常被<code>try-catch</code>捕获了</strong>
<ul>
<li><strong>原因</strong>：Spring声明式事务默认只在遇到<strong>RuntimeException或Error</strong>时才会回滚。如果你在事务方法内部用<code>try-catch</code>捕获了异常，并且没有在<code>catch</code>块中重新抛出，那么Spring的事务代理就无法感知到异常的发生，从而会正常提交事务。</li>
<li><strong>一句话总结</strong>：<strong>异常没有传播到代理层，代理以为一切正常</strong>。</li>
</ul>
</li>
<li><strong>指定了不回滚的异常类型</strong>
<ul>
<li><strong>原因</strong>：在<code>@Transactional(noRollbackFor = ...)</code>中指定了某个异常类，那么当这个异常发生时，事务将不会回滚。</li>
<li><strong>示例</strong>：<code>@Transactional(noRollbackFor = NullPointerException.class)</code></li>
</ul>
</li>
</ol>
<p>事务有关的</p>
<ol>
<li><strong>数据库引擎不支持事务</strong>
<ul>
<li><strong>原因</strong>：例如，MySQL的MyISAM引擎就不支持事务。如果表使用了不支持事务的引擎，所有事务相关的操作都会被静默忽略。</li>
<li><strong>一句话总结</strong>：<strong>底层基础不支持，上层框架无能为力</strong>。</li>
</ul>
</li>
<li>事务的传播类型设置的不对，比如不支持事务never</li>
</ol>
<p>事务的传播机制：</p>
<ol>
<li><strong><code>REQUIRED</code> (需要)</strong>
<ul>
<li><strong>描述</strong>：这是<strong>默认</strong>的传播特性。如果当前存在一个事务，那么新方法就<strong>加入</strong>到这个事务中。如果当前没有事务，就<strong>新建</strong>一个事务。</li>
<li><strong>场景</strong>：绝大多数情况下的选择。</li>
</ul>
</li>
<li><strong><code>SUPPORTS</code> (支持)</strong>
<ul>
<li><strong>描述</strong>：如果当前存在一个事务，就加入。如果当前没有事务，就以<strong>非事务</strong>的方式执行。</li>
<li><strong>场景</strong>：用于那些“可有可无”的事务方法，比如一些只读查询操作。</li>
</ul>
</li>
<li><strong><code>MANDATORY</code> (强制)</strong>
<ul>
<li><strong>描述</strong>：<strong>强制</strong>要求当前必须存在一个事务。如果当前没有事务，就会抛出异常。它不会自己创建事务。</li>
<li><strong>场景</strong>：用于那些必须在事务环境下执行的核心操作，起到一种校验作用。</li>
</ul>
</li>
<li><strong><code>REQUIRES_NEW</code> (需要新的)</strong>
<ul>
<li><strong>描述</strong>：<strong>总是创建一个全新的、独立的事务</strong>。如果当前已经存在一个事务，会把当前事务<strong>挂起</strong>，然后执行新事务。新事务执行完毕后，再恢复被挂起的事务。</li>
<li><strong>场景</strong>：希望某些操作的事务结果独立于外部事务，不受其影响。比如，在一个大的下单流程中，记录操作日志，无论下单成功与否，日志都必须成功入库。</li>
</ul>
</li>
<li><strong><code>NOT_SUPPORTED</code> (不支持)</strong>
<ul>
<li><strong>描述</strong>：以<strong>非事务</strong>的方式执行。如果当前存在一个事务，会把当前事务<strong>挂起</strong>。</li>
<li><strong>场景</strong>：用于那些明确不希望在事务中运行的方法。</li>
</ul>
</li>
<li><strong><code>NEVER</code> (从不)</strong>
<ul>
<li><strong>描述</strong>：以<strong>非事务</strong>的方式执行。如果当前存在一个事务，就会抛出异常。</li>
<li><strong>场景</strong>：用于和<code>MANDATORY</code>相对的校验场景。</li>
</ul>
</li>
<li><strong><code>NESTED</code> (嵌套)</strong>
<ul>
<li><strong>描述</strong>：如果当前存在一个事务，就在这个事务中创建一个<strong>嵌套事务（保存点 Savepoint）</strong>。嵌套事务独立于外部事务进行提交或回滚。如果外部事务回滚，嵌套事务也会回滚。但嵌套事务的回滚不影响外部事务。如果当前没有事务，行为等同于<code>REQUIRED</code>。</li>
<li><strong>注意</strong>：这是一个部分数据库才支持的特性（如Oracle），需要底层JDBC驱动和数据库的支持。</li>
</ul>
</li>
</ol>
<h2 id="6-spring-MVC">6.spring MVC</h2>
<p>MVC 设计模式：</p>
<p>model-&gt;view-&gt;controller</p>
<p>作用：</p>
<ol>
<li><strong>实现MVC模式的解耦</strong>：它提供了一套清晰的架构，将处理请求的控制器、业务逻辑的模型和展示用的视图分离开来，极大地提高了代码的可维护性、可扩展性和可测试性。</li>
<li><strong>简化Web开发</strong>：它基于Servlet API构建，但极大地简化了底层的Servlet、Request、Response等对象的直接操作。开发者可以用简单的注解（如<code>@GetMapping</code>, <code>@PostMapping</code>）来处理复杂的HTTP请求。</li>
<li><strong>与Spring生态无缝集成</strong>：它可以非常方便地使用Spring核心的IoC和AOP功能，轻松整合Service层、DAO层以及事务管理等。</li>
<li><strong>提供强大的功能</strong>：内置了强大的参数绑定、数据校验、RESTful风格支持、拦截器、国际化、文件上传等一系列Web开发所需的核心功能。</li>
</ol>
<p>springmvc核心组件&amp;&amp;执行过程c</p>
<p>常用注解，那几个mappring 参数绑定的那几个</p>
<p>深入知识：</p>
<p>1.<strong>统一异常处理 (<code>@ControllerAdvice</code> + <code>@ExceptionHandler</code>)</strong></p>
<ul>
<li><strong>作用</strong>：通过创建一个带有<code>@ControllerAdvice</code>注解的类，可以在其中定义多个<code>@ExceptionHandler</code>方法，来集中处理整个应用中由Controller抛出的特定异常。这避免了在每个Controller中都写<code>try-catch</code>，实现了优雅的全局异常处理。</li>
<li><strong>示例</strong>：捕获所有<code>NullPointerException</code>，并返回一个自定义的错误JSON。</li>
</ul>
<p>2.<strong>拦截器 (<code>HandlerInterceptor</code>)</strong></p>
<ul>
<li>
<p><strong>作用</strong>：提供了在请求处理的生命周期中（<strong>Controller方法执行前后</strong>）织入自定义逻辑的能力。它比Servlet Filter更精细，因为它能访问到即将执行的<code>Handler</code>信息。</p>
</li>
<li>
<p>三大方法</p>
<p>：</p>
<ul>
<li><code>preHandle</code>: 在Controller方法执行<strong>之前</strong>调用。可以进行权限验证、日志记录等。返回<code>false</code>则中断后续流程。</li>
<li><code>postHandle</code>: 在Controller方法执行<strong>之后</strong>，视图渲染<strong>之前</strong>调用。可以修改<code>ModelAndView</code>中的数据。</li>
<li><code>afterCompletion</code>: 在整个请求处理完成（包括视图渲染）<strong>之后</strong>调用。主要用于资源清理。</li>
</ul>
</li>
<li>
<p><strong>与Filter的区别</strong>：Filter是Servlet规范的一部分，作用范围更广，能处理所有HTTP请求；Interceptor是Spring MVC的一部分，只能处理经过<code>DispatcherServlet</code>的请求，但能获取到Spring MVC的上下文信息。</p>
</li>
</ul>
<p>3.<strong>数据绑定与类型转换 (<code>DataBinder</code>, <code>Converter</code>)</strong></p>
<p>Spring MVC能自动将请求参数（都是字符串）转换为Controller方法参数所需的类型（如<code>Integer</code>, <code>Date</code>）。这个过程就是数据绑定。我们可以通过实现<code>Converter</code>接口，并将其注册到Spring中，来定义自定义的类型转换逻辑（例如，将&quot;2023-01-01&quot;字符串转换为<code>LocalDate</code>对象）。</p>
<p>4.<strong>跨域请求处理 (<code>@CrossOrigin</code>)</strong></p>
<ul>
<li><strong>作用</strong>：简单方便地解决Web开发中常见的跨域资源共享（CORS）问题。可以直接在<code>Controller</code>类或方法上使用<code>@CrossOrigin</code>注解，来允许来自特定域的跨域请求。</li>
</ul>
<h2 id="7-springboot">7.springboot</h2>
<p>springboot是啥，四大特性（自动配置，starter，内嵌web服务器，无需xml配置）</p>
<p>常用的starter，Starter本质上是一个<strong>Maven依赖描述符 (pom)</strong>。它的作用是将实现某一特定功能所需的所有依赖项打包在一起，并触发与该功能相关的自动配置。</p>
<p>启动springboot，</p>
<p>spring-boot-devtools热部署工作原理：</p>
<p>当<code>devtools</code>检测到classpath下的文件发生变化时，它会触发应用<strong>快速重启</strong>（不是完全重启，速度很快）。它通过维护两个类加载器（一个加载不变的第三方库，一个加载你自己的代码）来实现这一点，只重新加载你自己写的代码，从而大大加快了速度。</p>
<p><strong>Spring Boot JAR 与 普通JAR的区别</strong></p>
<table>
<thead>
<tr>
<th style="text-align:left">特性</th>
<th style="text-align:left"><strong>普通JAR (Thin JAR)</strong></th>
<th style="text-align:left"><strong>Spring Boot JAR (Fat JAR / Executable JAR)</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left"><strong>内容</strong></td>
<td style="text-align:left">只包含你项目自己编译的<code>.class</code>文件和资源文件。</td>
<td style="text-align:left"><strong>包含所有内容</strong>：你的代码、资源文件，以及项目所需的所有第三方依赖库的JAR包。</td>
</tr>
<tr>
<td style="text-align:left"><strong>大小</strong></td>
<td style="text-align:left">非常小。</td>
<td style="text-align:left">非常大，因此也叫“胖JAR”。</td>
</tr>
<tr>
<td style="text-align:left"><strong>运行方式</strong></td>
<td style="text-align:left">不能直接<code>java -jar</code>运行（除非配置了<code>Main-Class</code>且无外部依赖）。通常是作为其他项目的库被引用。</td>
<td style="text-align:left">可以通过<code>java -jar</code>命令<strong>直接运行</strong>，因为它内置了所有依赖和启动逻辑。</td>
</tr>
<tr>
<td style="text-align:left"><strong>结构</strong></td>
<td style="text-align:left">标准JAR结构。</td>
<td style="text-align:left">特殊的结构。解压后会看到一个<code>BOOT-INF</code>目录，里面包含了<code>classes</code>（你的代码）和<code>lib</code>（所有依赖的JAR包）。还有一个<code>org/springframework/boot/loader</code>目录，这是Spring Boot的启动加载器。</td>
</tr>
</tbody>
</table>
<p>自动装配原理，Spring Boot的自动装配核心在于<code>@SpringBootApplication</code>注解，而这个注解又是一个组合注解，其中最关键的是<code>@EnableAutoConfiguration</code>。</p>
<ol>
<li><strong><code>@EnableAutoConfiguration</code></strong>：这个注解是自动配置的开关。</li>
<li><strong><code>@Import(AutoConfigurationImportSelector.class)</code></strong>：<code>@EnableAutoConfiguration</code>内部通过<code>@Import</code>注解导入了<code>AutoConfigurationImportSelector</code>这个类。</li>
<li><strong><code>AutoConfigurationImportSelector</code></strong>：这个类的核心作用是去<strong>加载和筛选</strong>需要被激活的自动配置类。</li>
<li><strong>扫描<code>META-INF/spring.factories</code></strong>：它会扫描项目中所有JAR包的<code>META-INF/spring.factories</code>文件。这个文件中定义了所有可能的自动配置类（key为<code>org.springframework.boot.autoconfigure.EnableAutoConfiguration</code>）。</li>
<li><strong>按需加载</strong>：<code>Selector</code>会根据<strong>条件注解 (<code>@ConditionalOnClass</code>, <code>@ConditionalOnBean</code>等)</strong> 来判断这些自动配置类是否满足生效条件（比如<code>DataSourceAutoConfiguration</code>只有在classpath下存在<code>DataSource.class</code>时才会生效）。</li>
<li><strong>注入Bean</strong>：最终，满足条件的自动配置类被加载到Spring容器中，它们内部定义的各种Bean（如<code>DataSource</code>, <code>RestTemplate</code>）就被创建并注入了。</li>
</ol>
<p>@Import注解：</p>
<p><code>@Import</code>是Spring框架提供的基础注解，它比<code>@Bean</code>更强大，通常用于<strong>批量导入Bean</strong>或者<strong>导入配置类</strong>。它有三种主要使用方式，而Spring Boot的自动配置正是利用了第三种：</p>
<ol>
<li><strong>导入普通的类</strong>：<code>@Import(MyService.class)</code>，Spring会将<code>MyService</code>注册为一个Bean。</li>
<li><strong>导入配置类</strong>：<code>@Import(MyConfig.class)</code>，Spring会加载<code>MyConfig</code>这个配置类以及它内部定义的所有<code>@Bean</code>。</li>
<li><strong>导入<code>ImportSelector</code>实现类</strong>：<strong>这是最关键的用法</strong>。<code>@Import(MyImportSelector.class)</code>，Spring会实例化<code>MyImportSelector</code>，并调用它的<code>selectImports()</code>方法，该方法返回一个字符串数组，数组里的每一个类名都会被Spring注册为Bean。<strong>Spring Boot的自动配置就是通过这种方式，动态地、可选择地加载了大量的配置类。</strong></li>
</ol>
<h1>spring源码分析</h1>
<h2 id="bean">bean</h2>
<p>凡是可以存放数据的具体数据结构实现，都可以称之为容器，在 Spring Bean 容器的场景下，我们需要一种可以用于存放和名称索引式的数据结构，所以选择 HashMap 是最合适不过的。</p>
<p>HashMap 是一种基于扰动函数、负载因子、红黑树转换等技术内容，形成的拉链寻址的数据结构，它能让数据更加散列的分布在哈希桶以及碰撞时形成的链表和红黑树上。它的数据结构会尽可能最大限度的让整个数据读取的复杂度在 O(1) ~ O(Logn) ~O(n)之间，当然在极端情况下也会有 O(n) 链表查找数据较多的情况。不过我们经过10万数据的扰动函数再寻址验证测试，数据会均匀的散列在各个哈希桶索引上，所以 HashMap 非常适合用在 Spring Bean 的容器实现上。但是我们实际上应用的是concurrenthashmap，因为他是线程安全的。我们的bean不可能只是单线程进行操作的。他是一个弱一致性迭代器，避免了并发的修改异常。</p>
<p>一个简单的 Spring Bean 容器实现，还需 Bean 的定义、注册、获取三个基本步骤</p>
<ul>
<li>定义：BeanDefinition，可能这是你在查阅 Spring 源码时经常看到的一个类，例如它会包括 singleton、prototype、BeanClassName 等。</li>
<li>注册：这个过程就相当于我们把数据存放到 HashMap 中，只不过现在 HashMap 。在我们注册阶段Map里面存储的是beanDefintion</li>
<li>获取：最后就是获取对象，Bean 的名字就是key，Spring 容器初始化好 Bean 以后，就可以直接获取了。</li>
<li>实例化完成之后里面存储的才是bean实例</li>
</ul>
<p>我们解决循环依赖的三级缓存就是这么设计的，key是bean的名字，value是bean的实例。</p>
<hr>
<p>Spring Bean 容器的整个实现内容非常简单，也仅仅是包括了一个简单的 BeanFactory 和 BeanDefinition</p>
<ol>
<li>BeanDefinition，用于定义 Bean 实例化信息，现在的实现是以一个 Object 存放对象，可以继续添加属性，比如:SCOPE_SINGLETON、SCOPE_PROTOTYPE、ROLE_APPLICATION、ROLE_SUPPORT、ROLE_INFRASTRUCTURE 以及 Bean Class 信息。</li>
<li>BeanFactory，代表了 Bean 对象的工厂，可以存放 Bean 定义到 Map 中以及获取。</li>
</ol>
<p><code>BeanDefinition</code> 是 Spring IoC 容器的基石，它是 Bean 的一切元数据（类名、作用域、构造函数参数、属性等）的载体，是面向接口编程思想的体现。容器操作的是 <code>BeanDefinition</code>，而非直接操作 <code>Class</code>。</p>
<p><code>DefaultListableBeanFactory</code> 中 <code>beanDefinitionMap</code> 这个 <code>ConcurrentHashMap</code>，所有加载的 <code>BeanDefinition</code> 都存储于此。</p>
<p>将 Bean 的定义信息封装成一个标准化的数据结构，使得容器上层逻辑可以统一处理，与 Bean 的来源（XML, 注解）解耦。</p>
<p>在 Bean 工厂的实现中，包括了 Bean 的注册，这里注册的是 Bean 的定义信息。同时在这个类中还包括了获取 Bean 的操作。</p>
<p>然后我们使用的时候，是先初始化beanfactory容器，然后通过beanDefinition来创建一个bean。</p>
<p>然后去通过beanfactory去获取我们注册的bean，然后去使用bean里面封装的方法。这个时候才会实例化</p>
<p>然后实际我们使用的spring容器比如说是<strong>DefaultListableBeanFactory</strong>，他是继承了AbstractAutowireCapableBeanFactory，然后实现了ConfigurableListableBeanFactory, BeanDefinitionRegistry</p>
<p>里面包括存储BeanDefinition的容器，存储bean定义名词的列表，一级缓存，已经完成初始化的单例bean,二级缓存，早期bean的引用。三级缓存，单例工厂</p>
<p>我们注册bean的时候bean并没有实例化，直到获取bean的时候才会实例化，这就是懒加载</p>
<p>获取的时候先从一级缓存获取，缓存没有才创建bean</p>
<p><code>BeanFactory</code>: 顶层接口，定义了 <code>getBean()</code> 等核心方法。</p>
<p><code>ListableBeanFactory</code>: 扩展接口，提供枚举所有 Bean 的能力。</p>
<p><code>ConfigurableListableBeanFactory</code>: <code>BeanFactory</code> 体系的终极接口，几乎包含了所有功能。</p>
<p><code>ApplicationContext</code>: 继承了 <code>ListableBeanFactory</code> 和其他多个高级接口。</p>
<p><code>AbstractApplicationContext</code>: 核心中的核心，其 <code>refresh()</code> 方法定义了容器启动的完整流程。</p>
<p>rerfesh方法：</p>
<hr>
<p>加载的一个链路：</p>
<p>注解：从 <code>AnnotationConfigApplicationContext</code> 构造函数出发 -&gt; <code>this.scanner.scan(...)</code> -&gt; <code>ClassPathBeanDefinitionScanner.doScan()</code> -&gt; <code>findCandidateComponents()</code> (扫描路径，找到符合条件的类) -&gt; <code>isCandidateComponent()</code> (检查是否包含 <code>@Component</code> 等注解) -&gt; <code>registerBeanDefinition()</code>。</p>
<p><strong>XML 路径</strong>: 从 <code>AbstractXmlApplicationContext</code> 的构造函数出发 -&gt; <code>loadBeanDefinitions(new XmlBeanDefinitionReader(this))</code> -&gt; <code>XmlBeanDefinitionReader.loadBeanDefinitions()</code> -&gt; <code>doLoadDocument()</code> (将XML转为DOM) -&gt; <code>registerBeanDefinitions()</code> (解析DOM并注册 <code>BeanDefinition</code>)。</p>
<h2 id="设计模式">设计模式</h2>
<p>职责分清，一个接口只关注一个核心的职责，通过组合来实现多种能力。这样的话，方便我们的后续扩展和维护</p>
<p>比如我们的BeanFactory只负责获取bean,SingletonBeanRegistry只负责单例bean的管理，BeanDefinitionRegistry 只负责定义注册</p>
<p>模板方法模式，所有子类都遵循相同的Bean获取流程，子类只需实现特定的抽象方法，通用逻辑在父类中实现</p>
<p>比如一个抽象的基类AbstractBeanFactory定义了获取bean的标准流程，先去看一级缓存中有没有，没有的话，获取一个beandefinition，然后创建实例化这个bean</p>
<p>然后剩下的方法只是定义完，具体的逻辑留给子类实现</p>
<p>分层架构，每一层都该干属于自己的事情，比如接口层定义契约和规范，然后抽象类层，实现通用的逻辑和模板方法，实现类层，实现具体的业务逻辑实现</p>
<p>然后在我们的项目中，比如说实现一个支付的实现的话，我们可以先创建一个支付接口，定义一个执行方法。</p>
<p>然后创建一个所有的支付类共同的抽象类，实现支付的基本逻辑，先检验参数，然后执行，获取执行结果，返回执行结果</p>
<p>然后子类具体的去实现这个执行的逻辑，比如支付宝的具体的实现逻辑</p>
<p>比如说我们在项目中可以根据我们的类型来选择我们要实例化bean的模式，一般就是普通的jdk代理或者是cglib代理，可以在bean属性中class里面设定，然后我们根据属性的设定来选择我们具体是选择哪一种策略。</p>
<h2 id="实例化">实例化</h2>
<p>jdk实例化，首先通过 beanDefinition 获取 Class 信息，这个 Class 信息是在 Bean 定义的时候传递进去的。然后看我们获取的class信息是不是空的，空的就是无构造函数实例化，不是空的就是有构造函数实例化。这里我们重点关注有构造函数的实例化，实例化方式为 <code>clazz.getDeclaredConstructor(ctor.getParameterTypes()).newInstance(args);</code>，把入参信息传递给 newInstance 进行实例化。比较简单，适用于简单的pojo对象。</p>
<p>cglib实例化,先是构建enhancer，设置目标为父类。设置回溯，使用noop就是说明不需要额外的处理。可以设置<code>MethodInterceptor</code>等其他回调来实现AOP功能</p>
<p>如果class信息为空，就enhacers默认的创建，不为空的话，就创建我们指定的构造器的类型。</p>
<p>支持动态代理，适用于需要进行增强的对象。运行的时候动态的生成新的class文件，比如需要事务代理，需要缓存代理的</p>
<table>
<thead>
<tr>
<th>特性</th>
<th>JDK反射</th>
<th>Cglib动态代理</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>实现原理</strong></td>
<td>Java原生反射API</td>
<td>字节码动态生成</td>
</tr>
<tr>
<td><strong>性能表现</strong></td>
<td>反射调用开销较小</td>
<td>首次创建开销大，后续调用快</td>
</tr>
<tr>
<td><strong>功能扩展</strong></td>
<td>仅支持实例化</td>
<td>支持方法拦截、AOP增强</td>
</tr>
<tr>
<td><strong>依赖要求</strong></td>
<td>无额外依赖</td>
<td>需要cglib和asm库</td>
</tr>
<tr>
<td><strong>代理限制</strong></td>
<td>无法代理final类/方法</td>
<td>无法代理final类/方法</td>
</tr>
</tbody>
</table>
<h2 id="注入">注入</h2>
<p>属性填充的时机，实在对象创建后立刻进行。<strong>. PropertyValue - 属性值载体****，PropertyValues - 属性集合管理</strong> <strong>BeanReference - 对象依赖标识</strong></p>
<ul>
<li><strong>延迟解析</strong>：不是直接存储Bean对象，而是存储Bean名称</li>
<li><strong>递归创建</strong>：在属性填充时才真正创建依赖的Bean</li>
<li><strong>循环依赖预留</strong>：为后续处理循环依赖留下接口</li>
</ul>
<p>属性填充方法，内部使用递归，检测到<code>BeanReference</code>类型，调用<code>getBean(beanReference.getBeanName())</code>获取他的依赖的名字</p>
<p>使用递归获取，被依赖的Bean创建完成后返回，用创建好的Bean对象填充当前Bean的属性</p>
<p>框架自动处理依赖关系，开发者无需关心创建顺序，只有真正需要这个bean的时候才会创建，提高了性能。然后我们创建后的Bean会被缓存，避免重复创建。这是缓存的思想</p>
<p>处理循环依赖：使用三级缓存架构来解决，一级缓存，完整的bean。二级缓存，实例化，没有进行属性的填充。三级缓存，bean的工厂对象，用于解决aop代理的问题</p>
<table>
<thead>
<tr>
<th>缓存级别</th>
<th>存储内容</th>
<th>作用</th>
<th>时机</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>一级缓存</strong></td>
<td>完整的Bean对象</td>
<td>存放完全初始化好的Bean</td>
<td>Bean创建完成后</td>
</tr>
<tr>
<td><strong>二级缓存</strong></td>
<td>早期Bean对象</td>
<td>存放实例化但未填充属性的Bean</td>
<td>解决循环依赖时</td>
</tr>
<tr>
<td><strong>三级缓存</strong></td>
<td>ObjectFactory</td>
<td>用于创建代理对象</td>
<td>Bean实例化后立即放入</td>
</tr>
</tbody>
</table>
<p>扩展支持private boolean allowCircularReference = true;</p>
<p><strong>DefaultSingletonBeanRegistry</strong>：</p>
<p>一级一级的调用，先去找一次缓存没有，标记为正在创建，然后再找二级缓存，允许早期引用。没有就从三级缓存中获取，还没有的话，<em>通过ObjectFactory创建Bean</em></p>
<p>然后放入二级缓存，从三级缓存中删除。</p>
<p>实体类方法：</p>
<p>实例化后立刻放入三级缓存，然后进行填充属性。然后初始化bean，成功之后放入一级缓存，标记为完成</p>
<p>流程：</p>
<p><strong>创建UserService</strong></p>
<ol>
<li>doGetBean(“userService”)</li>
<li>getSingleton(“userService”) → null（一级缓存为空）</li>
<li>beforeSingletonCreation(“userService”) → 标记正在创建</li>
<li>createBeanInstance() → 实例化UserService对象</li>
<li>addSingletonFactory(“userService”, ObjectFactory) → 添加到三级缓存</li>
<li>applyPropertyValues() → 开始填充orderService属性</li>
<li>getBean(“orderService”) → 触发OrderService创建</li>
</ol>
<p>创建orderService</p>
<ol start="8">
<li>doGetBean(“orderService”)</li>
<li>getSingleton(“orderService”) → null（一级缓存为空）</li>
<li>beforeSingletonCreation(“orderService”) → 标记正在创建</li>
<li>createBeanInstance() → 实例化OrderService对象</li>
<li>addSingletonFactory(“orderService”, ObjectFactory) → 添加到三级缓存</li>
<li>applyPropertyValues() → 开始填充userService属性</li>
<li>getBean(“userService”) → 再次请求UserService</li>
</ol>
<p>循环依赖解析</p>
<ol start="15">
<li>doGetBean(“userService”)</li>
<li>getSingleton(“userService”, true) → 执行三级缓存查找
<ul>
<li>一级缓存：null</li>
<li>isSingletonCurrentlyInCreation(“userService”) → true</li>
<li>二级缓存：null</li>
<li>三级缓存：找到ObjectFactory</li>
<li>factory.getObject() → 返回早期UserService对象</li>
<li>放入二级缓存，移除三级缓存</li>
</ul>
</li>
<li>返回早期UserService对象给OrderService</li>
<li>OrderService属性填充完成</li>
<li>OrderService初始化完成，添加到一级缓存</li>
<li>返回OrderService给UserService</li>
<li>UserService属性填充完成</li>
<li>UserService初始化完成，添加到一级缓存</li>
</ol>
<p>这就是我们所说的提前暴露的问题</p>
<h2 id="bean管理">bean管理</h2>
<p>使用配置文件来管理我们的bean,添加一个资源解释器，也就是能读取classpath、本地文件和云文件的配置内容</p>
<p>里面会包括 Bean 对象的描述和属性信息。在读取配置文件信息后，接下来就是对配置文件中的 Bean 描述信息解析后进行注册操作，把 Bean 对象注册到 Spring 容器中。</p>
<p>从配置文件层-&gt;资源加载层-&gt;解析注册层-&gt;bean容器层</p>
<hr>
<p>资源加载：定义 Resource 接口，提供获取 InputStream 流的方法</p>
<p>然后策略实现类，多种的实现策略。</p>
<p><strong>ClassPath资源加载</strong>：</p>
<p>通过 <code>ClassLoader</code> 读取<code>ClassPath</code> 下的文件信息，具体的读取过程主要是：<code>classLoader.getResourceAsStream(path)</code></p>
<ul>
<li><strong>打包后的配置文件</strong>：JAR包内的spring.xml</li>
<li><strong>测试资源</strong>：src/test/resources下的配置文件</li>
<li><strong>类路径资源</strong>：与class文件同目录的配置文件</li>
</ul>
<p><strong>文件系统资源加载</strong>：</p>
<p>通过指定文件路径的方式读取文件信息</p>
<ul>
<li><strong>外部配置文件</strong>：/etc/app/config.xml</li>
<li><strong>用户自定义配置</strong>：~/app/custom.properties</li>
<li><strong>绝对路径资源</strong>：D:/config/spring.xml</li>
</ul>
<p><strong>URL资源加载</strong>：</p>
<p>通过 HTTP 的方式读取云服务的文件，我们也可以把配置文件放到 GitHub 或者 Gitee 上，使用URLConnection</p>
<ul>
<li><strong>远程配置中心</strong>：<a target="_blank" rel="noopener" href="http://config-server/app.xml">http://config-server/app.xml</a></li>
<li><strong>云端配置文件</strong>：<a target="_blank" rel="noopener" href="https://github.com/user/repo/config.xml">https://github.com/user/repo/config.xml</a></li>
<li><strong>动态配置</strong>：从配置中心实时拉取</li>
</ul>
<hr>
<p>智能资源定位器，<strong>DefaultResourceLoader</strong></p>
<p>按照资源加载的不同方式，资源加载器可以把这些方式集中到统一的类服务下进行处理，外部用户只需要传递资源地址即可</p>
<p>使用的顺序是先去从classpath进行获取，然后再去获取url资源。都没有的话采取获取默认的文件系统资源</p>
<p>Bean定义读取器，BeanDefinitionReader</p>
<p>通过这个抽象类的具体实现就可以把解析后的 XML 文件中的 Bean 信息，注册到 Spring 容器去了。<em>以前我们是通过单元测试使用，调用 BeanDefinitionRegistry 完成Bean的注册，现在可以放到 XMl 中操作了</em></p>
<p>解析xml处理bean注册，<strong>XmlBeanDefinitionReader</strong> 基础自抽象类</p>
<p>将xml文件映射为我们需要的代码，然后进行在spring容器中的注册</p>
<h2 id="bean组件的扩展">bean组件的扩展</h2>
<p>在实际工作中，当我们开发基于Spring的技术组件（如中间件、SpringBoot Starter等）时，经常需要：</p>
<ul>
<li>修改Bean的信息</li>
<li>添加日志打印、监控</li>
<li>处理数据库路由和数据源切换</li>
<li>给RPC服务连接注册中心</li>
<li>实现AOP切面功能</li>
</ul>
<p>这些都需要在Bean的生命周期中插入自定义逻辑，这就是Spring扩展机制的核心价值。</p>
<p><strong>BeanFactoryPostProcessor - Bean定义后置处理器</strong></p>
<p>在beandefinition加载完之后，bean实例化之前，可以去修改beandefinition的属性信息。相当于我们去建筑的蓝图。用于配置属性修改、Bean定义动态调整</p>
<p>比如</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyBeanFactoryPostProcessor</span> <span class="keyword">implements</span> <span class="title class_">BeanFactoryPostProcessor</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">postProcessBeanFactory</span><span class="params">(ConfigurableListableBeanFactory beanFactory)</span> <span class="keyword">throws</span> BeansException &#123;</span><br><span class="line">        <span class="comment">// 场景1：动态修改Bean的属性值</span></span><br><span class="line">        <span class="type">BeanDefinition</span> <span class="variable">userServiceDef</span> <span class="operator">=</span> beanFactory.getBeanDefinition(<span class="string">&quot;userService&quot;</span>);</span><br><span class="line">        <span class="type">PropertyValues</span> <span class="variable">pv</span> <span class="operator">=</span> userServiceDef.getPropertyValues();</span><br><span class="line">        pv.addPropertyValue(<span class="keyword">new</span> <span class="title class_">PropertyValue</span>(<span class="string">&quot;environment&quot;</span>, <span class="string">&quot;production&quot;</span>));</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 场景2：根据环境调整Bean配置</span></span><br><span class="line">        <span class="keyword">if</span> (isProductionEnvironment()) &#123;</span><br><span class="line">            pv.addPropertyValue(<span class="keyword">new</span> <span class="title class_">PropertyValue</span>(<span class="string">&quot;timeout&quot;</span>, <span class="string">&quot;30000&quot;</span>));</span><br><span class="line">        &#125;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 场景3：添加额外的Bean定义</span></span><br><span class="line">        beanFactory.registerBeanDefinition(<span class="string">&quot;dynamicBean&quot;</span>, createDynamicBeanDefinition());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><strong>BeanPostProcessor - Bean实例后置处理器</strong></p>
<p><em>Bean实例化和属性注入后，初始化方法调用前执行</em>,他有前置和后置的类型，我们一般在后置进行增加的更多，比如AOP代理，Bean增强，属性修改。依赖检查，权限校验和监控</p>
<p>ApplicationContext应用上下文架构</p>
<p>为了避免繁琐的操作，他是我们最常用的一个IOC容器</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">// 简洁的上下文操作</span><br><span class="line">ApplicationContext context = new ClassPathXmlApplicationContext(&quot;classpath:spring.xml&quot;);</span><br><span class="line">UserService userService = context.getBean(&quot;userService&quot;, UserService.class);</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>接口体系：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">// 接口层次结构</span><br><span class="line">BeanFactory                           // 基础Bean工厂</span><br><span class="line">└── ListableBeanFactory              // 可列举Bean的工厂</span><br><span class="line">    └── ApplicationContext           // 应用上下文接口</span><br><span class="line">        └── ConfigurableApplicationContext  // 可配置的应用上下文</span><br><span class="line"></span><br><span class="line">// 实现层次结构  </span><br><span class="line">DefaultResourceLoader                 // 资源加载能力</span><br><span class="line">└── AbstractApplicationContext       // 上下文抽象实现</span><br><span class="line">    └── AbstractRefreshableApplicationContext     // 可刷新的上下文</span><br><span class="line">        └── AbstractXmlApplicationContext         // XML配置支持</span><br><span class="line">            └── ClassPathXmlApplicationContext    // 类路径XML上下文</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>在applicationcontext里面最重要的方法就是refresh方法</p>
<p>创建beanfactory然后加载beandefinnition</p>
<p>然后我们去获取beanfactory，执行<em>BeanFactoryPost</em>processor修改beandefinition</p>
<p>然后注册beanpostprocessor,为后续的处理进行准备</p>
<p>然后提前实例化单例的bean。</p>
<p>完整的生命周期</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">1. BeanDefinition注册</span><br><span class="line">        ↓</span><br><span class="line">2. BeanFactoryPostProcessor执行 ← 修改BeanDefinition</span><br><span class="line">        ↓</span><br><span class="line">3. Bean实例化（Constructor）</span><br><span class="line">        ↓</span><br><span class="line">4. 属性注入（Setter）</span><br><span class="line">        ↓</span><br><span class="line">5. BeanPostProcessor.postProcessBeforeInitialization ← Bean增强</span><br><span class="line">        ↓</span><br><span class="line">6. 初始化方法执行（@PostConstruct, InitializingBean, init-method）</span><br><span class="line">        ↓</span><br><span class="line">7. BeanPostProcessor.postProcessAfterInitialization ← AOP代理创建</span><br><span class="line">        ↓</span><br><span class="line">8. Bean就绪，放入容器</span><br><span class="line">        ↓</span><br><span class="line">9. 应用运行</span><br><span class="line">        ↓</span><br><span class="line">10. 容器关闭时执行销毁方法</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><strong>BeanFactoryPostProcessor应用场景</strong>：</p>
<ol>
<li><strong>配置中心集成</strong>：动态读取远程配置修改Bean属性</li>
<li><strong>环境相关配置</strong>：根据环境（dev/test/prod）调整Bean配置</li>
<li><strong>属性占位符解析</strong>：解析${property}占位符</li>
<li><strong>条件化Bean注册</strong>：根据条件动态注册Bean</li>
</ol>
<p><strong>BeanPostProcessor应用场景</strong>：</p>
<ol>
<li><strong>AOP实现</strong>：Spring AOP就是通过此接口创建代理对象</li>
<li><strong>中间件集成</strong>：如MyBatis的MapperScannerConfigurer</li>
<li><strong>监控和日志</strong>：自动添加监控、日志功能</li>
<li><strong>依赖注入增强</strong>：如@Autowired注解的实现</li>
<li><strong>数据源路由</strong>：动态数据源切换</li>
</ol>
<p><strong>Spring中哪些功能使用了这些扩展机制</strong></p>
<p><strong>BeanFactoryPostProcessor的应用</strong>：</p>
<ul>
<li><code>PropertyPlaceholderConfigurer</code>：属性占位符解析</li>
<li><code>PropertySourcesPlaceholderConfigurer</code>：Spring 3.1+的属性解析</li>
<li><code>ConfigurationClassPostProcessor</code>：@Configuration类处理</li>
</ul>
<p><strong>BeanPostProcessor的应用</strong>：</p>
<ul>
<li><code>AutowiredAnnotationBeanPostProcessor</code>：@Autowired注解处理</li>
<li><code>CommonAnnotationBeanPostProcessor</code>：@Resource等注解处理</li>
<li><code>AnnotationAwareAspectJAutoProxyCreator</code>：AOP代理创建</li>
</ul>
<h2 id="bean的初始化和销毁">bean的初始化和销毁</h2>
<p>完整的生命周期：</p>
<p>Bean定义注册<br>
↓<br>
BeanFactoryPostProcessor执行<br>
↓<br>
Bean实例化（Constructor）<br>
↓<br>
属性注入（Setter/Field）<br>
↓<br>
BeanPostProcessor.postProcessBeforeInitialization<br>
↓<br>
InitializingBean.afterPropertiesSet() ← 接口方式初始化<br>
↓<br>
init-method执行 ← XML配置方式初始化<br>
↓<br>
BeanPostProcessor.postProcessAfterInitialization<br>
↓<br>
Bean就绪状态<br>
↓<br>
容器关闭触发<br>
↓<br>
DisposableBean.destroy() ← 接口方式销毁<br>
↓<br>
destroy-method执行 ← XML配置方式销毁</p>
<p>在这个里面,init-method和destory-method他们也是要xml配置来进行的。所以也要通过 XmlBeanDefinitionReader 加载 spring.xml 配置信息到 BeanDefinition 中。</p>
<ul>
<li>InitializingBean、DisposableBean，两个接口方法还是比较常用的，在一些需要结合 Spring 实现的组件中，经常会使用这两个方法来做一些参数的初始化和销毁操作。比如接口暴漏、数据库数据读取、配置文件加载等等。</li>
<li>在方法 invokeInitMethods 中，主要分为两块来执行实现了 InitializingBean 接口的操作，处理 afterPropertiesSet 方法。另外一个是判断配置信息 init-method 是否存在，执行反射调用 initMethod.invoke(bean)。这两种方式都可以在 Bean 对象初始化过程中进行处理加载 Bean 对象中的初始化操作，让使用者可以额外新增加自己想要的动作。先执行接口方式，再执行配置方式，通过反射避免重复执行同名方法</li>
<li>方法destory跟上面的invokeinitMethods差不多，都是先实现接口，然后<em>配置信息 destroy-method {判断是为了避免二次执行销毁}</em></li>
</ul>
<p>虚拟机关闭钩子：</p>
<ul>
<li>首先我们需要在 ConfigurableApplicationContext 接口中定义注册虚拟机钩子的方法 <code>registerShutdownHook</code> 和手动执行关闭的方法 <code>close</code>。</li>
<li>在抽象实现类里面进行实现，注册JVM关闭构造的时候，是Runtime.getRuntime().addShutdownHook</li>
</ul>
<p>1.<strong>初始化方法和构造函数的区别？</strong></p>
<p>主要的区别在于执行的实际和功能定位，构造函数执行的时候，依赖注入还没完成，无法进行初始化</p>
<p>初始化方法执行的时候，所有属性已经完成。可以使用依赖对象进行初始化。比如建立数据库连接池，缓存预热，注册到注册中心</p>
<p>然后构造函数主要用于对象创建、基本属性设置，初始化方法主要使用依赖就绪后的业务初始化</p>
<p>2.<strong>为什么需要销毁方法？不能依赖GC吗</strong></p>
<p>GC只能回收内存，不能处理资源的释放</p>
<p>比如，socket,http连接，文件流，数据库连接等。比如线程池，定时器。还有注册中心，Mbean</p>
<p>3.<strong>Spring中哪些组件使用了初始化/销毁机制？</strong></p>
<p><strong>几乎所有核心组件都有应用</strong>，比如数据源组件，初始化连接池，销毁连接池</p>
<p>缓存组件，初始化缓存预热，关闭redis连接</p>
<p><strong>消息队列</strong>，启动监听消息队列，停止监听关闭消息队列</p>
<p>4.<strong>如何保证初始化方法的执行顺序？</strong></p>
<p>使用*@DependsOn*注解，就是一个前置条件，<em>确保configService和cacheService先初始化</em></p>
<p><strong>@Order注解配合ApplicationListener</strong>，数字越小，约先执行。</p>
<p><em>实现Ordered接口</em>，然后确定高优先级的初始化</p>
<p>5.<strong>如何处理初始化方法的异常？</strong></p>
<ol>
<li><strong>快速失败</strong>：关键资源初始化失败时立即抛异常</li>
<li><strong>优雅降级</strong>：非关键失败时使用备用方案</li>
<li><strong>延迟重试</strong>：网络等临时性失败可以重试</li>
</ol>
<h2 id="Aware">Aware</h2>
<p>Aware是Spring提供的一种<strong>容器感知机制</strong>，让Bean能够获取Spring容器中的各种资源和服务。它是一个<strong>标记接口</strong>，通过实现不同的Aware子接口，Bean可以感知到：</p>
<ul>
<li>BeanFactory</li>
<li>ApplicationContext</li>
<li>ClassLoader</li>
<li>Bean名称</li>
<li>以及其他容器资源</li>
</ul>
<p>继承 Aware 的接口包括：BeanFactoryAware、BeanClassLoaderAware、BeanNameAware和ApplicationContextAware</p>
<p>在具体的接口实现过程中你可以看到，一部分(<em>BeanFactoryAware、BeanClassLoaderAware、BeanNameAware</em>)在 factory 的 support 文件夹下，另外 ApplicationContextAware 是在 context 的 support 中，这是因为不同的内容获取需要在不同的包下提供。所以，在 AbstractApplicationContext 的具体实现中会用到向 beanFactory 添加 BeanPostProcessor 内容的 <code>ApplicationContextAwareProcessor</code> 操作，最后由 AbstractAutowireCapableBeanFactory 创建 createBean 时处理相应的调用操作。</p>
<p>Aware接口</p>
<ul>
<li>
<p>在 Spring 中有特别多类似这样的标记接口的设计方式，它们的存在就像是一种标签一样，可以方便统一摘取出属于此类接口的实现类，通常会有 instanceof 一起判断使用。</p>
</li>
<li>
<p><strong>标记模式</strong>：类似于<code>Serializable</code>接口，用于标识具有某种特性的类</p>
</li>
<li>
<p><strong>instanceof判断</strong>：通过<code>bean instanceof Aware</code>统一识别和处理</p>
</li>
<li>
<p><strong>统一管理</strong>：将所有感知接口归类到一个体系下</p>
</li>
</ul>
<p>四大核心感知接口：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. 感知BeanFactory</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">BeanFactoryAware</span> <span class="keyword">extends</span> <span class="title class_">Aware</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">setBeanFactory</span><span class="params">(BeanFactory beanFactory)</span> <span class="keyword">throws</span> BeansException;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 2. 感知ClassLoader</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">BeanClassLoaderAware</span> <span class="keyword">extends</span> <span class="title class_">Aware</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">setBeanClassLoader</span><span class="params">(ClassLoader classLoader)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 3. 感知Bean名称</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">BeanNameAware</span> <span class="keyword">extends</span> <span class="title class_">Aware</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">setBeanName</span><span class="params">(String name)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 4. 感知ApplicationContext</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">ApplicationContextAware</span> <span class="keyword">extends</span> <span class="title class_">Aware</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">setApplicationContext</span><span class="params">(ApplicationContext applicationContext)</span> <span class="keyword">throws</span> BeansException;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>调用感知：</p>
<ul>
<li>
<p>首先在 initializeBean 中，通过判断 <code>bean instanceof Aware</code>，调用了三个接口方法，<code>BeanFactoryAware.setBeanFactory(this)</code>、<code>BeanClassLoaderAware.setBeanClassLoader(getBeanClassLoader())</code>、<code>BeanNameAware.setBeanName(beanName)</code>，这样就能通知到已经实现了此接口的类。</p>
</li>
<li>
<p>另外我们还向 BeanPostProcessor 中添加了 <code>ApplicationContextAwareProcessor</code>，此时在这个方法中也会被调用到具体的类实现，得到一个 ApplicationContex 属性。</p>
</li>
<li>
<p>确保Bean获得感知能力后再进行业务初始化</p>
</li>
</ul>
<p><strong>ApplicationContext</strong>比较特殊他要单独去执行在refresh方法中进行，ApplicationContext在<code>AbstractAutowireCapableBeanFactory</code>中不可直接获取，需要在容器启动时注册专门的处理器，体现了<strong>分层架构</strong>的设计思想。ApplicationContextAwareProcessor在ApplicationContext，其他的他们在<em>BeanFactory层</em> 。</p>
<p>实现：</p>
<ol>
<li>在ApplicationContext层创建<code>ApplicationContextAwareProcessor</code></li>
<li>将processor注册到BeanFactory中</li>
<li>利用BeanPostProcessor机制在Bean初始化时注入ApplicationContext</li>
</ol>
<p>题目：</p>
<p>1.<strong>Aware接口的作用是什么？</strong></p>
<p><strong>Aware接口提供了Bean获取Spring容器资源的标准机制：</strong></p>
<ol>
<li><strong>容器感知</strong>：让Bean能够感知到Spring容器的存在</li>
<li><strong>资源获取</strong>：提供获取容器内部资源的标准方式</li>
<li><strong>扩展能力</strong>：为开发中间件和框架提供扩展点</li>
<li><strong>解耦设计</strong>：通过接口回调而非静态方法获取资源</li>
</ol>
<p>比如setApplicationContext方法，可以获取容器中的其他的bean，发布应用事件，可以获取环境配置</p>
<p>setBeanFactory方法，可以动态获取bean，检查bean是不是存在</p>
<p>2.<strong>不同Aware接口的执行顺序是什么？</strong></p>
<p>\1. BeanNameAware.setBeanName()</p>
<p>\2. BeanClassLoaderAware.setBeanClassLoader()</p>
<p>\3. BeanFactoryAware.setBeanFactory()</p>
<p>\4. EnvironmentAware.setEnvironment() (如果实现)</p>
<p>\5. EmbeddedValueResolverAware.setEmbeddedValueResolver() (如果实现)</p>
<p>\6. ResourceLoaderAware.setResourceLoader() (如果在ApplicationContext中)</p>
<p>\7. ApplicationEventPublisherAware.setApplicationEventPublisher() (如果在ApplicationContext中)</p>
<p>\8. MessageSourceAware.setMessageSource() (如果在ApplicationContext中)</p>
<p>\9. ApplicationContextAware.setApplicationContext() (如果在ApplicationContext中)</p>
<ul>
<li><strong>Bean自身信息</strong>先设置（Name、ClassLoader、Factory）</li>
<li><strong>容器环境信息</strong>后设置（Context、Environment等）</li>
<li><strong>应用层面信息</strong>最后设置（Event、Message等）</li>
<li>最后是我们的context</li>
</ul>
<p>3.<strong>Aware机制与@Autowired的区别？</strong></p>
<table>
<thead>
<tr>
<th>对比维度</th>
<th>Aware接口</th>
<th>@Autowired</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>注入对象</strong></td>
<td>Spring容器内部资源</td>
<td>业务Bean对象</td>
</tr>
<tr>
<td><strong>执行时机</strong></td>
<td>Bean初始化阶段</td>
<td>属性注入阶段</td>
</tr>
<tr>
<td><strong>耦合度</strong></td>
<td>与Spring框架耦合</td>
<td>相对解耦</td>
</tr>
<tr>
<td><strong>使用场景</strong></td>
<td>框架扩展、中间件开发</td>
<td>业务依赖注入</td>
</tr>
<tr>
<td><strong>灵活性</strong></td>
<td>可以获取容器的动态能力</td>
<td>静态依赖关系</td>
</tr>
</tbody>
</table>
<h2 id="FactoryBean-Bean的作用域">FactoryBean&amp;Bean的作用域</h2>
<p>FactoryBean是Spring提供的一种<strong>创建复杂Bean对象的工厂接口</strong>，它允许我们自定义Bean的创建逻辑，特别适用于：</p>
<ul>
<li><strong>代理对象创建</strong>（如MyBatis的Mapper代理）</li>
<li><strong>复杂对象初始化</strong>（需要多步骤构建的对象）</li>
<li><strong>第三方框架集成</strong>（将外部框架的对象纳入Spring管理）</li>
</ul>
<p><strong>Bean作用域（Scope）机制</strong></p>
<p>Spring支持多种Bean作用域：</p>
<ul>
<li><strong>singleton</strong>：单例模式（默认），容器中只有一个实例</li>
<li><strong>prototype</strong>：原型模式，每次获取都创建新实例</li>
<li><strong>request/session/application</strong>：Web环境中的作用域</li>
</ul>
<p>单例模式和原型模式的区别就在于是否存放到内存中，如果是原型模式那么就不会存放到内存中，每次获取都重新创建对象</p>
<p>这就是我们常说的五大作用域</p>
<p>FactoryBean设计：获取对象、对象类型，以及是否是单例对象</p>
<p>比如我们的<strong>MyBatis Mapper代理创建</strong>就是我们自定义的一个FactoryBean， 使用 <code>MapperFactoryBean</code> 将<strong>接口注册为代理对象</strong>，启动时会把接口方法解析成 <code>MappedStatement</code> 存入 Configuration 中，运行时由 <code>MapperProxy</code> 通过反射动态执行 SQL。</p>
<p>还有数据源代理等等。</p>
<p>作用域就是我们定义在BeanDefinition中的一个常量，然后我们通过指定scpore字段来定义</p>
<p>然后xml解析回去xml里获取作用域，然后设置beandefinition的信息</p>
<p>1.<strong>FactoryBean和BeanFactory的区别？</strong></p>
<table>
<thead>
<tr>
<th>对比维度</th>
<th>BeanFactory</th>
<th>FactoryBean</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>性质</strong></td>
<td>Spring容器的根接口</td>
<td>用户可实现的工厂接口</td>
</tr>
<tr>
<td><strong>作用</strong></td>
<td>管理Bean的生命周期</td>
<td>创建复杂的Bean对象</td>
</tr>
<tr>
<td><strong>使用者</strong></td>
<td>Spring框架内部使用</td>
<td>开发者实现和使用</td>
</tr>
<tr>
<td><strong>获取方式</strong></td>
<td>通过ApplicationContext</td>
<td>通过getBean()获取其产品</td>
</tr>
</tbody>
</table>
<p>2.<strong>如何获取FactoryBean本身而不是它创建的对象</strong></p>
<p>使用&amp;的前缀符表示我们需要的是FactoryBean</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">MyFactoryBean factoryBean = (MyFactoryBean) applicationContext.getBean(&quot;&amp;myFactoryBean&quot;);</span><br></pre></td></tr></table></figure>
<p>然后内部处理</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> Object <span class="title function_">getBean</span><span class="params">(String name)</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (name.startsWith(<span class="string">&quot;&amp;&quot;</span>)) &#123;</span><br><span class="line">        <span class="comment">// 去掉&amp;前缀，获取FactoryBean本身</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">factoryBeanName</span> <span class="operator">=</span> name.substring(<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">return</span> getFactoryBean(factoryBeanName);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">// 正常获取FactoryBean创建的对象</span></span><br><span class="line">        <span class="keyword">return</span> getObjectForBeanInstance(getSingleton(name), name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>3.<strong>FactoryBean在什么场景下使用？</strong></p>
<p>代理对象的创建，<strong>复杂对象初始化</strong>， <strong>第三方框架集成</strong>（比如redis中设置redis的运行的参数和序列化方式）</p>
<p>4.<strong>FactoryBean的生命周期是怎样的？</strong></p>
<p><strong>FactoryBean有双重生命周期</strong>，一个是他本身的生命周期，一个是他产品对象的生命周期</p>
<h2 id="事件">事件</h2>
<p>Event机制</p>
<p>在复杂的业务系统中，直接调用会导致<strong>紧耦合</strong>问题：</p>
<ul>
<li><strong>用户注册</strong> → 直接调用发送邮件、赠送积分、风控检查等服务</li>
<li><strong>订单支付</strong> → 直接调用库存扣减、物流发货、积分计算等服务</li>
<li><strong>文章发布</strong> → 直接调用消息推送、索引更新、缓存刷新等服务</li>
</ul>
<p>这种方式会导致：</p>
<ol>
<li><strong>代码耦合度高</strong>：核心业务逻辑与辅助功能混杂</li>
<li><strong>扩展性差</strong>：新增功能需要修改核心代码</li>
<li><strong>维护困难</strong>：一个环节出错影响整个流程</li>
<li><strong>性能问题</strong>：同步执行所有操作，响应慢</li>
</ol>
<p>我们可以通过观察者模式进行解耦</p>
<p>用户注册成功 → 发布UserRegisteredEvent → 多个监听器异步处理</p>
<p>├── EmailListener: 发送欢迎邮件</p>
<p>├── CouponListener: 赠送新人礼包</p>
<p>├── RiskListener: 风控分析</p>
<p>└── StatisticsListener: 数据统计</p>
<p>spring event</p>
<p>定义出事件类、事件监听、事件发布 事件广播器</p>
<p>applicationevent-&gt;applicationlistener-&gt;applicationeventpublisher-&gt;applicaitoneventmulticaster</p>
<p>我们事件类是构建一个基本的抽象类，然后其他的具体事件继承这个抽象类</p>
<p>事件广播器定义了添加监听和删除监听的方法，和添加广播的方法。<code>multicastEvent</code> 最终推送时间消息也会经过这个接口方法来处理谁该接收事件。</p>
<p>那我们怎么处理事件广播的并发处理呢？</p>
<ul>
<li><strong>监听器隔离</strong>：一个监听器异常不影响其他监听器</li>
<li><strong>异步执行</strong>：可配置同步或异步处理</li>
<li><strong>顺序控制</strong>：支持监听器执行顺序</li>
</ul>
<p>然后我们怎么去确定某个事件如何被监听器处理？我们使用泛型参数匹配来实现</p>
<p>我们先去获取监听的class，然后如果存在GCLIB代理的话，我们处理CGLIB代理。spring中Bean可能被代理，需要获取真实类型，就是他的父类。</p>
<p>然后获取泛型接口，提取泛型参数，获取事件的类型。</p>
<p>然后判断事件是否匹配，就是判断ParameterizedType 和eventClassName是不是子类和父类的关系</p>
<p>事件发布器，初始化事件发布者(initApplicationEventMulticaster)，</p>
<ul>
<li>
<p>主要用于实例化一个 SimpleApplicationEventMulticaster，这是一个事件广播器。</p>
</li>
<li>
<p>注册事件监听器(registerListeners)，通过 getBeansOfType 方法获取到所有从 spring.xml 中加载到的事件配置 Bean 对象。</p>
</li>
<li>
<p>发布容器刷新完成事件(finishRefresh)，发布了第一个服务器启动完成后的事件，这个事件通过 publishEvent 发布出去，其实也就是调用了 applicationEventMulticaster.multicastEvent(event); 方法。</p>
</li>
</ul>
<p>问题</p>
<p>1.spring event事件执行的流程：</p>
<ol>
<li><strong>事件定义</strong>：继承<code>ApplicationEvent</code>创建事件类</li>
<li><strong>监听器注册</strong>：实现<code>ApplicationListener</code>并注册到容器</li>
<li><strong>事件发布</strong>：通过<code>ApplicationEventPublisher.publishEvent()</code>发布</li>
<li><strong>事件广播</strong>：<code>ApplicationEventMulticaster</code>接收事件</li>
<li><strong>监听器匹配</strong>：根据泛型参数匹配感兴趣的监听器</li>
<li><strong>事件处理</strong>：调用匹配监听器的<code>onApplicationEvent()</code>方法</li>
</ol>
<p>2.<strong>如何保证Event处理的事务一致性？</strong></p>
<p>使用事件同步机制，事务提交后执行事务监听器，发送邮件通知等，然后事务回滚的时候发送清理操作</p>
<p>通过@TransactionalEventListener的状态来确定</p>
<p>然后失败之后通过补偿机制。</p>
<h2 id="动态代理">动态代理</h2>
<p>动态代理是我们spring的AOP的</p>
<p>AOP主要就是解耦，他将跟核心业务没关系的业务比如权限，日志等业务的抽离出来，一般都是以注释的形式。然后方法只执行业务核心方法</p>
<p>动态代理分为JDK动态代理和CGLIB动态代理</p>
<p>JDK动态代理基于接口，代理实现了接口的类，在运行时动态生成代理类的字节码。速度较快，不需要生成新的字节码</p>
<p>JdkDynamicAopProxy实现了AopProxy, InvocationHandler</p>
<p>获取代理方式，获取当前线程的context类加载器，然后通知通知添加目标接口。然后执行<em>InvocationHandler实现</em></p>
<p>然后使用Invoke方法，执行代理。检查方法是不是匹配切点表达式，匹配成功后执行方法拦截器，拦截，然后换取我们自己实现的bean。如果不匹配的话，我们就执行原来的方法</p>
<p>CGLIB动态是基于继承目标类生成子类代理，使用了使用ASM字节码技术。除了final都可以代理，速度较慢，需要生成字节码。但是性能较好</p>
<p>get方法是通过设置我们的需要代理的类，然后设置接口，设置回调处理器</p>
</article><div class="post-copyright"><div class="copyright-cc-box"><i class="anzhiyufont anzhiyu-icon-copyright"></i></div><div class="post-copyright__author_box"><a class="post-copyright__author_img" href="/" title="头像"><img class="post-copyright__author_img_back" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://skymirror-1322372781.cos.ap-beijing.myqcloud.com/202407230955363.jpg" title="头像" alt="头像"><img class="post-copyright__author_img_front" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://skymirror-1322372781.cos.ap-beijing.myqcloud.com/202407230955363.jpg" title="头像" alt="头像"></a><div class="post-copyright__author_name">mengnankkzhou</div><div class="post-copyright__author_desc">不要走捏</div></div><div class="post-copyright__post__info"><a class="post-copyright__original" title="该文章为原创文章，注意版权协议" href="https://blog.tokenlen.top/2025/07/19/%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/java-stack/spring3/">原创</a><a class="post-copyright-title"><span onclick="rm.copyPageUrl('https://blog.tokenlen.top/2025/07/19/%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/java-stack/spring3/')">Spring面试题hot2-源码分析</span></a></div><div class="post-tools" id="post-tools"><div class="post-tools-left"><div class="rewardLeftButton"></div><div class="shareRight"><div class="share-link mobile"><div class="share-qrcode"><div class="share-button" title="使用手机访问这篇文章"><i class="anzhiyufont anzhiyu-icon-qrcode"></i></div><div class="share-main"><div class="share-main-all"><div id="qrcode" title="https://blog.tokenlen.top/2025/07/19/%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/java-stack/spring3/"></div><div class="reward-dec">使用手机访问这篇文章</div></div></div></div></div><div class="share-link weibo"><a class="share-button" target="_blank" href="https://service.weibo.com/share/share.php?title=Spring面试题hot2-源码分析&amp;url=https://blog.tokenlen.top/2025/07/19/%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/java-stack/spring3/&amp;pic=https://skymirror-1322372781.cos.ap-beijing.myqcloud.com/202408081510494.jpg?_r_=57d05052-4f6f-e7fd-6fa7-231c0276d639" rel="external nofollow noreferrer noopener"><i class="anzhiyufont anzhiyu-icon-weibo"></i></a></div><script>function copyCurrentPageUrl() {
  var currentPageUrl = window.location.href;
  var input = document.createElement("input");
  input.setAttribute("value", currentPageUrl);
  document.body.appendChild(input);
  input.select();
  input.setSelectionRange(0, 99999);
  document.execCommand("copy");
  document.body.removeChild(input);
}</script><div class="share-link copyurl"><div class="share-button" id="post-share-url" title="复制链接" onclick="copyCurrentPageUrl()"><i class="anzhiyufont anzhiyu-icon-link"></i></div></div></div></div></div><div class="post-copyright__notice"><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://blog.tokenlen.top" target="_blank">mengnankkのblog</a>！</span></div></div><div class="post-tools-right"><div class="tag_share"><div class="post-meta__box"><div class="post-meta__box__category-list"><a class="post-meta__box__categoryes" href="/categories/%E6%8A%80%E6%9C%AF%E6%A0%88/"><span class="categoryes-punctuation"> <i class="anzhiyufont anzhiyu-icon-inbox"></i></span>技术栈<span class="categoryesPageCount">31</span></a></div><div class="post-meta__box__tag-list"><a class="post-meta__box__tags" href="/tags/java/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>java<span class="tagsPageCount">61</span></a><a class="post-meta__box__tags" href="/tags/%E9%9D%A2%E8%AF%95/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>面试<span class="tagsPageCount">46</span></a><a class="post-meta__box__tags" href="/tags/spring/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>spring<span class="tagsPageCount">4</span></a></div></div><div class="post_share"><div class="social-share" data-image="https://skymirror-1322372781.cos.ap-beijing.myqcloud.com/20250126175712179.jpg?_r_=66eda24b-5555-d375-8fb5-ddb70badb349" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"/><script src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer="defer"></script></div></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2025/07/19/%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/leetcode/leetcodetotal2/"><img class="prev-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://skymirror-1322372781.cos.ap-beijing.myqcloud.com/202410051722379.jpg?_r_=1a92002b-156e-32b5-ae62-c2808e497810" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Leetcode HOT面试总结</div></div></a></div><div class="next-post pull-right"><a href="/2025/07/25/%E5%B7%A5%E4%BD%9C/towork/woking2/"><img class="next-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://skymirror-1322372781.cos.ap-beijing.myqcloud.com/20250126175712178.jpg?_r_=0db9a708-2421-6288-4c62-5d662efbfbf5" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">面试面经-1</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="anzhiyufont anzhiyu-icon-thumbs-up fa-fw" style="font-size: 1.5rem; margin-right: 4px"></i><span>喜欢这篇文章的人也看了</span></div><div class="relatedPosts-list"><div><a href="/2025/05/05/%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/java-stack/spring2/" title="Spring面试题hot1"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://skymirror-1322372781.cos.ap-beijing.myqcloud.com/20250126175712181.jpg?_r_=1c1af7e7-24e4-e74f-8c9b-d4e091ac41bb" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-05-05</div><div class="title">Spring面试题hot1</div></div></a></div><div><a href="/2025/09/08/%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/konw/spring-alay/" title="Spring源码分析"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://skymirror-1322372781.cos.ap-beijing.myqcloud.com/20250126175712181.jpg?_r_=c8ff50e7-f761-77de-43f0-80b532eb932a" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-09-08</div><div class="title">Spring源码分析</div></div></a></div><div><a href="/2025/08/15/%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/java-stack/juc3/" title="JUC-源码分析"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://skymirror-1322372781.cos.ap-beijing.myqcloud.com/202407221837602.jpg?_r_=21db0a9e-f058-ac9b-ea7c-923bbddb8fff" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-08-15</div><div class="title">JUC-源码分析</div></div></a></div><div><a href="/2025/08/12/%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/javase/javase4/" title="javase面试-深入源码"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://skymirror-1322372781.cos.ap-beijing.myqcloud.com/20250126175712179.jpg?_r_=6a35ec85-015c-0ccd-d657-8fa8a89fa7a2" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-08-12</div><div class="title">javase面试-深入源码</div></div></a></div><div><a href="/2025/06/21/%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/javase/javaweb1/" title="javase面试题目hot2web开发"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://skymirror-1322372781.cos.ap-beijing.myqcloud.com/202407221837601.jpeg?_r_=d625376b-2a04-95f5-788b-40a9c964e70d" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-06-21</div><div class="title">javase面试题目hot2web开发</div></div></a></div><div><a href="/2025/05/27/%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/java-stack/javasample1/" title="JAVA设计模式面试题目hot"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://skymirror-1322372781.cos.ap-beijing.myqcloud.com/202408081510095.jpg?_r_=9df9a6dc-2888-06cf-a77f-fa7bfdd0bfe3" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-05-27</div><div class="title">JAVA设计模式面试题目hot</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="anzhiyufont anzhiyu-icon-comments"></i><span> 评论</span></div><div class="comment-randomInfo"><a onclick="anzhiyu.addRandomCommentInfo()" href="javascript:void(0)">匿名评论</a><a href="/privacy" style="margin-left: 4px">隐私政策</a></div><div class="comment-switch"><span class="first-comment">Twikoo</span><span id="switch-btn"></span><span class="second-comment">Valine</span></div><div class="comment-tips" id="comment-tips"><span>✅ 你无需删除空行，直接评论以获取最佳展示效果</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div><div><div class="vcomment" id="vcomment"></div></div></div></div><div class="comment-barrage"></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-content"><div class="author-info__sayhi" id="author-info__sayhi" onclick="anzhiyu.changeSayHelloText()"></div><div class="author-info-avatar"><img class="avatar-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://skymirror-1322372781.cos.ap-beijing.myqcloud.com/202407230955363.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-status"><img class="g-status" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/08/24/64e6ce9c507bb.png" alt="status"/></div></div><div class="author-info__description">清风拂柳影，碧水映花香。</div><div class="author-info__bottom-group"><a class="author-info__bottom-group-left" href="/"><h1 class="author-info__name">mengnankkzhou</h1><div class="author-info__desc">不要走捏</div></a><div class="card-info-social-icons is-center"><a class="social-icon faa-parent animated-hover" href="https://github.com/mengnankkkk" target="_blank" title="Github"><i class="anzhiyufont anzhiyu-icon-github"></i></a><a class="social-icon faa-parent animated-hover" href="https://space.bilibili.com/440831872" target="_blank" title="BiliBili"><i class="anzhiyufont anzhiyu-icon-bilibili"></i></a></div></div></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bullhorn anzhiyu-shake"></i><span>公告</span></div><div class="announcement_content">欢迎来看我的博客鸭~</div></div><div class="card-widget anzhiyu-right-widget" id="card-wechat" onclick="null"><div id="flip-wrapper"><div id="flip-content"><div class="face" style="background: url(https://bu.dusays.com/2023/01/13/63c02edf44033.png) center center / 100% no-repeat"></div><div class="back face" style="background: url(https://skymirror-1322372781.cos.ap-beijing.myqcloud.com/202410021212939.jpg) center center / 100% no-repeat"></div></div></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bars"></i><span>文章目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">1.</span> <span class="toc-text">基础</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E4%BB%80%E4%B9%88%E6%98%AF-IOC%EF%BC%9F"><span class="toc-number">1.1.</span> <span class="toc-text">1.什么是 IOC？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E4%BB%80%E4%B9%88%E6%98%AFspring-Aop"><span class="toc-number">1.2.</span> <span class="toc-text">2.什么是spring Aop</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-spring%E7%9A%84%E5%B8%B8%E7%94%A8%E6%B3%A8%E8%A7%A3"><span class="toc-number">1.3.</span> <span class="toc-text">3.spring的常用注解</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-Bean"><span class="toc-number">1.4.</span> <span class="toc-text">4.@Bean</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-spring%E4%BA%8B%E5%8A%A1"><span class="toc-number">1.5.</span> <span class="toc-text">5.spring事务</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-spring-MVC"><span class="toc-number">1.6.</span> <span class="toc-text">6.spring MVC</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-springboot"><span class="toc-number">1.7.</span> <span class="toc-text">7.springboot</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">2.</span> <span class="toc-text">spring源码分析</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#bean"><span class="toc-number">2.1.</span> <span class="toc-text">bean</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F"><span class="toc-number">2.2.</span> <span class="toc-text">设计模式</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%AE%9E%E4%BE%8B%E5%8C%96"><span class="toc-number">2.3.</span> <span class="toc-text">实例化</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%B3%A8%E5%85%A5"><span class="toc-number">2.4.</span> <span class="toc-text">注入</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#bean%E7%AE%A1%E7%90%86"><span class="toc-number">2.5.</span> <span class="toc-text">bean管理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#bean%E7%BB%84%E4%BB%B6%E7%9A%84%E6%89%A9%E5%B1%95"><span class="toc-number">2.6.</span> <span class="toc-text">bean组件的扩展</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#bean%E7%9A%84%E5%88%9D%E5%A7%8B%E5%8C%96%E5%92%8C%E9%94%80%E6%AF%81"><span class="toc-number">2.7.</span> <span class="toc-text">bean的初始化和销毁</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Aware"><span class="toc-number">2.8.</span> <span class="toc-text">Aware</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#FactoryBean-Bean%E7%9A%84%E4%BD%9C%E7%94%A8%E5%9F%9F"><span class="toc-number">2.9.</span> <span class="toc-text">FactoryBean&amp;Bean的作用域</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BA%8B%E4%BB%B6"><span class="toc-number">2.10.</span> <span class="toc-text">事件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%8A%A8%E6%80%81%E4%BB%A3%E7%90%86"><span class="toc-number">2.11.</span> <span class="toc-text">动态代理</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-history"></i><span>最近发布</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2025/10/09/%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/konw/log/" title="日志系统设计"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://skymirror-1322372781.cos.ap-beijing.myqcloud.com/20250126175712179.jpg?_r_=66eda24b-5555-d375-8fb5-ddb70badb349" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="日志系统设计"/></a><div class="content"><a class="title" href="/2025/10/09/%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/konw/log/" title="日志系统设计">日志系统设计</a><time datetime="2025-10-08T16:00:00.000Z" title="发表于 2025-10-09 00:00:00">2025-10-09</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/09/25/%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/new-stack/k8s1/" title="K8S"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://skymirror-1322372781.cos.ap-beijing.myqcloud.com/202408081510494.jpg?_r_=583d114a-88aa-be90-8598-c951d2856168" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="K8S"/></a><div class="content"><a class="title" href="/2025/09/25/%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/new-stack/k8s1/" title="K8S">K8S</a><time datetime="2025-09-24T16:00:00.000Z" title="发表于 2025-09-25 00:00:00">2025-09-25</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/09/25/%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/pro/k8s/" title="k8s八股分析"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://skymirror-1322372781.cos.ap-beijing.myqcloud.com/202407221811725.jpeg?_r_=d1375943-681f-fc68-adc6-cae65f70b708" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="k8s八股分析"/></a><div class="content"><a class="title" href="/2025/09/25/%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/pro/k8s/" title="k8s八股分析">k8s八股分析</a><time datetime="2025-09-24T16:00:00.000Z" title="发表于 2025-09-25 00:00:00">2025-09-25</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/09/24/%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/pro/cap/" title="分布式八股分析"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://skymirror-1322372781.cos.ap-beijing.myqcloud.com/202407221837447.jpg?_r_=388a2148-b95c-744b-57b3-25aa79d4e194" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="分布式八股分析"/></a><div class="content"><a class="title" href="/2025/09/24/%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/pro/cap/" title="分布式八股分析">分布式八股分析</a><time datetime="2025-09-23T16:00:00.000Z" title="发表于 2025-09-24 00:00:00">2025-09-24</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/09/24/%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/pro/aicode/" title="aicode八股分析"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://skymirror-1322372781.cos.ap-beijing.myqcloud.com/202410051722380.jpg?_r_=6131513e-5917-371f-05ad-63bc31e37440" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="aicode八股分析"/></a><div class="content"><a class="title" href="/2025/09/24/%E7%9F%A5%E8%AF%86%E6%95%B4%E7%90%86/pro/aicode/" title="aicode八股分析">aicode八股分析</a><time datetime="2025-09-23T16:00:00.000Z" title="发表于 2025-09-24 00:00:00">2025-09-24</time></div></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="footer_custom_text"><p><a style="margin-inline:5px" target="_blank" href="https://hexo.io/">
  <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shields.io/badge/Framework-Hexo-4e88f8?style=flat&logo=hexo" 
       title="博客框架为 Hexo" alt="Hexo">
</a>
<a style="margin-inline:5px" target="_blank" href="https://github.com/">
  <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shields.io/badge/Source-Github-24292f?style=flat&logo=github" 
       title="本站项目由 GitHub 托管" alt="GitHub">
</a>
<a style="margin-inline:5px" target="_blank" href="https://vercel.com/">
  <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shields.io/badge/Cloud-Vercel-000000?style=flat&logo=vercel" 
       title="使用 Vercel 部署" alt="Vercel">
</a>
<a style="margin-inline:5px" target="_blank" href="https://www.qlu.edu.cn/">
  <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shields.io/badge/University-齐鲁工业大学-0056a2?style=flat&logo=university" 
       title="齐鲁工业大学" alt="齐鲁工业大学">
</a>
<a style="margin-inline:5px" target="_blank" href="https://www.aliyun.com/">
  <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shields.io/badge/Cloud-阿里云-ff6a00?style=flat&logo=aliyun" 
       title="使用阿里云服务" alt="阿里云">
</a>
<a style="margin-inline:5px" target="_blank" href="https://cloud.tencent.com/">
  <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shields.io/badge/Cloud-腾讯云-0a73b8?style=flat&logo=tencent-cloud" 
       title="使用腾讯云服务" alt="腾讯云">
</a></p>
</div></div><div id="footer-bar"><div class="footer-bar-links"><div class="footer-bar-left"><div id="footer-bar-tips"><div class="copyright">&copy;2023 - 2025 By <a class="footer-bar-link" href="/" title="mengnankkzhou" target="_blank">mengnankkzhou</a></div></div><div id="footer-type-tips"></div></div><div class="footer-bar-right"><a class="footer-bar-link" target="_blank" rel="noopener" href="https://beian.miit.gov.cn/" title="鲁ICP备2024110758号">鲁ICP备2024110758号</a><a class="footer-bar-link" href="https://blog.tokenlen.top/rss2.xml" title="Rss">Rss</a><a class="footer-bar-link cc" href="/pravite" title="cc协议"><i class="anzhiyufont anzhiyu-icon-copyright-line"></i><i class="anzhiyufont anzhiyu-icon-creative-commons-by-line"></i><i class="anzhiyufont anzhiyu-icon-creative-commons-nc-line"></i><i class="anzhiyufont anzhiyu-icon-creative-commons-nd-line"></i></a></div></div></div></footer></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="sidebar-site-data site-data is-center"><a href="/archives/" title="archive"><div class="headline">文章</div><div class="length-num">192</div></a><a href="/tags/" title="tag"><div class="headline">标签</div><div class="length-num">56</div></a><a href="/categories/" title="category"><div class="headline">分类</div><div class="length-num">26</div></a></div><span class="sidebar-menu-item-title">功能</span><div class="sidebar-menu-item"><a class="darkmode_switchbutton menu-child" href="javascript:void(0);" title="显示模式"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span>显示模式</span></a></div><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" href="https://blog.tokenlen.top/" title="博客"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="博客"/><span class="back-menu-item-text">博客</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="http://img.mengnankk.top:9001/" title="图床"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="图床"/><span class="back-menu-item-text">图床</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">项目</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="http://img.mengnankk.top:9001/" title="mengnankk图床"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/08/13/64d8c2653332e.ico" alt="mengnankk图床"/><span class="back-menu-item-text">mengnankk图床</span></a></div></div></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size: 0.9em;"></i><span> 隧道</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 生活</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/album/"><i class="anzhiyufont anzhiyu-icon-images faa-tada" style="font-size: 0.9em;"></i><span> 相册集</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/essay/"><i class="anzhiyufont anzhiyu-icon-lightbulb faa-tada" style="font-size: 0.9em;"></i><span> 闲言碎语</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/music/"><i class="anzhiyufont anzhiyu-icon-music faa-tada" style="font-size: 0.9em;"></i><span> 音乐馆</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 我的</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><i class="anzhiyufont anzhiyu-icon-link faa-tada" style="font-size: 0.9em;"></i><span> 友人帐</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size: 0.9em;"></i><span> 关于本人</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/Message/"><i class="anzhiyufont anzhiyu-icon-envelope faa-tada" style="font-size: 0.9em;"></i><span> 留言</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 其他</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" target="_blank" rel="noopener" href="https://home.tokenlen.top/"><i class="anzhiyufont anzhiyu-icon-envelope faa-tada" style="font-size: 0.9em;"></i><span> home</span></a></li><li><a class="site-page child faa-parent animated-hover" target="_blank" rel="noopener" href="https://status.mengnankk.asia/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 站点检测</span></a></li><li><a class="site-page child faa-parent animated-hover" target="_blank" rel="noopener" href="https://home.tokenlen.top/"><i class="anzhiyufont anzhiyu-icon-lightbulb faa-tada" style="font-size: 0.9em;"></i><span> 心里话</span></a></li></ul></div></div><span class="sidebar-menu-item-title">标签</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/BF/" style="font-size: 0.88rem;">BF<sup>1</sup></a><a href="/tags/BigData/" style="font-size: 0.88rem;">BigData<sup>1</sup></a><a href="/tags/C/" style="font-size: 0.88rem;">C<sup>4</sup></a><a href="/tags/CE/" style="font-size: 0.88rem;">CE<sup>1</sup></a><a href="/tags/CSRF/" style="font-size: 0.88rem;">CSRF<sup>1</sup></a><a href="/tags/English/" style="font-size: 0.88rem;">English<sup>9</sup></a><a href="/tags/FI/" style="font-size: 0.88rem;">FI<sup>1</sup></a><a href="/tags/Go/" style="font-size: 0.88rem;">Go<sup>1</sup></a><a href="/tags/Hadoop/" style="font-size: 0.88rem;">Hadoop<sup>1</sup></a><a href="/tags/Linux/" style="font-size: 0.88rem;">Linux<sup>12</sup></a><a href="/tags/XSS/" style="font-size: 0.88rem;">XSS<sup>1</sup></a><a href="/tags/css/" style="font-size: 0.88rem;">css<sup>2</sup></a><a href="/tags/football/" style="font-size: 0.88rem;">football<sup>1</sup></a><a href="/tags/html/" style="font-size: 0.88rem;">html<sup>1</sup></a><a href="/tags/java/" style="font-size: 0.88rem;">java<sup>61</sup></a><a href="/tags/juc/" style="font-size: 0.88rem;">juc<sup>2</sup></a><a href="/tags/jvm/" style="font-size: 0.88rem;">jvm<sup>2</sup></a><a href="/tags/leetcode/" style="font-size: 0.88rem;">leetcode<sup>10</sup></a><a href="/tags/markdown/" style="font-size: 0.88rem;">markdown<sup>1</sup></a><a href="/tags/mysql/" style="font-size: 0.88rem;">mysql<sup>17</sup></a><a href="/tags/net/" style="font-size: 0.88rem;">net<sup>7</sup></a><a href="/tags/paper/" style="font-size: 0.88rem;">paper<sup>1</sup></a><a href="/tags/php/" style="font-size: 0.88rem;">php<sup>5</sup></a><a href="/tags/pip/" style="font-size: 0.88rem;">pip<sup>1</sup></a><a href="/tags/python/" style="font-size: 0.88rem;">python<sup>3</sup></a><a href="/tags/redis/" style="font-size: 0.88rem;">redis<sup>4</sup></a><a href="/tags/shell/" style="font-size: 0.88rem;">shell<sup>4</sup></a><a href="/tags/spring/" style="font-size: 0.88rem;">spring<sup>4</sup></a><a href="/tags/spring-boot/" style="font-size: 0.88rem;">spring boot<sup>14</sup></a><a href="/tags/sql/" style="font-size: 0.88rem;">sql<sup>5</sup></a><a href="/tags/web/" style="font-size: 0.88rem;">web<sup>3</sup></a><a href="/tags/%E5%8E%8B%E6%B5%8B/" style="font-size: 0.88rem;">压测<sup>1</sup></a><a href="/tags/%E6%95%B0%E5%AD%97%E9%80%BB%E8%BE%91/" style="font-size: 0.88rem;">数字逻辑<sup>1</sup></a><a href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93%E5%8E%9F%E7%90%86/" style="font-size: 0.88rem;">数据库原理<sup>3</sup></a><a href="/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" style="font-size: 0.88rem;">数据结构<sup>20</sup></a><a href="/tags/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/" style="font-size: 0.88rem;">正则表达式<sup>2</sup></a><a href="/tags/%E6%AF%9B%E9%80%89/" style="font-size: 0.88rem;">毛选<sup>1</sup></a><a href="/tags/%E6%B1%87%E7%BC%96%E8%AF%AD%E8%A8%80/" style="font-size: 0.88rem;">汇编语言<sup>1</sup></a><a href="/tags/%E7%AE%97%E6%B3%95/" style="font-size: 0.88rem;">算法<sup>9</sup></a><a href="/tags/%E9%9D%A2%E8%AF%95/" style="font-size: 0.88rem;">面试<sup>46</sup></a></div></div><hr/></div></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="anzhiyufont anzhiyu-icon-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="anzhiyufont anzhiyu-icon-gear"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="anzhiyufont anzhiyu-icon-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="anzhiyufont anzhiyu-icon-comments"></i></a><a id="switch-commentBarrage" href="javascript:anzhiyu.switchCommentBarrage();" title="开关弹幕"><i class="anzhiyufont anzhiyu-icon-danmu"></i></a><button id="go-up" type="button" title="回到顶部"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><div id="nav-music"><a id="nav-music-hoverTips" onclick="anzhiyu.musicToggle()" accesskey="m">播放音乐</a><div id="console-music-bg"></div><meting-js id="8152976493" server="netease" type="playlist" mutex="true" preload="none" theme="var(--anzhiyu-main)" data-lrctype="0" order="random" volume="0.7"></meting-js></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="anzhiyufont anzhiyu-icon-xmark"></i></button></nav><div class="is-center" id="loading-database"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-pulse-icon"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><div class="rightMenu-item" id="menu-backward"><i class="anzhiyufont anzhiyu-icon-arrow-left"></i></div><div class="rightMenu-item" id="menu-forward"><i class="anzhiyufont anzhiyu-icon-arrow-right"></i></div><div class="rightMenu-item" id="menu-refresh"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right" style="font-size: 1rem;"></i></div><div class="rightMenu-item" id="menu-top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></div></div><div class="rightMenu-group rightMenu-line rightMenuPlugin"><div class="rightMenu-item" id="menu-copytext"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制选中文本</span></div><div class="rightMenu-item" id="menu-pastetext"><i class="anzhiyufont anzhiyu-icon-paste"></i><span>粘贴文本</span></div><a class="rightMenu-item" id="menu-commenttext"><i class="anzhiyufont anzhiyu-icon-comment-medical"></i><span>引用到评论</span></a><div class="rightMenu-item" id="menu-newwindow"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开</span></div><div class="rightMenu-item" id="menu-copylink"><i class="anzhiyufont anzhiyu-icon-link"></i><span>复制链接地址</span></div><div class="rightMenu-item" id="menu-copyimg"><i class="anzhiyufont anzhiyu-icon-images"></i><span>复制此图片</span></div><div class="rightMenu-item" id="menu-downloadimg"><i class="anzhiyufont anzhiyu-icon-download"></i><span>下载此图片</span></div><div class="rightMenu-item" id="menu-newwindowimg"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开图片</span></div><div class="rightMenu-item" id="menu-search"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>站内搜索</span></div><div class="rightMenu-item" id="menu-searchBaidu"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>百度搜索</span></div><div class="rightMenu-item" id="menu-music-toggle"><i class="anzhiyufont anzhiyu-icon-play"></i><span>播放音乐</span></div><div class="rightMenu-item" id="menu-music-back"><i class="anzhiyufont anzhiyu-icon-backward"></i><span>切换到上一首</span></div><div class="rightMenu-item" id="menu-music-forward"><i class="anzhiyufont anzhiyu-icon-forward"></i><span>切换到下一首</span></div><div class="rightMenu-item" id="menu-music-playlist" onclick="window.open(&quot;https://y.qq.com/n/ryqq/playlist/8802438608&quot;, &quot;_blank&quot;);" style="display: none;"><i class="anzhiyufont anzhiyu-icon-radio"></i><span>查看所有歌曲</span></div><div class="rightMenu-item" id="menu-music-copyMusicName"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制歌名</span></div></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item menu-link" id="menu-randomPost"><i class="anzhiyufont anzhiyu-icon-shuffle"></i><span>随便逛逛</span></a><a class="rightMenu-item menu-link" href="/categories/"><i class="anzhiyufont anzhiyu-icon-cube"></i><span>博客分类</span></a><a class="rightMenu-item menu-link" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags"></i><span>文章标签</span></a></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item" id="menu-copy" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制地址</span></a><a class="rightMenu-item" id="menu-commentBarrage" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-message"></i><span class="menu-commentBarrage-text">关闭热评</span></a><a class="rightMenu-item" id="menu-darkmode" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span class="menu-darkmode-text">深色模式</span></a><a class="rightMenu-item" id="menu-translate" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-language"></i><span>轉為繁體</span></a></div></div><div id="rightmenu-mask"></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.umd.js"></script><script src="https://cdn.cbd.int/instant.page@5.2.0/instantpage.js" type="module"></script><script src="https://cdn.cbd.int/vanilla-lazyload@17.8.5/dist/lazyload.iife.min.js"></script><script src="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.js"></script><script>function panguFn () {
  if (typeof pangu === 'object') pangu.autoSpacingPage()
  else {
    getScript('https://cdn.cbd.int/pangu@4.0.7/dist/browser/pangu.min.js')
      .then(() => {
        pangu.autoSpacingPage()
      })
  }
}

function panguInit () {
  if (true){
    GLOBAL_CONFIG_SITE.isPost && panguFn()
  } else {
    panguFn()
  }
}

document.addEventListener('DOMContentLoaded', panguInit)</script><canvas id="universe"></canvas><script async src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/dark/dark.js"></script><script>// 消除控制台打印
var HoldLog = console.log;
console.log = function () {};
let now1 = new Date();
queueMicrotask(() => {
  const Log = function () {
    HoldLog.apply(console, arguments);
  }; //在恢复前输出日志
  const grt = new Date("04/01/2021 00:00:00"); //此处修改你的建站时间或者网站上线时间
  now1.setTime(now1.getTime() + 250);
  const days = (now1 - grt) / 1000 / 60 / 60 / 24;
  const dnum = Math.floor(days);
  const ascll = [
    `欢迎使用安知鱼!`,
    `生活明朗, 万物可爱`,
    `
        
       █████╗ ███╗   ██╗███████╗██╗  ██╗██╗██╗   ██╗██╗   ██╗
      ██╔══██╗████╗  ██║╚══███╔╝██║  ██║██║╚██╗ ██╔╝██║   ██║
      ███████║██╔██╗ ██║  ███╔╝ ███████║██║ ╚████╔╝ ██║   ██║
      ██╔══██║██║╚██╗██║ ███╔╝  ██╔══██║██║  ╚██╔╝  ██║   ██║
      ██║  ██║██║ ╚████║███████╗██║  ██║██║   ██║   ╚██████╔╝
      ╚═╝  ╚═╝╚═╝  ╚═══╝╚══════╝╚═╝  ╚═╝╚═╝   ╚═╝    ╚═════╝
        
        `,
    "已上线",
    dnum,
    "天",
    "©2023 By 安知鱼 V1.6.12",
  ];
  const ascll2 = [`NCC2-036`, `调用前置摄像头拍照成功，识别为【小笨蛋】.`, `Photo captured: `, `🤪`];

  setTimeout(
    Log.bind(
      console,
      `\n%c${ascll[0]} %c ${ascll[1]} %c ${ascll[2]} %c${ascll[3]}%c ${ascll[4]}%c ${ascll[5]}\n\n%c ${ascll[6]}\n`,
      "color:#425AEF",
      "",
      "color:#425AEF",
      "color:#425AEF",
      "",
      "color:#425AEF",
      ""
    )
  );
  setTimeout(
    Log.bind(
      console,
      `%c ${ascll2[0]} %c ${ascll2[1]} %c \n${ascll2[2]} %c\n${ascll2[3]}\n`,
      "color:white; background-color:#4fd953",
      "",
      "",
      'background:url("https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/tinggge.gif") no-repeat;font-size:450%'
    )
  );

  setTimeout(Log.bind(console, "%c WELCOME %c 你好，小笨蛋.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(
      console,
      "%c ⚡ Powered by 安知鱼 %c 你正在访问 mengnankkzhou 的博客.",
      "color:white; background-color:#f0ad4e",
      ""
    )
  );

  setTimeout(Log.bind(console, "%c W23-12 %c 你已打开控制台.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(console, "%c S013-782 %c 你现在正处于监控中.", "color:white; background-color:#d9534f", "")
  );
});</script><script async src="/anzhiyu/random.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>if (!window.MathJax) {
  window.MathJax = {
    tex: {
      inlineMath: [['$', '$'], ['\\(', '\\)']],
      tags: 'ams'
    },
    chtml: {
      scale: 1.1
    },
    options: {
      renderActions: {
        findScript: [10, doc => {
          for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
            const display = !!node.type.match(/; *mode=display/)
            const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display)
            const text = document.createTextNode('')
            node.parentNode.replaceChild(text, node)
            math.start = {node: text, delim: '', n: 0}
            math.end = {node: text, delim: '', n: 0}
            doc.math.push(math)
          }
        }, '']
      }
    }
  }
  
  const script = document.createElement('script')
  script.src = 'https://cdn.cbd.int/mathjax@3.2.2/es5/tex-mml-chtml.js'
  script.id = 'MathJax-script'
  script.async = true
  document.head.appendChild(script)
} else {
  MathJax.startup.document.state(0)
  MathJax.texReset()
  MathJax.typesetPromise()
}</script><script>(() => {
  const init = () => {
    twikoo.init(Object.assign({
      el: '#twikoo-wrap',
      envId: 'https://comment.tokenlen.top/',
      region: '',
      onCommentLoaded: () => {
        anzhiyu.loadLightbox(document.querySelectorAll('#twikoo .tk-content img:not(.tk-owo-emotion)'))
      }
    }, "siu~~~~~"))
  }

  const loadTwikoo = () => {
    if (typeof twikoo === 'object') setTimeout(runFn,0)
    else getScript('https://cdn.cbd.int/twikoo@1.6.25/dist/twikoo.all.min.js').then(runFn)
  }

  const getCount = () => {
    const countELement = document.getElementById('twikoo-count')
    if(!countELement) return
    twikoo.getCommentsCount({
      envId: 'https://comment.tokenlen.top/',
      region: '',
      urls: [window.location.pathname],
      includeReply: false
    }).then(res => {
      countELement.textContent = res[0].count
    }).catch(err => {
      console.error(err)
    })
  }

  const runFn = () => {
    init();
    
  }

  if ('Twikoo' === 'Twikoo' || !false) {
    if (false) anzhiyu.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else {
      loadTwikoo()
    }
  } else {
    window.loadOtherComment = loadTwikoo
  }
})()</script><script>(() => {
  const initValine = () => {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: '3ZpuzQHHKWfFH59QFYmcuCvr-gzGzoHsz',
      appKey: '8DIvljObQp853ueQMZzpb9Gx',
      avatar: 'mp',
      serverURLs: '',
      emojiMaps: "",
      path: window.location.pathname,
      visitor: false
    }, null))
  }

  const loadValine = async () => {
    if (typeof Valine === 'function') initValine()
    else {
      await getScript('https://cdn.cbd.int/valine@1.5.1/dist/Valine.min.js')
      initValine()
    }
  }

  if ('Twikoo' === 'Valine' || !false) {
    if (false) anzhiyu.loadComment(document.getElementById('vcomment'),loadValine)
    else setTimeout(loadValine, 0)
  } else {
    window.loadOtherComment = loadValine
  }
})()</script><input type="hidden" name="page-type" id="page-type" value="post"></div><script>window.addEventListener('load', () => {
  const changeContent = (content) => {
    if (content === '') return content

    content = content.replace(/<img.*?src="(.*?)"?[^\>]+>/ig, '[图片]') // replace image link
    content = content.replace(/<a[^>]+?href=["']?([^"']+)["']?[^>]*>([^<]+)<\/a>/gi, '[链接]') // replace url
    content = content.replace(/<pre><code>.*?<\/pre>/gi, '[代码]') // replace code
    content = content.replace(/<[^>]+>/g,"") // remove html tag

    if (content.length > 150) {
      content = content.substring(0,150) + '...'
    }
    return content
  }

  const getComment = () => {
    const runTwikoo = () => {
      twikoo.getRecentComments({
        envId: 'https://comment.tokenlen.top/',
        region: '',
        pageSize: 6,
        includeReply: true
      }).then(function (res) {
        const twikooArray = res.map(e => {
          return {
            'content': changeContent(e.comment),
            'avatar': e.avatar,
            'nick': e.nick,
            'url': e.url + '#' + e.id,
            'date': new Date(e.created).toISOString()
          }
        })

        saveToLocal.set('twikoo-newest-comments', JSON.stringify(twikooArray), 10/(60*24))
        generateHtml(twikooArray)
      }).catch(function (err) {
        const $dom = document.querySelector('#card-newest-comments .aside-list')
        $dom.textContent= "无法获取评论，请确认相关配置是否正确"
      })
    }

    if (typeof twikoo === 'object') {
      runTwikoo()
    } else {
      getScript('https://cdn.cbd.int/twikoo@1.6.25/dist/twikoo.all.min.js').then(runTwikoo)
    }
  }

  const generateHtml = array => {
    let result = ''

    if (array.length) {
      for (let i = 0; i < array.length; i++) {
        result += '<div class=\'aside-list-item\'>'

        if (true) {
          const name = 'data-lazy-src'
          result += `<a href='${array[i].url}' class='thumbnail'><img ${name}='${array[i].avatar}' alt='${array[i].nick}'><div class='name'><span>${array[i].nick} </span></div></a>`
        }
        
        result += `<div class='content'>
        <a class='comment' href='${array[i].url}' title='${array[i].content}'>${array[i].content}</a>
        <time datetime="${array[i].date}">${anzhiyu.diffDate(array[i].date, true)}</time></div>
        </div>`
      }
    } else {
      result += '没有评论'
    }

    let $dom = document.querySelector('#card-newest-comments .aside-list')
    $dom && ($dom.innerHTML= result)
    window.lazyLoadInstance && window.lazyLoadInstance.update()
    window.pjax && window.pjax.refresh($dom)
  }

  const newestCommentInit = () => {
    if (document.querySelector('#card-newest-comments .aside-list')) {
      const data = saveToLocal.get('twikoo-newest-comments')
      if (data) {
        generateHtml(JSON.parse(data))
      } else {
        getComment()
      }
    }
  }

  newestCommentInit()
  document.addEventListener('pjax:complete', newestCommentInit)
})</script><script async data-pjax src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.1/bubble/bubble.js"></script><script>var visitorMail = "";
</script><script async data-pjax src="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/waterfall/waterfall.js"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/qrcodejs/1.0.0/qrcode.min.js"></script><script src="/js/anzhiyu/right_click_menu.js"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.9/icon/ali_iconfont_css.css"><script defer="defer" id="fluttering_ribbon" mobile="true" src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/dist/canvas-fluttering-ribbon.min.js"></script><script id="click-show-text" src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/dist/click-show-text.min.js" data-mobile="false" data-text="I,LOVE,YOU" data-fontsize="15px" data-random="false" async="async"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/aplayer/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.cbd.int/anzhiyu-blog-static@1.0.1/js/APlayer.min.js"></script><script src="https://cdn.cbd.int/hexo-anzhiyu-music@1.0.1/assets/js/Meting2.min.js"></script><script src="https://cdn.cbd.int/pjax@0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["meta[property=\"og:image\"]","meta[property=\"og:title\"]","meta[property=\"og:url\"]","meta[property=\"og:type\"]","meta[property=\"og:site_name\"]","meta[property=\"og:description\"]","head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]
var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {
  // removeEventListener scroll 
  anzhiyu.removeGlobalFnEvent('pjax')
  anzhiyu.removeGlobalFnEvent('themeChange')

  document.getElementById('rightside').classList.remove('rightside-show')
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script charset="UTF-8" src="https://cdn.cbd.int/anzhiyu-theme-static@1.1.5/accesskey/accesskey.js"></script></div><div id="popup-window"><div class="popup-window-title">通知</div><div class="popup-window-divider"></div><div class="popup-window-content"><div class="popup-tip">你好呀</div><div class="popup-link"><i class="anzhiyufont anzhiyu-icon-arrow-circle-right"></i></div></div></div></body></html>