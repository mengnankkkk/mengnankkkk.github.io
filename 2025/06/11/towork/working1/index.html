<!DOCTYPE html><html lang="zh-CN" data-theme="dark"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"><title>面试模拟-202506 | mengnankkのblog</title><meta name="keywords" content="面试"><meta name="author" content="mengnankkzhou"><meta name="copyright" content="mengnankkzhou"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#18171d"><meta name="mobile-web-app-capable" content="yes"><meta name="apple-touch-fullscreen" content="yes"><meta name="apple-mobile-web-app-title" content="面试模拟-202506"><meta name="application-name" content="面试模拟-202506"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-status-bar-style" content="#18171d"><meta property="og:type" content="article"><meta property="og:title" content="面试模拟-202506"><meta property="og:url" content="https://blog.tokenlen.top/2025/06/11/towork/working1/index.html"><meta property="og:site_name" content="mengnankkのblog"><meta property="og:description" content="6.11模拟面试 1.什么是 Java 的面向对象编程？它的核心特性有哪些？ 面向对象编程是OOP是说就是用“对象”来组织代码，java就是一门面向对象编程的语言。 java的面向对象的三大特征是封装继承多态 封装：反射，修饰符 继承：构造方法调用，final 多态：方法重载，方法重写 抽象：抽象和"><meta property="og:locale" content="zh-CN"><meta property="og:image" content="https://skymirror-1322372781.cos.ap-beijing.myqcloud.com/20250126175712180.jpg?_r_=62b12b1e-027e-0455-7412-733e5fa8ad41"><meta property="article:author" content="mengnankkzhou"><meta property="article:tag"><meta name="twitter:card" content="summary"><meta name="twitter:image" content="https://skymirror-1322372781.cos.ap-beijing.myqcloud.com/20250126175712180.jpg?_r_=62b12b1e-027e-0455-7412-733e5fa8ad41"><meta name="description" content="6.11模拟面试 1.什么是 Java 的面向对象编程？它的核心特性有哪些？ 面向对象编程是OOP是说就是用“对象”来组织代码，java就是一门面向对象编程的语言。 java的面向对象的三大特征是封装继承多态 封装：反射，修饰符 继承：构造方法调用，final 多态：方法重载，方法重写 抽象：抽象和"><link rel="shortcut icon" href="/favicon.ico"><link rel="canonical" href="https://blog.tokenlen.top/2025/06/11/towork/working1/"><link rel="preconnect" href="//cdn.cbd.int"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><meta name="google-site-verification" content="xxx"/><meta name="baidu-site-verification" content="code-xxx"/><meta name="msvalidate.01" content="xxx"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/swiper/swiper.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = {
  linkPageTop: undefined,
  peoplecanvas: undefined,
  postHeadAiDescription: {"enable":true,"gptName":"AnZhiYu","mode":"local","switchBtn":false,"btnLink":"https://afdian.net/item/886a79d4db6711eda42a52540025c377","randomNum":3,"basicWordCount":1000,"key":"xxxx","Referer":"https://xx.xx/"},
  diytitle: {"enable":true,"leaveTitle":"w(ﾟДﾟ)w 不要走啊，那种事情不要啊","backTitle":"♪(^∇^*)欢迎回家！！！！"},
  LA51: undefined,
  greetingBox: {"enable":"ture","default":"晚上好👋","list":[{"greeting":"晚安😴","startTime":0,"endTime":5},{"greeting":"早上好鸭👋, 祝你一天好心情！","startTime":6,"endTime":9},{"greeting":"上午好👋, 状态很好，鼓励一下～","startTime":10,"endTime":10},{"greeting":"11点多啦, 在坚持一下就吃饭啦～","startTime":11,"endTime":11},{"greeting":"午安👋, 宝贝","startTime":12,"endTime":14},{"greeting":"🌈充实的一天辛苦啦！","startTime":14,"endTime":18},{"greeting":"19点喽, 奖励一顿丰盛的大餐吧🍔。","startTime":19,"endTime":19},{"greeting":"晚上好👋, 在属于自己的时间好好放松😌~","startTime":20,"endTime":24}]},
  twikooEnvId: 'https://comment.tokenlen.top/',
  commentBarrageConfig:{"enable":true,"maxBarrage":1,"barrageTime":4000,"accessToken":"\tbd9428de12b54b96b2f1b4e69aeee81f","mailMd5":"F37442226DA71492"},
  root: '/',
  preloader: {"source":3},
  friends_vue_info: undefined,
  navMusic: true,
  mainTone: undefined,
  authorStatus: {"skills":["🤖️ 数码科技爱好者","🔍 分享与热心帮助","🏠 智能家居小能手","🔨 设计开发一条龙","🤝 专修交互与设计","🏃 脚踏实地行动派","🧱 团队小组发动机","💢 壮汉人狠话不多"]},
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: {"defaultEncoding":2,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简","rightMenuMsgToTraditionalChinese":"转为繁体","rightMenuMsgToSimplifiedChinese":"转为简体"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlight.js","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":330},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: true,
    simplehomepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"copy":true,"copyrightEbable":false,"limitCount":50,"languages":{"author":"作者: mengnankkzhou","link":"链接: ","source":"来源: mengnankkのblog","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。","copySuccess":"复制成功，复制和转载请标注本文地址"}},
  lightbox: 'fancybox',
  Snackbar: {"chs_to_cht":"你已切换为繁体","cht_to_chs":"你已切换为简体","day_to_night":"你已切换为深色模式","night_to_day":"你已切换为浅色模式","bgLight":"#425AEF","bgDark":"#1f1f1f","position":"top-center"},
  source: {
    justifiedGallery: {
      js: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.min.js',
      css: 'https://cdn.cbd.int/flickr-justified-gallery@2.1.2/dist/fjGallery.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: true,
  isAnchor: false,
  shortcutKey: undefined,
  autoDarkmode: true
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  configTitle: 'mengnankkのblog',
  title: '面试模拟-202506',
  postAI: '',
  pageFillDescription: '6.11模拟面试, 1.什么是 Java 的面向对象编程？它的核心特性有哪些？, 2.说说 Java 中 ArrayList 和 LinkedList 的区别以及各自的适用场景, 3.HashMap 的底层原理, 4.Spring 框架中Bean 的作用域有哪些？请分别说明它们的生命周期和应用场景, 5.AOP 的实现原理, 6.MySQL 中索引是什么？常见的索引类型有哪些？请说明它们的适用场景和优缺点。, 7.MyBatis 的一级缓存和二级缓存机制？如何禁用缓存？, 8.MyBatis Plus 的 Wrapper 和原生 XML 写 SQL 的区别？什么时候该用 Wrapper？, 6.12模拟面试, 1.单例模式有哪些实现方式？各自的优缺点是什么？（比如饿汉式、懒汉式、双重检查锁还有静态内部类和枚举方式有没有线程安全的坑呀？）, 2.说下Spring 的ApplicationContext是单例模式策略模式在排序算法中的应用, 3.Java 线程池的核心参数有哪些？各自的作用是什么？比如corePoolSize和maximumPoolSize如何根据业务场景设置这些参数呀？, 4.你项目里用了JWT加双 Token具体是怎么设计的？两个 Token 各自的作用是什么？拦截器又分别处理什么逻辑？比如有没有考虑过 Token 过期、刷新机制或者防重放攻击的问题？, 5.看你在优惠劵的发放的时候使用限流怎么设计的, 6.那么优惠劵的发放呢？一些列的问题呢, 7.AOP记录日志, 6.14模拟面试, 1.Spring 事务的实现原理是什么？@Transactional 注解在什么情况下会失效？, 2.Java 中 HashMap 在 JDK1.8 的底层实现是什么？相对于 JDK1.7 做了哪些优化？, 3.Spring Bean 的生命周期是怎样的？@PostConstruct 和 @PreDestroy 的作用是什么？, 4.Java 中 synchronized 和 volatile 的区别是什么？各自的应用场景有哪些？, 5.Java 中为什么要使用线程池？线程池如何处理异常？, 6.19模拟面试, 1.在 校园餐饮系统 项目里你提到用了 Redis 存储 token 缓解压力能讲讲具体怎么设计 key 的结构以及如何保障 token 存储和读取的高效性与安全性不？, 2.在 MinaDB - 自研轻量级数据库系统 项目里你实现了基于 Java NIO 的数据页读写管理模块提升了 3 倍访问效率讲讲 Java NIO 是咋在这个模块里发挥作用的和传统 I/O 相比具体优化点在哪呀？, 3.在 校园餐饮系统 项目里你用 AOP 实现了操作日志自动记录讲讲 AOP 切点是怎么定义的怎么确保只拦截到需要记录日志的关键业务方法又不会过度拦截影响系统性能呀？, 4.Mysql的两段提交的三个步骤, 5.springboot启动类注解, 6.BeanFactory 和 FactoryBean 的区别, 7.MyBatis Mapper 注册过程模拟面试什么是的面向对象编程它的核心特性有哪些面向对象编程是是说就是用对象来组织代码就是一门面向对象编程的语言的面向对象的三大特征是封装继承多态封装反射修饰符继承构造方法调用多态方法重载方法重写抽象抽象和接口静态说说中和的区别以及各自的适用场景底层遍历和插入扩容数组的复制内存占比使用场景线程安全的底层原理特点底层实现之后头插和尾插过程转换红黑树扩容当链表长度且数组容量时转红黑树为什么用红黑树线程安全底层过程框架中的作用域有哪些请分别说明它们的生命周期和应用场景大标准作用域全局唯一实例容器加载时创建适用于无状态服务每次获取新实例适用于有状态对象如层每次请求一个实例需环境适用于请求上下文数据每个用户会话一个实例需环境适用于会话级数据全局共享实例需环境生命周期实例化属性注入初始化完成使用销毁循环依赖单例注入三级缓存一级缓存存储完全初始化的单例二级缓存存储早期曝光的解决的循环依赖三级缓存存储的工厂用于生成代理对象解决代理的循环依赖的实现原理概念适用场景作用点切面封装横切逻辑的类用注解标识切点定义横切逻辑作用的目标方法如通知横切逻辑的具体实现包括种类型连接点程序执行中的具体点如方法调用字段修改中主要指方法调用动态代理动态代理基于接口实现生成的代理对象适用于目标类有接口的情况代理基于子类继承生成目标类的子类代理对象适用于无接口的类需引入依赖默认策略有接口用代理无接口用代理可通过属性强制使用流程容器扫描到注解的切面类解析切点表达式和通知类型对目标类判断是否适用代理生成代理对象当调用代理对象的方法时实际执行的是通知逻辑目标方法的组合逻辑细节开启支持在配置类中添加注解或在中配置代理模式选择默认优先代理若需强制代理设置或循环依赖与若目标类被代理注入的是代理对象需注意方法调用不会触发因指向原始对象场景日志记录在方法执行前后记录入参结果避免业务代码污染事务管理本质是实现在方法调用时开启提交回滚事务权限校验在接口调用前校验用户权限拒绝非法请求性能监控统计方法执行耗时用于性能优化流程调用代理方法客户端调用代理对象的方法如匹配切点判断该方法是否匹配切面的切点表达式执行通知逻辑中先执行前置逻辑如日志记录开始调用触发目标方法执行执行后置逻辑如日志记录结束统计耗时返回结果通知逻辑执行完毕后将结果返回给客户端实例定义切面类定义切点匹配所有方法环绕通知实现耗时统计调用目标方法记录日志方法执行耗时中索引是什么常见的索引类型有哪些请说明它们的适用场景和优缺点数据库中用于加快数据查询速度的一种数据结构可以类比为书本的目录通过索引数据库可以更快地定位到目标数据而无需全表扫描为什么使用树层高叶子节点非叶子节点聚簇索引非聚簇索引索引下推联合索引覆盖索引普通索引唯一索引前缀索引全文索引索引失效的一级缓存和二级缓存机制如何禁用缓存在一次生命周期内相同的查询语句参数会被缓存第二次执行时直接从缓存中取值不会发起数据库请求当前会话有效执行任何更新操作会清空缓存执行不同参数的时候也会失效二级缓存是级别共享缓存多个之间共享该的缓存数据启用条件在配置中启用全局缓存在对应文件中配置标签查询的实体类必须实现查询语句不能使用默认查询是更新是必须关闭后一级缓存的数据才会被写入二级缓存默认缓存实现是可自定义缓存策略如的和原生写的区别什么时候该用是提供的条件构造器用于构建的等子句简化代码书写用于普通查询使用表达式避免写字段名字符串用于更新条件构造方式是传统写的方式通过文件自定义语句更加灵活和强大支持复杂的多表连接子查询等对比项构造器原生语法风格代码风格链式调用语法放在中可读性简洁类型安全特别是接近原生清晰直观编写速度快速开发尤其适合单表编写略慢需额外维护文件灵活性支持简单查询单表分页排序支持复杂多表连接子查询聚合维护性逻辑分散在代码中不易集中查看逻辑集中在更适合团队协作维护运行效率两者本质上都由执行性能差异不大性能主要看写得是否合理调试与日志日志可查看也可通过日志查看使用的场景快速开发原型项目简单的单表查询分页筛选中构造简单业务逻辑需要链式调用构造条件代码更加优雅使用避免字段拼写错误风险推荐日常开发中能用就用提高开发效率使用写的场景涉及复杂多表关联聚合函数子查询动态查询语句过长不适合写在代码中项目追求清晰的逻辑分层可维护性性能调优场景需要手写精细团队需要审查推荐复杂业务线上稳定项目用更清晰更可控模拟面试单例模式有哪些实现方式各自的优缺点是什么比如饿汉式懒汉式双重检查锁还有静态内部类和枚举方式有没有线程安全的坑呀饿汉式同步模式静态内部类枚举说下的是单例模式策略模式在排序算法中的应用本质上采用了单例模式来保证容器中的唯一性和全局访问能力启动时会初始化一个如作为容器的核心上下文这个容器对象在整个应用中只创建一次单例所有组件都从这个容器中获取实例避免了重复初始化的性能开销也方便了依赖管理统一配置事件发布等功能的实现开发中我们只需注入一次上下文或通过注解获取即可全局复用默认的是单例的这与单例模型相辅相成进一步保证了资源一致性与管理效率策略模式允许在运行时选择算法逻辑在排序算法中可用于根据用户选择动态切换不同排序策略定义统一的排序接口策略抽象不同的排序方式快排归并冒泡等实现这个接口运行时根据条件动态切换策略无需修改原有代码遵循开闭原则快速排序实现冒泡排序实现快速排序执行电商平台商品排序按价格销量上架时间数据可视化工具的排序规则切换线程池的核心参数有哪些各自的作用是什么比如和如何根据业务场景设置这些参数呀核心线程最大线程最大线程存活事件单位阻塞队列拒绝策略工厂你项目里用了加双具体是怎么设计的两个各自的作用是什么拦截器又分别处理什么逻辑比如有没有考虑过过期刷新机制或者防重放攻击的问题天有效期放在请求头用于日常接口认证用加密密钥服务端持有放在前端的天有效期存在值是随机字符串且绑定用户防止盗用放在中安全措施说明使用防止中间人劫持只读使用加密防篡改存结合用户存储支持设置有效控制生命周期黑名单机制登出用户退出登录时可删除中立即失效防止多端同时登录可使用为限制单个登录会话刷新接口限流防止被滥用加防重放限频刷新重发保护设置短期使用标记防止并发重复刷新退出策略用户点击退出删除中的或设置为无效标记因为是不可被撤销可考虑实现黑名单机制例如中维护一张黑名单黑名单适用于高安全场景如后台管理系统但会略增加接口访问时的查询压力拦截器认证拦截器先检查请求头是否有没有就返回有则解析校验用户信息是否存在第一个拦截器先校验请求头是否有没有的话直接返回第二个拦截器在有效时额外检查是否快过期比如剩余时间分钟如果是就用去换全新的和这里要注意刷新时的原子性避免并发问题刷新拦截器如果剩余有效期分钟就用请求头中的去校验校验通过的话生成新的和新会覆盖中的旧值保证单设备登录校验失败的话直接让用户重新登录危险前端或攻击者拿到密钥如部署泄露浏览器调试泄露就可以伪造合法内容是可解密的攻击者可猜测或修改然后重新签名如果服务端未验证签名有些误用场景会只解析不校验更容易被利用但还是更快计算算开销低对称密钥管理更简单适用于内部系统或中小型项目开发成本更低不涉及证书管理公私钥分发措施说明使用强密钥至少的复杂密钥不可硬编码进前端或代码中启用防止被中间人劫持签名校验每次都校验的签名防止伪造缩短有效期缩小攻击窗口存结合用户防重放防伪造黑名单机制登出清除登出时使无效检查等指纹防止被别人拿去复用看你在优惠劵的发放的时候使用限流怎么设计的我们在优惠券领取接口中用令牌桶实现限流注解定义注解标注需要限流的方法参数包括每分钟次时间单位分钟按用户限流切面实现通过切面拦截注解方法获取参数后生成唯一限流例如然后调用令牌桶服务校验令牌桶用脚本实现原子性校验核心是根据时间戳计算可生成的新令牌数不足时拒绝请求比如用户抢优惠券时同一每分钟最多次请求防止恶意刷接口防重复领取避免用户短时间内多次点击接口导致优惠券超发保护服务端峰值流量时限制请求频率防止或数据库被击穿线上遇到过同一下多个用户被误限的情况后来把改为用户减少了误判率切面类如何获取注解获取方法上的注解生成限流用户调用令牌桶校验请求频繁请稍后再试为什么选令牌桶而不是漏桶令牌桶适合突发流量漏桶适合平滑流量使用原子的存储令牌桶使用时间戳来校验令牌桶脚本简化版限流桶容量令牌生成速率个秒当前时间戳请求令牌数读取上次更新时间和剩余令牌数计算可生成的新令牌数够发令牌更新状态允许访问拒绝访问那么优惠劵的发放呢一些列的问题呢一关于优惠券类型的常见问题如何区分和应用不同类型的优惠券逻辑面试点策略模式优惠金额计算方式答法我们用策略模式来封装每种优惠券的优惠逻辑如满减折扣无门槛每种类型对应一个策略类实现统一的接口方法这样能在运行时动态选择策略便于扩展和维护二关于接口设计的追问为什么接口是这样的有没有考虑幂等性和安全性接口可能会被重复调用是否幂等有没有做权限控制防止其他用户伪造请求答法在使用优惠券时为防止重复使用我们使用实现原子操作同时标记优惠券为已使用此外接口采用登录态校验验证当前操作用户是否拥有该优惠券敏感操作都要求用户登录并记录操作日志三关于并发处理和限领逻辑如果多用户并发领取优惠券如何防止超发答法发放流程中我们使用的或脚本实现优惠券库存的原子扣减保证不会发放超过设定数量同时加锁防止并发条件下库存扣减不一致如何限制每个用户只能领取一次答法中设置一个标识键发放前先判断这个键是否存在避免重复发放也可以结合布隆过滤器提前过滤无效请求四关于时间与状态校验限时券怎么判断是否有效服务端怎么处理时间逻辑答法每张优惠券记录中保存有效时间范围使用时服务端比对当前时间是否在有效期内同时定时任务每天扫描过期优惠券标记为已过期五关于优惠券使用过程的逻辑判断使用时如果有多个优惠券怎么选最优答法前端可以请求一个推荐最优券的接口我们在服务端遍历用户可用券调用各个策略类计算预期优惠返回最高优惠金额对应的券六关于优惠券与订单系统结合问题如果下单失败了优惠券是否要恢复答法下单失败如支付失败库存不足时我们会在事务回滚后将优惠券状态重置为未使用为了避免并发问题使用分布式事务如消息队列或回滚标记七进阶设计问题优惠券支持异步发放和定时生效吗答法是的可以结合定时任务如或实现定时发放发放时间和有效时间字段分离发放时写入延时队列当生效时间到达时插入到用户优惠券表中八可能让你设计代码结构的问题优惠券模块的结构划分是怎样的答法示意接口及实现金额计算工具类九安全性问题用户伪造优惠券试图套用别人的优惠券怎么办答法每次使用时不仅要校验优惠券是否存在还要校验当前登录用户是否是该优惠券持有人只有归属校验通过才能使用记录日志我们用实现了登录日志和业务日志的分类记录核心设计是注解与策略定义注解标注需要记录的方法通过参数区分和类型切面逻辑拦截方法执行前后获取用户信息操作参数接口耗时等数据封装成日志对象例如登录日志会记录设备信息业务日志会记录操作类型如下单领券和参数如商品优惠券存储优化用异步写入日志避免影响接口性能再通过同步到方便用按时间用户等维度检索举个实际场景用户领取优惠券时业务日志会记录领取满减有次线上发现某个接口耗时突然增加通过检索该接口的日志很快定位到是参数校验逻辑异常导致的我们对敏感信息做了脱敏处理比如用户手机号会存成既满足日志追溯需求又符合数据安全规范存储的信息使用进行存储登录日志用户登录设备信息登录时间状态成功失败失败原因如密码错误业务日志用户操作类型如领取优惠券下单操作内容操作时间接口耗时请求参数脱敏处理切入点就是注解获取主机额上的方法然后建立实体类设置参数然后利用传参然后执行方法然后返回就是调用层负责和直接传输数据模拟面试事务的实现原理是什么注解在什么情况下会失效事务的实现原理是基于的动态代理和还有底层依赖通过生成代理对象默认对接口用动态代理对类用代理是采用继承目标类的方式去创建代理类非的方法不能能继承拦截器核心拦截器在方法调用前后开启提交回滚事务基于存储事务状态基于运行时异常来回滚的所以把运行时异常给或者返回没指定的异常底层依赖通过接口适配不同事务管理器如使用存储事务的状态如连接隔离级别通过存在线程本地变量保证线程安全所以基于这个情况事务失效的场景有吃掉运行时异常没抛出未配置回滚规则要配置指定类型调用非方法事务的传播属性设置为这种不支持事务的调用了不支持事务的数据库事务嵌套会挂起外部事务提前提交嵌套事务用会创建支持回滚子事务但数据库需支持外部事务外部异常不会影响提交的事务已提交属性详解传播行为如当前有事务则加入无则新建隔离级别如避免脏读事务超时时间如秒指定回滚的异常类型指定不回滚的异常类型中在的底层实现是什么相对于做了哪些优化数组链表红黑树数组链表尾插头插转换条件先扩容为什么不用平衡二叉树尾插解决环的问题线程和线程同时扩容处理链表时被挂起完成扩容后继续处理时按头插法插入元素导致链表成环扩容机制先扩容哈希算法优化通过扰动函数打散高位避免低位冲突直接使用但计算下标时用为数组长度需是的幂例实战性能提升存储个哈希冲突的键时查询需遍历链表用红黑树只需次查询内存占用红黑树节点比链表节点多存储父节点左右子节点指针但若哈希冲突少链表长度时仍用链表节省内存红黑树特点节点非红即黑根节点和叶节点是黑色红色节点不能相邻任意节点到叶节点的路径上黑节点数相同插入时最多旋转次即可平衡适合的高频插入场景场景线上曾遇到性能问题通过发现某接口频繁操作哈希冲突严重的将升级到后接口响应时间从降至主要得益于红黑树对高冲突场景的优化的生命周期是怎样的和的作用是什么实例化初始化使用销毁实例化通过构造器创建实例无参构造或工厂方法属性赋值依赖注入方法等初始化前执行的初始化执行标注的方法实现接口的自定义配置或的属性初始化后执行的使用放入容器供应用获取使用销毁前执行标注的方法销毁实现接口的自定义三级缓存解决循环依赖和的执行时机在依赖注入完成后初始化方法如之前执行在销毁前执行先于应用场景初始化数据库连接池初始化缓存预热销毁释放资源关闭文件流释放锁关键点初始化前后的拦截器如代理在此阶段创建属性赋值前的拦截器可修改属性值所有单例初始化完成后执行适合初始化需要依赖其他的场景问题解决问题依赖的方法未完成时已使用解决通过强制在之后初始化或实现接口指定初始化顺序或者是使用懒加载加载一个或者是重新构建方法中和的区别是什么各自的应用场景有哪些原子性通过锁确保代码块同一时间只能被一个线程执行可见性解锁时将工作内存变量刷新到主内存有序性通过原则禁止指令重排锁的获取释放形成关系可见性写操作时强制刷新主内存读操作时强制从主内存读取有序性通过内存屏障禁止指令重排确保关系不保证原子性仅保证单次读写操作的原子性如实际是读改写三步非原子内存屏障使用的时间读写屏障写写屏障写读屏障使用场景原子操作线程安全比如状态标记联合使用单例的模式问题问题多线程读取配置开关不生效原因配置开关未用修饰线程读取的是本地缓存值解决修改后立即通知所有线程中为什么要使用线程池线程池如何处理异常线程池的核心优势系统化梳理资源复用避免频繁创建销毁线程创建线程耗时约复用可降低开销控制并发数防止并发过高导致的如秒杀场景限制线程数保护数据库统一管理统一设置线程名称优先级方便日志追踪和故障排查异步处理将耗时任务放入线程池避免主线程阻塞如日志异步写入比较单线程多线程和线程池异常处理使用包裹任务任务异常通过获取异常任务异常阻塞获取结果抛出异常任务异常拒绝策略会抛出需在提交任务时捕获任务被拒绝场景电商下单场景用线程池异步处理库存扣减积分计算等耗时任务主线程快速返回订单创建结果提升用户体验日志系统用线程池异步写入日志到避免阻塞影响业务接口响应时间模拟面试在校园餐饮系统项目里你提到用了存储缓解压力能讲讲具体怎么设计的结构以及如何保障存储和读取的高效性与安全性不我们使用存储用户的以提升系统性能并减少数据库压力整体设计分为三部分设计存储结构安全机制结构设计这种格式能明确标识类型和所属用户保证唯一性和可读性避免冲突的存储结构我们使用的字符串结构或哈希结构存储取决于业务是否需要额外附加字段如生成时间设备信息设置合理的过期时间如天使用或命令控制生命周期的生成与安全性保障使用生成签名采用算法密钥保存在服务端配置中心或安全的中本身包含用户信息过期时间等生成后只将下发到前端则存于中服务端管理防止伪造认证流程登录时生成返回给前端存入为前端过期后携带请求刷新接口后端校验中的校验通过后重新生成新对提前防止问题防缓存穿透使用布隆过滤器记录有效用户或常见请求防止恶意请求频繁查询失败并打爆数据库防击穿为热点用户的设置合理避免同一时间大批用户同时失效防雪崩设置加入随机因子避免大批同时过期权限校验请求时验证是否属于当前防止越权操作在自研轻量级数据库系统项目里你实现了基于的数据页读写管理模块提升了倍访问效率讲讲是咋在这个模块里发挥作用的和传统相比具体优化点在哪呀与的区别每个请求需要一个线程处理线程阻塞在操作上连接数一多就容易造成线程资源耗尽系统响应慢通过实现多路复用单线程可监听多个避免大量线程阻塞等待提高了资源利用率工作机制客户端连接通过接收每个注册到上监听感兴趣的事件如使用非阻塞轮询就绪事件当某个有事件到达就通过读写数据由工作线程处理请求这种模型的优势是少量线程可处理高并发请求适合密集型场景数据库应用数据库系统天然是多并发场景传统每个连接对应一个线程会造成线程浪费甚至上下文切换频繁使用模型后我们采用模式用一个主线程监听所有连接事件用线程池异步处理真正的读写请求每个客户端连接通过注册到上提升了连接并发处理能力底层页式读写通过显著减少了系统调用次数和数据拷贝成本提高了磁盘效率并发控制说明因为是数据库系统多用户可能同时对同一数据页进行访问在读写路径上我们结合了读写锁机制和自实现的多版本并发控制确保事务隔离的一致性负责连接层的高效事件处理负责数据访问层的并发安全在校园餐饮系统项目里你用实现了操作日志自动记录讲讲切点是怎么定义的怎么确保只拦截到需要记录日志的关键业务方法又不会过度拦截影响系统性能呀我们系统中使用了来统一记录用户的操作日志包括登录日志和业务行为日志整体设计思路是基于自定义注解切面编程策略模式来实现灵活可扩展的日志记录体系我们定义了一个自定义注解用于标记需要记录的操作方法注解中可以配置以下元信息登录日志业务日志操作行为描述如删除用户切面实现日志拦截逻辑获取方法签名与参数根据注解元信息决定日志类型执行方法并记录执行结果将日志对象封装后交由策略类处理日志记录策略设计策略模式记录用户登录成功失败时间等记录用户执行的业务操作如删除用户策略选择通过实现支持按日志类型动态扩展如何保证只拦截关键方法避免性能问题只对使用注解的方法进行拦截确保业务无关方法不被扫描避免性能浪费切面逻辑尽量精简只做元信息解析和日志上下文构建真正的日志落盘交给异步任务处理或消息队列对不需要记录的查询类接口不加注解完全绕过切面执行保障系统整体响应效率日志可选择输出到文件使用或存入数据库供后期审计特殊场景下如操作异常支持记录异常栈与执行耗时追问问和有什么区别为什么你选用答能拿到方法执行前后的控制权包括返回值和异常更适合记录执行结果和耗时问怎么处理日志失败落盘慢的问题答日志落盘可异步执行或通过异步解耦避免阻塞主流程的两段提交的三个步骤写入的状态并刷盘引擎将事务修改的数据写入内存然后生成一条标记为状态调用将刷入磁盘保证崩溃后能恢复层将整个事务的逻辑操作记录为一条将持久化刷盘确保落地层写成功后通知将之前状态的更新为状态这一步是关键确认步骤表示事务已完全提交如果先写再写崩溃了但有记录主从同步出错如果只写不写主库恢复没问题但从库根本不会同步这条事务数据不一致所以必须保证与一致性落盘正是为了解决这一问题启动类注解这个注解是应用的入口是一个组合注解等价于表示这是一个配置类等同于传统的可在该类中使用定义开启的自动配置机制会根据项目依赖的自动配置例如依赖了就会自动配置等可通过属性排除某些自动配置类它通过机制条件注解在启动时动态加载并生效配置类这个会触发的自动导入机制会加载所有自动配置类内部使用加载文件中所有自动配置类每个自动配置类都配合有注解例如会根据当前已有配置文件内容等条件判断是否真正加载配置类从而实现了按需加载的自动配置在中约定大于配置约定大于配置是的核心设计理念它通过预设合理的默认行为和项目规范大幅减少开发者需要手动配置的步骤从而提升开发效率和项目标准化程度理解中的约定大于配置原则可以从以下几个方面来解释自动化配置提供了大量的自动化配置通过分析项目的依赖和环境自动配置应用程序的行为开发者无需显式地配置每个细节大部分常用的配置都已经预设好了例如引入后会自动配置内嵌和无需手动编写默认配置为诸多方面提供大量默认配置如连接数据库设置服务器处理日志等开发人员无需手动配置这些常见内容框架已做好决策例如默认的日志配置可让应用程序快速输出日志信息无需开发者额外繁琐配置日志级别输出格式与位置等约定的项目结构提倡特定项目结构通常主应用程序类含方法置于根包控制器类服务类数据访问类等分别放在相应子包如放控制器类放服务类等此约定使团队成员更易理解项目结构与组织新成员加入项目时能快速定位各功能代码位置提升协作效率扫描当前类所在包及其子包下的所有类识别注解如并注册到容器可指定自定义扫描路径扫描这个下面的包和他的子类常见注解开启定时任务支持配合使用开启异步任务支持配合使用开启事务注解支持如和的区别是容器本身负责管理所有是你自己定义的用来创建其他对比点类型接口顶层容器接口自定义的工厂位置框架提供用户自定义实现作用提供获取的基础功能如用于控制某个复杂的创建逻辑返回对象返回注册的原始实例返回由方法创建的对象示例用途加载懒加载场景用到中用于创建接口代理典型实现类用户自定义如示例提供就是容器负责拿常用于早期的配置方式示例用户自定义返回一个自定义创建的对象实际注入的是返回的实例启动时会识别但注入时拿的是的返回值如果你想拿到本身可以用是的底层容器接口提供了的获取懒加载等功能是一个用于创建的工厂类由我们自定义创建逻辑它本身是一个但它返回的对象是产生的例如就是通过动态创建接口代理对象注册过程动态代理注册流程的理解使用将接口注册为代理对象启动时会把接口方法解析成存入中运行时由通过反射动态执行接口注册注册到创建代理类执行通过执行对应启动时扫描接口会注册或它们会扫描包下所有接口对每个接口注册一个到容器中每个接口注册成一个实现了的接口它不会直接注入自身而是调用返回接口的代理类创建代理类返回的是一个的动态代理对象底层通过实现所以你注入的实际是代理类代理对象调用方法时执行会查找中注册的调用或等执行语句和参数映射都来源于或注解注册的在构建过程中会加载映射文件或注解把每个里的语句解析为调用注册到全局配置里最终保存在的中',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2025-07-26 18:12:13',
  postMainColor: '',
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
      win.saveToLocal = {
        set: (key, value, ttl) => {
          if (ttl === 0) return
          const now = Date.now()
          const expiry = now + ttl * 86400000
          const item = {
            value,
            expiry
          }
          localStorage.setItem(key, JSON.stringify(item))
        },
      
        get: key => {
          const itemStr = localStorage.getItem(key)
      
          if (!itemStr) {
            return undefined
          }
          const item = JSON.parse(itemStr)
          const now = Date.now()
      
          if (now > item.expiry) {
            localStorage.removeItem(key)
            return undefined
          }
          return item.value
        }
      }
    
      win.getScript = (url, attr = {}) => new Promise((resolve, reject) => {
        const script = document.createElement('script')
        script.src = url
        script.async = true
        script.onerror = reject
        script.onload = script.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          script.onload = script.onreadystatechange = null
          resolve()
        }

        Object.keys(attr).forEach(key => {
          script.setAttribute(key, attr[key])
        })

        document.head.appendChild(script)
      })
    
      win.getCSS = (url, id = false) => new Promise((resolve, reject) => {
        const link = document.createElement('link')
        link.rel = 'stylesheet'
        link.href = url
        if (id) link.id = id
        link.onerror = reject
        link.onload = link.onreadystatechange = function() {
          const loadState = this.readyState
          if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
          link.onload = link.onreadystatechange = null
          resolve()
        }
        document.head.appendChild(link)
      })
    
      win.activateDarkMode = () => {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#18171d')
        }
      }
      win.activateLightMode = () => {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#f7f9fe')
        }
      }
      const t = saveToLocal.get('theme')
    
          const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
          const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
          const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
          const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

          if (t === undefined) {
            if (isLightMode) activateLightMode()
            else if (isDarkMode) activateDarkMode()
            else if (isNotSpecified || hasNoSupport) {
              const now = new Date()
              const hour = now.getHours()
              const isNight = hour <= 6 || hour >= 18
              isNight ? activateDarkMode() : activateLightMode()
            }
            window.matchMedia('(prefers-color-scheme: dark)').addListener(e => {
              if (saveToLocal.get('theme') === undefined) {
                e.matches ? activateDarkMode() : activateLightMode()
              }
            })
          } else if (t === 'light') activateLightMode()
          else activateDarkMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
      const detectApple = () => {
        if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
          document.documentElement.classList.add('apple')
        }
      }
      detectApple()
    })(window)</script><meta name="generator" content="Hexo 7.2.0"><link rel="alternate" href="/rss2.xml" title="mengnankkのblog" type="application/rss+xml">
</head><body data-type="anzhiyu"><div id="web_bg"></div><div id="an_music_bg"></div><div id="loading-box" onclick="document.getElementById(&quot;loading-box&quot;).classList.add(&quot;loaded&quot;)"><div class="loading-bg"><img class="loading-img nolazyload" alt="加载头像" src="https://skymirror-1322372781.cos.ap-beijing.myqcloud.com/202407230955363.jpg"/><div class="loading-image-dot"></div></div></div><script>const preloader = {
  endLoading: () => {
    document.getElementById('loading-box').classList.add("loaded");
  },
  initLoading: () => {
    document.getElementById('loading-box').classList.remove("loaded")
  }
}
window.addEventListener('load',()=> { preloader.endLoading() })
setTimeout(function(){preloader.endLoading();},10000)

if (true) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.10/progress_bar/progress_bar.css"/><script async="async" src="https://cdn.cbd.int/pace-js@1.2.4/pace.min.js" data-pace-options="{ &quot;restartOnRequestAfter&quot;:false,&quot;eventLag&quot;:false}"></script><div class="post" id="body-wrap"><header class="post-bg" id="page-header"><nav id="nav"><div id="nav-group"><span id="blog_name"><div class="back-home-button"><i class="anzhiyufont anzhiyu-icon-grip-vertical"></i><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" href="https://blog.tokenlen.top/" title="博客"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="博客"/><span class="back-menu-item-text">博客</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="http://img.mengnankk.top:9001/" title="图床"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="图床"/><span class="back-menu-item-text">图床</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">项目</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="http://img.mengnankk.top:9001/" title="mengnankk图床"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/08/13/64d8c2653332e.ico" alt="mengnankk图床"/><span class="back-menu-item-text">mengnankk图床</span></a></div></div></div></div><a id="site-name" href="/" accesskey="h"><div class="title">mengnankkのblog</div><i class="anzhiyufont anzhiyu-icon-house-chimney"></i></a><div id="he-plugin-simple"></div><script>var WIDGET = {
  "CONFIG": {
    "modules": "0124",
    "background": "2",
    "tmpColor": "FFFFFF",
    "tmpSize": "16",
    "cityColor": "FFFFFF",
    "citySize": "16",
    "aqiColor": "E8D87B",
    "aqiSize": "16",
    "weatherIconSize": "24",
    "alertIconSize": "18",
    "padding": "10px 10px 10px 10px",
    "shadow": "0",
    "language": "auto",
    "borderRadius": "20",
    "fixed": "true",
    "vertical": "top",
    "horizontal": "left",
    "left": "20",
    "top": "7.1",
    "key": "df245676fb434a0691ead1c63341cd94"
  }
}
</script><link rel="stylesheet" href="https://widget.qweather.net/simple/static/css/he-simple.css?v=1.4.0"/><script src="https://widget.qweather.net/simple/static/js/he-simple.js?v=1.4.0"></script></span><div class="mask-name-container"><div id="name-container"><a id="page-name" href="javascript:anzhiyu.scrollToDest(0, 500)">PAGE_NAME</a></div></div><div id="menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size: 0.9em;"></i><span> 隧道</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 生活</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/album/"><i class="anzhiyufont anzhiyu-icon-images faa-tada" style="font-size: 0.9em;"></i><span> 相册集</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/essay/"><i class="anzhiyufont anzhiyu-icon-lightbulb faa-tada" style="font-size: 0.9em;"></i><span> 闲言碎语</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/music/"><i class="anzhiyufont anzhiyu-icon-music faa-tada" style="font-size: 0.9em;"></i><span> 音乐馆</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 我的</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><i class="anzhiyufont anzhiyu-icon-link faa-tada" style="font-size: 0.9em;"></i><span> 友人帐</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size: 0.9em;"></i><span> 关于本人</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/Message/"><i class="anzhiyufont anzhiyu-icon-envelope faa-tada" style="font-size: 0.9em;"></i><span> 留言</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 其他</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" target="_blank" rel="noopener" href="https://home.tokenlen.top/"><i class="anzhiyufont anzhiyu-icon-envelope faa-tada" style="font-size: 0.9em;"></i><span> home</span></a></li><li><a class="site-page child faa-parent animated-hover" target="_blank" rel="noopener" href="https://status.mengnankk.asia/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 站点检测</span></a></li><li><a class="site-page child faa-parent animated-hover" target="_blank" rel="noopener" href="https://home.tokenlen.top/"><i class="anzhiyufont anzhiyu-icon-lightbulb faa-tada" style="font-size: 0.9em;"></i><span> 心里话</span></a></li></ul></div></div></div><div id="nav-right"><div class="nav-button only-home" id="travellings_button" title="随机前往一个开往项目网站"><a class="site-page" onclick="anzhiyu.totraveling()" title="随机前往一个开往项目网站" href="javascript:void(0);" rel="external nofollow" data-pjax-state="external"><i class="anzhiyufont anzhiyu-icon-train"></i></a></div><div class="nav-button" id="randomPost_button"><a class="site-page" onclick="toRandomPost()" title="随机前往一个文章" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-dice"></i></a></div><div class="nav-button" id="search-button"><a class="site-page social-icon search" href="javascript:void(0);" title="搜索🔍" accesskey="s"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span> 搜索</span></a></div><input id="center-console" type="checkbox"/><label class="widget" for="center-console" title="中控台" onclick="anzhiyu.switchConsole();"><i class="left"></i><i class="widget center"></i><i class="widget right"></i></label><div id="console"><div class="console-card-group-reward"><ul class="reward-all console-card"><li class="reward-item"><a href="https://imgbed.mengnankk.asia/202407021650088.jpg" target="_blank"><img class="post-qr-code-img" alt="微信" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://imgbed.mengnankk.asia/202407021650088.jpg"/></a><div class="post-qr-code-desc">微信</div></li><li class="reward-item"><a href="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png" target="_blank"><img class="post-qr-code-img" alt="支付宝" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/qrcode-alipay.png"/></a><div class="post-qr-code-desc">支付宝</div></li></ul></div><div class="console-card-group"><div class="console-card-group-left"><div class="console-card" id="card-newest-comments"><div class="card-content"><div class="author-content-item-tips">互动</div><span class="author-content-item-title"> 最新评论</span></div><div class="aside-list"><span>正在加载中...</span></div></div></div><div class="console-card-group-right"><div class="console-card tags"><div class="card-content"><div class="author-content-item-tips">兴趣点</div><span class="author-content-item-title">寻找你感兴趣的领域</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/BF/" style="font-size: 1.05rem;">BF<sup>1</sup></a><a href="/tags/BUG/" style="font-size: 1.05rem;">BUG<sup>1</sup></a><a href="/tags/BigData/" style="font-size: 1.05rem;">BigData<sup>2</sup></a><a href="/tags/C/" style="font-size: 1.05rem;">C<sup>4</sup></a><a href="/tags/Cache/" style="font-size: 1.05rem;">Cache<sup>1</sup></a><a href="/tags/Elasticsearch/" style="font-size: 1.05rem;">Elasticsearch<sup>1</sup></a><a href="/tags/English/" style="font-size: 1.05rem;">English<sup>9</sup></a><a href="/tags/Github/" style="font-size: 1.05rem;">Github<sup>1</sup></a><a href="/tags/Hadoop/" style="font-size: 1.05rem;">Hadoop<sup>2</sup></a><a href="/tags/Linux/" style="font-size: 1.05rem;">Linux<sup>12</sup></a><a href="/tags/Nginx/" style="font-size: 1.05rem;">Nginx<sup>1</sup></a><a href="/tags/SpringAI/" style="font-size: 1.05rem;">SpringAI<sup>2</sup></a><a href="/tags/SpringCloud/" style="font-size: 1.05rem;">SpringCloud<sup>1</sup></a><a href="/tags/XSS/" style="font-size: 1.05rem;">XSS<sup>1</sup></a><a href="/tags/css/" style="font-size: 1.05rem;">css<sup>2</sup></a><a href="/tags/docker/" style="font-size: 1.05rem;">docker<sup>1</sup></a><a href="/tags/git/" style="font-size: 1.05rem;">git<sup>1</sup></a><a href="/tags/html/" style="font-size: 1.05rem;">html<sup>1</sup></a><a href="/tags/java/" style="font-size: 1.05rem;">java<sup>57</sup></a><a href="/tags/juc/" style="font-size: 1.05rem;">juc<sup>2</sup></a><a href="/tags/jvm/" style="font-size: 1.05rem;">jvm<sup>2</sup></a><a href="/tags/leetcode/" style="font-size: 1.05rem;">leetcode<sup>10</sup></a><a href="/tags/mysql/" style="font-size: 1.05rem;">mysql<sup>16</sup></a><a href="/tags/net/" style="font-size: 1.05rem;">net<sup>7</sup></a><a href="/tags/php/" style="font-size: 1.05rem;">php<sup>5</sup></a><a href="/tags/python/" style="font-size: 1.05rem;">python<sup>3</sup></a><a href="/tags/redis/" style="font-size: 1.05rem;">redis<sup>4</sup></a><a href="/tags/rocketmq/" style="font-size: 1.05rem;">rocketmq<sup>1</sup></a><a href="/tags/shell/" style="font-size: 1.05rem;">shell<sup>4</sup></a><a href="/tags/spring/" style="font-size: 1.05rem;">spring<sup>3</sup></a><a href="/tags/spring-boot/" style="font-size: 1.05rem;">spring boot<sup>14</sup></a><a href="/tags/sql/" style="font-size: 1.05rem;">sql<sup>5</sup></a><a href="/tags/web/" style="font-size: 1.05rem;">web<sup>3</sup></a><a href="/tags/%E6%95%B0%E5%AD%97%E9%80%BB%E8%BE%91/" style="font-size: 1.05rem;">数字逻辑<sup>1</sup></a><a href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93%E5%8E%9F%E7%90%86/" style="font-size: 1.05rem;">数据库原理<sup>3</sup></a><a href="/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" style="font-size: 1.05rem;">数据结构<sup>20</sup></a><a href="/tags/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/" style="font-size: 1.05rem;">正则表达式<sup>2</sup></a><a href="/tags/%E6%B1%87%E7%BC%96%E8%AF%AD%E8%A8%80/" style="font-size: 1.05rem;">汇编语言<sup>1</sup></a><a href="/tags/%E7%AE%97%E6%B3%95/" style="font-size: 1.05rem;">算法<sup>9</sup></a><a href="/tags/%E9%9D%A2%E8%AF%95/" style="font-size: 1.05rem;">面试<sup>24</sup></a></div></div><hr/></div></div><div class="console-card history"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-box-archiv"></i><span>文章</span></div><div class="card-archives"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-archive"></i><span>归档</span><a class="card-more-btn" href="/archives/" title="查看更多">
    <i class="anzhiyufont anzhiyu-icon-angle-right"></i></a></div><ul class="card-archive-list"><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/08/"><span class="card-archive-list-date">八月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">4</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/07/"><span class="card-archive-list-date">七月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">15</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/06/"><span class="card-archive-list-date">六月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">16</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/05/"><span class="card-archive-list-date">五月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">22</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/04/"><span class="card-archive-list-date">四月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">7</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/03/"><span class="card-archive-list-date">三月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">5</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/02/"><span class="card-archive-list-date">二月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">4</span><span>篇</span></div></a></li><li class="card-archive-list-item"><a class="card-archive-list-link" href="/archives/2025/01/"><span class="card-archive-list-date">一月 2025</span><div class="card-archive-list-count-group"><span class="card-archive-list-count">5</span><span>篇</span></div></a></li></ul></div><hr/></div></div></div><div class="button-group"><div class="console-btn-item"><a class="darkmode_switchbutton" title="显示模式切换" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-moon"></i></a></div><div class="console-btn-item" id="consoleHideAside" onclick="anzhiyu.hideAsideBtn()" title="边栏显示控制"><a class="asideSwitch"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></a></div><div class="console-btn-item on" id="consoleCommentBarrage" onclick="anzhiyu.switchCommentBarrage()" title="热评开关"><a class="commentBarrage"><i class="anzhiyufont anzhiyu-icon-message"></i></a></div><div class="console-btn-item" id="consoleMusic" onclick="anzhiyu.musicToggle()" title="音乐开关"><a class="music-switch"><i class="anzhiyufont anzhiyu-icon-music"></i></a></div></div><div class="console-mask" onclick="anzhiyu.hideConsole()" href="javascript:void(0);"></div></div><div class="nav-button" id="nav-totop"><a class="totopbtn" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i><span id="percent" onclick="anzhiyu.scrollToDest(0,500)">0</span></a></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);" title="切换"><i class="anzhiyufont anzhiyu-icon-bars"></i></a></div></div></div></nav><div id="post-info"><div id="post-firstinfo"><div class="meta-firstline"><a class="post-meta-original">原创</a><span class="post-meta-categories"><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-inbox post-meta-icon"></i><a class="post-meta-categories" href="/categories/%E9%9D%A2%E7%BB%8F/" itemprop="url">面经</a></span><span class="article-meta tags"><a class="article-meta__tags" href="/tags/%E9%9D%A2%E8%AF%95/" tabindex="-1" itemprop="url"> <span> <i class="anzhiyufont anzhiyu-icon-hashtag"></i>面试</span></a></span></div></div><h1 class="post-title" itemprop="name headline">面试模拟-202506</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="anzhiyufont anzhiyu-icon-calendar-days post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" itemprop="dateCreated datePublished" datetime="2025-06-10T16:00:00.000Z" title="发表于 2025-06-11 00:00:00">2025-06-11</time><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-history post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" itemprop="dateCreated datePublished" datetime="2025-07-26T10:12:13.505Z" title="更新于 2025-07-26 18:12:13">2025-07-26</time></span></div><div class="meta-secondline"><span class="post-meta-separator"></span><span class="post-meta-wordcount"><i class="anzhiyufont anzhiyu-icon-file-word post-meta-icon" title="文章字数"></i><span class="post-meta-label" title="文章字数">字数总计:</span><span class="word-count" title="文章字数">11.1k</span><span class="post-meta-separator"></span><i class="anzhiyufont anzhiyu-icon-clock post-meta-icon" title="阅读时长"></i><span class="post-meta-label" title="阅读时长">阅读时长:</span><span>37分钟</span></span><span class="post-meta-separator"></span><span id="" data-flag-title="面试模拟-202506"><i class="anzhiyufont anzhiyu-icon-fw-eye post-meta-icon"></i><span class="post-meta-label" title="阅读量">阅读量:</span><span id="twikoo_visitors" title="访问量"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-spin"></i></span></span><span class="post-meta-separator">       </span><span class="post-meta-position" title="作者IP属地为济南"><i class="anzhiyufont anzhiyu-icon-location-dot"></i>济南</span></div></div></div><section class="main-hero-waves-area waves-area"><svg class="waves-svg" xmlns="http://www.w3.org/2000/svg" xlink="http://www.w3.org/1999/xlink" viewBox="0 24 150 28" preserveAspectRatio="none" shape-rendering="auto"><defs><path id="gentle-wave" d="M -160 44 c 30 0 58 -18 88 -18 s 58 18 88 18 s 58 -18 88 -18 s 58 18 88 18 v 44 h -352 Z"></path></defs><g class="parallax"><use href="#gentle-wave" x="48" y="0"></use><use href="#gentle-wave" x="48" y="3"></use><use href="#gentle-wave" x="48" y="5"></use><use href="#gentle-wave" x="48" y="7"></use></g></svg></section><div id="post-top-cover"><img class="nolazyload" id="post-top-bg" src="https://skymirror-1322372781.cos.ap-beijing.myqcloud.com/20250126175712180.jpg?_r_=62b12b1e-027e-0455-7412-733e5fa8ad41"></div></header><main id="blog-container"><div class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container" itemscope itemtype="https://blog.tokenlen.top/2025/06/11/towork/working1/"><header><a class="post-meta-categories" href="/categories/%E9%9D%A2%E7%BB%8F/" itemprop="url">面经</a><a href="/tags/%E9%9D%A2%E8%AF%95/" tabindex="-1" itemprop="url">面试</a><h1 id="CrawlerTitle" itemprop="name headline">面试模拟-202506</h1><span itemprop="author" itemscope itemtype="http://schema.org/Person">mengnankkzhou</span><time itemprop="dateCreated datePublished" datetime="2025-06-10T16:00:00.000Z" title="发表于 2025-06-11 00:00:00">2025-06-11</time><time itemprop="dateCreated datePublished" datetime="2025-07-26T10:12:13.505Z" title="更新于 2025-07-26 18:12:13">2025-07-26</time></header><h1>6.11模拟面试</h1>
<h2 id="1-什么是-Java-的面向对象编程？它的核心特性有哪些？">1.什么是 Java 的面向对象编程？它的核心特性有哪些？</h2>
<p>面向对象编程是OOP是说就是<strong>用“对象”来组织代码</strong>，java就是一门面向对象编程的语言。</p>
<p>java的面向对象的三大特征是封装继承多态</p>
<p>封装：反射，修饰符</p>
<p>继承：构造方法调用，final</p>
<p>多态：方法重载，方法重写</p>
<p>抽象：抽象和接口</p>
<p>静态：</p>
<h2 id="2-说说-Java-中-ArrayList-和-LinkedList-的区别，以及各自的适用场景">2.说说 Java 中 ArrayList 和 LinkedList 的区别，以及各自的适用场景</h2>
<p>底层：</p>
<p>遍历和插入：</p>
<p>arrayList扩容：1.5，数组的复制</p>
<p>内存占比：</p>
<p>使用场景：</p>
<p>线程安全：</p>
<h2 id="3-HashMap-的底层原理">3.HashMap 的底层原理</h2>
<p>特点：</p>
<p>底层实现，1.7/1.7之后，头插和尾插</p>
<p>put过程</p>
<p>转换红黑树/扩容：当链表长度≥8 且数组容量≥64 时转红黑树 为什么用红黑树</p>
<p>线程安全：</p>
<p>concurrenthashmap，底层，put过程</p>
<h2 id="4-Spring-框架中，Bean-的作用域有哪些？请分别说明它们的生命周期和应用场景">4.Spring 框架中，Bean 的作用域有哪些？请分别说明它们的生命周期和应用场景</h2>
<p><strong>5 大标准作用域</strong>：</p>
<ul>
<li><strong>Singleton</strong>：全局唯一实例，Spring 容器加载时创建，适用于无状态服务；</li>
<li><strong>Prototype</strong>：每次获取新实例，适用于有状态对象（如 DAO 层）；</li>
<li><strong>Request</strong>：每次 HTTP 请求一个实例，需 Web 环境，适用于请求上下文数据；</li>
<li><strong>Session</strong>：每个用户会话一个实例，需 Web 环境，适用于会话级数据；</li>
<li><strong>Application</strong>：全局 ServletContext 共享实例，需 Web 环境。</li>
</ul>
<p>生命周期：实例化→属性注入→@PostConstruct→初始化完成→使用→@PreDestroy→销毁。</p>
<p>循环依赖：setter单例注入，三级缓存，</p>
<ul>
<li>一级缓存（singletonObjects）：存储完全初始化的单例 Bean；</li>
<li>二级缓存（earlySingletonObjects）：存储早期曝光的 Bean（解决 A→B→A 的循环依赖）；</li>
<li>三级缓存（singletonFactories）：存储 Bean 的工厂，用于生成代理对象（解决 A→B（代理）→A 的循环依赖）。</li>
</ul>
<h2 id="5-AOP-的实现原理">5.AOP 的实现原理</h2>
<p>概念：适用场景</p>
<p>作用点：</p>
<ul>
<li><strong>切面（Aspect）</strong>：封装横切逻辑的类，用<code>@Aspect</code>注解标识；</li>
<li><strong>切点（Pointcut）</strong>：定义横切逻辑作用的目标方法（如<code>@Pointcut(&quot;execution(* com.service.*.*(..))&quot;)</code>）；</li>
<li><strong>通知（Advice）</strong>：横切逻辑的具体实现，包括 5 种类型</li>
<li><strong>连接点（Joinpoint）</strong>：程序执行中的具体点（如方法调用、字段修改），AOP 中主要指<strong>方法调用</strong></li>
</ul>
<p>动态代理：</p>
<ul>
<li><strong>JDK 动态代理</strong>：基于接口实现，生成<code>InvocationHandler</code>的代理对象，适用于目标类有接口的情况；</li>
<li><strong>CGLIB 代理</strong>：基于子类继承，生成目标类的子类代理对象，适用于无接口的类（需引入<code>cglib</code>依赖）；</li>
<li><strong>Spring 默认策略</strong>：有接口用 JDK 代理，无接口用 CGLIB 代理（可通过<code>proxy-target-class</code>属性强制使用 CGLIB）。</li>
<li>流程：</li>
<li>Spring 容器扫描到<code>@Aspect</code>注解的切面类，解析切点表达式和通知类型；</li>
<li>对目标类判断是否适用 JDK/CGLIB 代理，生成代理对象；</li>
<li>当调用代理对象的方法时，实际执行的是<strong>通知逻辑 + 目标方法</strong>的组合逻辑。</li>
</ul>
<p>细节：</p>
<ol>
<li>
<p><strong>开启 AOP 支持</strong>：在配置类中添加<code>@EnableAspectJAutoProxy</code>注解，或在 XML 中配置<code>&lt;aop:aspectj-autoproxy/&gt;</code>；</p>
</li>
<li>
<p>代理模式选择</p>
<p>：</p>
<ul>
<li>默认<code>proxyTargetClass=false</code>（优先 JDK 代理）；</li>
<li>若需强制 CGLIB 代理，设置<code>proxyTargetClass=true</code>或<code>@EnableAspectJAutoProxy(proxyTargetClass = true)</code>；</li>
</ul>
</li>
<li>
<p><strong>循环依赖与 AOP</strong>：若目标类被代理，注入的是代理对象，需注意<code>this.方法()</code>调用不会触发 AOP（因<code>this</code>指向原始对象）。</p>
</li>
</ol>
<p>场景：</p>
<ul>
<li>
<p><strong>日志记录</strong>：在方法执行前后记录入参 / 结果，避免业务代码污染；</p>
</li>
<li>
<p><strong>事务管理</strong>：<code>@Transactional</code>本质是 AOP 实现，在方法调用时开启 / 提交 / 回滚事务；</p>
</li>
<li>
<p><strong>权限校验</strong>：在接口调用前校验用户权限，拒绝非法请求；</p>
</li>
<li>
<p><strong>性能监控</strong>：统计方法执行耗时，用于性能优化。</p>
</li>
</ul>
<p>流程：</p>
<ol>
<li><strong>调用代理方法</strong>：客户端调用代理对象的方法（如<code>userService.save()</code>）；</li>
<li><strong>匹配切点</strong>：Spring 判断该方法是否匹配切面的切点表达式；</li>
<li>执行通知逻辑
<ul>
<li><code>@Around</code>中先执行前置逻辑（如日志记录开始）；</li>
<li>调用<code>proceed()</code>触发目标方法执行；</li>
<li>执行后置逻辑（如日志记录结束、统计耗时）；</li>
</ul>
</li>
<li><strong>返回结果</strong>：通知逻辑执行完毕后，将结果返回给客户端。</li>
</ol>
<p>实例：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 1. 定义切面类</span></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LogAspect</span> &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 2. 定义切点（匹配所有Service方法）</span></span><br><span class="line">    <span class="meta">@Pointcut(&quot;execution(* com.service..*.*(..))&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">servicePointcut</span><span class="params">()</span> &#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 3. 环绕通知实现耗时统计</span></span><br><span class="line">    <span class="meta">@Around(&quot;servicePointcut()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">logExecutionTime</span><span class="params">(ProceedingJoinPoint joinPoint)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        <span class="type">long</span> <span class="variable">start</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        <span class="comment">// 调用目标方法</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">result</span> <span class="operator">=</span> joinPoint.proceed();</span><br><span class="line">        <span class="type">long</span> <span class="variable">end</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        <span class="comment">// 记录日志</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">methodName</span> <span class="operator">=</span> joinPoint.getSignature().getName();</span><br><span class="line">        System.out.println(<span class="string">&quot;方法 &quot;</span> + methodName + <span class="string">&quot; 执行耗时：&quot;</span> + (end - start) + <span class="string">&quot;ms&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="6-MySQL-中，索引是什么？常见的索引类型有哪些？请说明它们的适用场景和优缺点。">6.MySQL 中，索引是什么？常见的索引类型有哪些？请说明它们的适用场景和优缺点。</h2>
<p>数据库中用于<strong>加快数据查询速度的一种数据结构</strong>，可以类比为书本的目录。通过索引，数据库可以更快地定位到目标数据，而无需全表扫描。</p>
<p>为什么使用b+树，层高，叶子节点/非叶子节点</p>
<p>聚簇索引，非聚簇索引，索引下推</p>
<p>联合索引，覆盖索引</p>
<p>普通索引，唯一索引，前缀索引，全文索引。</p>
<p>索引失效：</p>
<p>explain:</p>
<h2 id="7-MyBatis-的一级缓存和二级缓存机制？如何禁用缓存？">7.<strong>MyBatis 的一级缓存和二级缓存机制？如何禁用缓存？</strong></h2>
<p>sqlsession:</p>
<p>在一次 SqlSession 生命周期内，相同的查询语句（SQL + 参数）会被缓存，第二次执行时直接从缓存中取值，不会发起数据库请求。当前会话有效，执行 <code>insert/update/delete</code>：任何更新操作会清空缓存。执行<code>sqlSession.clearCache()</code>。不同参数的时候也会失效</p>
<p>mapper：</p>
<p>二级缓存是 <strong>Mapper 级别</strong>（namespace）共享缓存。</p>
<p>多个 SqlSession 之间共享该 Mapper 的缓存数据。</p>
<p>启用条件：</p>
<p>在 MyBatis 配置中启用全局缓存：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;settings&gt;</span><br><span class="line">  &lt;setting name=&quot;cacheEnabled&quot; value=&quot;true&quot;/&gt;</span><br><span class="line">&lt;/settings&gt;</span><br></pre></td></tr></table></figure>
<p>在对应 Mapper 文件中配置 <code>&lt;cache&gt;</code> 标签：</p>
<p>查询的 POJO 实体类必须实现 <code>Serializable</code>。</p>
<p>查询语句不能使用 <code>flushCache=&quot;true&quot;</code>（默认查询是 false，更新是 true）。</p>
<p>SqlSession 必须关闭后，一级缓存的数据才会被写入二级缓存。</p>
<p>默认缓存实现是 <code>PerpetualCache + LRU</code>。</p>
<p>可自定义缓存策略（如 EhCache、Redis）。</p>
<h2 id="8-MyBatis-Plus-的-Wrapper-和原生-XML-写-SQL-的区别？什么时候该用-Wrapper？"><strong>8.MyBatis Plus 的 Wrapper 和原生 XML 写 SQL 的区别？什么时候该用 Wrapper？</strong></h2>
<p>Wrapper 是 MyBatis Plus 提供的条件构造器，用于构建 SQL 的 WHERE、ORDER BY 等子句，简化代码书写。</p>
<p><code>QueryWrapper</code>：用于普通查询。</p>
<p><code>LambdaQueryWrapper</code>：使用 lambda 表达式避免写字段名字符串。</p>
<p><code>UpdateWrapper</code> / <code>LambdaUpdateWrapper</code>：用于更新条件构造。</p>
<p>XML 方式是传统 MyBatis 写 SQL 的方式，通过 Mapper.xml 文件自定义 SQL 语句，更加灵活和强大，支持复杂的多表连接、子查询等。</p>
<table>
<thead>
<tr>
<th>对比项</th>
<th>Wrapper（构造器）</th>
<th>XML 原生 SQL</th>
</tr>
</thead>
<tbody>
<tr>
<td>语法风格</td>
<td>Java 代码风格，链式调用</td>
<td>SQL 语法，放在 XML 中</td>
</tr>
<tr>
<td>可读性</td>
<td>简洁、类型安全（特别是 Lambda）</td>
<td>接近原生 SQL，清晰直观</td>
</tr>
<tr>
<td>编写速度</td>
<td>快速开发，尤其适合单表 CRUD</td>
<td>编写略慢，需额外维护 Mapper.xml 文件</td>
</tr>
<tr>
<td>SQL 灵活性</td>
<td>支持简单查询（单表、分页、排序）</td>
<td>支持复杂 SQL（多表连接、子查询、聚合）</td>
</tr>
<tr>
<td>维护性</td>
<td>逻辑分散在代码中，不易集中查看</td>
<td>逻辑集中在 XML，更适合团队协作维护</td>
</tr>
<tr>
<td>运行效率</td>
<td>两者本质上都由 MyBatis 执行，性能差异不大</td>
<td>性能主要看 SQL 写得是否合理</td>
</tr>
<tr>
<td>调试与日志</td>
<td>SQL 日志可查看</td>
<td>也可通过日志查看</td>
</tr>
</tbody>
</table>
<p>✅ 使用 Wrapper 的场景：</p>
<ul>
<li>快速开发、原型项目。</li>
<li>简单的单表查询、分页、筛选。</li>
<li>Controller/Service 中构造简单业务逻辑。</li>
<li>需要链式调用构造条件，代码更加优雅。</li>
<li>使用 Lambda 避免字段拼写错误风险。</li>
</ul>
<blockquote>
<p><strong>推荐：日常开发中能用 Wrapper 就用 Wrapper，提高开发效率。</strong></p>
</blockquote>
<hr>
<p>✅ 使用 XML 写 SQL 的场景：</p>
<ul>
<li>涉及复杂 SQL（多表关联、聚合函数、子查询、动态 SQL）。</li>
<li>查询语句过长、不适合写在 Java 代码中。</li>
<li>项目追求清晰的逻辑分层、SQL 可维护性。</li>
<li>性能调优场景，需要手写精细 SQL。</li>
<li>团队需要 DBA 审查 SQL。</li>
</ul>
<blockquote>
<p><strong>推荐：复杂业务、线上稳定项目，用 XML 更清晰、更可控。</strong></p>
</blockquote>
<h1>6.12模拟面试</h1>
<h2 id="1-单例模式有哪些实现方式？各自的优缺点是什么？（比如饿汉式、懒汉式、双重检查锁，还有静态内部类和枚举方式，有没有线程安全的坑呀？）">1.<strong>单例模式有哪些实现方式？各自的优缺点是什么？（比如饿汉式、懒汉式、双重检查锁，还有静态内部类和枚举方式，有没有线程安全的坑呀？）</strong></h2>
<p>饿汉式：</p>
<p>同步模式</p>
<p>volatile+synchronized</p>
<p>静态内部类</p>
<p>枚举</p>
<h2 id="2-说下Spring-的ApplicationContext是单例模式”“策略模式在排序算法中的应用”">2.说下Spring 的ApplicationContext是单例模式”“策略模式在排序算法中的应用”</h2>
<p><code>ApplicationContext</code> 本质上采用了<strong>单例模式</strong>来保证 Spring 容器中 <strong>Bean 的唯一性和全局访问能力</strong>。</p>
<p>Spring Boot 启动时会初始化一个 <code>ApplicationContext</code>（如 <code>AnnotationConfigApplicationContext</code>），作为<strong>IoC 容器的核心上下文</strong>。</p>
<p>这个容器对象在整个应用中<strong>只创建一次（单例）</strong>，所有组件（Controller、Service、Repository）都从这个容器中获取 Bean 实例。</p>
<p><strong>避免了重复初始化 Bean 的性能开销</strong>，也方便了依赖管理、统一配置、事件发布等功能的实现。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> SpringApplication.run(MyApp.class, args);</span><br><span class="line"><span class="type">MyService</span> <span class="variable">service</span> <span class="operator">=</span> context.getBean(MyService.class);</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>开发中我们只需注入一次上下文或通过 <code>@Autowired</code> 注解获取 Bean，即可全局复用。</p>
<p>Spring 默认的 Bean 是单例的（<code>@Scope(&quot;singleton&quot;)</code>），这与 <code>ApplicationContext</code> 单例模型相辅相成，进一步保证了资源一致性与管理效率。</p>
<p>策略模式允许在运行时选择算法逻辑，在排序算法中可用于根据用户选择动态切换不同排序策略。</p>
<p><strong>定义统一的排序接口（策略抽象）</strong>，不同的排序方式（快排、归并、冒泡等）实现这个接口。</p>
<p><strong>运行时根据条件动态切换策略</strong>，无需修改原有代码（遵循开闭原则）。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">SortStrategy</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">sort</span><span class="params">(<span class="type">int</span>[] arr)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">QuickSort</span> <span class="keyword">implements</span> <span class="title class_">SortStrategy</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sort</span><span class="params">(<span class="type">int</span>[] arr)</span> &#123;</span><br><span class="line">        <span class="comment">// 快速排序实现</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BubbleSort</span> <span class="keyword">implements</span> <span class="title class_">SortStrategy</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sort</span><span class="params">(<span class="type">int</span>[] arr)</span> &#123;</span><br><span class="line">        <span class="comment">// 冒泡排序实现</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SortContext</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> SortStrategy strategy;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">SortContext</span><span class="params">(SortStrategy strategy)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.strategy = strategy;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">executeSort</span><span class="params">(<span class="type">int</span>[] arr)</span> &#123;</span><br><span class="line">        strategy.sort(arr);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">SortContext</span> <span class="variable">ctx</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SortContext</span>(<span class="keyword">new</span> <span class="title class_">QuickSort</span>());</span><br><span class="line">ctx.executeSort(myArray); <span class="comment">// 快速排序执行</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<ul>
<li>电商平台商品排序（按价格、销量、上架时间）</li>
<li>数据可视化工具的排序规则切换</li>
</ul>
<h2 id="3-Java-线程池的核心参数有哪些？各自的作用是什么？比如corePoolSize和maximumPoolSize，如何根据业务场景设置这些参数呀？">3.<strong>Java 线程池的核心参数有哪些？各自的作用是什么？比如<code>corePoolSize</code>和<code>maximumPoolSize</code>，如何根据业务场景设置这些参数呀？</strong></h2>
<p>核心线程</p>
<p>最大线程</p>
<p>最大线程存活事件</p>
<p>单位</p>
<p>阻塞队列</p>
<p>拒绝策略</p>
<p>工厂</p>
<h2 id="4-你项目里用了JWT加双-Token，具体是怎么设计的？两个-Token-各自的作用是什么？拦截器又分别处理什么逻辑？比如有没有考虑过-Token-过期、刷新机制，或者防重放攻击的问题？">4.你项目里用了JWT加双 Token，具体是怎么设计的？两个 Token 各自的作用是什么？拦截器又分别处理什么逻辑？比如有没有考虑过 Token 过期、刷新机制，或者防重放攻击的问题？</h2>
<p>token:</p>
<ul>
<li><strong>access token</strong>（7 天有效期）：放在请求头，用于日常接口认证，用 HS256 加密（密钥服务端持有）；放在前端的localStorage/jwt</li>
<li><strong>refresh token</strong>（15 天有效期）：存在 Redis，值是随机字符串，且绑定用户 ID ，防止盗用。放在redis中</li>
</ul>
<table>
<thead>
<tr>
<th>安全措施</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>使用 HTTPS</td>
<td>防止中间人劫持 token</td>
</tr>
<tr>
<td>access token 只读</td>
<td>JWT 使用 HS256 加密，防篡改</td>
</tr>
<tr>
<td>refresh token 存 Redis</td>
<td>结合用户 ID 存储，支持设置 TTL，有效控制生命周期</td>
</tr>
<tr>
<td>黑名单机制（登出）</td>
<td>用户退出登录时可删除 Redis 中 refresh token，立即失效</td>
</tr>
<tr>
<td>防止多端同时登录</td>
<td>Redis 可使用 userId 为 key，限制 refresh token 单个登录会话</td>
</tr>
<tr>
<td>Token 刷新接口限流</td>
<td>防止 refresh token 被滥用（加防重放、限频）</td>
</tr>
<tr>
<td>Token 刷新重发保护</td>
<td>Redis 设置短期 refresh token 使用标记，防止并发重复刷新</td>
</tr>
</tbody>
</table>
<p>退出策略：</p>
<p>用户点击退出：</p>
<ul>
<li>删除 Redis 中的 refresh token（或设置为无效标记）；</li>
<li>access token 因为是 JWT，不可被撤销，可考虑实现<strong>黑名单机制</strong>（例如 Redis 中维护一张 token 黑名单）；</li>
</ul>
<p>黑名单适用于<strong>高安全场景</strong>（如后台管理系统），但会略增加接口访问时的 Redis 查询压力。</p>
<p>jwt拦截器：</p>
<ol>
<li><strong>认证拦截器</strong>：先检查请求头是否有 access token，没有就返回 401；有则解析 token，校验用户信息是否存在。</li>
</ol>
<ul>
<li>第一个拦截器先校验请求头是否有 access token，没有的话直接返回 401；第二个拦截器在 access token 有效时，额外检查是否快过期（比如剩余时间 &lt; 10 分钟），如果是就用 refresh token 去 Redis 换全新的 access token 和 refresh token（这里要注意刷新时的原子性，避免并发问题）。</li>
</ul>
<ol>
<li>刷新拦截器：如果 access token 剩余有效期 &lt; 10 分钟，就用请求头中的 refresh token 去 Redis 校验：
<ul>
<li>校验通过的话，生成新的 access token 和 refresh token（新 refresh token 会覆盖 Redis 中的旧值，保证单设备登录）；</li>
<li>校验失败的话，直接让用户重新登录。</li>
</ul>
</li>
</ol>
<p>危险：</p>
<p>前端或攻击者<strong>拿到密钥（如部署泄露、浏览器调试泄露）</strong>，就可以伪造合法 token。</p>
<p>token 内容是可解密的，攻击者可<strong>猜测或修改 payload</strong>，然后重新签名。</p>
<p>如果服务端<strong>未验证签名</strong>（有些误用场景会只解析不校验），更容易被利用。</p>
<p>但还是sh256更快，计算算开销低；对称密钥管理更简单，适用于内部系统或中小型项目；</p>
<p>开发成本更低，不涉及证书管理、公私钥分发；</p>
<table>
<thead>
<tr>
<th>措施</th>
<th>说明</th>
</tr>
</thead>
<tbody>
<tr>
<td>✅ 使用强密钥</td>
<td>至少 256 bit 的复杂密钥，不可硬编码进前端或代码中</td>
</tr>
<tr>
<td>✅ 启用 HTTPS</td>
<td>防止 token 被中间人劫持</td>
</tr>
<tr>
<td>✅ token 签名校验</td>
<td>每次都校验 JWT 的签名，防止伪造</td>
</tr>
<tr>
<td>✅ 缩短 access token 有效期</td>
<td>缩小攻击窗口</td>
</tr>
<tr>
<td>✅ refresh token 存 Redis</td>
<td>结合用户 ID 防重放、防伪造</td>
</tr>
<tr>
<td>✅ 黑名单机制 + 登出清除</td>
<td>登出时使 refresh token 无效</td>
</tr>
<tr>
<td>✅ 检查 UA/IP 等指纹</td>
<td>防止 token 被别人拿去复用</td>
</tr>
</tbody>
</table>
<h2 id="5-看你在优惠劵的发放的时候使用限流，怎么设计的">5.看你在优惠劵的发放的时候使用限流，怎么设计的</h2>
<p>我们在优惠券领取接口中用 AOP + 令牌桶实现限流</p>
<ul>
<li><strong>注解定义</strong>：<code>@RateLimit</code> 注解标注需要限流的方法，参数包括 <code>limitCount=5</code>（每分钟 5 次）、<code>time=1</code>（时间单位分钟）、<code>keyType=&quot;USER_IP&quot;</code>（按用户 IP+ID 限流）。</li>
<li><strong>切面实现</strong>：通过 <code>@Around</code> 切面拦截注解方法，获取参数后生成唯一限流 key（例如 <code>rate_limit:user_123:192.168.1.1</code>），然后调用 Redis 令牌桶服务校验。</li>
<li><strong>Redis 令牌桶</strong>：用 Lua 脚本实现原子性校验，核心是根据时间戳计算可生成的新令牌数，不足时拒绝请求。比如用户抢优惠券时，同一 IP+ID 每分钟最多 5 次请求，防止恶意刷接口。</li>
</ul>
<ol>
<li><strong>防重复领取</strong>：避免用户短时间内多次点击接口，导致优惠券<strong>超发</strong>；</li>
<li><strong>保护服务端</strong>：峰值流量时限制请求频率，防止 Redis 或数据库被击穿。线上遇到过同一 WiFi 下多个用户被误限的情况，后来把 key 改为`IP+用户ID，减少了误判率。”</li>
</ol>
<p>切面类如何获取注解：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RateLimitAspect</span> &#123;</span><br><span class="line">    <span class="meta">@Pointcut(&quot;@annotation(com.example.RateLimit)&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">rateLimitPointcut</span><span class="params">()</span> &#123;&#125;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Around(&quot;rateLimitPointcut()&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">around</span><span class="params">(ProceedingJoinPoint joinPoint)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        <span class="comment">// 获取方法上的注解</span></span><br><span class="line">        <span class="type">Method</span> <span class="variable">method</span> <span class="operator">=</span> ((MethodSignature) joinPoint.getSignature()).getMethod();</span><br><span class="line">        <span class="type">RateLimit</span> <span class="variable">rateLimit</span> <span class="operator">=</span> method.getAnnotation(RateLimit.class);</span><br><span class="line">        <span class="type">int</span> <span class="variable">limitCount</span> <span class="operator">=</span> rateLimit.limitCount();</span><br><span class="line">        <span class="type">long</span> <span class="variable">time</span> <span class="operator">=</span> rateLimit.time();</span><br><span class="line">        <span class="type">String</span> <span class="variable">keyType</span> <span class="operator">=</span> rateLimit.keyType();</span><br><span class="line">        </span><br><span class="line">        <span class="comment">// 生成限流key（IP+用户ID）</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">key</span> <span class="operator">=</span> generateKey(joinPoint, keyType);</span><br><span class="line">        <span class="comment">// 调用Redis令牌桶校验</span></span><br><span class="line">        <span class="type">boolean</span> <span class="variable">allow</span> <span class="operator">=</span> redisBucketService.tryAcquire(key, limitCount, time, TimeUnit.MINUTES);</span><br><span class="line">        <span class="keyword">if</span> (!allow) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;请求频繁，请稍后再试&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> joinPoint.proceed();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>为什么选令牌桶而不是漏桶？</p>
<p>令牌桶适合突发流量，漏桶适合平滑流量</p>
<p>使用redis+lua原子的存储令牌桶，使用时间戳来校验。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">-- 令牌桶Lua脚本（简化版）</span><br><span class="line"><span class="type">local</span> <span class="variable">key</span> <span class="operator">=</span> KEYS[<span class="number">1</span>]  -- 限流key</span><br><span class="line"><span class="type">local</span> <span class="variable">capacity</span> <span class="operator">=</span> tonumber(ARGV[<span class="number">1</span>])  -- 桶容量</span><br><span class="line"><span class="type">local</span> <span class="variable">rate</span> <span class="operator">=</span> tonumber(ARGV[<span class="number">2</span>])  -- 令牌生成速率（个/秒）</span><br><span class="line"><span class="type">local</span> <span class="variable">now</span> <span class="operator">=</span> tonumber(ARGV[<span class="number">3</span>])  -- 当前时间戳</span><br><span class="line"><span class="type">local</span> <span class="variable">requested</span> <span class="operator">=</span> tonumber(ARGV[<span class="number">4</span>])  -- 请求令牌数</span><br><span class="line"></span><br><span class="line">-- 读取上次更新时间和剩余令牌数</span><br><span class="line"><span class="type">local</span> <span class="variable">last</span> <span class="operator">=</span> redis.call(<span class="string">&#x27;hget&#x27;</span>, key, <span class="string">&#x27;last&#x27;</span>)</span><br><span class="line"><span class="type">local</span> <span class="variable">tokens</span> <span class="operator">=</span> tonumber(redis.call(<span class="string">&#x27;hget&#x27;</span>, key, <span class="string">&#x27;tokens&#x27;</span>) or <span class="number">0</span>)</span><br><span class="line">last = last or now</span><br><span class="line"></span><br><span class="line">-- 计算可生成的新令牌数</span><br><span class="line"><span class="type">local</span> <span class="variable">delta</span> <span class="operator">=</span> now - last</span><br><span class="line"><span class="type">local</span> <span class="variable">newTokens</span> <span class="operator">=</span> math.min(capacity, tokens + delta * rate)</span><br><span class="line"><span class="keyword">if</span> newTokens &gt;= requested then</span><br><span class="line">    -- 够发令牌，更新状态</span><br><span class="line">    redis.call(<span class="string">&#x27;hset&#x27;</span>, key, <span class="string">&#x27;last&#x27;</span>, now)</span><br><span class="line">    redis.call(<span class="string">&#x27;hset&#x27;</span>, key, <span class="string">&#x27;tokens&#x27;</span>, newTokens - requested)</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span>  -- 允许访问</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>  -- 拒绝访问</span><br><span class="line">end</span><br></pre></td></tr></table></figure>
<h2 id="6-那么优惠劵的发放呢？一些列的问题呢">6.那么优惠劵的发放呢？一些列的问题呢</h2>
<p>✅ 一、关于优惠券类型的常见问题</p>
<p>❓1. 如何区分和应用不同类型的优惠券逻辑？</p>
<p><strong>面试点</strong>：策略模式、优惠金额计算方式。</p>
<p><strong>答法</strong>：</p>
<blockquote>
<p>我们用策略模式来封装每种优惠券的优惠逻辑（如满减、折扣、无门槛）。每种类型对应一个策略类，实现统一的接口方法 <code>calculateDiscount(OrderInfo order)</code>，这样能在运行时动态选择策略，便于扩展和维护。</p>
</blockquote>
<hr>
<p>✅ 二、关于接口设计的追问</p>
<p>❓2. 为什么接口是这样的？有没有考虑幂等性和安全性？</p>
<ul>
<li><code>POST /use</code> 接口可能会被重复调用，是否<strong>幂等</strong>？</li>
<li>有没有做权限控制，防止其他用户伪造请求？</li>
</ul>
<p><strong>答法</strong>：</p>
<blockquote>
<p>在使用优惠券时，为防止重复使用，我们使用 Redis + Lua 实现原子操作，同时标记优惠券为“已使用”。此外接口采用登录态校验，验证当前操作用户是否拥有该优惠券。敏感操作都要求用户登录，并记录操作日志。</p>
</blockquote>
<hr>
<p>✅ 三、关于并发处理和限领逻辑</p>
<p>❓3. 如果多用户并发领取优惠券，如何防止超发？</p>
<p><strong>答法</strong>：</p>
<blockquote>
<p>发放流程中，我们使用 Redis 的 <code>DECR</code> 或 Lua 脚本实现优惠券库存的原子扣减，保证不会发放超过设定数量。同时加锁防止并发条件下库存扣减不一致。</p>
</blockquote>
<hr>
<p>❓4. 如何限制每个用户只能领取一次？</p>
<p><strong>答法</strong>：</p>
<blockquote>
<p>Redis 中设置一个标识键：<code>user:coupon:received:&#123;couponId&#125;:&#123;userId&#125;</code>，发放前先判断这个键是否存在，避免重复发放。也可以结合布隆过滤器提前过滤无效请求。</p>
</blockquote>
<hr>
<p>✅ 四、关于时间与状态校验</p>
<p>❓5. 限时券怎么判断是否有效？服务端怎么处理时间逻辑？</p>
<p><strong>答法</strong>：</p>
<blockquote>
<p>每张优惠券记录中保存有效时间范围。使用时，服务端比对当前时间是否在有效期内。同时定时任务每天扫描过期优惠券，标记为“已过期”。</p>
</blockquote>
<hr>
<p>✅ 五、关于优惠券使用过程的逻辑判断</p>
<p>❓6. 使用时如果有多个优惠券，怎么选最优？</p>
<p><strong>答法</strong>：</p>
<blockquote>
<p>前端可以请求一个“推荐最优券”的接口，我们在服务端遍历用户可用券，调用各个策略类计算预期优惠，返回最高优惠金额对应的券。</p>
</blockquote>
<hr>
<p>✅ 六、关于优惠券与订单系统结合问题</p>
<p>❓7. 如果下单失败了，优惠券是否要恢复？</p>
<p><strong>答法</strong>：</p>
<blockquote>
<p>下单失败（如支付失败、库存不足）时，我们会在事务回滚后将优惠券状态重置为“未使用”。为了避免并发问题，使用分布式事务（如消息队列、TCC）或 Redis 回滚标记。</p>
</blockquote>
<hr>
<p>✅ 七、进阶设计问题</p>
<p>❓8. 优惠券支持“异步发放”和“定时生效”吗？</p>
<p><strong>答法</strong>：</p>
<blockquote>
<p>是的，可以结合定时任务（如 Quartz 或 Spring Schedule）实现定时发放；发放时间和有效时间字段分离，发放时写入 Redis 延时队列，当生效时间到达时插入到用户优惠券表中。</p>
</blockquote>
<hr>
<p>✅ 八、可能让你设计代码结构的问题</p>
<p>❓9. 优惠券模块的结构划分是怎样的？</p>
<p><strong>答法</strong>（示意）：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">- entity（Coupon, UserCoupon）</span><br><span class="line">- controller（CouponController）</span><br><span class="line">- service（CouponService、UseStrategy接口及实现）</span><br><span class="line">- repository（MyBatis-Plus Mapper）</span><br><span class="line">- util（金额计算工具类）</span><br></pre></td></tr></table></figure>
<hr>
<p>✅ 九、安全性问题</p>
<p>❓10. 用户伪造优惠券 ID，试图套用别人的优惠券怎么办？</p>
<p><strong>答法</strong>：</p>
<blockquote>
<p>每次使用时不仅要校验优惠券 ID 是否存在，还要校验当前登录用户是否是该优惠券持有人，只有归属校验通过才能使用。</p>
</blockquote>
<h2 id="7-AOP记录日志">7.AOP记录日志</h2>
<p>“我们用 AOP 实现了登录日志和业务日志的分类记录，核心设计是：</p>
<ul>
<li>
<p><strong>注解与策略</strong>：定义<code>@Log</code>注解标注需要记录的方法，通过<code>type()</code>参数区分<code>LOGIN</code>和<code>BUSINESS</code>类型。</p>
</li>
<li>
<p><strong>切面逻辑</strong>：拦截方法执行前后，<strong>获取用户信息、操作参数、接口耗时等数据，封装成日志对象</strong>。例如登录日志会记录 IP、设备信息，业务日志会<strong>记录操作类型</strong>（如下单、领券）和参数（如商品 ID、优惠券 ID）。</p>
</li>
<li>
<p><strong>存储优化</strong>：用 Kafka 异步写入日志，避免影响接口性能，再通过 Logstash 同步到 Elasticsearch，方便用 Kibana 按时间、用户 ID 等维度检索。</p>
</li>
</ul>
<p>举个实际场景：用户领取优惠券时，业务日志会记录<code>&#123;user_id:123, operation:&quot;领取满100减20&quot;, params:&#123;coupon_id:567&#125;, cost:87ms&#125;</code>。有次线上发现某个接口耗时突然增加，通过 ELK 检索该接口的日志，很快定位到是参数校验逻辑异常导致的。</p>
<p>我们对敏感信息做了脱敏处理，比如用户手机号会存成<code>138****5678</code>，既满足日志追溯需求，又符合数据安全规范。”</p>
<p>存储的信息，使用json进行存储</p>
<ul>
<li>登录日志：用户 ID、登录 IP、设备信息、登录时间、状态（成功 / 失败）、失败原因（如密码错误）；</li>
<li>业务日志：用户 ID、操作类型（如 “领取优惠券”“下单”）、操作内容、操作时间、接口耗时、请求参数（脱敏处理）。</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LogAspect</span> &#123;</span><br><span class="line">    <span class="meta">@Around(&quot;operationLogPointcut()&quot;)</span><span class="comment">//切入点就是注解</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">logOperation</span><span class="params">(ProceedingJoinPoint joinPoint)</span> <span class="keyword">throws</span> Throwable&#123;</span><br><span class="line">        <span class="type">Method</span> <span class="variable">method</span>  <span class="operator">=</span> ((MethodSignature)joinPoint.getSignature()).getMethod();</span><br><span class="line">        <span class="type">OperationLog</span> <span class="variable">logAnno</span> <span class="operator">=</span> method.getAnnotation(OperationLog.class);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="type">long</span> <span class="variable">start</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        <span class="type">Object</span> <span class="variable">result</span> <span class="operator">=</span> joinPoint.proceed();</span><br><span class="line">        <span class="type">long</span> <span class="variable">duration</span> <span class="operator">=</span>System.currentTimeMillis()-start;</span><br><span class="line"></span><br><span class="line">        <span class="type">LogDTO</span> <span class="variable">log</span> <span class="operator">=</span> buildLog(joinPoint,logAnno.type(),logAnno.action(),duration);</span><br><span class="line">        asyncLogUtils.record(log);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>
<p>Method获取主机额上的方法，然后建立实体类，设置参数，然后利用DTO传参，然后执行service方法，然后返回，service就是调用log,info</p>
<p>DTO层负责service和controller直接传输数据</p>
<h1>6.14模拟面试</h1>
<h2 id="1-Spring-事务的实现原理是什么？-Transactional-注解在什么情况下会失效？">1.<strong>Spring 事务的实现原理是什么？@Transactional 注解在什么情况下会失效？</strong></h2>
<p>spring事务的实现原理是基于AOP的动态代理和TransacationInterceptorh还有底层依赖</p>
<p>AOP：Spring 通过 ProxyFactoryBean 生成代理对象，默认对接口用 JDK 动态代理，对类用 CGLIB 代理；是采用cglib继承目标类的方式去创建代理类，非pulic的方法不能能继承。</p>
<p>拦截器：核心拦截器，在方法调用前后开启 / 提交 / 回滚事务，基于 ThreadLocal 存储事务状态；基于运行时异常来回滚的，所以把运行时异常给catch或者返回没指定的异常</p>
<p>底层依赖：通过 PlatformTransactionManager 接口适配不同事务管理器（如 JDBC、JPA）。</p>
<p>使用ThreadLocal存储事务的状态，（如连接、隔离级别）通过<code>TransactionSynchronizationManager</code>存在线程本地变量，保证线程安全。</p>
<p>所以基于这个情况,spring事务失效的场景有：</p>
<p>1.吃掉运行时异常没抛出：</p>
<p>2.未配置回滚规则，要配置rollbackFor=Exception.class指定类型</p>
<p>3.调用this</p>
<p>4.非public方法</p>
<p>5.事务的传播属性设置为never,not_support这种不支持事务的</p>
<p>6.调用了不支持事务的数据库</p>
<p>7.事务嵌套：</p>
<p><code>REQUIRES_NEW</code> 会挂起外部事务，<strong>提前提交</strong></p>
<p>嵌套事务用 <code>NESTED</code> 会创建 savepoint，支持回滚子事务（但数据库需支持）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 外部事务</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">outer</span><span class="params">()</span> &#123;</span><br><span class="line">    inner(); <span class="comment">// REQUIRES_NEW</span></span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(); <span class="comment">// 外部异常不会影响 inner 提交的事务</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Transactional(propagation = Propagation.REQUIRES_NEW)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">inner</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="comment">// 已提交</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Transactional 属性详解:</p>
<ul>
<li><code>propagation</code>：传播行为（如 REQUIRED：当前有事务则加入，无则新建）；</li>
<li><code>isolation</code>：隔离级别（如 READ_COMMITTED 避免脏读）；</li>
<li><code>timeout</code>：事务超时时间（如<code>timeout=30</code>秒）；</li>
<li><code>rollbackFor/rollbackForClassName</code>：指定回滚的异常类型；</li>
<li><code>noRollbackFor/noRollbackForClassName</code>：指定不回滚的异常类型。</li>
</ul>
<h2 id="2-Java-中-HashMap-在-JDK1-8-的底层实现是什么？相对于-JDK1-7-做了哪些优化？">2.<strong>Java 中 HashMap 在 JDK1.8 的底层实现是什么？相对于 JDK1.7 做了哪些优化？</strong></h2>
<p>1.8：数组+链表+红黑树，1.7数组+链表</p>
<p>尾插					头插</p>
<p>转换条件，&lt;64先扩容</p>
<p>为什么不用平衡二叉树，</p>
<p>尾插解决环的问题（线程 A 和线程 B 同时扩容 HashMap，A 处理链表时被挂起，B 完成扩容后，A 继续处理时按头插法插入元素，导致链表成环；）。</p>
<p>扩容机制 &lt;64先扩容</p>
<p>哈希算法优化：</p>
<ul>
<li>1.7：通过<code>hashCode() ^ (hashCode() &gt;&gt;&gt; 16)</code>扰动函数打散高 16 位，避免低位冲突；</li>
<li>1.8：直接使用<code>hashCode()</code>，但计算下标时用<code>(n-1) &amp; hash</code>（n 为数组长度，需是 2 的幂），例：</li>
</ul>
<p>实战：</p>
<ul>
<li><strong>性能提升</strong>：存储 1000 个哈希冲突的键时，1.7 查询需遍历链表（O (1000)），1.8 用红黑树只需 O (log2 (1000))≈10 次查询；</li>
<li><strong>内存占用</strong>：红黑树节点比链表节点多存储父节点、左右子节点指针，但若哈希冲突少，链表长度 &lt;8 时仍用链表，节省内存。”</li>
</ul>
<p>红黑树特点：</p>
<ol>
<li>节点非红即黑；</li>
<li>根节点和叶节点（null）是黑色；</li>
<li>红色节点不能相邻；</li>
<li>任意节点到叶节点的路径上黑节点数相同；<br>
插入时最多旋转 2 次即可平衡，适合 HashMap 的高频插入场景。</li>
</ol>
<p>场景：</p>
<p>“线上曾遇到 HashMap 性能问题，通过 JProfiler 发现某接口频繁操作哈希冲突严重的 Map，将 JDK1.7 升级到 1.8 后，接口响应时间从 500ms 降至 50ms，主要得益于红黑树对高冲突场景的优化。”</p>
<h2 id="3-Spring-Bean-的生命周期是怎样的？-PostConstruct-和-PreDestroy-的作用是什么？">3.<strong>Spring Bean 的生命周期是怎样的？@PostConstruct 和 @PreDestroy 的作用是什么？</strong></h2>
<p>实例化-&gt;初始化-&gt;使用-&gt;销毁</p>
<p><strong>实例化</strong>：通过构造器创建 Bean 实例（无参构造或工厂方法）；</p>
<p><strong>属性赋值</strong>：依赖注入（@Autowired、setter 方法等）；</p>
<p><strong>初始化前</strong>：执行 BeanPostProcessor 的<code>postProcessBeforeInitialization</code>；</p>
<p>初始化：</p>
<ol>
<li>执行 @PostConstruct 标注的方法；</li>
<li>实现 InitializingBean 接口的<code>afterPropertiesSet</code>；</li>
<li>自定义 init-method（XML 配置或 @Bean 的 initMethod 属性）；</li>
</ol>
<p><strong>初始化后</strong>：执行 BeanPostProcessor 的<code>postProcessAfterInitialization</code>；</p>
<p><strong>使用</strong>：Bean 放入容器，供应用获取使用；</p>
<p><strong>销毁前</strong>：执行 @PreDestroy 标注的方法；</p>
<p>销毁：</p>
<ol>
<li>实现 DisposableBean 接口的<code>destroy</code>；</li>
<li>自定义 destroy-method。</li>
</ol>
<p>三级缓存解决循环依赖：</p>
<p><strong>@PostConstruct 和 @PreDestroy 的执行时机</strong>：</p>
<p><strong>@PostConstruct</strong>：在依赖注入完成后，初始化方法（如 init-method）之前执行；</p>
<p><strong>@PreDestroy</strong>：在 Bean 销毁前执行，先于 destroy-method；</p>
<p>应用场景：</p>
<ul>
<li>初始化：数据库连接池初始化、缓存预热；</li>
<li>销毁：释放资源（关闭文件流、释放锁）。</li>
</ul>
<p>关键点：</p>
<ul>
<li><strong>BeanPostProcessor</strong>：初始化前后的拦截器（如 AOP 代理在此阶段创建）；</li>
<li><strong>InstantiationAwareBeanPostProcessor</strong>：属性赋值前的拦截器（可修改属性值）；</li>
<li><strong>SmartInitializingSingleton</strong>：所有单例 Bean 初始化完成后执行（适合初始化需要依赖其他 Bean 的场景）。</li>
</ul>
<p>问题解决：</p>
<ul>
<li>问题：ServiceA 依赖 ServiceB，ServiceB 的 @PostConstruct 方法未完成时，ServiceA 已使用 ServiceB；</li>
<li>解决：通过<code>@DependsOn(&quot;serviceB&quot;)</code>强制 ServiceA 在 ServiceB 之后初始化，或实现<code>Ordered</code>接口指定初始化顺序。”或者是使用懒加载加载一个，或者是重新构建方法</li>
</ul>
<h2 id="4-Java-中-synchronized-和-volatile-的区别是什么？各自的应用场景有哪些？">4.<strong>Java 中 synchronized 和 volatile 的区别是什么？各自的应用场景有哪些？</strong></h2>
<ul>
<li>
<p>synchronized：</p>
<ul>
<li><strong>原子性</strong>：通过 <strong>Monitor 锁</strong>确保代码块同一时间只能被一个线程执行；</li>
<li><strong>可见性</strong>：解锁时将工作内存变量刷新到主内存；</li>
<li><strong>有序性</strong>：通过 happens-before 原则，禁止指令重排（锁的获取 / 释放形成 happens-before 关系）。</li>
</ul>
</li>
<li>
<p>volatile：</p>
<ul>
<li><strong>可见性</strong>：写操作时强制刷新主内存，读操作时强制从主内存读取；</li>
<li><strong>有序性</strong>：通过内存屏障（Memory Barrier）禁止指令重排，确保 happens-before 关系；</li>
<li><strong>不保证原子性</strong>：仅保证单次读 / 写操作的原子性，如<code>i++</code>（实际是读 - 改 - 写三步，非原子）。</li>
</ul>
</li>
</ul>
<p>内存屏障使用的时间：读写屏障，写写屏障，写读屏障</p>
<p>使用场景：</p>
<p>s:原子操作，线程安全比如hashtable</p>
<p>v:状态标记,interput</p>
<p>联合使用：单例的DCL模式，concurrenthashmap,</p>
<p>问题：</p>
<ul>
<li><strong>问题</strong>：多线程读取配置开关不生效；</li>
<li><strong>原因</strong>：配置开关未用 volatile 修饰，线程读取的是本地缓存值；</li>
<li><strong>解决</strong>：<code>volatile boolean configSwitch = false;</code>，修改后立即通知所有线程。</li>
</ul>
<h2 id="5-Java-中为什么要使用线程池？线程池如何处理异常？">5.<strong>Java 中为什么要使用线程池？线程池如何处理异常？</strong></h2>
<p><strong>线程池的核心优势系统化梳理</strong>：</p>
<ul>
<li><strong>资源复用</strong>：避免频繁创建销毁线程（创建线程耗时约 3ms，复用可降低开销）；</li>
<li><strong>控制并发数</strong>：防止并发过高导致的 OOM（如秒杀场景限制线程数保护数据库）；</li>
<li><strong>统一管理</strong>：统一设置线程名称、优先级，方便日志追踪和故障排查；</li>
<li><strong>异步处理</strong>：将耗时任务放入线程池，避免主线程阻塞（如日志异步写入）。</li>
</ul>
<p>比较单线程，多线程，和线程池</p>
<p>异常处理：</p>
<p>使用<code>try-catch</code>包裹任务</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">executor.execute(() -&gt; &#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        doTask();</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        log.error(<span class="string">&quot;任务异常&quot;</span>, e);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>通过<code>Future</code>获取异常</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Future&lt;?&gt; future = executor.submit(() -&gt; &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;任务异常&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    future.get(); <span class="comment">// 阻塞获取结果，抛出异常</span></span><br><span class="line">&#125; <span class="keyword">catch</span> (ExecutionException e) &#123;</span><br><span class="line">    log.error(<span class="string">&quot;任务异常&quot;</span>, e.getCause());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>拒绝策略<code>AbortPolicy</code>会抛出<code>RejectedExecutionException</code>，需在提交任务时捕获：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    executor.execute(task);</span><br><span class="line">&#125; <span class="keyword">catch</span> (RejectedExecutionException e) &#123;</span><br><span class="line">    log.error(<span class="string">&quot;任务被拒绝&quot;</span>, e);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>场景：</p>
<ul>
<li><strong>电商下单场景</strong>：<br>
用线程池异步处理库存扣减、积分计算等耗时任务，主线程快速返回订单创建结果，提升用户体验；</li>
<li><strong>日志系统</strong>：<br>
用线程池异步写入日志到 Kafka，避免 IO 阻塞影响业务接口响应时间。</li>
</ul>
<h1>6.19模拟面试</h1>
<h2 id="1-在-“校园餐饮系统”-项目里，你提到用了-Redis-存储-token-缓解压力，能讲讲具体怎么设计-key-的结构，以及如何保障-token-存储和读取的高效性与安全性不？">1.在 “校园餐饮系统” 项目里，你提到用了 Redis 存储 token 缓解压力，能讲讲具体怎么设计 key 的结构，以及如何保障 token 存储和读取的高效性与安全性不？</h2>
<p>我们使用 Redis 存储用户的 <code>refresh token</code>，以提升系统性能并减少数据库压力，整体设计分为三部分：<strong>Key 设计、存储结构、安全机制</strong>。</p>
<p>结构设计：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">token:refresh:&#123;userId&#125;</span><br></pre></td></tr></table></figure>
<p>这种格式能明确标识 token 类型和所属用户，保证唯一性和可读性，避免 key 冲突。</p>
<p>Value 的存储结构：</p>
<p>我们使用 Redis 的 <strong>字符串结构（String）</strong> 或 <strong>哈希结构（Hash）</strong> 存储 refresh token，取决于业务是否需要额外附加字段（如生成时间、IP、设备信息）。</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">HSET token:refresh:123 userId 123 token abc123 createdAt 2025-06-19</span><br></pre></td></tr></table></figure>
<p>设置合理的过期时间（如 7 天），使用 <code>EXPIRE</code> 或 <code>SETEX</code> 命令控制 token 生命周期。</p>
<p>Token 的生成与安全性保障：</p>
<p>Token 使用 JWT 生成，签名采用 <strong>HS256 算法</strong>（HMAC + SHA256），密钥保存在服务端配置中心或安全的 KMS（Key Management Service）中。</p>
<p>JWT 本身包含用户信息、过期时间等，生成后只将 <code>access token</code> 下发到前端，<code>refresh token</code> 则存于 Redis 中服务端管理，防止伪造。</p>
<p>认证流程：</p>
<p>登录时生成 access + refresh token：</p>
<ul>
<li>access token 返回给前端；</li>
<li>refresh token 存入 Redis，key 为 <code>token:refresh:&#123;userId&#125;</code>。</li>
</ul>
<p>前端 token 过期后，<strong>携带 refresh token 请求刷新接口</strong>；</p>
<p>后端校验 Redis 中的 refresh token，校验通过后重新生成新 token 对。</p>
<p>提前防止问题：</p>
<p><strong>防缓存穿透</strong>：使用 <strong>布隆过滤器</strong> 记录<strong>有效用户 ID 或常见请求 Key</strong>，防止恶意请求频繁查询 Redis 失败并打爆数据库。</p>
<p><strong>防击穿</strong>：为热点用户的 token <strong>设置合理 TTL</strong>，避免同一时间大批用户同时失效。</p>
<p><strong>防雪崩</strong>：TTL 设置加入随机因子，避免大批 key 同时过期。</p>
<p><strong>权限校验</strong>：请求时验证 token 是否属于当前 userId，防止越权操作。</p>
<h2 id="2-在-“MinaDB-自研轻量级数据库系统”-项目里，你实现了基于-Java-NIO-的数据页读写管理模块，提升了-3-倍访问效率，讲讲-Java-NIO-是咋在这个模块里发挥作用的，和传统-I-O-相比，具体优化点在哪呀？">2.在 “MinaDB - 自研轻量级数据库系统” 项目里，你实现了基于 Java NIO 的数据页读写管理模块，提升了 3 倍访问效率，讲讲 Java NIO 是咋在这个模块里发挥作用的，和传统 I/O 相比，具体优化点在哪呀？</h2>
<p>BIO 与 NIO 的区别：</p>
<p><strong>BIO（Blocking I/O）</strong>：每个请求需要一个线程处理，线程阻塞在 I/O 操作上，连接数一多就容易造成线程资源耗尽，系统响应慢。</p>
<p><strong>NIO（Non-blocking I/O）</strong>：通过 <strong>Selector + Channel + Buffer</strong> 实现多路复用，单线程可监听多个 Channel，避免大量线程阻塞等待，提高了资源利用率。</p>
<p>NIO 工作机制：</p>
<ul>
<li>客户端连接通过 <code>ServerSocketChannel</code> 接收；</li>
<li>每个 <code>Channel</code> 注册到 <code>Selector</code> 上，监听感兴趣的事件（如 <code>READ</code>、<code>WRITE</code>）；</li>
<li>Selector 使用 <code>select()</code> <strong>非阻塞轮询</strong>就绪事件；</li>
<li>当某个 Channel 有事件到达，就通过 <code>Buffer</code> 读写数据，由工作线程处理请求。</li>
</ul>
<p>这种模型的优势是：<strong>少量线程可处理高并发请求</strong>，适合 I/O 密集型场景。</p>
<p>数据库应用：</p>
<p>数据库系统天然是多并发场景，传统 BIO 每个连接对应一个线程，会造成线程浪费甚至上下文切换频繁；</p>
<p>使用 NIO 模型后，我们<strong>采用 Reactor 模式</strong>，用一个主线程监听所有连接事件，用线程池异步处理真正的读写请求；</p>
<p>每个客户端连接通过 Channel 注册到 Selector 上，提升了连接并发处理能力；</p>
<p>底层页式读写通过 Buffer 显著减少了系统调用次数和数据拷贝成本，提高了磁盘 I/O 效率。</p>
<p>并发控制说明：</p>
<p>因为是数据库系统，多用户可能同时对同一数据页进行访问；</p>
<p>在读写路径上，我们结合了<strong>读写锁</strong>机制和自实现的<strong>MVCC（多版本并发控制）</strong>，确保事务隔离的一致性；</p>
<p>NIO 负责连接层的高效事件处理，MVCC 负责数据访问层的并发安全。</p>
<h2 id="3-在-“校园餐饮系统”-项目里，你用-AOP-实现了操作日志自动记录，讲讲-AOP-切点是怎么定义的，怎么确保只拦截到需要记录日志的关键业务方法，又不会过度拦截影响系统性能呀？">3.在 “校园餐饮系统” 项目里，你用 AOP 实现了操作日志自动记录，讲讲 AOP 切点是怎么定义的，怎么确保只拦截到需要记录日志的关键业务方法，又不会过度拦截影响系统性能呀？</h2>
<p>我们系统中使用了 Spring AOP 来统一记录用户的操作日志，包括登录日志和业务行为日志。整体设计思路是基于 <strong>自定义注解 + 切面编程 + 策略模式</strong> 来实现灵活、可扩展的日志记录体系。</p>
<p>我们定义了一个自定义注解 <code>@LogRecord</code>，用于标记需要记录的操作方法，注解中可以配置以下元信息：</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target(ElementType.METHOD)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> LogRecord &#123;</span><br><span class="line">    LogType <span class="title function_">type</span><span class="params">()</span>; <span class="comment">// 登录日志 or 业务日志</span></span><br><span class="line">    String <span class="title function_">action</span><span class="params">()</span>; <span class="comment">// 操作行为描述，如 &quot;删除用户&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>切面实现日志拦截逻辑:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LogAspect</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Around(&quot;@annotation(logRecord)&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">recordLog</span><span class="params">(ProceedingJoinPoint pjp, LogRecord logRecord)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        <span class="comment">// 1. 获取方法签名与参数</span></span><br><span class="line">        <span class="type">MethodSignature</span> <span class="variable">signature</span> <span class="operator">=</span> (MethodSignature) pjp.getSignature();</span><br><span class="line">        <span class="type">Method</span> <span class="variable">method</span> <span class="operator">=</span> signature.getMethod();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2. 根据注解元信息决定日志类型</span></span><br><span class="line">        <span class="type">LogType</span> <span class="variable">type</span> <span class="operator">=</span> logRecord.type();</span><br><span class="line">        <span class="type">String</span> <span class="variable">action</span> <span class="operator">=</span> logRecord.action();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3. 执行方法并记录执行结果</span></span><br><span class="line">        <span class="type">Object</span> <span class="variable">result</span> <span class="operator">=</span> pjp.proceed();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 4. 将日志对象封装后交由策略类处理</span></span><br><span class="line">        <span class="type">LogContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">LogContext</span>(...);</span><br><span class="line">        logStrategyFactory.getStrategy(type).record(context);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>日志记录策略设计（策略模式）:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">LogStrategy</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">record</span><span class="params">(LogContext context)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoginLogStrategy</span> <span class="keyword">implements</span> <span class="title class_">LogStrategy</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">record</span><span class="params">(LogContext context)</span> &#123;</span><br><span class="line">        <span class="comment">// 记录用户登录成功/失败，IP、时间等</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BizLogStrategy</span> <span class="keyword">implements</span> <span class="title class_">LogStrategy</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">record</span><span class="params">(LogContext context)</span> &#123;</span><br><span class="line">        <span class="comment">// 记录用户执行的业务操作，如“删除用户”</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>策略选择通过 <code>LogStrategyFactory</code> 实现，支持按日志类型动态扩展。</p>
<p>如何保证只拦截关键方法、避免性能问题：</p>
<p>只对使用 <code>@LogRecord</code> 注解的方法进行拦截，确保业务无关方法不被扫描，避免性能浪费；</p>
<p><strong>切面逻辑尽量精简</strong>，只做元信息解析和日志上下文构建，真正的日志落盘交给异步任务处理或消息队列；</p>
<p>对不需要记录的查询类接口，不加注解，完全绕过切面执行，保障系统整体响应效率。</p>
<p>日志可选择输出到文件（使用 SLF4J + Logback），或存入数据库 / Elasticsearch，供后期审计；</p>
<p>特殊场景下（如操作异常），支持记录异常栈与执行耗时。</p>
<p>追问：：：</p>
<ul>
<li><strong>问</strong>：@Around 和 @Before 有什么区别，为什么你选用 Around？</li>
<li><strong>答</strong>：Around 能拿到方法执行前后的控制权，包括返回值和异常，更适合记录执行结果和耗时。</li>
<li><strong>问</strong>：怎么处理日志失败、落盘慢的问题？</li>
<li><strong>答</strong>：日志落盘可异步执行或通过 MQ 异步解耦，避免阻塞主流程。</li>
</ul>
<h2 id="4-Mysql的两段提交的三个步骤">4.Mysql的两段提交的三个步骤</h2>
<p>1.prepare</p>
<p>InnoDB 写入 redo log 的 prepare 状态并刷盘:</p>
<p>InnoDB 引擎将事务修改的数据写入内存（Buffer Pool）；</p>
<p>然后生成一条 redo log，标记为 <code>&quot;prepare&quot;</code> 状态；</p>
<p>调用 <code>fsync</code> 将 redo log 刷入磁盘，保证崩溃后能恢复；</p>
<p>2.binlogcommit:</p>
<p>Server 层将整个事务的逻辑操作记录为一条 binlog；</p>
<p>将 binlog 持久化刷盘，<code>fsync()</code> 确保落地。</p>
<p>3.redocommit:</p>
<p>Server 层写 binlog 成功后，通知 InnoDB；</p>
<p>InnoDB 将之前 prepare 状态的 redo log 更新为 <code>&quot;commit&quot;</code> 状态；</p>
<p>这一步是关键确认步骤，表示事务已完全提交。</p>
<p>如果 <strong>先写 binlog 再写 redo log</strong>：InnoDB 崩溃了但 binlog 有记录，主从同步出错；</p>
<p>如果 <strong>只写 redo log，不写 binlog</strong>：主库恢复没问题，但从库根本不会同步这条事务，数据不一致；</p>
<p>所以必须保证 <strong>redo log 与 binlog 一致性落盘</strong>，2PC 正是为了解决这一问题。</p>
<h2 id="5-springboot启动类注解">5.springboot启动类注解</h2>
<p>@SpringBootApplication</p>
<p>这个注解是 Spring Boot 应用的入口，<strong>是一个组合注解</strong>，等价于：</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">@Configuration</span><br><span class="line">@EnableAutoConfiguration</span><br><span class="line">@ComponentScan</span><br></pre></td></tr></table></figure>
<p><code>@Configuration</code></p>
<ul>
<li>表示这是一个配置类，等同于传统的 <code>applicationContext.xml</code>；</li>
<li>可在该类中使用 <code>@Bean</code> 定义 Bean。</li>
</ul>
<p><code>@EnableAutoConfiguration</code></p>
<ul>
<li>开启 Spring Boot 的<strong>自动配置机制</strong>；</li>
<li>会根据项目依赖的 jar 自动配置 Spring Bean（例如依赖了 spring-boot-starter-web，就会自动配置 Tomcat、Spring MVC 等）；</li>
<li>可通过 <code>exclude</code> 属性排除某些自动配置类：</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@EnableAutoConfiguration(exclude = &#123;DataSourceAutoConfiguration.class&#125;)</span><br></pre></td></tr></table></figure>
<p>它通过 <strong><code>SpringFactoriesLoader</code> + SPI机制 + 条件注解</strong>，在启动时动态加载并生效配置类。</p>
<blockquote>
<p>@Import(AutoConfigurationImportSelector.class)<br>
这个 Import 会触发 Spring 的自动导入机制；</p>
<p>AutoConfigurationImportSelector 会加载所有自动配置类</p>
<p>内部使用 <code>SpringFactoriesLoader</code> 加载 <code>spring.factories</code> 文件中所有自动配置类</p>
<p>每个自动配置类都配合有 <code>@ConditionalOn...</code> 注解，例如：</p>
<p>Spring 会根据当前 <strong>classpath</strong>、<strong>已有 Bean</strong>、<strong>配置文件内容</strong>等条件判断是否真正加载配置类；</p>
<p>从而实现了“<strong>按需加载</strong>”的自动配置。</p>
</blockquote>
<p>在springboot中约定大于配置，</p>
<p>约定大于配置是Spring Boot的核心设计理念，它通过<strong>预设合理的默认行为和项目规范</strong>，大幅减少开发者需要手动配置的步骤，从而提升开发效率和项目标准化程度。</p>
<p>理解 Spring Boot 中的“约定大于配置”原则，可以从以下几个方面来解释：</p>
<ul>
<li><strong>自动化配置</strong>：Spring Boot 提供了<strong>大量的自动化配置</strong>，通过分析项目的依赖和环境，自动配置应用程序的行为。开发者无需显式地配置每个细节，大部分常用的配置都已经预设好了。例如，引入<code>spring-boot-starter-web</code>后，Spring Boot会自动配置内嵌Tomcat和Spring MVC，无需手动编写XML。</li>
<li><strong>默认配置</strong>：Spring Boot 为诸多方面提供<strong>大量默认配置</strong>，如连接数据库、设置 Web 服务器、处理日志等。开发人员无需手动配置这些常见内容，框架已做好决策。例如，默认的日志配置可让应用程序快速输出日志信息，<strong>无需开发者额外繁琐配置日志级别、输出格式与位置等。</strong></li>
<li><strong>约定的项目结构</strong>：Spring Boot 提倡<strong>特定项目结</strong>构，通常主应用程序类（含 main 方法）置于根包，控制器类、服务类、数据访问类等分别放在相应子包，如<code>com.example.demo.controller</code>放控制器类，<code>com.example.demo.service</code>放服务类等。<strong>此约定使团队成员更易理解项目结构与组织，新成员加入项目时能快速定位各功能代码位置，提升协作效率。</strong></li>
</ul>
<p><code>@ComponentScan</code></p>
<ul>
<li>扫描当前类所在包及其子包下的所有类，识别注解如 <code>@Component</code>、<code>@Service</code>、<code>@Repository</code>、<code>@Controller</code> 并注册到 Spring 容器；</li>
<li>可指定自定义扫描路径：</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">@ComponentScan(basePackages = &#123;&quot;com.example.service&quot;, &quot;com.example.controller&quot;&#125;)</span><br></pre></td></tr></table></figure>
<p>扫描这个下面的包和他的子类</p>
<p>常见注解：</p>
<p><code>@EnableScheduling</code></p>
<ul>
<li>开启定时任务支持（配合 <code>@Scheduled</code> 使用）</li>
</ul>
<p><code>@EnableAsync</code></p>
<ul>
<li>开启异步任务支持（配合 <code>@Async</code> 使用）</li>
</ul>
<p><code>@EnableTransactionManagement</code></p>
<ul>
<li>开启事务注解支持（如 <code>@Transactional</code>）</li>
</ul>
<h2 id="6-BeanFactory-和-FactoryBean-的区别">6.<code>BeanFactory</code> 和 <code>FactoryBean</code> 的区别</h2>
<p><code>BeanFactory</code> 是 Spring 容器本身，负责管理所有 Bean；<br>
<code>FactoryBean</code> 是你自己定义的 Bean，用来创建其他 Bean。</p>
<table>
<thead>
<tr>
<th>对比点</th>
<th><code>BeanFactory</code></th>
<th><code>FactoryBean</code></th>
</tr>
</thead>
<tbody>
<tr>
<td>类型</td>
<td>接口（Spring 顶层 IOC 容器）</td>
<td>接口（自定义 Bean 的工厂）</td>
</tr>
<tr>
<td>位置</td>
<td>Spring 框架提供</td>
<td>用户自定义实现</td>
</tr>
<tr>
<td>作用</td>
<td>提供获取 Bean 的基础功能，如 <code>getBean()</code></td>
<td>用于控制某个复杂 Bean 的创建逻辑</td>
</tr>
<tr>
<td>返回对象</td>
<td>返回注册的原始 Bean 实例</td>
<td>返回由 <code>getObject()</code> 方法创建的对象</td>
</tr>
<tr>
<td>示例用途</td>
<td>XML 加载、懒加载场景用到</td>
<td>MyBatis 中用于创建 Mapper 接口代理</td>
</tr>
<tr>
<td>典型实现类</td>
<td><code>DefaultListableBeanFactory</code></td>
<td>用户自定义，如 <code>MyCarFactoryBean</code></td>
</tr>
</tbody>
</table>
<p>1️⃣ <code>BeanFactory</code> 示例（Spring 提供）</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">BeanFactory factory = new ClassPathXmlApplicationContext(&quot;beans.xml&quot;);</span><br><span class="line">UserService userService = factory.getBean(&quot;userService&quot;, UserService.class);</span><br></pre></td></tr></table></figure>
<ul>
<li><code>BeanFactory</code> 就是容器，负责“拿 Bean”。</li>
<li>常用于早期的 XML 配置方式。</li>
</ul>
<p><code>FactoryBean</code> 示例（用户自定义）</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyCarFactoryBean</span> <span class="keyword">implements</span> <span class="title class_">FactoryBean</span>&lt;Car&gt; &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Car <span class="title function_">getObject</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// 返回一个自定义创建的对象</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Car</span>(<span class="string">&quot;BMW&quot;</span>, <span class="number">2025</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Class&lt;?&gt; getObjectType() &#123;</span><br><span class="line">        <span class="keyword">return</span> Car.class;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> Car car; <span class="comment">// 实际注入的是 MyCarFactoryBean.getObject() 返回的 Car 实例</span></span><br></pre></td></tr></table></figure>
<ul>
<li>Spring 启动时会识别 <code>MyCarFactoryBean</code>，但注入时拿的是 <code>getObject()</code> 的返回值；</li>
<li>如果你想拿到 <code>FactoryBean</code> 本身，可以用：</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">CarFactoryBean</span> <span class="variable">factoryBean</span> <span class="operator">=</span> (CarFactoryBean) context.getBean(<span class="string">&quot;&amp;carFactoryBean&quot;</span>);</span><br></pre></td></tr></table></figure>
<p><code>beanFactory</code> 是 Spring 的底层 IOC 容器接口，提供了 Bean 的获取、懒加载等功能。<br>
<code>FactoryBean</code> 是一个用于创建 Bean 的“工厂类”，由我们<strong>自定义创建逻辑</strong>，它本身是一个 Bean，但它返回的对象是 <code>getObject()</code> 产生的。<br>
例如：MyBatis 就是通过 FactoryBean 动态创建 Mapper 接口代理对象。</p>
<h2 id="7-MyBatis-Mapper-注册过程">7.MyBatis Mapper 注册过程</h2>
<p><strong>动态代理、FactoryBean、Configuration 注册流程</strong>的理解</p>
<p>MyBatis 使用 <code>MapperFactoryBean</code> 将<strong>接口注册为代理对象</strong>，启动时会把接口方法解析成 <code>MappedStatement</code> 存入 Configuration 中，运行时由 <code>MapperProxy</code> 通过反射动态执行 SQL。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">       XML or <span class="meta">@MapperScan</span></span><br><span class="line">              ↓</span><br><span class="line">  【Mapper接口注册】 → 注册到 Configuration.mapperRegistry</span><br><span class="line">              ↓</span><br><span class="line">  【创建代理类】 MapperProxyFactory → MapperProxy</span><br><span class="line">              ↓</span><br><span class="line">【执行 SQL】 通过 SqlSession 执行对应 MappedStatement</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>1.@MapperScan 启动时扫描 Mapper 接口</p>
<p><code>@MapperScan</code> 会注册 <code>MapperScannerConfigurer</code> 或 <code>MapperScannerRegistrar</code>；</p>
<p>它们会扫描包下所有接口，<strong>对每个接口注册一个 <code>MapperFactoryBean</code> 到 Spring 容器中</strong>。</p>
<p>2.<strong>每个 Mapper 接口注册成一个 MapperFactoryBean</strong></p>
<p><strong>MapperFactoryBean</strong> 实现了 Spring 的 <code>FactoryBean</code> 接口；</p>
<p>它不会直接注入自身，而是调用 <code>getObject()</code> 返回 Mapper 接口的代理类。</p>
<p>3.MapperProxyFactory 创建代理类</p>
<p>返回的是一个 <strong>MapperProxy 的动态代理对象</strong>，底层通过 <code>Proxy.newProxyInstance(...)</code> 实现；</p>
<p>所以你注入的 <code>UserMapper</code> 实际是 MapperProxy 代理类。</p>
<p>4.代理对象调用方法时执行 SQL</p>
<p><code>MapperMethod</code> 会查找 <code>Configuration</code> 中注册的 <code>MappedStatement</code>；</p>
<p>调用 <code>sqlSession.selectOne(...)</code> 或 <code>insert(...)</code> 等执行 SQL；</p>
<p>SQL 语句和参数映射都来源于 XML 或注解注册的 MappedStatement。</p>
<p>5.在 <code>SqlSessionFactoryBuilder.build()</code> 构建过程中，MyBatis 会：</p>
<ul>
<li>加载 XML 映射文件或注解 Mapper；</li>
<li>把每个 <code>&lt;mapper&gt;</code> 里的 SQL 语句解析为 <code>MappedStatement</code>；</li>
<li>调用 <code>Configuration.addMappedStatement()</code> 注册到全局配置里；</li>
<li>最终保存在 <code>configuration.getMappedStatements()</code> 的 Map 中。</li>
</ul>
</article><div class="post-copyright"><div class="copyright-cc-box"><i class="anzhiyufont anzhiyu-icon-copyright"></i></div><div class="post-copyright__author_box"><a class="post-copyright__author_img" href="/" title="头像"><img class="post-copyright__author_img_back" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://skymirror-1322372781.cos.ap-beijing.myqcloud.com/202407230955363.jpg" title="头像" alt="头像"><img class="post-copyright__author_img_front" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://skymirror-1322372781.cos.ap-beijing.myqcloud.com/202407230955363.jpg" title="头像" alt="头像"></a><div class="post-copyright__author_name">mengnankkzhou</div><div class="post-copyright__author_desc">不要走捏</div></div><div class="post-copyright__post__info"><a class="post-copyright__original" title="该文章为原创文章，注意版权协议" href="https://blog.tokenlen.top/2025/06/11/towork/working1/">原创</a><a class="post-copyright-title"><span onclick="rm.copyPageUrl('https://blog.tokenlen.top/2025/06/11/towork/working1/')">面试模拟-202506</span></a></div><div class="post-tools" id="post-tools"><div class="post-tools-left"><div class="rewardLeftButton"></div><div class="shareRight"><div class="share-link mobile"><div class="share-qrcode"><div class="share-button" title="使用手机访问这篇文章"><i class="anzhiyufont anzhiyu-icon-qrcode"></i></div><div class="share-main"><div class="share-main-all"><div id="qrcode" title="https://blog.tokenlen.top/2025/06/11/towork/working1/"></div><div class="reward-dec">使用手机访问这篇文章</div></div></div></div></div><div class="share-link weibo"><a class="share-button" target="_blank" href="https://service.weibo.com/share/share.php?title=面试模拟-202506&amp;url=https://blog.tokenlen.top/2025/06/11/towork/working1/&amp;pic=https://skymirror-1322372781.cos.ap-beijing.myqcloud.com/20250126175712180.jpg?_r_=62b12b1e-027e-0455-7412-733e5fa8ad41" rel="external nofollow noreferrer noopener"><i class="anzhiyufont anzhiyu-icon-weibo"></i></a></div><script>function copyCurrentPageUrl() {
  var currentPageUrl = window.location.href;
  var input = document.createElement("input");
  input.setAttribute("value", currentPageUrl);
  document.body.appendChild(input);
  input.select();
  input.setSelectionRange(0, 99999);
  document.execCommand("copy");
  document.body.removeChild(input);
}</script><div class="share-link copyurl"><div class="share-button" id="post-share-url" title="复制链接" onclick="copyCurrentPageUrl()"><i class="anzhiyufont anzhiyu-icon-link"></i></div></div></div></div></div><div class="post-copyright__notice"><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://blog.tokenlen.top" target="_blank">mengnankkのblog</a>！</span></div></div><div class="post-tools-right"><div class="tag_share"><div class="post-meta__box"><div class="post-meta__box__category-list"><a class="post-meta__box__categoryes" href="/categories/%E9%9D%A2%E7%BB%8F/"><span class="categoryes-punctuation"> <i class="anzhiyufont anzhiyu-icon-inbox"></i></span>面经<span class="categoryesPageCount">4</span></a></div><div class="post-meta__box__tag-list"><a class="post-meta__box__tags" href="/tags/%E9%9D%A2%E8%AF%95/"><span class="tags-punctuation"> <i class="anzhiyufont anzhiyu-icon-tag"></i></span>面试<span class="tagsPageCount">24</span></a></div></div><div class="post_share"><div class="social-share" data-image="https://skymirror-1322372781.cos.ap-beijing.myqcloud.com/202410051722382.jpg?_r_=4ef10f2e-41c4-8a83-25b9-23bbd54e0552" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/css/share.min.css" media="print" onload="this.media='all'"/><script src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/sharejs/dist/js/social-share.min.js" defer="defer"></script></div></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2025/06/10/workmenu/reggie2/"><img class="prev-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://skymirror-1322372781.cos.ap-beijing.myqcloud.com/202407221837601.jpeg?_r_=d3cf8379-9010-aacb-e0ef-64b212cfd472" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">瑞吉外卖逻辑分析</div></div></a></div><div class="next-post pull-right"><a href="/2025/06/11/lastteam/shuziluoji/"><img class="next-cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://skymirror-1322372781.cos.ap-beijing.myqcloud.com/202407221811725.jpeg?_r_=56a04a02-718f-d58f-b949-9d84476a4946" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">数字逻辑期末复习</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="anzhiyufont anzhiyu-icon-thumbs-up fa-fw" style="font-size: 1.5rem; margin-right: 4px"></i><span>喜欢这篇文章的人也看了</span></div><div class="relatedPosts-list"><div><a href="/2025/05/27/java-stack/javasample1/" title="JAVA设计模式面试题目hot"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://skymirror-1322372781.cos.ap-beijing.myqcloud.com/202407221837602.jpg?_r_=c2ef60fa-c891-26be-9ad1-4dfe9d9aa62c" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-05-27</div><div class="title">JAVA设计模式面试题目hot</div></div></a></div><div><a href="/2025/05/25/java-stack/jvm2/" title="JVM-java虚拟机hot面试"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://skymirror-1322372781.cos.ap-beijing.myqcloud.com/202410051722379.jpg?_r_=41e7d7e8-f339-5496-34ba-72657a4354b5" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-05-25</div><div class="title">JVM-java虚拟机hot面试</div></div></a></div><div><a href="/2025/07/15/java-stack/redis3/" title="redis面试hot-高并发&#x2F;高级玩法部分"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://skymirror-1322372781.cos.ap-beijing.myqcloud.com/202408081510095.jpg?_r_=f0c64402-c92a-f19f-50b9-71048de55a8c" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-07-15</div><div class="title">redis面试hot-高并发&#x2F;高级玩法部分</div></div></a></div><div><a href="/2025/05/22/java-stack/juc2/" title="JUC-线程池面试题hot"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://skymirror-1322372781.cos.ap-beijing.myqcloud.com/20250126175712181.jpg?_r_=23831538-4773-64d1-f0ed-95b492759205" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-05-22</div><div class="title">JUC-线程池面试题hot</div></div></a></div><div><a href="/2025/05/15/java-stack/redis2/" title="redis面试hot-基础部分"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://skymirror-1322372781.cos.ap-beijing.myqcloud.com/202407221818490.jpeg?_r_=ddc2d87a-3d8b-7a4f-c0b7-68fbea510a53" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-05-15</div><div class="title">redis面试hot-基础部分</div></div></a></div><div><a href="/2025/07/19/java-stack/spring3/" title="Spring面试题hot2-源码分析"><img class="cover" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://skymirror-1322372781.cos.ap-beijing.myqcloud.com/202407221811725.jpeg?_r_=10230d47-7941-7fed-6aa3-e4d9743c6280" alt="cover"><div class="content is-center"><div class="date"><i class="anzhiyufont anzhiyu-icon-calendar-days fa-fw"></i> 2025-07-19</div><div class="title">Spring面试题hot2-源码分析</div></div></a></div></div></div><hr/><div id="post-comment"><div class="comment-head"><div class="comment-headline"><i class="anzhiyufont anzhiyu-icon-comments"></i><span> 评论</span></div><div class="comment-randomInfo"><a onclick="anzhiyu.addRandomCommentInfo()" href="javascript:void(0)">匿名评论</a><a href="/privacy" style="margin-left: 4px">隐私政策</a></div><div class="comment-switch"><span class="first-comment">Twikoo</span><span id="switch-btn"></span><span class="second-comment">Valine</span></div><div class="comment-tips" id="comment-tips"><span>✅ 你无需删除空行，直接评论以获取最佳展示效果</span></div></div><div class="comment-wrap"><div><div id="twikoo-wrap"></div></div><div><div class="vcomment" id="vcomment"></div></div></div></div><div class="comment-barrage"></div></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="card-content"><div class="author-info__sayhi" id="author-info__sayhi" onclick="anzhiyu.changeSayHelloText()"></div><div class="author-info-avatar"><img class="avatar-img" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://skymirror-1322372781.cos.ap-beijing.myqcloud.com/202407230955363.jpg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-status"><img class="g-status" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/08/24/64e6ce9c507bb.png" alt="status"/></div></div><div class="author-info__description">清风拂柳影，碧水映花香。</div><div class="author-info__bottom-group"><a class="author-info__bottom-group-left" href="/"><h1 class="author-info__name">mengnankkzhou</h1><div class="author-info__desc">不要走捏</div></a><div class="card-info-social-icons is-center"><a class="social-icon faa-parent animated-hover" href="https://github.com/mengnankkkk" target="_blank" title="Github"><i class="anzhiyufont anzhiyu-icon-github"></i></a><a class="social-icon faa-parent animated-hover" href="https://space.bilibili.com/440831872" target="_blank" title="BiliBili"><i class="anzhiyufont anzhiyu-icon-bilibili"></i></a></div></div></div></div><div class="card-widget card-announcement"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bullhorn anzhiyu-shake"></i><span>公告</span></div><div class="announcement_content">欢迎来看我的博客鸭~</div></div><div class="card-widget anzhiyu-right-widget" id="card-wechat" onclick="null"><div id="flip-wrapper"><div id="flip-content"><div class="face" style="background: url(https://bu.dusays.com/2023/01/13/63c02edf44033.png) center center / 100% no-repeat"></div><div class="back face" style="background: url(https://skymirror-1322372781.cos.ap-beijing.myqcloud.com/202410021212939.jpg) center center / 100% no-repeat"></div></div></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-bars"></i><span>文章目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">1.</span> <span class="toc-text">6.11模拟面试</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E4%BB%80%E4%B9%88%E6%98%AF-Java-%E7%9A%84%E9%9D%A2%E5%90%91%E5%AF%B9%E8%B1%A1%E7%BC%96%E7%A8%8B%EF%BC%9F%E5%AE%83%E7%9A%84%E6%A0%B8%E5%BF%83%E7%89%B9%E6%80%A7%E6%9C%89%E5%93%AA%E4%BA%9B%EF%BC%9F"><span class="toc-number">1.1.</span> <span class="toc-text">1.什么是 Java 的面向对象编程？它的核心特性有哪些？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E8%AF%B4%E8%AF%B4-Java-%E4%B8%AD-ArrayList-%E5%92%8C-LinkedList-%E7%9A%84%E5%8C%BA%E5%88%AB%EF%BC%8C%E4%BB%A5%E5%8F%8A%E5%90%84%E8%87%AA%E7%9A%84%E9%80%82%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="toc-number">1.2.</span> <span class="toc-text">2.说说 Java 中 ArrayList 和 LinkedList 的区别，以及各自的适用场景</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-HashMap-%E7%9A%84%E5%BA%95%E5%B1%82%E5%8E%9F%E7%90%86"><span class="toc-number">1.3.</span> <span class="toc-text">3.HashMap 的底层原理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-Spring-%E6%A1%86%E6%9E%B6%E4%B8%AD%EF%BC%8CBean-%E7%9A%84%E4%BD%9C%E7%94%A8%E5%9F%9F%E6%9C%89%E5%93%AA%E4%BA%9B%EF%BC%9F%E8%AF%B7%E5%88%86%E5%88%AB%E8%AF%B4%E6%98%8E%E5%AE%83%E4%BB%AC%E7%9A%84%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E5%92%8C%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF"><span class="toc-number">1.4.</span> <span class="toc-text">4.Spring 框架中，Bean 的作用域有哪些？请分别说明它们的生命周期和应用场景</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-AOP-%E7%9A%84%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86"><span class="toc-number">1.5.</span> <span class="toc-text">5.AOP 的实现原理</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-MySQL-%E4%B8%AD%EF%BC%8C%E7%B4%A2%E5%BC%95%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F%E5%B8%B8%E8%A7%81%E7%9A%84%E7%B4%A2%E5%BC%95%E7%B1%BB%E5%9E%8B%E6%9C%89%E5%93%AA%E4%BA%9B%EF%BC%9F%E8%AF%B7%E8%AF%B4%E6%98%8E%E5%AE%83%E4%BB%AC%E7%9A%84%E9%80%82%E7%94%A8%E5%9C%BA%E6%99%AF%E5%92%8C%E4%BC%98%E7%BC%BA%E7%82%B9%E3%80%82"><span class="toc-number">1.6.</span> <span class="toc-text">6.MySQL 中，索引是什么？常见的索引类型有哪些？请说明它们的适用场景和优缺点。</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-MyBatis-%E7%9A%84%E4%B8%80%E7%BA%A7%E7%BC%93%E5%AD%98%E5%92%8C%E4%BA%8C%E7%BA%A7%E7%BC%93%E5%AD%98%E6%9C%BA%E5%88%B6%EF%BC%9F%E5%A6%82%E4%BD%95%E7%A6%81%E7%94%A8%E7%BC%93%E5%AD%98%EF%BC%9F"><span class="toc-number">1.7.</span> <span class="toc-text">7.MyBatis 的一级缓存和二级缓存机制？如何禁用缓存？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#8-MyBatis-Plus-%E7%9A%84-Wrapper-%E5%92%8C%E5%8E%9F%E7%94%9F-XML-%E5%86%99-SQL-%E7%9A%84%E5%8C%BA%E5%88%AB%EF%BC%9F%E4%BB%80%E4%B9%88%E6%97%B6%E5%80%99%E8%AF%A5%E7%94%A8-Wrapper%EF%BC%9F"><span class="toc-number">1.8.</span> <span class="toc-text">8.MyBatis Plus 的 Wrapper 和原生 XML 写 SQL 的区别？什么时候该用 Wrapper？</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">2.</span> <span class="toc-text">6.12模拟面试</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F%E6%9C%89%E5%93%AA%E4%BA%9B%E5%AE%9E%E7%8E%B0%E6%96%B9%E5%BC%8F%EF%BC%9F%E5%90%84%E8%87%AA%E7%9A%84%E4%BC%98%E7%BC%BA%E7%82%B9%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F%EF%BC%88%E6%AF%94%E5%A6%82%E9%A5%BF%E6%B1%89%E5%BC%8F%E3%80%81%E6%87%92%E6%B1%89%E5%BC%8F%E3%80%81%E5%8F%8C%E9%87%8D%E6%A3%80%E6%9F%A5%E9%94%81%EF%BC%8C%E8%BF%98%E6%9C%89%E9%9D%99%E6%80%81%E5%86%85%E9%83%A8%E7%B1%BB%E5%92%8C%E6%9E%9A%E4%B8%BE%E6%96%B9%E5%BC%8F%EF%BC%8C%E6%9C%89%E6%B2%A1%E6%9C%89%E7%BA%BF%E7%A8%8B%E5%AE%89%E5%85%A8%E7%9A%84%E5%9D%91%E5%91%80%EF%BC%9F%EF%BC%89"><span class="toc-number">2.1.</span> <span class="toc-text">1.单例模式有哪些实现方式？各自的优缺点是什么？（比如饿汉式、懒汉式、双重检查锁，还有静态内部类和枚举方式，有没有线程安全的坑呀？）</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E8%AF%B4%E4%B8%8BSpring-%E7%9A%84ApplicationContext%E6%98%AF%E5%8D%95%E4%BE%8B%E6%A8%A1%E5%BC%8F%E2%80%9D%E2%80%9C%E7%AD%96%E7%95%A5%E6%A8%A1%E5%BC%8F%E5%9C%A8%E6%8E%92%E5%BA%8F%E7%AE%97%E6%B3%95%E4%B8%AD%E7%9A%84%E5%BA%94%E7%94%A8%E2%80%9D"><span class="toc-number">2.2.</span> <span class="toc-text">2.说下Spring 的ApplicationContext是单例模式”“策略模式在排序算法中的应用”</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-Java-%E7%BA%BF%E7%A8%8B%E6%B1%A0%E7%9A%84%E6%A0%B8%E5%BF%83%E5%8F%82%E6%95%B0%E6%9C%89%E5%93%AA%E4%BA%9B%EF%BC%9F%E5%90%84%E8%87%AA%E7%9A%84%E4%BD%9C%E7%94%A8%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F%E6%AF%94%E5%A6%82corePoolSize%E5%92%8CmaximumPoolSize%EF%BC%8C%E5%A6%82%E4%BD%95%E6%A0%B9%E6%8D%AE%E4%B8%9A%E5%8A%A1%E5%9C%BA%E6%99%AF%E8%AE%BE%E7%BD%AE%E8%BF%99%E4%BA%9B%E5%8F%82%E6%95%B0%E5%91%80%EF%BC%9F"><span class="toc-number">2.3.</span> <span class="toc-text">3.Java 线程池的核心参数有哪些？各自的作用是什么？比如corePoolSize和maximumPoolSize，如何根据业务场景设置这些参数呀？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-%E4%BD%A0%E9%A1%B9%E7%9B%AE%E9%87%8C%E7%94%A8%E4%BA%86JWT%E5%8A%A0%E5%8F%8C-Token%EF%BC%8C%E5%85%B7%E4%BD%93%E6%98%AF%E6%80%8E%E4%B9%88%E8%AE%BE%E8%AE%A1%E7%9A%84%EF%BC%9F%E4%B8%A4%E4%B8%AA-Token-%E5%90%84%E8%87%AA%E7%9A%84%E4%BD%9C%E7%94%A8%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F%E6%8B%A6%E6%88%AA%E5%99%A8%E5%8F%88%E5%88%86%E5%88%AB%E5%A4%84%E7%90%86%E4%BB%80%E4%B9%88%E9%80%BB%E8%BE%91%EF%BC%9F%E6%AF%94%E5%A6%82%E6%9C%89%E6%B2%A1%E6%9C%89%E8%80%83%E8%99%91%E8%BF%87-Token-%E8%BF%87%E6%9C%9F%E3%80%81%E5%88%B7%E6%96%B0%E6%9C%BA%E5%88%B6%EF%BC%8C%E6%88%96%E8%80%85%E9%98%B2%E9%87%8D%E6%94%BE%E6%94%BB%E5%87%BB%E7%9A%84%E9%97%AE%E9%A2%98%EF%BC%9F"><span class="toc-number">2.4.</span> <span class="toc-text">4.你项目里用了JWT加双 Token，具体是怎么设计的？两个 Token 各自的作用是什么？拦截器又分别处理什么逻辑？比如有没有考虑过 Token 过期、刷新机制，或者防重放攻击的问题？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-%E7%9C%8B%E4%BD%A0%E5%9C%A8%E4%BC%98%E6%83%A0%E5%8A%B5%E7%9A%84%E5%8F%91%E6%94%BE%E7%9A%84%E6%97%B6%E5%80%99%E4%BD%BF%E7%94%A8%E9%99%90%E6%B5%81%EF%BC%8C%E6%80%8E%E4%B9%88%E8%AE%BE%E8%AE%A1%E7%9A%84"><span class="toc-number">2.5.</span> <span class="toc-text">5.看你在优惠劵的发放的时候使用限流，怎么设计的</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-%E9%82%A3%E4%B9%88%E4%BC%98%E6%83%A0%E5%8A%B5%E7%9A%84%E5%8F%91%E6%94%BE%E5%91%A2%EF%BC%9F%E4%B8%80%E4%BA%9B%E5%88%97%E7%9A%84%E9%97%AE%E9%A2%98%E5%91%A2"><span class="toc-number">2.6.</span> <span class="toc-text">6.那么优惠劵的发放呢？一些列的问题呢</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-AOP%E8%AE%B0%E5%BD%95%E6%97%A5%E5%BF%97"><span class="toc-number">2.7.</span> <span class="toc-text">7.AOP记录日志</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">3.</span> <span class="toc-text">6.14模拟面试</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-Spring-%E4%BA%8B%E5%8A%A1%E7%9A%84%E5%AE%9E%E7%8E%B0%E5%8E%9F%E7%90%86%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F-Transactional-%E6%B3%A8%E8%A7%A3%E5%9C%A8%E4%BB%80%E4%B9%88%E6%83%85%E5%86%B5%E4%B8%8B%E4%BC%9A%E5%A4%B1%E6%95%88%EF%BC%9F"><span class="toc-number">3.1.</span> <span class="toc-text">1.Spring 事务的实现原理是什么？@Transactional 注解在什么情况下会失效？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-Java-%E4%B8%AD-HashMap-%E5%9C%A8-JDK1-8-%E7%9A%84%E5%BA%95%E5%B1%82%E5%AE%9E%E7%8E%B0%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F%E7%9B%B8%E5%AF%B9%E4%BA%8E-JDK1-7-%E5%81%9A%E4%BA%86%E5%93%AA%E4%BA%9B%E4%BC%98%E5%8C%96%EF%BC%9F"><span class="toc-number">3.2.</span> <span class="toc-text">2.Java 中 HashMap 在 JDK1.8 的底层实现是什么？相对于 JDK1.7 做了哪些优化？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-Spring-Bean-%E7%9A%84%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E6%98%AF%E6%80%8E%E6%A0%B7%E7%9A%84%EF%BC%9F-PostConstruct-%E5%92%8C-PreDestroy-%E7%9A%84%E4%BD%9C%E7%94%A8%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F"><span class="toc-number">3.3.</span> <span class="toc-text">3.Spring Bean 的生命周期是怎样的？@PostConstruct 和 @PreDestroy 的作用是什么？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-Java-%E4%B8%AD-synchronized-%E5%92%8C-volatile-%E7%9A%84%E5%8C%BA%E5%88%AB%E6%98%AF%E4%BB%80%E4%B9%88%EF%BC%9F%E5%90%84%E8%87%AA%E7%9A%84%E5%BA%94%E7%94%A8%E5%9C%BA%E6%99%AF%E6%9C%89%E5%93%AA%E4%BA%9B%EF%BC%9F"><span class="toc-number">3.4.</span> <span class="toc-text">4.Java 中 synchronized 和 volatile 的区别是什么？各自的应用场景有哪些？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-Java-%E4%B8%AD%E4%B8%BA%E4%BB%80%E4%B9%88%E8%A6%81%E4%BD%BF%E7%94%A8%E7%BA%BF%E7%A8%8B%E6%B1%A0%EF%BC%9F%E7%BA%BF%E7%A8%8B%E6%B1%A0%E5%A6%82%E4%BD%95%E5%A4%84%E7%90%86%E5%BC%82%E5%B8%B8%EF%BC%9F"><span class="toc-number">3.5.</span> <span class="toc-text">5.Java 中为什么要使用线程池？线程池如何处理异常？</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link"><span class="toc-number">4.</span> <span class="toc-text">6.19模拟面试</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#1-%E5%9C%A8-%E2%80%9C%E6%A0%A1%E5%9B%AD%E9%A4%90%E9%A5%AE%E7%B3%BB%E7%BB%9F%E2%80%9D-%E9%A1%B9%E7%9B%AE%E9%87%8C%EF%BC%8C%E4%BD%A0%E6%8F%90%E5%88%B0%E7%94%A8%E4%BA%86-Redis-%E5%AD%98%E5%82%A8-token-%E7%BC%93%E8%A7%A3%E5%8E%8B%E5%8A%9B%EF%BC%8C%E8%83%BD%E8%AE%B2%E8%AE%B2%E5%85%B7%E4%BD%93%E6%80%8E%E4%B9%88%E8%AE%BE%E8%AE%A1-key-%E7%9A%84%E7%BB%93%E6%9E%84%EF%BC%8C%E4%BB%A5%E5%8F%8A%E5%A6%82%E4%BD%95%E4%BF%9D%E9%9A%9C-token-%E5%AD%98%E5%82%A8%E5%92%8C%E8%AF%BB%E5%8F%96%E7%9A%84%E9%AB%98%E6%95%88%E6%80%A7%E4%B8%8E%E5%AE%89%E5%85%A8%E6%80%A7%E4%B8%8D%EF%BC%9F"><span class="toc-number">4.1.</span> <span class="toc-text">1.在 “校园餐饮系统” 项目里，你提到用了 Redis 存储 token 缓解压力，能讲讲具体怎么设计 key 的结构，以及如何保障 token 存储和读取的高效性与安全性不？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#2-%E5%9C%A8-%E2%80%9CMinaDB-%E8%87%AA%E7%A0%94%E8%BD%BB%E9%87%8F%E7%BA%A7%E6%95%B0%E6%8D%AE%E5%BA%93%E7%B3%BB%E7%BB%9F%E2%80%9D-%E9%A1%B9%E7%9B%AE%E9%87%8C%EF%BC%8C%E4%BD%A0%E5%AE%9E%E7%8E%B0%E4%BA%86%E5%9F%BA%E4%BA%8E-Java-NIO-%E7%9A%84%E6%95%B0%E6%8D%AE%E9%A1%B5%E8%AF%BB%E5%86%99%E7%AE%A1%E7%90%86%E6%A8%A1%E5%9D%97%EF%BC%8C%E6%8F%90%E5%8D%87%E4%BA%86-3-%E5%80%8D%E8%AE%BF%E9%97%AE%E6%95%88%E7%8E%87%EF%BC%8C%E8%AE%B2%E8%AE%B2-Java-NIO-%E6%98%AF%E5%92%8B%E5%9C%A8%E8%BF%99%E4%B8%AA%E6%A8%A1%E5%9D%97%E9%87%8C%E5%8F%91%E6%8C%A5%E4%BD%9C%E7%94%A8%E7%9A%84%EF%BC%8C%E5%92%8C%E4%BC%A0%E7%BB%9F-I-O-%E7%9B%B8%E6%AF%94%EF%BC%8C%E5%85%B7%E4%BD%93%E4%BC%98%E5%8C%96%E7%82%B9%E5%9C%A8%E5%93%AA%E5%91%80%EF%BC%9F"><span class="toc-number">4.2.</span> <span class="toc-text">2.在 “MinaDB - 自研轻量级数据库系统” 项目里，你实现了基于 Java NIO 的数据页读写管理模块，提升了 3 倍访问效率，讲讲 Java NIO 是咋在这个模块里发挥作用的，和传统 I&#x2F;O 相比，具体优化点在哪呀？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#3-%E5%9C%A8-%E2%80%9C%E6%A0%A1%E5%9B%AD%E9%A4%90%E9%A5%AE%E7%B3%BB%E7%BB%9F%E2%80%9D-%E9%A1%B9%E7%9B%AE%E9%87%8C%EF%BC%8C%E4%BD%A0%E7%94%A8-AOP-%E5%AE%9E%E7%8E%B0%E4%BA%86%E6%93%8D%E4%BD%9C%E6%97%A5%E5%BF%97%E8%87%AA%E5%8A%A8%E8%AE%B0%E5%BD%95%EF%BC%8C%E8%AE%B2%E8%AE%B2-AOP-%E5%88%87%E7%82%B9%E6%98%AF%E6%80%8E%E4%B9%88%E5%AE%9A%E4%B9%89%E7%9A%84%EF%BC%8C%E6%80%8E%E4%B9%88%E7%A1%AE%E4%BF%9D%E5%8F%AA%E6%8B%A6%E6%88%AA%E5%88%B0%E9%9C%80%E8%A6%81%E8%AE%B0%E5%BD%95%E6%97%A5%E5%BF%97%E7%9A%84%E5%85%B3%E9%94%AE%E4%B8%9A%E5%8A%A1%E6%96%B9%E6%B3%95%EF%BC%8C%E5%8F%88%E4%B8%8D%E4%BC%9A%E8%BF%87%E5%BA%A6%E6%8B%A6%E6%88%AA%E5%BD%B1%E5%93%8D%E7%B3%BB%E7%BB%9F%E6%80%A7%E8%83%BD%E5%91%80%EF%BC%9F"><span class="toc-number">4.3.</span> <span class="toc-text">3.在 “校园餐饮系统” 项目里，你用 AOP 实现了操作日志自动记录，讲讲 AOP 切点是怎么定义的，怎么确保只拦截到需要记录日志的关键业务方法，又不会过度拦截影响系统性能呀？</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#4-Mysql%E7%9A%84%E4%B8%A4%E6%AE%B5%E6%8F%90%E4%BA%A4%E7%9A%84%E4%B8%89%E4%B8%AA%E6%AD%A5%E9%AA%A4"><span class="toc-number">4.4.</span> <span class="toc-text">4.Mysql的两段提交的三个步骤</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#5-springboot%E5%90%AF%E5%8A%A8%E7%B1%BB%E6%B3%A8%E8%A7%A3"><span class="toc-number">4.5.</span> <span class="toc-text">5.springboot启动类注解</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#6-BeanFactory-%E5%92%8C-FactoryBean-%E7%9A%84%E5%8C%BA%E5%88%AB"><span class="toc-number">4.6.</span> <span class="toc-text">6.BeanFactory 和 FactoryBean 的区别</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#7-MyBatis-Mapper-%E6%B3%A8%E5%86%8C%E8%BF%87%E7%A8%8B"><span class="toc-number">4.7.</span> <span class="toc-text">7.MyBatis Mapper 注册过程</span></a></li></ol></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="anzhiyufont anzhiyu-icon-history"></i><span>最近发布</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2025/08/12/javase/javase4/" title="javase面试-深入源码"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://skymirror-1322372781.cos.ap-beijing.myqcloud.com/202410051722382.jpg?_r_=4ef10f2e-41c4-8a83-25b9-23bbd54e0552" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="javase面试-深入源码"/></a><div class="content"><a class="title" href="/2025/08/12/javase/javase4/" title="javase面试-深入源码">javase面试-深入源码</a><time datetime="2025-08-11T16:00:00.000Z" title="发表于 2025-08-12 00:00:00">2025-08-12</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/08/10/workmenu/forum1/" title="微服务论坛设计方案"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://skymirror-1322372781.cos.ap-beijing.myqcloud.com/202407221811725.jpeg?_r_=c145f523-c70f-48c0-c2d0-6316b05340de" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="微服务论坛设计方案"/></a><div class="content"><a class="title" href="/2025/08/10/workmenu/forum1/" title="微服务论坛设计方案">微服务论坛设计方案</a><time datetime="2025-08-09T16:00:00.000Z" title="发表于 2025-08-10 00:00:00">2025-08-10</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/08/10/workmenu/fourm2/" title="微服务论坛问题收集"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://skymirror-1322372781.cos.ap-beijing.myqcloud.com/202407221837448.jpg?_r_=99de7ccf-57bf-7694-9360-4a4c879df700" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="微服务论坛问题收集"/></a><div class="content"><a class="title" href="/2025/08/10/workmenu/fourm2/" title="微服务论坛问题收集">微服务论坛问题收集</a><time datetime="2025-08-09T16:00:00.000Z" title="发表于 2025-08-10 00:00:00">2025-08-10</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/08/09/new-stack/springcloud1/" title="SpringCloud-组件介绍"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://skymirror-1322372781.cos.ap-beijing.myqcloud.com/202407221837602.jpg?_r_=de2a8de1-b8b7-4748-1b68-7ed9d20f8e8d" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="SpringCloud-组件介绍"/></a><div class="content"><a class="title" href="/2025/08/09/new-stack/springcloud1/" title="SpringCloud-组件介绍">SpringCloud-组件介绍</a><time datetime="2025-08-08T16:00:00.000Z" title="发表于 2025-08-09 00:00:00">2025-08-09</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2025/07/29/towork/woking3/" title="面试模拟-202508"><img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://skymirror-1322372781.cos.ap-beijing.myqcloud.com/202408081510550.jpg?_r_=b7f7d40d-4260-2ed2-d5d2-36ff18acc534" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="面试模拟-202508"/></a><div class="content"><a class="title" href="/2025/07/29/towork/woking3/" title="面试模拟-202508">面试模拟-202508</a><time datetime="2025-07-28T16:00:00.000Z" title="发表于 2025-07-29 00:00:00">2025-07-29</time></div></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="footer_custom_text"><p><a style="margin-inline:5px" target="_blank" href="https://hexo.io/">
  <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shields.io/badge/Framework-Hexo-4e88f8?style=flat&logo=hexo" 
       title="博客框架为 Hexo" alt="Hexo">
</a>
<a style="margin-inline:5px" target="_blank" href="https://github.com/">
  <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shields.io/badge/Source-Github-24292f?style=flat&logo=github" 
       title="本站项目由 GitHub 托管" alt="GitHub">
</a>
<a style="margin-inline:5px" target="_blank" href="https://vercel.com/">
  <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shields.io/badge/Cloud-Vercel-000000?style=flat&logo=vercel" 
       title="使用 Vercel 部署" alt="Vercel">
</a>
<a style="margin-inline:5px" target="_blank" href="https://www.qlu.edu.cn/">
  <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shields.io/badge/University-齐鲁工业大学-0056a2?style=flat&logo=university" 
       title="齐鲁工业大学" alt="齐鲁工业大学">
</a>
<a style="margin-inline:5px" target="_blank" href="https://www.aliyun.com/">
  <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shields.io/badge/Cloud-阿里云-ff6a00?style=flat&logo=aliyun" 
       title="使用阿里云服务" alt="阿里云">
</a>
<a style="margin-inline:5px" target="_blank" href="https://cloud.tencent.com/">
  <img src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://img.shields.io/badge/Cloud-腾讯云-0a73b8?style=flat&logo=tencent-cloud" 
       title="使用腾讯云服务" alt="腾讯云">
</a></p>
</div></div><div id="footer-bar"><div class="footer-bar-links"><div class="footer-bar-left"><div id="footer-bar-tips"><div class="copyright">&copy;2023 - 2025 By <a class="footer-bar-link" href="/" title="mengnankkzhou" target="_blank">mengnankkzhou</a></div></div><div id="footer-type-tips"></div></div><div class="footer-bar-right"><a class="footer-bar-link" target="_blank" rel="noopener" href="https://beian.miit.gov.cn/" title="鲁ICP备2024110758号">鲁ICP备2024110758号</a><a class="footer-bar-link" href="https://blog.tokenlen.top/rss2.xml" title="Rss">Rss</a><a class="footer-bar-link cc" href="/pravite" title="cc协议"><i class="anzhiyufont anzhiyu-icon-copyright-line"></i><i class="anzhiyufont anzhiyu-icon-creative-commons-by-line"></i><i class="anzhiyufont anzhiyu-icon-creative-commons-nc-line"></i><i class="anzhiyufont anzhiyu-icon-creative-commons-nd-line"></i></a></div></div></div></footer></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="sidebar-site-data site-data is-center"><a href="/archives/" title="archive"><div class="headline">文章</div><div class="length-num">162</div></a><a href="/tags/" title="tag"><div class="headline">标签</div><div class="length-num">49</div></a><a href="/categories/" title="category"><div class="headline">分类</div><div class="length-num">25</div></a></div><span class="sidebar-menu-item-title">功能</span><div class="sidebar-menu-item"><a class="darkmode_switchbutton menu-child" href="javascript:void(0);" title="显示模式"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span>显示模式</span></a></div><div class="back-menu-list-groups"><div class="back-menu-list-group"><div class="back-menu-list-title">网页</div><div class="back-menu-list"><a class="back-menu-item" href="https://blog.tokenlen.top/" title="博客"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="博客"/><span class="back-menu-item-text">博客</span></a><a class="back-menu-item" target="_blank" rel="noopener" href="http://img.mengnankk.top:9001/" title="图床"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="/img/favicon.ico" alt="图床"/><span class="back-menu-item-text">图床</span></a></div></div><div class="back-menu-list-group"><div class="back-menu-list-title">项目</div><div class="back-menu-list"><a class="back-menu-item" target="_blank" rel="noopener" href="http://img.mengnankk.top:9001/" title="mengnankk图床"><img class="back-menu-item-icon" src= "data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7" onerror="this.onerror=null,this.src=&quot;/img/404.jpg&quot;" data-lazy-src="https://bu.dusays.com/2023/08/13/64d8c2653332e.ico" alt="mengnankk图床"/><span class="back-menu-item-text">mengnankk图床</span></a></div></div></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 文章</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/archives/"><i class="anzhiyufont anzhiyu-icon-box-archive faa-tada" style="font-size: 0.9em;"></i><span> 隧道</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/categories/"><i class="anzhiyufont anzhiyu-icon-shapes faa-tada" style="font-size: 0.9em;"></i><span> 分类</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 标签</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 生活</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/album/"><i class="anzhiyufont anzhiyu-icon-images faa-tada" style="font-size: 0.9em;"></i><span> 相册集</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/essay/"><i class="anzhiyufont anzhiyu-icon-lightbulb faa-tada" style="font-size: 0.9em;"></i><span> 闲言碎语</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/music/"><i class="anzhiyufont anzhiyu-icon-music faa-tada" style="font-size: 0.9em;"></i><span> 音乐馆</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 我的</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" href="/link/"><i class="anzhiyufont anzhiyu-icon-link faa-tada" style="font-size: 0.9em;"></i><span> 友人帐</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/about/"><i class="anzhiyufont anzhiyu-icon-paper-plane faa-tada" style="font-size: 0.9em;"></i><span> 关于本人</span></a></li><li><a class="site-page child faa-parent animated-hover" href="/Message/"><i class="anzhiyufont anzhiyu-icon-envelope faa-tada" style="font-size: 0.9em;"></i><span> 留言</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><span> 其他</span></a><ul class="menus_item_child"><li><a class="site-page child faa-parent animated-hover" target="_blank" rel="noopener" href="https://home.tokenlen.top/"><i class="anzhiyufont anzhiyu-icon-envelope faa-tada" style="font-size: 0.9em;"></i><span> home</span></a></li><li><a class="site-page child faa-parent animated-hover" target="_blank" rel="noopener" href="https://status.mengnankk.asia/"><i class="anzhiyufont anzhiyu-icon-tags faa-tada" style="font-size: 0.9em;"></i><span> 站点检测</span></a></li><li><a class="site-page child faa-parent animated-hover" target="_blank" rel="noopener" href="https://home.tokenlen.top/"><i class="anzhiyufont anzhiyu-icon-lightbulb faa-tada" style="font-size: 0.9em;"></i><span> 心里话</span></a></li></ul></div></div><span class="sidebar-menu-item-title">标签</span><div class="card-tags"><div class="item-headline"></div><div class="card-tag-cloud"><a href="/tags/BF/" style="font-size: 0.88rem;">BF<sup>1</sup></a><a href="/tags/BUG/" style="font-size: 0.88rem;">BUG<sup>1</sup></a><a href="/tags/BigData/" style="font-size: 0.88rem;">BigData<sup>2</sup></a><a href="/tags/C/" style="font-size: 0.88rem;">C<sup>4</sup></a><a href="/tags/Cache/" style="font-size: 0.88rem;">Cache<sup>1</sup></a><a href="/tags/Elasticsearch/" style="font-size: 0.88rem;">Elasticsearch<sup>1</sup></a><a href="/tags/English/" style="font-size: 0.88rem;">English<sup>9</sup></a><a href="/tags/Github/" style="font-size: 0.88rem;">Github<sup>1</sup></a><a href="/tags/Hadoop/" style="font-size: 0.88rem;">Hadoop<sup>2</sup></a><a href="/tags/Linux/" style="font-size: 0.88rem;">Linux<sup>12</sup></a><a href="/tags/Nginx/" style="font-size: 0.88rem;">Nginx<sup>1</sup></a><a href="/tags/SpringAI/" style="font-size: 0.88rem;">SpringAI<sup>2</sup></a><a href="/tags/SpringCloud/" style="font-size: 0.88rem;">SpringCloud<sup>1</sup></a><a href="/tags/XSS/" style="font-size: 0.88rem;">XSS<sup>1</sup></a><a href="/tags/css/" style="font-size: 0.88rem;">css<sup>2</sup></a><a href="/tags/docker/" style="font-size: 0.88rem;">docker<sup>1</sup></a><a href="/tags/git/" style="font-size: 0.88rem;">git<sup>1</sup></a><a href="/tags/html/" style="font-size: 0.88rem;">html<sup>1</sup></a><a href="/tags/java/" style="font-size: 0.88rem;">java<sup>57</sup></a><a href="/tags/juc/" style="font-size: 0.88rem;">juc<sup>2</sup></a><a href="/tags/jvm/" style="font-size: 0.88rem;">jvm<sup>2</sup></a><a href="/tags/leetcode/" style="font-size: 0.88rem;">leetcode<sup>10</sup></a><a href="/tags/mysql/" style="font-size: 0.88rem;">mysql<sup>16</sup></a><a href="/tags/net/" style="font-size: 0.88rem;">net<sup>7</sup></a><a href="/tags/php/" style="font-size: 0.88rem;">php<sup>5</sup></a><a href="/tags/python/" style="font-size: 0.88rem;">python<sup>3</sup></a><a href="/tags/redis/" style="font-size: 0.88rem;">redis<sup>4</sup></a><a href="/tags/rocketmq/" style="font-size: 0.88rem;">rocketmq<sup>1</sup></a><a href="/tags/shell/" style="font-size: 0.88rem;">shell<sup>4</sup></a><a href="/tags/spring/" style="font-size: 0.88rem;">spring<sup>3</sup></a><a href="/tags/spring-boot/" style="font-size: 0.88rem;">spring boot<sup>14</sup></a><a href="/tags/sql/" style="font-size: 0.88rem;">sql<sup>5</sup></a><a href="/tags/web/" style="font-size: 0.88rem;">web<sup>3</sup></a><a href="/tags/%E6%95%B0%E5%AD%97%E9%80%BB%E8%BE%91/" style="font-size: 0.88rem;">数字逻辑<sup>1</sup></a><a href="/tags/%E6%95%B0%E6%8D%AE%E5%BA%93%E5%8E%9F%E7%90%86/" style="font-size: 0.88rem;">数据库原理<sup>3</sup></a><a href="/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" style="font-size: 0.88rem;">数据结构<sup>20</sup></a><a href="/tags/%E6%AD%A3%E5%88%99%E8%A1%A8%E8%BE%BE%E5%BC%8F/" style="font-size: 0.88rem;">正则表达式<sup>2</sup></a><a href="/tags/%E6%B1%87%E7%BC%96%E8%AF%AD%E8%A8%80/" style="font-size: 0.88rem;">汇编语言<sup>1</sup></a><a href="/tags/%E7%AE%97%E6%B3%95/" style="font-size: 0.88rem;">算法<sup>9</sup></a><a href="/tags/%E9%9D%A2%E8%AF%95/" style="font-size: 0.88rem;">面试<sup>24</sup></a></div></div><hr/></div></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="anzhiyufont anzhiyu-icon-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">繁</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="anzhiyufont anzhiyu-icon-arrows-left-right"></i></button></div><div id="rightside-config-show"><button id="rightside-config" type="button" title="设置"><i class="anzhiyufont anzhiyu-icon-gear"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="anzhiyufont anzhiyu-icon-list-ul"></i></button><a id="to_comment" href="#post-comment" title="直达评论"><i class="anzhiyufont anzhiyu-icon-comments"></i></a><a id="switch-commentBarrage" href="javascript:anzhiyu.switchCommentBarrage();" title="开关弹幕"><i class="anzhiyufont anzhiyu-icon-danmu"></i></a><button id="go-up" type="button" title="回到顶部"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></button></div></div><div id="nav-music"><a id="nav-music-hoverTips" onclick="anzhiyu.musicToggle()" accesskey="m">播放音乐</a><div id="console-music-bg"></div><meting-js id="8152976493" server="netease" type="playlist" mutex="true" preload="none" theme="var(--anzhiyu-main)" data-lrctype="0" order="random" volume="0.7"></meting-js></div><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="anzhiyufont anzhiyu-icon-xmark"></i></button></nav><div class="is-center" id="loading-database"><i class="anzhiyufont anzhiyu-icon-spinner anzhiyu-pulse-icon"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div id="local-search-results"></div></div></div><div id="search-mask"></div></div><div id="rightMenu"><div class="rightMenu-group rightMenu-small"><div class="rightMenu-item" id="menu-backward"><i class="anzhiyufont anzhiyu-icon-arrow-left"></i></div><div class="rightMenu-item" id="menu-forward"><i class="anzhiyufont anzhiyu-icon-arrow-right"></i></div><div class="rightMenu-item" id="menu-refresh"><i class="anzhiyufont anzhiyu-icon-arrow-rotate-right" style="font-size: 1rem;"></i></div><div class="rightMenu-item" id="menu-top"><i class="anzhiyufont anzhiyu-icon-arrow-up"></i></div></div><div class="rightMenu-group rightMenu-line rightMenuPlugin"><div class="rightMenu-item" id="menu-copytext"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制选中文本</span></div><div class="rightMenu-item" id="menu-pastetext"><i class="anzhiyufont anzhiyu-icon-paste"></i><span>粘贴文本</span></div><a class="rightMenu-item" id="menu-commenttext"><i class="anzhiyufont anzhiyu-icon-comment-medical"></i><span>引用到评论</span></a><div class="rightMenu-item" id="menu-newwindow"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开</span></div><div class="rightMenu-item" id="menu-copylink"><i class="anzhiyufont anzhiyu-icon-link"></i><span>复制链接地址</span></div><div class="rightMenu-item" id="menu-copyimg"><i class="anzhiyufont anzhiyu-icon-images"></i><span>复制此图片</span></div><div class="rightMenu-item" id="menu-downloadimg"><i class="anzhiyufont anzhiyu-icon-download"></i><span>下载此图片</span></div><div class="rightMenu-item" id="menu-newwindowimg"><i class="anzhiyufont anzhiyu-icon-window-restore"></i><span>新窗口打开图片</span></div><div class="rightMenu-item" id="menu-search"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>站内搜索</span></div><div class="rightMenu-item" id="menu-searchBaidu"><i class="anzhiyufont anzhiyu-icon-magnifying-glass"></i><span>百度搜索</span></div><div class="rightMenu-item" id="menu-music-toggle"><i class="anzhiyufont anzhiyu-icon-play"></i><span>播放音乐</span></div><div class="rightMenu-item" id="menu-music-back"><i class="anzhiyufont anzhiyu-icon-backward"></i><span>切换到上一首</span></div><div class="rightMenu-item" id="menu-music-forward"><i class="anzhiyufont anzhiyu-icon-forward"></i><span>切换到下一首</span></div><div class="rightMenu-item" id="menu-music-playlist" onclick="window.open(&quot;https://y.qq.com/n/ryqq/playlist/8802438608&quot;, &quot;_blank&quot;);" style="display: none;"><i class="anzhiyufont anzhiyu-icon-radio"></i><span>查看所有歌曲</span></div><div class="rightMenu-item" id="menu-music-copyMusicName"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制歌名</span></div></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item menu-link" id="menu-randomPost"><i class="anzhiyufont anzhiyu-icon-shuffle"></i><span>随便逛逛</span></a><a class="rightMenu-item menu-link" href="/categories/"><i class="anzhiyufont anzhiyu-icon-cube"></i><span>博客分类</span></a><a class="rightMenu-item menu-link" href="/tags/"><i class="anzhiyufont anzhiyu-icon-tags"></i><span>文章标签</span></a></div><div class="rightMenu-group rightMenu-line rightMenuOther"><a class="rightMenu-item" id="menu-copy" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-copy"></i><span>复制地址</span></a><a class="rightMenu-item" id="menu-commentBarrage" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-message"></i><span class="menu-commentBarrage-text">关闭热评</span></a><a class="rightMenu-item" id="menu-darkmode" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-circle-half-stroke"></i><span class="menu-darkmode-text">深色模式</span></a><a class="rightMenu-item" id="menu-translate" href="javascript:void(0);"><i class="anzhiyufont anzhiyu-icon-language"></i><span>轉為繁體</span></a></div></div><div id="rightmenu-mask"></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.cbd.int/@fancyapps/ui@5.0.28/dist/fancybox/fancybox.umd.js"></script><script src="https://cdn.cbd.int/instant.page@5.2.0/instantpage.js" type="module"></script><script src="https://cdn.cbd.int/vanilla-lazyload@17.8.5/dist/lazyload.iife.min.js"></script><script src="https://cdn.cbd.int/node-snackbar@0.1.16/dist/snackbar.min.js"></script><script>function panguFn () {
  if (typeof pangu === 'object') pangu.autoSpacingPage()
  else {
    getScript('https://cdn.cbd.int/pangu@4.0.7/dist/browser/pangu.min.js')
      .then(() => {
        pangu.autoSpacingPage()
      })
  }
}

function panguInit () {
  if (true){
    GLOBAL_CONFIG_SITE.isPost && panguFn()
  } else {
    panguFn()
  }
}

document.addEventListener('DOMContentLoaded', panguInit)</script><canvas id="universe"></canvas><script async src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.0/dark/dark.js"></script><script>// 消除控制台打印
var HoldLog = console.log;
console.log = function () {};
let now1 = new Date();
queueMicrotask(() => {
  const Log = function () {
    HoldLog.apply(console, arguments);
  }; //在恢复前输出日志
  const grt = new Date("04/01/2021 00:00:00"); //此处修改你的建站时间或者网站上线时间
  now1.setTime(now1.getTime() + 250);
  const days = (now1 - grt) / 1000 / 60 / 60 / 24;
  const dnum = Math.floor(days);
  const ascll = [
    `欢迎使用安知鱼!`,
    `生活明朗, 万物可爱`,
    `
        
       █████╗ ███╗   ██╗███████╗██╗  ██╗██╗██╗   ██╗██╗   ██╗
      ██╔══██╗████╗  ██║╚══███╔╝██║  ██║██║╚██╗ ██╔╝██║   ██║
      ███████║██╔██╗ ██║  ███╔╝ ███████║██║ ╚████╔╝ ██║   ██║
      ██╔══██║██║╚██╗██║ ███╔╝  ██╔══██║██║  ╚██╔╝  ██║   ██║
      ██║  ██║██║ ╚████║███████╗██║  ██║██║   ██║   ╚██████╔╝
      ╚═╝  ╚═╝╚═╝  ╚═══╝╚══════╝╚═╝  ╚═╝╚═╝   ╚═╝    ╚═════╝
        
        `,
    "已上线",
    dnum,
    "天",
    "©2023 By 安知鱼 V1.6.12",
  ];
  const ascll2 = [`NCC2-036`, `调用前置摄像头拍照成功，识别为【小笨蛋】.`, `Photo captured: `, `🤪`];

  setTimeout(
    Log.bind(
      console,
      `\n%c${ascll[0]} %c ${ascll[1]} %c ${ascll[2]} %c${ascll[3]}%c ${ascll[4]}%c ${ascll[5]}\n\n%c ${ascll[6]}\n`,
      "color:#425AEF",
      "",
      "color:#425AEF",
      "color:#425AEF",
      "",
      "color:#425AEF",
      ""
    )
  );
  setTimeout(
    Log.bind(
      console,
      `%c ${ascll2[0]} %c ${ascll2[1]} %c \n${ascll2[2]} %c\n${ascll2[3]}\n`,
      "color:white; background-color:#4fd953",
      "",
      "",
      'background:url("https://npm.elemecdn.com/anzhiyu-blog@1.1.6/img/post/common/tinggge.gif") no-repeat;font-size:450%'
    )
  );

  setTimeout(Log.bind(console, "%c WELCOME %c 你好，小笨蛋.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(
      console,
      "%c ⚡ Powered by 安知鱼 %c 你正在访问 mengnankkzhou 的博客.",
      "color:white; background-color:#f0ad4e",
      ""
    )
  );

  setTimeout(Log.bind(console, "%c W23-12 %c 你已打开控制台.", "color:white; background-color:#4f90d9", ""));

  setTimeout(
    console.warn.bind(console, "%c S013-782 %c 你现在正处于监控中.", "color:white; background-color:#d9534f", "")
  );
});</script><script async src="/anzhiyu/random.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"><script>if (!window.MathJax) {
  window.MathJax = {
    tex: {
      inlineMath: [['$', '$'], ['\\(', '\\)']],
      tags: 'ams'
    },
    chtml: {
      scale: 1.1
    },
    options: {
      renderActions: {
        findScript: [10, doc => {
          for (const node of document.querySelectorAll('script[type^="math/tex"]')) {
            const display = !!node.type.match(/; *mode=display/)
            const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display)
            const text = document.createTextNode('')
            node.parentNode.replaceChild(text, node)
            math.start = {node: text, delim: '', n: 0}
            math.end = {node: text, delim: '', n: 0}
            doc.math.push(math)
          }
        }, '']
      }
    }
  }
  
  const script = document.createElement('script')
  script.src = 'https://cdn.cbd.int/mathjax@3.2.2/es5/tex-mml-chtml.js'
  script.id = 'MathJax-script'
  script.async = true
  document.head.appendChild(script)
} else {
  MathJax.startup.document.state(0)
  MathJax.texReset()
  MathJax.typesetPromise()
}</script><script>(() => {
  const init = () => {
    twikoo.init(Object.assign({
      el: '#twikoo-wrap',
      envId: 'https://comment.tokenlen.top/',
      region: '',
      onCommentLoaded: () => {
        anzhiyu.loadLightbox(document.querySelectorAll('#twikoo .tk-content img:not(.tk-owo-emotion)'))
      }
    }, "siu~~~~~"))
  }

  const loadTwikoo = () => {
    if (typeof twikoo === 'object') setTimeout(runFn,0)
    else getScript('https://cdn.cbd.int/twikoo@1.6.25/dist/twikoo.all.min.js').then(runFn)
  }

  const getCount = () => {
    const countELement = document.getElementById('twikoo-count')
    if(!countELement) return
    twikoo.getCommentsCount({
      envId: 'https://comment.tokenlen.top/',
      region: '',
      urls: [window.location.pathname],
      includeReply: false
    }).then(res => {
      countELement.textContent = res[0].count
    }).catch(err => {
      console.error(err)
    })
  }

  const runFn = () => {
    init();
    
  }

  if ('Twikoo' === 'Twikoo' || !false) {
    if (false) anzhiyu.loadComment(document.getElementById('twikoo-wrap'), loadTwikoo)
    else {
      loadTwikoo()
    }
  } else {
    window.loadOtherComment = loadTwikoo
  }
})()</script><script>(() => {
  const initValine = () => {
    const valine = new Valine(Object.assign({
      el: '#vcomment',
      appId: '3ZpuzQHHKWfFH59QFYmcuCvr-gzGzoHsz',
      appKey: '8DIvljObQp853ueQMZzpb9Gx',
      avatar: 'mp',
      serverURLs: '',
      emojiMaps: "",
      path: window.location.pathname,
      visitor: false
    }, null))
  }

  const loadValine = async () => {
    if (typeof Valine === 'function') initValine()
    else {
      await getScript('https://cdn.cbd.int/valine@1.5.1/dist/Valine.min.js')
      initValine()
    }
  }

  if ('Twikoo' === 'Valine' || !false) {
    if (false) anzhiyu.loadComment(document.getElementById('vcomment'),loadValine)
    else setTimeout(loadValine, 0)
  } else {
    window.loadOtherComment = loadValine
  }
})()</script><input type="hidden" name="page-type" id="page-type" value="post"></div><script>window.addEventListener('load', () => {
  const changeContent = (content) => {
    if (content === '') return content

    content = content.replace(/<img.*?src="(.*?)"?[^\>]+>/ig, '[图片]') // replace image link
    content = content.replace(/<a[^>]+?href=["']?([^"']+)["']?[^>]*>([^<]+)<\/a>/gi, '[链接]') // replace url
    content = content.replace(/<pre><code>.*?<\/pre>/gi, '[代码]') // replace code
    content = content.replace(/<[^>]+>/g,"") // remove html tag

    if (content.length > 150) {
      content = content.substring(0,150) + '...'
    }
    return content
  }

  const getComment = () => {
    const runTwikoo = () => {
      twikoo.getRecentComments({
        envId: 'https://comment.tokenlen.top/',
        region: '',
        pageSize: 6,
        includeReply: true
      }).then(function (res) {
        const twikooArray = res.map(e => {
          return {
            'content': changeContent(e.comment),
            'avatar': e.avatar,
            'nick': e.nick,
            'url': e.url + '#' + e.id,
            'date': new Date(e.created).toISOString()
          }
        })

        saveToLocal.set('twikoo-newest-comments', JSON.stringify(twikooArray), 10/(60*24))
        generateHtml(twikooArray)
      }).catch(function (err) {
        const $dom = document.querySelector('#card-newest-comments .aside-list')
        $dom.textContent= "无法获取评论，请确认相关配置是否正确"
      })
    }

    if (typeof twikoo === 'object') {
      runTwikoo()
    } else {
      getScript('https://cdn.cbd.int/twikoo@1.6.25/dist/twikoo.all.min.js').then(runTwikoo)
    }
  }

  const generateHtml = array => {
    let result = ''

    if (array.length) {
      for (let i = 0; i < array.length; i++) {
        result += '<div class=\'aside-list-item\'>'

        if (true) {
          const name = 'data-lazy-src'
          result += `<a href='${array[i].url}' class='thumbnail'><img ${name}='${array[i].avatar}' alt='${array[i].nick}'><div class='name'><span>${array[i].nick} </span></div></a>`
        }
        
        result += `<div class='content'>
        <a class='comment' href='${array[i].url}' title='${array[i].content}'>${array[i].content}</a>
        <time datetime="${array[i].date}">${anzhiyu.diffDate(array[i].date, true)}</time></div>
        </div>`
      }
    } else {
      result += '没有评论'
    }

    let $dom = document.querySelector('#card-newest-comments .aside-list')
    $dom && ($dom.innerHTML= result)
    window.lazyLoadInstance && window.lazyLoadInstance.update()
    window.pjax && window.pjax.refresh($dom)
  }

  const newestCommentInit = () => {
    if (document.querySelector('#card-newest-comments .aside-list')) {
      const data = saveToLocal.get('twikoo-newest-comments')
      if (data) {
        generateHtml(JSON.parse(data))
      } else {
        getComment()
      }
    }
  }

  newestCommentInit()
  document.addEventListener('pjax:complete', newestCommentInit)
})</script><script async data-pjax src="https://npm.elemecdn.com/anzhiyu-theme-static@1.0.1/bubble/bubble.js"></script><script>var visitorMail = "";
</script><script async data-pjax src="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/waterfall/waterfall.js"></script><script src="https://lf3-cdn-tos.bytecdntp.com/cdn/expire-1-M/qrcodejs/1.0.0/qrcode.min.js"></script><script src="/js/anzhiyu/right_click_menu.js"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.1.9/icon/ali_iconfont_css.css"><script defer="defer" id="fluttering_ribbon" mobile="true" src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/dist/canvas-fluttering-ribbon.min.js"></script><script id="click-show-text" src="https://cdn.cbd.int/butterfly-extsrc@1.1.3/dist/click-show-text.min.js" data-mobile="false" data-text="I,LOVE,YOU" data-fontsize="15px" data-random="false" async="async"></script><link rel="stylesheet" href="https://cdn.cbd.int/anzhiyu-theme-static@1.0.0/aplayer/APlayer.min.css" media="print" onload="this.media='all'"><script src="https://cdn.cbd.int/anzhiyu-blog-static@1.0.1/js/APlayer.min.js"></script><script src="https://cdn.cbd.int/hexo-anzhiyu-music@1.0.1/assets/js/Meting2.min.js"></script><script src="https://cdn.cbd.int/pjax@0.2.8/pjax.min.js"></script><script>let pjaxSelectors = ["meta[property=\"og:image\"]","meta[property=\"og:title\"]","meta[property=\"og:url\"]","meta[property=\"og:type\"]","meta[property=\"og:site_name\"]","meta[property=\"og:description\"]","head > title","#config-diff","#body-wrap","#rightside-config-hide","#rightside-config-show",".js-pjax"]
var pjax = new Pjax({
  elements: 'a:not([target="_blank"])',
  selectors: pjaxSelectors,
  cacheBust: false,
  analytics: false,
  scrollRestoration: false
})

document.addEventListener('pjax:send', function () {
  // removeEventListener scroll 
  anzhiyu.removeGlobalFnEvent('pjax')
  anzhiyu.removeGlobalFnEvent('themeChange')

  document.getElementById('rightside').classList.remove('rightside-show')
  
  if (window.aplayers) {
    for (let i = 0; i < window.aplayers.length; i++) {
      if (!window.aplayers[i].options.fixed) {
        window.aplayers[i].destroy()
      }
    }
  }

  typeof typed === 'object' && typed.destroy()

  //reset readmode
  const $bodyClassList = document.body.classList
  $bodyClassList.contains('read-mode') && $bodyClassList.remove('read-mode')
})

document.addEventListener('pjax:complete', function () {
  window.refreshFn()

  document.querySelectorAll('script[data-pjax]').forEach(item => {
    const newScript = document.createElement('script')
    const content = item.text || item.textContent || item.innerHTML || ""
    Array.from(item.attributes).forEach(attr => newScript.setAttribute(attr.name, attr.value))
    newScript.appendChild(document.createTextNode(content))
    item.parentNode.replaceChild(newScript, item)
  })

  GLOBAL_CONFIG.islazyload && window.lazyLoadInstance.update()

  typeof panguInit === 'function' && panguInit()

  // google analytics
  typeof gtag === 'function' && gtag('config', '', {'page_path': window.location.pathname});

  // baidu analytics
  typeof _hmt === 'object' && _hmt.push(['_trackPageview',window.location.pathname]);

  typeof loadMeting === 'function' && document.getElementsByClassName('aplayer').length && loadMeting()

  // prismjs
  typeof Prism === 'object' && Prism.highlightAll()
})

document.addEventListener('pjax:error', e => {
  if (e.request.status === 404) {
    pjax.loadUrl('/404.html')
  }
})</script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script charset="UTF-8" src="https://cdn.cbd.int/anzhiyu-theme-static@1.1.5/accesskey/accesskey.js"></script></div><div id="popup-window"><div class="popup-window-title">通知</div><div class="popup-window-divider"></div><div class="popup-window-content"><div class="popup-tip">你好呀</div><div class="popup-link"><i class="anzhiyufont anzhiyu-icon-arrow-circle-right"></i></div></div></div></body></html>