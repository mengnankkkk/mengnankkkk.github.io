<?xml version="1.0" encoding="utf-8"?>
<rss version="2.0"
  xmlns:atom="http://www.w3.org/2005/Atom"
  xmlns:content="http://purl.org/rss/1.0/modules/content/">
  <channel>
    <title>mengnankkã®blog</title>
    <link>https://blog.tokenlen.top/</link>
    
    <image>
      <url>https://blog.tokenlen.top/icon.png</url>
      <title>mengnankkã®blog</title>
      <link>https://blog.tokenlen.top/</link>
    </image>
    
    <atom:link href="https://blog.tokenlen.top/rss2.xml" rel="self" type="application/rss+xml"/>
    <atom:link href="https://pubsubhubbub.appspot.com/" rel="hub"/>
    <description>æ¸…é£æ‹‚æŸ³å½±ï¼Œç¢§æ°´æ˜ èŠ±é¦™ã€‚</description>
    <pubDate>Fri, 30 May 2025 09:22:10 GMT</pubDate>
    <generator>http://hexo.io/</generator>
    
    <item>
      <title>Git</title>
      <link>https://blog.tokenlen.top/2025/05/31/new-stack/git/</link>
      <guid>https://blog.tokenlen.top/2025/05/31/new-stack/git/</guid>
      <pubDate>Fri, 30 May 2025 16:00:00 GMT</pubDate>
      
      
      
      
      <category domain="https://blog.tokenlen.top/categories/%E6%8A%80%E6%9C%AF%E6%A0%88/">æŠ€æœ¯æ ˆ</category>
      
      
      <category domain="https://blog.tokenlen.top/tags/git/">git</category>
      
      
      <comments>https://blog.tokenlen.top/2025/05/31/new-stack/git/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>Leetcode HOTé¢è¯•é¢˜ç›®</title>
      <link>https://blog.tokenlen.top/2025/05/28/leetcode/leetocdehot1/</link>
      <guid>https://blog.tokenlen.top/2025/05/28/leetcode/leetocdehot1/</guid>
      <pubDate>Tue, 27 May 2025 16:00:00 GMT</pubDate>
      
        
        
          
          
      <description>&lt;h1 id=&quot;é¢è¯•ä¸€è½®&quot;&gt;&lt;a href=&quot;#é¢è¯•ä¸€è½®&quot; class=&quot;headerlink&quot; title=&quot;é¢è¯•ä¸€è½®&quot;&gt;&lt;/a&gt;é¢è¯•ä¸€è½®&lt;/h1&gt;&lt;h2 id=&quot;3-æ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²&quot;&gt;&lt;a href=&quot;#3-æ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²&quot; class=&quot;headerlink&quot;</description>
          
        
      
      
      
      <content:encoded><![CDATA[<h1 id="é¢è¯•ä¸€è½®"><a href="#é¢è¯•ä¸€è½®" class="headerlink" title="é¢è¯•ä¸€è½®"></a>é¢è¯•ä¸€è½®</h1><h2 id="3-æ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²"><a href="#3-æ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²" class="headerlink" title="3.æ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²"></a>3.<a href="https://leetcode.cn/problems/longest-substring-without-repeating-characters/">æ— é‡å¤å­—ç¬¦çš„æœ€é•¿å­ä¸²</a></h2><p>æ»‘åŠ¨çª—å£</p><p>ç»™å®šä¸€ä¸ªå­—ç¬¦ä¸² <code>s</code> ï¼Œè¯·ä½ æ‰¾å‡ºå…¶ä¸­ä¸å«æœ‰é‡å¤å­—ç¬¦çš„ <strong>æœ€é•¿ å­ä¸²</strong> çš„é•¿åº¦ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution3AAA</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">lengthOfLongestSubstring</span><span class="params">(String s)</span>&#123;</span><br><span class="line">        Map&lt;Character,Integer&gt; cnt = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        <span class="type">int</span> <span class="variable">left</span> <span class="operator">=</span> -<span class="number">1</span>,res = <span class="number">0</span>,n = s.length();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">right</span> <span class="operator">=</span> <span class="number">0</span>;right&lt;n;right++)&#123;</span><br><span class="line">            <span class="keyword">if</span> (cnt.containsKey(s.charAt(right)))&#123;</span><br><span class="line">                left = Math.max(left,cnt.get(s.charAt(right)));</span><br><span class="line">            &#125;</span><br><span class="line">            cnt.put(s.charAt(right),right);</span><br><span class="line">            res = Math.max(res,right-left);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç»å…¸æ»‘åŠ¨çª—å£ï¼Œæ›´æ–°rightå’Œleftç„¶åè®¡ç®—é•¿åº¦</p><h2 id="146-LRU-ç¼“å­˜"><a href="#146-LRU-ç¼“å­˜" class="headerlink" title="146. LRU ç¼“å­˜"></a><a href="https://leetcode.cn/problems/lru-cache/">146. LRU ç¼“å­˜</a></h2><p>linkedHashMap</p><p>è¯·ä½ è®¾è®¡å¹¶å®ç°ä¸€ä¸ªæ»¡è¶³ <a href="https://baike.baidu.com/item/LRU">LRU (æœ€è¿‘æœ€å°‘ä½¿ç”¨) ç¼“å­˜</a> çº¦æŸçš„æ•°æ®ç»“æ„ã€‚</p><p>å®ç° <code>LRUCache</code> ç±»ï¼š</p><ul><li><code>LRUCache(int capacity)</code> ä»¥ <strong>æ­£æ•´æ•°</strong> ä½œä¸ºå®¹é‡ <code>capacity</code> åˆå§‹åŒ– LRU ç¼“å­˜</li><li><code>int get(int key)</code> å¦‚æœå…³é”®å­— <code>key</code> å­˜åœ¨äºç¼“å­˜ä¸­ï¼Œåˆ™è¿”å›å…³é”®å­—çš„å€¼ï¼Œå¦åˆ™è¿”å› <code>-1</code> ã€‚</li><li><code>void put(int key, int value)</code> å¦‚æœå…³é”®å­— <code>key</code> å·²ç»å­˜åœ¨ï¼Œåˆ™å˜æ›´å…¶æ•°æ®å€¼ <code>value</code> ï¼›å¦‚æœä¸å­˜åœ¨ï¼Œåˆ™å‘ç¼“å­˜ä¸­æ’å…¥è¯¥ç»„ <code>key-value</code> ã€‚å¦‚æœæ’å…¥æ“ä½œå¯¼è‡´å…³é”®å­—æ•°é‡è¶…è¿‡ <code>capacity</code> ï¼Œåˆ™åº”è¯¥ <strong>é€å‡º</strong> æœ€ä¹…æœªä½¿ç”¨çš„å…³é”®å­—ã€‚</li></ul><p>å‡½æ•° <code>get</code> å’Œ <code>put</code> å¿…é¡»ä»¥ <code>O(1)</code> çš„å¹³å‡æ—¶é—´å¤æ‚åº¦è¿è¡Œã€‚</p><p>ä¸€çœ‹åˆ°æ˜¯å­˜å‚¨é”®å€¼å¯¹æ•°æ®ï¼Œé‚£æˆ‘ä»¬å¯ä»¥ä½¿ç”¨mapé›†åˆæ¥åšï¼Œç„¶åè¿”ç°éœ€è¦æ’å…¥xud</p><p>LinkedHashMapè€Œå…¶å†…éƒ¨æ˜¯é  å»ºç«‹ä¸€ä¸ª<strong>åŒå‘é“¾è¡¨</strong> æ¥ç»´æŠ¤è¿™ä¸ªé¡ºåºçš„ï¼Œåœ¨æ¯æ¬¡æ’å…¥ã€åˆ é™¤åï¼Œéƒ½ä¼šè°ƒç”¨ä¸€ä¸ªå‡½æ•°æ¥è¿›è¡Œ åŒå‘é“¾è¡¨çš„ç»´æŠ¤ ï¼Œå‡†ç¡®çš„æ¥è¯´ï¼Œæ˜¯æœ‰ä¸‰ä¸ªå‡½æ•°æ¥åšè¿™ä»¶äº‹ï¼Œè¿™ä¸‰ä¸ªå‡½æ•°éƒ½ç»Ÿç§°ä¸º <strong>å›è°ƒå‡½æ•°</strong> ï¼Œè¿™ä¸‰ä¸ªå‡½æ•°åˆ†åˆ«æ˜¯ï¼š</p><p>void afterNodeAccess(Node<K,V> p) { }<br>å…¶ä½œç”¨å°±æ˜¯åœ¨è®¿é—®å…ƒç´ ä¹‹åï¼Œ<strong>å°†è¯¥å…ƒç´ æ”¾åˆ°åŒå‘é“¾è¡¨çš„å°¾å·´å¤„</strong>(æ‰€ä»¥è¿™ä¸ªå‡½æ•°åªæœ‰åœ¨æŒ‰ç…§è¯»å–çš„é¡ºåºçš„æ—¶å€™æ‰ä¼šæ‰§è¡Œ)ï¼Œä¹‹æ‰€ä»¥æè¿™ä¸ªï¼Œæ˜¯å»ºè®®å¤§å®¶å»çœ‹çœ‹ï¼Œå¦‚ä½•ä¼˜ç¾çš„å®ç°åœ¨åŒå‘é“¾è¡¨ä¸­å°†æŒ‡å®šå…ƒç´ æ”¾å…¥é“¾å°¾ï¼<br>void afterNodeRemoval(Node<K,V> p) { }<br>å…¶ä½œç”¨å°±æ˜¯åœ¨åˆ é™¤å…ƒç´ ä¹‹åï¼Œå°†å…ƒç´ ä»åŒå‘é“¾è¡¨ä¸­åˆ é™¤ï¼Œè¿˜æ˜¯éå¸¸å»ºè®®å¤§å®¶å»çœ‹çœ‹è¿™ä¸ªå‡½æ•°çš„ï¼Œå¾ˆä¼˜ç¾çš„æ–¹å¼åœ¨åŒå‘é“¾è¡¨ä¸­åˆ é™¤èŠ‚ç‚¹ï¼<br>void afterNodeInsertion(boolean evict) { }<br>è¿™ä¸ªæ‰æ˜¯æˆ‘ä»¬é¢˜ç›®ä¸­ä¼šç”¨åˆ°çš„ï¼Œåœ¨æ’å…¥æ–°å…ƒç´ ä¹‹åï¼Œ<strong>éœ€è¦å›è°ƒå‡½æ•°åˆ¤æ–­æ˜¯å¦éœ€è¦ç§»é™¤ä¸€ç›´ä¸ç”¨çš„æŸäº›å…ƒç´ ï¼</strong></p><p>æ‰€ä»¥æˆ‘ä»¬ç›´æ¥ç»§æ‰¿linkedhashmapæ¥è§£å†³è¿™ä¸ªé—®é¢˜</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">LRUCache</span> <span class="keyword">extends</span> <span class="title class_">LinkedHashMap</span>&lt;Integer,Integer&gt;&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> capacity;</span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">LRUCache</span><span class="params">(<span class="type">int</span> capacity)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>(capacity,<span class="number">0.75F</span>,<span class="literal">true</span>);</span><br><span class="line">        <span class="built_in">this</span>.capacity = capacity;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">get</span><span class="params">(<span class="type">int</span> key)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">super</span>.getOrDefault(key,-<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">put</span><span class="params">(<span class="type">int</span> key, <span class="type">int</span> value)</span> &#123;</span><br><span class="line">        <span class="built_in">super</span>.put(key,value);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> <span class="type">boolean</span> <span class="title function_">removeEldestEntry</span><span class="params">(Map.Entry&lt;Integer,Integer&gt; eldest)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> size()&gt;capacity;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ç›´æ¥è¿”å›å³å¯äº†</p><h2 id="206-åè½¬é“¾è¡¨"><a href="#206-åè½¬é“¾è¡¨" class="headerlink" title="206. åè½¬é“¾è¡¨"></a><a href="https://leetcode.cn/problems/reverse-linked-list/">206. åè½¬é“¾è¡¨</a></h2><p>å•é“¾è¡¨çš„å¤´èŠ‚ç‚¹ <code>head</code> ï¼Œè¯·ä½ åè½¬é“¾è¡¨ï¼Œå¹¶è¿”å›åè½¬åçš„é“¾è¡¨ã€‚</p><p>é‚£æˆ‘ä»¬å°±ä¸€ç›´äº¤æ¢ä»–ä»¬çš„æŒ‡é’ˆåº”è¯¥å°±å¯ä»¥äº†ï¼Œä»å°¾éƒ¨äº¤æ¢åˆ°å¤´</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution206A</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> ListNode <span class="title function_">reverseList</span><span class="params">(ListNode head)</span> &#123;</span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">pre</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">cur</span> <span class="operator">=</span> head;</span><br><span class="line">        <span class="keyword">while</span> (cur != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="type">ListNode</span> <span class="variable">nxt</span> <span class="operator">=</span> cur.next;</span><br><span class="line">            cur.next = pre;</span><br><span class="line">            pre = cur;</span><br><span class="line">            cur = nxt;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> pre;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>A.pre-&gt;cur</p><p>A.cur-&gt;cur.next</p><p>A.cur.next = pre</p><p>ç„¶åç”¨<strong>å¤´æ’æ³•</strong>ä¾æ¬¡æŠŠèŠ‚ç‚¹ 1,2,3 æ’åˆ°è¿™ä¸ªæ–°é“¾è¡¨çš„å¤´éƒ¨</p><p>1-&gt;2-&gt;3</p><p>2.next-&gt;1</p><p>2.pre-&gt;2</p><p>2.cur-&gt;3</p><p>3-&gt;2-&gt;1</p><h2 id="215-æ•°ç»„ä¸­çš„ç¬¬Kä¸ªæœ€å¤§å…ƒç´ "><a href="#215-æ•°ç»„ä¸­çš„ç¬¬Kä¸ªæœ€å¤§å…ƒç´ " class="headerlink" title="215. æ•°ç»„ä¸­çš„ç¬¬Kä¸ªæœ€å¤§å…ƒç´ "></a><a href="https://leetcode.cn/problems/kth-largest-element-in-an-array/">215. æ•°ç»„ä¸­çš„ç¬¬Kä¸ªæœ€å¤§å…ƒç´ </a></h2><p>ç»™å®šæ•´æ•°æ•°ç»„ <code>nums</code> å’Œæ•´æ•° <code>k</code>ï¼Œè¯·è¿”å›æ•°ç»„ä¸­ç¬¬ <code>**k**</code> ä¸ªæœ€å¤§çš„å…ƒç´ ã€‚</p><p>è¯·æ³¨æ„ï¼Œä½ éœ€è¦æ‰¾çš„æ˜¯æ•°ç»„æ’åºåçš„ç¬¬ <code>k</code> ä¸ªæœ€å¤§çš„å…ƒç´ ï¼Œè€Œä¸æ˜¯ç¬¬ <code>k</code> ä¸ªä¸åŒçš„å…ƒç´ ã€‚</p><p>ä½ å¿…é¡»è®¾è®¡å¹¶å®ç°æ—¶é—´å¤æ‚åº¦ä¸º <code>O(n)</code> çš„ç®—æ³•è§£å†³æ­¤é—®é¢˜ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">findKthLargest</span><span class="params">(<span class="type">int</span>[] nums,<span class="type">int</span> k)</span>&#123;</span><br><span class="line">        Arrays.sort(nums);</span><br><span class="line">        <span class="keyword">return</span> nums[nums.length-k];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç›´æ¥æ’åºï¼Œè¿”å›å€’æ•°ç¬¬kä¸ªå°±å®Œäº‹</p><h2 id="15-ä¸‰æ•°ä¹‹å’Œ"><a href="#15-ä¸‰æ•°ä¹‹å’Œ" class="headerlink" title="15. ä¸‰æ•°ä¹‹å’Œ"></a><a href="https://leetcode.cn/problems/3sum/">15. ä¸‰æ•°ä¹‹å’Œ</a></h2><p>åŒæŒ‡é’ˆ</p><p>ç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„ <code>nums</code> ï¼Œåˆ¤æ–­æ˜¯å¦å­˜åœ¨ä¸‰å…ƒç»„ <code>[nums[i], nums[j], nums[k]]</code> æ»¡è¶³ <code>i != j</code>ã€<code>i != k</code> ä¸” <code>j != k</code> ï¼ŒåŒæ—¶è¿˜æ»¡è¶³ <code>nums[i] + nums[j] + nums[k] == 0</code> ã€‚è¯·ä½ è¿”å›æ‰€æœ‰å’Œä¸º <code>0</code> ä¸”ä¸é‡å¤çš„ä¸‰å…ƒç»„ã€‚</p><p><strong>æ³¨æ„ï¼š</strong>ç­”æ¡ˆä¸­ä¸å¯ä»¥åŒ…å«é‡å¤çš„ä¸‰å…ƒç»„ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution15A</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> List&lt;List&lt;Integer&gt;&gt; <span class="title function_">threeSum</span><span class="params">(<span class="type">int</span>[] nums)</span>&#123;</span><br><span class="line">        Arrays.sort(nums);</span><br><span class="line">        List&lt;List&lt;Integer&gt;&gt; ans = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="type">int</span> <span class="variable">n</span>  <span class="operator">=</span> nums.length;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span><span class="number">0</span>;i&lt;n-<span class="number">2</span>;i++)&#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">x</span> <span class="operator">=</span> nums[i];</span><br><span class="line">            <span class="keyword">if</span> (i&gt;<span class="number">0</span>&amp;&amp;x==nums[i-<span class="number">1</span>]) <span class="keyword">continue</span>;<span class="comment">//è·³è¿‡é‡å¤æ•°ç»„</span></span><br><span class="line">            <span class="keyword">if</span> (x+nums[i+<span class="number">1</span>]+nums[i+<span class="number">2</span>]&gt;<span class="number">0</span>) <span class="keyword">break</span>;<span class="comment">//æ²¡è´Ÿæ•°å°±åˆ«çœ‹äº†</span></span><br><span class="line">            <span class="keyword">if</span> (x+nums[n-<span class="number">2</span>]+nums[n-<span class="number">1</span>]&lt;<span class="number">0</span>) <span class="keyword">continue</span>;<span class="comment">//æ¯ä¸ªæ­£æ•°ä¹Ÿä¸çœ‹äº†</span></span><br><span class="line">            <span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> i+<span class="number">1</span>;</span><br><span class="line">            <span class="type">int</span> <span class="variable">k</span>  <span class="operator">=</span> n-<span class="number">1</span>;</span><br><span class="line">            <span class="keyword">while</span> (j&lt;k)&#123;</span><br><span class="line">                <span class="type">int</span> s= x+nums[j]+nums[k];</span><br><span class="line">                <span class="keyword">if</span> (s&gt;<span class="number">0</span>)&#123;</span><br><span class="line">                    k--;</span><br><span class="line">                &#125;<span class="keyword">else</span> <span class="keyword">if</span> (s&lt;<span class="number">0</span>)&#123;</span><br><span class="line">                    j++;</span><br><span class="line">                &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                    ans.add(List.of(x, nums[j], nums[k]));</span><br><span class="line">                    <span class="keyword">for</span> (j++;j&lt;k&amp;&amp;nums[j]==nums[j-<span class="number">1</span>];j++);<span class="comment">//å»é‡</span></span><br><span class="line">                    <span class="keyword">for</span> (k--;k&gt;j&amp;&amp;nums[k]==nums[k+<span class="number">1</span>];k--);<span class="comment">//å»é‡</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸€ä¸ªè¿›è¡Œä¼˜åŒ–å’Œæå‰å»è§‚å¯Ÿçš„åŒæŒ‡é’ˆæ–¹æ³•ï¼Œæå‰çœ‹æœ€å¤§çš„èƒ½ä¸èƒ½å®ç°ï¼Œè¿˜æœ‰æœ€å°çš„æƒ…å†µèƒ½ä¸èƒ½ç¬¦åˆ.</p><h2 id="25-K-ä¸ªä¸€ç»„ç¿»è½¬é“¾è¡¨"><a href="#25-K-ä¸ªä¸€ç»„ç¿»è½¬é“¾è¡¨" class="headerlink" title="25. K ä¸ªä¸€ç»„ç¿»è½¬é“¾è¡¨"></a><a href="https://leetcode.cn/problems/reverse-nodes-in-k-group/">25. K ä¸ªä¸€ç»„ç¿»è½¬é“¾è¡¨</a></h2><p>ç»™ä½ é“¾è¡¨çš„å¤´èŠ‚ç‚¹ <code>head</code> ï¼Œæ¯ <code>k</code> ä¸ªèŠ‚ç‚¹ä¸€ç»„è¿›è¡Œç¿»è½¬ï¼Œè¯·ä½ è¿”å›ä¿®æ”¹åçš„é“¾è¡¨ã€‚</p><p><code>k</code> æ˜¯ä¸€ä¸ªæ­£æ•´æ•°ï¼Œå®ƒçš„å€¼å°äºæˆ–ç­‰äºé“¾è¡¨çš„é•¿åº¦ã€‚å¦‚æœèŠ‚ç‚¹æ€»æ•°ä¸æ˜¯ <code>k</code> çš„æ•´æ•°å€ï¼Œé‚£ä¹ˆè¯·å°†æœ€åå‰©ä½™çš„èŠ‚ç‚¹ä¿æŒåŸæœ‰é¡ºåºã€‚</p><p>ä½ ä¸èƒ½åªæ˜¯å•çº¯çš„æ”¹å˜èŠ‚ç‚¹å†…éƒ¨çš„å€¼ï¼Œè€Œæ˜¯éœ€è¦å®é™…è¿›è¡ŒèŠ‚ç‚¹äº¤æ¢ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution25A</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> ListNode <span class="title function_">reverseKGroup</span><span class="params">(ListNode head, <span class="type">int</span> k)</span>&#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span><span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">ListNode</span> <span class="variable">cur</span> <span class="operator">=</span> head;cur!=<span class="literal">null</span>;cur =cur.next)&#123;</span><br><span class="line">            n++;<span class="comment">//è®¡æ•°å™¨</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">dummy</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ListNode</span>(<span class="number">0</span>,head),preHead = dummy;</span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">pre</span> <span class="operator">=</span> <span class="literal">null</span>,cur = head;</span><br><span class="line">        <span class="keyword">for</span> (;n&gt;=k;n-=k)&#123;<span class="comment">//é‡å¤n-kæ¬¡</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>;i&lt;k;++i)&#123;</span><br><span class="line">                <span class="type">ListNode</span>  <span class="variable">next</span> <span class="operator">=</span> cur.next;</span><br><span class="line">                cur.next = pre;</span><br><span class="line">                pre =cur;</span><br><span class="line">                cur  = next;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="type">ListNode</span> <span class="variable">tail</span> <span class="operator">=</span> preHead.next;<span class="comment">//åè½¬åŒºé—´çš„ç»“å°¾</span></span><br><span class="line">            tail.next = cur;<span class="comment">//ä¸‹ä¸ªåŒºé—´</span></span><br><span class="line">            preHead.next = pre;<span class="comment">//åŒºé—´çš„æ–°head</span></span><br><span class="line">            preHead = tail;<span class="comment">//åˆ°è¾¾ç»“å°¾è¿›è¡Œä¸‹ä¸€ä¸ª</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> dummy.next;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="53-æœ€å¤§å­æ•°ç»„å’Œ"><a href="#53-æœ€å¤§å­æ•°ç»„å’Œ" class="headerlink" title="53. æœ€å¤§å­æ•°ç»„å’Œ"></a><a href="https://leetcode.cn/problems/maximum-subarray/">53. æœ€å¤§å­æ•°ç»„å’Œ</a></h2><p>åˆ†ç»„å¾ªç¯</p><p>ç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„ <code>nums</code> ï¼Œè¯·ä½ æ‰¾å‡ºä¸€ä¸ªå…·æœ‰æœ€å¤§å’Œçš„è¿ç»­å­æ•°ç»„ï¼ˆå­æ•°ç»„æœ€å°‘åŒ…å«ä¸€ä¸ªå…ƒç´ ï¼‰ï¼Œè¿”å›å…¶æœ€å¤§å’Œã€‚</p><p><strong>å­æ•°ç»„</strong>æ˜¯æ•°ç»„ä¸­çš„ä¸€ä¸ªè¿ç»­éƒ¨åˆ†ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution53A</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">maxSubArray</span><span class="params">(<span class="type">int</span>[] nums)</span>&#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">ans</span> <span class="operator">=</span> nums[<span class="number">0</span>];</span><br><span class="line">        <span class="type">int</span> <span class="variable">sum</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> x:nums)&#123;</span><br><span class="line">            <span class="keyword">if</span> (sum&gt;<span class="number">0</span>)&#123;</span><br><span class="line">                sum +=x;</span><br><span class="line">            &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                sum = x;</span><br><span class="line">            &#125;</span><br><span class="line">            ans = Math.max(sum,ans);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¾ˆç®€å•çš„å»è§£å†³ï¼Œå¦‚æœå’Œä¸ºæ­£æ•°çš„è¯ï¼Œå°±ç»§ç»­å»åŠ æ•°ã€‚ä¸æ˜¯çš„è¯ï¼Œå°±ä»å½“å‰è¿™ä¸ªæ•°å¼€å§‹é‡æ–°è®¡ç®—</p><p>ä¹Ÿæœ‰ç‚¹åˆ†ç»„å¾ªç¯çš„æ„æ€äº†å“ˆå“ˆ</p><h2 id="æ‰‹æ’•å¿«é€Ÿæ’åº"><a href="#æ‰‹æ’•å¿«é€Ÿæ’åº" class="headerlink" title="æ‰‹æ’•å¿«é€Ÿæ’åº"></a>æ‰‹æ’•å¿«é€Ÿæ’åº</h2><p>å¿«é€Ÿæ’åºæ¯ä¸€æ¬¡éƒ½æ’å®šä¸€ä¸ªå…ƒç´ ï¼ˆè¿™ä¸ªå…ƒç´ å‘†åœ¨äº†å®ƒæœ€ç»ˆåº”è¯¥å‘†çš„ä½ç½®ï¼‰ï¼Œç„¶åé€’å½’åœ°å»æ’å®ƒå·¦è¾¹çš„éƒ¨åˆ†å’Œå³è¾¹çš„éƒ¨åˆ†ï¼Œä¾æ¬¡è¿›è¡Œä¸‹å»ï¼Œç›´åˆ°æ•°ç»„æœ‰åºï¼›</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution912</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">INSERTION_SORT_THRESHOLD</span> <span class="operator">=</span> <span class="number">7</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Random</span> <span class="variable">RANDOM</span>  <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Random</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span>[] sortArray(<span class="type">int</span>[] nums)&#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">len</span>  <span class="operator">=</span> nums.length;</span><br><span class="line">        quickSort(nums,<span class="number">0</span>,len-<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">return</span> nums;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">quickSort</span><span class="params">(<span class="type">int</span>[] nums,<span class="type">int</span> left,<span class="type">int</span> right)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (right-left&lt;=INSERTION_SORT_THRESHOLD)&#123;</span><br><span class="line">            insertSort(nums,left,right);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> <span class="variable">pIndex</span> <span class="operator">=</span> partition(nums,left,right);</span><br><span class="line">        quickSort(nums,left,pIndex-<span class="number">1</span>);</span><br><span class="line">        quickSort(nums,pIndex+<span class="number">1</span>,right);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">insertSort</span><span class="params">(<span class="type">int</span>[] nums,<span class="type">int</span> left,<span class="type">int</span> right)</span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> left+<span class="number">1</span>;i&lt;=right;i++)&#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">tmp</span> <span class="operator">=</span> nums[i];</span><br><span class="line">            <span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> i;</span><br><span class="line">            <span class="keyword">while</span> (j&gt;left&amp;&amp;nums[j-<span class="number">1</span>]&gt;tmp)&#123;</span><br><span class="line">                nums[j] = nums[j-<span class="number">1</span>];</span><br><span class="line">                j--;</span><br><span class="line">            &#125;</span><br><span class="line">            nums[j] = tmp;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="title function_">partition</span><span class="params">(<span class="type">int</span>[] nums, <span class="type">int</span> left, <span class="type">int</span> right)</span>&#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">randomIndex</span> <span class="operator">=</span> left+RANDOM.nextInt(right-left+<span class="number">1</span>);</span><br><span class="line">        swap(nums,randomIndex,left);</span><br><span class="line"></span><br><span class="line">        <span class="type">int</span> <span class="variable">pivot</span> <span class="operator">=</span> nums[left];</span><br><span class="line">        <span class="type">int</span> <span class="variable">lt</span> <span class="operator">=</span> left+<span class="number">1</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">gt</span> <span class="operator">=</span> right;</span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>) &#123;</span><br><span class="line">            <span class="keyword">while</span> (lt &lt;= right &amp;&amp; nums[lt] &lt; pivot) &#123;</span><br><span class="line">                lt++;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">while</span> (gt &gt; left &amp;&amp; nums[gt] &gt; pivot) &#123;</span><br><span class="line">                gt--;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (lt &gt;= gt) &#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// ç»†èŠ‚ï¼šç›¸ç­‰çš„å…ƒç´ é€šè¿‡äº¤æ¢ï¼Œç­‰æ¦‚ç‡åˆ†åˆ°æ•°ç»„çš„ä¸¤è¾¹</span></span><br><span class="line">            swap(nums, lt, gt);</span><br><span class="line">            lt++;</span><br><span class="line">            gt--;</span><br><span class="line">        &#125;</span><br><span class="line">        swap(nums, left, gt);</span><br><span class="line">        <span class="keyword">return</span> gt;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">swap</span><span class="params">(<span class="type">int</span>[] nums, <span class="type">int</span> index1, <span class="type">int</span> index2)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">temp</span> <span class="operator">=</span> nums[index1];</span><br><span class="line">        nums[index1] = nums[index2];</span><br><span class="line">        nums[index2] = temp;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ‰ç‚¹éš¾äº†ğŸ˜“</p><h2 id="21-åˆå¹¶ä¸¤ä¸ªæœ‰åºé“¾è¡¨"><a href="#21-åˆå¹¶ä¸¤ä¸ªæœ‰åºé“¾è¡¨" class="headerlink" title="21. åˆå¹¶ä¸¤ä¸ªæœ‰åºé“¾è¡¨"></a><a href="https://leetcode.cn/problems/merge-two-sorted-lists/">21. åˆå¹¶ä¸¤ä¸ªæœ‰åºé“¾è¡¨</a></h2><p>å°†ä¸¤ä¸ªå‡åºé“¾è¡¨åˆå¹¶ä¸ºä¸€ä¸ªæ–°çš„ <strong>å‡åº</strong> é“¾è¡¨å¹¶è¿”å›ã€‚æ–°é“¾è¡¨æ˜¯é€šè¿‡æ‹¼æ¥ç»™å®šçš„ä¸¤ä¸ªé“¾è¡¨çš„æ‰€æœ‰èŠ‚ç‚¹ç»„æˆçš„ã€‚ </p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> ListNode <span class="title function_">mergeTwoLists</span><span class="params">(ListNode list1, ListNode list2)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (list1 == <span class="literal">null</span>) <span class="keyword">return</span> list2; <span class="comment">// æ³¨ï¼šå¦‚æœéƒ½ä¸ºç©ºåˆ™è¿”å›ç©º</span></span><br><span class="line">        <span class="keyword">if</span> (list2 == <span class="literal">null</span>) <span class="keyword">return</span> list1;</span><br><span class="line">        <span class="keyword">if</span> (list1.val &lt; list2.val) &#123;</span><br><span class="line">            list1.next = mergeTwoLists(list1.next, list2);</span><br><span class="line">            <span class="keyword">return</span> list1;</span><br><span class="line">        &#125;</span><br><span class="line">        list2.next = mergeTwoLists(list1, list2.next);</span><br><span class="line">        <span class="keyword">return</span> list2;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ç©ºçš„è¯å°±è¿”å›å¦ä¸€ä¸ªçš„é“¾è¡¨</p><p>å¦‚æœl1çš„å€¼å°äºl2çš„è¯ï¼Œé€’å½’è°ƒç”¨çš„é“¾è¡¨æ¥l1ä¹‹åã€‚åä¹‹ä¸€æ ·</p><p>ç„¶åè¿”å›å½“å‰èŠ‚ç‚¹</p><h2 id="5-æœ€é•¿å›æ–‡å­ä¸²"><a href="#5-æœ€é•¿å›æ–‡å­ä¸²" class="headerlink" title="5. æœ€é•¿å›æ–‡å­ä¸²"></a><a href="https://leetcode.cn/problems/longest-palindromic-substring/">5. æœ€é•¿å›æ–‡å­ä¸²</a></h2><p>ç»™ä½ ä¸€ä¸ªå­—ç¬¦ä¸² <code>s</code>ï¼Œæ‰¾åˆ° <code>s</code> ä¸­æœ€é•¿çš„ å›æ–‡ å­ä¸²ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution5A</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">longestPalindrome</span><span class="params">(String s)</span>&#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">res</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span><span class="number">0</span>;i&lt;s.length();i++)&#123;</span><br><span class="line">            <span class="type">String</span> <span class="variable">s1</span> <span class="operator">=</span> expend(s,i,i+<span class="number">1</span>);</span><br><span class="line">            <span class="type">String</span> <span class="variable">s2</span> <span class="operator">=</span> expend(s,i,i);</span><br><span class="line">            res = res.length()&gt;s1.length()?res:s1;</span><br><span class="line">            res = res.length()&gt;s2.length()?res:s2;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> String <span class="title function_">expend</span><span class="params">(String s,<span class="type">int</span> l,<span class="type">int</span> r)</span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (l&gt;=<span class="number">0</span>&amp;&amp;r&lt;s.length()&amp;&amp;s.charAt(l)==s.charAt(r))&#123;</span><br><span class="line">            l--;</span><br><span class="line">            r++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> s.substring(l+<span class="number">1</span>,r);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>expendè¿”å›çš„æ˜¯ä¸Šä¸€æ¬¡åˆæ³•å›æ–‡çš„èŒƒå›´ã€‚ç„¶åæ…¢æ…¢æ‰©å¤§èŒƒå›´ï¼Œs1ä¸ºå¶æ•°å›æ–‡</p><p>s2ä¸ºå¥‡æ•°å›æ–‡</p><h2 id="102-äºŒå‰æ ‘çš„å±‚åºéå†"><a href="#102-äºŒå‰æ ‘çš„å±‚åºéå†" class="headerlink" title="102. äºŒå‰æ ‘çš„å±‚åºéå†"></a><a href="https://leetcode.cn/problems/binary-tree-level-order-traversal/">102. äºŒå‰æ ‘çš„å±‚åºéå†</a></h2><p>ç»™ä½ äºŒå‰æ ‘çš„æ ¹èŠ‚ç‚¹ <code>root</code> ï¼Œè¿”å›å…¶èŠ‚ç‚¹å€¼çš„ <strong>å±‚åºéå†</strong> ã€‚ ï¼ˆå³é€å±‚åœ°ï¼Œä»å·¦åˆ°å³è®¿é—®æ‰€æœ‰èŠ‚ç‚¹ï¼‰ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution102A</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> List&lt;List&lt;Integer&gt;&gt; <span class="title function_">levelOrder</span><span class="params">(TreeNode root)</span>&#123;</span><br><span class="line">        List&lt;List&lt;Integer&gt;&gt; res = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        Queue&lt;TreeNode&gt; queue   = <span class="keyword">new</span> <span class="title class_">ArrayDeque</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">if</span> (root!=<span class="literal">null</span>)&#123;</span><br><span class="line">            queue.add(root);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">while</span> (!queue.isEmpty())&#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> queue.size();</span><br><span class="line">            List&lt;Integer&gt; level = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>;i&lt;n;i++)&#123;</span><br><span class="line">                <span class="type">TreeNode</span> <span class="variable">node</span> <span class="operator">=</span> queue.poll();</span><br><span class="line">                level.add(node.val);</span><br><span class="line">                <span class="keyword">if</span> (node.left!=<span class="literal">null</span>)&#123;</span><br><span class="line">                    queue.add(node.left);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">if</span> (node.right!=<span class="literal">null</span>)&#123;</span><br><span class="line">                    queue.add(node.right);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            res.add(level);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>levelä¸ºå½“å‰çš„å±‚æ•°ï¼Œnä¸ºå½“å‰å±‚æ•°çš„æ‰€æœ‰èŠ‚ç‚¹æ•°</p><p>ç„¶åä½¿ç”¨bfsè¿›æ­¥éå†ï¼Œä¸ä¸ºç©ºï¼Œå°±åŠ å…¥é˜Ÿåˆ—éå†</p><h2 id="1-ä¸¤æ•°ä¹‹å’Œ"><a href="#1-ä¸¤æ•°ä¹‹å’Œ" class="headerlink" title="1. ä¸¤æ•°ä¹‹å’Œ"></a><a href="https://leetcode.cn/problems/two-sum/">1. ä¸¤æ•°ä¹‹å’Œ</a></h2><p>hashmap</p><p>ç»™å®šä¸€ä¸ªæ•´æ•°æ•°ç»„ <code>nums</code> å’Œä¸€ä¸ªæ•´æ•°ç›®æ ‡å€¼ <code>target</code>ï¼Œè¯·ä½ åœ¨è¯¥æ•°ç»„ä¸­æ‰¾å‡º <strong>å’Œä¸ºç›®æ ‡å€¼</strong> <em><code>target</code></em> çš„é‚£ <strong>ä¸¤ä¸ª</strong> æ•´æ•°ï¼Œå¹¶è¿”å›å®ƒä»¬çš„æ•°ç»„ä¸‹æ ‡ã€‚</p><p>ä½ å¯ä»¥å‡è®¾æ¯ç§è¾“å…¥åªä¼šå¯¹åº”ä¸€ä¸ªç­”æ¡ˆï¼Œå¹¶ä¸”ä½ ä¸èƒ½ä½¿ç”¨ä¸¤æ¬¡ç›¸åŒçš„å…ƒç´ ã€‚</p><p>ä½ å¯ä»¥æŒ‰ä»»æ„é¡ºåºè¿”å›ç­”æ¡ˆã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution1A</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span>[] twoSum(<span class="type">int</span>[] nums,<span class="type">int</span> target)&#123;</span><br><span class="line">        Map&lt;Integer,Integer&gt; map  = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>;i&lt;nums.length;i++)&#123;</span><br><span class="line">            <span class="keyword">if</span> (map.containsKey(target-nums[i]))&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">int</span>[] &#123;map.get(target-nums[i]),i&#125;;</span><br><span class="line">            &#125;</span><br><span class="line">            map.put(nums[i],i);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;No two sum solution&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨hashè¡¨è§£å†³ï¼Œåœ¨mapé‡Œæœ‰target-nums[i]çš„æ•°ï¼Œå°±æ–°å»ºæ•°ç»„</p><p>ç„¶åæ”¾å…¥nums[i]ï¼Œæ²¡æœ‰å°±æ‰”å‡ºå¼‚å¸¸</p><h2 id="33-æœç´¢æ—‹è½¬æ’åºæ•°ç»„"><a href="#33-æœç´¢æ—‹è½¬æ’åºæ•°ç»„" class="headerlink" title="33. æœç´¢æ—‹è½¬æ’åºæ•°ç»„"></a><a href="https://leetcode.cn/problems/search-in-rotated-sorted-array/">33. æœç´¢æ—‹è½¬æ’åºæ•°ç»„</a></h2><p>äºŒåˆ†æŸ¥æ‰¾</p><p>æ•´æ•°æ•°ç»„ <code>nums</code> æŒ‰å‡åºæ’åˆ—ï¼Œæ•°ç»„ä¸­çš„å€¼ <strong>äº’ä¸ç›¸åŒ</strong> ã€‚</p><p>åœ¨ä¼ é€’ç»™å‡½æ•°ä¹‹å‰ï¼Œ<code>nums</code> åœ¨é¢„å…ˆæœªçŸ¥çš„æŸä¸ªä¸‹æ ‡ <code>k</code>ï¼ˆ<code>0 &lt;= k &lt; nums.length</code>ï¼‰ä¸Šè¿›è¡Œäº† <strong>æ—‹è½¬</strong>ï¼Œä½¿æ•°ç»„å˜ä¸º <code>[nums[k], nums[k+1], ..., nums[n-1], nums[0], nums[1], ..., nums[k-1]]</code>ï¼ˆä¸‹æ ‡ <strong>ä» 0 å¼€å§‹</strong> è®¡æ•°ï¼‰ã€‚ä¾‹å¦‚ï¼Œ <code>[0,1,2,4,5,6,7]</code> åœ¨ä¸‹æ ‡ <code>3</code> å¤„ç»æ—‹è½¬åå¯èƒ½å˜ä¸º <code>[4,5,6,7,0,1,2]</code> ã€‚</p><p>ç»™ä½  <strong>æ—‹è½¬å</strong> çš„æ•°ç»„ <code>nums</code> å’Œä¸€ä¸ªæ•´æ•° <code>target</code> ï¼Œå¦‚æœ <code>nums</code> ä¸­å­˜åœ¨è¿™ä¸ªç›®æ ‡å€¼ <code>target</code> ï¼Œåˆ™è¿”å›å®ƒçš„ä¸‹æ ‡ï¼Œå¦åˆ™è¿”å› <code>-1</code> ã€‚</p><p>ä½ å¿…é¡»è®¾è®¡ä¸€ä¸ªæ—¶é—´å¤æ‚åº¦ä¸º <code>O(log n)</code> çš„ç®—æ³•è§£å†³æ­¤é—®é¢˜ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution33A</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">check</span><span class="params">(<span class="type">int</span>[] nums, <span class="type">int</span> target, <span class="type">int</span> i)</span>&#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">x</span> <span class="operator">=</span> nums[i];</span><br><span class="line">        <span class="type">int</span> <span class="variable">end</span> <span class="operator">=</span> nums[nums.length-<span class="number">1</span>];</span><br><span class="line">        <span class="keyword">if</span> (x&gt;end)&#123;</span><br><span class="line">            <span class="keyword">return</span> target&gt;end&amp;&amp;x&gt;=target;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> target&gt;end||x&gt;=target;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">search</span><span class="params">(<span class="type">int</span>[] nums, <span class="type">int</span> target)</span>&#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">left</span> <span class="operator">=</span> -<span class="number">1</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">right</span> <span class="operator">=</span> nums.length-<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span> (left+<span class="number">1</span>&lt;right)&#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">mid</span> <span class="operator">=</span> (left+right)&gt;&gt;&gt;<span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span> (check(nums,target,mid))&#123;</span><br><span class="line">                right = mid;</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                left = mid;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> nums[right]==target?right:-<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ä½¿ç”¨äºŒåˆ†æŸ¥æ‰¾</p><p>æŠŠæŸä¸ªæ•° <em>x</em> ä¸æœ€åä¸€ä¸ªæ•° <em>nums</em>[<em>n</em>âˆ’1] æ¯”å¤§å°</p><p>å¦‚æœx&gt;nums[n-1]çš„è¯</p><p>numsä¸€å®šè¢«æ—‹è½¬åˆ†ä¸ºå·¦å³ä¸¤ä¸ªé€’å¢çš„ï¼Œå°±æ˜¯å‰é¢çš„ä¸€æ®µç§»åŠ¨åˆ°åé¢æ¥äº†</p><p>ç„¶åå‰é¢çš„å¤§äºåé¢çš„</p><p>xè¿˜åœ¨ç¬¬ä¸€æ®µ</p><p>åä¹‹ï¼Œx&lt;=nums[n-1]å°±è¯´æ˜xåœ¨ç¬¬äºŒæ®µ</p><p>æˆ–è€…ä»–å°±æ˜¯é€’å¢æ•°ç»„</p><p>æ ¹æ®è¿™ä¸ªå†™æˆ‘ä»¬çš„checkå‡½æ•°ï¼Œæ¥ç¡®å®šxçš„èŒƒå›´ï¼Œå¥½è®©æˆ‘ä»¬è¿›è¡ŒäºŒåˆ†æŸ¥æ‰¾</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">check</span><span class="params">(<span class="type">int</span>[] nums, <span class="type">int</span> target, <span class="type">int</span> i)</span>&#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">x</span> <span class="operator">=</span> nums[i];</span><br><span class="line">        <span class="type">int</span> <span class="variable">end</span> <span class="operator">=</span> nums[nums.length-<span class="number">1</span>];</span><br><span class="line">        <span class="keyword">if</span> (x&gt;end)&#123;</span><br><span class="line">            <span class="keyword">return</span> target&gt;end&amp;&amp;x&gt;=target;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> target&gt;end||x&gt;=target;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><h2 id="200-å²›å±¿æ•°é‡"><a href="#200-å²›å±¿æ•°é‡" class="headerlink" title="200. å²›å±¿æ•°é‡"></a><a href="https://leetcode.cn/problems/number-of-islands/">200. å²›å±¿æ•°é‡</a></h2><p>bfs</p><p>ç»™ä½ ä¸€ä¸ªç”± <code>&#39;1&#39;</code>ï¼ˆé™†åœ°ï¼‰å’Œ <code>&#39;0&#39;</code>ï¼ˆæ°´ï¼‰ç»„æˆçš„çš„äºŒç»´ç½‘æ ¼ï¼Œè¯·ä½ è®¡ç®—ç½‘æ ¼ä¸­å²›å±¿çš„æ•°é‡ã€‚</p><p>å²›å±¿æ€»æ˜¯è¢«æ°´åŒ…å›´ï¼Œå¹¶ä¸”æ¯åº§å²›å±¿åªèƒ½ç”±æ°´å¹³æ–¹å‘å’Œ/æˆ–ç«–ç›´æ–¹å‘ä¸Šç›¸é‚»çš„é™†åœ°è¿æ¥å½¢æˆã€‚</p><p>æ­¤å¤–ï¼Œä½ å¯ä»¥å‡è®¾è¯¥ç½‘æ ¼çš„å››æ¡è¾¹å‡è¢«æ°´åŒ…å›´ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution200</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">numIslands</span><span class="params">(<span class="type">char</span>[][] grid)</span>&#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">ans</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span><span class="number">0</span>;i&lt;grid.length;i++)&#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>; j &lt; grid[i].length; j++) &#123;</span><br><span class="line">                <span class="keyword">if</span> (grid[i][j]==<span class="string">&#x27;1&#x27;</span>)&#123;</span><br><span class="line">                    dfs(grid,i,j);</span><br><span class="line">                    ans++;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">dfs</span><span class="params">(<span class="type">char</span>[][] grid,<span class="type">int</span> i,<span class="type">int</span> j)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (i&lt;<span class="number">0</span>||i&gt;=grid.length||j&lt;<span class="number">0</span>||j&gt;=grid[<span class="number">0</span>].length||grid[i][j]!=<span class="string">&#x27;1&#x27;</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        grid[i][j]=<span class="string">&#x27;2&#x27;</span>;</span><br><span class="line">        dfs(grid,i,j-<span class="number">1</span>);</span><br><span class="line">        dfs(grid,i,j+<span class="number">1</span>);</span><br><span class="line">        dfs(grid,i-<span class="number">1</span>,j);</span><br><span class="line">        dfs(grid,i+<span class="number">1</span>,j);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å°±æ˜¯éå†è¿™æ•´ä¸ªçŸ©é˜µï¼Œç„¶åå¦‚æœæ˜¯1å°±count++;</p><p>ç„¶åæŠŠé€šè¿‡çš„æ”¹ä¸º2ï¼Œé˜²æ­¢é‡å¤éå†</p><h2 id="46-å…¨æ’åˆ—"><a href="#46-å…¨æ’åˆ—" class="headerlink" title="46. å…¨æ’åˆ—"></a><a href="https://leetcode.cn/problems/permutations/">46. å…¨æ’åˆ—</a></h2><p>å›æº¯æ³•</p><p>ç»™å®šä¸€ä¸ªä¸å«é‡å¤æ•°å­—çš„æ•°ç»„ <code>nums</code> ï¼Œè¿”å›å…¶ <em>æ‰€æœ‰å¯èƒ½çš„å…¨æ’åˆ—</em> ã€‚ä½ å¯ä»¥ <strong>æŒ‰ä»»æ„é¡ºåº</strong> è¿”å›ç­”æ¡ˆã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> List&lt;List&lt;Integer&gt;&gt; <span class="title function_">permute</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">        List&lt;List&lt;Integer&gt;&gt; ans = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        List&lt;Integer&gt; path = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="type">boolean</span>[] onPath = <span class="keyword">new</span> <span class="title class_">boolean</span>[nums.length];</span><br><span class="line">        dfs(nums, path, onPath, ans);</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">dfs</span><span class="params">(<span class="type">int</span>[] nums, List&lt;Integer&gt; path, <span class="type">boolean</span>[] onPath, List&lt;List&lt;Integer&gt;&gt; ans)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (path.size() == nums.length) &#123;</span><br><span class="line">            ans.add(<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(path));</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; nums.length; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (onPath[i]) <span class="keyword">continue</span>;</span><br><span class="line">            path.add(nums[i]);</span><br><span class="line">            onPath[i] = <span class="literal">true</span>;</span><br><span class="line">            dfs(nums, path, onPath, ans);</span><br><span class="line">            path.remove(path.size() - <span class="number">1</span>); <span class="comment">// å›æº¯</span></span><br><span class="line">            onPath[i] = <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>onPathç”¨æ¥æ”¾è¿™ä¸ªjæœ‰æ²¡æœ‰ä½¿ç”¨</p><p>pathä¸ºè·¯å¾„ï¼Œå°±æ˜¯æ•°ç»„ï¼Œé•¿åº¦å…¨äº†çš„è¯ï¼Œå°±ç»™ä»–åŠ å…¥åˆ°ç­”æ¡ˆä¸­</p><p>ç„¶åéå†ï¼Œè¿›å…¥è·¯å¾„ï¼Œè®¾ä¸ºåŒ¹é…ï¼Œdfsåï¼Œå†æ¢å¤</p><h2 id="88-åˆå¹¶ä¸¤ä¸ªæœ‰åºæ•°ç»„"><a href="#88-åˆå¹¶ä¸¤ä¸ªæœ‰åºæ•°ç»„" class="headerlink" title="88. åˆå¹¶ä¸¤ä¸ªæœ‰åºæ•°ç»„"></a><a href="https://leetcode.cn/problems/merge-sorted-array/">88. åˆå¹¶ä¸¤ä¸ªæœ‰åºæ•°ç»„</a></h2><p>ç»™ä½ ä¸¤ä¸ªæŒ‰ <strong>éé€’å‡é¡ºåº</strong> æ’åˆ—çš„æ•´æ•°æ•°ç»„ <code>nums1</code> å’Œ <code>nums2</code>ï¼Œå¦æœ‰ä¸¤ä¸ªæ•´æ•° <code>m</code> å’Œ <code>n</code> ï¼Œåˆ†åˆ«è¡¨ç¤º <code>nums1</code> å’Œ <code>nums2</code> ä¸­çš„å…ƒç´ æ•°ç›®ã€‚</p><p>è¯·ä½  <strong>åˆå¹¶</strong> <code>nums2</code> åˆ° <code>nums1</code> ä¸­ï¼Œä½¿åˆå¹¶åçš„æ•°ç»„åŒæ ·æŒ‰ <strong>éé€’å‡é¡ºåº</strong> æ’åˆ—ã€‚</p><p><strong>æ³¨æ„ï¼š</strong>æœ€ç»ˆï¼Œåˆå¹¶åæ•°ç»„ä¸åº”ç”±å‡½æ•°è¿”å›ï¼Œè€Œæ˜¯å­˜å‚¨åœ¨æ•°ç»„ <code>nums1</code> ä¸­ã€‚ä¸ºäº†åº”å¯¹è¿™ç§æƒ…å†µï¼Œ<code>nums1</code> çš„åˆå§‹é•¿åº¦ä¸º <code>m + n</code>ï¼Œå…¶ä¸­å‰ <code>m</code> ä¸ªå…ƒç´ è¡¨ç¤ºåº”åˆå¹¶çš„å…ƒç´ ï¼Œå <code>n</code> ä¸ªå…ƒç´ ä¸º <code>0</code> ï¼Œåº”å¿½ç•¥ã€‚<code>nums2</code> çš„é•¿åº¦ä¸º <code>n</code> ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">merge</span><span class="params">(<span class="type">int</span>[] nums1, <span class="type">int</span> m, <span class="type">int</span>[] nums2, <span class="type">int</span> n)</span>&#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">p1</span> <span class="operator">=</span> m-<span class="number">1</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">p2</span> <span class="operator">=</span> n-<span class="number">1</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">p</span> <span class="operator">=</span> m+n-<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span> (p2&gt;=<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span> (p1&gt;=<span class="number">0</span>&amp;&amp;nums1[p1]&gt;nums2[p2])&#123;</span><br><span class="line">                nums1[p--] = nums1[p1--];</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                nums1[p--] = nums2[p2--];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç®€å•çš„äº¤æ¢ï¼Œè°å¤§è°åœ¨åé¢</p><h2 id="20-æœ‰æ•ˆçš„æ‹¬å·"><a href="#20-æœ‰æ•ˆçš„æ‹¬å·" class="headerlink" title="20. æœ‰æ•ˆçš„æ‹¬å·"></a><a href="https://leetcode.cn/problems/valid-parentheses/">20. æœ‰æ•ˆçš„æ‹¬å·</a></h2><p>æ ˆ</p><p>ç»™å®šä¸€ä¸ªåªåŒ…æ‹¬ <code>&#39;(&#39;</code>ï¼Œ<code>&#39;)&#39;</code>ï¼Œ<code>&#39;&#123;&#39;</code>ï¼Œ<code>&#39;&#125;&#39;</code>ï¼Œ<code>&#39;[&#39;</code>ï¼Œ<code>&#39;]&#39;</code> çš„å­—ç¬¦ä¸² <code>s</code> ï¼Œåˆ¤æ–­å­—ç¬¦ä¸²æ˜¯å¦æœ‰æ•ˆã€‚</p><p>æœ‰æ•ˆå­—ç¬¦ä¸²éœ€æ»¡è¶³ï¼š</p><ol><li>å·¦æ‹¬å·å¿…é¡»ç”¨ç›¸åŒç±»å‹çš„å³æ‹¬å·é—­åˆã€‚</li><li>å·¦æ‹¬å·å¿…é¡»ä»¥æ­£ç¡®çš„é¡ºåºé—­åˆã€‚</li><li>æ¯ä¸ªå³æ‹¬å·éƒ½æœ‰ä¸€ä¸ªå¯¹åº”çš„ç›¸åŒç±»å‹çš„å·¦æ‹¬å·ã€‚</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution20</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isValid</span><span class="params">(String s)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (s.isEmpty())&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        Stack&lt;Character&gt; stack = <span class="keyword">new</span> <span class="title class_">Stack</span>&lt;Character&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">char</span> c :s.toCharArray())&#123;</span><br><span class="line">            <span class="keyword">if</span> (c==<span class="string">&#x27;(&#x27;</span>) stack.push(<span class="string">&#x27;)&#x27;</span>);</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (c==<span class="string">&#x27;&#123;&#x27;</span>) stack.push(<span class="string">&#x27;&#125;&#x27;</span>);</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (c==<span class="string">&#x27;[&#x27;</span>) stack.push(<span class="string">&#x27;]&#x27;</span>);</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (stack.isEmpty()||c!=stack.pop())&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> stack.isEmpty();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ä½¿ç”¨æ ˆçš„æ€æƒ³ï¼Œæœ‰å·¦çš„è¯ï¼Œå°±æŠŠå³è¾¹çš„å…¥æ ˆ</p><p>æˆ–è€…ç©ºäº†ï¼Œæˆ–è€…æ˜¯æ‰€ä¸å¯¹åº”çš„æ—¶å€™ï¼Œè¿”å›fasle</p><p>ç„¶åæœ€åçœ‹æ˜¯ä¸æ˜¯ç©º</p><h2 id="121-ä¹°å–è‚¡ç¥¨çš„æœ€ä½³æ—¶æœº"><a href="#121-ä¹°å–è‚¡ç¥¨çš„æœ€ä½³æ—¶æœº" class="headerlink" title="121. ä¹°å–è‚¡ç¥¨çš„æœ€ä½³æ—¶æœº"></a><a href="https://leetcode.cn/problems/best-time-to-buy-and-sell-stock/">121. ä¹°å–è‚¡ç¥¨çš„æœ€ä½³æ—¶æœº</a></h2><p>ç»™å®šä¸€ä¸ªæ•°ç»„ <code>prices</code> ï¼Œå®ƒçš„ç¬¬ <code>i</code> ä¸ªå…ƒç´  <code>prices[i]</code> è¡¨ç¤ºä¸€æ”¯ç»™å®šè‚¡ç¥¨ç¬¬ <code>i</code> å¤©çš„ä»·æ ¼ã€‚</p><p>ä½ åªèƒ½é€‰æ‹© <strong>æŸä¸€å¤©</strong> ä¹°å…¥è¿™åªè‚¡ç¥¨ï¼Œå¹¶é€‰æ‹©åœ¨ <strong>æœªæ¥çš„æŸä¸€ä¸ªä¸åŒçš„æ—¥å­</strong> å–å‡ºè¯¥è‚¡ç¥¨ã€‚è®¾è®¡ä¸€ä¸ªç®—æ³•æ¥è®¡ç®—ä½ æ‰€èƒ½è·å–çš„æœ€å¤§åˆ©æ¶¦ã€‚</p><p>è¿”å›ä½ å¯ä»¥ä»è¿™ç¬”äº¤æ˜“ä¸­è·å–çš„æœ€å¤§åˆ©æ¶¦ã€‚å¦‚æœä½ ä¸èƒ½è·å–ä»»ä½•åˆ©æ¶¦ï¼Œè¿”å› <code>0</code> ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution121</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">maxProfit</span><span class="params">(<span class="type">int</span>[] prices)</span>&#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">cost</span> <span class="operator">=</span> Integer.MAX_VALUE,profit = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> p:prices)&#123;</span><br><span class="line">            cost = Math.min(cost,p);</span><br><span class="line">            profit = Math.max(profit,p-cost);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> profit;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>easyé¢˜ç›®</p><h2 id="103-äºŒå‰æ ‘çš„é”¯é½¿å½¢å±‚åºéå†"><a href="#103-äºŒå‰æ ‘çš„é”¯é½¿å½¢å±‚åºéå†" class="headerlink" title="103. äºŒå‰æ ‘çš„é”¯é½¿å½¢å±‚åºéå†"></a><a href="https://leetcode.cn/problems/binary-tree-zigzag-level-order-traversal/">103. äºŒå‰æ ‘çš„é”¯é½¿å½¢å±‚åºéå†</a></h2><p>ç»™ä½ äºŒå‰æ ‘çš„æ ¹èŠ‚ç‚¹ <code>root</code> ï¼Œè¿”å›å…¶èŠ‚ç‚¹å€¼çš„ <strong>é”¯é½¿å½¢å±‚åºéå†</strong> ã€‚ï¼ˆå³å…ˆä»å·¦å¾€å³ï¼Œå†ä»å³å¾€å·¦è¿›è¡Œä¸‹ä¸€å±‚éå†ï¼Œä»¥æ­¤ç±»æ¨ï¼Œå±‚ä¸å±‚ä¹‹é—´äº¤æ›¿è¿›è¡Œï¼‰ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution103A</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> List&lt;List&lt;Integer&gt;&gt; <span class="title function_">zigzagLevelOrder</span><span class="params">(TreeNode root)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (root==<span class="literal">null</span>) <span class="keyword">return</span> List.of();</span><br><span class="line">        List&lt;List&lt;Integer&gt;&gt; ans = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        Queue&lt;TreeNode&gt; q = <span class="keyword">new</span> <span class="title class_">ArrayDeque</span>&lt;&gt;();</span><br><span class="line">        q.add(root);</span><br><span class="line">        <span class="keyword">while</span> (!q.isEmpty())&#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> q.size();</span><br><span class="line">            List&lt;Integer&gt; vals = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(n);</span><br><span class="line">            <span class="keyword">while</span> (n--&gt;<span class="number">0</span>)&#123;</span><br><span class="line">                <span class="type">TreeNode</span> <span class="variable">node</span> <span class="operator">=</span> q.poll();</span><br><span class="line">                vals.add(node.val);</span><br><span class="line">                <span class="keyword">if</span> (node.left!=<span class="literal">null</span>) q.add(node.left);</span><br><span class="line">                <span class="keyword">if</span> (node.right!=<span class="literal">null</span>) q.add(node.right);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (ans.size()%<span class="number">2</span>&gt;<span class="number">0</span>) Collections.reverse(vals);</span><br><span class="line">            ans.add(vals);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸€çœ‹åˆ°è¿™ç§å±‚åºéå†ï¼Œæˆ‘ä»¬é¦–å…ˆæƒ³åˆ°ä½¿ç”¨bfsï¼Œç„¶åå±‚åºéå†ï¼Œå…ˆéå†left,ç„¶åéå†right</p><p>ä¹‹å‰çš„ä»£ç è·Ÿå±‚åºéå†å·®ä¸å¤šï¼Œåªä¸è¿‡ï¼Œä»–è¦å½¢æˆé”¯é½¿çŠ¶ï¼Œå¥‡æ•°å±‚å°±è¦åè½¬ã€‚å³å°±æ˜¯ä¸‹é¢çš„ä»£ç </p><p>åˆšåˆšå‰é¢åˆ¤æ–­å†™çš„æœ‰ç‚¹éº»çƒ¦äº†</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution103A</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> List&lt;List&lt;Integer&gt;&gt; <span class="title function_">zigzagLevelOrder</span><span class="params">(TreeNode root)</span>&#123;</span><br><span class="line">        </span><br><span class="line">        List&lt;List&lt;Integer&gt;&gt; ans = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        Queue&lt;TreeNode&gt; q = <span class="keyword">new</span> <span class="title class_">ArrayDeque</span>&lt;&gt;();</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span>(root!=<span class="literal">null</span>) q.add(root);</span><br><span class="line">        <span class="keyword">while</span> (!q.isEmpty())&#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> q.size();</span><br><span class="line">            List&lt;Integer&gt; vals = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(n);</span><br><span class="line">            <span class="keyword">while</span> (n--&gt;<span class="number">0</span>)&#123;</span><br><span class="line">                <span class="type">TreeNode</span> <span class="variable">node</span> <span class="operator">=</span> q.poll();</span><br><span class="line">                vals.add(node.val);</span><br><span class="line">                <span class="keyword">if</span> (node.left!=<span class="literal">null</span>) q.add(node.left);</span><br><span class="line">                <span class="keyword">if</span> (node.right!=<span class="literal">null</span>) q.add(node.right);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (ans.size()%<span class="number">2</span>&gt;<span class="number">0</span>) Collections.reverse(vals);</span><br><span class="line">            ans.add(vals);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æ›´æ­£ä¸€ä¸‹</p><blockquote><p>è”ç³»102äºŒå‰æ ‘çš„å±‚åºéå†</p></blockquote><h2 id="236-äºŒå‰æ ‘çš„æœ€è¿‘å…¬å…±ç¥–å…ˆ"><a href="#236-äºŒå‰æ ‘çš„æœ€è¿‘å…¬å…±ç¥–å…ˆ" class="headerlink" title="236. äºŒå‰æ ‘çš„æœ€è¿‘å…¬å…±ç¥–å…ˆ"></a><a href="https://leetcode.cn/problems/lowest-common-ancestor-of-a-binary-tree/">236. äºŒå‰æ ‘çš„æœ€è¿‘å…¬å…±ç¥–å…ˆ</a></h2><p>ç»™å®šä¸€ä¸ªäºŒå‰æ ‘, æ‰¾åˆ°è¯¥æ ‘ä¸­ä¸¤ä¸ªæŒ‡å®šèŠ‚ç‚¹çš„æœ€è¿‘å…¬å…±ç¥–å…ˆã€‚</p><p><a href="https://baike.baidu.com/item/æœ€è¿‘å…¬å…±ç¥–å…ˆ/8918834?fr=aladdin">ç™¾åº¦ç™¾ç§‘</a>ä¸­æœ€è¿‘å…¬å…±ç¥–å…ˆçš„å®šä¹‰ä¸ºï¼šâ€œå¯¹äºæœ‰æ ¹æ ‘ T çš„ä¸¤ä¸ªèŠ‚ç‚¹ pã€qï¼Œæœ€è¿‘å…¬å…±ç¥–å…ˆè¡¨ç¤ºä¸ºä¸€ä¸ªèŠ‚ç‚¹ xï¼Œæ»¡è¶³ x æ˜¯ pã€q çš„ç¥–å…ˆä¸” x çš„æ·±åº¦å°½å¯èƒ½å¤§ï¼ˆ<strong>ä¸€ä¸ªèŠ‚ç‚¹ä¹Ÿå¯ä»¥æ˜¯å®ƒè‡ªå·±çš„ç¥–å…ˆ</strong>ï¼‰ã€‚â€</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution236</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> TreeNode <span class="title function_">lowestCommonAncestor</span><span class="params">(TreeNode root,TreeNode p,TreeNode q)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (root==<span class="literal">null</span>||root==q||root==p) <span class="keyword">return</span> root;</span><br><span class="line">        <span class="type">TreeNode</span> <span class="variable">left</span> <span class="operator">=</span> lowestCommonAncestor(root.left,p,q);</span><br><span class="line">        <span class="type">TreeNode</span> <span class="variable">right</span> <span class="operator">=</span> lowestCommonAncestor(root.right,p,q);</span><br><span class="line">        <span class="keyword">if</span> (left==<span class="literal">null</span>) <span class="keyword">return</span> right;</span><br><span class="line">        <span class="keyword">if</span> (right==<span class="literal">null</span>) <span class="keyword">return</span> left;</span><br><span class="line">        <span class="keyword">return</span> root;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å°±æ˜¯æœ‰å•¥å°±è¿”å›å•¥ï¼Œæ²¡æœ‰å°±è¿”å›å¦ä¸€åŠï¼Œéƒ½æ²¡æœ‰å°±è¿”å›root</p><h2 id="141-ç¯å½¢é“¾è¡¨"><a href="#141-ç¯å½¢é“¾è¡¨" class="headerlink" title="141. ç¯å½¢é“¾è¡¨"></a><a href="https://leetcode.cn/problems/linked-list-cycle/">141. ç¯å½¢é“¾è¡¨</a></h2><p>ç»™ä½ ä¸€ä¸ªé“¾è¡¨çš„å¤´èŠ‚ç‚¹ <code>head</code> ï¼Œåˆ¤æ–­é“¾è¡¨ä¸­æ˜¯å¦æœ‰ç¯ã€‚</p><p>å¦‚æœé“¾è¡¨ä¸­æœ‰æŸä¸ªèŠ‚ç‚¹ï¼Œå¯ä»¥é€šè¿‡è¿ç»­è·Ÿè¸ª <code>next</code> æŒ‡é’ˆå†æ¬¡åˆ°è¾¾ï¼Œåˆ™é“¾è¡¨ä¸­å­˜åœ¨ç¯ã€‚ ä¸ºäº†è¡¨ç¤ºç»™å®šé“¾è¡¨ä¸­çš„ç¯ï¼Œè¯„æµ‹ç³»ç»Ÿå†…éƒ¨ä½¿ç”¨æ•´æ•° <code>pos</code> æ¥è¡¨ç¤ºé“¾è¡¨å°¾è¿æ¥åˆ°é“¾è¡¨ä¸­çš„ä½ç½®ï¼ˆç´¢å¼•ä» 0 å¼€å§‹ï¼‰ã€‚<strong>æ³¨æ„ï¼š<code>pos</code> ä¸ä½œä¸ºå‚æ•°è¿›è¡Œä¼ é€’</strong> ã€‚ä»…ä»…æ˜¯ä¸ºäº†æ ‡è¯†é“¾è¡¨çš„å®é™…æƒ…å†µã€‚</p><p><em>å¦‚æœé“¾è¡¨ä¸­å­˜åœ¨ç¯</em> ï¼Œåˆ™è¿”å› <code>true</code> ã€‚ å¦åˆ™ï¼Œè¿”å› <code>false</code> ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution141</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">hasCycle</span><span class="params">(ListNode head)</span> &#123;</span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">fast</span> <span class="operator">=</span> head, slow = head;</span><br><span class="line">        <span class="keyword">while</span> (fast != <span class="literal">null</span> &amp;&amp; fast.next != <span class="literal">null</span>) &#123;</span><br><span class="line">            fast = fast.next.next;</span><br><span class="line">            slow = slow.next;</span><br><span class="line">            <span class="keyword">if</span> (slow == fast) &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªç¯å½¢ï¼Œä¹Ÿå°±æ˜¯è¯´æ˜¯å¿«æ…¢æŒ‡é’ˆç¢°åˆ°ä¸€å—äº†å°±æ˜¯ä¸€ä¸ªç¯</p><h2 id="92-åè½¬é“¾è¡¨-II"><a href="#92-åè½¬é“¾è¡¨-II" class="headerlink" title="92. åè½¬é“¾è¡¨ II"></a><a href="https://leetcode.cn/problems/reverse-linked-list-ii/">92. åè½¬é“¾è¡¨ II</a></h2><p>ç»™ä½ å•é“¾è¡¨çš„å¤´æŒ‡é’ˆ <code>head</code> å’Œä¸¤ä¸ªæ•´æ•° <code>left</code> å’Œ <code>right</code> ï¼Œå…¶ä¸­ <code>left &lt;= right</code> ã€‚è¯·ä½ åè½¬ä»ä½ç½® <code>left</code> åˆ°ä½ç½® <code>right</code> çš„é“¾è¡¨èŠ‚ç‚¹ï¼Œè¿”å› <strong>åè½¬åçš„é“¾è¡¨</strong> ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution92</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> ListNode <span class="title function_">reverseBetween</span><span class="params">(ListNode head, <span class="type">int</span> left, <span class="type">int</span> right)</span>&#123;</span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">dummy</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ListNode</span>(<span class="number">0</span>,head);</span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">p0</span> <span class="operator">=</span> dummy;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>;i&lt;left-<span class="number">1</span>;i++)&#123;</span><br><span class="line">            p0= p0.next;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">pre</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">        <span class="type">ListNode</span> <span class="variable">cur</span> <span class="operator">=</span> p0.next;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>;i&lt;right-left+<span class="number">1</span>;i++)&#123;</span><br><span class="line">            <span class="type">ListNode</span> <span class="variable">next</span> <span class="operator">=</span> cur.next;</span><br><span class="line">            cur.next = pre;</span><br><span class="line">            pre = cur;</span><br><span class="line">            cur= next;</span><br><span class="line">        &#125;</span><br><span class="line">        p0.next.next = cur;</span><br><span class="line">        p0.next = pre;</span><br><span class="line">        <span class="keyword">return</span> dummy.next;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>ç±»ä¼¼ leetcode25,206</p></blockquote><p>åè½¬éœ€è¦æ³¨æ„çš„</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ListNode next = cur.next;</span><br><span class="line">            cur.next = pre;</span><br><span class="line">            pre = cur;</span><br><span class="line">            cur= next;</span><br></pre></td></tr></table></figure><p>åè½¬ååœ¨åŸæ¥çš„é“¾è¡¨ä¸Šçœ‹ï¼ŒpreæŒ‡å‘åè½¬ä¸€æ®µçš„æœ«å°¾ï¼Œ</p><p>curæŒ‡å‘åè½¬ä¸€æ®µåç»­çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹</p><p>ç„¶åä¿®æ”¹</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">p0.next.next = cur;</span><br><span class="line">        p0.next = pre;</span><br><span class="line">        return dummy.next;</span><br></pre></td></tr></table></figure><h2 id="54-èºæ—‹çŸ©é˜µ"><a href="#54-èºæ—‹çŸ©é˜µ" class="headerlink" title="54. èºæ—‹çŸ©é˜µ"></a><a href="https://leetcode.cn/problems/spiral-matrix/">54. èºæ—‹çŸ©é˜µ</a></h2><p>ç»™ä½ ä¸€ä¸ª <code>m</code> è¡Œ <code>n</code> åˆ—çš„çŸ©é˜µ <code>matrix</code> ï¼Œè¯·æŒ‰ç…§ <strong>é¡ºæ—¶é’ˆèºæ—‹é¡ºåº</strong> ï¼Œè¿”å›çŸ©é˜µä¸­çš„æ‰€æœ‰å…ƒç´ ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution54A</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> List&lt;Integer&gt; <span class="title function_">spiralOrder</span><span class="params">(<span class="type">int</span>[][] matrix)</span>&#123;</span><br><span class="line">        List&lt;Integer&gt; res = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">if</span> (matrix.length==<span class="number">0</span>) <span class="keyword">return</span> res;</span><br><span class="line">        <span class="type">int</span> <span class="variable">l</span> <span class="operator">=</span><span class="number">0</span>,r = matrix[<span class="number">0</span>].length-<span class="number">1</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">t</span> <span class="operator">=</span> <span class="number">0</span>,b = matrix.length-<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (l&lt;=r&amp;&amp;t&lt;=b)&#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> l;i&lt;=r;i++) res.add(matrix[t][i]);</span><br><span class="line">            t++;</span><br><span class="line">            <span class="keyword">if</span> (t&gt;b) <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span>t;i&lt;=b;i++) res.add(matrix[i][r]);</span><br><span class="line">            r--;</span><br><span class="line">            <span class="keyword">if</span> (l&gt;r) <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> i=r;i&gt;=l;i--) res.add(matrix[b][i]);</span><br><span class="line">            b--;</span><br><span class="line">            <span class="keyword">if</span> (t&gt;b) <span class="keyword">break</span>;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span>b;i&gt;=t;i--) res.add(matrix[i][l]);</span><br><span class="line">            l++;</span><br><span class="line">            <span class="keyword">if</span> (l&gt;r) <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å°±æ˜¯ä¸€ä¸ªéå†çš„é—®é¢˜ï¼Œä»å·¦åˆ°å³ï¼Œä»ä¸Šåˆ°ä¸‹ï¼Œç„¶åä»å³åˆ°å·¦ï¼Œå†ä»ä¸‹åˆ°ä¸Š</p><p>ç„¶åå¾ªç¯ï¼Œä¸»è¦æ˜¯è¾¹ç•Œä¹Ÿè¦è·Ÿç€ç§»åŠ¨</p><h2 id="300-æœ€é•¿é€’å¢å­åºåˆ—"><a href="#300-æœ€é•¿é€’å¢å­åºåˆ—" class="headerlink" title="300. æœ€é•¿é€’å¢å­åºåˆ—"></a><a href="https://leetcode.cn/problems/longest-increasing-subsequence/">300. æœ€é•¿é€’å¢å­åºåˆ—</a></h2><p>ç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„ <code>nums</code> ï¼Œæ‰¾åˆ°å…¶ä¸­æœ€é•¿ä¸¥æ ¼é€’å¢å­åºåˆ—çš„é•¿åº¦ã€‚</p><p><strong>å­åºåˆ—</strong> æ˜¯ç”±æ•°ç»„æ´¾ç”Ÿè€Œæ¥çš„åºåˆ—ï¼Œåˆ é™¤ï¼ˆæˆ–ä¸åˆ é™¤ï¼‰æ•°ç»„ä¸­çš„å…ƒç´ è€Œä¸æ”¹å˜å…¶ä½™å…ƒç´ çš„é¡ºåºã€‚ä¾‹å¦‚ï¼Œ<code>[3,6,2,7]</code> æ˜¯æ•°ç»„ <code>[0,3,1,6,2,2,7]</code> çš„å­åºåˆ—ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution300</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">lengthOfLIS</span><span class="params">(<span class="type">int</span>[] nums)</span>&#123;</span><br><span class="line">        <span class="type">int</span>[] res = <span class="keyword">new</span> <span class="title class_">int</span>[nums.length];</span><br><span class="line">        <span class="type">int</span> <span class="variable">k</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        res[<span class="number">0</span>] = nums[<span class="number">0</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span>  <span class="operator">=</span><span class="number">1</span>;i&lt;nums.length;i++)&#123;</span><br><span class="line">            <span class="keyword">if</span> (nums[i]&gt;res[k])&#123;</span><br><span class="line">                res[++k] = nums[i];</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> <span class="number">0</span>;j&lt;=k;j++)&#123;</span><br><span class="line">                <span class="keyword">if</span> (res[j]&gt;=nums[i])&#123;</span><br><span class="line">                    res[j] =nums[i];</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> k+<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å…ˆéå†å‡ºæ¥ä¸ªé€’å¢çš„æ•°ç»„</p><p>å¦‚æœä¸æ˜¯çš„è¯ï¼Œä»0-kä¸­æ‰¾ä¸€ä¸ªåˆ«çš„æ•°ï¼Œæ¥è´ªå¿ƒæ›¿æ¢</p><p>æœ€åk+1å°±æ˜¯æœ‰æ•ˆçš„é•¿åº¦</p>]]></content:encoded>
      
      
      <category domain="https://blog.tokenlen.top/categories/java/">java</category>
      
      
      <category domain="https://blog.tokenlen.top/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/">æ•°æ®ç»“æ„</category>
      
      <category domain="https://blog.tokenlen.top/tags/java/">java</category>
      
      <category domain="https://blog.tokenlen.top/tags/leetcode/">leetcode</category>
      
      
      <comments>https://blog.tokenlen.top/2025/05/28/leetcode/leetocdehot1/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>JAVAè®¾è®¡é¢è¯•é¢˜ç›®hot</title>
      <link>https://blog.tokenlen.top/2025/05/27/java-stack/javasample1/</link>
      <guid>https://blog.tokenlen.top/2025/05/27/java-stack/javasample1/</guid>
      <pubDate>Mon, 26 May 2025 16:00:00 GMT</pubDate>
      
        
        
          
          
      <description>&lt;h1 id=&quot;Controller&quot;&gt;&lt;a href=&quot;#Controller&quot; class=&quot;headerlink&quot; title=&quot;Controller&quot;&gt;&lt;/a&gt;Controller&lt;/h1&gt;&lt;h2</description>
          
        
      
      
      
      <content:encoded><![CDATA[<h1 id="Controller"><a href="#Controller" class="headerlink" title="Controller"></a>Controller</h1><h2 id="1-å†™ä¸€ä¸ªç®€å•çš„ç™»å½•æ¥å£çš„Controllerï¼ŒåŒ…å«ç”¨æˆ·IDå’Œå¯†ç å­—æ®µã€‚"><a href="#1-å†™ä¸€ä¸ªç®€å•çš„ç™»å½•æ¥å£çš„Controllerï¼ŒåŒ…å«ç”¨æˆ·IDå’Œå¯†ç å­—æ®µã€‚" class="headerlink" title="1.å†™ä¸€ä¸ªç®€å•çš„ç™»å½•æ¥å£çš„Controllerï¼ŒåŒ…å«ç”¨æˆ·IDå’Œå¯†ç å­—æ®µã€‚"></a>1.å†™ä¸€ä¸ªç®€å•çš„ç™»å½•æ¥å£çš„Controllerï¼ŒåŒ…å«ç”¨æˆ·IDå’Œå¯†ç å­—æ®µã€‚</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/api/auth&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AuthController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserService userService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/login&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;?&gt; login(<span class="meta">@RequestBody</span> LoginRequest request) &#123;</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userService.findByUserId(request.getUserId());</span><br><span class="line">        <span class="keyword">if</span> (user == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> ResponseEntity.status(HttpStatus.UNAUTHORIZED).body(<span class="string">&quot;ç”¨æˆ·ä¸å­˜åœ¨&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (!user.getPassword().equals(request.getPassword())) &#123;</span><br><span class="line">            <span class="keyword">return</span> ResponseEntity.status(HttpStatus.UNAUTHORIZED).body(<span class="string">&quot;å¯†ç é”™è¯¯&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ¨¡æ‹Ÿç”Ÿæˆ JWTï¼ˆå¯æ›¿æ¢ä¸ºçœŸå®ç”Ÿæˆï¼‰</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">token</span> <span class="operator">=</span> JwtUtil.createToken(user.getId().toString(), <span class="number">10</span> * <span class="number">60</span> * <span class="number">1000</span>); <span class="comment">// 10åˆ†é’Ÿæœ‰æ•ˆ</span></span><br><span class="line"></span><br><span class="line">        Map&lt;String, Object&gt; response = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        response.put(<span class="string">&quot;accessToken&quot;</span>, token);</span><br><span class="line">        response.put(<span class="string">&quot;userId&quot;</span>, user.getId());</span><br><span class="line">        response.put(<span class="string">&quot;username&quot;</span>, user.getUsername());</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.ok(response);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">findByUserId</span><span class="params">(String userId)</span> &#123;</span><br><span class="line">        <span class="comment">// æ¨¡æ‹ŸæŸ¥åº“</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="string">&quot;admin&quot;</span>.equals(userId)) &#123;</span><br><span class="line">            <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>();</span><br><span class="line">            user.setId(<span class="number">1L</span>);</span><br><span class="line">            user.setUserId(<span class="string">&quot;admin&quot;</span>);</span><br><span class="line">            user.setUsername(<span class="string">&quot;ç®¡ç†å‘˜&quot;</span>);</span><br><span class="line">            user.setPassword(<span class="string">&quot;123456&quot;</span>); <span class="comment">// æ˜æ–‡å¯†ç ä»…ç”¨äºæ¼”ç¤º</span></span><br><span class="line">            <span class="keyword">return</span> user;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="2-å¯¹äºPOSTè¯·æ±‚ï¼Œä½ æ˜¯ç›´æ¥ç”¨å‚æ•°æ¥æ”¶ï¼Œè¿˜æ˜¯å°è£…æˆå¯¹è±¡æ¥æ”¶ï¼Ÿ"><a href="#2-å¯¹äºPOSTè¯·æ±‚ï¼Œä½ æ˜¯ç›´æ¥ç”¨å‚æ•°æ¥æ”¶ï¼Œè¿˜æ˜¯å°è£…æˆå¯¹è±¡æ¥æ”¶ï¼Ÿ" class="headerlink" title="2.å¯¹äºPOSTè¯·æ±‚ï¼Œä½ æ˜¯ç›´æ¥ç”¨å‚æ•°æ¥æ”¶ï¼Œè¿˜æ˜¯å°è£…æˆå¯¹è±¡æ¥æ”¶ï¼Ÿ"></a>2.å¯¹äºPOSTè¯·æ±‚ï¼Œä½ æ˜¯ç›´æ¥ç”¨å‚æ•°æ¥æ”¶ï¼Œè¿˜æ˜¯å°è£…æˆå¯¹è±¡æ¥æ”¶ï¼Ÿ</h2><p>å°è£…æˆå¯¹è±¡æ¥æ¥å—ã€‚</p><p>åœ¨å¼€å‘ä¸­ï¼Œå¯¹äº POST è¯·æ±‚ï¼Œæˆ‘æ›´å€¾å‘äºä½¿ç”¨ <code>@RequestBody</code> å°†å‚æ•°å°è£…æˆå¯¹è±¡ã€‚è¿™ç§æ–¹å¼æ›´æ¸…æ™°ã€å¯ç»´æŠ¤ï¼Œä¹Ÿæ–¹ä¾¿è¿›è¡Œå‚æ•°æ ¡éªŒå’Œè‡ªåŠ¨ç”Ÿæˆ Swagger æ–‡æ¡£ã€‚å¦‚æœå‚æ•°è¾ƒå°‘ã€æ˜¯ç®€å•çš„è¡¨å•æäº¤ï¼Œå¶å°”ä¹Ÿå¯ä»¥ç”¨ <code>@RequestParam</code>ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping(&quot;/login&quot;)</span></span><br><span class="line"><span class="keyword">public</span> ResponseEntity&lt;?&gt; login(<span class="meta">@RequestBody</span> LoginRequest request) &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">userId</span> <span class="operator">=</span> request.getUserId();</span><br><span class="line">    <span class="type">String</span> <span class="variable">password</span> <span class="operator">=</span> request.getPassword();</span><br><span class="line">    <span class="comment">// ç™»å½•é€»è¾‘...</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoginRequest</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String userId;</span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å°è£…æˆç±»ï¼Œå‚æ•°å¤šçš„æ—¶å€™ï¼Œä¸å®œæ··ä¹±ï¼Œæ–¹ä¾¿æ‰©å±•ï¼Œæ–°å¢å­—æ®µçš„æ—¶å€™ï¼Œä¸ç”¨æ”¹æ–¹æ³•ç­¾åï¼Œæ”¯æŒéªŒè¯æ³¨è§£ï¼Œå¦‚ <code>@NotBlank</code>ã€<code>@Size</code> ç›´æ¥åŠ åœ¨ç±»å­—æ®µä¸Šã€‚æ›´åŠ é€‚åˆSwaggerè‡ªåŠ¨æ–‡æ¡£ï¼Œè‡ªåŠ¨è¯†åˆ«è¯·æ±‚ç»“æ„ã€‚</p><p>ä¸å°è£…çš„è¯ï¼Œå‚æ•°ç­¾åè¶Šæ¥è¶Šé•¿ï¼Œè€Œä¸”æ— æ³•å¤„ç† <code>application/json</code> è¯·æ±‚ã€‚ä¸èƒ½é˜Ÿå•ä¸ªå­—æ®µåŠ éªŒè¯è§„åˆ™ã€‚</p><h2 id="3-ä½ åœ¨å·¥ä½œä¸­æ˜¯å¦‚ä½•è¿›è¡Œå‚æ•°éç©ºæ ¡éªŒçš„ï¼Ÿ"><a href="#3-ä½ åœ¨å·¥ä½œä¸­æ˜¯å¦‚ä½•è¿›è¡Œå‚æ•°éç©ºæ ¡éªŒçš„ï¼Ÿ" class="headerlink" title="3.ä½ åœ¨å·¥ä½œä¸­æ˜¯å¦‚ä½•è¿›è¡Œå‚æ•°éç©ºæ ¡éªŒçš„ï¼Ÿ"></a>3.ä½ åœ¨å·¥ä½œä¸­æ˜¯å¦‚ä½•è¿›è¡Œå‚æ•°éç©ºæ ¡éªŒçš„ï¼Ÿ</h2><p>åœ¨å·¥ä½œä¸­ï¼Œæˆ‘ä¼šæ ¹æ®å…·ä½“åœºæ™¯ï¼Œåœ¨ <strong>ä¸‰ä¸ªå±‚æ¬¡</strong> å¯¹å‚æ•°è¿›è¡Œéç©ºæ ¡éªŒï¼š</p><ol><li><strong>å‰ç«¯æ ¡éªŒ</strong>ï¼šå‰ç«¯é€šè¿‡ JS æˆ–ç»„ä»¶æ ¡éªŒæ¡†æ¶ï¼ˆå¦‚ Element Plus è¡¨å•æ ¡éªŒã€AntD Ruleï¼‰æ¥åšç¬¬ä¸€å±‚å‚æ•°åˆæ³•æ€§æ ¡éªŒï¼Œæå‡ç”¨æˆ·ä½“éªŒã€‚</li><li><strong>åç«¯æ§åˆ¶å±‚æ ¡éªŒï¼ˆæ¨èï¼‰</strong>ï¼šä½¿ç”¨ Spring çš„ <code>javax.validation</code> æ³¨è§£ï¼ˆå¦‚ <code>@NotBlank</code>ã€<code>@NotNull</code>ã€<code>@Size</code>ï¼‰ç»“åˆ <code>@Valid</code> å®ç°è‡ªåŠ¨å‚æ•°æ ¡éªŒï¼Œ<strong>ç»Ÿä¸€å¼‚å¸¸å¤„ç†</strong>è¿”å›æç¤ºã€‚</li><li><strong>ä¸šåŠ¡é€»è¾‘æ ¡éªŒï¼ˆæœåŠ¡å±‚ï¼‰</strong>ï¼šå¯¹å…³é”®å‚æ•°è¿›è¡Œä¸šåŠ¡æ ¡éªŒï¼ˆå¦‚è´¦å·æ˜¯å¦å­˜åœ¨ã€å¯†ç æ˜¯å¦ä¸ºç©ºã€ä¸¤ä¸ªå­—æ®µä¸èƒ½åŒæ—¶ä¸ºç©ºç­‰ï¼‰ï¼Œä¿è¯é€»è¾‘æ­£ç¡®æ€§ã€‚</li></ol><p>controllerå±‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping(&quot;/login&quot;)</span></span><br><span class="line"><span class="keyword">public</span> ResponseEntity&lt;?&gt; login(<span class="meta">@Valid</span> <span class="meta">@RequestBody</span> LoginRequest request) &#123;</span><br><span class="line">    <span class="comment">// å¦‚æœå‚æ•°æ ¡éªŒå¤±è´¥ï¼Œä¼šè‡ªåŠ¨æŠ›å‡ºå¼‚å¸¸</span></span><br><span class="line">    <span class="keyword">return</span> authService.login(request);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>DTO+æ³¨è§£</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoginRequest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@NotBlank(message = &quot;ç”¨æˆ·IDä¸èƒ½ä¸ºç©º&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String userId;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@NotBlank(message = &quot;å¯†ç ä¸èƒ½ä¸ºç©º&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å…¨å±€å¼‚å¸¸å¤„ç†ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestControllerAdvice</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GlobalExceptionHandler</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ExceptionHandler(MethodArgumentNotValidException.class)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;?&gt; handleValidationException(MethodArgumentNotValidException ex) &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">msg</span> <span class="operator">=</span> ex.getBindingResult().getFieldError().getDefaultMessage();</span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.badRequest().body(Map.of(<span class="string">&quot;error&quot;</span>, msg));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è¿˜å°è£…äº†ç»Ÿä¸€çš„ <code>BaseRequest</code> ç±» + å‚æ•°æ ¡éªŒé€šç”¨æ³¨è§£ï¼Œé…åˆå…¨å±€å¼‚å¸¸è¿”å›æ ‡å‡†åŒ–çš„é”™è¯¯ç»“æ„ï¼Œåšåˆ°æ¥å£å‹å¥½ã€å¼€å‘é«˜æ•ˆã€‚</p><p>BaseRequest</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BaseRequest</span> &#123;</span><br><span class="line">    <span class="meta">@NotNull(message = &quot;è¯·æ±‚æ—¶é—´æˆ³ä¸èƒ½ä¸ºç©º&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Long timestamp;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@NotBlank(message = &quot;è¯·æ±‚æ¥æºä¸èƒ½ä¸ºç©º&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String source; <span class="comment">// web / app / admin ç­‰</span></span><br><span class="line"></span><br><span class="line">    <span class="meta">@NotBlank(message = &quot;ç­¾åä¸èƒ½ä¸ºç©º&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String sign;   <span class="comment">// ç”¨äºç®€å•ç­¾åæ ¡éªŒ</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å®é™…è¯·æ±‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoginRequest</span> <span class="keyword">extends</span> <span class="title class_">BaseRequest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@NotBlank(message = &quot;ç”¨æˆ·IDä¸èƒ½ä¸ºç©º&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String userId;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@NotBlank(message = &quot;å¯†ç ä¸èƒ½ä¸ºç©º&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>Controller ä¸­ä½¿ç”¨ <code>@Valid</code> æ¥æ”¶å‚æ•°</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@PostMapping(&quot;/login&quot;)</span></span><br><span class="line"><span class="keyword">public</span> ResponseEntity&lt;?&gt; login(<span class="meta">@Valid</span> <span class="meta">@RequestBody</span> LoginRequest request) &#123;</span><br><span class="line">    <span class="comment">// æ ¡éªŒé€šè¿‡ï¼Œæ‰§è¡Œä¸šåŠ¡é€»è¾‘</span></span><br><span class="line">    <span class="keyword">return</span> authService.login(request);</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å…¨å±€å¼‚å¸¸å¤„ç†è¿”å›ç»Ÿä¸€æ ¼å¼ï¼ˆå¦‚ <code>Result&lt;T&gt;</code>ï¼‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Result</span>&lt;T&gt; &#123;</span><br><span class="line">    <span class="keyword">private</span> Integer code;</span><br><span class="line">    <span class="keyword">private</span> String message;</span><br><span class="line">    <span class="keyword">private</span> T data;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> &lt;T&gt; Result&lt;T&gt; <span class="title function_">success</span><span class="params">(T data)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Result</span>&lt;&gt;(<span class="number">200</span>, <span class="string">&quot;success&quot;</span>, data);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Result&lt;?&gt; error(String message) &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Result</span>&lt;&gt;(<span class="number">400</span>, message, <span class="literal">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å‚æ•°æ ¡éªŒç»Ÿä¸€å¼‚å¸¸å¤„ç†ï¼ˆ<code>@ControllerAdvice</code>ï¼‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestControllerAdvice</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">GlobalExceptionHandler</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ExceptionHandler(MethodArgumentNotValidException.class)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;Result&lt;?&gt;&gt; handleValidation(MethodArgumentNotValidException ex) &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">msg</span> <span class="operator">=</span> ex.getBindingResult().getFieldError().getDefaultMessage();</span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.badRequest().body(Result.error(msg));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å…¶ä»–é€šç”¨å¼‚å¸¸å¤„ç†</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬é¡¹ç›®é‡Œç»Ÿä¸€å°è£…äº†è¯·æ±‚åŸºç±» <code>BaseRequest</code>ï¼Œæ¯ä¸ªæ¥å£è¯·æ±‚éƒ½åŒ…å« timestampã€sourceã€sign ç­‰å­—æ®µï¼ŒåŒæ—¶ç»“åˆ Spring çš„ <code>@Valid</code> å’Œè‡ªå®šä¹‰çš„é€šç”¨æ³¨è§£è¿›è¡Œå­—æ®µæ ¡éªŒï¼Œé…åˆç»Ÿä¸€å¼‚å¸¸å¤„ç†ç±»ï¼Œè¿”å›æ ¼å¼ç»Ÿä¸€æˆ <code>Result&lt;T&gt;</code>ã€‚è¿™æ ·æ¥å£æ–‡æ¡£æ¸…æ™°ã€è°ƒè¯•æ–¹ä¾¿ã€å‰åç«¯è”è°ƒæ•ˆç‡é«˜ï¼Œå¼€å‘ä½“éªŒæå‡å¾ˆå¤šã€‚</p><h1 id="è®¾è®¡æ¨¡å¼"><a href="#è®¾è®¡æ¨¡å¼" class="headerlink" title="è®¾è®¡æ¨¡å¼"></a>è®¾è®¡æ¨¡å¼</h1><div class="table-container"><table><thead><tr><th>åˆ†ç±»</th><th>æ¨¡å¼</th><th>ä½œç”¨</th><th>ç¤ºä¾‹å…³é”®ç‚¹</th></tr></thead><tbody><tr><td>åˆ›å»ºå‹</td><td>å•ä¾‹æ¨¡å¼</td><td>ä¿è¯å…¨å±€åªæœ‰ä¸€ä¸ªå®ä¾‹</td><td>Spring ä¸­çš„ Bean é»˜è®¤å°±æ˜¯å•ä¾‹</td></tr><tr><td>åˆ›å»ºå‹</td><td>å·¥å‚æ¨¡å¼</td><td>ç»Ÿä¸€åˆ›å»ºå¯¹è±¡</td><td>æ•°æ®åº“è¿æ¥ã€ç­–ç•¥ç±»</td></tr><tr><td>ç»“æ„å‹</td><td>ä»£ç†æ¨¡å¼</td><td>ç»™ç›®æ ‡å¯¹è±¡å¢åŠ é¢å¤–åŠŸèƒ½</td><td>Spring AOPã€äº‹åŠ¡ã€æ—¥å¿—</td></tr><tr><td>ç»“æ„å‹</td><td>è£…é¥°å™¨æ¨¡å¼</td><td>åŠ¨æ€æ‰©å±•å¯¹è±¡åŠŸèƒ½</td><td>IO æµã€è¿‡æ»¤å™¨é“¾</td></tr><tr><td>è¡Œä¸ºå‹</td><td>ç­–ç•¥æ¨¡å¼</td><td>å¯åˆ‡æ¢çš„è¡Œä¸ºç®—æ³•</td><td>æ”¯ä»˜ã€æ¶ˆæ¯æ¨é€</td></tr><tr><td>è¡Œä¸ºå‹</td><td>è§‚å¯Ÿè€…æ¨¡å¼</td><td>å‘å¸ƒ/è®¢é˜…äº‹ä»¶é€šçŸ¥</td><td>MQã€äº‹ä»¶ç›‘å¬</td></tr><tr><td>è¡Œä¸ºå‹</td><td>æ¨¡æ¿æ–¹æ³•</td><td>å›ºå®šæµç¨‹ + å¯å˜æ­¥éª¤</td><td>æŠ½è±¡ Controllerã€ç™»å½•æµç¨‹</td></tr><tr><td>è¡Œä¸ºå‹</td><td>è´£ä»»é“¾æ¨¡å¼</td><td>å¤šä¸ªå¤„ç†å™¨ä¾æ¬¡å¤„ç†</td><td>è¿‡æ»¤å™¨é“¾ã€æƒé™è®¤è¯</td></tr><tr><td>è¡Œä¸ºå‹</td><td>çŠ¶æ€æ¨¡å¼</td><td>å¯¹è±¡çŠ¶æ€é©±åŠ¨è¡Œä¸º</td><td>è®¢å•ã€ä»»åŠ¡çŠ¶æ€</td></tr><tr><td>è¡Œä¸ºå‹</td><td>å‘½ä»¤æ¨¡å¼</td><td>æŠŠæ“ä½œå°è£…æˆå¯¹è±¡</td><td>ä»»åŠ¡æ’¤é”€ã€é™æµæ“ä½œå‘½ä»¤</td></tr></tbody></table></div><h2 id="å•ä¾‹æ¨¡å¼"><a href="#å•ä¾‹æ¨¡å¼" class="headerlink" title="å•ä¾‹æ¨¡å¼"></a>å•ä¾‹æ¨¡å¼</h2><p>ç¡®ä¿ä¸€ä¸ªç±»åœ¨æ•´ä¸ªåº”ç”¨ä¸­ <strong>åªæœ‰ä¸€ä¸ªå®ä¾‹</strong>ï¼Œå¹¶æä¾›ä¸€ä¸ªå…¨å±€è®¿é—®ç‚¹ã€‚</p><ul><li>Redis å·¥å…·ç±»ã€çº¿ç¨‹æ± ã€è¿æ¥æ± ã€é…ç½®ç±»ç­‰</li><li>Spring é»˜è®¤æ˜¯å•ä¾‹ Beanï¼ˆIOC æ§åˆ¶ï¼‰</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Singleton</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">volatile</span> Singleton instance;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">Singleton</span><span class="params">()</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Singleton <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (instance == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">synchronized</span>(Singleton.class) &#123;</span><br><span class="line">                <span class="keyword">if</span> (instance == <span class="literal">null</span>) &#123;</span><br><span class="line">                    instance = <span class="keyword">new</span> <span class="title class_">Singleton</span>(); <span class="comment">// é˜²æ­¢æŒ‡ä»¤é‡æ’</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>åŸºäºvolatileå’Œsynchronized</p><p><code>volatile</code>ï¼šé˜²æ­¢ JVM æŒ‡ä»¤é‡æ’åºï¼Œç¡®ä¿å®ä¾‹åˆå§‹åŒ–å®Œæˆåå†èµ‹å€¼ã€‚</p><p>åŒé‡æ ¡éªŒï¼šç¬¬ä¸€æ¬¡ if é¿å…æ¯æ¬¡åŠ é”ï¼Œç¬¬äºŒæ¬¡ if é¿å…å¹¶å‘é‡å¤åˆ›å»ºã€‚</p><p>æ¯”å¦‚Calendar:</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Calendar calendar = Calendar.getInstance();</span><br></pre></td></tr></table></figure><p>æ¯”å¦‚ Loggerï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Logger logger = Logger.getLogger(MyClass.class.getName());</span><br></pre></td></tr></table></figure><h2 id="å·¥å‚æ¨¡å¼"><a href="#å·¥å‚æ¨¡å¼" class="headerlink" title="å·¥å‚æ¨¡å¼"></a>å·¥å‚æ¨¡å¼</h2><p>æ ¹æ®ä¸åŒç±»å‹ <strong>ç”Ÿæˆä¸åŒå®ç°ç±»å®ä¾‹</strong>ï¼Œè§£è€¦å¯¹è±¡åˆ›å»ºè¿‡ç¨‹ã€‚</p><ul><li><p>æ ¹æ®ç±»å‹åˆ›å»ºæ”¯ä»˜å¤„ç†å™¨ã€ç™»å½•æ–¹å¼ã€å¯¼å‡ºç±»å‹ç­‰</p></li><li><p>åˆ›å»ºæ”¯ä»˜æ–¹å¼ï¼ˆæ”¯ä»˜å®ã€å¾®ä¿¡ï¼‰</p><p>åˆ›å»ºå¯¼å‡ºæœåŠ¡ï¼ˆExcelã€PDFï¼‰</p><p>ç™»å½•ç­–ç•¥ã€æ–‡ä»¶è§£æç­‰ç±»å‹å¤šå˜ç»„ä»¶</p></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.mengnankk.designpattern;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å·¥å‚ç±»</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ExportFactory</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> ExportService <span class="title function_">getExport</span><span class="params">(String type)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="string">&quot;excel&quot;</span>.equalsIgnoreCase(type)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ExcelExportService</span>();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;ä¸æ”¯æŒçš„ç±»å‹&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">interface</span> <span class="title class_">ExportService</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">export</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">ExcelExportService</span> <span class="keyword">implements</span> <span class="title class_">ExportService</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">export</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;å¯¼å‡ºExcel&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ç»“åˆæ¥å£éš”ç¦» + æšä¸¾æ³¨å†Œ</p><p>é€šè¿‡å·¥å‚ç±»å°è£…åˆ›å»ºé€»è¾‘</p><p>è¿”å›çš„æ˜¯æ¥å£ç±»å‹ï¼Œåˆ©äºæ‰©å±•å’Œè§£è€¦</p><p>ç»“åˆæšä¸¾æˆ–é…ç½®å¯å®ç°<strong>æ³¨å†Œå¼å·¥å‚</strong></p><h2 id="ç­–ç•¥æ¨¡å¼"><a href="#ç­–ç•¥æ¨¡å¼" class="headerlink" title="ç­–ç•¥æ¨¡å¼"></a>ç­–ç•¥æ¨¡å¼</h2><p>å®šä¹‰ä¸€ç³»åˆ—ç®—æ³•ï¼ˆç­–ç•¥ï¼‰ï¼Œå¹¶ä½¿å®ƒä»¬å¯ä»¥ç›¸äº’æ›¿æ¢ã€‚<strong>å°†è¡Œä¸ºä¸é€‰æ‹©è§£è€¦</strong>ã€‚</p><p>å¤šç§æ”¯ä»˜æ–¹å¼ã€ç™»å½•æ–¹å¼ã€å®¡æ ¸ç­–ç•¥ç­‰</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.mengnankk.designpattern;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Service;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PayContext</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> Map&lt;String,PayStrategy&gt; paymap;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">dopay</span><span class="params">(String type)</span>&#123;</span><br><span class="line">        <span class="type">PayStrategy</span> <span class="variable">strategy</span> <span class="operator">=</span> paymap.get(type);</span><br><span class="line">        <span class="keyword">if</span> (strategy!=<span class="literal">null</span>) strategy.pay();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> <span class="keyword">interface</span> <span class="title class_">PayStrategy</span>&#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">pay</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Component(&quot;aliPay&quot;)</span></span><br><span class="line"> <span class="keyword">class</span> <span class="title class_">AliPay</span> <span class="keyword">implements</span> <span class="title class_">PayStrategy</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">pay</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æ”¯ä»˜å®æ”¯ä»˜&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Component(&quot;wechatPay&quot;)</span></span><br><span class="line"> <span class="keyword">class</span> <span class="title class_">WeChatPay</span> <span class="keyword">implements</span> <span class="title class_">PayStrategy</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">pay</span><span class="params">()</span> &#123; System.out.println(<span class="string">&quot;å¾®ä¿¡æ”¯ä»˜&quot;</span>); &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>åˆ©ç”¨ Spring å®¹å™¨è‡ªåŠ¨æ³¨å…¥æ‰€æœ‰ç­–ç•¥ Bean</p><p>æ ¹æ® key è·å–ç­–ç•¥æ‰§è¡Œå¯¹åº”é€»è¾‘ï¼Œé¿å…å†™æ­» if-else æˆ– switch</p><p>å’Œå·¥å‚æ¨¡å¼çš„æœ€å¤§åŒºåˆ«æ˜¯ï¼š<strong>ç­–ç•¥å°è£…è¡Œä¸ºï¼Œå·¥å‚å°è£…åˆ›å»º</strong></p><h2 id="ä»£ç†æ¨¡å¼"><a href="#ä»£ç†æ¨¡å¼" class="headerlink" title="ä»£ç†æ¨¡å¼"></a>ä»£ç†æ¨¡å¼</h2><p>åœ¨ä¸ä¿®æ”¹ç›®æ ‡ç±»çš„æƒ…å†µä¸‹ï¼Œ<strong>å¢å¼ºå…¶åŠŸèƒ½ï¼ˆå¦‚æ—¥å¿—ã€æƒé™ã€äº‹åŠ¡ç­‰ï¼‰</strong></p><p>æ—¥å¿—ã€æƒé™ã€äº‹åŠ¡æ§åˆ¶ã€æ¥å£é™æµ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.mengnankk.designpattern;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.JoinPoint;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Aspect;</span><br><span class="line"><span class="keyword">import</span> org.aspectj.lang.annotation.Before;</span><br><span class="line"><span class="keyword">import</span> org.springframework.stereotype.Component;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.lang.annotation.*;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LogAspect</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Before(&quot;@annotation(com.mengnankk.designpattern.Log)&quot;)</span> <span class="comment">// æŒ‡å®šæ³¨è§£å…¨è·¯å¾„</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">logBefore</span><span class="params">(JoinPoint point)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;è°ƒç”¨æ–¹æ³•ï¼š&quot;</span> + point.getSignature().getName());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Target(ElementType.METHOD)</span></span><br><span class="line"><span class="meta">@Retention(RetentionPolicy.RUNTIME)</span></span><br><span class="line"><span class="meta">@Documented</span></span><br><span class="line"> <span class="meta">@interface</span> Log &#123;</span><br><span class="line">    String <span class="title function_">value</span><span class="params">()</span> <span class="keyword">default</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>AOP æœ¬è´¨æ˜¯åŠ¨æ€ä»£ç†ï¼ˆJDK æˆ– CGLIBï¼‰</p><p>åˆ©ç”¨åˆ‡ç‚¹è¡¨è¾¾å¼ <code>@annotation</code> å®šä½ç›®æ ‡æ–¹æ³•</p><p>å¢å¼ºåŠŸèƒ½é€šè¿‡åˆ‡é¢ç±»ç¼–ç»‡</p><h2 id="ä¿®é¥°å™¨æ¨¡å¼"><a href="#ä¿®é¥°å™¨æ¨¡å¼" class="headerlink" title="ä¿®é¥°å™¨æ¨¡å¼"></a>ä¿®é¥°å™¨æ¨¡å¼</h2><p>åœ¨ä¸ä¿®æ”¹åŸå§‹å¯¹è±¡çš„æƒ…å†µä¸‹ï¼Œ<strong>åŠ¨æ€å¢å¼ºå…¶åŠŸèƒ½</strong>ï¼ˆä¸ä»£ç†å¾ˆåƒï¼ŒåŒºåˆ«æ˜¯åŒ…è£…å¯¹è±¡ï¼‰</p><p>è¯·æ±‚/å“åº”å¢å¼ºå¤„ç†ã€æ—¥å¿—è¿½åŠ å¤„ç†ã€åŠ å¯†/è§£å¯†</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">package</span> com.mengnankk.designpattern;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.servlet.*;</span><br><span class="line"><span class="keyword">import</span> javax.servlet.annotation.WebFilter;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="meta">@WebFilter(&quot;/*&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RequestLogFilter</span> <span class="keyword">implements</span> <span class="title class_">Filter</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">(FilterConfig filterConfig)</span> &#123;</span><br><span class="line">        <span class="comment">// åˆå§‹åŒ–é€»è¾‘ï¼ˆå¯é€‰ï¼‰</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doFilter</span><span class="params">(ServletRequest req, ServletResponse res, FilterChain chain)</span> <span class="keyword">throws</span> IOException, ServletException &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;è®°å½•è¯·æ±‚æ—¥å¿—&quot;</span>);</span><br><span class="line">        chain.doFilter(req, res);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">destroy</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// èµ„æºé‡Šæ”¾é€»è¾‘ï¼ˆå¯é€‰ï¼‰</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ç±»ä¼¼ä»£ç†ï¼Œä½†æ›´åå‘â€œåµŒå¥—å¢å¼ºâ€</p><p>å…¸å‹ç”¨æ³•æ˜¯ <strong>Filterã€Interceptor</strong>ï¼Œå½¢æˆå¤„ç†é“¾</p><p>å¯ä»¥ç»„åˆå¤šä¸ªä¿®é¥°å™¨é“¾å¼å¢å¼º</p><h2 id="é€‚é…å™¨æ¨¡å¼"><a href="#é€‚é…å™¨æ¨¡å¼" class="headerlink" title="é€‚é…å™¨æ¨¡å¼"></a>é€‚é…å™¨æ¨¡å¼</h2><p><strong>é…å™¨æ¨¡å¼</strong>åƒæ˜¯â€œæ’å¤´è½¬æ¢å™¨â€ï¼Œè®©ä¸¤ä¸ªåŸæœ¬ä¸å…¼å®¹çš„æ¥å£è¿æ¥ä¸Šã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> <span class="title class_">MediaPlayer</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">play</span><span class="params">(String type, String fileName)</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">OldPlayer</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">playAudio</span><span class="params">(String fileName)</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;æ’­æ”¾éŸ³é¢‘ï¼š&quot;</span> + fileName);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">AudioAdapter</span> <span class="keyword">implements</span> <span class="title class_">MediaPlayer</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">OldPlayer</span> <span class="variable">oldPlayer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">OldPlayer</span>();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">play</span><span class="params">(String type, String fileName)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="string">&quot;mp3&quot;</span>.equalsIgnoreCase(type)) &#123;</span><br><span class="line">            oldPlayer.playAudio(fileName);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><div class="table-container"><table><thead><tr><th>ç»´åº¦</th><th>ä»£ç†æ¨¡å¼</th><th>é€‚é…å™¨æ¨¡å¼</th></tr></thead><tbody><tr><td><strong>ç›®çš„</strong></td><td>æ§åˆ¶è®¿é—®ç›®æ ‡å¯¹è±¡ï¼Œæ·»åŠ é™„åŠ é€»è¾‘</td><td>æ¥å£ä¸å…¼å®¹æ—¶è¿›è¡Œé€‚é…</td></tr><tr><td><strong>åŸå§‹ç±»</strong></td><td>ä¸ä»£ç†ç±»å®ç°åŒä¸€æ¥å£</td><td>ä¸ç›®æ ‡æ¥å£<strong>æ— å…³</strong>ï¼Œé€šè¿‡åŒ…è£…â€œé€‚é…â€</td></tr><tr><td><strong>ä½¿ç”¨æ—¶æœº</strong></td><td>ä¸æƒ³æˆ–ä¸èƒ½ç›´æ¥è®¿é—®ç›®æ ‡å¯¹è±¡ï¼Œå¢åŠ åŠŸèƒ½ï¼ˆå¦‚è¿œç¨‹è°ƒç”¨ã€æƒé™ï¼‰</td><td>å¤ç”¨å·²æœ‰ç±»ä½†å…¶æ¥å£ä¸ç¬¦åˆå½“å‰ç³»ç»Ÿè¦æ±‚</td></tr><tr><td><strong>æ˜¯å¦å¢å¼º</strong></td><td>æ˜¯ï¼Œå¯ä»¥æ·»åŠ å‰ç½®/åç½®é€»è¾‘</td><td>å¦ï¼Œä»…åšæ¥å£é€‚é…</td></tr></tbody></table></div><h1 id="javaæ‰©å±•"><a href="#javaæ‰©å±•" class="headerlink" title="javaæ‰©å±•"></a>javaæ‰©å±•</h1><h2 id="1-åŒæ­¥å’Œå¼‚æ­¥çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#1-åŒæ­¥å’Œå¼‚æ­¥çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="1.åŒæ­¥å’Œå¼‚æ­¥çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ"></a>1.åŒæ­¥å’Œå¼‚æ­¥çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ</h2><p><strong>åŒæ­¥ï¼ˆSynchronousï¼‰å’Œå¼‚æ­¥ï¼ˆAsynchronousï¼‰</strong> æ˜¯ä¸¤ç§ä¸åŒçš„ä»»åŠ¡æ‰§è¡Œæ–¹å¼ï¼Œä¸»è¦åŒºåˆ«åœ¨äºä»»åŠ¡çš„æ‰§è¡Œæ˜¯å¦éœ€è¦ç­‰å¾…å…¶ä»–ä»»åŠ¡å®Œæˆã€‚</p><p>åŒæ­¥çš„è¯æ˜¯éœ€è¦ç­‰å¾…ä»»åŠ¡å®Œæˆä¹‹åï¼Œæ”¶åˆ°è¿”å›çš„ç¡®è®¤è¯·æ±‚çš„æ—¶å€™å†è¿›è¡Œå…¶ä»–çš„</p><p>å¼‚æ­¥çš„è¯ï¼Œå°±æ˜¯ä¸éœ€è¦ç­‰å¾…ï¼Œç›´æ¥è¿›è¡Œä¸‹ä¸€æ­¥ä»»åŠ¡</p>]]></content:encoded>
      
      
      <category domain="https://blog.tokenlen.top/categories/%E6%8A%80%E6%9C%AF%E6%A0%88/">æŠ€æœ¯æ ˆ</category>
      
      
      <category domain="https://blog.tokenlen.top/tags/java/">java</category>
      
      <category domain="https://blog.tokenlen.top/tags/%E9%9D%A2%E8%AF%95/">é¢è¯•</category>
      
      
      <comments>https://blog.tokenlen.top/2025/05/27/java-stack/javasample1/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>LeetcodeåŠ¨æ€è§„åˆ’</title>
      <link>https://blog.tokenlen.top/2025/05/27/leetcode/leetcode4/</link>
      <guid>https://blog.tokenlen.top/2025/05/27/leetcode/leetcode4/</guid>
      <pubDate>Mon, 26 May 2025 16:00:00 GMT</pubDate>
      
        
        
          
          
      <description>&lt;h1 id=&quot;çˆ¬æ¥¼æ¢¯&quot;&gt;&lt;a href=&quot;#çˆ¬æ¥¼æ¢¯&quot; class=&quot;headerlink&quot; title=&quot;çˆ¬æ¥¼æ¢¯&quot;&gt;&lt;/a&gt;çˆ¬æ¥¼æ¢¯&lt;/h1&gt;&lt;h2 id=&quot;70-çˆ¬æ¥¼æ¢¯&quot;&gt;&lt;a href=&quot;#70-çˆ¬æ¥¼æ¢¯&quot; class=&quot;headerlink&quot; title=&quot;70.</description>
          
        
      
      
      
      <content:encoded><![CDATA[<h1 id="çˆ¬æ¥¼æ¢¯"><a href="#çˆ¬æ¥¼æ¢¯" class="headerlink" title="çˆ¬æ¥¼æ¢¯"></a>çˆ¬æ¥¼æ¢¯</h1><h2 id="70-çˆ¬æ¥¼æ¢¯"><a href="#70-çˆ¬æ¥¼æ¢¯" class="headerlink" title="70. çˆ¬æ¥¼æ¢¯"></a><a href="https://leetcode.cn/problems/climbing-stairs/">70. çˆ¬æ¥¼æ¢¯</a></h2><p>å‡è®¾ä½ æ­£åœ¨çˆ¬æ¥¼æ¢¯ã€‚éœ€è¦ <code>n</code> é˜¶ä½ æ‰èƒ½åˆ°è¾¾æ¥¼é¡¶ã€‚</p><p>æ¯æ¬¡ä½ å¯ä»¥çˆ¬ <code>1</code> æˆ– <code>2</code> ä¸ªå°é˜¶ã€‚ä½ æœ‰å¤šå°‘ç§ä¸åŒçš„æ–¹æ³•å¯ä»¥çˆ¬åˆ°æ¥¼é¡¶å‘¢ï¼Ÿ</p><p>æŒ‰ç€æ•°å­¦æ¥çœ‹çš„è¯ï¼Œå°±æ˜¯å¦‚æœæ˜¯1é˜¶æ¢¯çš„è¯ï¼Œå°±æ˜¯1</p><p>å¤§äºç­‰äº2çš„æœ‰ä¸¤ç§ï¼Œæ˜¯i-1+(i-2)</p><p>ç„¶åæˆ‘ä»¬ä½¿ç”¨è®°å¿†æ•°ç»„æ¥è®°å¿†ä¹‹å‰ç®—è¿‡çš„</p><p>ç„¶åä½¿ç”¨é€’å½’</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution70A</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">climbStairs</span><span class="params">(<span class="type">int</span> n )</span>&#123;</span><br><span class="line">        <span class="type">int</span>[] memo  = <span class="keyword">new</span> <span class="title class_">int</span>[n+<span class="number">1</span>];</span><br><span class="line">        <span class="keyword">return</span> dfs(n,memo);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="title function_">dfs</span><span class="params">(<span class="type">int</span> i,<span class="type">int</span>[] memo)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>  (i&lt;=<span class="number">1</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>  (memo[i]!=<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> memo[i];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> memo[i] = dfs(i-<span class="number">1</span>,memo)+dfs(i-<span class="number">2</span>,memo);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é‡åˆ°è®°å¿†æ•°ç»„ä¸æ˜¯1çš„ï¼Œè°ƒç”¨è®°å¿†æ•°ç»„ï¼Œä¸º0çš„å°±ç›´æ¥è®¡ç®—</p><p>è¿™æ ·å°±ä¸ä¼šè¶…æ—¶</p><h2 id="746-ä½¿ç”¨æœ€å°èŠ±è´¹çˆ¬æ¥¼æ¢¯"><a href="#746-ä½¿ç”¨æœ€å°èŠ±è´¹çˆ¬æ¥¼æ¢¯" class="headerlink" title="746. ä½¿ç”¨æœ€å°èŠ±è´¹çˆ¬æ¥¼æ¢¯"></a><a href="https://leetcode.cn/problems/min-cost-climbing-stairs/">746. ä½¿ç”¨æœ€å°èŠ±è´¹çˆ¬æ¥¼æ¢¯</a></h2><p>ç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„ <code>cost</code> ï¼Œå…¶ä¸­ <code>cost[i]</code> æ˜¯ä»æ¥¼æ¢¯ç¬¬ <code>i</code> ä¸ªå°é˜¶å‘ä¸Šçˆ¬éœ€è¦æ”¯ä»˜çš„è´¹ç”¨ã€‚ä¸€æ—¦ä½ æ”¯ä»˜æ­¤è´¹ç”¨ï¼Œå³å¯é€‰æ‹©å‘ä¸Šçˆ¬ä¸€ä¸ªæˆ–è€…ä¸¤ä¸ªå°é˜¶ã€‚</p><p>ä½ å¯ä»¥é€‰æ‹©ä»ä¸‹æ ‡ä¸º <code>0</code> æˆ–ä¸‹æ ‡ä¸º <code>1</code> çš„å°é˜¶å¼€å§‹çˆ¬æ¥¼æ¢¯ã€‚</p><p>è¯·ä½ è®¡ç®—å¹¶è¿”å›è¾¾åˆ°æ¥¼æ¢¯é¡¶éƒ¨çš„æœ€ä½èŠ±è´¹ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution746</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">minCostClimbingStairs</span><span class="params">(<span class="type">int</span>[] cost)</span>&#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> cost.length;</span><br><span class="line">        <span class="type">int</span> [] memo = <span class="keyword">new</span> <span class="title class_">int</span> [n+<span class="number">1</span>];</span><br><span class="line">        Arrays.fill(memo,-<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">return</span> dfs(n,memo,cost);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="title function_">dfs</span><span class="params">(<span class="type">int</span> i ,<span class="type">int</span>[] memo,<span class="type">int</span>[] cost)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (i&lt;=<span class="number">1</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (memo[i]!=-<span class="number">1</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> memo[i];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> <span class="variable">res1</span> <span class="operator">=</span> dfs(i-<span class="number">1</span>,memo,cost)+cost[i-<span class="number">1</span>];</span><br><span class="line">        <span class="type">int</span> <span class="variable">res2</span> <span class="operator">=</span> dfs(i-<span class="number">2</span>,memo,cost)+cost[i-<span class="number">2</span>];</span><br><span class="line">        <span class="keyword">return</span> memo[i] = Math.min(res2,res1);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è·Ÿä¸Šé¢é‚£ä¸ªé¢˜ä¸€æ ·ï¼Œåªä¸è¿‡æœ€åå–çš„æ—¶å€™ï¼Œæ˜¯çœ‹èŠ±è´¹å“ªä¸ªå°‘äº†</p><h2 id="377-ç»„åˆæ€»å’Œ-â…£"><a href="#377-ç»„åˆæ€»å’Œ-â…£" class="headerlink" title="377. ç»„åˆæ€»å’Œ â…£"></a><a href="https://leetcode.cn/problems/combination-sum-iv/">377. ç»„åˆæ€»å’Œ â…£</a></h2><p>ç»™ä½ ä¸€ä¸ªç”± <strong>ä¸åŒ</strong> æ•´æ•°ç»„æˆçš„æ•°ç»„ <code>nums</code> ï¼Œå’Œä¸€ä¸ªç›®æ ‡æ•´æ•° <code>target</code> ã€‚è¯·ä½ ä» <code>nums</code> ä¸­æ‰¾å‡ºå¹¶è¿”å›æ€»å’Œä¸º <code>target</code> çš„å…ƒç´ ç»„åˆçš„ä¸ªæ•°ã€‚</p><p>é¢˜ç›®æ•°æ®ä¿è¯ç­”æ¡ˆç¬¦åˆ 32 ä½æ•´æ•°èŒƒå›´ã€‚</p><p>æœ¬è´¨è¿˜æ˜¯çˆ¬æ¥¼æ¢¯é—®é¢˜å•Š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution377</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">combinationSum4</span><span class="params">(<span class="type">int</span>[] nums, <span class="type">int</span> target)</span>&#123;</span><br><span class="line">        <span class="type">int</span>[] memo = <span class="keyword">new</span> <span class="title class_">int</span>[target+<span class="number">1</span>];</span><br><span class="line">        Arrays.fill(memo,-<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">return</span> dfs(target,nums,memo);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="title function_">dfs</span><span class="params">(<span class="type">int</span> i,<span class="type">int</span>[] nums,<span class="type">int</span>[] memo)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (i==<span class="number">0</span>) <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">if</span> (memo[i]!=-<span class="number">1</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> memo[i];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> <span class="variable">res</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> x:nums)&#123;</span><br><span class="line">            <span class="keyword">if</span> (x&lt;=i)&#123;</span><br><span class="line">                res +=dfs(i-x,nums,memo);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> memo[i]  = res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¹Ÿæ˜¯ç±»ä¼¼çš„</p><h2 id="2466-ç»Ÿè®¡æ„é€ å¥½å­—ç¬¦ä¸²çš„æ–¹æ¡ˆæ•°"><a href="#2466-ç»Ÿè®¡æ„é€ å¥½å­—ç¬¦ä¸²çš„æ–¹æ¡ˆæ•°" class="headerlink" title="2466. ç»Ÿè®¡æ„é€ å¥½å­—ç¬¦ä¸²çš„æ–¹æ¡ˆæ•°"></a><a href="https://leetcode.cn/problems/count-ways-to-build-good-strings/">2466. ç»Ÿè®¡æ„é€ å¥½å­—ç¬¦ä¸²çš„æ–¹æ¡ˆæ•°</a></h2><p>ç»™ä½ æ•´æ•° <code>zero</code> ï¼Œ<code>one</code> ï¼Œ<code>low</code> å’Œ <code>high</code> ï¼Œæˆ‘ä»¬ä»ç©ºå­—ç¬¦ä¸²å¼€å§‹æ„é€ ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œæ¯ä¸€æ­¥æ‰§è¡Œä¸‹é¢æ“ä½œä¸­çš„ä¸€ç§ï¼š</p><ul><li>å°† <code>&#39;0&#39;</code> åœ¨å­—ç¬¦ä¸²æœ«å°¾æ·»åŠ  <code>zero</code> æ¬¡ã€‚</li><li>å°† <code>&#39;1&#39;</code> åœ¨å­—ç¬¦ä¸²æœ«å°¾æ·»åŠ  <code>one</code> æ¬¡ã€‚</li></ul><p>ä»¥ä¸Šæ“ä½œå¯ä»¥æ‰§è¡Œä»»æ„æ¬¡ã€‚</p><p>å¦‚æœé€šè¿‡ä»¥ä¸Šè¿‡ç¨‹å¾—åˆ°ä¸€ä¸ª <strong>é•¿åº¦</strong> åœ¨ <code>low</code> å’Œ <code>high</code> ä¹‹é—´ï¼ˆåŒ…å«ä¸Šä¸‹è¾¹ç•Œï¼‰çš„å­—ç¬¦ä¸²ï¼Œé‚£ä¹ˆè¿™ä¸ªå­—ç¬¦ä¸²æˆ‘ä»¬ç§°ä¸º <strong>å¥½</strong> å­—ç¬¦ä¸²ã€‚</p><p>è¯·ä½ è¿”å›æ»¡è¶³ä»¥ä¸Šè¦æ±‚çš„ <strong>ä¸åŒ</strong> å¥½å­—ç¬¦ä¸²æ•°ç›®ã€‚ç”±äºç­”æ¡ˆå¯èƒ½å¾ˆå¤§ï¼Œè¯·å°†ç»“æœå¯¹ <code>109 + 7</code> <strong>å–ä½™</strong> åè¿”å›ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution2466</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">countGoodStrings</span><span class="params">(<span class="type">int</span> low, <span class="type">int</span> high, <span class="type">int</span> zero, <span class="type">int</span> one)</span>&#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">ans</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">final</span> <span class="type">int</span> <span class="variable">MOD</span> <span class="operator">=</span> <span class="number">1_000_000_007</span>;</span><br><span class="line">        <span class="type">int</span> [] f = <span class="keyword">new</span> <span class="title class_">int</span>[high+<span class="number">1</span>];</span><br><span class="line">        f[<span class="number">0</span>]= <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;=high;i++)&#123;</span><br><span class="line">            <span class="keyword">if</span> (i&gt;=zero) f[i] = f[i-zero];</span><br><span class="line">            <span class="keyword">if</span> (i&gt;=one) f[i] = (f[i]+f[i-one])%MOD;</span><br><span class="line">            <span class="keyword">if</span> (i&gt;=low) ans = (ans+f[i])%MOD;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨é€’æ¨</p><p>ç›¸å½“äºæŠŠé€’æ¨å¼ <em>f</em>[<em>i</em>]=<em>f</em>[<em>i</em>âˆ’<em>zero</em>]+<em>f</em>[<em>i</em>âˆ’<em>one</em>] æ‹†åˆ†æˆäº†ä¸¤æ­¥</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">MOD</span> <span class="operator">=</span> <span class="number">1_000_000_007</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">countGoodStrings</span><span class="params">(<span class="type">int</span> low, <span class="type">int</span> high, <span class="type">int</span> zero, <span class="type">int</span> one)</span> &#123;</span><br><span class="line">        <span class="type">int</span>[] memo = <span class="keyword">new</span> <span class="title class_">int</span>[high + <span class="number">1</span>];</span><br><span class="line">        Arrays.fill(memo, -<span class="number">1</span>); <span class="comment">// -1 è¡¨ç¤ºæ²¡æœ‰è®¡ç®—è¿‡</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">ans</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> low; i &lt;= high; i++) &#123;</span><br><span class="line">            ans = (ans + dfs(i, zero, one, memo)) % MOD;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="title function_">dfs</span><span class="params">(<span class="type">int</span> i, <span class="type">int</span> zero, <span class="type">int</span> one, <span class="type">int</span>[] memo)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (i &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (i == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (memo[i] != -<span class="number">1</span>) &#123; <span class="comment">// ä¹‹å‰è®¡ç®—è¿‡</span></span><br><span class="line">            <span class="keyword">return</span> memo[i];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> memo[i] = (dfs(i - zero, zero, one, memo) + dfs(i - one, zero, one, memo)) % MOD;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è®°å¿†é€’æ¨æ–¹æ³•</p>]]></content:encoded>
      
      
      <category domain="https://blog.tokenlen.top/categories/java/">java</category>
      
      
      <category domain="https://blog.tokenlen.top/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/">æ•°æ®ç»“æ„</category>
      
      <category domain="https://blog.tokenlen.top/tags/%E7%AE%97%E6%B3%95/">ç®—æ³•</category>
      
      <category domain="https://blog.tokenlen.top/tags/java/">java</category>
      
      <category domain="https://blog.tokenlen.top/tags/leetcode/">leetcode</category>
      
      
      <comments>https://blog.tokenlen.top/2025/05/27/leetcode/leetcode4/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>crmebå•†åŸåˆ†æ</title>
      <link>https://blog.tokenlen.top/2025/05/27/workmenu/crmeb/</link>
      <guid>https://blog.tokenlen.top/2025/05/27/workmenu/crmeb/</guid>
      <pubDate>Mon, 26 May 2025 16:00:00 GMT</pubDate>
      
        
        
          
          
      <description>&lt;p&gt;ä»æ•´ä½“åˆ†æè¿™ä¸ªé¡¹ç›®&lt;/p&gt;
&lt;p&gt;ç„¶ååŠ å…¥ä¸€äº›åˆ«çš„é¡¹ç›®çš„é€šç”¨çš„çŸ¥è¯†&lt;/p&gt;
&lt;p&gt;å…¶ä»–é¡¹ç›®åŠ å…¥çš„ï¼šï¼šï¼š&lt;/p&gt;
&lt;h1 id=&quot;äº®ç‚¹&quot;&gt;&lt;a href=&quot;#äº®ç‚¹&quot; class=&quot;headerlink&quot; title=&quot;äº®ç‚¹&quot;&gt;&lt;/a&gt;äº®ç‚¹&lt;/h1&gt;&lt;h2</description>
          
        
      
      
      
      <content:encoded><![CDATA[<p>ä»æ•´ä½“åˆ†æè¿™ä¸ªé¡¹ç›®</p><p>ç„¶ååŠ å…¥ä¸€äº›åˆ«çš„é¡¹ç›®çš„é€šç”¨çš„çŸ¥è¯†</p><p>å…¶ä»–é¡¹ç›®åŠ å…¥çš„ï¼šï¼šï¼š</p><h1 id="äº®ç‚¹"><a href="#äº®ç‚¹" class="headerlink" title="äº®ç‚¹"></a>äº®ç‚¹</h1><h2 id="èº«ä»½è®¤è¯ä¸æƒé™æ ¡éªŒ"><a href="#èº«ä»½è®¤è¯ä¸æƒé™æ ¡éªŒ" class="headerlink" title="èº«ä»½è®¤è¯ä¸æƒé™æ ¡éªŒ"></a>èº«ä»½è®¤è¯ä¸æƒé™æ ¡éªŒ</h2><p>ä½¿ç”¨ä»¤ç‰ŒæŠ€æœ¯å®ç°èº«ä»½éªŒè¯ï¼Œç”¨è‡ªå®šæ æˆªå™¨å®Œæˆç”¨æˆ·è®¤è¯ï¼Œå¹¶ç»“åˆ ThreadLocalè¿›è¡Œæˆªå™¨æ ¡éªŒï¼Œä¿éšœç³»ç»Ÿå®‰å…¨è®¿é—´ã€‚</p><p><strong>åŸºäºSpring Boot + JWTçš„å®Œæ•´èº«ä»½è®¤è¯ç¤ºä¾‹</strong>ï¼ŒåŒ…å«ï¼š</p><ul><li>JWTç”Ÿæˆå’Œè§£æå·¥å…·ç±»</li><li>è®¤è¯æ‹¦æˆªå™¨ï¼ˆæ‹¦æˆªè¯·æ±‚éªŒè¯JWTï¼‰</li><li>ThreadLocalå­˜å‚¨å½“å‰ç”¨æˆ·ä¿¡æ¯</li><li>é…ç½®æ‹¦æˆªå™¨æ³¨å†Œ</li><li>ç®€å•çš„ç”¨æˆ·æ§åˆ¶å™¨ç¤ºä¾‹</li></ul><h3 id="æµç¨‹"><a href="#æµç¨‹" class="headerlink" title="æµç¨‹"></a>æµç¨‹</h3><p>æ³¨å†Œï¼šæäº¤ç”¨æˆ·å/å¯†ç ï¼Œåå°ä¿å­˜ï¼ˆé€šå¸¸å¯†ç è¦å“ˆå¸Œå­˜å‚¨ï¼‰ï¼Œè¿”å›æ³¨å†ŒæˆåŠŸä¿¡æ¯ã€‚</p><p>ç™»å½•ï¼šæäº¤ç”¨æˆ·å/å¯†ç ï¼Œæ ¡éªŒé€šè¿‡åç”Ÿæˆ JWT Tokenï¼Œè¿”å›ç»™å®¢æˆ·ç«¯ã€‚ã€</p><p>è®¿é—®ï¼šå®¢æˆ·ç«¯åœ¨è¯·æ±‚å¤´ <code>Authorization: Bearer &lt;token&gt;</code> ä¸­æºå¸¦ JWT</p><p>è‡ªå®šä¹‰æ‹¦æˆªå™¨æ‹¦æˆªè¯·æ±‚ï¼ŒéªŒè¯ JWTï¼Œæœ‰æ•ˆåˆ™å°†è§£æåçš„ç”¨æˆ·ä¿¡æ¯å­˜å…¥ <code>ThreadLocal</code></p><p>Controller ä¸šåŠ¡æ–¹æ³•ä¸­å¯ç›´æ¥ä» <code>ThreadLocal</code> å–å‡ºå½“å‰ç”¨æˆ·ä¿¡æ¯</p><p>ç™»å‡º/è¿‡æœŸï¼šJWT è‡ªå¸¦è¿‡æœŸæ—¶é—´ï¼Œæ— éœ€æœåŠ¡å™¨çŠ¶æ€ç»´æŠ¤ï¼›æˆ–é…åˆé»‘åå•å®ç°ä¸»åŠ¨å¤±æ•ˆã€‚</p><h3 id="é—®é¢˜è§£æ"><a href="#é—®é¢˜è§£æ" class="headerlink" title="é—®é¢˜è§£æ"></a>é—®é¢˜è§£æ</h3><h4 id="1-JWTçš„ç»„æˆ"><a href="#1-JWTçš„ç»„æˆ" class="headerlink" title="1.JWTçš„ç»„æˆ"></a>1.JWTçš„ç»„æˆ</h4><p>Headerï¼ˆå¤´éƒ¨ï¼‰:æè¿°ç­¾åçš„å…ƒæ•°æ®ï¼ŒåŒ…å«alg(ç­¾åç®—æ³•) HS256ï¼ŒRS256,typ(ä»¤ç‰Œçš„ç±»å‹)é€šå¸¸ä¸ºJWTï¼Œbase64URLç¼–ç ä½œä¸ºä¸€ä¸ªç‰‡æ®µ</p><p>Payloadï¼šå­˜æ”¾ä¸šåŠ¡æ•°æ®å’Œæ ‡å‡†å£°æ˜ï¼ˆClaimsï¼‰ï¼Œ</p><p><strong>RFCå®šä¹‰</strong>ï¼š<code>iss</code>ï¼ˆç­¾å‘è€…ï¼‰ã€<code>sub</code>ï¼ˆä¸»é¢˜ï¼‰ã€<code>aud</code>ï¼ˆå—ä¼—ï¼‰ã€<code>exp</code>ï¼ˆè¿‡æœŸæ—¶é—´ï¼‰ã€<code>iat</code>ï¼ˆç­¾å‘æ—¶é—´ï¼‰</p><p><strong>Public Claims</strong>ï¼šç”¨æˆ·è‡ªå®šä¹‰ï¼Œä½†è¦é¿å…å†²çª</p><p><strong>Private Claims</strong>ï¼šåŒæ–¹çº¦å®šçš„è‡ªå®šä¹‰å­—æ®µï¼ˆå¦‚ <code>userId</code>ã€<code>roles</code>ï¼‰</p><p>Signatureï¼ˆç­¾åï¼‰ï¼š</p><p>ç”¨ <code>Base64Url(Header) + &quot;.&quot; + Base64Url(Payload)</code>ï¼Œå†åŠ ä¸Šå¯†é’¥ï¼Œé€šè¿‡æŒ‡å®šç®—æ³•ï¼ˆå¦‚ HMAC SHA256ï¼‰è®¡ç®—å¾—åˆ°ã€‚</p><p>é˜²æ­¢æ•°æ®è¢«ç¯¡æ”¹ï¼šæ¥æ”¶æ–¹ç”¨<strong>ç›¸åŒç®—æ³•å’Œå¯†é’¥æ ¡éªŒç­¾å</strong>ã€‚</p><h4 id="2-ä¸ºä»€ä¹ˆè¦è®¾ç½®-expï¼Œä»¥åŠå¦‚ä½•å¤„ç†è¿‡æœŸï¼Ÿ"><a href="#2-ä¸ºä»€ä¹ˆè¦è®¾ç½®-expï¼Œä»¥åŠå¦‚ä½•å¤„ç†è¿‡æœŸï¼Ÿ" class="headerlink" title="2.ä¸ºä»€ä¹ˆè¦è®¾ç½® expï¼Œä»¥åŠå¦‚ä½•å¤„ç†è¿‡æœŸï¼Ÿ"></a>2.ä¸ºä»€ä¹ˆè¦è®¾ç½® <code>exp</code>ï¼Œä»¥åŠå¦‚ä½•å¤„ç†è¿‡æœŸï¼Ÿ</h4><p>é™åˆ¶ä»¤ç‰Œçš„æœ‰æ•ˆæœŸï¼Œé™ä½æ³„éœ²åæ»¥ç”¨é£é™©ï¼Œå¼ºåˆ¶å®¢æˆ·ç«¯<strong>å®šæœŸè·å–æ–°ä»¤ç‰Œ</strong>ï¼Œæœ‰åŠ©äºæƒé™å˜æ›´åŠæ—¶ç”Ÿæ•ˆã€‚</p><p>è‡ªåŠ¨å¤„ç†è¿‡æœŸï¼š</p><p><strong>è‡ªåŠ¨æ‹’ç»</strong>ï¼šåœ¨è§£æ JWT æ—¶ï¼Œåº“ï¼ˆå¦‚ jjwtï¼‰ä¼šæŠ›å‡º <code>ExpiredJwtException</code>ï¼Œæ‹¦æˆªå™¨ï¼è¿‡æ»¤å™¨æ•è·åè¿”å› <code>401 Unauthorized</code>ã€‚</p><p><strong>Refresh Token</strong> æœºåˆ¶ï¼š</p><p>Access Tokenï¼ˆçŸ­æ—¶æœ‰æ•ˆï¼‰+ Refresh Tokenï¼ˆé•¿æœŸæœ‰æ•ˆä¸”å­˜æ”¾æ›´å®‰å…¨ï¼‰</p><p>Access Token è¿‡æœŸåï¼Œå®¢æˆ·ç«¯ç”¨ Refresh Token å‘ä¸“é—¨æ¥å£æ¢å–æ–°çš„ Access Tokenã€‚</p><p><strong>æœåŠ¡ç«¯é»‘åå•</strong>ï¼šå¯¹å…³é”®åœºæ™¯ï¼Œå¯åœ¨ Redis ç­‰å­˜å‚¨è¿‡æœŸæˆ–æ‰‹åŠ¨åºŸå¼ƒçš„ Token ID åˆ—è¡¨ï¼Œæ‹¦æˆªæ—¶è¿›ä¸€æ­¥æ¯”å¯¹ã€‚</p><h3 id="3-å¯¹ç§°åŠ å¯†ï¼ˆHS256ï¼‰ä¸éå¯¹ç§°åŠ å¯†ï¼ˆRS256ï¼‰çš„åŒºåˆ«ï¼Ÿ"><a href="#3-å¯¹ç§°åŠ å¯†ï¼ˆHS256ï¼‰ä¸éå¯¹ç§°åŠ å¯†ï¼ˆRS256ï¼‰çš„åŒºåˆ«ï¼Ÿ" class="headerlink" title="3.å¯¹ç§°åŠ å¯†ï¼ˆHS256ï¼‰ä¸éå¯¹ç§°åŠ å¯†ï¼ˆRS256ï¼‰çš„åŒºåˆ«ï¼Ÿ"></a>3.å¯¹ç§°åŠ å¯†ï¼ˆHS256ï¼‰ä¸éå¯¹ç§°åŠ å¯†ï¼ˆRS256ï¼‰çš„åŒºåˆ«ï¼Ÿ</h3><div class="table-container"><table><thead><tr><th>ç‰¹æ€§</th><th>HS256ï¼ˆå¯¹ç§°ï¼‰</th><th>RS256ï¼ˆéå¯¹ç§°ï¼‰</th></tr></thead><tbody><tr><td><strong>å¯†é’¥</strong></td><td>åŒä¸€ä¸ªå¯†é’¥ç”¨äºç­¾åå’Œæ ¡éªŒ</td><td>ä½¿ç”¨ç§é’¥ç­¾åï¼Œå…¬é’¥æ ¡éªŒ</td></tr><tr><td><strong>å®‰å…¨æ€§</strong></td><td>åªè¦å…±äº«å¯†é’¥ä¸ä¼šæ³„éœ²ï¼›å¤šæœåŠ¡æ—¶éœ€å®‰å…¨åˆ†å‘å¯†é’¥</td><td>ç§é’¥åªåœ¨ç­¾å‘ç«¯ä¿å­˜ï¼Œå…¬é’¥å¯å…¬å¼€ï¼Œæ³„éœ²é£é™©ä½</td></tr><tr><td><strong>æ€§èƒ½</strong></td><td>HMAC é€Ÿåº¦å¿«</td><td>RSA è¿ç®—ç›¸å¯¹æ…¢ä¸€äº›</td></tr><tr><td><strong>åº”ç”¨åœºæ™¯</strong></td><td>å°è§„æ¨¡æˆ–å•ä½“åº”ç”¨ï¼Œéƒ¨ç½²ç®€å•</td><td>åˆ†å¸ƒå¼/å¾®æœåŠ¡æˆ–ç¬¬ä¸‰æ–¹éªŒè¯åœºæ™¯ï¼Œç§é’¥ä¿æŠ¤æ›´å¥½</td></tr></tbody></table></div><h3 id="4-HandlerInterceptor-ä¸-Filter-çš„åŒºåˆ«ï¼Ÿ"><a href="#4-HandlerInterceptor-ä¸-Filter-çš„åŒºåˆ«ï¼Ÿ" class="headerlink" title="4.HandlerInterceptor ä¸ Filter çš„åŒºåˆ«ï¼Ÿ"></a>4.<code>HandlerInterceptor</code> ä¸ <code>Filter</code> çš„åŒºåˆ«ï¼Ÿ</h3><div class="table-container"><table><thead><tr><th>æ–¹é¢</th><th>Filter</th><th>HandlerInterceptor</th></tr></thead><tbody><tr><td><strong>åŠ è½½æ—¶æœº</strong></td><td>æœ€æ—©ï¼ŒServlet å®¹å™¨å¯åŠ¨æ—¶é…ç½®ï¼Œä½äº Spring MVC ä¹‹å‰</td><td>åœ¨ Spring MVC å†…éƒ¨ï¼ŒController è°ƒç”¨å‰åæ‹¦æˆª</td></tr><tr><td><strong>æ¥å£</strong></td><td><code>javax.servlet.Filter</code></td><td><code>org.springframework.web.servlet.HandlerInterceptor</code></td></tr><tr><td><strong>èŒè´£</strong></td><td>é€šç”¨è¯·æ±‚é¢„å¤„ç†ï¼šå¦‚æ—¥å¿—ã€è·¨åŸŸã€è¯·æ±‚åŒ…è£…ã€å­—ç¬¦ç¼–ç </td><td>æ›´è´´è¿‘ MVCï¼šå¯ä»¥è®¿é—® Handlerï¼ˆControllerï¼‰ä¿¡æ¯ï¼Œåšæ–¹æ³•çº§é‰´æƒ</td></tr><tr><td><strong>é…ç½®æ–¹å¼</strong></td><td><code>@WebFilter</code>ã€<code>FilterRegistrationBean</code> ç­‰</td><td>å®ç° <code>WebMvcConfigurer#addInterceptors</code> æ³¨å†Œ</td></tr><tr><td><strong>æ–¹æ³•</strong></td><td><code>doFilter</code></td><td><code>preHandle</code>ã€<code>postHandle</code>ã€<code>afterCompletion</code></td></tr></tbody></table></div><h3 id="5-å¦‚ä½•é…ç½®æŸäº›è·¯å¾„æ”¾è¡Œï¼Ÿ"><a href="#5-å¦‚ä½•é…ç½®æŸäº›è·¯å¾„æ”¾è¡Œï¼Ÿ" class="headerlink" title="5.å¦‚ä½•é…ç½®æŸäº›è·¯å¾„æ”¾è¡Œï¼Ÿ"></a>5.å¦‚ä½•é…ç½®æŸäº›è·¯å¾„æ”¾è¡Œï¼Ÿ</h3><p>æ¯”å¦‚æˆ‘ä»¬è®©ä»–ä¸ç”¨ç™»å½•å°±èƒ½çœ‹çš„ä¸€äº›é¡µé¢ï¼Œå•†å“å±•ç¤ºç­‰ç­‰</p><p>åœ¨ Spring MVC æ‹¦æˆªå™¨æ³¨å†Œæ—¶ï¼Œé€šè¿‡ <code>excludePathPatterns(...)</code>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">registry.addInterceptor(jwtInterceptor)</span><br><span class="line">        .addPathPatterns(<span class="string">&quot;/api/**&quot;</span>)           <span class="comment">// æ‹¦æˆªæ‰€æœ‰ /api/**</span></span><br><span class="line">        .excludePathPatterns(</span><br><span class="line">            <span class="string">&quot;/api/auth/**&quot;</span>,                  <span class="comment">// æ”¾è¡Œè®¤è¯ç›¸å…³</span></span><br><span class="line">            <span class="string">&quot;/swagger-ui/**&quot;</span>, <span class="string">&quot;/v3/api-docs&quot;</span>  <span class="comment">// æ”¾è¡Œ Swagger</span></span><br><span class="line">        );</span><br></pre></td></tr></table></figure><p>å¦‚æœæ˜¯ Filterï¼Œå¯åœ¨å†…éƒ¨åˆ¤æ–­è¯·æ±‚ URIï¼Œæˆ–åœ¨ <code>FilterRegistrationBean</code> ä¸­è®¾ç½® <code>setUrlPatterns</code> ä¸ <code>setOrder</code>ã€‚</p><h3 id="6-Spring-Boot-é»˜è®¤å“ªäº›é™æ€èµ„æºè·¯å¾„ï¼Ÿæ˜¯å¦ä¼šè¢«æ‹¦æˆªï¼Ÿ"><a href="#6-Spring-Boot-é»˜è®¤å“ªäº›é™æ€èµ„æºè·¯å¾„ï¼Ÿæ˜¯å¦ä¼šè¢«æ‹¦æˆªï¼Ÿ" class="headerlink" title="6.Spring Boot é»˜è®¤å“ªäº›é™æ€èµ„æºè·¯å¾„ï¼Ÿæ˜¯å¦ä¼šè¢«æ‹¦æˆªï¼Ÿ"></a>6.Spring Boot é»˜è®¤å“ªäº›é™æ€èµ„æºè·¯å¾„ï¼Ÿæ˜¯å¦ä¼šè¢«æ‹¦æˆªï¼Ÿ</h3><ul><li><strong>é»˜è®¤è·¯å¾„ï¼ˆclasspath ä¸‹ï¼‰</strong><ul><li><code>/static</code></li><li><code>/public</code></li><li><code>/resources</code></li><li><code>/META-INF/resources</code></li></ul></li><li><strong>æ˜¯å¦è¢«æ‹¦æˆªï¼Ÿ</strong><ul><li>Spring MVC çš„æ‹¦æˆªå™¨é»˜è®¤åªæ‹¦æˆª <code>/**</code>ï¼Œä½†é™æ€èµ„æºç”± <code>ResourceHttpRequestHandler</code> å¤„ç†ï¼Œä¼˜å…ˆçº§é«˜äºä¸€èˆ¬çš„ Controller è°ƒç”¨ã€‚</li><li><strong>å¦‚æœ</strong>åœ¨ <code>addInterceptors</code> ä¸­ä½¿ç”¨äº†æ‹¦æˆªæ‰€æœ‰ <code>/**</code>ï¼Œä¸”æ‹¦æˆªåŒ¹é…åˆ°é™æ€èµ„æºè·¯å¾„ï¼Œå°±æœ‰å¯èƒ½æ‹¦æˆªï¼›ä½†é€šå¸¸æˆ‘ä»¬ä¼šåœ¨ <code>excludePathPatterns(&quot;/**/*.js&quot;, &quot;/**/*.css&quot;, &quot;/**/*.png&quot;, ...&quot;)</code> æˆ–ç›´æ¥æ’é™¤é™æ€èµ„æºç›®å½•ï¼Œç¡®ä¿é™æ€èµ„æºæ­£å¸¸åŠ è½½ã€‚</li></ul></li></ul><h3 id="7-ä¸ºä»€ä¹ˆè¦åœ¨-afterCompletion-æ¸…ç†-ThreadLocalï¼Ÿ"><a href="#7-ä¸ºä»€ä¹ˆè¦åœ¨-afterCompletion-æ¸…ç†-ThreadLocalï¼Ÿ" class="headerlink" title="7.ä¸ºä»€ä¹ˆè¦åœ¨ afterCompletion æ¸…ç† ThreadLocalï¼Ÿ"></a>7.ä¸ºä»€ä¹ˆè¦åœ¨ <code>afterCompletion</code> æ¸…ç† <code>ThreadLocal</code>ï¼Ÿ</h3><p><code>ThreadLocal</code> å­˜å‚¨çš„æ•°æ®ä¸å½“å‰çº¿ç¨‹ç»‘å®šã€‚</p><p>åœ¨é«˜å¹¶å‘ç¯å¢ƒä¸‹ï¼Œä½¿ç”¨çº¿ç¨‹æ± å¤ç”¨çº¿ç¨‹ï¼Œå¦‚æœä¸æ‰‹åŠ¨æ¸…ç†ï¼Œåç»­è¯·æ±‚å¯èƒ½è¯»å–åˆ°ä¸Šä¸€ä¸ªç”¨æˆ·çš„ä¿¡æ¯ï¼Œå¯¼è‡´<strong>æ•°æ®æ³„éœ²</strong>æˆ–<strong>å®‰å…¨æ¼æ´</strong>ã€‚</p><p><code>afterCompletion</code> ä¿è¯åœ¨è¯·æ±‚å¤„ç†å®Œæ¯•åæ— è®ºæ­£å¸¸æˆ–å¼‚å¸¸ï¼Œéƒ½èƒ½ç§»é™¤æ•°æ®ï¼Œé˜²æ­¢å†…å­˜æ³„éœ²ã€‚</p><p>æˆ–è€…æ˜¯å¦‚æœä¸æ¸…ç†çš„è¯ï¼Œå› ä¸ºæ˜¯å¼±å¼•ç”¨ï¼ŒThreadLocalçš„keyå¾ˆå®¹æ˜“è¢«æ¸…ç†ï¼Œå…¶è¿˜æœ‰nullçš„é”®ï¼Œä¸€ç›´åœ¨é‚£é‡Œå‘†ç€ã€‚æ‰€ä»¥è¦ä½¿ç”¨removeæ¸…ç†æˆ–è€…æ˜¯ï¼ŒæŸ¥æ‰¾ä¸å½“å‰çº¿ç¨‹å…³è”çš„Mapå¹¶å°†é”®å€¼å¯¹è®¾ç½®ä¸ºå½“å‰çº¿ç¨‹å’Œnullï¼ŒHuozæ˜¯åœ¨finallyä¸­å…³é—­ThreadLocalã€‚</p><h3 id="8-å¹¶å‘åœºæ™¯ä¸‹-ThreadLocal-çš„é€‚ç”¨ä¸é™åˆ¶ï¼Ÿ"><a href="#8-å¹¶å‘åœºæ™¯ä¸‹-ThreadLocal-çš„é€‚ç”¨ä¸é™åˆ¶ï¼Ÿ" class="headerlink" title="8.å¹¶å‘åœºæ™¯ä¸‹ ThreadLocal çš„é€‚ç”¨ä¸é™åˆ¶ï¼Ÿ"></a>8.å¹¶å‘åœºæ™¯ä¸‹ <code>ThreadLocal</code> çš„é€‚ç”¨ä¸é™åˆ¶ï¼Ÿ</h3><p><strong>é€‚ç”¨</strong>ï¼š</p><ul><li>å­˜æ”¾ä¸å½“å‰è¯·æ±‚ã€å½“å‰<strong>çº¿ç¨‹å¼ºå…³è”çš„æ•°æ®</strong>ï¼ˆå¦‚ç”¨æˆ·ä¸Šä¸‹æ–‡ã€äº‹åŠ¡ IDï¼‰</li><li>é¿å…åœ¨æ–¹æ³•é—´é¢‘ç¹ä¼ å‚</li></ul><p><strong>é™åˆ¶</strong>ï¼š</p><ul><li>å¿…é¡»åœ¨è¯·æ±‚<strong>ç»“æŸåæ¸…ç†</strong>ï¼Œå¦åˆ™çº¿ç¨‹å¤ç”¨ä¼šå¯¼è‡´â€œä¸Šä¸‹æ–‡ä¸²åº“â€</li><li>ä¸èƒ½è·¨çº¿ç¨‹ï¼ˆå¦‚å¼‚æ­¥æ‰§è¡Œã€çº¿ç¨‹æ± ä»»åŠ¡ï¼‰å…±äº«ï¼›å¦‚æœåœ¨å­çº¿ç¨‹é‡Œå°è¯•å–æ•°æ®ï¼Œéœ€è¦æ˜¾å¼ä¼ é€’æˆ–ä½¿ç”¨ <code>InheritableThreadLocal</code>ï¼ˆä½†è¦æ³¨æ„ GC é£é™©ï¼‰</li><li>å¤§é‡æ•°æ®å­˜æ”¾ä¼šå¢åŠ å†…å­˜å‹åŠ›</li></ul><p>æˆ–è€…æ˜¯å¦‚æœä¸æ¸…ç†çš„è¯ï¼Œå› ä¸ºæ˜¯å¼±å¼•ç”¨ï¼ŒThreadLocalçš„keyå¾ˆå®¹æ˜“è¢«æ¸…ç†ï¼Œå…¶è¿˜æœ‰nullçš„é”®ï¼Œä¸€ç›´åœ¨é‚£é‡Œå‘†ç€ã€‚æ‰€ä»¥è¦ä½¿ç”¨removeæ¸…ç†æˆ–è€…æ˜¯ï¼ŒæŸ¥æ‰¾ä¸å½“å‰çº¿ç¨‹å…³è”çš„Mapå¹¶å°†é”®å€¼å¯¹è®¾ç½®ä¸ºå½“å‰çº¿ç¨‹å’Œnullï¼ŒHuozæ˜¯åœ¨finallyä¸­å…³é—­ThreadLocalã€‚</p><h3 id="9-å¦‚ä½•å®‰å…¨åœ°å­˜å‚¨ç”¨æˆ·å¯†ç ï¼Ÿ"><a href="#9-å¦‚ä½•å®‰å…¨åœ°å­˜å‚¨ç”¨æˆ·å¯†ç ï¼Ÿ" class="headerlink" title="9.å¦‚ä½•å®‰å…¨åœ°å­˜å‚¨ç”¨æˆ·å¯†ç ï¼Ÿ"></a>9.å¦‚ä½•å®‰å…¨åœ°å­˜å‚¨ç”¨æˆ·å¯†ç ï¼Ÿ</h3><p><strong>ä¸€å®šè¦å“ˆå¸Œ</strong>ï¼Œåˆ‡å¿Œæ˜æ–‡å­˜å‚¨ã€‚</p><p><strong>ä½¿ç”¨å¼ºå•å‘å“ˆå¸Œç®—æ³•</strong>ï¼Œæ¨èï¼š</p><ul><li>BCryptï¼ˆSpring Security é»˜è®¤æ”¯æŒï¼‰</li><li>Argon2ã€PBKDF2</li></ul><p><strong>åŠ ç›</strong>ï¼šæ¯ä¸ªç”¨æˆ·ä½¿ç”¨<strong>ç‹¬ç«‹éšæœºç›</strong>ï¼Œé˜²æ­¢å½©è™¹è¡¨æ”»å‡»ã€‚</p><p><strong>é€‚å½“è¿­ä»£</strong>ï¼šå¢åŠ è®¡ç®—æˆæœ¬ï¼Œé˜²æ­¢æš´åŠ›ç ´è§£ã€‚</p><h3 id="10-ä¸ºä»€ä¹ˆä¸è¦æŠŠæ•æ„Ÿä¿¡æ¯ï¼ˆå¦‚å¯†ç ï¼‰æ”¾åˆ°-JWT-é‡Œï¼Ÿ"><a href="#10-ä¸ºä»€ä¹ˆä¸è¦æŠŠæ•æ„Ÿä¿¡æ¯ï¼ˆå¦‚å¯†ç ï¼‰æ”¾åˆ°-JWT-é‡Œï¼Ÿ" class="headerlink" title="10.ä¸ºä»€ä¹ˆä¸è¦æŠŠæ•æ„Ÿä¿¡æ¯ï¼ˆå¦‚å¯†ç ï¼‰æ”¾åˆ° JWT é‡Œï¼Ÿ"></a>10.ä¸ºä»€ä¹ˆä¸è¦æŠŠæ•æ„Ÿä¿¡æ¯ï¼ˆå¦‚å¯†ç ï¼‰æ”¾åˆ° JWT é‡Œï¼Ÿ</h3><p><strong>JWT Payload å¯è¢«ä»»æ„æ–¹ Base64Url è§£ç </strong>ï¼Œä¸å…·å¤‡æœºå¯†æ€§ã€‚</p><p>å³ä½¿<strong>ç­¾åé˜²ç¯¡æ”¹</strong>ï¼Œä¹Ÿæ— æ³•é˜²æ­¢ä»»ä½•äººè¯»å–å…¶ä¸­çš„æ˜æ–‡æ•°æ®ã€‚</p><p>åº”åªæ”¾å¿…è¦çš„éæ•æ„Ÿæ ‡è¯†ï¼ˆå¦‚ <code>userId</code>ã€<code>roles</code>ï¼‰ï¼Œ<strong>æ•æ„Ÿæ•°æ®åº”åœ¨åå°æŒ‰éœ€æŸ¥è¯¢</strong>ã€‚</p><h3 id="11-Token-åœ¨å‰ç«¯å¦‚ä½•å­˜å‚¨ï¼ˆlocalStorage-vs-HttpOnly-Cookieï¼‰ï¼Ÿ"><a href="#11-Token-åœ¨å‰ç«¯å¦‚ä½•å­˜å‚¨ï¼ˆlocalStorage-vs-HttpOnly-Cookieï¼‰ï¼Ÿ" class="headerlink" title="11.Token åœ¨å‰ç«¯å¦‚ä½•å­˜å‚¨ï¼ˆlocalStorage vs HttpOnly Cookieï¼‰ï¼Ÿ"></a>11.Token åœ¨å‰ç«¯å¦‚ä½•å­˜å‚¨ï¼ˆlocalStorage vs HttpOnly Cookieï¼‰ï¼Ÿ</h3><div class="table-container"><table><thead><tr><th>å­˜å‚¨æ–¹å¼</th><th>ä¼˜ç‚¹</th><th>ç¼ºç‚¹</th></tr></thead><tbody><tr><td><strong>localStorage</strong></td><td>ç®€å•æ˜“ç”¨ï¼ŒJS å¯ç›´æ¥è¯»å†™</td><td>æ˜“å— XSS æ”»å‡»ï¼šæ¶æ„è„šæœ¬å¯è¯»å–å¹¶çªƒå– Token</td></tr><tr><td><strong>HttpOnly Cookie</strong></td><td>JS æ— æ³•è¯»å–ï¼Œèƒ½è‡ªåŠ¨éšè¯·æ±‚å¸¦ä¸Šï¼Œé˜²æ­¢ XSS</td><td>éœ€é˜²èŒƒ CSRFï¼ˆå¯é…åˆ SameSiteã€åŒé‡æäº¤ Cookieï¼‰</td></tr></tbody></table></div><p><strong>æœ€ä½³å®è·µ</strong>ï¼š</p><ul><li>æ¨èå°† <strong>Access Token</strong> å­˜åœ¨ <strong>HttpOnly</strong>ã€Secureã€SameSite=strict çš„ Cookie ä¸­ï¼›</li><li>å¦‚æœä»éœ€åœ¨ JS ä¸­è®¿é—®ï¼Œå¯ç”¨ Refresh Token çŸ­æ—¶å†™å…¥ <code>localStorage</code>ï¼Œä½†ä¸¥æ ¼é˜² XSSã€‚</li><li>åŒæ—¶é…åˆ CSRF ä»¤ç‰Œã€CORS ç™½åå•ã€å†…å®¹å®‰å…¨ç­–ç•¥ï¼ˆCSPï¼‰ç­‰ã€‚</li></ul><h2 id="æŠ€æœ¯å‡çº§-åŒé‡æ‹¦æˆªå™¨-åŒtoken"><a href="#æŠ€æœ¯å‡çº§-åŒé‡æ‹¦æˆªå™¨-åŒtoken" class="headerlink" title="æŠ€æœ¯å‡çº§-åŒé‡æ‹¦æˆªå™¨-åŒtoken"></a>æŠ€æœ¯å‡çº§-åŒé‡æ‹¦æˆªå™¨-åŒtoken</h2><p>ä»‹ç»ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">ç™»å½•æˆåŠŸ</span><br><span class="line">    â†“</span><br><span class="line">åç«¯ç”Ÿæˆ Access Tokenï¼ˆ<span class="number">10</span>åˆ†é’Ÿï¼‰ å’Œ Refresh Tokenï¼ˆ<span class="number">7</span>å¤©ï¼‰</span><br><span class="line">    â†“</span><br><span class="line">å‰ç«¯å­˜å‚¨ï¼š</span><br><span class="line">    - Access Tokenï¼ˆå¦‚å†…å­˜/Storeï¼‰</span><br><span class="line">    - Refresh Tokenï¼ˆå¦‚ Cookie/LocalStorageï¼‰</span><br><span class="line">    â†“</span><br><span class="line">è¯·æ±‚æ¥å£æ—¶æºå¸¦ Access Token</span><br><span class="line">    â†“</span><br><span class="line">å¦‚æœ Access Token è¿‡æœŸ</span><br><span class="line">    â†“</span><br><span class="line">ç”¨ Refresh Token å‘ refresh æ¥å£è·å–æ–°çš„ Access Token</span><br><span class="line">    â†“</span><br><span class="line">æˆåŠŸåˆ™è‡ªåŠ¨é‡è¯•åŸè¯·æ±‚ï¼›å¤±è´¥åˆ™è·³è½¬ç™»å½•</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>ä¸€çº§æ‹¦æˆªå™¨ï¼šJWT è®¤è¯æ‹¦æˆªå™¨ï¼ˆ<code>AuthInterceptor</code>ï¼‰</strong></p><p>æå–è¯·æ±‚å¤´ä¸­çš„ <code>Authorization: Bearer &lt;token&gt;</code> æºå¸¦çš„æ˜¯access token</p><p>è§£æ JWT è·å–ç”¨æˆ· IDï¼ˆä» Payload ä¸­è§£æå‡º <code>userId</code>ï¼‰</p><p>æ ¡éªŒç­¾åã€æ˜¯å¦è¿‡æœŸï¼ˆ<code>exp</code>ï¼‰</p><p>è‹¥æœ‰æ•ˆï¼ŒæŸ¥è¯¢ç”¨æˆ·ä¿¡æ¯å¹¶å†™å…¥ <code>ThreadLocal</code></p><p>å¼‚å¸¸å¤„ç†ï¼š</p><ul><li>æ—  Tokenã€Token æ— æ•ˆæˆ–è¿‡æœŸ â†’ è¿”å› 401 å“åº”</li></ul><p><strong>äºŒçº§æ‹¦æˆªå™¨ï¼šToken åˆ·æ–°æ‹¦æˆªå™¨ï¼ˆ<code>RefreshInterceptor</code>ï¼‰</strong></p><ul><li>ä½œç”¨ï¼š<ul><li>æ£€æŸ¥ Token æ˜¯å¦ä¸´è¿‘è¿‡æœŸï¼ˆå¦‚è· <code>exp</code> ä»…å‰© 5 åˆ†é’Ÿï¼‰æˆ–è€…æ˜¯access tokenå·²ç»è¿‡æœŸï¼Œè¿”å›401</li><li>å»redisä¸­æŸ¥æ‰¾refrush tokenï¼Œæ‰¾åˆ°äº†å°±ç»­ç­¾</li><li>é‡æ–°ç”Ÿæˆ Tokenï¼Œå¹¶å°†å…¶é€šè¿‡å“åº”å¤´æˆ– Cookie è¿”å›ç»™å‰ç«¯</li><li>ä½¿ç”¨ <code>setHeader(&quot;Authorization&quot;, &quot;Bearer xxx&quot;)</code> è¿”å›æ–° Token</li><li>ç„¶åé‡æ–°å°è¯•åŸè¯·æ±‚</li></ul></li></ul><p><strong>ç”¨æˆ·ä¿¡æ¯å­˜å…¥ <code>ThreadLocal</code></strong></p><ul><li><code>UserHolder.set(userInfo)</code>ï¼šæ‹¦æˆªå™¨ä¸­å°†ç”¨æˆ·ä¿¡æ¯å†™å…¥ ThreadLocal</li><li>Controller ä¸­é€šè¿‡ <code>UserHolder.get()</code> è·å–ï¼Œæ— éœ€æ¯æ¬¡æŸ¥åº“ï¼ˆRT ä» 200ms é™è‡³ 20msï¼‰</li><li>åœ¨ <code>afterCompletion</code> ä¸­æ¸…ç† ThreadLocalï¼Œé˜²æ­¢çº¿ç¨‹å¤ç”¨é€ æˆç”¨æˆ·ä¿¡æ¯ä¸²ç”¨</li></ul><h3 id="é—®é¢˜è§£æ-1"><a href="#é—®é¢˜è§£æ-1" class="headerlink" title="é—®é¢˜è§£æ"></a>é—®é¢˜è§£æ</h3><h4 id="1-ä½ ä»¬çš„è®¤è¯æœºåˆ¶æ˜¯æ€ä¹ˆåšçš„ï¼Ÿä¸ºä»€ä¹ˆç”¨-JWTï¼Ÿ"><a href="#1-ä½ ä»¬çš„è®¤è¯æœºåˆ¶æ˜¯æ€ä¹ˆåšçš„ï¼Ÿä¸ºä»€ä¹ˆç”¨-JWTï¼Ÿ" class="headerlink" title="1.ä½ ä»¬çš„è®¤è¯æœºåˆ¶æ˜¯æ€ä¹ˆåšçš„ï¼Ÿä¸ºä»€ä¹ˆç”¨ JWTï¼Ÿ"></a>1.<strong>ä½ ä»¬çš„è®¤è¯æœºåˆ¶æ˜¯æ€ä¹ˆåšçš„ï¼Ÿä¸ºä»€ä¹ˆç”¨ JWTï¼Ÿ</strong></h4><p>å‰åç«¯åˆ†ç¦»æ¶æ„ä¸‹ä½¿ç”¨ <strong>JWT æ— çŠ¶æ€ä»¤ç‰Œ</strong>ï¼Œç”¨æˆ·ç™»å½•åç”±æœåŠ¡ç«¯ç”Ÿæˆ Tokenï¼Œåç»­è¯·æ±‚æºå¸¦ Token å®Œæˆèº«ä»½éªŒè¯</p><p>ä¸ä¼ ç»Ÿ Session ç›¸æ¯”ï¼ŒJWT ä¸ä¾èµ–æœåŠ¡ç«¯å­˜å‚¨ï¼Œ<strong>æ›´é€‚åˆåˆ†å¸ƒå¼å¾®æœåŠ¡åœºæ™¯</strong></p><p>ç­¾åæœºåˆ¶å¯é˜²æ­¢ Token è¢«ä¼ªé€ ï¼ŒPayload å¯æºå¸¦ <code>userId</code> ç­‰ä¿¡æ¯å‡å°‘æ•°æ®åº“æŸ¥è¯¢</p><h4 id="2-å¦‚ä½•è®¾è®¡-Token-åˆ·æ–°æœºåˆ¶ï¼Ÿ"><a href="#2-å¦‚ä½•è®¾è®¡-Token-åˆ·æ–°æœºåˆ¶ï¼Ÿ" class="headerlink" title="2.å¦‚ä½•è®¾è®¡ Token åˆ·æ–°æœºåˆ¶ï¼Ÿ"></a>2.å¦‚ä½•è®¾è®¡ Token åˆ·æ–°æœºåˆ¶ï¼Ÿ</h4><p>åœ¨æ‹¦æˆªå™¨ä¸­æ£€æŸ¥ Token å‰©ä½™æœ‰æ•ˆæ—¶é—´</p><p>å½“ Token ä¸´è¿‘è¿‡æœŸï¼ˆä¾‹å¦‚å‰©ä½™ &lt;5 åˆ†é’Ÿï¼‰æ—¶ï¼Œ<strong>è‡ªåŠ¨ç”Ÿæˆæ–° Token å¹¶é€šè¿‡å“åº”å¤´æˆ– Cookie è¿”å›</strong></p><p>æé«˜ç”¨æˆ·ä½“éªŒï¼Œé¿å…é¢‘ç¹é‡æ–°ç™»å½•</p><p>å¯é…åˆ Refresh Token å¼ºåŒ–å®‰å…¨æ€§</p><h4 id="3-ä¸ºä»€ä¹ˆä½¿ç”¨-ThreadLocalï¼Ÿæ˜¯å¦å­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Ÿ"><a href="#3-ä¸ºä»€ä¹ˆä½¿ç”¨-ThreadLocalï¼Ÿæ˜¯å¦å­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Ÿ" class="headerlink" title="3.ä¸ºä»€ä¹ˆä½¿ç”¨ ThreadLocalï¼Ÿæ˜¯å¦å­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Ÿ"></a>3.ä¸ºä»€ä¹ˆä½¿ç”¨ ThreadLocalï¼Ÿæ˜¯å¦å­˜åœ¨çº¿ç¨‹å®‰å…¨é—®é¢˜ï¼Ÿ</h4><p>ThreadLocal å°†<strong>ç”¨æˆ·ä¿¡æ¯ä¸çº¿ç¨‹</strong>ç»‘å®šï¼Œé¿å…åœ¨æ¯ä¸ªæ–¹æ³•ä¸­é‡å¤æŸ¥è¯¢ã€ä¼ å‚ï¼Œå‡å°‘æ•°æ®åº“/Redis å‹åŠ›</p><p>åœ¨ Controller å±‚å¯ç›´æ¥é€šè¿‡ <code>UserHolder.get()</code> è·å–ç”¨æˆ·ä¿¡æ¯ï¼Œæå‡æ€§èƒ½ï¼ˆå¦‚ä» 200ms é™åˆ° 20msï¼‰</p><p><strong>çº¿ç¨‹å®‰å…¨æ€§ä¿éšœ</strong>ï¼š</p><ul><li>æ¯ä¸ªçº¿ç¨‹æœ‰ç‹¬ç«‹å‰¯æœ¬</li><li>ä½¿ç”¨çº¿ç¨‹æ± æ—¶å¿…é¡»æ‰‹åŠ¨ <code>remove()</code>ï¼Œå¦åˆ™ç”¨æˆ·æ•°æ®ä¸²ç”¨ â†’ å®‰å…¨éšæ‚£</li></ul><p><strong>é™åˆ¶</strong>ï¼š</p><ul><li>å¿…é¡»åœ¨è¯·æ±‚<strong>ç»“æŸåæ¸…ç†</strong>ï¼Œå¦åˆ™çº¿ç¨‹å¤ç”¨ä¼šå¯¼è‡´â€œä¸Šä¸‹æ–‡ä¸²åº“â€</li><li>ä¸èƒ½è·¨çº¿ç¨‹ï¼ˆå¦‚å¼‚æ­¥æ‰§è¡Œã€çº¿ç¨‹æ± ä»»åŠ¡ï¼‰å…±äº«ï¼›å¦‚æœåœ¨å­çº¿ç¨‹é‡Œå°è¯•å–æ•°æ®ï¼Œéœ€è¦æ˜¾å¼ä¼ é€’æˆ–ä½¿ç”¨ <code>InheritableThreadLocal</code>ï¼ˆä½†è¦æ³¨æ„ GC é£é™©ï¼‰</li><li>å¤§é‡æ•°æ®å­˜æ”¾ä¼šå¢åŠ å†…å­˜å‹åŠ›</li></ul><p>æˆ–è€…æ˜¯å¦‚æœä¸æ¸…ç†çš„è¯ï¼Œå› ä¸ºæ˜¯å¼±å¼•ç”¨ï¼ŒThreadLocalçš„keyå¾ˆå®¹æ˜“è¢«æ¸…ç†ï¼Œå…¶è¿˜æœ‰nullçš„é”®ï¼Œä¸€ç›´åœ¨é‚£é‡Œå‘†ç€ã€‚æ‰€ä»¥è¦ä½¿ç”¨removeæ¸…ç†æˆ–è€…æ˜¯ï¼ŒæŸ¥æ‰¾ä¸å½“å‰çº¿ç¨‹å…³è”çš„Mapå¹¶å°†é”®å€¼å¯¹è®¾ç½®ä¸ºå½“å‰çº¿ç¨‹å’Œnullï¼ŒHuozæ˜¯åœ¨finallyä¸­å…³é—­ThreadLocalã€‚</p><h4 id="4-ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ä¸¤ä¸ªæ‹¦æˆªå™¨ï¼Ÿä¸èƒ½ä¸€ä¸ªå®ç°æ‰€æœ‰åŠŸèƒ½å—ï¼Ÿ"><a href="#4-ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ä¸¤ä¸ªæ‹¦æˆªå™¨ï¼Ÿä¸èƒ½ä¸€ä¸ªå®ç°æ‰€æœ‰åŠŸèƒ½å—ï¼Ÿ" class="headerlink" title="4.ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ä¸¤ä¸ªæ‹¦æˆªå™¨ï¼Ÿä¸èƒ½ä¸€ä¸ªå®ç°æ‰€æœ‰åŠŸèƒ½å—ï¼Ÿ"></a>4.<strong>ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ä¸¤ä¸ªæ‹¦æˆªå™¨ï¼Ÿä¸èƒ½ä¸€ä¸ªå®ç°æ‰€æœ‰åŠŸèƒ½å—ï¼Ÿ</strong></h4><p>èŒè´£å•ä¸€ï¼Œéµå¾ª <strong>å•ä¸€èŒè´£åŸåˆ™</strong>ï¼Œä»£ç æ›´æ¸…æ™°ã€å¯ç»´æŠ¤æ€§æ›´å¥½</p><p>ä¸€çº§è´Ÿè´£è®¤è¯ï¼ŒäºŒçº§è´Ÿè´£ç»­ç­¾ï¼Œåˆ†å±‚é€»è¾‘è§£è€¦ï¼Œä¾¿äºæ‰©å±•å’Œæµ‹è¯•</p><p>ä¹Ÿæ–¹ä¾¿åæœŸå¼•å…¥æ›´å¤šå±‚ï¼ˆå¦‚è§’è‰²æ ¡éªŒã€æ—¥å¿—è®°å½•ç­‰ï¼‰</p><h4 id="5-Token-åœ¨å‰ç«¯å¦‚ä½•å­˜å‚¨ï¼Ÿå¦‚ä½•é˜²æ­¢è¢«ç›—ç”¨ï¼Ÿ"><a href="#5-Token-åœ¨å‰ç«¯å¦‚ä½•å­˜å‚¨ï¼Ÿå¦‚ä½•é˜²æ­¢è¢«ç›—ç”¨ï¼Ÿ" class="headerlink" title="5.Token åœ¨å‰ç«¯å¦‚ä½•å­˜å‚¨ï¼Ÿå¦‚ä½•é˜²æ­¢è¢«ç›—ç”¨ï¼Ÿ"></a>5.Token åœ¨å‰ç«¯å¦‚ä½•å­˜å‚¨ï¼Ÿå¦‚ä½•é˜²æ­¢è¢«ç›—ç”¨ï¼Ÿ</h4><p>æ¨èä½¿ç”¨ <strong>HttpOnly + Secure çš„ Cookie å­˜å‚¨ Token</strong>ï¼Œé˜²æ­¢ JS è„šæœ¬è¯»å–ï¼ˆé˜² XSSï¼‰</p><p>ç»“åˆ <code>SameSite=Strict</code> å±æ€§é˜²æ­¢ CSRF æ”»å‡»</p><p>é¿å…æŠŠ Token å­˜åœ¨ localStorage ä¸­ï¼ŒlocalStorage æ˜“è¢« XSS æ”»å‡»è¯»å–</p><p>å¯é€‰ä½¿ç”¨åŒ Tokenï¼šAccess Token + Refresh Tokenï¼Œæå‡å®‰å…¨æ€§</p><h4 id="6-ä¸ºä»€ä¹ˆè¦ä½¿ç”¨-Access-Token-å’Œ-Refresh-Token-åŒ-tokenï¼Ÿ"><a href="#6-ä¸ºä»€ä¹ˆè¦ä½¿ç”¨-Access-Token-å’Œ-Refresh-Token-åŒ-tokenï¼Ÿ" class="headerlink" title="6.ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ Access Token å’Œ Refresh Token åŒ tokenï¼Ÿ"></a>6.ä¸ºä»€ä¹ˆè¦ä½¿ç”¨ Access Token å’Œ Refresh Token åŒ tokenï¼Ÿ</h4><p>Access Token çŸ­æœŸæœ‰æ•ˆï¼Œæš´éœ²é£é™©å°ï¼›</p><p>Refresh Token ä¿æŠ¤ç”¨æˆ·æ— éœ€é¢‘ç¹ç™»å½•ï¼›</p><p>é¿å…é¢‘ç¹éªŒè¯æ•°æ®åº“æˆ– Redisï¼Œæé«˜æ€§èƒ½ï¼›</p><p>é…åˆåŒæ‹¦æˆªå™¨è‡ªåŠ¨åˆ·æ–°ï¼Œå¢å¼ºç”¨æˆ·ä½“éªŒã€‚</p><h4 id="7-Refresh-Token-è¦ä¸è¦å­˜-Redisï¼Ÿ"><a href="#7-Refresh-Token-è¦ä¸è¦å­˜-Redisï¼Ÿ" class="headerlink" title="7.Refresh Token è¦ä¸è¦å­˜ Redisï¼Ÿ"></a>7.<strong>Refresh Token è¦ä¸è¦å­˜ Redisï¼Ÿ</strong></h4><p>å»ºè®®å­˜ Redisï¼š</p><ul><li>å¯ä¸»åŠ¨ç™»å‡º/æ³¨é”€ refresh tokenï¼›</li><li>å¯å¼ºåˆ¶ä¸‹çº¿ï¼›</li><li>å¯é™åˆ¶ä¸€ä¸ªç”¨æˆ·åªæœ‰ä¸€ä¸ªæœ‰æ•ˆ refresh tokenï¼›</li><li>æé«˜å®‰å…¨æ€§ï¼ˆRefresh Token ä¸åº”è¢«é¢‘ç¹éªŒè¯ï¼Œä½†ä¸€æ—¦æ³„éœ²å½±å“å¾ˆå¤§ï¼‰ã€‚</li></ul><h4 id="8-Refresh-Token-è¿‡æœŸåæ€ä¹ˆåŠï¼Ÿ"><a href="#8-Refresh-Token-è¿‡æœŸåæ€ä¹ˆåŠï¼Ÿ" class="headerlink" title="8.Refresh Token è¿‡æœŸåæ€ä¹ˆåŠï¼Ÿ"></a>8.Refresh Token è¿‡æœŸåæ€ä¹ˆåŠï¼Ÿ</h4><p>å‰ç«¯æ”¶åˆ° 401 åæ— æ³•å†è‡ªåŠ¨ç»­ç­¾ï¼›</p><p>å¼•å¯¼ç”¨æˆ·é‡æ–°ç™»å½•ï¼›</p><p>åç«¯è¿”å›ç‰¹å®šé”™è¯¯ç åŒºåˆ† access ä¸ refresh å¤±æ•ˆã€‚</p><h4 id="9-å¦‚ä½•é˜²æ­¢-Refresh-Token-è¢«ç›—ç”¨ï¼Ÿ"><a href="#9-å¦‚ä½•é˜²æ­¢-Refresh-Token-è¢«ç›—ç”¨ï¼Ÿ" class="headerlink" title="9.å¦‚ä½•é˜²æ­¢ Refresh Token è¢«ç›—ç”¨ï¼Ÿ"></a>9.å¦‚ä½•é˜²æ­¢ Refresh Token è¢«ç›—ç”¨ï¼Ÿ</h4><p>é™åˆ¶ IPã€è®¾å¤‡æ ‡è¯†ï¼ˆUser-Agentï¼‰ç­‰ï¼›</p><p>åŠ å…¥ Redis é»‘åå•æœºåˆ¶ï¼›</p><p>å»ºè®®è®¾ç½® HttpOnly Cookie å­˜å‚¨ refresh tokenï¼Œé˜²æ­¢ XSSï¼›</p><h2 id="æ¥å£æ”¯æ¡£ç¼–å†™ä¸æµ‹è¯•"><a href="#æ¥å£æ”¯æ¡£ç¼–å†™ä¸æµ‹è¯•" class="headerlink" title="æ¥å£æ”¯æ¡£ç¼–å†™ä¸æµ‹è¯•"></a>æ¥å£æ”¯æ¡£ç¼–å†™ä¸æµ‹è¯•</h2><p>ä½¿ç”¨Swaggerç¼–å†™æ¥å£æ”¯æ¡£ï¼Œå¼€å‘è¿‡ç¨‹ä¸­è¿›è¡Œæ¥å£è”è°ƒæµ‹è¯•æå‡å¼€å‘æ•ˆç‡</p><p>Swagger æ˜¯ä¸€å¥— <strong>å¼€æ”¾æºä»£ç é¡¹ç›®</strong>ï¼Œç”¨äºç”Ÿæˆã€æè¿°ã€è°ƒç”¨å’Œå¯è§†åŒ– RESTful é£æ ¼ Web æœåŠ¡çš„å·¥å…·é›†ã€‚ä¸»è¦åŒ…æ‹¬ï¼š</p><ul><li>Swagger UIï¼šæä¾›ä¸€ä¸ªäº¤äº’å¼æ–‡æ¡£é¡µé¢ï¼Œå¯ä»¥ç›´æ¥æµ‹è¯•æ¥å£ã€‚</li><li>Swagger Editorï¼šåœ¨çº¿ç¼–è¾‘ OpenAPI è§„èŒƒæ–‡æ¡£ã€‚</li><li>Swagger Codegenï¼šæ ¹æ®æ–‡æ¡£ç”Ÿæˆå®¢æˆ·ç«¯ SDK æˆ–æœåŠ¡ç«¯æ¨¡æ¿ä»£ç ã€‚</li></ul><p>å¸¸è§æ³¨è§£ï¼š</p><div class="table-container"><table><thead><tr><th>æ³¨è§£</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td><code>@Operation(summary = &quot;...&quot;)</code></td><td>ç”¨äºæ–¹æ³•ä¸Šï¼Œæè¿°æ¥å£ä½œç”¨</td></tr><tr><td><code>@Parameter(name = &quot;...&quot;)</code></td><td>ç”¨äºæ–¹æ³•å‚æ•°ä¸Šï¼Œæè¿°å‚æ•°</td></tr><tr><td><code>@Schema(description = &quot;...&quot;)</code></td><td>ç”¨äºå®ä½“ç±»å­—æ®µä¸Šï¼Œæè¿°å­—æ®µ</td></tr><tr><td><code>@Tag(name = &quot;...&quot;)</code></td><td>ç”¨äº Controller ä¸Šï¼Œåˆ†ç»„æè¿°</td></tr><tr><td><code>@RequestBody</code> + <code>@Schema</code></td><td>æè¿°è¯·æ±‚ä½“</td></tr><tr><td><code>@ApiResponse(responseCode = &quot;200&quot;, description = &quot;...&quot;)</code></td><td>æè¿°å“åº”ç ä¸å†…å®¹</td></tr></tbody></table></div><p>ç¤ºä¾‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/api/user&quot;)</span></span><br><span class="line"><span class="meta">@Tag(name = &quot;ç”¨æˆ·æ¥å£&quot;, description = &quot;ç”¨æˆ·ç›¸å…³æ¥å£æ–‡æ¡£&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/add&quot;)</span></span><br><span class="line">    <span class="meta">@Operation(summary = &quot;æ–°å¢ç”¨æˆ·&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;String&gt; <span class="title function_">addUser</span><span class="params">(<span class="meta">@RequestBody</span> <span class="meta">@Parameter(description = &quot;ç”¨æˆ·ä¿¡æ¯&quot;)</span> UserDTO user)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.ok(<span class="string">&quot;æ·»åŠ æˆåŠŸ: &quot;</span> + user.getUsername());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="meta">@Operation(summary = &quot;æ ¹æ®IDè·å–ç”¨æˆ·&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> ResponseEntity&lt;UserDTO&gt; <span class="title function_">getUser</span><span class="params">(<span class="meta">@PathVariable</span> Long id)</span> &#123;</span><br><span class="line">        <span class="type">UserDTO</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserDTO</span>();</span><br><span class="line">        user.setUsername(<span class="string">&quot;å¼ ä¸‰&quot;</span>);</span><br><span class="line">        user.setAge(<span class="number">25</span>);</span><br><span class="line">        <span class="keyword">return</span> ResponseEntity.ok(user);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="é¢è¯•é—®é¢˜"><a href="#é¢è¯•é—®é¢˜" class="headerlink" title="é¢è¯•é—®é¢˜"></a>é¢è¯•é—®é¢˜</h3><h4 id="1-Swagger-æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿä½¿ç”¨å®ƒæœ‰ä»€ä¹ˆä¼˜åŠ¿ï¼Ÿ"><a href="#1-Swagger-æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿä½¿ç”¨å®ƒæœ‰ä»€ä¹ˆä¼˜åŠ¿ï¼Ÿ" class="headerlink" title="1.Swagger æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿä½¿ç”¨å®ƒæœ‰ä»€ä¹ˆä¼˜åŠ¿ï¼Ÿ"></a>1.Swagger æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿä½¿ç”¨å®ƒæœ‰ä»€ä¹ˆä¼˜åŠ¿ï¼Ÿ</h4><p>Swagger å¯ä»¥<strong>è‡ªåŠ¨ç”Ÿæˆæ¥å£æ–‡æ¡£</strong>ï¼Œæ”¯æŒæ¥å£è°ƒè¯•ï¼Œæå‡å‰åç«¯è”è°ƒæ•ˆç‡ã€‚ä¼˜åŠ¿åŒ…æ‹¬ï¼š</p><ul><li>æ¥å£æ–‡æ¡£è‡ªåŠ¨åŒæ­¥ï¼Œæ— éœ€æ‰‹å†™ç»´æŠ¤</li><li>å¯è§†åŒ–äº¤äº’å¼é¡µé¢ï¼Œä¾¿äºæµ‹è¯•æ¥å£</li><li>æ”¯æŒå¯¼å‡º OpenAPI è§„èŒƒï¼Œä¾¿äºç”Ÿæˆ SDK æˆ– Mock æ¥å£</li></ul><h4 id="2-Swagger-åœ¨-Spring-Boot-é¡¹ç›®ä¸­å¦‚ä½•æ¥å…¥ï¼Ÿ"><a href="#2-Swagger-åœ¨-Spring-Boot-é¡¹ç›®ä¸­å¦‚ä½•æ¥å…¥ï¼Ÿ" class="headerlink" title="2.Swagger åœ¨ Spring Boot é¡¹ç›®ä¸­å¦‚ä½•æ¥å…¥ï¼Ÿ"></a>2.Swagger åœ¨ Spring Boot é¡¹ç›®ä¸­å¦‚ä½•æ¥å…¥ï¼Ÿ</h4><p>ä½¿ç”¨ <code>springdoc-openapi</code> ä¾èµ–ï¼Œæ·»åŠ ä¾èµ–åå³å¯è‡ªåŠ¨æ‰«æ <code>@RestController</code> æ³¨è§£çš„æ–¹æ³•ç”Ÿæˆæ¥å£æ–‡æ¡£ï¼Œå¸¸ç”¨æ³¨è§£åŒ…æ‹¬ <code>@Operation</code>ã€<code>@Schema</code>ã€<code>@Parameter</code> ç­‰ã€‚</p><h4 id="3-Swagger-ä¸-Postman-æœ‰ä½•åŒºåˆ«ï¼Ÿ"><a href="#3-Swagger-ä¸-Postman-æœ‰ä½•åŒºåˆ«ï¼Ÿ" class="headerlink" title="3.Swagger ä¸ Postman æœ‰ä½•åŒºåˆ«ï¼Ÿ"></a>3.Swagger ä¸ Postman æœ‰ä½•åŒºåˆ«ï¼Ÿ</h4><p>Swagger æ›´é€‚åˆå¼€å‘é˜¶æ®µè‡ªåŠ¨ç”Ÿæˆæ–‡æ¡£å’Œæ¥å£è°ƒè¯•ï¼›</p><p>Postman æ›´é€‚åˆæ¥å£è‡ªåŠ¨åŒ–æµ‹è¯•ã€å›¢é˜Ÿå…±äº«æµ‹è¯•é›†åˆã€å‹æµ‹è„šæœ¬ç­‰ï¼›</p><p>ä¸¤è€…å¯äº’è¡¥ï¼šSwagger å¯¼å‡º OpenAPI è§„èŒƒï¼ŒPostman å¯å¯¼å…¥æ‰§è¡Œã€‚</p><h4 id="4-å¦‚ä½•é€šè¿‡-Swagger-å®ç°æ¥å£-Mockï¼Ÿ"><a href="#4-å¦‚ä½•é€šè¿‡-Swagger-å®ç°æ¥å£-Mockï¼Ÿ" class="headerlink" title="4.å¦‚ä½•é€šè¿‡ Swagger å®ç°æ¥å£ Mockï¼Ÿ"></a>4.å¦‚ä½•é€šè¿‡ Swagger å®ç°æ¥å£ Mockï¼Ÿ</h4><p>Swagger æœ¬èº«ä¸æä¾› Mock åŠŸèƒ½ï¼Œä½†å¯ä»¥é€šè¿‡ï¼š</p><ul><li>SwaggerHub æä¾›åœ¨çº¿ Mockï¼›</li><li>ä½¿ç”¨ Swagger JSON é…åˆå·¥å…·å¦‚ <a href="https://github.com/stoplightio/prism">Prism</a>ã€[WireMock] å®ç°ï¼›</li><li>æœ¬åœ°æ¨¡æ‹Ÿè¿”å›å›ºå®šæ•°æ®ï¼Œç”¨äºå‰ç«¯è°ƒè¯•ã€‚</li></ul><h4 id="5-MOCKæ˜¯å•¥"><a href="#5-MOCKæ˜¯å•¥" class="headerlink" title="5.MOCKæ˜¯å•¥"></a>5.MOCKæ˜¯å•¥</h4><p><strong>ç”¨äºåœ¨çœŸå®å¯¹è±¡ä¸å¯ç”¨ã€æœªå®Œæˆæˆ–ä¸æ–¹ä¾¿è°ƒç”¨æ—¶ï¼Œä½¿ç”¨ä¼ªé€ çš„â€œæ›¿ä»£å¯¹è±¡â€æ¥æ¨¡æ‹Ÿå…¶è¡Œä¸º</strong>ã€‚</p><p>æœ¬è´¨ï¼šä½¿ç”¨å‡çš„å¯¹è±¡æˆ–è¿”å›ç»“æœï¼Œä»£æ›¿çœŸå®ä¾èµ–æˆ–çœŸå®æ•°æ®ï¼Œæ–¹ä¾¿å¼€å‘å’Œæµ‹è¯•ã€‚</p><p>æ€§èƒ½ä¸éƒ¨ç½²ä¼˜åŒ–ï¼šä½¿ç”¨Redisç¼“å­˜çƒ­é—¨èœå“æ•°æ®å±…ï¼Œåº”å¯¹é«˜å¹¶å‘ï¼Œå‡å°‘æ•°æ®åº“è®¿å°šï¼Œç¼©çŸ­æ¥å£å“åº”æ—¶é—´ï¼šé…ç½®gä½œä¸ºæ—¥PæœåŠ¡å™¨ï¼Œå¤–ç†é™æ€èµ„æºèµ”éƒ¨ç½®ã€ååŒä»£å•åŠè´Ÿçš„å¾‹ï¼Œæå‡ç³»ç»Ÿç¨³å®šæ€§ä¸å“åº”èƒ½åŠ›</p>]]></content:encoded>
      
      
      <category domain="https://blog.tokenlen.top/categories/java/">java</category>
      
      <category domain="https://blog.tokenlen.top/categories/java/%E9%A1%B9%E7%9B%AE/">é¡¹ç›®</category>
      
      
      <category domain="https://blog.tokenlen.top/tags/java/">java</category>
      
      <category domain="https://blog.tokenlen.top/tags/spring-boot/">spring boot</category>
      
      
      <comments>https://blog.tokenlen.top/2025/05/27/workmenu/crmeb/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>JVM-javaè™šæ‹Ÿæœº</title>
      <link>https://blog.tokenlen.top/2025/05/25/java-stack/jvm1/</link>
      <guid>https://blog.tokenlen.top/2025/05/25/java-stack/jvm1/</guid>
      <pubDate>Sat, 24 May 2025 16:00:00 GMT</pubDate>
      
        
        
          
          
      <description>&lt;h1 id=&quot;åŸºæœ¬ä»‹ç»&quot;&gt;&lt;a href=&quot;#åŸºæœ¬ä»‹ç»&quot; class=&quot;headerlink&quot; title=&quot;åŸºæœ¬ä»‹ç»&quot;&gt;&lt;/a&gt;åŸºæœ¬ä»‹ç»&lt;/h1&gt;&lt;p&gt;JVM æ˜¯ Java Virtual Machine</description>
          
        
      
      
      
      <content:encoded><![CDATA[<h1 id="åŸºæœ¬ä»‹ç»"><a href="#åŸºæœ¬ä»‹ç»" class="headerlink" title="åŸºæœ¬ä»‹ç»"></a>åŸºæœ¬ä»‹ç»</h1><p>JVM æ˜¯ Java Virtual Machine çš„ç¼©å†™ï¼Œå®ƒæ˜¯ä¸€ä¸ªè™šæ„å‡ºæ¥çš„è®¡ç®—æœºï¼Œä¸€ç§è§„èŒƒã€‚é€šè¿‡åœ¨å®é™…çš„è®¡ç®—æœºä¸Šä»¿çœŸæ¨¡æ‹Ÿå„ç±»è®¡ç®—æœºåŠŸèƒ½å®ç°Â·Â·Â·</p><p> JVM å…¶å®å°±ç±»ä¼¼äºä¸€å°å°ç”µè„‘è¿è¡Œåœ¨ windows æˆ–è€… linux è¿™äº›æ“ä½œç³»ç»Ÿç¯å¢ƒä¸‹å³å¯ã€‚<strong>å®ƒç›´æ¥å’Œæ“ä½œç³»ç»Ÿè¿›è¡Œäº¤äº’</strong>ï¼Œä¸ç¡¬ä»¶ä¸ç›´æ¥äº¤äº’ï¼Œè€Œæ“ä½œç³»ç»Ÿå¯ä»¥å¸®æˆ‘ä»¬å®Œæˆå’Œç¡¬ä»¶è¿›è¡Œäº¤äº’çš„å·¥ä½œã€‚</p><p><img src="https://cdn.xiaolincoding.com//picgo/1713516291293-ce6ee4e7-c5a6-4395-9ee7-4ec1c014b206.webp" alt=""></p><p>é‚£æˆ‘ä»¬çš„ <strong>JVM</strong> æ˜¯ä¸è®¤è¯†æ–‡æœ¬æ–‡ä»¶çš„ï¼Œæ‰€ä»¥å®ƒéœ€è¦ä¸€ä¸ª <strong>ç¼–è¯‘</strong> ï¼Œè®©å…¶æˆä¸ºä¸€ä¸ªå®ƒä¼šè¯»äºŒè¿›åˆ¶æ–‡ä»¶çš„ <strong>HelloWorld.class</strong></p><p>å¦‚æœ <strong>JVM</strong> æƒ³è¦æ‰§è¡Œè¿™ä¸ª <strong>.class</strong> æ–‡ä»¶ï¼Œæˆ‘ä»¬éœ€è¦å°†å…¶è£…è¿›ä¸€ä¸ª <strong>ç±»åŠ è½½å™¨</strong> ä¸­ï¼Œå®ƒå°±åƒä¸€ä¸ªæ¬è¿å·¥ä¸€æ ·ï¼Œä¼šæŠŠæ‰€æœ‰çš„ <strong>.class</strong> æ–‡ä»¶å…¨éƒ¨æ¬è¿› JVM é‡Œé¢æ¥ã€‚</p><p><img src="https://static001.geekbang.org/infoq/2f/2f012fde94376f43a25dbe1dd07e0dd8.png" alt=""></p><p><strong>æ–¹æ³•åŒº</strong> æ˜¯ç”¨äºå­˜æ”¾ç±»ä¼¼äºå…ƒæ•°æ®ä¿¡æ¯æ–¹é¢çš„æ•°æ®çš„ï¼Œæ¯”å¦‚ç±»ä¿¡æ¯ï¼Œå¸¸é‡ï¼Œé™æ€å˜é‡ï¼Œç¼–è¯‘åä»£ç Â·Â·Â·ç­‰</p><p>ç±»åŠ è½½å™¨å°† .class æ–‡ä»¶æ¬è¿‡æ¥å°±æ˜¯å…ˆä¸¢åˆ°è¿™ä¸€å—ä¸Š</p><p><strong>å †</strong> ä¸»è¦æ”¾äº†ä¸€äº›å­˜å‚¨çš„æ•°æ®ï¼Œæ¯”å¦‚å¯¹è±¡å®ä¾‹ï¼Œæ•°ç»„Â·Â·Â·ç­‰ï¼Œå®ƒå’Œæ–¹æ³•åŒºéƒ½åŒå±äº <strong>çº¿ç¨‹å…±äº«åŒºåŸŸ</strong> ã€‚ä¹Ÿå°±æ˜¯è¯´å®ƒä»¬éƒ½æ˜¯ <strong>çº¿ç¨‹ä¸å®‰å…¨</strong> çš„</p><p><strong>æ ˆ</strong> è¿™æ˜¯æˆ‘ä»¬çš„ä»£ç è¿è¡Œç©ºé—´ã€‚æˆ‘ä»¬ç¼–å†™çš„æ¯ä¸€ä¸ªæ–¹æ³•éƒ½ä¼šæ”¾åˆ° <strong>æ ˆ</strong> é‡Œé¢è¿è¡Œã€‚</p><p>æˆ‘ä»¬ä¼šå¬è¯´è¿‡ æœ¬åœ°æ–¹æ³•æ ˆ æˆ–è€… æœ¬åœ°æ–¹æ³•æ¥å£ è¿™ä¸¤ä¸ªåè¯ï¼Œä¸è¿‡æˆ‘ä»¬åŸºæœ¬ä¸ä¼šæ¶‰åŠè¿™ä¸¤å—çš„å†…å®¹ï¼Œå®ƒä¿©åº•å±‚æ˜¯ä½¿ç”¨ C æ¥è¿›è¡Œå·¥ä½œçš„ï¼Œå’Œ Java æ²¡æœ‰å¤ªå¤§çš„å…³ç³»</p><p><strong>ç¨‹åºè®¡æ•°å™¨</strong>ä¸»è¦å°±æ˜¯å®Œæˆä¸€ä¸ª<strong>åŠ è½½å·¥ä½œ</strong>ï¼Œç±»ä¼¼äºä¸€ä¸ªæŒ‡é’ˆä¸€æ ·çš„ï¼ŒæŒ‡å‘<strong>ä¸‹ä¸€è¡Œæˆ‘ä»¬éœ€è¦æ‰§è¡Œçš„ä»£ç ã€‚å’Œæ ˆä¸€æ ·</strong>ï¼Œéƒ½æ˜¯ <strong>çº¿ç¨‹ç‹¬äº«</strong> çš„ï¼Œå°±æ˜¯è¯´æ¯ä¸€ä¸ªçº¿ç¨‹éƒ½ä¼šæœ‰è‡ªå·±å¯¹åº”çš„ä¸€å—åŒºåŸŸè€Œä¸ä¼šå­˜åœ¨å¹¶å‘å’Œå¤šçº¿ç¨‹çš„é—®é¢˜ã€‚</p><p><img src="https://static001.geekbang.org/infoq/c6/c602f57ea9297f50bbc265f1821d6263.png" alt=""></p><p>è€Œ JVM çš„è°ƒä¼˜ä¸»è¦å°±æ˜¯å›´ç»•å †ï¼Œæ ˆä¸¤å¤§å—è¿›è¡Œ</p><p>çº¿ç¨‹å…±äº«åŒºå°±æ˜¯çº¿ç¨‹ä¸å®‰å…¨çš„åŒºåŸŸ</p><p>æ‰§è¡Œè¿‡ç¨‹ï¼š</p><p>ç¼–è¯‘å¥½ App.java åå¾—åˆ° App.class åï¼Œæ‰§è¡Œ App.classï¼Œç³»ç»Ÿä¼šå¯åŠ¨ä¸€ä¸ª JVM è¿›ç¨‹ï¼Œä» classpath è·¯å¾„ä¸­æ‰¾åˆ°ä¸€ä¸ªåä¸º App.class çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå°† App çš„ç±»ä¿¡æ¯åŠ è½½åˆ°è¿è¡Œæ—¶æ•°æ®åŒºçš„æ–¹æ³•åŒºå†…ï¼Œè¿™ä¸ªè¿‡ç¨‹å«åš App ç±»çš„åŠ è½½</p><p>JVM æ‰¾åˆ° App çš„ä¸»ç¨‹åºå…¥å£ï¼Œæ‰§è¡Œ main æ–¹æ³•</p><p>è¿™ä¸ª main ä¸­çš„ç¬¬ä¸€æ¡è¯­å¥ä¸º Student student = new Student(â€œtellUrDreamâ€) ï¼Œå°±æ˜¯è®© JVM åˆ›å»ºä¸€ä¸ª Student å¯¹è±¡ï¼Œä½†æ˜¯è¿™ä¸ªæ—¶å€™æ–¹æ³•åŒºä¸­æ˜¯æ²¡æœ‰ Student ç±»çš„ä¿¡æ¯çš„ï¼Œæ‰€ä»¥ JVM é©¬ä¸ŠåŠ è½½ Student ç±»ï¼ŒæŠŠ Student ç±»çš„ä¿¡æ¯æ”¾åˆ°æ–¹æ³•åŒºä¸­</p><p>åŠ è½½å®Œ Student ç±»åï¼ŒJVM åœ¨å †ä¸­ä¸ºä¸€ä¸ªæ–°çš„ Student å®ä¾‹åˆ†é…å†…å­˜ï¼Œç„¶åè°ƒç”¨æ„é€ å‡½æ•°åˆå§‹åŒ– Student å®ä¾‹ï¼Œè¿™ä¸ª Student å®ä¾‹æŒæœ‰ <strong>æŒ‡å‘æ–¹æ³•åŒºä¸­çš„ Student ç±»çš„ç±»å‹ä¿¡æ¯</strong> çš„å¼•ç”¨</p><p>æ‰§è¡Œ student.sayName();æ—¶ï¼ŒJVM æ ¹æ® student çš„å¼•ç”¨æ‰¾åˆ° student å¯¹è±¡ï¼Œç„¶åæ ¹æ® student å¯¹è±¡æŒæœ‰çš„å¼•ç”¨å®šä½åˆ°æ–¹æ³•åŒºä¸­ student ç±»çš„ç±»å‹ä¿¡æ¯çš„æ–¹æ³•è¡¨ï¼Œè·å¾— sayName() çš„å­—èŠ‚ç åœ°å€ã€‚</p><p>æ‰§è¡Œ sayName()</p><p>åªéœ€è¦çŸ¥é“å¯¹è±¡å®ä¾‹åˆå§‹åŒ–æ—¶ä¼šå»<strong>æ–¹æ³•åŒºä¸­æ‰¾ç±»ä¿¡æ¯ï¼Œå®Œæˆåå†åˆ°æ ˆé‚£é‡Œå»è¿è¡Œæ–¹æ³•ã€‚æ‰¾æ–¹æ³•å°±åœ¨æ–¹æ³•è¡¨ä¸­æ‰¾ã€‚</strong></p><h1 id="ç±»åŠ è½½å™¨"><a href="#ç±»åŠ è½½å™¨" class="headerlink" title="ç±»åŠ è½½å™¨"></a>ç±»åŠ è½½å™¨</h1><p>ä¹‹å‰ä¹Ÿæåˆ°äº†å®ƒæ˜¯<strong>è´Ÿè´£åŠ è½½.class æ–‡ä»¶</strong>çš„ï¼Œå®ƒä»¬åœ¨æ–‡ä»¶å¼€å¤´ä¼šæœ‰ç‰¹å®šçš„æ–‡ä»¶æ ‡ç¤ºï¼Œ<strong>å°† class æ–‡ä»¶å­—èŠ‚ç å†…å®¹åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œå¹¶å°†è¿™äº›å†…å®¹è½¬æ¢æˆæ–¹æ³•åŒºä¸­çš„è¿è¡Œæ—¶æ•°æ®ç»“æ„ï¼Œ</strong>å¹¶ä¸” ClassLoader åªè´Ÿè´£ class æ–‡ä»¶çš„åŠ è½½ï¼Œè€Œæ˜¯å¦èƒ½å¤Ÿè¿è¡Œåˆ™ç”± Execution Engine æ¥å†³å®š</p><p>ä»ç±»è¢«åŠ è½½åˆ°è™šæ‹Ÿæœºå†…å­˜ä¸­å¼€å§‹ï¼Œåˆ°é‡Šæ”¾å†…å­˜æ€»å…±æœ‰ 7 ä¸ªæ­¥éª¤ï¼šåŠ è½½ï¼ŒéªŒè¯ï¼Œå‡†å¤‡ï¼Œè§£æï¼Œåˆå§‹åŒ–ï¼Œä½¿ç”¨ï¼Œå¸è½½ã€‚å…¶ä¸­<strong>éªŒè¯ï¼Œå‡†å¤‡ï¼Œè§£æä¸‰ä¸ªéƒ¨åˆ†ç»Ÿç§°ä¸ºè¿æ¥</strong></p><ol><li><p>å°† class æ–‡ä»¶åŠ è½½åˆ°å†…å­˜</p></li><li><p>å°†é™æ€æ•°æ®ç»“æ„è½¬åŒ–æˆæ–¹æ³•åŒºä¸­è¿è¡Œæ—¶çš„æ•°æ®ç»“æ„</p></li><li><p>åœ¨å †ä¸­ç”Ÿæˆä¸€ä¸ªä»£è¡¨è¿™ä¸ªç±»çš„ java.lang.Class å¯¹è±¡ä½œä¸ºæ•°æ®è®¿é—®çš„å…¥å£</p></li><li><p>éªŒè¯ï¼šç¡®ä¿åŠ è½½çš„ç±»ç¬¦åˆ JVM è§„èŒƒå’Œå®‰å…¨ï¼Œä¿è¯è¢«æ ¡éªŒç±»çš„æ–¹æ³•åœ¨è¿è¡Œæ—¶ä¸ä¼šåšå‡ºå±å®³è™šæ‹Ÿæœºçš„äº‹ä»¶ï¼Œ<strong>å…¶å®å°±æ˜¯ä¸€ä¸ªå®‰å…¨æ£€æŸ¥</strong></p></li><li><p>å‡†å¤‡ï¼š<strong>ä¸º static å˜é‡åœ¨æ–¹æ³•åŒºä¸­åˆ†é…å†…å­˜ç©ºé—´ï¼Œè®¾ç½®å˜é‡çš„åˆå§‹å€¼</strong>ï¼Œä¾‹å¦‚ static int a = 3 ï¼ˆæ³¨æ„ï¼šå‡†å¤‡é˜¶æ®µåªè®¾ç½®ç±»ä¸­çš„é™æ€å˜é‡ï¼ˆæ–¹æ³•åŒºä¸­ï¼‰ï¼Œä¸åŒ…æ‹¬å®ä¾‹å˜é‡ï¼ˆå †å†…å­˜ä¸­ï¼‰ï¼Œå®ä¾‹å˜é‡æ˜¯å¯¹è±¡åˆå§‹åŒ–æ—¶èµ‹å€¼çš„ï¼‰</p></li><li><p>è§£æï¼šè™šæ‹Ÿæœºå°†<strong>å¸¸é‡æ± å†…çš„ç¬¦å·å¼•ç”¨æ›¿æ¢ä¸ºç›´æ¥å¼•ç”¨çš„è¿‡ç¨‹</strong>ï¼ˆç¬¦å·å¼•ç”¨æ¯”å¦‚æˆ‘ç°åœ¨ import java.util.ArrayList è¿™å°±ç®—ç¬¦å·å¼•ç”¨ï¼Œ<strong>ç›´æ¥å¼•ç”¨å°±æ˜¯æŒ‡é’ˆæˆ–è€…å¯¹è±¡åœ°å€</strong>ï¼Œæ³¨æ„å¼•ç”¨å¯¹è±¡ä¸€å®šæ˜¯åœ¨å†…å­˜è¿›è¡Œï¼‰</p></li><li><p>åˆå§‹åŒ–å…¶å®å°±æ˜¯æ‰§è¡Œç±»æ„é€ å™¨æ–¹æ³•çš„<code>&lt;clinit&gt;()</code>çš„è¿‡ç¨‹ï¼Œè€Œä¸”è¦ä¿è¯æ‰§è¡Œå‰çˆ¶ç±»çš„<code>&lt;clinit&gt;()</code>æ–¹æ³•æ‰§è¡Œå®Œæ¯•ã€‚è¿™ä¸ªæ–¹æ³•ç”±<strong>ç¼–è¯‘å™¨æ”¶é›†</strong>ï¼Œ<strong>é¡ºåºæ‰§è¡Œæ‰€æœ‰ç±»å˜é‡ï¼ˆstatic ä¿®é¥°çš„æˆå‘˜å˜é‡ï¼‰æ˜¾å¼åˆå§‹åŒ–å’Œé™æ€ä»£ç å—ä¸­è¯­å¥</strong>ã€‚æ­¤æ—¶å‡†å¤‡é˜¶æ®µæ—¶çš„é‚£ä¸ª <code>static int a</code> ç”±é»˜è®¤åˆå§‹åŒ–çš„ 0 å˜æˆäº†æ˜¾å¼åˆå§‹åŒ–çš„ 3ã€‚ ç”±äºæ‰§è¡Œé¡ºåºç¼˜æ•…ï¼Œ<strong>åˆå§‹åŒ–é˜¶æ®µç±»å˜é‡å¦‚æœåœ¨é™æ€ä»£ç å—ä¸­åˆè¿›è¡Œäº†æ›´æ”¹ï¼Œä¼šè¦†ç›–ç±»å˜é‡çš„æ˜¾å¼åˆå§‹åŒ–ï¼Œæœ€ç»ˆå€¼ä¼šä¸ºé™æ€ä»£ç å—ä¸­çš„èµ‹å€¼ã€‚</strong></p><blockquote><p>æ³¨æ„ï¼šå­—èŠ‚ç æ–‡ä»¶ä¸­åˆå§‹åŒ–æ–¹æ³•æœ‰ä¸¤ç§ï¼Œéé™æ€èµ„æºåˆå§‹åŒ–çš„<code>&lt;init&gt;</code>å’Œé™æ€èµ„æºåˆå§‹åŒ–çš„<code>&lt;clinit&gt;</code>ï¼Œç±»æ„é€ å™¨æ–¹æ³•<code>&lt;clinit&gt;()</code>ä¸åŒäºç±»çš„æ„é€ å™¨ï¼Œè¿™äº›æ–¹æ³•éƒ½æ˜¯å­—èŠ‚ç æ–‡ä»¶ä¸­åªèƒ½ç»™ JVM è¯†åˆ«çš„ç‰¹æ®Šæ–¹æ³•ã€‚</p></blockquote></li></ol><p>8.GC å°†æ— ç”¨å¯¹è±¡ä»å†…å­˜ä¸­å¸è½½</p><h2 id="åŠ è½½é¡ºåº"><a href="#åŠ è½½é¡ºåº" class="headerlink" title="åŠ è½½é¡ºåº"></a>åŠ è½½é¡ºåº</h2><p>åŠ è½½ä¸€ä¸ª Class ç±»çš„é¡ºåºä¹Ÿæ˜¯æœ‰ä¼˜å…ˆçº§çš„ï¼Œç±»åŠ è½½å™¨ä»æœ€åº•å±‚å¼€å§‹å¾€ä¸Šçš„é¡ºåºæ˜¯è¿™æ ·çš„</p><ol><li>BootStrap ClassLoaderï¼šrt.jar</li><li>Extension ClassLoader: åŠ è½½æ‰©å±•çš„ jar åŒ…</li><li>App ClassLoaderï¼šæŒ‡å®šçš„ classpath ä¸‹é¢çš„ jar åŒ…</li><li>Custom ClassLoaderï¼šè‡ªå®šä¹‰çš„ç±»åŠ è½½å™¨</li></ol><h2 id="åŒäº²å§”æ´¾æœºåˆ¶"><a href="#åŒäº²å§”æ´¾æœºåˆ¶" class="headerlink" title="åŒäº²å§”æ´¾æœºåˆ¶"></a>åŒäº²å§”æ´¾æœºåˆ¶</h2><p>å½“ä¸€ä¸ªç±»æ”¶åˆ°äº†åŠ è½½è¯·æ±‚æ—¶ï¼Œå®ƒæ˜¯ä¸ä¼šå…ˆè‡ªå·±å»å°è¯•åŠ è½½çš„ï¼Œ<strong>è€Œæ˜¯å§”æ´¾ç»™çˆ¶ç±»å»å®Œæˆ</strong>ï¼Œæ¯”å¦‚æˆ‘ç°åœ¨è¦ new ä¸€ä¸ª Personï¼Œè¿™ä¸ª Person æ˜¯æˆ‘ä»¬è‡ªå®šä¹‰çš„ç±»ï¼Œå¦‚æœæˆ‘ä»¬è¦åŠ è½½å®ƒï¼Œå°±ä¼šå…ˆå§”æ´¾ App ClassLoader ï¼Œ<strong>åªæœ‰å½“çˆ¶ç±»åŠ è½½å™¨éƒ½åé¦ˆè‡ªå·±æ— æ³•å®Œæˆè¿™ä¸ªè¯·æ±‚ï¼ˆä¹Ÿå°±æ˜¯çˆ¶ç±»åŠ è½½å™¨éƒ½æ²¡æœ‰æ‰¾åˆ°åŠ è½½æ‰€éœ€çš„ Classï¼‰æ—¶ï¼Œå­ç±»åŠ è½½å™¨æ‰ä¼šè‡ªè¡Œå°è¯•åŠ è½½ã€‚</strong></p><p>è¿™æ ·åšçš„å¥½å¤„æ˜¯ï¼Œ<strong>åŠ è½½ä½äº rt.jar åŒ…ä¸­çš„ç±»æ—¶ä¸ç®¡æ˜¯å“ªä¸ªåŠ è½½å™¨åŠ è½½ï¼Œæœ€ç»ˆéƒ½ä¼šå§”æ‰˜åˆ° BootStrap ClassLoader</strong> è¿›è¡ŒåŠ è½½ï¼Œè¿™æ ·ä¿è¯äº†ä½¿ç”¨ä¸åŒçš„ç±»åŠ è½½å™¨å¾—åˆ°çš„éƒ½æ˜¯åŒä¸€ä¸ªç»“æœã€‚</p><p>å…¶å®è¿™ä¸ªä¹Ÿæ˜¯ä¸€ä¸ªéš”ç¦»çš„ä½œç”¨ï¼Œé¿å…äº†æˆ‘ä»¬çš„ä»£ç å½±å“äº† JDK çš„ä»£ç ï¼Œæ¯”å¦‚æˆ‘ç°åœ¨è‡ªå·±å®šä¹‰ä¸€ä¸ª <code>java.lang.String</code>ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">package java.lang;</span><br><span class="line">public class String &#123;</span><br><span class="line">    public static void main(String[] args) &#123;</span><br><span class="line">        System.out.println();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å°è¯•è¿è¡Œå½“å‰ç±»çš„ <code>main</code> å‡½æ•°çš„æ—¶å€™ï¼Œæˆ‘ä»¬çš„ä»£ç è‚¯å®šä¼šæŠ¥é”™ã€‚è¿™æ˜¯å› ä¸ºåœ¨åŠ è½½çš„æ—¶å€™å…¶å®æ˜¯æ‰¾åˆ°äº† rt.jar ä¸­çš„<code>java.lang.String</code>ï¼Œç„¶è€Œå‘ç°è¿™ä¸ªé‡Œé¢å¹¶æ²¡æœ‰ <code>main</code> æ–¹æ³•ã€‚</p><hr><h1 id="è¿è¡Œæ—¶æ•°æ®åŒº"><a href="#è¿è¡Œæ—¶æ•°æ®åŒº" class="headerlink" title="è¿è¡Œæ—¶æ•°æ®åŒº"></a>è¿è¡Œæ—¶æ•°æ®åŒº</h1><h2 id="æœ¬åœ°æ–¹æ³•æ ˆå’Œç¨‹åºè®¡æ•°å™¨"><a href="#æœ¬åœ°æ–¹æ³•æ ˆå’Œç¨‹åºè®¡æ•°å™¨" class="headerlink" title="æœ¬åœ°æ–¹æ³•æ ˆå’Œç¨‹åºè®¡æ•°å™¨"></a>æœ¬åœ°æ–¹æ³•æ ˆå’Œç¨‹åºè®¡æ•°å™¨</h2><p>æ¯”å¦‚è¯´æˆ‘ä»¬ç°åœ¨ç‚¹å¼€ Thread ç±»çš„æºç ï¼Œä¼šçœ‹åˆ°å®ƒçš„ start0 æ–¹æ³•å¸¦æœ‰ä¸€ä¸ª native å…³é”®å­—ä¿®é¥°ï¼Œè€Œä¸”ä¸å­˜åœ¨æ–¹æ³•ä½“ï¼Œ<strong>è¿™ç§ç”¨ native ä¿®é¥°çš„æ–¹æ³•å°±æ˜¯æœ¬åœ°æ–¹æ³•</strong>ï¼Œè¿™æ˜¯ä½¿ç”¨ C æ¥å®ç°çš„ï¼Œ<strong>ç„¶åä¸€èˆ¬è¿™äº›æ–¹æ³•éƒ½ä¼šæ”¾åˆ°ä¸€ä¸ªå«åšæœ¬åœ°æ–¹æ³•æ ˆçš„åŒºåŸŸã€‚</strong></p><p>ç¨‹åºè®¡æ•°å™¨å…¶å®å°±æ˜¯<strong>ä¸€ä¸ªæŒ‡é’ˆ</strong>ï¼Œå®ƒæŒ‡å‘äº†<strong>æˆ‘ä»¬ç¨‹åºä¸­ä¸‹ä¸€å¥éœ€è¦æ‰§è¡Œçš„æŒ‡ä»¤</strong>ï¼Œ<strong>å®ƒä¹Ÿæ˜¯å†…å­˜åŒºåŸŸä¸­å”¯ä¸€ä¸€ä¸ªä¸ä¼šå‡ºç° OutOfMemoryError çš„åŒºåŸŸï¼Œè€Œä¸”å ç”¨å†…å­˜ç©ºé—´å°åˆ°åŸºæœ¬å¯ä»¥å¿½ç•¥ä¸è®¡ã€‚</strong>è¿™ä¸ªå†…å­˜ä»…ä»£è¡¨<strong>å½“å‰çº¿ç¨‹æ‰€æ‰§è¡Œçš„å­—èŠ‚ç çš„è¡Œå·æŒ‡ç¤ºå™¨</strong>ï¼Œå­—èŠ‚ç è§£æå™¨é€šè¿‡<strong>æ”¹å˜è¿™ä¸ªè®¡æ•°å™¨çš„å€¼é€‰å–ä¸‹ä¸€æ¡éœ€è¦æ‰§è¡Œçš„å­—èŠ‚ç æŒ‡ä»¤ã€‚</strong></p><p>å¦‚æœæ‰§è¡Œçš„æ˜¯ native æ–¹æ³•ï¼Œé‚£è¿™ä¸ªæŒ‡é’ˆå°±ä¸å·¥ä½œäº†ã€‚</p><h2 id="æ–¹æ³•åŒº"><a href="#æ–¹æ³•åŒº" class="headerlink" title="æ–¹æ³•åŒº"></a>æ–¹æ³•åŒº</h2><p>æ–¹æ³•åŒºä¸»è¦çš„ä½œç”¨æ˜¯<strong>å­˜æ”¾ç±»çš„å…ƒæ•°æ®ä¿¡æ¯</strong>ï¼Œå¸¸é‡å’Œé™æ€å˜é‡Â·Â·Â·ç­‰ã€‚å½“å®ƒå­˜å‚¨çš„ä¿¡æ¯è¿‡å¤§æ—¶ï¼Œä¼šåœ¨æ— æ³•æ»¡è¶³å†…å­˜åˆ†é…æ—¶æŠ¥é”™ã€‚</p><h2 id="è™šæ‹Ÿæœºæ ˆå’Œè™šæ‹Ÿæœºå †"><a href="#è™šæ‹Ÿæœºæ ˆå’Œè™šæ‹Ÿæœºå †" class="headerlink" title="è™šæ‹Ÿæœºæ ˆå’Œè™šæ‹Ÿæœºå †"></a>è™šæ‹Ÿæœºæ ˆå’Œè™šæ‹Ÿæœºå †</h2><p>ä¸€å¥è¯ä¾¿æ˜¯ï¼š<strong>æ ˆç®¡è¿è¡Œï¼Œå †ç®¡å­˜å‚¨</strong>ã€‚åˆ™è™šæ‹Ÿæœºæ ˆè´Ÿè´£è¿è¡Œä»£ç ï¼Œè€Œè™šæ‹Ÿæœºå †è´Ÿè´£å­˜å‚¨æ•°æ®ã€‚</p><h3 id="æ ˆ"><a href="#æ ˆ" class="headerlink" title="æ ˆ"></a>æ ˆ</h3><p>å®ƒæ˜¯ Java æ–¹æ³•æ‰§è¡Œçš„<strong>å†…å­˜æ¨¡å‹</strong>ã€‚é‡Œé¢ä¼šå¯¹<strong>å±€éƒ¨å˜é‡ï¼ŒåŠ¨æ€é“¾è¡¨ï¼Œæ–¹æ³•å‡ºå£ï¼Œæ ˆçš„æ“ä½œï¼ˆå…¥æ ˆå’Œå‡ºæ ˆï¼‰è¿›è¡Œå­˜å‚¨ï¼Œä¸”çº¿ç¨‹ç‹¬äº«ã€‚</strong>åŒæ—¶å¦‚æœæˆ‘ä»¬å¬åˆ°å±€éƒ¨å˜é‡è¡¨ï¼Œé‚£ä¹Ÿæ˜¯åœ¨è¯´è™šæ‹Ÿæœºæ ˆ</p><p>å¦‚æœçº¿ç¨‹è¯·æ±‚çš„<strong>æ ˆçš„æ·±åº¦å¤§äºè™šæ‹Ÿæœºæ ˆçš„æœ€å¤§æ·±åº¦</strong>ï¼Œå°±ä¼šæŠ¥ <strong>StackOverflowError</strong> ï¼ˆè¿™ç§é”™è¯¯ç»å¸¸å‡ºç°åœ¨é€’å½’ä¸­ï¼‰ã€‚Java è™šæ‹Ÿæœºä¹Ÿå¯ä»¥åŠ¨æ€æ‰©å±•ï¼Œä½†éšç€æ‰©å±•ä¼šä¸æ–­åœ°ç”³è¯·å†…å­˜ï¼Œå½“æ— æ³•ç”³è¯·è¶³å¤Ÿå†…å­˜æ—¶å°±ä¼šæŠ¥é”™ <strong>OutOfMemoryError</strong>ã€‚</p><p>å¯¹äºæ ˆæ¥è¯´ï¼Œä¸å­˜åœ¨åƒåœ¾å›æ”¶ã€‚åªè¦ç¨‹åºè¿è¡Œç»“æŸï¼Œæ ˆçš„ç©ºé—´è‡ªç„¶å°±ä¼šé‡Šæ”¾äº†ã€‚æ ˆçš„ç”Ÿå‘½å‘¨æœŸå’Œæ‰€å¤„çš„çº¿ç¨‹æ˜¯ä¸€è‡´çš„ã€‚</p><p>è¿™é‡Œè¡¥å……ä¸€å¥ï¼š8 ç§åŸºæœ¬ç±»å‹çš„å˜é‡+å¯¹è±¡çš„å¼•ç”¨å˜é‡+å®ä¾‹æ–¹æ³•éƒ½æ˜¯åœ¨æ ˆé‡Œé¢åˆ†é…å†…å­˜ã€‚</p><p>æˆ‘ä»¬ç»å¸¸è¯´çš„æ ˆå¸§æ•°æ®ï¼Œè¯´ç™½äº†åœ¨ JVM ä¸­å«æ ˆå¸§ï¼Œ<strong>æ”¾åˆ° Java ä¸­å…¶å®å°±æ˜¯æ–¹æ³•</strong>ï¼Œå®ƒä¹Ÿæ˜¯å­˜æ”¾åœ¨æ ˆä¸­çš„ã€‚</p><p>æ ˆä¸­çš„<strong>æ•°æ®éƒ½æ˜¯ä»¥æ ˆå¸§</strong>çš„æ ¼å¼å­˜åœ¨ï¼Œå®ƒæ˜¯ä¸€ä¸ªå…³äºæ–¹æ³•å’Œè¿è¡ŒæœŸæ•°æ®çš„æ•°æ®é›†ã€‚æ¯”å¦‚æˆ‘ä»¬æ‰§è¡Œä¸€ä¸ªæ–¹æ³• aï¼Œå°±ä¼šå¯¹åº”äº§ç”Ÿä¸€ä¸ªæ ˆå¸§ A1ï¼Œç„¶å A1 ä¼šè¢«å‹å…¥æ ˆä¸­ã€‚åŒç†æ–¹æ³• b ä¼šæœ‰ä¸€ä¸ª B1ï¼Œæ–¹æ³• c ä¼šæœ‰ä¸€ä¸ª C1ï¼Œç­‰åˆ°è¿™ä¸ªçº¿ç¨‹æ‰§è¡Œå®Œæ¯•åï¼Œæ ˆä¼šå…ˆå¼¹å‡º C1ï¼Œå B1,A1ã€‚<strong>å®ƒæ˜¯ä¸€ä¸ªå…ˆè¿›åå‡ºï¼Œåè¿›å…ˆå‡ºåŸåˆ™ã€‚</strong></p><p>å±€éƒ¨å˜é‡è¡¨ç”¨äºå­˜æ”¾<strong>æ–¹æ³•å‚æ•°å’Œæ–¹æ³•å†…éƒ¨æ‰€å®šä¹‰çš„å±€éƒ¨å˜é‡</strong>ã€‚å®ƒçš„å®¹é‡æ˜¯ä»¥ Slot ä¸ºæœ€å°å•ä½ï¼Œ<strong>ä¸€ä¸ª slot å¯ä»¥å­˜æ”¾ 32 ä½ä»¥å†…çš„æ•°æ®ç±»å‹</strong>ã€‚</p><p>è™šæ‹Ÿæœºé€šè¿‡<strong>ç´¢å¼•å®šä½</strong>çš„æ–¹å¼ä½¿ç”¨å±€éƒ¨å˜é‡è¡¨ï¼ŒèŒƒå›´ä¸º <code>[0,å±€éƒ¨å˜é‡è¡¨çš„ slot çš„æ•°é‡]</code>ã€‚æ–¹æ³•ä¸­çš„å‚æ•°å°±ä¼šæŒ‰ä¸€å®šé¡ºåºæ’åˆ—åœ¨è¿™ä¸ªå±€éƒ¨å˜é‡è¡¨ä¸­ï¼Œè‡³äºæ€ä¹ˆæ’çš„æˆ‘ä»¬å¯ä»¥å…ˆä¸å…³å¿ƒã€‚è€Œä¸ºäº†èŠ‚çœæ ˆå¸§ç©ºé—´ï¼Œ<strong>è¿™äº› slot æ˜¯å¯ä»¥å¤ç”¨çš„</strong>ï¼Œ<strong>å½“æ–¹æ³•æ‰§è¡Œä½ç½®è¶…è¿‡äº†æŸä¸ªå˜é‡ï¼Œé‚£ä¹ˆè¿™ä¸ªå˜é‡çš„ slot å¯ä»¥è¢«å…¶å®ƒå˜é‡å¤ç”¨ã€‚</strong>å½“ç„¶å¦‚æœéœ€è¦å¤ç”¨ï¼Œé‚£æˆ‘ä»¬çš„åƒåœ¾å›æ”¶è‡ªç„¶å°±ä¸ä¼šå»åŠ¨è¿™äº›å†…å­˜ã€‚</p><h3 id="å †"><a href="#å †" class="headerlink" title="å †"></a>å †</h3><p>JVM å†…å­˜ä¼šåˆ’åˆ†ä¸ºå †å†…å­˜å’Œéå †å†…å­˜ï¼Œå †å†…å­˜ä¸­ä¹Ÿä¼šåˆ’åˆ†ä¸º<strong>å¹´è½»ä»£</strong>å’Œ<strong>è€å¹´ä»£</strong>ï¼Œè€Œéå †å†…å­˜åˆ™ä¸º<strong>æ°¸ä¹…ä»£</strong>ã€‚å¹´è½»ä»£åˆä¼šåˆ†ä¸º<strong>Eden</strong>å’Œ<strong>Survivor</strong>åŒºã€‚Survivor ä¹Ÿä¼šåˆ†ä¸º<strong>FromPlace</strong>å’Œ<strong>ToPlace</strong>ï¼ŒtoPlace çš„ survivor åŒºåŸŸæ˜¯ç©ºçš„ã€‚Edenï¼ŒFromPlace å’Œ ToPlace çš„é»˜è®¤å æ¯”ä¸º <strong>8:1:1</strong>ã€‚å½“ç„¶è¿™ä¸ªä¸œè¥¿å…¶å®ä¹Ÿå¯ä»¥é€šè¿‡ä¸€ä¸ª <strong>-XX:+UsePSAdaptiveSurvivorSizePolicy</strong> å‚æ•°æ¥æ ¹æ®ç”Ÿæˆå¯¹è±¡çš„é€Ÿç‡åŠ¨æ€è°ƒæ•´</p><p>å †å†…å­˜ä¸­å­˜æ”¾çš„æ˜¯å¯¹è±¡ï¼Œåƒåœ¾æ”¶é›†å°±æ˜¯æ”¶é›†è¿™äº›å¯¹è±¡ç„¶åäº¤ç»™ GC ç®—æ³•è¿›è¡Œå›æ”¶ã€‚<strong>éå †å†…å­˜å…¶å®æˆ‘ä»¬å·²ç»è¯´è¿‡äº†ï¼Œå°±æ˜¯æ–¹æ³•åŒº</strong>ã€‚åœ¨ 1.8 ä¸­å·²ç»ç§»é™¤æ°¸ä¹…ä»£ï¼Œ<strong>æ›¿ä»£å“æ˜¯ä¸€ä¸ªå…ƒç©ºé—´(MetaSpace)ï¼Œæœ€å¤§åŒºåˆ«æ˜¯ metaSpace æ˜¯ä¸å­˜åœ¨äº JVM ä¸­çš„ï¼Œå®ƒä½¿ç”¨çš„æ˜¯æœ¬åœ°å†…å­˜ã€‚å¹¶æœ‰ä¸¤ä¸ªå‚æ•°</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">MetaspaceSizeï¼šåˆå§‹åŒ–å…ƒç©ºé—´å¤§å°ï¼Œæ§åˆ¶å‘ç”ŸGC</span><br><span class="line">MaxMetaspaceSizeï¼šé™åˆ¶å…ƒç©ºé—´å¤§å°ä¸Šé™ï¼Œé˜²æ­¢å ç”¨è¿‡å¤šç‰©ç†å†…å­˜ã€‚</span><br></pre></td></tr></table></figure><p>ç§»é™¤çš„åŸå› å¯ä»¥å¤§è‡´äº†è§£ä¸€ä¸‹ï¼šèåˆ HotSpot JVM å’Œ JRockit VM è€Œåšå‡ºçš„æ”¹å˜ï¼Œå› ä¸º JRockit æ˜¯æ²¡æœ‰æ°¸ä¹…ä»£çš„ï¼Œä¸è¿‡è¿™ä¹Ÿé—´æ¥æ€§åœ°è§£å†³äº†æ°¸ä¹…ä»£çš„ OOM é—®é¢˜ã€‚</p><p><strong>å¹´è½»ä»£ï¼šï¼šï¼šï¼š</strong></p><p>å½“æˆ‘ä»¬ new ä¸€ä¸ªå¯¹è±¡åï¼Œä¼šå…ˆæ”¾åˆ° Eden åˆ’åˆ†å‡ºæ¥çš„<strong>ä¸€å—ä½œä¸ºå­˜å‚¨ç©ºé—´çš„å†…å­˜ï¼Œ</strong>ä½†æ˜¯æˆ‘ä»¬çŸ¥é“å¯¹å †å†…å­˜æ˜¯çº¿ç¨‹å…±äº«çš„ï¼Œ<strong>æ‰€ä»¥æœ‰å¯èƒ½ä¼šå‡ºç°ä¸¤ä¸ªå¯¹è±¡å…±ç”¨ä¸€ä¸ªå†…å­˜çš„æƒ…å†µ</strong>ã€‚è¿™é‡Œ JVM çš„å¤„ç†æ˜¯<strong>ä¸ºæ¯ä¸ªçº¿ç¨‹éƒ½é¢„å…ˆç”³è¯·å¥½ä¸€å—è¿ç»­çš„å†…å­˜ç©ºé—´å¹¶è§„å®šäº†å¯¹è±¡å­˜æ”¾çš„ä½ç½®ï¼Œè€Œå¦‚æœç©ºé—´ä¸è¶³ä¼šå†ç”³è¯·å¤šå—å†…å­˜ç©ºé—´ã€‚è¿™ä¸ªæ“ä½œæˆ‘ä»¬ä¼šç§°ä½œ TLABï¼Œ</strong>æœ‰å…´è¶£å¯ä»¥äº†è§£ä¸€ä¸‹</p><p>ä¿®æ­£ï¼šå½“ Eden åŒºå†…å­˜ç©ºé—´æ»¡äº†çš„æ—¶å€™ï¼Œå°±ä¼šè§¦å‘ <strong>Minor GC</strong>ï¼ŒSurvivor0 åŒºæ»¡ä¸ä¼šè§¦å‘ Minor GC ã€‚</p><p><strong>é‚£ Survivor0 åŒº çš„å¯¹è±¡ä»€ä¹ˆæ—¶å€™åƒåœ¾å›æ”¶å‘¢ï¼Ÿ</strong></p><p>å‡è®¾ Survivor0 åŒºç°åœ¨æ˜¯æ»¡çš„ï¼Œæ­¤æ—¶åˆè§¦å‘äº† Minor GC ï¼Œå‘ç° Survivor0 åŒºä¾æ—§æ˜¯æ»¡çš„ï¼Œå­˜ä¸ä¸‹ï¼Œ<strong>æ­¤æ—¶ä¼šå°† S0 åŒºä¸ Eden åŒºçš„å¯¹è±¡ä¸€èµ·è¿›è¡Œå¯è¾¾æ€§åˆ†æï¼Œæ‰¾å‡ºæ´»è·ƒçš„å¯¹è±¡ï¼Œå°†å®ƒå¤åˆ¶åˆ° S1 åŒºå¹¶ä¸”å°† S0 åŒºåŸŸå’Œ Eden åŒºçš„å¯¹è±¡ç»™æ¸…ç©ºï¼Œè¿™æ ·é‚£äº›ä¸å¯è¾¾çš„å¯¹è±¡è¿›è¡Œæ¸…é™¤ï¼Œå¹¶ä¸”å°† S0 åŒº å’Œ S1 åŒºäº¤æ¢</strong></p><p><strong>è€å¹´ä»£</strong>ï¼šï¼šï¼šï¼šï¼š</p><p>è€å¹´ä»£æ˜¯<strong>å­˜å‚¨é•¿æœŸå­˜æ´»çš„å¯¹è±¡</strong>çš„ï¼Œå æ»¡æ—¶å°±ä¼šè§¦å‘æˆ‘ä»¬æœ€å¸¸å¬è¯´çš„ <strong>Full GC</strong>ï¼Œ<strong>æœŸé—´ä¼šåœæ­¢æ‰€æœ‰çº¿ç¨‹ç­‰å¾… GC çš„å®Œæˆ</strong>ã€‚æ‰€ä»¥å¯¹äºå“åº”è¦æ±‚é«˜çš„åº”ç”¨åº”è¯¥å°½é‡å»å‡å°‘å‘ç”Ÿ Full GC ä»è€Œé¿å…å“åº”è¶…æ—¶çš„é—®é¢˜ã€‚</p><p><strong>è€Œä¸”å½“è€å¹´åŒºæ‰§è¡Œäº† full gc ä¹‹åä»ç„¶æ— æ³•è¿›è¡Œå¯¹è±¡ä¿å­˜çš„æ“ä½œï¼Œå°±ä¼šäº§ç”Ÿ OOM</strong>ï¼Œè¿™æ—¶å€™å°±æ˜¯<strong>è™šæ‹Ÿæœºä¸­çš„å †å†…å­˜ä¸è¶³</strong>ï¼ŒåŸå› å¯èƒ½ä¼šæ˜¯å †å†…å­˜è®¾ç½®çš„<strong>å¤§å°è¿‡å°</strong>ï¼Œè¿™ä¸ªå¯ä»¥é€šè¿‡å‚æ•°-Xmsã€-Xmx æ¥è°ƒæ•´ã€‚<strong>ä¹Ÿå¯èƒ½æ˜¯ä»£ç ä¸­åˆ›å»ºçš„å¯¹è±¡å¤§ä¸”å¤šï¼Œè€Œä¸”å®ƒä»¬ä¸€ç›´åœ¨è¢«å¼•ç”¨ä»è€Œé•¿æ—¶é—´åƒåœ¾æ”¶é›†æ— æ³•æ”¶é›†å®ƒä»¬ã€‚</strong></p><p><img src="https://static001.geekbang.org/infoq/39/398255141fde8ba208f6c99f4edaa9fe.png" alt=""></p><p><strong>å›æ”¶ï¼šï¼šï¼šï¼š</strong></p><p><img src="https://static001.geekbang.org/infoq/1b/1ba7f3cff6e07c6e9c6765cc4ef74997.png" alt=""></p><p>å›¾ä¸­ç¨‹åºè®¡æ•°å™¨ã€è™šæ‹Ÿæœºæ ˆã€æœ¬åœ°æ–¹æ³•æ ˆï¼Œ3 ä¸ªåŒºåŸŸéšç€çº¿ç¨‹çš„ç”Ÿå­˜è€Œç”Ÿå­˜çš„ã€‚å†…å­˜åˆ†é…å’Œå›æ”¶éƒ½æ˜¯ç¡®å®šçš„ã€‚éšç€çº¿ç¨‹çš„ç»“æŸå†…å­˜è‡ªç„¶å°±è¢«å›æ”¶äº†ï¼Œå› æ­¤ä¸éœ€è¦è€ƒè™‘åƒåœ¾å›æ”¶çš„é—®é¢˜ã€‚è€Œ Java å †å’Œæ–¹æ³•åŒºåˆ™ä¸ä¸€æ ·ï¼Œå„çº¿ç¨‹å…±äº«ï¼Œå†…å­˜çš„åˆ†é…å’Œå›æ”¶éƒ½æ˜¯åŠ¨æ€çš„ã€‚å› æ­¤åƒåœ¾æ”¶é›†å™¨æ‰€å…³æ³¨çš„éƒ½æ˜¯å †å’Œæ–¹æ³•è¿™éƒ¨åˆ†å†…å­˜ã€‚</p><p>åœ¨è¿›è¡Œå›æ”¶å‰å°±è¦åˆ¤æ–­å“ªäº›å¯¹è±¡è¿˜å­˜æ´»ï¼Œå“ªäº›å·²ç»æ­»å»ã€‚ä¸‹é¢ä»‹ç»ä¸¤ä¸ªåŸºç¡€çš„è®¡ç®—æ–¹æ³•</p><p>1.å¼•ç”¨è®¡æ•°å™¨è®¡ç®—ï¼šç»™å¯¹è±¡æ·»åŠ ä¸€ä¸ªå¼•ç”¨è®¡æ•°å™¨ï¼Œæ¯æ¬¡å¼•ç”¨è¿™ä¸ªå¯¹è±¡æ—¶è®¡æ•°å™¨åŠ ä¸€ï¼Œå¼•ç”¨å¤±æ•ˆæ—¶å‡ä¸€ï¼Œ<strong>è®¡æ•°å™¨ç­‰äº 0 æ—¶å°±æ˜¯ä¸ä¼šå†æ¬¡ä½¿ç”¨çš„ã€‚ä¸è¿‡è¿™ä¸ªæ–¹æ³•æœ‰ä¸€ç§æƒ…å†µå°±æ˜¯å‡ºç°å¯¹è±¡çš„å¾ªç¯å¼•ç”¨æ—¶ GC æ²¡æ³•å›æ”¶ã€‚</strong></p><p>2.å¯è¾¾æ€§åˆ†æè®¡ç®—ï¼šè¿™æ˜¯ä¸€ç§ç±»ä¼¼äºäºŒå‰æ ‘çš„å®ç°ï¼Œå°†ä¸€ç³»åˆ—çš„ <strong>GC ROOTS</strong> ä½œä¸ºèµ·å§‹çš„å­˜æ´»å¯¹è±¡é›†ï¼Œ<strong>ä»è¿™ä¸ªèŠ‚ç‚¹å¾€ä¸‹æœç´¢ï¼Œæœç´¢æ‰€èµ°è¿‡çš„è·¯å¾„æˆä¸ºå¼•ç”¨é“¾ï¼ŒæŠŠèƒ½è¢«è¯¥é›†åˆå¼•ç”¨åˆ°çš„å¯¹è±¡åŠ å…¥åˆ°é›†åˆä¸­ã€‚æœç´¢å½“ä¸€ä¸ªå¯¹è±¡åˆ° GC Roots æ²¡æœ‰ä½¿ç”¨ä»»ä½•å¼•ç”¨é“¾æ—¶ï¼Œåˆ™è¯´æ˜è¯¥å¯¹è±¡æ˜¯ä¸å¯ç”¨çš„ã€‚ä¸»æµçš„å•†ç”¨ç¨‹åºè¯­è¨€</strong>ï¼Œä¾‹å¦‚ Javaï¼ŒC#ç­‰éƒ½æ˜¯é è¿™æ‹›å»åˆ¤å®šå¯¹è±¡æ˜¯å¦å­˜æ´»çš„ã€‚</p><p>3.<strong>ç»ˆç»“å™¨</strong>ï¼ˆFinalizerï¼‰ï¼šå¦‚æœå¯¹è±¡é‡å†™äº†<code>finalize()</code>æ–¹æ³•ï¼Œåƒåœ¾å›æ”¶å™¨ä¼šåœ¨å›æ”¶è¯¥å¯¹è±¡ä¹‹å‰è°ƒç”¨<code>finalize()</code>æ–¹æ³•ï¼Œå¯¹è±¡å¯ä»¥åœ¨<code>finalize()</code>æ–¹æ³•ä¸­è¿›è¡Œä¸€äº›æ¸…ç†æ“ä½œã€‚ç„¶è€Œï¼Œç»ˆç»“å™¨æœºåˆ¶çš„ä½¿ç”¨ä¸è¢«æ¨èï¼Œå› ä¸ºå®ƒçš„æ‰§è¡Œæ—¶é—´æ˜¯ä¸ç¡®å®šçš„ï¼Œå¯èƒ½ä¼šå¯¼è‡´ä¸å¯é¢„æµ‹çš„æ€§èƒ½é—®é¢˜ã€‚è¿™ä¸ªç±»ä¼¼äºtry-catch-finallyä¸­çš„finally</p><p>ä¸€ä¸ªå¯¹è±¡çš„ finalize()æ–¹æ³•åªä¼šè¢«<strong>ç³»ç»Ÿè‡ªåŠ¨è°ƒç”¨ä¸€æ¬¡</strong>ï¼Œç»è¿‡ finalize()æ–¹æ³•é€ƒè„±æ­»äº¡çš„å¯¹è±¡ï¼Œç¬¬äºŒæ¬¡ä¸ä¼šå†è°ƒç”¨ã€‚</p><p>è¡¥å……ä¸€å¥ï¼šå¹¶ä¸æå€¡åœ¨ç¨‹åºä¸­è°ƒç”¨ finalize()æ¥è¿›è¡Œè‡ªæ•‘ã€‚<strong>å»ºè®®å¿˜æ‰ Java ç¨‹åºä¸­è¯¥æ–¹æ³•çš„å­˜åœ¨ã€‚</strong>å› ä¸ºå®ƒæ‰§è¡Œçš„æ—¶é—´ä¸ç¡®å®šï¼Œç”šè‡³æ˜¯å¦è¢«æ‰§è¡Œä¹Ÿä¸ç¡®å®šï¼ˆJava ç¨‹åºçš„ä¸æ­£å¸¸é€€å‡ºï¼‰ï¼Œè€Œä¸”è¿è¡Œä»£ä»·é«˜æ˜‚ï¼Œæ— æ³•ä¿è¯å„ä¸ªå¯¹è±¡çš„è°ƒç”¨é¡ºåºï¼ˆç”šè‡³æœ‰ä¸åŒçº¿ç¨‹ä¸­è°ƒç”¨ï¼‰ã€‚åœ¨ Java9 ä¸­å·²ç»è¢«æ ‡è®°ä¸º <strong>deprecated</strong> ï¼Œä¸” <code>java.lang.ref.Cleaner</code>ï¼ˆä¹Ÿå°±æ˜¯å¼ºã€è½¯ã€å¼±ã€å¹»è±¡å¼•ç”¨çš„é‚£ä¸€å¥—ï¼‰ä¸­å·²ç»é€æ­¥æ›¿æ¢æ‰å®ƒï¼Œä¼šæ¯” <code>finalize</code> æ¥çš„æ›´åŠ çš„è½»é‡åŠå¯é ã€‚</p><hr><p>åœ¨ Java è¯­è¨€æ±‡æ€»èƒ½ä½œä¸º GC Roots çš„å¯¹è±¡åˆ†ä¸ºä»¥ä¸‹å‡ ç§ï¼š</p><ol><li>è™šæ‹Ÿæœºæ ˆï¼ˆæ ˆå¸§ä¸­çš„æœ¬åœ°æ–¹æ³•è¡¨ï¼‰ä¸­å¼•ç”¨çš„å¯¹è±¡ï¼ˆ<strong>å±€éƒ¨å˜é‡</strong>ï¼‰</li><li>æ–¹æ³•åŒºä¸­é™æ€å˜é‡æ‰€å¼•ç”¨çš„å¯¹è±¡ï¼ˆ<strong>é™æ€å˜é‡</strong>ï¼‰</li><li>æ–¹æ³•åŒºä¸­<strong>å¸¸é‡å¼•ç”¨çš„å¯¹è±¡</strong></li><li><strong>æœ¬åœ°æ–¹æ³•æ ˆï¼ˆå³ native ä¿®é¥°çš„æ–¹æ³•ï¼‰ä¸­ JNI å¼•ç”¨çš„å¯¹è±¡</strong>ï¼ˆJNI æ˜¯ Java è™šæ‹Ÿæœºè°ƒç”¨å¯¹åº”çš„ C å‡½æ•°çš„æ–¹å¼ï¼Œé€šè¿‡ JNI å‡½æ•°ä¹Ÿå¯ä»¥åˆ›å»ºæ–°çš„ Java å¯¹è±¡ã€‚ä¸” JNI å¯¹äºå¯¹è±¡çš„å±€éƒ¨å¼•ç”¨æˆ–è€…å…¨å±€å¼•ç”¨éƒ½ä¼šæŠŠå®ƒä»¬æŒ‡å‘çš„å¯¹è±¡éƒ½æ ‡è®°ä¸ºä¸å¯å›æ”¶ï¼‰</li><li>å·²å¯åŠ¨çš„ä¸”æœªç»ˆæ­¢çš„ Java çº¿ç¨‹</li></ol><p>è¿™ç§æ–¹æ³•çš„ä¼˜ç‚¹æ˜¯èƒ½å¤Ÿ<strong>è§£å†³å¾ªç¯å¼•ç”¨çš„é—®é¢˜</strong>ï¼Œå¯å®ƒçš„å®ç°éœ€è¦è€—è´¹å¤§é‡èµ„æºå’Œæ—¶é—´ï¼Œä¹Ÿéœ€è¦ GCï¼ˆå®ƒçš„åˆ†æè¿‡ç¨‹å¼•ç”¨å…³ç³»ä¸èƒ½å‘ç”Ÿå˜åŒ–ï¼Œæ‰€ä»¥éœ€è¦åœæ­¢æ‰€æœ‰è¿›ç¨‹ï¼‰</p><p>åˆ¤æ–­ä¸€ä¸ªå¯¹è±¡çš„æ­»äº¡è‡³å°‘éœ€è¦ä¸¤æ¬¡æ ‡è®°</p><ol><li>å¦‚æœ<strong>å¯¹è±¡è¿›è¡Œå¯è¾¾æ€§åˆ†æä¹‹åæ²¡å‘ç°ä¸ GC Roots ç›¸è¿çš„å¼•ç”¨é“¾</strong>ï¼Œé‚£å®ƒå°†ä¼šç¬¬ä¸€æ¬¡æ ‡è®°å¹¶ä¸”è¿›è¡Œä¸€æ¬¡ç­›é€‰ã€‚åˆ¤æ–­çš„æ¡ä»¶æ˜¯å†³å®šè¿™ä¸ªå¯¹è±¡æ˜¯å¦æœ‰å¿…è¦æ‰§è¡Œ finalize()æ–¹æ³•ã€‚<strong>å¦‚æœå¯¹è±¡æœ‰å¿…è¦æ‰§è¡Œ finalize()æ–¹æ³•ï¼Œåˆ™è¢«æ”¾å…¥ F-Queue é˜Ÿåˆ—ä¸­ã€‚</strong></li><li>GC å¯¹ F-Queue é˜Ÿåˆ—ä¸­çš„å¯¹è±¡è¿›è¡ŒäºŒæ¬¡æ ‡è®°ã€‚<strong>å¦‚æœå¯¹è±¡åœ¨ finalize()æ–¹æ³•ä¸­é‡æ–°ä¸å¼•ç”¨é“¾ä¸Šçš„ä»»ä½•ä¸€ä¸ªå¯¹è±¡å»ºç«‹äº†å…³è”ï¼Œé‚£ä¹ˆäºŒæ¬¡æ ‡è®°æ—¶åˆ™ä¼šå°†å®ƒç§»å‡ºâ€œå³å°†å›æ”¶â€é›†åˆã€‚å¦‚æœæ­¤æ—¶å¯¹è±¡è¿˜æ²¡æˆåŠŸé€ƒè„±ï¼Œé‚£ä¹ˆåªèƒ½è¢«å›æ”¶äº†ã€‚</strong></li></ol><p>å¦‚æœç¡®å®šå¯¹è±¡å·²ç»æ­»äº¡ï¼Œæˆ‘ä»¬åˆè¯¥å¦‚ä½•å›æ”¶è¿™äº›åƒåœ¾å‘¢</p><hr><h1 id="åƒåœ¾å›æ”¶ç®—æ³•ï¼ˆGCï¼‰"><a href="#åƒåœ¾å›æ”¶ç®—æ³•ï¼ˆGCï¼‰" class="headerlink" title="åƒåœ¾å›æ”¶ç®—æ³•ï¼ˆGCï¼‰"></a>åƒåœ¾å›æ”¶ç®—æ³•ï¼ˆGCï¼‰</h1><h2 id="å †ç©ºé—´çš„åŸºæœ¬ç»“æ„"><a href="#å †ç©ºé—´çš„åŸºæœ¬ç»“æ„" class="headerlink" title="å †ç©ºé—´çš„åŸºæœ¬ç»“æ„"></a>å †ç©ºé—´çš„åŸºæœ¬ç»“æ„</h2><p>Java çš„è‡ªåŠ¨å†…å­˜ç®¡ç†ä¸»è¦æ˜¯é’ˆå¯¹å¯¹è±¡å†…å­˜çš„å›æ”¶å’Œå¯¹è±¡å†…å­˜çš„åˆ†é…ã€‚åŒæ—¶ï¼ŒJava è‡ªåŠ¨å†…å­˜ç®¡ç†æœ€æ ¸å¿ƒçš„åŠŸèƒ½æ˜¯ <strong>å †</strong> å†…å­˜ä¸­å¯¹è±¡çš„åˆ†é…ä¸å›æ”¶ã€‚</p><p>Java å †æ˜¯åƒåœ¾æ”¶é›†å™¨ç®¡ç†çš„ä¸»è¦åŒºåŸŸï¼Œå› æ­¤ä¹Ÿè¢«ç§°ä½œ <strong>GC å †ï¼ˆGarbage Collected Heapï¼‰</strong>ã€‚</p><p>ä»åƒåœ¾å›æ”¶çš„è§’åº¦æ¥è¯´ï¼Œç”±äºç°åœ¨æ”¶é›†å™¨åŸºæœ¬éƒ½é‡‡ç”¨åˆ†ä»£åƒåœ¾æ”¶é›†ç®—æ³•ï¼Œæ‰€ä»¥ Java å †è¢«åˆ’åˆ†ä¸ºäº†å‡ ä¸ªä¸åŒçš„åŒºåŸŸï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥æ ¹æ®å„ä¸ªåŒºåŸŸçš„ç‰¹ç‚¹é€‰æ‹©åˆé€‚çš„åƒåœ¾æ”¶é›†ç®—æ³•ã€‚</p><p>åœ¨ JDK 7 ç‰ˆæœ¬åŠ JDK 7 ç‰ˆæœ¬ä¹‹å‰ï¼Œå †å†…å­˜è¢«é€šå¸¸åˆ†ä¸ºä¸‹é¢ä¸‰éƒ¨åˆ†ï¼š</p><ol><li>æ–°ç”Ÿä»£å†…å­˜(Young Generation)</li><li>è€ç”Ÿä»£(Old Generation)</li><li>æ°¸ä¹…ä»£(Permanent Generation)</li></ol><p>ä¸‹å›¾æ‰€ç¤ºçš„ Eden åŒºã€ä¸¤ä¸ª Survivor åŒº S0 å’Œ S1 éƒ½å±äºæ–°ç”Ÿä»£ï¼Œä¸­é—´ä¸€å±‚å±äºè€å¹´ä»£ï¼Œæœ€ä¸‹é¢ä¸€å±‚å±äºæ°¸ä¹…ä»£ã€‚1.8ä¹‹åæ”¹ä¸ºå…ƒç©ºé—´ï¼ˆæ–¹æ³•åŒºï¼‰</p><p><img src="https://oss.javaguide.cn/github/javaguide/java/jvm/hotspot-heap-structure.png" alt=""></p><h3 id="æ–°ç”Ÿä»£"><a href="#æ–°ç”Ÿä»£" class="headerlink" title="æ–°ç”Ÿä»£"></a>æ–°ç”Ÿä»£</h3><p>å½“ Eden åŒºæ²¡æœ‰è¶³å¤Ÿç©ºé—´è¿›è¡Œåˆ†é…æ—¶ï¼Œè™šæ‹Ÿæœºå°†å‘èµ·ä¸€æ¬¡ Minor GCã€‚GC æœŸé—´è™šæ‹Ÿæœºåˆå‘ç° <code>allocation1</code> æ— æ³•å­˜å…¥ Survivor ç©ºé—´ï¼Œæ‰€ä»¥åªå¥½é€šè¿‡ <strong>åˆ†é…æ‹…ä¿æœºåˆ¶</strong> æŠŠ<strong>æ–°ç”Ÿä»£çš„å¯¹è±¡æå‰è½¬ç§»åˆ°è€å¹´ä»£ä¸­å»</strong>ï¼Œè€å¹´ä»£ä¸Šçš„ç©ºé—´è¶³å¤Ÿå­˜æ”¾ <code>allocation1</code>ï¼Œæ‰€ä»¥ä¸ä¼šå‡ºç° Full GCã€‚æ‰§è¡Œ Minor GC åï¼Œåé¢åˆ†é…çš„å¯¹è±¡å¦‚æœèƒ½å¤Ÿå­˜åœ¨ Eden åŒºçš„è¯ï¼Œè¿˜æ˜¯ä¼šåœ¨ Eden åŒºåˆ†é…å†…å­˜</p><h3 id="è€å¹´ä»£"><a href="#è€å¹´ä»£" class="headerlink" title="è€å¹´ä»£"></a>è€å¹´ä»£</h3><p>å¤§å¯¹è±¡å°±æ˜¯éœ€è¦<strong>å¤§é‡è¿ç»­å†…å­˜ç©ºé—´çš„å¯¹è±¡</strong>ï¼ˆæ¯”å¦‚ï¼šå­—ç¬¦ä¸²ã€æ•°ç»„ï¼‰ã€‚</p><p>å¤§å¯¹è±¡ç›´æ¥è¿›å…¥è€å¹´ä»£çš„è¡Œä¸ºæ˜¯ç”±<strong>è™šæ‹ŸæœºåŠ¨æ€å†³å®š</strong>çš„ï¼Œå®ƒä¸å…·ä½“ä½¿ç”¨çš„åƒåœ¾å›æ”¶å™¨å’Œç›¸å…³å‚æ•°æœ‰å…³ã€‚å¤§å¯¹è±¡ç›´æ¥è¿›å…¥è€å¹´ä»£æ˜¯ä¸€ç§ä¼˜åŒ–ç­–ç•¥ï¼Œæ—¨åœ¨é¿å…å°†å¤§å¯¹è±¡æ”¾å…¥æ–°ç”Ÿä»£ï¼Œä»è€Œå‡å°‘æ–°ç”Ÿä»£çš„åƒåœ¾å›æ”¶é¢‘ç‡å’Œæˆæœ¬ã€‚</p><ul><li>G1 åƒåœ¾å›æ”¶å™¨ä¼šæ ¹æ® <code>-XX:G1HeapRegionSize</code> å‚æ•°è®¾ç½®çš„å †åŒºåŸŸå¤§å°å’Œ <code>-XX:G1MixedGCLiveThresholdPercent</code> å‚æ•°è®¾ç½®çš„é˜ˆå€¼ï¼Œæ¥å†³å®šå“ªäº›å¯¹è±¡ä¼šç›´æ¥è¿›å…¥è€å¹´ä»£ã€‚</li><li>Parallel Scavenge åƒåœ¾å›æ”¶å™¨ä¸­ï¼Œé»˜è®¤æƒ…å†µä¸‹ï¼Œå¹¶æ²¡æœ‰ä¸€ä¸ªå›ºå®šçš„é˜ˆå€¼(<code>XX:ThresholdTolerance</code>æ˜¯åŠ¨æ€è°ƒæ•´çš„)æ¥å†³å®šä½•æ—¶ç›´æ¥åœ¨è€å¹´ä»£åˆ†é…å¤§å¯¹è±¡ã€‚è€Œæ˜¯ç”±è™šæ‹Ÿæœºæ ¹æ®å½“å‰çš„å †å†…å­˜æƒ…å†µå’Œå†å²æ•°æ®åŠ¨æ€å†³å®šã€‚</li></ul><p>æ—¢ç„¶è™šæ‹Ÿæœºé‡‡ç”¨äº†<strong>åˆ†ä»£æ”¶é›†</strong>çš„æ€æƒ³æ¥ç®¡ç†å†…å­˜ï¼Œé‚£ä¹ˆå†…å­˜å›æ”¶æ—¶å°±å¿…é¡»èƒ½è¯†åˆ«å“ªäº›å¯¹è±¡åº”æ”¾åœ¨æ–°ç”Ÿä»£ï¼Œå“ªäº›å¯¹è±¡åº”æ”¾åœ¨è€å¹´ä»£ä¸­ã€‚ä¸ºäº†åšåˆ°è¿™ä¸€ç‚¹ï¼Œ<strong>è™šæ‹Ÿæœºç»™æ¯ä¸ªå¯¹è±¡ä¸€ä¸ªå¯¹è±¡å¹´é¾„ï¼ˆAgeï¼‰è®¡æ•°å™¨ã€‚</strong></p><p>å¦‚æœå¯¹è±¡åœ¨ Eden å‡ºç”Ÿå¹¶ç»è¿‡ç¬¬ä¸€æ¬¡ Minor GC åä»ç„¶èƒ½å¤Ÿå­˜æ´»ï¼Œå¹¶ä¸”èƒ½è¢« Survivor å®¹çº³çš„è¯ï¼Œå°†è¢«ç§»åŠ¨åˆ° Survivor ç©ºé—´ï¼ˆs0 æˆ–è€… s1ï¼‰ä¸­ï¼Œå¹¶å°†å¯¹è±¡å¹´é¾„è®¾ä¸º 1(<strong>Eden åŒº-&gt;Survivor åŒºåå¯¹è±¡çš„åˆå§‹å¹´é¾„å˜ä¸º 1</strong>)ã€‚</p><p>å¯¹è±¡åœ¨ Survivor ä¸­æ¯ç†¬è¿‡ä¸€æ¬¡ MinorGC,å¹´é¾„å°±å¢åŠ  1 å²ï¼Œå½“å®ƒçš„å¹´é¾„å¢åŠ åˆ°ä¸€å®šç¨‹åº¦ï¼ˆé»˜è®¤ä¸º 15 å²ï¼‰ï¼Œå°±ä¼šè¢«æ™‹å‡åˆ°è€å¹´ä»£ä¸­ã€‚å¯¹è±¡æ™‹å‡åˆ°è€å¹´ä»£çš„å¹´é¾„é˜ˆå€¼ï¼Œå¯ä»¥é€šè¿‡å‚æ•° <code>-XX:MaxTenuringThreshold</code> æ¥è®¾ç½®ã€‚</p><p>â€œHotspot éå†æ‰€æœ‰å¯¹è±¡æ—¶ï¼ŒæŒ‰ç…§å¹´é¾„ä»å°åˆ°å¤§å¯¹å…¶æ‰€å ç”¨çš„å¤§å°è¿›è¡Œç´¯ç§¯ï¼Œå½“ç´¯ç§¯çš„æŸä¸ªå¹´é¾„å¤§å°è¶…è¿‡äº† <strong>survivor åŒºçš„ 50% æ—¶</strong>ï¼ˆé»˜è®¤å€¼æ˜¯ 50%ï¼Œå¯ä»¥é€šè¿‡ <code>-XX:TargetSurvivorRatio=percent</code> æ¥è®¾ç½®ï¼Œï¼‰å–è¿™ä¸ªå¹´é¾„å’Œ MaxTenuringThreshold ä¸­æ›´å°çš„ä¸€ä¸ªå€¼ï¼Œ<strong>ä½œä¸ºæ–°çš„æ™‹å‡å¹´é¾„é˜ˆå€¼â€ã€‚</strong></p><p><strong>é»˜è®¤æ™‹å‡å¹´é¾„å¹¶ä¸éƒ½æ˜¯ 15ï¼Œè¿™ä¸ªæ˜¯è¦åŒºåˆ†åƒåœ¾æ”¶é›†å™¨çš„ï¼ŒCMS å°±æ˜¯ 6.</strong></p><p>é’ˆå¯¹ HotSpot VM çš„å®ç°ï¼Œå®ƒé‡Œé¢çš„ GC å…¶å®å‡†ç¡®åˆ†ç±»åªæœ‰ä¸¤å¤§ç§ï¼š</p><p>éƒ¨åˆ†æ”¶é›† (Partial GC)ï¼š</p><ul><li>æ–°ç”Ÿä»£æ”¶é›†ï¼ˆMinor GC / Young GCï¼‰ï¼šåªå¯¹æ–°ç”Ÿä»£è¿›è¡Œåƒåœ¾æ”¶é›†ï¼›</li><li>è€å¹´ä»£æ”¶é›†ï¼ˆMajor GC / Old GCï¼‰ï¼šåªå¯¹<strong>è€å¹´ä»£è¿›è¡Œåƒåœ¾æ”¶é›†</strong>ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ Major GC åœ¨æœ‰çš„è¯­å¢ƒä¸­ä¹Ÿç”¨äºæŒ‡ä»£æ•´å †æ”¶é›†ï¼›</li><li>æ··åˆæ”¶é›†ï¼ˆMixed GCï¼‰ï¼šå¯¹æ•´ä¸ªæ–°ç”Ÿä»£å’Œéƒ¨åˆ†è€å¹´ä»£è¿›è¡Œåƒåœ¾æ”¶é›†ã€‚</li></ul><p>æ•´å †æ”¶é›† (Full GC)ï¼šæ”¶é›†æ•´ä¸ª Java å †å’Œæ–¹æ³•åŒºã€‚</p><h3 id="ç©ºé—´åˆ†é…æ‹…ä¿"><a href="#ç©ºé—´åˆ†é…æ‹…ä¿" class="headerlink" title="ç©ºé—´åˆ†é…æ‹…ä¿"></a>ç©ºé—´åˆ†é…æ‹…ä¿</h3><p>ç©ºé—´åˆ†é…æ‹…ä¿æ˜¯ä¸ºäº†<strong>ç¡®ä¿åœ¨ Minor GC ä¹‹å‰è€å¹´ä»£æœ¬èº«è¿˜æœ‰å®¹çº³æ–°ç”Ÿä»£æ‰€æœ‰å¯¹è±¡çš„å‰©ä½™ç©ºé—´ã€‚</strong></p><p>JDK 6 Update 24 ä¹‹å‰ï¼Œ<strong>åœ¨å‘ç”Ÿ Minor GC ä¹‹å‰ï¼Œè™šæ‹Ÿæœºå¿…é¡»å…ˆæ£€æŸ¥è€å¹´ä»£æœ€å¤§å¯ç”¨çš„è¿ç»­ç©ºé—´æ˜¯å¦å¤§äºæ–°ç”Ÿä»£æ‰€æœ‰å¯¹è±¡æ€»ç©ºé—´</strong>ï¼Œå¦‚æœè¿™ä¸ªæ¡ä»¶æˆç«‹ï¼Œé‚£è¿™ä¸€æ¬¡ Minor GC å¯ä»¥ç¡®ä¿æ˜¯å®‰å…¨çš„ã€‚å¦‚æœä¸æˆç«‹ï¼Œ<strong>åˆ™è™šæ‹Ÿæœºä¼šå…ˆæŸ¥çœ‹ <code>-XX:HandlePromotionFailure</code> å‚æ•°çš„è®¾ç½®å€¼æ˜¯å¦å…è®¸æ‹…ä¿å¤±è´¥(Handle Promotion Failure);å¦‚æœå…è®¸ï¼Œé‚£ä¼šç»§ç»­æ£€æŸ¥è€å¹´ä»£æœ€å¤§å¯ç”¨çš„è¿ç»­ç©ºé—´æ˜¯å¦å¤§äºå†æ¬¡æ™‹å‡åˆ°è€å¹´ä»£å¯¹è±¡çš„å¹³å‡å¤§å°ï¼Œå¦‚æœå¤§äºï¼Œå°†å°è¯•è¿›è¡Œä¸€æ¬¡ Minor GCï¼Œå°½ç®¡è¿™æ¬¡ Minor GC æ˜¯æœ‰é£é™©çš„;å¦‚æœå°äºï¼Œæˆ–è€… <code>-XX: HandlePromotionFailure</code> è®¾ç½®ä¸å…è®¸å†’é™©ï¼Œé‚£è¿™æ—¶å°±è¦æ”¹ä¸ºè¿›è¡Œä¸€æ¬¡ Full GCã€‚</strong></p><p>JDK 6 Update 24 ä¹‹åçš„è§„åˆ™å˜ä¸º<strong>åªè¦è€å¹´ä»£çš„è¿ç»­ç©ºé—´å¤§äºæ–°ç”Ÿä»£å¯¹è±¡æ€»å¤§å°æˆ–è€…å†æ¬¡æ™‹å‡çš„å¹³å‡å¤§å°</strong>ï¼Œå°±ä¼šè¿›è¡Œ Minor GCï¼Œå¦åˆ™å°†è¿›è¡Œ Full GCã€‚</p><h2 id="å¯¹è±¡æ­»äº¡çš„åˆ¤æ–­æ–¹æ³•"><a href="#å¯¹è±¡æ­»äº¡çš„åˆ¤æ–­æ–¹æ³•" class="headerlink" title="å¯¹è±¡æ­»äº¡çš„åˆ¤æ–­æ–¹æ³•"></a>å¯¹è±¡æ­»äº¡çš„åˆ¤æ–­æ–¹æ³•</h2><h3 id="å¼•ç”¨è®¡æ•°å™¨"><a href="#å¼•ç”¨è®¡æ•°å™¨" class="headerlink" title="å¼•ç”¨è®¡æ•°å™¨"></a>å¼•ç”¨è®¡æ•°å™¨</h3><p>ç»™å¯¹è±¡ä¸­æ·»åŠ ä¸€ä¸ªå¼•ç”¨è®¡æ•°å™¨ï¼š</p><ul><li>æ¯å½“æœ‰ä¸€ä¸ªåœ°æ–¹å¼•ç”¨å®ƒï¼Œè®¡æ•°å™¨å°±åŠ  1ï¼›</li><li>å½“å¼•ç”¨å¤±æ•ˆï¼Œè®¡æ•°å™¨å°±å‡ 1ï¼›</li><li>ä»»ä½•æ—¶å€™è®¡æ•°å™¨ä¸º 0 çš„å¯¹è±¡å°±æ˜¯ä¸å¯èƒ½å†è¢«ä½¿ç”¨çš„ã€‚</li></ul><p><strong>è¿™ä¸ªæ–¹æ³•å®ç°ç®€å•ï¼Œæ•ˆç‡é«˜ï¼Œä½†æ˜¯ç›®å‰ä¸»æµçš„è™šæ‹Ÿæœºä¸­å¹¶æ²¡æœ‰é€‰æ‹©è¿™ä¸ªç®—æ³•æ¥ç®¡ç†å†…å­˜ï¼Œå…¶æœ€ä¸»è¦çš„åŸå› æ˜¯å®ƒå¾ˆéš¾è§£å†³å¯¹è±¡ä¹‹é—´å¾ªç¯å¼•ç”¨çš„é—®é¢˜ã€‚</strong></p><p>ä¾‹å­ï¼š</p><p>å¦‚ä¸‹é¢ä»£ç æ‰€ç¤ºï¼šé™¤äº†å¯¹è±¡ <code>objA</code> å’Œ <code>objB</code> ç›¸äº’å¼•ç”¨ç€å¯¹æ–¹ä¹‹å¤–ï¼Œè¿™ä¸¤ä¸ªå¯¹è±¡ä¹‹é—´å†æ— ä»»ä½•å¼•ç”¨ã€‚<strong>ä½†æ˜¯ä»–ä»¬å› ä¸ºäº’ç›¸å¼•ç”¨å¯¹æ–¹ï¼Œå¯¼è‡´å®ƒä»¬çš„å¼•ç”¨è®¡æ•°å™¨éƒ½ä¸ä¸º 0</strong>ï¼Œäºæ˜¯å¼•ç”¨è®¡æ•°ç®—æ³•æ— æ³•é€šçŸ¥ GC å›æ”¶å™¨å›æ”¶ä»–ä»¬ã€‚</p><h3 id="å¯è¾¾æ€§åˆ†æ"><a href="#å¯è¾¾æ€§åˆ†æ" class="headerlink" title="å¯è¾¾æ€§åˆ†æ"></a>å¯è¾¾æ€§åˆ†æ</h3><p>é€šè¿‡ä¸€ç³»åˆ—çš„ç§°ä¸º <strong>â€œGC Rootsâ€</strong> çš„å¯¹è±¡ä½œä¸ºèµ·ç‚¹ï¼Œä»è¿™äº›èŠ‚ç‚¹å¼€å§‹å‘ä¸‹æœç´¢ï¼ŒèŠ‚ç‚¹æ‰€èµ°è¿‡çš„è·¯å¾„ç§°ä¸ºå¼•ç”¨é“¾ï¼Œå½“ä¸€ä¸ªå¯¹è±¡åˆ° GC Roots æ²¡æœ‰ä»»ä½•å¼•ç”¨é“¾ç›¸è¿çš„è¯ï¼Œåˆ™è¯æ˜æ­¤å¯¹è±¡æ˜¯ä¸å¯ç”¨çš„ï¼Œéœ€è¦è¢«å›æ”¶ã€‚</p><p><strong>å“ªäº›å¯¹è±¡å¯ä»¥ä½œä¸º GC Roots å‘¢ï¼Ÿ</strong></p><ul><li>è™šæ‹Ÿæœº<strong>æ ˆ(æ ˆå¸§ä¸­çš„å±€éƒ¨å˜é‡è¡¨)ä¸­å¼•ç”¨çš„å¯¹è±¡</strong></li><li><strong>æœ¬åœ°æ–¹æ³•æ ˆ(Native æ–¹æ³•)ä¸­å¼•ç”¨çš„å¯¹è±¡</strong></li><li>æ–¹æ³•åŒºä¸­<strong>ç±»é™æ€å±æ€§</strong>å¼•ç”¨çš„å¯¹è±¡</li><li>æ–¹æ³•åŒºä¸­<strong>å¸¸é‡</strong>å¼•ç”¨çš„å¯¹è±¡</li><li>æ‰€æœ‰<strong>è¢«åŒæ­¥é”</strong>æŒæœ‰çš„å¯¹è±¡</li><li>JNIï¼ˆJava Native Interfaceï¼‰å¼•ç”¨çš„å¯¹è±¡</li></ul><p>ç„¶åè¦è¿›è¡Œä¸¤æ¬¡æ ‡è®°ä¹‹åï¼Œæ‰ä¼šçœŸæ­£ç»™ä»–å›æ”¶äº†</p><p>åˆ¤æ–­ä¸€ä¸ªå¯¹è±¡çš„æ­»äº¡è‡³å°‘éœ€è¦ä¸¤æ¬¡æ ‡è®°</p><ol><li>å¦‚æœ<strong>å¯¹è±¡è¿›è¡Œå¯è¾¾æ€§åˆ†æä¹‹åæ²¡å‘ç°ä¸ GC Roots ç›¸è¿çš„å¼•ç”¨é“¾</strong>ï¼Œé‚£å®ƒå°†ä¼šç¬¬ä¸€æ¬¡æ ‡è®°å¹¶ä¸”è¿›è¡Œä¸€æ¬¡ç­›é€‰ã€‚åˆ¤æ–­çš„æ¡ä»¶æ˜¯å†³å®šè¿™ä¸ªå¯¹è±¡æ˜¯å¦æœ‰å¿…è¦æ‰§è¡Œ finalize()æ–¹æ³•ã€‚<strong>å¦‚æœå¯¹è±¡æœ‰å¿…è¦æ‰§è¡Œ finalize()æ–¹æ³•ï¼Œåˆ™è¢«æ”¾å…¥ F-Queue é˜Ÿåˆ—ä¸­ã€‚</strong></li><li>GC å¯¹ F-Queue é˜Ÿåˆ—ä¸­çš„å¯¹è±¡è¿›è¡ŒäºŒæ¬¡æ ‡è®°ã€‚<strong>å¦‚æœå¯¹è±¡åœ¨ finalize()æ–¹æ³•ä¸­é‡æ–°ä¸å¼•ç”¨é“¾ä¸Šçš„ä»»ä½•ä¸€ä¸ªå¯¹è±¡å»ºç«‹äº†å…³è”ï¼Œé‚£ä¹ˆäºŒæ¬¡æ ‡è®°æ—¶åˆ™ä¼šå°†å®ƒç§»å‡ºâ€œå³å°†å›æ”¶â€é›†åˆã€‚å¦‚æœæ­¤æ—¶å¯¹è±¡è¿˜æ²¡æˆåŠŸé€ƒè„±ï¼Œé‚£ä¹ˆåªèƒ½è¢«å›æ”¶äº†ã€‚</strong></li></ol><h3 id="ä½¿ç”¨ç»ˆç»“å™¨"><a href="#ä½¿ç”¨ç»ˆç»“å™¨" class="headerlink" title="ä½¿ç”¨ç»ˆç»“å™¨"></a>ä½¿ç”¨ç»ˆç»“å™¨</h3><p>ä½†æ˜¯ä»–å—¯ï¼Œæˆä¸ºäº† Java è¯­è¨€çš„è´Ÿæ‹…ï¼Œå½±å“äº† Java è¯­è¨€çš„å®‰å…¨å’Œ GC çš„æ€§èƒ½ã€‚</p><h2 id="å¼•ç”¨ç±»å‹æ€»ç»“"><a href="#å¼•ç”¨ç±»å‹æ€»ç»“" class="headerlink" title="å¼•ç”¨ç±»å‹æ€»ç»“"></a>å¼•ç”¨ç±»å‹æ€»ç»“</h2><p>JDK1.2 ä¹‹å‰ï¼ŒJava ä¸­å¼•ç”¨çš„å®šä¹‰å¾ˆä¼ ç»Ÿï¼šå¦‚æœ reference ç±»å‹çš„æ•°æ®å­˜å‚¨çš„æ•°å€¼ä»£è¡¨çš„æ˜¯å¦ä¸€å—å†…å­˜çš„èµ·å§‹åœ°å€ï¼Œå°±ç§°è¿™å—å†…å­˜ä»£è¡¨ä¸€ä¸ªå¼•ç”¨ã€‚</p><p>JDK1.2 ä»¥åï¼ŒJava å¯¹å¼•ç”¨çš„æ¦‚å¿µè¿›è¡Œäº†æ‰©å……ï¼Œå°†å¼•ç”¨åˆ†ä¸ºå¼ºå¼•ç”¨ã€è½¯å¼•ç”¨ã€å¼±å¼•ç”¨ã€è™šå¼•ç”¨å››ç§ï¼ˆå¼•ç”¨å¼ºåº¦é€æ¸å‡å¼±ï¼‰ï¼Œ<strong>å¼ºå¼•ç”¨å°±æ˜¯ Java ä¸­æ™®é€šçš„å¯¹è±¡</strong>ï¼Œè€Œè½¯å¼•ç”¨ã€å¼±å¼•ç”¨ã€è™šå¼•ç”¨åœ¨ JDK ä¸­å®šä¹‰çš„ç±»åˆ†åˆ«æ˜¯ <code>SoftReference</code>ã€<code>WeakReference</code>ã€<code>PhantomReference</code>ã€‚</p><h3 id="å¼ºå¼•ç”¨"><a href="#å¼ºå¼•ç”¨" class="headerlink" title="å¼ºå¼•ç”¨"></a>å¼ºå¼•ç”¨</h3><p>å°±æ˜¯ç¨‹åºä»£ç ä¸­æ™®éå­˜åœ¨çš„å¼•ç”¨èµ‹å€¼ï¼Œè¿™æ˜¯ä½¿ç”¨æœ€æ™®éçš„å¼•ç”¨ï¼Œå…¶ä»£ç å¦‚ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">strongReference</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;abc&quot;</span>);</span><br></pre></td></tr></table></figure><p>å¦‚æœä¸€ä¸ªå¯¹è±¡å…·æœ‰å¼ºå¼•ç”¨ï¼Œé‚£å°±ç±»ä¼¼äº<strong>å¿…ä¸å¯å°‘çš„ç”Ÿæ´»ç”¨å“</strong>ï¼Œåƒåœ¾å›æ”¶å™¨ç»ä¸ä¼šå›æ”¶å®ƒã€‚å½“å†…å­˜ç©ºé—´ä¸è¶³ï¼ŒJava è™šæ‹Ÿæœºå®æ„¿æŠ›å‡º <strong>OutOfMemoryError</strong> é”™è¯¯ï¼Œä½¿ç¨‹åºå¼‚å¸¸ç»ˆæ­¢ï¼Œä¹Ÿä¸ä¼šé éšæ„å›æ”¶å…·æœ‰å¼ºå¼•ç”¨çš„å¯¹è±¡æ¥è§£å†³å†…å­˜ä¸è¶³é—®é¢˜ã€‚</p><h3 id="è½¯å¼•ç”¨"><a href="#è½¯å¼•ç”¨" class="headerlink" title="è½¯å¼•ç”¨"></a>è½¯å¼•ç”¨</h3><p>å¦‚æœä¸€ä¸ªå¯¹è±¡åªå…·æœ‰è½¯å¼•ç”¨ï¼Œé‚£å°±ç±»ä¼¼äº<strong>å¯æœ‰å¯æ— çš„ç”Ÿæ´»ç”¨å“</strong>ã€‚è½¯å¼•ç”¨ä»£ç å¦‚ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è½¯å¼•ç”¨</span></span><br><span class="line"><span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;abc&quot;</span>);</span><br><span class="line">SoftReference&lt;String&gt; softReference = <span class="keyword">new</span> <span class="title class_">SoftReference</span>&lt;String&gt;(str);</span><br></pre></td></tr></table></figure><p>å¦‚æœå†…å­˜ç©ºé—´è¶³å¤Ÿï¼Œåƒåœ¾å›æ”¶å™¨å°±ä¸ä¼šå›æ”¶å®ƒï¼Œå¦‚æœå†…å­˜ç©ºé—´ä¸è¶³äº†ï¼Œå°±ä¼šå›æ”¶è¿™äº›å¯¹è±¡çš„å†…å­˜ã€‚åªè¦åƒåœ¾å›æ”¶å™¨æ²¡æœ‰å›æ”¶å®ƒï¼Œè¯¥å¯¹è±¡å°±å¯ä»¥è¢«ç¨‹åºä½¿ç”¨ã€‚<strong>è½¯å¼•ç”¨å¯ç”¨æ¥å®ç°å†…å­˜æ•æ„Ÿçš„é«˜é€Ÿç¼“å­˜ã€‚</strong></p><p><strong>è½¯å¼•ç”¨å¯ä»¥å’Œä¸€ä¸ªå¼•ç”¨é˜Ÿåˆ—</strong>ï¼ˆReferenceQueueï¼‰è”åˆä½¿ç”¨ï¼Œ<strong>å¦‚æœè½¯å¼•ç”¨æ‰€å¼•ç”¨çš„å¯¹è±¡è¢«åƒåœ¾å›æ”¶ï¼ŒJAVA è™šæ‹Ÿæœºå°±ä¼šæŠŠè¿™ä¸ªè½¯å¼•ç”¨åŠ å…¥åˆ°ä¸ä¹‹å…³è”çš„å¼•ç”¨é˜Ÿåˆ—ä¸­ã€‚</strong></p><h3 id="å¼±å¼•ç”¨"><a href="#å¼±å¼•ç”¨" class="headerlink" title="å¼±å¼•ç”¨"></a>å¼±å¼•ç”¨</h3><p>å¦‚æœä¸€ä¸ªå¯¹è±¡åªå…·æœ‰å¼±å¼•ç”¨ï¼Œé‚£å°±ç±»ä¼¼äº<strong>å¯æœ‰å¯æ— çš„ç”Ÿæ´»ç”¨å“</strong>ã€‚å¼±å¼•ç”¨ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;abc&quot;</span>);</span><br><span class="line">WeakReference&lt;String&gt; weakReference = <span class="keyword">new</span> <span class="title class_">WeakReference</span>&lt;&gt;(str);</span><br><span class="line">str = <span class="literal">null</span>; <span class="comment">//strå˜æˆè½¯å¼•ç”¨ï¼Œå¯ä»¥è¢«æ”¶é›†</span></span><br></pre></td></tr></table></figure><p>å¼±å¼•ç”¨ä¸è½¯å¼•ç”¨çš„åŒºåˆ«åœ¨äºï¼šåªå…·æœ‰å¼±å¼•ç”¨çš„å¯¹è±¡æ‹¥æœ‰æ›´çŸ­æš‚çš„ç”Ÿå‘½å‘¨æœŸã€‚åœ¨åƒåœ¾å›æ”¶å™¨çº¿ç¨‹æ‰«æå®ƒæ‰€ç®¡è¾–çš„å†…å­˜åŒºåŸŸçš„è¿‡ç¨‹ä¸­ï¼Œ<strong>ä¸€æ—¦å‘ç°äº†åªå…·æœ‰å¼±å¼•ç”¨çš„å¯¹è±¡ï¼Œä¸ç®¡å½“å‰å†…å­˜ç©ºé—´è¶³å¤Ÿä¸å¦ï¼Œéƒ½ä¼šå›æ”¶å®ƒçš„å†…å­˜ã€‚</strong>ä¸è¿‡ï¼Œç”±äºåƒåœ¾å›æ”¶å™¨æ˜¯<strong>ä¸€ä¸ªä¼˜å…ˆçº§å¾ˆä½</strong>çš„çº¿ç¨‹ï¼Œ å› æ­¤ä¸ä¸€å®šä¼šå¾ˆå¿«å‘ç°é‚£äº›åªå…·æœ‰å¼±å¼•ç”¨çš„å¯¹è±¡ã€‚</p><p><strong>å¼±å¼•ç”¨å¯ä»¥å’Œä¸€ä¸ªå¼•ç”¨é˜Ÿåˆ—ï¼ˆReferenceQueueï¼‰è”åˆä½¿ç”¨ï¼Œå¦‚æœå¼±å¼•ç”¨æ‰€å¼•ç”¨çš„å¯¹è±¡è¢«åƒåœ¾å›æ”¶ï¼ŒJava è™šæ‹Ÿæœºå°±ä¼šæŠŠè¿™ä¸ªå¼±å¼•ç”¨åŠ å…¥åˆ°ä¸ä¹‹å…³è”çš„å¼•ç”¨é˜Ÿåˆ—ä¸­ã€‚</strong></p><h3 id="è™šå¼•ç”¨"><a href="#è™šå¼•ç”¨" class="headerlink" title="è™šå¼•ç”¨"></a>è™šå¼•ç”¨</h3><p>â€œè™šå¼•ç”¨â€é¡¾åæ€ä¹‰ï¼Œå°±æ˜¯å½¢åŒè™šè®¾ï¼Œä¸å…¶ä»–å‡ ç§å¼•ç”¨éƒ½ä¸åŒï¼Œè™šå¼•ç”¨å¹¶ä¸ä¼šå†³å®šå¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸã€‚å¦‚æœä¸€ä¸ªå¯¹è±¡ä»…æŒæœ‰è™šå¼•ç”¨ï¼Œé‚£ä¹ˆå®ƒå°±å’Œæ²¡æœ‰ä»»ä½•å¼•ç”¨ä¸€æ ·ï¼Œåœ¨ä»»ä½•æ—¶å€™éƒ½å¯èƒ½è¢«åƒåœ¾å›æ”¶ã€‚è™šå¼•ç”¨ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">String</span> <span class="variable">str</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">String</span>(<span class="string">&quot;abc&quot;</span>);</span><br><span class="line"><span class="type">ReferenceQueue</span> <span class="variable">queue</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReferenceQueue</span>();</span><br><span class="line"><span class="comment">// åˆ›å»ºè™šå¼•ç”¨ï¼Œè¦æ±‚å¿…é¡»ä¸ä¸€ä¸ªå¼•ç”¨é˜Ÿåˆ—å…³è”</span></span><br><span class="line"><span class="type">PhantomReference</span> <span class="variable">pr</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">PhantomReference</span>(str, queue);</span><br></pre></td></tr></table></figure><p><strong>è™šå¼•ç”¨ä¸»è¦ç”¨æ¥è·Ÿè¸ªå¯¹è±¡è¢«åƒåœ¾å›æ”¶çš„æ´»åŠ¨</strong>ã€‚</p><p><strong>è™šå¼•ç”¨ä¸è½¯å¼•ç”¨å’Œå¼±å¼•ç”¨çš„ä¸€ä¸ªåŒºåˆ«åœ¨äºï¼š</strong> <strong>è™šå¼•ç”¨å¿…é¡»å’Œå¼•ç”¨é˜Ÿåˆ—ï¼ˆReferenceQueueï¼‰è”åˆä½¿ç”¨ã€‚</strong>å½“åƒåœ¾å›æ”¶å™¨å‡†å¤‡å›æ”¶ä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œå¦‚æœå‘ç°å®ƒè¿˜æœ‰è™šå¼•ç”¨ï¼Œå°±ä¼šåœ¨å›æ”¶å¯¹è±¡çš„å†…å­˜ä¹‹å‰ï¼ŒæŠŠè¿™ä¸ªè™šå¼•ç”¨åŠ å…¥åˆ°ä¸ä¹‹å…³è”çš„å¼•ç”¨é˜Ÿåˆ—ä¸­ã€‚ç¨‹åºå¯ä»¥é€šè¿‡åˆ¤æ–­å¼•ç”¨é˜Ÿåˆ—ä¸­æ˜¯å¦å·²ç»åŠ å…¥äº†è™šå¼•ç”¨ï¼Œæ¥äº†è§£è¢«å¼•ç”¨çš„å¯¹è±¡æ˜¯å¦å°†è¦è¢«åƒåœ¾å›æ”¶ã€‚ç¨‹åºå¦‚æœå‘ç°æŸä¸ªè™šå¼•ç”¨å·²ç»è¢«åŠ å…¥åˆ°å¼•ç”¨é˜Ÿåˆ—ï¼Œ<strong>é‚£ä¹ˆå°±å¯ä»¥åœ¨æ‰€å¼•ç”¨çš„å¯¹è±¡çš„å†…å­˜è¢«å›æ”¶ä¹‹å‰é‡‡å–å¿…è¦çš„è¡ŒåŠ¨ã€‚</strong></p><p>ç‰¹åˆ«æ³¨æ„ï¼Œåœ¨ç¨‹åºè®¾è®¡ä¸­ä¸€èˆ¬å¾ˆå°‘ä½¿ç”¨å¼±å¼•ç”¨ä¸è™šå¼•ç”¨ï¼Œä½¿ç”¨è½¯å¼•ç”¨çš„æƒ…å†µè¾ƒå¤šï¼Œè¿™æ˜¯å› ä¸º<strong>è½¯å¼•ç”¨å¯ä»¥åŠ é€Ÿ JVM å¯¹åƒåœ¾å†…å­˜çš„å›æ”¶é€Ÿåº¦ï¼Œå¯ä»¥ç»´æŠ¤ç³»ç»Ÿçš„è¿è¡Œå®‰å…¨ï¼Œé˜²æ­¢å†…å­˜æº¢å‡ºï¼ˆOutOfMemoryï¼‰ç­‰é—®é¢˜çš„äº§ç”Ÿ</strong>ã€‚</p><p><strong>1.ä¸ºä»€ä¹ˆè½¯å¼•ç”¨å¯ä»¥é˜²æ­¢å†…å­˜æº¢å‡º</strong></p><p>å‡è½»å†…å­˜å‹åŠ›ï¼š</p><p>è½¯å¼•ç”¨å¯¹è±¡åœ¨å†…å­˜ç´§å¼ æ—¶ä¼šè¢« GC å›æ”¶ï¼Œè¿™æ„å‘³ç€,å¯¹äºä¸€äº›<strong>ç¼“å­˜å‹å¯¹è±¡</strong>ï¼ˆå¦‚å›¾ç‰‡ç¼“å­˜ã€æ•°æ®ç¼“å­˜ï¼‰ï¼š</p><ul><li>ä½¿ç”¨è½¯å¼•ç”¨èƒ½è®© JVM åœ¨ä¸å½±å“ç³»ç»Ÿè¿è¡Œçš„å‰æä¸‹<strong>è‡ªåŠ¨æ¸…ç†ä¸é‡è¦çš„å¯¹è±¡</strong>ï¼›</li><li>é¿å…è¿™äº›å¯¹è±¡<strong>ä¸€ç›´å ç”¨å†…å­˜</strong>å¯¼è‡´ OOMï¼ˆOutOfMemoryErrorï¼‰ã€‚</li></ul><p>æœ‰åˆ©äºç¼“å­˜ç³»ç»Ÿçš„å®ç°ï¼š</p><p>æ¯”å¦‚åœ¨å›¾ç‰‡æµè§ˆå™¨ã€æ•°æ®åº“è¿æ¥æ± ã€ç½‘é¡µæµè§ˆå™¨ä¸­ï¼Œå¸¸å¸¸éœ€è¦ç¼“å­˜å¤§é‡æ•°æ®ï¼›ä½¿ç”¨è½¯å¼•ç”¨ä½œä¸ºç¼“å­˜çš„åŸºç¡€å¯ä»¥ç¡®ä¿ï¼š</p><ul><li>ç¼“å­˜ä¸ä¼š<strong>å ç”¨è¿‡å¤šå †å†…å­˜</strong>ï¼›</li><li>ç³»ç»Ÿç©ºé—²æ—¶ç¼“å­˜ä»å¯ç”¨ï¼›</li><li>ä¸€æ—¦å†…å­˜ç´§å¼ ï¼Œ<strong>ç¼“å­˜è‡ªåŠ¨é‡Šæ”¾</strong>ï¼Œç³»ç»Ÿä¾æ—§å®‰å…¨è¿è¡Œã€‚</li></ul><p>ç›¸æ¯”å¼ºå¼•ç”¨æ›´çµæ´»ã€ç›¸æ¯”å¼±å¼•ç”¨æ›´å®‰å…¨</p><div class="table-container"><table><thead><tr><th>å¼•ç”¨ç±»å‹</th><th>å›æ”¶æ—¶æœº</th><th>æ˜¯å¦é€‚åˆåšç¼“å­˜</th><th>å¯¹ç³»ç»Ÿå®‰å…¨æ€§çš„å½±å“</th></tr></thead><tbody><tr><td>å¼ºå¼•ç”¨</td><td>æ°¸ä¸å›æ”¶ï¼ˆé™¤éæ²¡æœ‰å¼•ç”¨ï¼‰</td><td>âŒ ä¼šå¯¼è‡´ OOM</td><td>é«˜é£é™©</td></tr><tr><td>å¼±å¼•ç”¨</td><td>GC æ—¶å°±å›æ”¶</td><td>âš ï¸ ä¸é€‚åˆ</td><td>ç¨³å®šä½†æ˜“å¤±æ•ˆ</td></tr><tr><td>è½¯å¼•ç”¨</td><td>å†…å­˜ä¸è¶³æ—¶å›æ”¶</td><td>âœ… éå¸¸é€‚åˆ</td><td>âœ… å®‰å…¨å¯é </td></tr></tbody></table></div><p>ä¸ºä»€ä¹ˆå¼±å¼•ç”¨/è™šå¼•ç”¨ç”¨å¾—å°‘ï¼Ÿ</p><p><strong>å¼±å¼•ç”¨</strong>ï¼šä¸€æ—¦ GC è§¦å‘ï¼Œä¸ç®¡å†…å­˜å¤Ÿä¸å¤Ÿéƒ½ä¼šè¢«å›æ”¶ï¼Œ<strong>å¤ªæ¿€è¿›ï¼Œä¸é€‚åˆç¼“å­˜</strong>ï¼›</p><p><strong>è™šå¼•ç”¨</strong>ï¼šæ›´ååº•å±‚ï¼Œ<strong>ç”¨äºç›‘æ§å¯¹è±¡è¢«å›æ”¶çš„æ—¶æœº</strong>ï¼Œä¸å…·å¤‡è®¿é—®èƒ½åŠ›ï¼Œ<strong>éœ€è¦é…åˆ ReferenceQueue ä½¿ç”¨</strong>ï¼Œå¤æ‚åº¦é«˜ã€‚</p><h2 id="åˆ¤æ–­æ˜¯ä¸æ˜¯è¯¥åºŸå¼ƒ"><a href="#åˆ¤æ–­æ˜¯ä¸æ˜¯è¯¥åºŸå¼ƒ" class="headerlink" title="åˆ¤æ–­æ˜¯ä¸æ˜¯è¯¥åºŸå¼ƒ"></a>åˆ¤æ–­æ˜¯ä¸æ˜¯è¯¥åºŸå¼ƒ</h2><p>è¿è¡Œæ—¶å¸¸é‡æ± ä¸»è¦å›æ”¶çš„æ˜¯åºŸå¼ƒçš„å¸¸é‡ã€‚é‚£ä¹ˆï¼Œæˆ‘ä»¬å¦‚ä½•åˆ¤æ–­ä¸€ä¸ªå¸¸é‡æ˜¯åºŸå¼ƒå¸¸é‡å‘¢ï¼Ÿ</p><blockquote><ol><li><strong>JDK1.7 ä¹‹å‰è¿è¡Œæ—¶å¸¸é‡æ± é€»è¾‘åŒ…å«å­—ç¬¦ä¸²å¸¸é‡æ± å­˜æ”¾åœ¨æ–¹æ³•åŒº, æ­¤æ—¶ hotspot è™šæ‹Ÿæœºå¯¹æ–¹æ³•åŒºçš„å®ç°ä¸ºæ°¸ä¹…ä»£</strong></li><li><strong>JDK1.7 å­—ç¬¦ä¸²å¸¸é‡æ± è¢«ä»æ–¹æ³•åŒºæ‹¿åˆ°äº†å †ä¸­, è¿™é‡Œæ²¡æœ‰æåˆ°è¿è¡Œæ—¶å¸¸é‡æ± ,ä¹Ÿå°±æ˜¯è¯´å­—ç¬¦ä¸²å¸¸é‡æ± è¢«å•ç‹¬æ‹¿åˆ°å †,è¿è¡Œæ—¶å¸¸é‡æ± å‰©ä¸‹çš„ä¸œè¥¿è¿˜åœ¨æ–¹æ³•åŒº, ä¹Ÿå°±æ˜¯ hotspot ä¸­çš„æ°¸ä¹…ä»£</strong> ã€‚</li><li><strong>JDK1.8 hotspot ç§»é™¤äº†æ°¸ä¹…ä»£ç”¨å…ƒç©ºé—´(Metaspace)å–è€Œä»£ä¹‹, è¿™æ—¶å€™å­—ç¬¦ä¸²å¸¸é‡æ± è¿˜åœ¨å †, è¿è¡Œæ—¶å¸¸é‡æ± è¿˜åœ¨æ–¹æ³•åŒº, åªä¸è¿‡æ–¹æ³•åŒºçš„å®ç°ä»æ°¸ä¹…ä»£å˜æˆäº†å…ƒç©ºé—´(Metaspace)</strong></li></ol></blockquote><p>å‡å¦‚åœ¨å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­å­˜åœ¨å­—ç¬¦ä¸² â€œabcâ€ï¼Œ<strong>å¦‚æœå½“å‰æ²¡æœ‰ä»»ä½• String å¯¹è±¡å¼•ç”¨è¯¥å­—ç¬¦ä¸²å¸¸é‡çš„è¯ï¼Œå°±è¯´æ˜å¸¸é‡ â€œabcâ€ å°±æ˜¯åºŸå¼ƒå¸¸é‡</strong>ï¼Œå¦‚æœè¿™æ—¶å‘ç”Ÿå†…å­˜å›æ”¶çš„è¯è€Œä¸”æœ‰å¿…è¦çš„è¯ï¼Œâ€abcâ€ å°±ä¼šè¢«ç³»ç»Ÿæ¸…ç†å‡ºå¸¸é‡æ± äº†ã€‚</p><p>æ–¹æ³•åŒºä¸»è¦å›æ”¶çš„æ˜¯æ— ç”¨çš„ç±»ï¼Œé‚£ä¹ˆå¦‚ä½•åˆ¤æ–­ä¸€ä¸ªç±»æ˜¯æ— ç”¨çš„ç±»çš„å‘¢ï¼Ÿ</p><p>åˆ¤å®šä¸€ä¸ªå¸¸é‡æ˜¯å¦æ˜¯â€œåºŸå¼ƒå¸¸é‡â€æ¯”è¾ƒç®€å•ï¼Œè€Œè¦åˆ¤å®šä¸€ä¸ªç±»æ˜¯å¦æ˜¯â€œæ— ç”¨çš„ç±»â€çš„æ¡ä»¶åˆ™ç›¸å¯¹è‹›åˆ»è®¸å¤šã€‚ç±»éœ€è¦åŒæ—¶æ»¡è¶³ä¸‹é¢ 3 ä¸ªæ¡ä»¶æ‰èƒ½ç®—æ˜¯ <strong>â€œæ— ç”¨çš„ç±»â€</strong>ï¼š</p><ul><li>è¯¥ç±»æ‰€æœ‰çš„<strong>å®ä¾‹éƒ½å·²ç»è¢«å›æ”¶ï¼Œä¹Ÿå°±æ˜¯ Java å †ä¸­ä¸å­˜åœ¨è¯¥ç±»çš„ä»»ä½•å®ä¾‹ã€‚</strong></li><li>åŠ è½½è¯¥ç±»çš„ <code>ClassLoader</code> å·²ç»è¢«å›æ”¶ã€‚</li><li>è¯¥ç±»å¯¹åº”çš„ <code>java.lang.Class</code> å¯¹è±¡æ²¡æœ‰åœ¨<strong>ä»»ä½•åœ°æ–¹è¢«å¼•ç”¨</strong>ï¼Œ<strong>æ— æ³•åœ¨ä»»ä½•åœ°æ–¹é€šè¿‡åå°„è®¿é—®è¯¥ç±»çš„æ–¹æ³•ã€‚</strong></li></ul><p>è™šæ‹Ÿæœºå¯ä»¥å¯¹æ»¡è¶³ä¸Šè¿° 3 ä¸ªæ¡ä»¶çš„æ— ç”¨ç±»è¿›è¡Œå›æ”¶ï¼Œè¿™é‡Œè¯´çš„ä»…ä»…æ˜¯â€œå¯ä»¥â€ï¼Œè€Œå¹¶ä¸æ˜¯å’Œå¯¹è±¡ä¸€æ ·ä¸ä½¿ç”¨äº†å°±ä¼šå¿…ç„¶è¢«å›æ”¶ã€‚</p><h2 id="åƒåœ¾å›æ”¶ç®—æ³•"><a href="#åƒåœ¾å›æ”¶ç®—æ³•" class="headerlink" title="åƒåœ¾å›æ”¶ç®—æ³•"></a>åƒåœ¾å›æ”¶ç®—æ³•</h2><h3 id="æ ‡è®°æ¸…é™¤ç®—æ³•"><a href="#æ ‡è®°æ¸…é™¤ç®—æ³•" class="headerlink" title="æ ‡è®°æ¸…é™¤ç®—æ³•"></a>æ ‡è®°æ¸…é™¤ç®—æ³•</h3><p>æ ‡è®°-æ¸…é™¤ï¼ˆMark-and-Sweepï¼‰ç®—æ³•åˆ†ä¸ºâ€œæ ‡è®°ï¼ˆMarkï¼‰â€å’Œâ€œæ¸…é™¤ï¼ˆSweepï¼‰â€é˜¶æ®µï¼š<strong>é¦–å…ˆæ ‡è®°å‡ºæ‰€æœ‰ä¸éœ€è¦å›æ”¶çš„å¯¹è±¡ï¼Œåœ¨æ ‡è®°å®Œæˆåç»Ÿä¸€å›æ”¶æ‰æ‰€æœ‰æ²¡æœ‰è¢«æ ‡è®°çš„å¯¹è±¡ã€‚</strong></p><p>å®ƒæ˜¯æœ€<strong>åŸºç¡€</strong>çš„æ”¶é›†ç®—æ³•ï¼Œåç»­çš„ç®—æ³•éƒ½æ˜¯å¯¹å…¶ä¸è¶³è¿›è¡Œæ”¹è¿›å¾—åˆ°ã€‚è¿™ç§åƒåœ¾æ”¶é›†ç®—æ³•ä¼šå¸¦æ¥ä¸¤ä¸ªæ˜æ˜¾çš„é—®é¢˜ï¼š</p><ol><li><strong>æ•ˆç‡é—®é¢˜</strong>ï¼šæ ‡è®°å’Œæ¸…é™¤ä¸¤ä¸ªè¿‡ç¨‹æ•ˆç‡éƒ½ä¸é«˜ã€‚</li><li><strong>ç©ºé—´é—®é¢˜</strong>ï¼šæ ‡è®°æ¸…é™¤åä¼šäº§ç”Ÿå¤§é‡ä¸è¿ç»­çš„å†…å­˜ç¢ç‰‡ã€‚</li></ol><p>å¦‚æœæŒ‰ç…§å‰è€…çš„ç†è§£ï¼Œæ•´ä¸ªæ ‡è®°-æ¸…é™¤è¿‡ç¨‹å¤§è‡´æ˜¯è¿™æ ·çš„ï¼š</p><ol><li>å½“ä¸€ä¸ªå¯¹è±¡è¢«åˆ›å»ºæ—¶ï¼Œç»™ä¸€ä¸ªæ ‡è®°ä½ï¼Œå‡è®¾ä¸º 0 (false)ï¼›</li><li>åœ¨æ ‡è®°é˜¶æ®µï¼Œæˆ‘ä»¬å°†æ‰€æœ‰å¯è¾¾å¯¹è±¡ï¼ˆæˆ–ç”¨æˆ·å¯ä»¥å¼•ç”¨çš„å¯¹è±¡ï¼‰çš„æ ‡è®°ä½è®¾ç½®ä¸º 1 (true)ï¼›</li><li>æ‰«æé˜¶æ®µæ¸…é™¤çš„å°±æ˜¯æ ‡è®°ä½ä¸º 0 (false)çš„å¯¹è±¡ã€‚</li></ol><h3 id="å¤åˆ¶ç®—æ³•"><a href="#å¤åˆ¶ç®—æ³•" class="headerlink" title="å¤åˆ¶ç®—æ³•"></a>å¤åˆ¶ç®—æ³•</h3><p>ä¸ºäº†è§£å†³æ ‡è®°-æ¸…é™¤ç®—æ³•çš„æ•ˆç‡å’Œå†…å­˜ç¢ç‰‡é—®é¢˜ï¼Œå¤åˆ¶ï¼ˆCopyingï¼‰æ”¶é›†ç®—æ³•å‡ºç°äº†ã€‚<strong>å®ƒå¯ä»¥å°†å†…å­˜åˆ†ä¸ºå¤§å°ç›¸åŒçš„ä¸¤å—ï¼Œæ¯æ¬¡ä½¿ç”¨å…¶ä¸­çš„ä¸€å—ã€‚</strong>å½“è¿™ä¸€å—çš„å†…å­˜ä½¿ç”¨å®Œåï¼Œ<strong>å°±å°†è¿˜å­˜æ´»çš„å¯¹è±¡å¤åˆ¶åˆ°å¦ä¸€å—å»ï¼Œç„¶åå†æŠŠä½¿ç”¨çš„ç©ºé—´ä¸€æ¬¡æ¸…ç†æ‰ã€‚</strong>è¿™æ ·å°±ä½¿æ¯æ¬¡çš„å†…å­˜å›æ”¶éƒ½æ˜¯å¯¹å†…å­˜åŒºé—´çš„ä¸€åŠè¿›è¡Œå›æ”¶ã€‚</p><p>è™½ç„¶æ”¹è¿›äº†æ ‡è®°-æ¸…é™¤ç®—æ³•ï¼Œä½†ä¾ç„¶å­˜åœ¨ä¸‹é¢è¿™äº›é—®é¢˜ï¼š</p><ul><li><strong>å¯ç”¨å†…å­˜å˜å°</strong>ï¼šå¯ç”¨å†…å­˜ç¼©å°ä¸ºåŸæ¥çš„ä¸€åŠã€‚</li><li><strong>ä¸é€‚åˆè€å¹´ä»£</strong>ï¼šå¦‚æœ<strong>å­˜æ´»å¯¹è±¡æ•°é‡æ¯”è¾ƒå¤§ï¼Œå¤åˆ¶æ€§èƒ½ä¼šå˜å¾—å¾ˆå·®</strong>ã€‚</li></ul><h3 id="æ ‡è®°æ•´ç†ç®—æ³•"><a href="#æ ‡è®°æ•´ç†ç®—æ³•" class="headerlink" title="æ ‡è®°æ•´ç†ç®—æ³•"></a>æ ‡è®°æ•´ç†ç®—æ³•</h3><p>æ ‡è®°-æ•´ç†ï¼ˆMark-and-Compactï¼‰ç®—æ³•æ˜¯æ ¹æ®<strong>è€å¹´ä»£</strong>çš„ç‰¹ç‚¹æå‡ºçš„ä¸€ç§æ ‡è®°ç®—æ³•ï¼Œæ ‡è®°è¿‡ç¨‹ä»ç„¶ä¸â€œæ ‡è®°-æ¸…é™¤â€ç®—æ³•ä¸€æ ·ï¼Œä½†åç»­æ­¥éª¤ä¸æ˜¯ç›´æ¥å¯¹å¯å›æ”¶å¯¹è±¡å›æ”¶ï¼Œ<strong>è€Œæ˜¯è®©æ‰€æœ‰å­˜æ´»çš„å¯¹è±¡å‘ä¸€ç«¯ç§»åŠ¨ï¼Œç„¶åç›´æ¥æ¸…ç†æ‰ç«¯è¾¹ç•Œä»¥å¤–çš„å†…å­˜ã€‚</strong></p><p>ç”±äºå¤šäº†æ•´ç†è¿™ä¸€æ­¥ï¼Œå› æ­¤æ•ˆç‡ä¹Ÿä¸é«˜ï¼Œé€‚åˆè€å¹´ä»£è¿™ç§åƒåœ¾å›æ”¶é¢‘ç‡ä¸æ˜¯å¾ˆé«˜çš„åœºæ™¯ã€‚</p><p><img src="https://oss.javaguide.cn/github/javaguide/java/jvm/mark-and-compact-garbage-collection-algorithm.png" alt=""></p><h3 id="åˆ†ä»£æ”¶é›†ç®—æ³•"><a href="#åˆ†ä»£æ”¶é›†ç®—æ³•" class="headerlink" title="åˆ†ä»£æ”¶é›†ç®—æ³•"></a>åˆ†ä»£æ”¶é›†ç®—æ³•</h3><p>å½“å‰è™šæ‹Ÿæœºçš„åƒåœ¾æ”¶é›†éƒ½é‡‡ç”¨åˆ†ä»£æ”¶é›†ç®—æ³•ï¼Œè¿™ç§ç®—æ³•æ²¡æœ‰ä»€ä¹ˆæ–°çš„æ€æƒ³ï¼Œåªæ˜¯æ ¹æ®å¯¹è±¡å­˜æ´»å‘¨æœŸçš„ä¸åŒå°†å†…å­˜åˆ†ä¸ºå‡ å—ã€‚ä¸€èˆ¬å°† Java å †åˆ†ä¸ºæ–°ç”Ÿä»£å’Œè€å¹´ä»£ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥æ ¹æ®å„ä¸ªå¹´ä»£çš„ç‰¹ç‚¹é€‰æ‹©åˆé€‚çš„åƒåœ¾æ”¶é›†ç®—æ³•ã€‚</p><p>æ¯”å¦‚åœ¨<strong>æ–°ç”Ÿä»£</strong>ä¸­ï¼Œæ¯æ¬¡æ”¶é›†éƒ½ä¼šæœ‰å¤§é‡å¯¹è±¡æ­»å»ï¼Œ<strong>æ‰€ä»¥å¯ä»¥é€‰æ‹©â€œå¤åˆ¶â€ç®—æ³•</strong>ï¼Œåªéœ€è¦ä»˜å‡ºå°‘é‡å¯¹è±¡çš„å¤åˆ¶æˆæœ¬å°±å¯ä»¥å®Œæˆæ¯æ¬¡åƒåœ¾æ”¶é›†ã€‚è€Œ<strong>è€å¹´ä»£</strong>çš„å¯¹è±¡å­˜æ´»å‡ ç‡æ˜¯æ¯”è¾ƒé«˜çš„ï¼Œè€Œä¸”æ²¡æœ‰é¢å¤–çš„ç©ºé—´å¯¹å®ƒè¿›è¡Œåˆ†é…æ‹…ä¿ï¼Œ<strong>æ‰€ä»¥æˆ‘ä»¬å¿…é¡»é€‰æ‹©â€œæ ‡è®°-æ¸…é™¤â€æˆ–â€œæ ‡è®°-æ•´ç†â€ç®—æ³•è¿›è¡Œåƒåœ¾æ”¶é›†ã€‚</strong></p><h2 id="åƒåœ¾æ”¶é›†å™¨"><a href="#åƒåœ¾æ”¶é›†å™¨" class="headerlink" title="åƒåœ¾æ”¶é›†å™¨"></a>åƒåœ¾æ”¶é›†å™¨</h2><p><strong>å¦‚æœè¯´æ”¶é›†ç®—æ³•æ˜¯å†…å­˜å›æ”¶çš„æ–¹æ³•è®ºï¼Œé‚£ä¹ˆåƒåœ¾æ”¶é›†å™¨å°±æ˜¯å†…å­˜å›æ”¶çš„å…·ä½“å®ç°ã€‚</strong></p><p>è™½ç„¶æˆ‘ä»¬å¯¹å„ä¸ªæ”¶é›†å™¨è¿›è¡Œæ¯”è¾ƒï¼Œä½†å¹¶éè¦æŒ‘é€‰å‡ºä¸€ä¸ªæœ€å¥½çš„æ”¶é›†å™¨ã€‚å› ä¸ºç›´åˆ°ç°åœ¨ä¸ºæ­¢è¿˜æ²¡æœ‰æœ€å¥½çš„åƒåœ¾æ”¶é›†å™¨å‡ºç°ï¼Œæ›´åŠ æ²¡æœ‰ä¸‡èƒ½çš„åƒåœ¾æ”¶é›†å™¨ï¼Œ<strong>æˆ‘ä»¬èƒ½åšçš„å°±æ˜¯æ ¹æ®å…·ä½“åº”ç”¨åœºæ™¯é€‰æ‹©é€‚åˆè‡ªå·±çš„åƒåœ¾æ”¶é›†å™¨</strong>ã€‚è¯•æƒ³ä¸€ä¸‹ï¼šå¦‚æœæœ‰ä¸€ç§å››æµ·ä¹‹å†…ã€ä»»ä½•åœºæ™¯ä¸‹éƒ½é€‚ç”¨çš„å®Œç¾æ”¶é›†å™¨å­˜åœ¨ï¼Œé‚£ä¹ˆæˆ‘ä»¬çš„ HotSpot è™šæ‹Ÿæœºå°±ä¸ä¼šå®ç°é‚£ä¹ˆå¤šä¸åŒçš„åƒåœ¾æ”¶é›†å™¨äº†ã€‚</p><p>JDK é»˜è®¤åƒåœ¾æ”¶é›†å™¨ï¼ˆä½¿ç”¨ <code>java -XX:+PrintCommandLineFlags -version</code> å‘½ä»¤æŸ¥çœ‹ï¼‰ï¼š</p><ul><li>JDK 8: <strong>Parallel Scavengeï¼ˆæ–°ç”Ÿä»£ï¼‰+ Parallel Oldï¼ˆè€å¹´ä»£ï¼‰</strong></li><li>JDK 9 ~ JDK22: <strong>G1</strong></li></ul><h3 id="Serial"><a href="#Serial" class="headerlink" title="Serial"></a>Serial</h3><p>Serial<strong>ï¼ˆä¸²è¡Œï¼‰æ”¶é›†å™¨</strong>æ˜¯æœ€åŸºæœ¬ã€å†å²æœ€æ‚ ä¹…çš„åƒåœ¾æ”¶é›†å™¨äº†ã€‚å¤§å®¶çœ‹åå­—å°±çŸ¥é“è¿™ä¸ªæ”¶é›†å™¨æ˜¯ä¸€ä¸ªå•çº¿ç¨‹æ”¶é›†å™¨äº†ã€‚å®ƒçš„ <strong>â€œå•çº¿ç¨‹â€</strong> çš„æ„ä¹‰ä¸ä»…ä»…æ„å‘³ç€å®ƒåªä¼šä½¿ç”¨ä¸€æ¡åƒåœ¾æ”¶é›†çº¿ç¨‹å»å®Œæˆåƒåœ¾æ”¶é›†å·¥ä½œï¼Œ<strong>æ›´é‡è¦çš„æ˜¯å®ƒåœ¨è¿›è¡Œåƒåœ¾æ”¶é›†å·¥ä½œçš„æ—¶å€™å¿…é¡»æš‚åœå…¶ä»–æ‰€æœ‰çš„å·¥ä½œçº¿ç¨‹</strong>ï¼ˆ <strong>â€œStop The Worldâ€</strong> ï¼‰ï¼Œç›´åˆ°å®ƒæ”¶é›†ç»“æŸã€‚</p><p><strong>æ–°ç”Ÿä»£é‡‡ç”¨æ ‡è®°-å¤åˆ¶ç®—æ³•ï¼Œè€å¹´ä»£é‡‡ç”¨æ ‡è®°-æ•´ç†ç®—æ³•ã€‚</strong></p><p><img src="https://oss.javaguide.cn/github/javaguide/java/jvm/serial-garbage-collector.png" alt="Serial æ”¶é›†å™¨"></p><p>è™šæ‹Ÿæœºçš„è®¾è®¡è€…ä»¬å½“ç„¶çŸ¥é“ Stop The World å¸¦æ¥çš„ä¸è‰¯ç”¨æˆ·ä½“éªŒï¼Œæ‰€ä»¥åœ¨åç»­çš„åƒåœ¾æ”¶é›†å™¨è®¾è®¡ä¸­åœé¡¿æ—¶é—´åœ¨ä¸æ–­ç¼©çŸ­ï¼ˆä»ç„¶è¿˜æœ‰åœé¡¿ï¼Œå¯»æ‰¾æœ€ä¼˜ç§€çš„åƒåœ¾æ”¶é›†å™¨çš„è¿‡ç¨‹ä»ç„¶åœ¨ç»§ç»­ï¼‰ã€‚</p><p>ä½†æ˜¯ Serial æ”¶é›†å™¨æœ‰æ²¡æœ‰ä¼˜äºå…¶ä»–åƒåœ¾æ”¶é›†å™¨çš„åœ°æ–¹å‘¢ï¼Ÿå½“ç„¶æœ‰ï¼Œå®ƒ<strong>ç®€å•è€Œé«˜æ•ˆï¼ˆä¸å…¶ä»–æ”¶é›†å™¨çš„å•çº¿ç¨‹ç›¸æ¯”ï¼‰</strong>ã€‚<strong>Serial æ”¶é›†å™¨ç”±äºæ²¡æœ‰çº¿ç¨‹äº¤äº’çš„å¼€é”€ï¼Œè‡ªç„¶å¯ä»¥è·å¾—å¾ˆé«˜çš„å•çº¿ç¨‹æ”¶é›†æ•ˆç‡ã€‚Serial æ”¶é›†å™¨å¯¹äºè¿è¡Œåœ¨ Client æ¨¡å¼ä¸‹çš„è™šæ‹Ÿæœºæ¥è¯´æ˜¯ä¸ªä¸é”™çš„é€‰æ‹©ã€‚</strong></p><h3 id="ParNew"><a href="#ParNew" class="headerlink" title="ParNew"></a>ParNew</h3><p>ParNew æ”¶é›†å™¨å…¶å®å°±æ˜¯ <strong>Serial æ”¶é›†å™¨çš„å¤šçº¿ç¨‹ç‰ˆæœ¬</strong>ï¼Œé™¤äº†ä½¿ç”¨å¤šçº¿ç¨‹è¿›è¡Œåƒåœ¾æ”¶é›†å¤–ï¼Œå…¶ä½™è¡Œä¸ºï¼ˆæ§åˆ¶å‚æ•°ã€æ”¶é›†ç®—æ³•ã€å›æ”¶ç­–ç•¥ç­‰ç­‰ï¼‰å’Œ Serial æ”¶é›†å™¨å®Œå…¨ä¸€æ ·ã€‚</p><p><strong>æ–°ç”Ÿä»£é‡‡ç”¨æ ‡è®°-å¤åˆ¶ç®—æ³•ï¼Œè€å¹´ä»£é‡‡ç”¨æ ‡è®°-æ•´ç†ç®—æ³•ã€‚</strong></p><p><img src="https://oss.javaguide.cn/github/javaguide/java/jvm/parnew-garbage-collector.png" alt="ParNew æ”¶é›†å™¨ "></p><p>å®ƒæ˜¯è®¸å¤šè¿è¡Œåœ¨ Server æ¨¡å¼ä¸‹çš„è™šæ‹Ÿæœºçš„é¦–è¦é€‰æ‹©ï¼Œé™¤äº† Serial æ”¶é›†å™¨å¤–ï¼Œ<strong>åªæœ‰å®ƒèƒ½ä¸ CMS æ”¶é›†å™¨ï¼ˆçœŸæ­£æ„ä¹‰ä¸Šçš„å¹¶å‘æ”¶é›†å™¨ï¼Œåé¢ä¼šä»‹ç»åˆ°ï¼‰é…åˆå·¥ä½œã€‚</strong></p><p><strong>å¹¶è¡Œå’Œå¹¶å‘æ¦‚å¿µè¡¥å……ï¼š</strong></p><ul><li><strong>å¹¶è¡Œï¼ˆParallelï¼‰</strong>ï¼šæŒ‡å¤šæ¡åƒåœ¾æ”¶é›†çº¿ç¨‹å¹¶è¡Œå·¥ä½œï¼Œä½†æ­¤æ—¶ç”¨æˆ·çº¿ç¨‹ä»ç„¶å¤„äºç­‰å¾…çŠ¶æ€ã€‚</li><li><strong>å¹¶å‘ï¼ˆConcurrentï¼‰</strong>ï¼šæŒ‡<strong>ç”¨æˆ·çº¿ç¨‹ä¸åƒåœ¾æ”¶é›†çº¿ç¨‹åŒæ—¶æ‰§è¡Œ</strong>ï¼ˆä½†ä¸ä¸€å®šæ˜¯å¹¶è¡Œï¼Œå¯èƒ½ä¼šäº¤æ›¿æ‰§è¡Œï¼‰ï¼Œç”¨æˆ·ç¨‹åºåœ¨ç»§ç»­è¿è¡Œï¼Œè€Œåƒåœ¾æ”¶é›†å™¨è¿è¡Œåœ¨å¦ä¸€ä¸ª CPU ä¸Š</li></ul><h3 id="Parallerl-Scavenge"><a href="#Parallerl-Scavenge" class="headerlink" title="Parallerl Scavenge"></a>Parallerl Scavenge</h3><p>Parallel Scavenge æ”¶é›†å™¨ä¹Ÿæ˜¯ä½¿ç”¨æ ‡è®°-å¤åˆ¶ç®—æ³•çš„å¤šçº¿ç¨‹æ”¶é›†å™¨ï¼Œå®ƒçœ‹ä¸Šå»å‡ ä¹å’Œ ParNew éƒ½ä¸€æ ·ã€‚ <strong>é‚£ä¹ˆå®ƒæœ‰ä»€ä¹ˆç‰¹åˆ«ä¹‹å¤„å‘¢ï¼Ÿ</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">-XX:+UseParallelGC</span><br><span class="line"></span><br><span class="line">    ä½¿ç”¨ Parallel æ”¶é›†å™¨+ è€å¹´ä»£ä¸²è¡Œ</span><br><span class="line"></span><br><span class="line">-XX:+UseParallelOldGC</span><br><span class="line"></span><br><span class="line">    ä½¿ç”¨ Parallel æ”¶é›†å™¨+ è€å¹´ä»£å¹¶è¡Œ</span><br></pre></td></tr></table></figure><p>Parallel Scavenge æ”¶é›†å™¨å…³æ³¨ç‚¹æ˜¯<strong>ååé‡ï¼ˆé«˜æ•ˆç‡çš„åˆ©ç”¨ CPUï¼‰</strong>ã€‚CMS ç­‰åƒåœ¾æ”¶é›†å™¨çš„å…³æ³¨ç‚¹æ›´å¤šçš„æ˜¯<strong>ç”¨æˆ·çº¿ç¨‹çš„åœé¡¿æ—¶é—´</strong>ï¼ˆæé«˜ç”¨æˆ·ä½“éªŒï¼‰ã€‚æ‰€è°“ååé‡å°±æ˜¯ <strong>CPU ä¸­ç”¨äºè¿è¡Œç”¨æˆ·ä»£ç çš„æ—¶é—´ä¸ CPU æ€»æ¶ˆè€—æ—¶é—´çš„æ¯”å€¼</strong>ã€‚ Parallel Scavenge æ”¶é›†å™¨æä¾›äº†å¾ˆå¤šå‚æ•°ä¾›ç”¨æˆ·æ‰¾åˆ°æœ€åˆé€‚çš„åœé¡¿æ—¶é—´æˆ–æœ€å¤§ååé‡ï¼Œå¦‚æœå¯¹äºæ”¶é›†å™¨è¿ä½œä¸å¤ªäº†è§£ï¼Œæ‰‹å·¥ä¼˜åŒ–å­˜åœ¨å›°éš¾çš„æ—¶å€™ï¼Œ<strong>ä½¿ç”¨ Parallel Scavenge æ”¶é›†å™¨é…åˆè‡ªé€‚åº”è°ƒèŠ‚ç­–ç•¥ï¼ŒæŠŠå†…å­˜ç®¡ç†ä¼˜åŒ–äº¤ç»™è™šæ‹Ÿæœºå»å®Œæˆä¹Ÿæ˜¯ä¸€ä¸ªä¸é”™çš„é€‰æ‹©ã€‚</strong></p><p><strong>æ–°ç”Ÿä»£é‡‡ç”¨æ ‡è®°-å¤åˆ¶ç®—æ³•ï¼Œè€å¹´ä»£é‡‡ç”¨æ ‡è®°-æ•´ç†ç®—æ³•ã€‚</strong></p><p><img src="https://oss.javaguide.cn/github/javaguide/java/jvm/parallel-scavenge-garbage-collector.png" alt=""></p><p><strong>è¿™æ˜¯ JDK1.8 é»˜è®¤æ”¶é›†å™¨</strong></p><p>ä½¿ç”¨ <code>java -XX:+PrintCommandLineFlags -version</code> å‘½ä»¤æŸ¥çœ‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">-XX:InitialHeapSize=<span class="number">262921408</span> -XX:MaxHeapSize=<span class="number">4206742528</span> -XX:+PrintCommandLineFlags -XX:+UseCompressedClassPointers -XX:+UseCompressedOops -XX:+UseParallelGC</span><br><span class="line">java version <span class="string">&quot;1.8.0_211&quot;</span></span><br><span class="line">Java(TM) SE Runtime <span class="title function_">Environment</span> <span class="params">(build <span class="number">1.8</span><span class="number">.0_211</span>-b12)</span></span><br><span class="line">Java <span class="title function_">HotSpot</span><span class="params">(TM)</span> <span class="number">64</span>-Bit Server <span class="title function_">VM</span> <span class="params">(build <span class="number">25.211</span>-b12, mixed mode)</span></span><br></pre></td></tr></table></figure><p>JDK1.8 é»˜è®¤ä½¿ç”¨çš„æ˜¯ <strong>Parallel Scavenge + Parallel Old</strong>ï¼Œå¦‚æœæŒ‡å®šäº†-XX:+UseParallelGC å‚æ•°ï¼Œåˆ™é»˜è®¤æŒ‡å®šäº†-XX:+UseParallelOldGCï¼Œå¯ä»¥ä½¿ç”¨-XX:-UseParallelOldGC æ¥ç¦ç”¨è¯¥åŠŸèƒ½</p><h3 id="Serial-Old"><a href="#Serial-Old" class="headerlink" title="Serial Old"></a>Serial Old</h3><p><strong>Serial æ”¶é›†å™¨çš„è€å¹´ä»£ç‰ˆæœ¬</strong>ï¼Œå®ƒåŒæ ·æ˜¯ä¸€ä¸ªå•çº¿ç¨‹æ”¶é›†å™¨ã€‚å®ƒä¸»è¦æœ‰ä¸¤å¤§ç”¨é€”ï¼š<strong>ä¸€ç§ç”¨é€”æ˜¯åœ¨ JDK1.5 ä»¥åŠä»¥å‰çš„ç‰ˆæœ¬ä¸­ä¸ Parallel Scavenge æ”¶é›†å™¨æ­é…ä½¿ç”¨ï¼Œå¦ä¸€ç§ç”¨é€”æ˜¯ä½œä¸º CMS æ”¶é›†å™¨çš„åå¤‡æ–¹æ¡ˆã€‚</strong></p><p><img src="https://oss.javaguide.cn/github/javaguide/java/jvm/serial-garbage-collector.png" alt="Serial æ”¶é›†å™¨"></p><h3 id="Parallel-Old"><a href="#Parallel-Old" class="headerlink" title="Parallel Old"></a>Parallel Old</h3><p><strong>Parallel Scavenge æ”¶é›†å™¨çš„è€å¹´ä»£ç‰ˆæœ¬</strong>ã€‚ä½¿ç”¨å¤šçº¿ç¨‹å’Œâ€œæ ‡è®°-æ•´ç†â€ç®—æ³•ã€‚åœ¨æ³¨é‡ååé‡ä»¥åŠ CPU èµ„æºçš„åœºåˆï¼Œéƒ½å¯ä»¥ä¼˜å…ˆè€ƒè™‘ Parallel Scavenge æ”¶é›†å™¨å’Œ Parallel Old æ”¶é›†å™¨ã€‚</p><p><img src="https://oss.javaguide.cn/github/javaguide/java/jvm/parallel-scavenge-garbage-collector.png" alt="Parallel Oldæ”¶é›†å™¨è¿è¡Œç¤ºæ„å›¾"></p><h3 id="CMS"><a href="#CMS" class="headerlink" title="CMS"></a>CMS</h3><p><strong>CMSï¼ˆConcurrent Mark Sweepï¼‰æ”¶é›†å™¨æ˜¯ä¸€ç§ä»¥è·å–æœ€çŸ­å›æ”¶åœé¡¿æ—¶é—´ä¸ºç›®æ ‡çš„æ”¶é›†å™¨ã€‚å®ƒéå¸¸ç¬¦åˆåœ¨æ³¨é‡ç”¨æˆ·ä½“éªŒçš„åº”ç”¨ä¸Šä½¿ç”¨ã€‚</strong></p><p><strong>CMSï¼ˆConcurrent Mark Sweepï¼‰æ”¶é›†å™¨æ˜¯ HotSpot è™šæ‹Ÿæœºç¬¬ä¸€æ¬¾çœŸæ­£æ„ä¹‰ä¸Šçš„å¹¶å‘æ”¶é›†å™¨ï¼Œå®ƒç¬¬ä¸€æ¬¡å®ç°äº†è®©åƒåœ¾æ”¶é›†çº¿ç¨‹ä¸ç”¨æˆ·çº¿ç¨‹ï¼ˆåŸºæœ¬ä¸Šï¼‰åŒæ—¶å·¥ä½œã€‚</strong></p><p>ä»åå­—ä¸­çš„<strong>Mark Sweep</strong>è¿™ä¸¤ä¸ªè¯å¯ä»¥çœ‹å‡ºï¼ŒCMS æ”¶é›†å™¨æ˜¯ä¸€ç§ <strong>â€œæ ‡è®°-æ¸…é™¤â€ç®—æ³•</strong>å®ç°çš„ï¼Œå®ƒçš„è¿ä½œè¿‡ç¨‹ç›¸æ¯”äºå‰é¢å‡ ç§åƒåœ¾æ”¶é›†å™¨æ¥è¯´æ›´åŠ å¤æ‚ä¸€äº›ã€‚æ•´ä¸ªè¿‡ç¨‹åˆ†ä¸ºå››ä¸ªæ­¥éª¤ï¼š</p><ul><li><strong>åˆå§‹æ ‡è®°ï¼š</strong> çŸ­æš‚åœé¡¿ï¼Œ<strong>æ ‡è®°ç›´æ¥ä¸ root ç›¸è¿çš„å¯¹è±¡ï¼ˆæ ¹å¯¹è±¡ï¼‰ï¼›</strong></li><li><strong>å¹¶å‘æ ‡è®°ï¼š</strong> <strong>åŒæ—¶å¼€å¯ GC å’Œç”¨æˆ·çº¿ç¨‹</strong>ï¼Œç”¨ä¸€ä¸ª<strong>é—­åŒ…ç»“æ„</strong>å»è®°å½•å¯è¾¾å¯¹è±¡ã€‚ä½†åœ¨è¿™ä¸ªé˜¶æ®µç»“æŸï¼Œè¿™ä¸ªé—­åŒ…ç»“æ„å¹¶ä¸èƒ½ä¿è¯åŒ…å«å½“å‰æ‰€æœ‰çš„å¯è¾¾å¯¹è±¡ã€‚å› ä¸ºç”¨æˆ·çº¿ç¨‹å¯èƒ½ä¼šä¸æ–­çš„æ›´æ–°å¼•ç”¨åŸŸï¼Œæ‰€ä»¥ GC çº¿ç¨‹æ— æ³•ä¿è¯å¯è¾¾æ€§åˆ†æçš„å®æ—¶æ€§ã€‚<strong>æ‰€ä»¥è¿™ä¸ªç®—æ³•é‡Œä¼šè·Ÿè¸ªè®°å½•è¿™äº›å‘ç”Ÿå¼•ç”¨æ›´æ–°çš„åœ°æ–¹ã€‚</strong></li><li><strong>é‡æ–°æ ‡è®°ï¼š</strong> é‡æ–°æ ‡è®°é˜¶æ®µå°±æ˜¯ä¸ºäº†<strong>ä¿®æ­£å¹¶å‘æ ‡è®°æœŸé—´å› ä¸ºç”¨æˆ·ç¨‹åºç»§ç»­è¿è¡Œè€Œå¯¼è‡´æ ‡è®°äº§ç”Ÿå˜åŠ¨çš„é‚£ä¸€éƒ¨åˆ†å¯¹è±¡çš„æ ‡è®°è®°å½•ï¼Œ</strong>è¿™ä¸ªé˜¶æ®µçš„åœé¡¿æ—¶é—´ä¸€èˆ¬ä¼šæ¯”åˆå§‹æ ‡è®°é˜¶æ®µçš„æ—¶é—´ç¨é•¿ï¼Œè¿œè¿œæ¯”å¹¶å‘æ ‡è®°é˜¶æ®µæ—¶é—´çŸ­</li><li><strong>å¹¶å‘æ¸…é™¤ï¼š</strong> å¼€å¯ç”¨æˆ·çº¿ç¨‹ï¼ŒåŒæ—¶ GC çº¿ç¨‹å¼€å§‹å¯¹æœªæ ‡è®°çš„åŒºåŸŸåšæ¸…æ‰«ã€‚</li></ul><p><img src="https://oss.javaguide.cn/github/javaguide/java/jvm/cms-garbage-collector.png" alt="CMS æ”¶é›†å™¨"></p><p>ä»å®ƒçš„åå­—å°±å¯ä»¥çœ‹å‡ºå®ƒæ˜¯ä¸€æ¬¾ä¼˜ç§€çš„åƒåœ¾æ”¶é›†å™¨ï¼Œä¸»è¦ä¼˜ç‚¹ï¼š<strong>å¹¶å‘æ”¶é›†ã€ä½åœé¡¿</strong>ã€‚ä½†æ˜¯å®ƒæœ‰ä¸‹é¢ä¸‰ä¸ªæ˜æ˜¾çš„ç¼ºç‚¹ï¼š</p><ul><li><strong>å¯¹ CPU èµ„æºæ•æ„Ÿï¼›</strong></li><li><strong>æ— æ³•å¤„ç†æµ®åŠ¨åƒåœ¾ï¼›</strong></li><li><strong>å®ƒä½¿ç”¨çš„å›æ”¶ç®—æ³•-â€œæ ‡è®°-æ¸…é™¤â€ç®—æ³•ä¼šå¯¼è‡´æ”¶é›†ç»“æŸæ—¶ä¼šæœ‰å¤§é‡ç©ºé—´ç¢ç‰‡äº§ç”Ÿã€‚</strong></li></ul><p><strong>CMS åƒåœ¾å›æ”¶å™¨åœ¨ Java 9 ä¸­å·²ç»è¢«æ ‡è®°ä¸ºè¿‡æ—¶(deprecated)ï¼Œå¹¶åœ¨ Java 14 ä¸­è¢«ç§»é™¤ã€‚</strong></p><h3 id="G1"><a href="#G1" class="headerlink" title="G1"></a>G1</h3><p><strong>G1 (Garbage-First) æ˜¯ä¸€æ¬¾é¢å‘æœåŠ¡å™¨çš„åƒåœ¾æ”¶é›†å™¨,ä¸»è¦é’ˆå¯¹é…å¤‡å¤šé¢—å¤„ç†å™¨åŠå¤§å®¹é‡å†…å­˜çš„æœºå™¨. ä»¥æé«˜æ¦‚ç‡æ»¡è¶³ GC åœé¡¿æ—¶é—´è¦æ±‚çš„åŒæ—¶,è¿˜å…·å¤‡é«˜ååé‡æ€§èƒ½ç‰¹å¾ã€‚</strong></p><p>è¢«è§†ä¸º JDK1.7 ä¸­ HotSpot è™šæ‹Ÿæœºçš„ä¸€ä¸ªé‡è¦è¿›åŒ–ç‰¹å¾ã€‚å®ƒå…·å¤‡ä»¥ä¸‹ç‰¹ç‚¹ï¼š</p><ul><li><strong>å¹¶è¡Œä¸å¹¶å‘</strong>ï¼š<strong>G1 èƒ½å……åˆ†åˆ©ç”¨ CPUã€å¤šæ ¸ç¯å¢ƒä¸‹çš„ç¡¬ä»¶ä¼˜åŠ¿</strong>ï¼Œä½¿ç”¨å¤šä¸ª CPUï¼ˆCPU æˆ–è€… CPU æ ¸å¿ƒï¼‰æ¥ç¼©çŸ­ <strong>Stop-The-World åœé¡¿æ—¶é—´</strong>(æš‚åœå…¶ä»–çš„çº¿ç¨‹)ã€‚éƒ¨åˆ†å…¶ä»–æ”¶é›†å™¨åŸæœ¬éœ€è¦åœé¡¿ Java çº¿ç¨‹æ‰§è¡Œçš„ GC åŠ¨ä½œï¼Œ<strong>G1 æ”¶é›†å™¨ä»ç„¶å¯ä»¥é€šè¿‡å¹¶å‘çš„æ–¹å¼è®© java ç¨‹åºç»§ç»­æ‰§è¡Œã€‚</strong></li><li><strong>åˆ†ä»£æ”¶é›†</strong>ï¼šè™½ç„¶ G1 å¯ä»¥ä¸éœ€è¦å…¶ä»–æ”¶é›†å™¨é…åˆå°±èƒ½ç‹¬ç«‹ç®¡ç†æ•´ä¸ª GC å †ï¼Œä½†æ˜¯è¿˜æ˜¯ä¿ç•™äº†<strong>åˆ†ä»£</strong>çš„æ¦‚å¿µã€‚</li><li><strong>ç©ºé—´æ•´åˆ</strong>ï¼šä¸ CMS çš„â€œæ ‡è®°-æ¸…é™¤â€ç®—æ³•ä¸åŒï¼Œ<strong>G1 ä»æ•´ä½“æ¥çœ‹æ˜¯åŸºäºâ€œæ ‡è®°-æ•´ç†â€ç®—æ³•å®ç°çš„æ”¶é›†å™¨ï¼›ä»å±€éƒ¨ä¸Šæ¥çœ‹æ˜¯åŸºäºâ€œæ ‡è®°-å¤åˆ¶â€ç®—æ³•å®ç°çš„ã€‚</strong></li><li><strong>å¯é¢„æµ‹çš„åœé¡¿</strong>ï¼šè¿™æ˜¯ G1 ç›¸å¯¹äº CMS çš„å¦ä¸€ä¸ªå¤§ä¼˜åŠ¿ï¼Œé™ä½åœé¡¿æ—¶é—´æ˜¯ G1 å’Œ CMS å…±åŒçš„å…³æ³¨ç‚¹ï¼Œ<strong>ä½† G1 é™¤äº†è¿½æ±‚ä½åœé¡¿å¤–ï¼Œè¿˜èƒ½å»ºç«‹å¯é¢„æµ‹çš„åœé¡¿æ—¶é—´æ¨¡å‹ï¼Œèƒ½è®©ä½¿ç”¨è€…æ˜ç¡®æŒ‡å®šåœ¨ä¸€ä¸ªé•¿åº¦ä¸º M æ¯«ç§’çš„æ—¶é—´ç‰‡æ®µå†…ï¼Œæ¶ˆè€—åœ¨åƒåœ¾æ”¶é›†ä¸Šçš„æ—¶é—´ä¸å¾—è¶…è¿‡ N æ¯«ç§’</strong>ã€‚</li></ul><p>G1 æ”¶é›†å™¨çš„è¿ä½œå¤§è‡´åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š</p><ul><li><strong>åˆå§‹æ ‡è®°</strong>ï¼š çŸ­æš‚åœé¡¿ï¼ˆStop-The-Worldï¼ŒSTWï¼‰ï¼Œ<strong>æ ‡è®°ä» GC Roots å¯ç›´æ¥å¼•ç”¨çš„å¯¹è±¡ï¼Œå³æ ‡è®°æ‰€æœ‰ç›´æ¥å¯è¾¾çš„æ´»è·ƒå¯¹è±¡</strong></li><li><strong>å¹¶å‘æ ‡è®°</strong>ï¼š<strong>ä¸åº”ç”¨å¹¶å‘è¿è¡Œ</strong>ï¼Œæ ‡è®°æ‰€æœ‰å¯è¾¾å¯¹è±¡ã€‚ è¿™ä¸€é˜¶æ®µå¯èƒ½æŒç»­è¾ƒé•¿æ—¶é—´ï¼Œå–å†³äºå †çš„å¤§å°å’Œå¯¹è±¡çš„æ•°é‡ã€‚</li><li><strong>æœ€ç»ˆæ ‡è®°</strong>ï¼š çŸ­æš‚åœé¡¿ï¼ˆSTWï¼‰ï¼Œ<strong>å¤„ç†å¹¶å‘æ ‡è®°é˜¶æ®µç»“æŸåæ®‹ç•™çš„å°‘é‡æœªå¤„ç†çš„å¼•ç”¨å˜æ›´ã€‚</strong></li><li><strong>ç­›é€‰å›æ”¶</strong>ï¼šæ ¹æ®æ ‡è®°ç»“æœï¼Œ<strong>é€‰æ‹©å›æ”¶ä»·å€¼é«˜çš„åŒºåŸŸï¼Œå¤åˆ¶å­˜æ´»å¯¹è±¡åˆ°æ–°åŒºåŸŸï¼Œå›æ”¶æ—§åŒºåŸŸå†…å­˜ã€‚è¿™ä¸€é˜¶æ®µåŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªåœé¡¿ï¼ˆSTWï¼‰ï¼Œå…·ä½“å–å†³äºå›æ”¶çš„å¤æ‚åº¦ã€‚</strong></li></ul><p><img src="https://oss.javaguide.cn/github/javaguide/java/jvm/g1-garbage-collector.png" alt="G1 æ”¶é›†å™¨"></p><p><strong>G1 æ”¶é›†å™¨åœ¨åå°ç»´æŠ¤äº†ä¸€ä¸ªä¼˜å…ˆåˆ—è¡¨ï¼Œæ¯æ¬¡æ ¹æ®å…è®¸çš„æ”¶é›†æ—¶é—´ï¼Œä¼˜å…ˆé€‰æ‹©å›æ”¶ä»·å€¼æœ€å¤§çš„ Region(è¿™ä¹Ÿå°±æ˜¯å®ƒçš„åå­— Garbage-First çš„ç”±æ¥)</strong> ã€‚è¿™ç§ä½¿ç”¨ Region åˆ’åˆ†å†…å­˜ç©ºé—´ä»¥åŠæœ‰ä¼˜å…ˆçº§çš„åŒºåŸŸå›æ”¶æ–¹å¼ï¼Œ<strong>ä¿è¯äº† G1 æ”¶é›†å™¨åœ¨æœ‰é™æ—¶é—´å†…å¯ä»¥å°½å¯èƒ½é«˜çš„æ”¶é›†æ•ˆç‡</strong>ï¼ˆæŠŠå†…å­˜åŒ–æ•´ä¸ºé›¶ï¼‰ã€‚</p><p><strong>ä» JDK9 å¼€å§‹ï¼ŒG1 åƒåœ¾æ”¶é›†å™¨æˆä¸ºäº†é»˜è®¤çš„åƒåœ¾æ”¶é›†å™¨ã€‚</strong></p><h3 id="ZGC"><a href="#ZGC" class="headerlink" title="ZGC"></a>ZGC</h3><p>ä¸ CMS ä¸­çš„ ParNew å’Œ G1 ç±»ä¼¼ï¼Œ<strong>ZGC ä¹Ÿé‡‡ç”¨æ ‡è®°-å¤åˆ¶ç®—æ³•</strong>ï¼Œä¸è¿‡ ZGC å¯¹è¯¥ç®—æ³•åšäº†é‡å¤§æ”¹è¿›ã€‚</p><p><strong>ZGC å¯ä»¥å°†æš‚åœæ—¶é—´æ§åˆ¶åœ¨å‡ æ¯«ç§’ä»¥å†…ï¼Œä¸”æš‚åœæ—¶é—´ä¸å—å †å†…å­˜å¤§å°çš„å½±å“ï¼Œå‡ºç° Stop The World çš„æƒ…å†µä¼šæ›´å°‘ï¼Œä½†ä»£ä»·æ˜¯ç‰ºç‰²äº†ä¸€äº›ååé‡ã€‚ZGC æœ€å¤§æ”¯æŒ 16TB çš„å †å†…å­˜ã€‚</strong></p><p>ZGC åœ¨ Java11 ä¸­å¼•å…¥ï¼Œå¤„äºè¯•éªŒé˜¶æ®µã€‚ç»è¿‡å¤šä¸ªç‰ˆæœ¬çš„è¿­ä»£ï¼Œä¸æ–­çš„å®Œå–„å’Œä¿®å¤é—®é¢˜ï¼ŒZGC åœ¨ Java15 å·²ç»å¯ä»¥æ­£å¼ä½¿ç”¨äº†ã€‚</p><p>ä¸è¿‡ï¼Œé»˜è®¤çš„åƒåœ¾å›æ”¶å™¨ä¾ç„¶æ˜¯ G1ã€‚ä½ å¯ä»¥é€šè¿‡ä¸‹é¢çš„å‚æ•°å¯ç”¨ ZGCï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -XX:+UseZGC className</span><br></pre></td></tr></table></figure><p>åœ¨ Java21 ä¸­ï¼Œ<strong>å¼•å…¥äº†åˆ†ä»£ ZGCï¼Œæš‚åœæ—¶é—´å¯ä»¥ç¼©çŸ­åˆ° 1 æ¯«ç§’ä»¥å†…ã€‚</strong></p><p>ä½ å¯ä»¥é€šè¿‡ä¸‹é¢çš„å‚æ•°å¯ç”¨åˆ†ä»£ ZGCï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">java -XX:+UseZGC -XX:+ZGenerational className</span><br></pre></td></tr></table></figure><p><img src="https://static001.geekbang.org/infoq/9f/9ff72176ab0bf58bc43e142f69427379.png" alt=""></p><h1 id="JVM-çš„å¸¸ç”¨å‚æ•°"><a href="#JVM-çš„å¸¸ç”¨å‚æ•°" class="headerlink" title="JVM çš„å¸¸ç”¨å‚æ•°"></a>JVM çš„å¸¸ç”¨å‚æ•°</h1><div class="table-container"><table><thead><tr><th>å‚æ•°å</th><th>ä½œç”¨æè¿°</th><th>ç¤ºä¾‹å€¼/è¯´æ˜</th></tr></thead><tbody><tr><td><code>-Xms</code></td><td>åˆå§‹å †å†…å­˜å¤§å°</td><td><code>-Xms512m</code></td></tr><tr><td><code>-Xmx</code></td><td>æœ€å¤§å †å†…å­˜å¤§å°</td><td><code>-Xmx1024m</code></td></tr><tr><td><code>-Xmn</code></td><td>æ–°ç”Ÿä»£å¤§å°ï¼ˆæ§åˆ¶ Eden + Survivor åŒºï¼‰</td><td><code>-Xmn256m</code></td></tr><tr><td><code>-XX:PermSize</code>ï¼ˆJDK 8 å‰ï¼‰</td><td>åˆå§‹æ°¸ä¹…ä»£å¤§å°ï¼ˆæ–¹æ³•åŒºï¼‰</td><td><code>-XX:PermSize=128m</code></td></tr><tr><td><code>-XX:MaxPermSize</code>ï¼ˆJDK 8 å‰ï¼‰</td><td>æœ€å¤§æ°¸ä¹…ä»£å¤§å°</td><td><code>-XX:MaxPermSize=256m</code></td></tr><tr><td><code>-XX:MetaspaceSize</code>ï¼ˆJDK 8+ï¼‰</td><td>å…ƒç©ºé—´åˆå§‹å¤§å°</td><td><code>-XX:MetaspaceSize=128m</code></td></tr><tr><td><code>-XX:MaxMetaspaceSize</code>ï¼ˆJDK 8+ï¼‰</td><td>å…ƒç©ºé—´æœ€å¤§å¤§å°</td><td><code>-XX:MaxMetaspaceSize=512m</code></td></tr><tr><td><code>-XX:+PrintGCDetails</code></td><td>è¾“å‡º GC è¯¦ç»†ä¿¡æ¯</td><td>è°ƒè¯•ç”¨</td></tr><tr><td><code>-XX:+UseSerialGC</code></td><td>ä½¿ç”¨ä¸²è¡Œåƒåœ¾æ”¶é›†å™¨</td><td>é€‚åˆå•æ ¸æˆ–å°å†…å­˜ç¯å¢ƒ</td></tr><tr><td><code>-XX:+UseParallelGC</code></td><td>ä½¿ç”¨å¹¶è¡Œæ”¶é›†å™¨ï¼ˆååé‡ä¼˜å…ˆï¼‰</td><td>é»˜è®¤åœ¨ JDK 8</td></tr><tr><td><code>-XX:+UseG1GC</code></td><td>ä½¿ç”¨ G1 æ”¶é›†å™¨ï¼ˆä½å»¶è¿Ÿåœºæ™¯ï¼‰</td><td>æ¨èåœ¨å¤§å†…å­˜ã€æœåŠ¡ç«¯åœºæ™¯ä¸­ä½¿ç”¨</td></tr><tr><td><code>-XX:SurvivorRatio</code></td><td>Eden ä¸ Survivor åŒºå¤§å°æ¯”</td><td><code>-XX:SurvivorRatio=8</code></td></tr><tr><td><code>-XX:+HeapDumpOnOutOfMemoryError</code></td><td>OOM æ—¶å¯¼å‡ºå†…å­˜å¿«ç…§</td><td>ç”¨äºå®šä½å†…å­˜æ³„æ¼</td></tr><tr><td><code>-XX:HeapDumpPath</code></td><td>æŒ‡å®š heap dump æ–‡ä»¶è·¯å¾„</td><td><code>-XX:HeapDumpPath=/tmp/dump.hprof</code></td></tr><tr><td><code>-Xss</code></td><td>è®¾ç½®æ¯ä¸ªçº¿ç¨‹çš„æ ˆå¤§å°</td><td><code>-Xss256k</code></td></tr><tr><td><code>-XX:+PrintGCDateStamps</code></td><td>æ‰“å° GC æ—¥å¿—æ—¶é™„å¸¦æ—¶é—´æˆ³</td><td>è°ƒè¯•ç”¨</td></tr><tr><td><code>-XX:+UseCompressedOops</code></td><td>å‹ç¼©å¯¹è±¡æŒ‡é’ˆï¼ˆèŠ‚çœ 64 ä½ JVM å†…å­˜ï¼‰</td><td>é»˜è®¤å¼€å¯</td></tr><tr><td><code>-Dkey=value</code></td><td>è®¾ç½®ç³»ç»Ÿå±æ€§ï¼ˆå¸¸ç”¨äºé…ç½®ï¼‰</td><td>ç¤ºä¾‹ï¼š<code>-Denv=prod</code></td></tr></tbody></table></div>]]></content:encoded>
      
      
      <category domain="https://blog.tokenlen.top/categories/%E6%8A%80%E6%9C%AF%E6%A0%88/">æŠ€æœ¯æ ˆ</category>
      
      
      <category domain="https://blog.tokenlen.top/tags/java/">java</category>
      
      <category domain="https://blog.tokenlen.top/tags/jvm/">jvm</category>
      
      
      <comments>https://blog.tokenlen.top/2025/05/25/java-stack/jvm1/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>JVM-javaè™šæ‹Ÿæœºhoté¢è¯•</title>
      <link>https://blog.tokenlen.top/2025/05/25/java-stack/jvm2/</link>
      <guid>https://blog.tokenlen.top/2025/05/25/java-stack/jvm2/</guid>
      <pubDate>Sat, 24 May 2025 16:00:00 GMT</pubDate>
      
        
        
          
          
      <description>&lt;h1 id=&quot;å†…å­˜æ¨¡å‹&quot;&gt;&lt;a href=&quot;#å†…å­˜æ¨¡å‹&quot; class=&quot;headerlink&quot; title=&quot;å†…å­˜æ¨¡å‹&quot;&gt;&lt;/a&gt;å†…å­˜æ¨¡å‹&lt;/h1&gt;&lt;h2 id=&quot;1-JVMçš„å†…å­˜æ¨¡å‹ä»‹ç»ä¸€ä¸‹&quot;&gt;&lt;a href=&quot;#1-JVMçš„å†…å­˜æ¨¡å‹ä»‹ç»ä¸€ä¸‹&quot;</description>
          
        
      
      
      
      <content:encoded><![CDATA[<h1 id="å†…å­˜æ¨¡å‹"><a href="#å†…å­˜æ¨¡å‹" class="headerlink" title="å†…å­˜æ¨¡å‹"></a>å†…å­˜æ¨¡å‹</h1><h2 id="1-JVMçš„å†…å­˜æ¨¡å‹ä»‹ç»ä¸€ä¸‹"><a href="#1-JVMçš„å†…å­˜æ¨¡å‹ä»‹ç»ä¸€ä¸‹" class="headerlink" title="1.JVMçš„å†…å­˜æ¨¡å‹ä»‹ç»ä¸€ä¸‹"></a>1.JVMçš„å†…å­˜æ¨¡å‹ä»‹ç»ä¸€ä¸‹</h2><p>æ ¹æ® JDK 8 è§„èŒƒï¼ŒJVM è¿è¡Œæ—¶å†…å­˜å…±åˆ†ä¸º<strong>è™šæ‹Ÿæœºæ ˆã€å †ã€å…ƒç©ºé—´ã€ç¨‹åºè®¡æ•°å™¨ã€æœ¬åœ°æ–¹æ³•æ ˆ</strong>äº”ä¸ªéƒ¨åˆ†ã€‚è¿˜æœ‰ä¸€éƒ¨åˆ†å†…å­˜å«ç›´æ¥å†…å­˜ï¼Œå±äºæ“ä½œç³»ç»Ÿçš„æœ¬åœ°å†…å­˜ï¼Œä¹Ÿæ˜¯å¯ä»¥ç›´æ¥æ“ä½œçš„ã€‚</p><p>JVMçš„å†…å­˜ç»“æ„ä¸»è¦åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªéƒ¨åˆ†ï¼š</p><ul><li><strong>ç¨‹åºè®¡æ•°å™¨</strong>ï¼šå¯ä»¥çœ‹ä½œæ˜¯<strong>å½“å‰çº¿ç¨‹æ‰€æ‰§è¡Œçš„å­—èŠ‚ç çš„è¡Œå·æŒ‡ç¤ºå™¨</strong>ï¼Œç”¨äºå­˜å‚¨å½“å‰çº¿ç¨‹æ­£åœ¨æ‰§è¡Œçš„ Java æ–¹æ³•çš„ JVM æŒ‡ä»¤åœ°å€ã€‚ç›¸å½“äºæŒ‡é’ˆï¼Œ<strong>å¦‚æœçº¿ç¨‹æ‰§è¡Œçš„æ˜¯ Native æ–¹æ³•ï¼Œè®¡æ•°å™¨å€¼ä¸º nullã€‚</strong>æ˜¯å”¯ä¸€ä¸€ä¸ªåœ¨ Java è™šæ‹Ÿæœºè§„èŒƒä¸­<strong>æ²¡æœ‰è§„å®šä»»ä½• OutOfMemoryError</strong> æƒ…å†µçš„åŒºåŸŸï¼Œç”Ÿå‘½å‘¨æœŸä¸çº¿ç¨‹ç›¸åŒã€‚</li><li><strong>Java è™šæ‹Ÿæœºæ ˆ</strong>ï¼š<strong>æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±ç‹¬ç«‹çš„ Java è™šæ‹Ÿæœºæ ˆ</strong>ï¼Œç”Ÿå‘½å‘¨æœŸä¸çº¿ç¨‹ç›¸åŒã€‚æ¯ä¸ª<strong>æ–¹æ³•åœ¨æ‰§è¡Œæ—¶éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ ˆå¸§</strong>ï¼Œç”¨äºå­˜å‚¨å±€éƒ¨å˜é‡è¡¨ã€æ“ä½œæ•°æ ˆã€åŠ¨æ€é“¾æ¥ã€æ–¹æ³•å‡ºå£ç­‰ä¿¡æ¯ã€‚å¯èƒ½ä¼šæŠ›å‡º <strong>StackOverflowError å’Œ OutOfMemoryError</strong> å¼‚å¸¸ã€‚</li><li><strong>æœ¬åœ°æ–¹æ³•æ ˆ</strong>ï¼šä¸ Java è™šæ‹Ÿæœºæ ˆç±»ä¼¼ï¼Œä¸»<strong>è¦ä¸ºè™šæ‹Ÿæœºä½¿ç”¨åˆ°çš„ Native æ–¹æ³•æœåŠ¡</strong>ï¼Œåœ¨ <strong>HotSpot è™šæ‹Ÿæœºä¸­å’Œ Java è™šæ‹Ÿæœºæ ˆåˆäºŒä¸ºä¸€</strong>ã€‚æœ¬åœ°æ–¹æ³•æ‰§è¡Œæ—¶ä¹Ÿä¼šåˆ›å»ºæ ˆå¸§ï¼Œ<strong>åŒæ ·å¯èƒ½å‡ºç° StackOverflowError å’Œ OutOfMemoryError ä¸¤ç§é”™è¯¯ã€‚</strong></li><li><strong>Java å †</strong>ï¼šæ˜¯ <strong>JVM ä¸­æœ€å¤§çš„ä¸€å—å†…å­˜åŒºåŸŸï¼Œè¢«æ‰€æœ‰çº¿ç¨‹å…±äº«</strong>ï¼Œåœ¨è™šæ‹Ÿæœºå¯åŠ¨æ—¶åˆ›å»ºï¼Œç”¨äºå­˜æ”¾å¯¹è±¡å®ä¾‹ã€‚ä»å†…å­˜å›æ”¶è§’åº¦ï¼Œå †è¢«åˆ’åˆ†ä¸ºæ–°ç”Ÿä»£å’Œè€å¹´ä»£ï¼Œæ–°ç”Ÿä»£åˆåˆ†ä¸º Eden åŒºå’Œä¸¤ä¸ª Survivor åŒºï¼ˆFrom Survivor å’Œ To Survivorï¼‰ã€‚å¦‚æœåœ¨å †ä¸­æ²¡æœ‰å†…å­˜å®Œæˆå®ä¾‹åˆ†é…ï¼Œ<strong>å¹¶ä¸”å †ä¹Ÿæ— æ³•æ‰©å±•æ—¶ä¼šæŠ›å‡º OutOfMemoryError å¼‚å¸¸ã€‚</strong></li><li><strong>æ–¹æ³•åŒºï¼ˆå…ƒç©ºé—´ï¼‰</strong>ï¼šåœ¨ JDK 1.8 åŠä»¥åçš„ç‰ˆæœ¬ä¸­ï¼Œ<strong>æ–¹æ³•åŒºè¢«å…ƒç©ºé—´å–ä»£ï¼Œä½¿ç”¨æœ¬åœ°å†…å­˜</strong>ã€‚ç”¨äºå­˜å‚¨å·²è¢«è™šæ‹ŸæœºåŠ è½½çš„ç±»ä¿¡æ¯ã€å¸¸é‡ã€é™æ€å˜é‡ç­‰æ•°æ®ã€‚è™½ç„¶æ–¹æ³•åŒºè¢«æè¿°ä¸ºå †çš„é€»è¾‘éƒ¨åˆ†ï¼Œä½†æœ‰ â€œéå †â€ çš„åˆ«åã€‚<strong>æ–¹æ³•åŒºå¯ä»¥é€‰æ‹©ä¸å®ç°åƒåœ¾æ”¶é›†ï¼Œå†…å­˜ä¸è¶³æ—¶ä¼šæŠ›å‡º OutOfMemoryError å¼‚å¸¸ã€‚</strong></li><li><strong>è¿è¡Œæ—¶å¸¸é‡æ± </strong>ï¼šæ˜¯æ–¹æ³•åŒºçš„ä¸€éƒ¨åˆ†ï¼Œ<strong>ç”¨äºå­˜æ”¾ç¼–è¯‘æœŸç”Ÿæˆçš„å„ç§å­—é¢é‡å’Œç¬¦å·å¼•ç”¨</strong>ï¼Œå…·æœ‰åŠ¨æ€æ€§ï¼Œè¿è¡Œæ—¶ä¹Ÿå¯å°†æ–°çš„å¸¸é‡æ”¾å…¥æ± ä¸­ã€‚å½“æ— æ³•ç”³è¯·åˆ°è¶³å¤Ÿå†…å­˜æ—¶ï¼Œä¼šæŠ›å‡º OutOfMemoryError å¼‚å¸¸ã€‚</li><li><strong>ç›´æ¥å†…å­˜</strong>ï¼šä¸å±äº JVM è¿è¡Œæ—¶æ•°æ®åŒºçš„ä¸€éƒ¨åˆ†ï¼Œ<strong>é€šè¿‡ NIO ç±»å¼•å…¥ï¼Œæ˜¯ä¸€ç§å †å¤–å†…å­˜ï¼Œå¯ä»¥æ˜¾è‘—æé«˜ I/O æ€§èƒ½ã€‚</strong>ç›´æ¥å†…å­˜çš„ä½¿ç”¨å—åˆ°æœ¬æœºæ€»å†…å­˜çš„é™åˆ¶ï¼Œè‹¥åˆ†é…ä¸å½“ï¼Œå¯èƒ½å¯¼è‡´ OutOfMemoryError å¼‚å¸¸ã€‚</li></ul><h2 id="2-JVMå†…å­˜æ¨¡å‹é‡Œçš„å †å’Œæ ˆæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"><a href="#2-JVMå†…å­˜æ¨¡å‹é‡Œçš„å †å’Œæ ˆæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ" class="headerlink" title="2.JVMå†…å­˜æ¨¡å‹é‡Œçš„å †å’Œæ ˆæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"></a>2.JVMå†…å­˜æ¨¡å‹é‡Œçš„å †å’Œæ ˆæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</h2><ul><li><strong>ç”¨é€”</strong>ï¼š<strong>æ ˆä¸»è¦ç”¨äºå­˜å‚¨å±€éƒ¨å˜é‡ã€æ–¹æ³•è°ƒç”¨çš„å‚æ•°ã€æ–¹æ³•è¿”å›åœ°å€ä»¥åŠä¸€äº›ä¸´æ—¶æ•°æ®ã€‚</strong>æ¯å½“ä¸€ä¸ªæ–¹æ³•è¢«è°ƒç”¨ï¼Œä¸€ä¸ªæ ˆå¸§ï¼ˆstack frameï¼‰å°±ä¼šåœ¨æ ˆä¸­åˆ›å»ºï¼Œç”¨äºå­˜å‚¨è¯¥æ–¹æ³•çš„ä¿¡æ¯ï¼Œå½“æ–¹æ³•æ‰§è¡Œå®Œæ¯•ï¼Œæ ˆå¸§ä¹Ÿä¼šè¢«ç§»é™¤ã€‚å †ç”¨äºå­˜å‚¨å¯¹è±¡çš„å®ä¾‹ï¼ˆåŒ…æ‹¬ç±»çš„å®ä¾‹å’Œæ•°ç»„ï¼‰ã€‚<strong>å½“ä½ ä½¿ç”¨<code>new</code>å…³é”®å­—åˆ›å»ºä¸€ä¸ªå¯¹è±¡æ—¶ï¼Œå¯¹è±¡çš„å®ä¾‹å°±ä¼šåœ¨å †ä¸Šåˆ†é…ç©ºé—´ã€‚</strong></li><li><strong>ç”Ÿå‘½å‘¨æœŸ</strong>ï¼šæ ˆä¸­çš„æ•°æ®å…·æœ‰<strong>ç¡®å®šçš„ç”Ÿå‘½å‘¨æœŸ</strong>ï¼Œå½“ä¸€ä¸ªæ–¹æ³•è°ƒç”¨ç»“æŸæ—¶ï¼Œå…¶å¯¹åº”çš„æ ˆå¸§å°±ä¼šè¢«é”€æ¯ï¼Œæ ˆä¸­å­˜å‚¨çš„å±€éƒ¨å˜é‡ä¹Ÿä¼šéšä¹‹æ¶ˆå¤±ã€‚å †ä¸­çš„å¯¹è±¡ç”Ÿå‘½å‘¨æœŸä¸ç¡®å®šï¼Œ<strong>å¯¹è±¡ä¼šåœ¨åƒåœ¾å›æ”¶æœºåˆ¶ï¼ˆGarbage Collection, GCï¼‰æ£€æµ‹åˆ°å¯¹è±¡ä¸å†è¢«å¼•ç”¨æ—¶æ‰è¢«å›æ”¶ã€‚</strong></li><li><strong>å­˜å–é€Ÿåº¦</strong>ï¼š<strong>æ ˆçš„å­˜å–é€Ÿåº¦é€šå¸¸æ¯”å †å¿«</strong>ï¼Œå› ä¸ºæ ˆéµå¾ªå…ˆè¿›åå‡ºï¼ˆLIFO, Last In First Outï¼‰çš„åŸåˆ™ï¼Œæ“ä½œç®€å•å¿«é€Ÿã€‚å †çš„å­˜å–é€Ÿåº¦ç›¸å¯¹è¾ƒæ…¢ï¼Œå› ä¸ºå¯¹è±¡åœ¨å †ä¸Šçš„åˆ†é…å’Œå›æ”¶éœ€è¦æ›´å¤šçš„æ—¶é—´ï¼Œè€Œä¸”åƒåœ¾å›æ”¶æœºåˆ¶çš„è¿è¡Œä¹Ÿä¼šå½±å“æ€§èƒ½ã€‚</li><li><strong>å­˜å‚¨ç©ºé—´</strong>ï¼š<strong>æ ˆçš„ç©ºé—´ç›¸å¯¹è¾ƒå°ï¼Œä¸”å›ºå®šï¼Œç”±æ“ä½œç³»ç»Ÿç®¡ç†</strong>ã€‚å½“æ ˆæº¢å‡ºæ—¶ï¼Œé€šå¸¸æ˜¯å› ä¸ºé€’å½’è¿‡æ·±æˆ–å±€éƒ¨å˜é‡è¿‡å¤§ã€‚å †çš„ç©ºé—´è¾ƒå¤§ï¼ŒåŠ¨æ€æ‰©å±•ï¼Œç”±JVMç®¡ç†ã€‚<strong>å †æº¢å‡ºé€šå¸¸æ˜¯ç”±äºåˆ›å»ºäº†å¤ªå¤šçš„å¤§å¯¹è±¡æˆ–æœªèƒ½åŠæ—¶å›æ”¶ä¸å†ä½¿ç”¨çš„å¯¹è±¡ã€‚</strong></li><li><strong>å¯è§æ€§</strong>ï¼šæ ˆä¸­çš„æ•°æ®å¯¹çº¿ç¨‹æ˜¯ç§æœ‰çš„ï¼Œæ¯ä¸ªçº¿ç¨‹æœ‰è‡ªå·±çš„æ ˆç©ºé—´ã€‚å †ä¸­çš„æ•°æ®å¯¹çº¿ç¨‹æ˜¯å…±äº«çš„ï¼Œæ‰€æœ‰çº¿ç¨‹éƒ½å¯ä»¥è®¿é—®å †ä¸Šçš„å¯¹è±¡ã€‚</li></ul><h2 id="3-æ ˆä¸­å­˜çš„åˆ°åº•æ˜¯æŒ‡é’ˆè¿˜æ˜¯å¯¹è±¡ï¼Ÿ"><a href="#3-æ ˆä¸­å­˜çš„åˆ°åº•æ˜¯æŒ‡é’ˆè¿˜æ˜¯å¯¹è±¡ï¼Ÿ" class="headerlink" title="3.æ ˆä¸­å­˜çš„åˆ°åº•æ˜¯æŒ‡é’ˆè¿˜æ˜¯å¯¹è±¡ï¼Ÿ"></a>3.æ ˆä¸­å­˜çš„åˆ°åº•æ˜¯æŒ‡é’ˆè¿˜æ˜¯å¯¹è±¡ï¼Ÿ</h2><p>åœ¨JVMå†…å­˜æ¨¡å‹ä¸­ï¼Œæ ˆï¼ˆStackï¼‰ä¸»è¦ç”¨äº<strong>ç®¡ç†çº¿ç¨‹çš„å±€éƒ¨å˜é‡å’Œæ–¹æ³•è°ƒç”¨çš„ä¸Šä¸‹æ–‡</strong>ï¼Œè€Œå †ï¼ˆHeapï¼‰åˆ™æ˜¯ç”¨äº<strong>å­˜å‚¨æ‰€æœ‰ç±»çš„å®ä¾‹å’Œæ•°ç»„ã€‚</strong></p><p>å½“æˆ‘ä»¬åœ¨æ ˆä¸­è®¨è®ºâ€œå­˜å‚¨â€æ—¶ï¼Œå®é™…ä¸ŠæŒ‡çš„æ˜¯å­˜å‚¨åŸºæœ¬ç±»å‹çš„æ•°æ®ï¼ˆå¦‚int, doubleç­‰ï¼‰å’Œå¯¹è±¡çš„å¼•ç”¨ï¼Œè€Œä¸æ˜¯å¯¹è±¡æœ¬èº«ã€‚</p><p>è¿™é‡Œçš„å…³é”®ç‚¹æ˜¯ï¼Œæ ˆä¸­å­˜å‚¨çš„<strong>ä¸æ˜¯</strong>å¯¹è±¡ï¼Œè€Œæ˜¯<strong>å¯¹è±¡çš„å¼•ç”¨</strong>ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œ<strong>å½“ä½ åœ¨æ–¹æ³•ä¸­å£°æ˜ä¸€ä¸ªå¯¹è±¡ï¼Œæ¯”å¦‚<code>MyObject obj = new MyObject();</code>ï¼Œè¿™é‡Œçš„<code>obj</code>å®é™…ä¸Šæ˜¯ä¸€ä¸ªå­˜å‚¨åœ¨æ ˆä¸Šçš„å¼•ç”¨</strong>ï¼Œ<strong>æŒ‡å‘å †ä¸­å®é™…çš„å¯¹è±¡å®ä¾‹</strong>ã€‚è¿™ä¸ªå¼•ç”¨æ˜¯ä¸€ä¸ªå›ºå®šå¤§å°çš„æ•°æ®ï¼ˆä¾‹å¦‚åœ¨64ä½ç³»ç»Ÿä¸Šæ˜¯8å­—èŠ‚ï¼‰ï¼Œå®ƒæŒ‡å‘å †ä¸­åˆ†é…ç»™å¯¹è±¡çš„å†…å­˜åŒºåŸŸã€‚</p><h2 id="4-å †åˆ†ä¸ºå“ªå‡ éƒ¨åˆ†å‘¢ï¼Ÿ"><a href="#4-å †åˆ†ä¸ºå“ªå‡ éƒ¨åˆ†å‘¢ï¼Ÿ" class="headerlink" title="4.å †åˆ†ä¸ºå“ªå‡ éƒ¨åˆ†å‘¢ï¼Ÿ"></a>4.å †åˆ†ä¸ºå“ªå‡ éƒ¨åˆ†å‘¢ï¼Ÿ</h2><p>Javaå †ï¼ˆHeapï¼‰æ˜¯Javaè™šæ‹Ÿæœºï¼ˆJVMï¼‰ä¸­å†…å­˜ç®¡ç†çš„ä¸€ä¸ªé‡è¦åŒºåŸŸï¼Œä¸»è¦ç”¨äºå­˜æ”¾å¯¹è±¡å®ä¾‹å’Œæ•°ç»„ã€‚éšç€JVMçš„å‘å±•å’Œä¸åŒåƒåœ¾æ”¶é›†å™¨çš„å®ç°ï¼Œå †çš„å…·ä½“åˆ’åˆ†å¯èƒ½ä¼šæœ‰æ‰€ä¸åŒï¼Œä½†é€šå¸¸å¯ä»¥åˆ†ä¸ºä»¥ä¸‹å‡ ä¸ªéƒ¨åˆ†ï¼š</p><p><img src="https://cdn.xiaolincoding.com//picgo/1719974471041-14f6ed7f-358b-426a-b614-2501ceae0035.png" alt=""></p><ul><li><strong>æ–°ç”Ÿä»£ï¼ˆYoung Generationï¼‰</strong>:æ–°ç”Ÿä»£åˆ†ä¸º<strong>Eden Spaceå’ŒSurvivor Space</strong>ã€‚åœ¨Eden Spaceä¸­ï¼Œ å¤§å¤šæ•°æ–°åˆ›å»ºçš„å¯¹è±¡é¦–å…ˆå­˜æ”¾åœ¨è¿™é‡Œã€‚EdenåŒºç›¸å¯¹è¾ƒå°ï¼Œå½“EdenåŒºæ»¡æ—¶ï¼Œä¼šè§¦å‘ä¸€æ¬¡Minor GCï¼ˆæ–°ç”Ÿä»£åƒåœ¾å›æ”¶ï¼‰ã€‚åœ¨Survivor Spacesä¸­ï¼Œé€šå¸¸åˆ†ä¸ºä¸¤ä¸ªç›¸ç­‰å¤§å°çš„åŒºåŸŸï¼Œ<strong>ç§°ä¸ºS0ï¼ˆSurvivor 0ï¼‰å’ŒS1ï¼ˆSurvivor 1ï¼‰</strong>ã€‚åœ¨æ¯æ¬¡Minor GCåï¼Œå­˜æ´»ä¸‹æ¥çš„å¯¹è±¡ä¼šè¢«ç§»åŠ¨åˆ°å…¶ä¸­ä¸€ä¸ªSurvivorç©ºé—´ï¼Œä»¥ç»§ç»­å®ƒä»¬çš„ç”Ÿå‘½å‘¨æœŸã€‚<strong>è¿™ä¸¤ä¸ªåŒºåŸŸè½®æµå……å½“å¯¹è±¡çš„ä¸­è½¬ç«™ï¼Œå¸®åŠ©åŒºåˆ†çŸ­æš‚å­˜æ´»çš„å¯¹è±¡å’Œé•¿æœŸå­˜æ´»çš„å¯¹è±¡ã€‚</strong></li><li><strong>è€å¹´ä»£ï¼ˆOld Generation/Tenured Generationï¼‰</strong>:å­˜æ”¾è¿‡ä¸€æ¬¡æˆ–å¤šæ¬¡Minor GCä»å­˜æ´»çš„å¯¹è±¡ä¼šè¢«ç§»åŠ¨åˆ°è€å¹´ä»£ã€‚<strong>è€å¹´ä»£ä¸­çš„å¯¹è±¡ç”Ÿå‘½å‘¨æœŸè¾ƒé•¿</strong>ï¼Œå› æ­¤Major GCï¼ˆä¹Ÿç§°ä¸ºFull GCï¼Œæ¶‰åŠè€å¹´ä»£çš„åƒåœ¾å›æ”¶ï¼‰å‘ç”Ÿçš„é¢‘ç‡ç›¸å¯¹è¾ƒä½ï¼Œä½†å…¶æ‰§è¡Œæ—¶é—´é€šå¸¸æ¯”Minor GCé•¿ã€‚è€å¹´ä»£çš„<strong>ç©ºé—´é€šå¸¸æ¯”æ–°ç”Ÿä»£å¤§</strong>ï¼Œä»¥å­˜å‚¨æ›´å¤šçš„é•¿æœŸå­˜æ´»å¯¹è±¡ã€‚</li><li><strong>å…ƒç©ºé—´ï¼ˆMetaspaceï¼‰</strong>:ä»Java 8å¼€å§‹ï¼Œæ°¸ä¹…ä»£ï¼ˆPermanent Generationï¼‰è¢«<strong>å…ƒç©ºé—´</strong>å–ä»£ï¼Œ<strong>ç”¨äºå­˜å‚¨ç±»çš„å…ƒæ•°æ®ä¿¡æ¯ï¼Œå¦‚ç±»çš„ç»“æ„ä¿¡æ¯ï¼ˆå¦‚å­—æ®µã€æ–¹æ³•ä¿¡æ¯ç­‰ï¼‰</strong>ã€‚å…ƒç©ºé—´å¹¶ä¸åœ¨Javaå †ä¸­ï¼Œè€Œæ˜¯ä½¿ç”¨<strong>æœ¬åœ°å†…å­˜</strong>ï¼Œè¿™è§£å†³äº†æ°¸ä¹…ä»£å®¹æ˜“å‡ºç°çš„å†…å­˜æº¢å‡ºé—®é¢˜ã€‚</li><li><strong>å¤§å¯¹è±¡åŒºï¼ˆLarge Object Space / Humongous Objectsï¼‰</strong>:åœ¨æŸäº›JVMå®ç°ä¸­ï¼ˆå¦‚G1åƒåœ¾æ”¶é›†å™¨ï¼‰ï¼Œ<strong>ä¸ºå¤§å¯¹è±¡åˆ†é…äº†ä¸“é—¨çš„åŒºåŸŸï¼Œç§°ä¸ºå¤§å¯¹è±¡åŒºæˆ–Humongous ObjectsåŒºåŸŸ</strong>ã€‚å¤§å¯¹è±¡æ˜¯æŒ‡<strong>éœ€è¦å¤§é‡è¿ç»­å†…å­˜ç©ºé—´çš„å¯¹è±¡ï¼Œå¦‚å¤§æ•°ç»„ã€‚è¿™ç±»å¯¹è±¡ç›´æ¥åˆ†é…åœ¨è€å¹´ä»£ï¼Œä»¥é¿å…å› é¢‘ç¹çš„å¹´è½»ä»£æ™‹å‡è€Œå¯¼è‡´çš„å†…å­˜ç¢ç‰‡åŒ–é—®é¢˜ã€‚</strong></li></ul><h2 id="5-å¦‚æœæœ‰ä¸ªå¤§å¯¹è±¡ä¸€èˆ¬æ˜¯åœ¨å“ªä¸ªåŒºåŸŸï¼Ÿ"><a href="#5-å¦‚æœæœ‰ä¸ªå¤§å¯¹è±¡ä¸€èˆ¬æ˜¯åœ¨å“ªä¸ªåŒºåŸŸï¼Ÿ" class="headerlink" title="5.å¦‚æœæœ‰ä¸ªå¤§å¯¹è±¡ä¸€èˆ¬æ˜¯åœ¨å“ªä¸ªåŒºåŸŸï¼Ÿ"></a>5.å¦‚æœæœ‰ä¸ªå¤§å¯¹è±¡ä¸€èˆ¬æ˜¯åœ¨å“ªä¸ªåŒºåŸŸï¼Ÿ</h2><p><strong>å¤§å¯¹è±¡é€šå¸¸ä¼šç›´æ¥åˆ†é…åˆ°è€å¹´ä»£ã€‚</strong></p><p>æ–°ç”Ÿä»£ä¸»è¦ç”¨äº<strong>å­˜æ”¾ç”Ÿå‘½å‘¨æœŸè¾ƒçŸ­çš„å¯¹è±¡ï¼Œå¹¶ä¸”å…¶å†…å­˜ç©ºé—´ç›¸å¯¹è¾ƒå°</strong>ã€‚å¦‚æœå°†å¤§å¯¹è±¡åˆ†é…åˆ°æ–°ç”Ÿä»£ï¼Œå¯èƒ½ä¼šå¾ˆå¿«å¯¼è‡´æ–°ç”Ÿä»£ç©ºé—´ä¸è¶³ï¼Œä»è€Œé¢‘ç¹è§¦å‘ Minor GCã€‚è€Œæ¯æ¬¡ Minor GC éƒ½éœ€è¦è¿›è¡Œå¯¹è±¡çš„å¤åˆ¶å’Œç§»åŠ¨æ“ä½œï¼Œè¿™ä¼šå¸¦æ¥ä¸€å®šçš„æ€§èƒ½å¼€é”€ã€‚å°†å¤§å¯¹è±¡ç›´æ¥åˆ†é…åˆ°è€å¹´ä»£ï¼Œå¯ä»¥å‡å°‘æ–°ç”Ÿä»£çš„å†…å­˜å‹åŠ›ï¼Œé™ä½ Minor GC çš„é¢‘ç‡ã€‚</p><p><strong>å¤§å¯¹è±¡é€šå¸¸éœ€è¦è¿ç»­çš„å†…å­˜ç©ºé—´</strong>ï¼Œå¦‚æœåœ¨æ–°ç”Ÿä»£ä¸­é¢‘ç¹åˆ†é…å’Œå›æ”¶å¤§å¯¹è±¡ï¼Œ<strong>å®¹æ˜“äº§ç”Ÿå†…å­˜ç¢ç‰‡ï¼Œå¯¼è‡´åç»­åˆ†é…å¤§å¯¹è±¡æ—¶å¯èƒ½å› ä¸ºå†…å­˜ä¸è¿ç»­è€Œå¤±è´¥ã€‚</strong>è€å¹´ä»£çš„ç©ºé—´ç›¸å¯¹è¾ƒå¤§ï¼Œæ›´é€‚åˆå­˜å‚¨å¤§å¯¹è±¡ï¼Œæœ‰åŠ©äºå‡å°‘å†…å­˜ç¢ç‰‡çš„äº§ç”Ÿã€‚</p><h2 id="6-ç¨‹åºè®¡æ•°å™¨çš„ä½œç”¨ï¼Œä¸ºä»€ä¹ˆæ˜¯ç§æœ‰çš„ï¼Ÿ"><a href="#6-ç¨‹åºè®¡æ•°å™¨çš„ä½œç”¨ï¼Œä¸ºä»€ä¹ˆæ˜¯ç§æœ‰çš„ï¼Ÿ" class="headerlink" title="6.ç¨‹åºè®¡æ•°å™¨çš„ä½œç”¨ï¼Œä¸ºä»€ä¹ˆæ˜¯ç§æœ‰çš„ï¼Ÿ"></a>6.ç¨‹åºè®¡æ•°å™¨çš„ä½œç”¨ï¼Œä¸ºä»€ä¹ˆæ˜¯ç§æœ‰çš„ï¼Ÿ</h2><p>Javaç¨‹åºæ˜¯æ”¯æŒå¤šçº¿ç¨‹ä¸€èµ·è¿è¡Œçš„ï¼Œå¤šä¸ªçº¿ç¨‹ä¸€èµ·è¿è¡Œçš„æ—¶å€™cpuä¼šæœ‰ä¸€ä¸ªè°ƒåŠ¨å™¨ç»„ä»¶ç»™å®ƒä»¬åˆ†é…æ—¶é—´ç‰‡ï¼Œæ¯”å¦‚è¯´ä¼šç»™çº¿ç¨‹1åˆ†ç»™ä¸€ä¸ªæ—¶é—´ç‰‡ï¼Œå®ƒåœ¨æ—¶é—´ç‰‡å†…å¦‚æœå®ƒçš„ä»£ç æ²¡æœ‰æ‰§è¡Œå®Œï¼Œ<strong>å®ƒå°±ä¼šæŠŠçº¿ç¨‹1çš„çŠ¶æ€æ‰§è¡Œä¸€ä¸ªæš‚å­˜</strong>ï¼Œåˆ‡æ¢åˆ°çº¿ç¨‹2å»ï¼Œæ‰§è¡Œçº¿ç¨‹2çš„ä»£ç ï¼Œç­‰çº¿ç¨‹2çš„ä»£ç æ‰§è¡Œåˆ°äº†ä¸€å®šç¨‹åº¦ï¼Œçº¿ç¨‹2çš„æ—¶é—´ç‰‡ç”¨å®Œäº†ï¼Œå†åˆ‡æ¢å›æ¥ï¼Œå†ç»§ç»­æ‰§è¡Œçº¿ç¨‹1å‰©ä½™éƒ¨åˆ†çš„ä»£ç ã€‚</p><p>æˆ‘ä»¬è€ƒè™‘ä¸€ä¸‹ï¼Œ<strong>å¦‚æœåœ¨çº¿ç¨‹åˆ‡æ¢çš„è¿‡ç¨‹ä¸­ï¼Œä¸‹ä¸€æ¡æŒ‡ä»¤æ‰§è¡Œåˆ°å“ªé‡Œäº†ï¼Œæ˜¯ä¸æ˜¯è¿˜æ˜¯ä¼šç”¨åˆ°æˆ‘ä»¬çš„ç¨‹åºè®¡æ•°å™¨å•Šã€‚æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„ç¨‹åºè®¡æ•°å™¨ï¼Œå› ä¸ºå®ƒä»¬å„è‡ªæ‰§è¡Œçš„ä»£ç çš„æŒ‡ä»¤åœ°å€æ˜¯ä¸ä¸€æ ·çš„å‘€ï¼Œæ‰€ä»¥æ¯ä¸ªçº¿ç¨‹éƒ½åº”è¯¥æœ‰è‡ªå·±çš„ç¨‹åºè®¡æ•°å™¨ã€‚</strong></p><h2 id="7-æ–¹æ³•åŒºä¸­çš„æ–¹æ³•çš„æ‰§è¡Œè¿‡ç¨‹ï¼Ÿ"><a href="#7-æ–¹æ³•åŒºä¸­çš„æ–¹æ³•çš„æ‰§è¡Œè¿‡ç¨‹ï¼Ÿ" class="headerlink" title="7.æ–¹æ³•åŒºä¸­çš„æ–¹æ³•çš„æ‰§è¡Œè¿‡ç¨‹ï¼Ÿ"></a>7.æ–¹æ³•åŒºä¸­çš„æ–¹æ³•çš„æ‰§è¡Œè¿‡ç¨‹ï¼Ÿ</h2><p>å½“ç¨‹åºä¸­é€šè¿‡å¯¹è±¡æˆ–ç±»ç›´æ¥è°ƒç”¨æŸä¸ªæ–¹æ³•æ—¶ï¼Œä¸»è¦åŒ…æ‹¬ä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š</p><ul><li><strong>è§£ææ–¹æ³•è°ƒç”¨</strong>ï¼šJVMä¼šæ ¹æ®<strong>æ–¹æ³•çš„ç¬¦å·å¼•ç”¨æ‰¾åˆ°å®é™…çš„æ–¹æ³•åœ°å€</strong>ï¼ˆå¦‚æœä¹‹å‰æ²¡æœ‰è§£æè¿‡çš„è¯ï¼‰ã€‚</li><li><strong>æ ˆå¸§åˆ›å»º</strong>ï¼šåœ¨è°ƒç”¨ä¸€ä¸ªæ–¹æ³•å‰ï¼ŒJVMä¼šåœ¨å½“å‰çº¿ç¨‹çš„Java<strong>è™šæ‹Ÿæœºæ ˆä¸­ä¸ºè¯¥æ–¹æ³•åˆ†é…ä¸€ä¸ªæ–°çš„æ ˆå¸§ï¼Œç”¨äºå­˜å‚¨å±€éƒ¨å˜é‡è¡¨ã€æ“ä½œæ•°æ ˆã€åŠ¨æ€é“¾æ¥ã€æ–¹æ³•å‡ºå£ç­‰ä¿¡æ¯ã€‚</strong></li><li><strong>æ‰§è¡Œæ–¹æ³•</strong>ï¼šæ‰§è¡Œæ–¹æ³•å†…çš„<strong>å­—èŠ‚ç æŒ‡ä»¤</strong>ï¼Œæ¶‰åŠçš„æ“ä½œå¯èƒ½åŒ…æ‹¬å±€éƒ¨å˜é‡çš„è¯»å†™ã€æ“ä½œæ•°æ ˆçš„æ“ä½œã€è·³è½¬æ§åˆ¶ã€å¯¹è±¡åˆ›å»ºã€æ–¹æ³•è°ƒç”¨ç­‰ã€‚</li><li><strong>è¿”å›å¤„ç†</strong>ï¼šæ–¹æ³•æ‰§è¡Œå®Œæ¯•åï¼Œå¯<strong>èƒ½ä¼šè¿”å›ä¸€ä¸ªç»“æœç»™è°ƒç”¨è€…ï¼Œå¹¶æ¸…ç†å½“å‰æ ˆå¸§ï¼Œæ¢å¤è°ƒç”¨è€…çš„æ‰§è¡Œç¯å¢ƒã€‚</strong></li></ul><h2 id="8-HotSpot-ä¸ºä»€ä¹ˆè¦åˆ†ä¸ºæ–°ç”Ÿä»£å’Œè€å¹´ä»£ï¼Ÿ"><a href="#8-HotSpot-ä¸ºä»€ä¹ˆè¦åˆ†ä¸ºæ–°ç”Ÿä»£å’Œè€å¹´ä»£ï¼Ÿ" class="headerlink" title="8.HotSpot ä¸ºä»€ä¹ˆè¦åˆ†ä¸ºæ–°ç”Ÿä»£å’Œè€å¹´ä»£ï¼Ÿ"></a>8.HotSpot ä¸ºä»€ä¹ˆè¦åˆ†ä¸ºæ–°ç”Ÿä»£å’Œè€å¹´ä»£ï¼Ÿ</h2><p>HotSpot å°†å †å†…å­˜åˆ’åˆ†ä¸ºæ–°ç”Ÿä»£å’Œè€å¹´ä»£ï¼Œæ˜¯ä¸ºäº†<strong>åˆ©ç”¨å¯¹è±¡ç”Ÿå‘½å‘¨æœŸçš„å·®å¼‚æ¥ä¼˜åŒ–åƒåœ¾å›æ”¶æ€§èƒ½ã€‚</strong>å¤§å¤šæ•°å¯¹è±¡ç”Ÿå‘½å‘¨æœŸçŸ­ï¼Œé€‚åˆåœ¨æ–°ç”Ÿä»£ä¸­ç”¨é«˜æ•ˆçš„<strong>å¤åˆ¶ç®—æ³•</strong>å¿«é€Ÿå›æ”¶ï¼›å°‘é‡é•¿å¯¿å‘½å¯¹è±¡å­˜æ”¾åœ¨è€å¹´ä»£ï¼Œ<strong>å‡å°‘å›æ”¶é¢‘ç‡ã€‚åˆ†ä»£è®¾è®¡èƒ½æœ‰æ•ˆç¼©çŸ­åœé¡¿æ—¶é—´ã€æé«˜ååé‡ï¼Œé¿å…æ¯æ¬¡ GC éƒ½æ‰«ææ•´ä¸ªå †ï¼Œä»è€Œæå‡æ•´ä½“ç³»ç»Ÿè¿è¡Œæ•ˆç‡ã€‚</strong></p><h2 id="9-æ–¹æ³•åŒºä¸­è¿˜æœ‰å“ªäº›ä¸œè¥¿ï¼Ÿ"><a href="#9-æ–¹æ³•åŒºä¸­è¿˜æœ‰å“ªäº›ä¸œè¥¿ï¼Ÿ" class="headerlink" title="9.æ–¹æ³•åŒºä¸­è¿˜æœ‰å“ªäº›ä¸œè¥¿ï¼Ÿ"></a>9.æ–¹æ³•åŒºä¸­è¿˜æœ‰å“ªäº›ä¸œè¥¿ï¼Ÿ</h2><p>å®ƒç”¨äºå­˜å‚¨å·²è¢«è™šæ‹ŸæœºåŠ è½½çš„<strong>ç±»å‹ä¿¡æ¯ã€å¸¸é‡ã€é™æ€å˜é‡ã€å³æ—¶ç¼–è¯‘å™¨ç¼–è¯‘åçš„ä»£ç ç¼“å­˜</strong>ç­‰ã€‚</p><ul><li>ç±»ä¿¡æ¯ï¼šåŒ…æ‹¬ç±»çš„ç»“æ„ä¿¡æ¯ã€ç±»çš„è®¿é—®ä¿®é¥°ç¬¦ã€çˆ¶ç±»ä¸æ¥å£ç­‰ä¿¡æ¯ã€‚</li><li>å¸¸é‡æ± ï¼šå­˜å‚¨ç±»å’Œæ¥å£ä¸­çš„å¸¸é‡ï¼ŒåŒ…æ‹¬å­—é¢å€¼å¸¸é‡ã€ç¬¦å·å¼•ç”¨ï¼Œä»¥åŠè¿è¡Œæ—¶å¸¸é‡æ± ã€‚</li><li>é™æ€å˜é‡ï¼šå­˜å‚¨ç±»çš„é™æ€å˜é‡ï¼Œè¿™äº›å˜é‡åœ¨ç±»åˆå§‹åŒ–çš„æ—¶å€™è¢«èµ‹å€¼ã€‚</li><li>æ–¹æ³•å­—èŠ‚ç ï¼šå­˜å‚¨ç±»çš„æ–¹æ³•å­—èŠ‚ç ï¼Œå³ç¼–è¯‘åçš„ä»£ç ã€‚</li><li>ç¬¦å·å¼•ç”¨ï¼šå­˜å‚¨ç±»å’Œæ–¹æ³•çš„ç¬¦å·å¼•ç”¨ï¼Œæ˜¯ä¸€ç§ç›´æ¥å¼•ç”¨ä¸åŒäºç›´æ¥å¼•ç”¨çš„å¼•ç”¨ç±»å‹ã€‚</li><li>è¿è¡Œæ—¶å¸¸é‡æ± ï¼šå­˜å‚¨ç€åœ¨ç±»æ–‡ä»¶ä¸­çš„å¸¸é‡æ± æ•°æ®ï¼Œåœ¨ç±»åŠ è½½ååœ¨æ–¹æ³•åŒºç”Ÿæˆè¯¥è¿è¡Œæ—¶å¸¸é‡æ± ã€‚</li><li>å¸¸é‡æ± ç¼“å­˜ï¼šç”¨äºæå‡ç±»åŠ è½½çš„æ•ˆç‡ï¼Œå°†å¸¸ç”¨çš„å¸¸é‡ç¼“å­˜èµ·æ¥æ–¹ä¾¿ä½¿ç”¨ã€‚</li></ul><h2 id="10-Stringä¿å­˜åœ¨å“ªé‡Œå‘¢ï¼Ÿ"><a href="#10-Stringä¿å­˜åœ¨å“ªé‡Œå‘¢ï¼Ÿ" class="headerlink" title="10.Stringä¿å­˜åœ¨å“ªé‡Œå‘¢ï¼Ÿ"></a>10.Stringä¿å­˜åœ¨å“ªé‡Œå‘¢ï¼Ÿ</h2><p>String ä¿å­˜åœ¨å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­ï¼Œä¸åŒäºå…¶ä»–å¯¹è±¡ï¼Œå®ƒçš„å€¼æ˜¯ä¸å¯å˜çš„ï¼Œä¸”å¯ä»¥è¢«å¤šä¸ªå¼•ç”¨å…±äº«</p><h2 id="11-String-s-new-Stringï¼ˆâ€œabcâ€ï¼‰æ‰§è¡Œè¿‡ç¨‹ä¸­åˆ†åˆ«å¯¹åº”å“ªäº›å†…å­˜åŒºåŸŸï¼Ÿ"><a href="#11-String-s-new-Stringï¼ˆâ€œabcâ€ï¼‰æ‰§è¡Œè¿‡ç¨‹ä¸­åˆ†åˆ«å¯¹åº”å“ªäº›å†…å­˜åŒºåŸŸï¼Ÿ" class="headerlink" title="11.String s = new Stringï¼ˆâ€œabcâ€ï¼‰æ‰§è¡Œè¿‡ç¨‹ä¸­åˆ†åˆ«å¯¹åº”å“ªäº›å†…å­˜åŒºåŸŸï¼Ÿ"></a>11.String s = new Stringï¼ˆâ€œabcâ€ï¼‰æ‰§è¡Œè¿‡ç¨‹ä¸­åˆ†åˆ«å¯¹åº”å“ªäº›å†…å­˜åŒºåŸŸï¼Ÿ</h2><p>é¦–å…ˆï¼Œæˆ‘ä»¬çœ‹åˆ°è¿™ä¸ªä»£ç ä¸­æœ‰ä¸€ä¸ªnewå…³é”®å­—ï¼Œæˆ‘ä»¬çŸ¥é“<strong>new</strong>æŒ‡ä»¤æ˜¯åˆ›å»ºä¸€ä¸ªç±»çš„å®ä¾‹å¯¹è±¡å¹¶å®ŒæˆåŠ è½½åˆå§‹åŒ–çš„ï¼Œå› æ­¤è¿™ä¸ªå­—ç¬¦ä¸²å¯¹è±¡æ˜¯åœ¨<strong>è¿è¡ŒæœŸ</strong>æ‰èƒ½ç¡®å®šçš„ï¼Œåˆ›å»ºçš„å­—ç¬¦ä¸²å¯¹è±¡æ˜¯åœ¨<strong>å †å†…å­˜ä¸Š</strong>ã€‚</p><p>å…¶æ¬¡ï¼Œåœ¨Stringçš„æ„é€ æ–¹æ³•ä¸­ä¼ é€’äº†ä¸€ä¸ªå­—ç¬¦ä¸²abcï¼Œç”±äºè¿™é‡Œçš„abcæ˜¯è¢«finalä¿®é¥°çš„å±æ€§ï¼Œæ‰€ä»¥å®ƒæ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²å¸¸é‡ã€‚åœ¨é¦–æ¬¡æ„å»ºè¿™ä¸ªå¯¹è±¡æ—¶ï¼ŒJVMæ‹¿å­—é¢é‡â€abcâ€å»<strong>å­—ç¬¦ä¸²å¸¸é‡æ± </strong>è¯•å›¾è·å–å…¶å¯¹åº”Stringå¯¹è±¡çš„å¼•ç”¨ã€‚<strong>äºæ˜¯åœ¨å †ä¸­åˆ›å»ºäº†ä¸€ä¸ªâ€abcâ€çš„Stringå¯¹è±¡</strong>ï¼Œå¹¶å°†å…¶å¼•ç”¨ä¿å­˜åˆ°å­—ç¬¦ä¸²å¸¸é‡æ± ä¸­ï¼Œç„¶åè¿”å›ï¼›</p><p>æ‰€ä»¥ï¼Œ<strong>å¦‚æœabcè¿™ä¸ªå­—ç¬¦ä¸²å¸¸é‡ä¸å­˜åœ¨ï¼Œåˆ™åˆ›å»ºä¸¤ä¸ªå¯¹è±¡ï¼Œåˆ†åˆ«æ˜¯abcè¿™ä¸ªå­—ç¬¦ä¸²å¸¸é‡ï¼Œä»¥åŠnew Stringè¿™ä¸ªå®ä¾‹å¯¹è±¡ã€‚å¦‚æœabcè¿™å­—ç¬¦ä¸²å¸¸é‡å­˜åœ¨ï¼Œåˆ™åªä¼šåˆ›å»ºä¸€ä¸ªå¯¹è±¡</strong>ã€‚</p><h1 id="å¼•ç”¨"><a href="#å¼•ç”¨" class="headerlink" title="å¼•ç”¨"></a>å¼•ç”¨</h1><h2 id="1-ä¸ºä»€ä¹ˆè½¯å¼•ç”¨å¯ä»¥é˜²æ­¢å†…å­˜æº¢å‡º"><a href="#1-ä¸ºä»€ä¹ˆè½¯å¼•ç”¨å¯ä»¥é˜²æ­¢å†…å­˜æº¢å‡º" class="headerlink" title="1.ä¸ºä»€ä¹ˆè½¯å¼•ç”¨å¯ä»¥é˜²æ­¢å†…å­˜æº¢å‡º"></a><strong>1.ä¸ºä»€ä¹ˆè½¯å¼•ç”¨å¯ä»¥é˜²æ­¢å†…å­˜æº¢å‡º</strong></h2><p>å‡è½»å†…å­˜å‹åŠ›ï¼š</p><p>è½¯å¼•ç”¨å¯¹è±¡åœ¨å†…å­˜ç´§å¼ æ—¶ä¼šè¢« GC å›æ”¶ï¼Œè¿™æ„å‘³ç€,å¯¹äºä¸€äº›<strong>ç¼“å­˜å‹å¯¹è±¡</strong>ï¼ˆå¦‚å›¾ç‰‡ç¼“å­˜ã€æ•°æ®ç¼“å­˜ï¼‰ï¼š</p><ul><li>ä½¿ç”¨è½¯å¼•ç”¨èƒ½è®© JVM åœ¨ä¸å½±å“ç³»ç»Ÿè¿è¡Œçš„å‰æä¸‹<strong>è‡ªåŠ¨æ¸…ç†ä¸é‡è¦çš„å¯¹è±¡</strong>ï¼›</li><li>é¿å…è¿™äº›å¯¹è±¡<strong>ä¸€ç›´å ç”¨å†…å­˜</strong>å¯¼è‡´ OOMï¼ˆOutOfMemoryErrorï¼‰ã€‚</li></ul><p>æœ‰åˆ©äºç¼“å­˜ç³»ç»Ÿçš„å®ç°ï¼š</p><p>æ¯”å¦‚åœ¨å›¾ç‰‡æµè§ˆå™¨ã€æ•°æ®åº“è¿æ¥æ± ã€ç½‘é¡µæµè§ˆå™¨ä¸­ï¼Œå¸¸å¸¸éœ€è¦ç¼“å­˜å¤§é‡æ•°æ®ï¼›ä½¿ç”¨è½¯å¼•ç”¨ä½œä¸ºç¼“å­˜çš„åŸºç¡€å¯ä»¥ç¡®ä¿ï¼š</p><ul><li>ç¼“å­˜ä¸ä¼š<strong>å ç”¨è¿‡å¤šå †å†…å­˜</strong>ï¼›</li><li>ç³»ç»Ÿç©ºé—²æ—¶ç¼“å­˜ä»å¯ç”¨ï¼›</li><li>ä¸€æ—¦å†…å­˜ç´§å¼ ï¼Œ<strong>ç¼“å­˜è‡ªåŠ¨é‡Šæ”¾</strong>ï¼Œç³»ç»Ÿä¾æ—§å®‰å…¨è¿è¡Œã€‚</li></ul><p>ç›¸æ¯”å¼ºå¼•ç”¨æ›´çµæ´»ã€ç›¸æ¯”å¼±å¼•ç”¨æ›´å®‰å…¨</p><div class="table-container"><table><thead><tr><th>å¼•ç”¨ç±»å‹</th><th>å›æ”¶æ—¶æœº</th><th>æ˜¯å¦é€‚åˆåšç¼“å­˜</th><th>å¯¹ç³»ç»Ÿå®‰å…¨æ€§çš„å½±å“</th></tr></thead><tbody><tr><td>å¼ºå¼•ç”¨</td><td>æ°¸ä¸å›æ”¶ï¼ˆé™¤éæ²¡æœ‰å¼•ç”¨ï¼‰</td><td>âŒ ä¼šå¯¼è‡´ OOM</td><td>é«˜é£é™©</td></tr><tr><td>å¼±å¼•ç”¨</td><td>GC æ—¶å°±å›æ”¶</td><td>âš ï¸ ä¸é€‚åˆ</td><td>ç¨³å®šä½†æ˜“å¤±æ•ˆ</td></tr><tr><td>è½¯å¼•ç”¨</td><td>å†…å­˜ä¸è¶³æ—¶å›æ”¶</td><td>âœ… éå¸¸é€‚åˆ</td><td>âœ… å®‰å…¨å¯é </td></tr></tbody></table></div><p>ä¸ºä»€ä¹ˆå¼±å¼•ç”¨/è™šå¼•ç”¨ç”¨å¾—å°‘ï¼Ÿ</p><p><strong>å¼±å¼•ç”¨</strong>ï¼šä¸€æ—¦ GC è§¦å‘ï¼Œä¸ç®¡å†…å­˜å¤Ÿä¸å¤Ÿéƒ½ä¼šè¢«å›æ”¶ï¼Œ<strong>å¤ªæ¿€è¿›ï¼Œä¸é€‚åˆç¼“å­˜</strong>ï¼›</p><p><strong>è™šå¼•ç”¨</strong>ï¼šæ›´ååº•å±‚ï¼Œ<strong>ç”¨äºç›‘æ§å¯¹è±¡è¢«å›æ”¶çš„æ—¶æœº</strong>ï¼Œä¸å…·å¤‡è®¿é—®èƒ½åŠ›ï¼Œ<strong>éœ€è¦é…åˆ ReferenceQueue ä½¿ç”¨</strong>ï¼Œå¤æ‚åº¦é«˜ã€‚</p><h2 id="2-å¼•ç”¨ç±»å‹æœ‰å“ªäº›ï¼Ÿæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"><a href="#2-å¼•ç”¨ç±»å‹æœ‰å“ªäº›ï¼Ÿæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ" class="headerlink" title="2.å¼•ç”¨ç±»å‹æœ‰å“ªäº›ï¼Ÿæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"></a>2.å¼•ç”¨ç±»å‹æœ‰å“ªäº›ï¼Ÿæœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</h2><p>å¼•ç”¨ç±»å‹ä¸»è¦åˆ†ä¸ºå¼ºè½¯å¼±è™šå››ç§ï¼š</p><ul><li>å¼ºå¼•ç”¨æŒ‡çš„å°±æ˜¯<strong>ä»£ç ä¸­æ™®éå­˜åœ¨çš„èµ‹å€¼æ–¹å¼</strong>ï¼Œæ¯”å¦‚A a = new A()è¿™ç§ã€‚å¼ºå¼•ç”¨å…³è”çš„å¯¹è±¡ï¼Œæ°¸è¿œä¸ä¼šè¢«GCå›æ”¶ã€‚å°±æ˜¯ä¸€ä¸ªå¯¹è±¡</li><li>è½¯å¼•ç”¨å¯ä»¥ç”¨SoftReferenceæ¥æè¿°ï¼ŒæŒ‡çš„æ˜¯é‚£äº›æœ‰ç”¨ä½†æ˜¯ä¸æ˜¯å¿…é¡»è¦çš„å¯¹è±¡ã€‚<strong>ç³»ç»Ÿåœ¨å‘ç”Ÿå†…å­˜æº¢å‡ºå‰ä¼šå¯¹è¿™ç±»å¼•ç”¨çš„å¯¹è±¡è¿›è¡Œå›æ”¶ã€‚</strong></li><li>å¼±å¼•ç”¨å¯ä»¥ç”¨WeakReferenceæ¥æè¿°ï¼Œä»–çš„å¼ºåº¦æ¯”è½¯å¼•ç”¨æ›´ä½ä¸€ç‚¹ï¼Œ<strong>å¼±å¼•ç”¨çš„å¯¹è±¡ä¸‹ä¸€æ¬¡GCçš„æ—¶å€™ä¸€å®šä¼šè¢«å›æ”¶ï¼Œè€Œä¸ç®¡å†…å­˜æ˜¯å¦è¶³å¤Ÿã€‚</strong></li><li>è™šå¼•ç”¨ä¹Ÿè¢«ç§°ä½œå¹»å½±å¼•ç”¨ï¼Œæ˜¯æœ€å¼±çš„å¼•ç”¨å…³ç³»ï¼Œå¯ä»¥ç”¨PhantomReferenceæ¥æè¿°ï¼Œ<strong>ä»–å¿…é¡»å’ŒReferenceQueueä¸€èµ·ä½¿ç”¨</strong>ï¼ŒåŒæ ·çš„å½“å‘ç”ŸGCçš„æ—¶å€™ï¼Œè™šå¼•ç”¨ä¹Ÿä¼šè¢«å›æ”¶ã€‚<strong>å¯ä»¥ç”¨è™šå¼•ç”¨æ¥ç®¡ç†å †å¤–å†…å­˜ã€‚</strong></li></ul><h2 id="3-å¼±å¼•ç”¨äº†è§£å—-ä¸¾ä¾‹è¯´æ˜åœ¨å“ªé‡Œå¯ä»¥ç”¨"><a href="#3-å¼±å¼•ç”¨äº†è§£å—-ä¸¾ä¾‹è¯´æ˜åœ¨å“ªé‡Œå¯ä»¥ç”¨" class="headerlink" title="3.å¼±å¼•ç”¨äº†è§£å—?ä¸¾ä¾‹è¯´æ˜åœ¨å“ªé‡Œå¯ä»¥ç”¨?"></a>3.å¼±å¼•ç”¨äº†è§£å—?ä¸¾ä¾‹è¯´æ˜åœ¨å“ªé‡Œå¯ä»¥ç”¨?</h2><p>Javaä¸­çš„å¼±å¼•ç”¨æ˜¯ä¸€ç§å¼•ç”¨ç±»å‹ï¼Œå®ƒä¸ä¼šé˜»æ­¢ä¸€ä¸ªå¯¹è±¡è¢«åƒåœ¾å›æ”¶ã€‚</p><p>åœ¨Javaä¸­ï¼Œå¼±å¼•ç”¨æ˜¯é€šè¿‡<code>Java.lang.ref.WeakReference</code>ç±»å®ç°çš„ã€‚å¼±å¼•ç”¨çš„ä¸€ä¸ªä¸»è¦ç”¨é€”æ˜¯åˆ›å»ºéå¼ºåˆ¶æ€§çš„å¯¹è±¡å¼•ç”¨ï¼Œ<strong>è¿™äº›å¼•ç”¨å¯ä»¥åœ¨å†…å­˜å‹åŠ›å¤§æ—¶è¢«åƒåœ¾å›æ”¶å™¨æ¸…ç†ï¼Œä»è€Œé¿å…å†…å­˜æ³„éœ²ã€‚</strong></p><p>å¼±å¼•ç”¨çš„ä½¿ç”¨åœºæ™¯ï¼š</p><ul><li><strong>ç¼“å­˜ç³»ç»Ÿ</strong>ï¼šå¼±å¼•ç”¨å¸¸ç”¨äº<strong>å®ç°ç¼“å­˜</strong>ï¼Œç‰¹åˆ«æ˜¯å½“å¸Œæœ›ç¼“å­˜é¡¹èƒ½å¤Ÿåœ¨å†…å­˜å‹åŠ›ä¸‹è‡ªåŠ¨é‡Šæ”¾æ—¶ã€‚å¦‚æœç¼“å­˜çš„å¤§å°ä¸å—æ§åˆ¶ï¼Œå¯èƒ½ä¼šå¯¼è‡´å†…å­˜æº¢å‡ºã€‚ä½¿ç”¨å¼±å¼•ç”¨æ¥ç»´æŠ¤ç¼“å­˜ï¼Œå¯ä»¥è®©JVMåœ¨éœ€è¦æ›´å¤šå†…å­˜æ—¶è‡ªåŠ¨æ¸…ç†è¿™äº›ç¼“å­˜å¯¹è±¡ã€‚</li><li><strong>å¯¹è±¡æ± </strong>ï¼šåœ¨å¯¹è±¡æ± ä¸­ï¼Œ<strong>å¼±å¼•ç”¨å¯ä»¥ç”¨æ¥ç®¡ç†é‚£äº›æš‚æ—¶ä¸ä½¿ç”¨çš„å¯¹è±¡ã€‚å½“å¯¹è±¡ä¸å†è¢«å¼ºå¼•ç”¨æ—¶ï¼Œå®ƒä»¬å¯ä»¥è¢«åƒåœ¾å›æ”¶ï¼Œé‡Šæ”¾å†…å­˜ã€‚</strong></li><li><strong>é¿å…å†…å­˜æ³„éœ²</strong>ï¼šå½“ä¸€ä¸ªå¯¹è±¡<strong>ä¸åº”è¯¥è¢«é•¿æœŸå¼•ç”¨æ—¶</strong>ï¼Œä½¿ç”¨å¼±å¼•ç”¨å¯ä»¥é˜²æ­¢è¯¥å¯¹è±¡è¢«æ„å¤–åœ°ä¿ç•™ï¼Œä»è€Œé¿å…æ½œåœ¨çš„å†…å­˜æ³„éœ²ã€‚</li></ul><p>ç¤ºä¾‹ä»£ç ï¼š</p><p>å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªç¼“å­˜ç³»ç»Ÿï¼Œæˆ‘ä»¬ä½¿ç”¨å¼±å¼•ç”¨æ¥ç»´æŠ¤ç¼“å­˜ä¸­çš„å¯¹è±¡ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Java.lang.ref.WeakReference;</span><br><span class="line"><span class="keyword">import</span> Java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> Java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CacheExample</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, WeakReference&lt;MyHeavyObject&gt;&gt; cache = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> MyHeavyObject <span class="title function_">get</span><span class="params">(String key)</span> &#123;</span><br><span class="line">        WeakReference&lt;MyHeavyObject&gt; ref = cache.get(key);</span><br><span class="line">        <span class="keyword">if</span> (ref != <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> ref.get();</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="type">MyHeavyObject</span> <span class="variable">obj</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyHeavyObject</span>();</span><br><span class="line">            cache.put(key, <span class="keyword">new</span> <span class="title class_">WeakReference</span>&lt;&gt;(obj));</span><br><span class="line">            <span class="keyword">return</span> obj;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å‡è®¾MyHeavyObjectæ˜¯ä¸€ä¸ªå ç”¨å¤§é‡å†…å­˜çš„å¯¹è±¡</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">MyHeavyObject</span> &#123;</span><br><span class="line">        <span class="keyword">private</span> <span class="type">byte</span>[] largeData = <span class="keyword">new</span> <span class="title class_">byte</span>[<span class="number">1024</span> * <span class="number">1024</span> * <span class="number">10</span>]; <span class="comment">// 10MB data</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œä½¿ç”¨<code>WeakReference</code>æ¥å­˜å‚¨<code>MyHeavyObject</code>å®ä¾‹ï¼Œå½“å†…å­˜å‹åŠ›å¢å¤§æ—¶ï¼Œåƒåœ¾å›æ”¶å™¨å¯ä»¥è‡ªç”±åœ°å›æ”¶è¿™äº›å¯¹è±¡ï¼Œè€Œä¸ä¼šå½±å“ç¼“å­˜çš„æ­£å¸¸è¿è¡Œã€‚</p><p>å¦‚æœä¸€ä¸ªå¯¹è±¡è¢«åƒåœ¾å›æ”¶ï¼Œä¸‹æ¬¡å°è¯•ä»ç¼“å­˜ä¸­è·å–æ—¶ï¼Œ<code>get()</code>æ–¹æ³•ä¼šè¿”å›<code>null</code>ï¼Œè¿™æ—¶æˆ‘ä»¬å¯ä»¥é‡æ–°åˆ›å»ºå¯¹è±¡å¹¶å°†å…¶æ”¾å…¥ç¼“å­˜ä¸­ã€‚å› æ­¤ï¼Œä½¿ç”¨å¼±å¼•ç”¨æ—¶è¦æ³¨æ„ï¼Œä¸€æ—¦å¯¹è±¡è¢«åƒåœ¾å›æ”¶ï¼Œé€šè¿‡å¼±å¼•ç”¨è·å–çš„å¯¹è±¡å¯èƒ½ä¼šå˜ä¸º<code>null</code>ï¼Œå› æ­¤åœ¨ä½¿ç”¨å‰é€šå¸¸éœ€è¦æ£€æŸ¥è¿™ä¸€ç‚¹ã€‚</p><div class="table-container"><table><thead><tr><th>ç‰¹æ€§</th><th>è½¯å¼•ç”¨ï¼ˆSoftReferenceï¼‰</th><th>å¼±å¼•ç”¨ï¼ˆWeakReferenceï¼‰</th></tr></thead><tbody><tr><td>å›æ”¶æ—¶æœº</td><td>å†…å­˜ä¸è¶³æ—¶æ‰å›æ”¶</td><td>ä¸‹ä¸€æ¬¡ GC å°±å¯èƒ½å›æ”¶</td></tr><tr><td>å­˜æ´»æ—¶é—´</td><td>ç›¸å¯¹æ›´é•¿</td><td>éå¸¸çŸ­ï¼Œéšæ—¶å¯èƒ½è¢«æ¸…é™¤</td></tr><tr><td>é€‚åˆåœºæ™¯</td><td>ç¼“å­˜ï¼ˆä¿ç•™å°½å¯èƒ½å¤šå¯¹è±¡ï¼‰</td><td>æ˜ å°„ã€è¾…åŠ©å¼•ç”¨ã€ç›‘å¬å™¨ã€ThreadLocal ç­‰</td></tr><tr><td>å®‰å…¨æ€§</td><td>æ›´é«˜ï¼ˆå†…å­˜ç´§å¼ æ—¶æ‰å›æ”¶ï¼‰</td><td>æ›´ä½ï¼ˆä¸ç¨³å®šï¼Œéšæ—¶å¯èƒ½ä¸º nullï¼‰</td></tr><tr><td>è¢«ä½¿ç”¨çš„å…¸å‹ç±»</td><td><code>SoftReferenceCache</code></td><td><code>WeakHashMap</code>ã€<code>ThreadLocal</code> åº•å±‚</td></tr></tbody></table></div><h2 id="4-å†…å­˜æ³„æ¼å’Œå†…å­˜æº¢å‡ºçš„ç†è§£ï¼Ÿ"><a href="#4-å†…å­˜æ³„æ¼å’Œå†…å­˜æº¢å‡ºçš„ç†è§£ï¼Ÿ" class="headerlink" title="4.å†…å­˜æ³„æ¼å’Œå†…å­˜æº¢å‡ºçš„ç†è§£ï¼Ÿ"></a>4.å†…å­˜æ³„æ¼å’Œå†…å­˜æº¢å‡ºçš„ç†è§£ï¼Ÿ</h2><p><strong>å†…å­˜æ³„éœ²</strong>ï¼šå†…å­˜æ³„æ¼æ˜¯<strong>æŒ‡ç¨‹åºåœ¨è¿è¡Œè¿‡ç¨‹ä¸­ä¸å†ä½¿ç”¨çš„å¯¹è±¡ä»ç„¶è¢«å¼•ç”¨ï¼Œè€Œæ— æ³•è¢«åƒåœ¾æ”¶é›†å™¨å›æ”¶ï¼Œä»è€Œå¯¼è‡´å¯ç”¨å†…å­˜é€æ¸å‡å°‘ã€‚</strong>è™½ç„¶åœ¨Javaä¸­ï¼Œåƒåœ¾å›æ”¶æœºåˆ¶ä¼šè‡ªåŠ¨å›æ”¶ä¸å†ä½¿ç”¨çš„å¯¹è±¡ï¼Œä½†å¦‚æœæœ‰å¯¹è±¡ä»è¢«ä¸å†ä½¿ç”¨çš„å¼•ç”¨æŒæœ‰ï¼Œåƒåœ¾æ”¶é›†å™¨æ— æ³•å›æ”¶è¿™äº›å†…å­˜ï¼Œæœ€ç»ˆå¯èƒ½å¯¼è‡´ç¨‹åºçš„å†…å­˜ä½¿ç”¨ä¸æ–­å¢åŠ ã€‚</p><p>å†…å­˜æ³„éœ²å¸¸è§åŸå› ï¼š</p><ul><li><strong>é™æ€é›†åˆ</strong>ï¼šä½¿ç”¨é™æ€æ•°æ®ç»“æ„ï¼ˆå¦‚<code>HashMap</code>æˆ–<code>ArrayList</code>ï¼‰å­˜å‚¨å¯¹è±¡ï¼Œä¸”æœªæ¸…ç†ã€‚</li><li><strong>äº‹ä»¶ç›‘å¬</strong>ï¼šæœªå–æ¶ˆå¯¹äº‹ä»¶æºçš„ç›‘å¬ï¼Œå¯¼è‡´å¯¹è±¡æŒç»­è¢«å¼•ç”¨ã€‚</li><li><strong>çº¿ç¨‹</strong>ï¼šæœªåœæ­¢çš„çº¿ç¨‹å¯èƒ½æŒæœ‰å¯¹è±¡å¼•ç”¨ï¼Œæ— æ³•è¢«å›æ”¶ã€‚</li></ul><p>å†…å­˜æº¢å‡ºï¼šå†…å­˜æº¢å‡ºæ˜¯æŒ‡<strong>Javaè™šæ‹Ÿæœºï¼ˆJVMï¼‰åœ¨ç”³è¯·å†…å­˜æ—¶ï¼Œæ— æ³•æ‰¾åˆ°è¶³å¤Ÿçš„å†…å­˜ï¼Œæœ€ç»ˆå¼•å‘<code>OutOfMemoryError</code>ã€‚è¿™é€šå¸¸å‘ç”Ÿåœ¨å †å†…å­˜ä¸è¶³ä»¥å­˜æ”¾æ–°åˆ›å»ºçš„å¯¹è±¡æ—¶ã€‚</strong></p><p>å†…å­˜æº¢å‡ºå¸¸è§åŸå› ï¼š</p><ul><li><strong>å¤§é‡å¯¹è±¡åˆ›å»º</strong>ï¼šç¨‹åºä¸­ä¸æ–­åˆ›å»ºå¤§é‡å¯¹è±¡ï¼Œè¶…å‡ºJVMå †çš„é™åˆ¶ã€‚</li><li><strong>æŒä¹…å¼•ç”¨</strong>ï¼šå¤§å‹æ•°æ®ç»“æ„ï¼ˆå¦‚ç¼“å­˜ã€é›†åˆç­‰ï¼‰é•¿æ—¶é—´æŒæœ‰å¯¹è±¡å¼•ç”¨ï¼Œå¯¼è‡´å†…å­˜ç´¯ç§¯ã€‚</li><li><strong>é€’å½’è°ƒç”¨</strong>ï¼šæ·±åº¦é€’å½’å¯¼è‡´æ ˆæº¢å‡ºã€‚</li></ul><p>å†…å­˜æ³„æ¼æ˜¯è¿˜æ²¡æ»¡ï¼Œå†…å­˜æº¢å‡ºæ˜¯å·²ç»æ»¡äº†</p><h2 id="5-jvm-å†…å­˜ç»“æ„æœ‰å“ªå‡ ç§å†…å­˜æº¢å‡ºçš„æƒ…å†µï¼Ÿ"><a href="#5-jvm-å†…å­˜ç»“æ„æœ‰å“ªå‡ ç§å†…å­˜æº¢å‡ºçš„æƒ…å†µï¼Ÿ" class="headerlink" title="5.jvm å†…å­˜ç»“æ„æœ‰å“ªå‡ ç§å†…å­˜æº¢å‡ºçš„æƒ…å†µï¼Ÿ"></a>5.jvm å†…å­˜ç»“æ„æœ‰å“ªå‡ ç§å†…å­˜æº¢å‡ºçš„æƒ…å†µï¼Ÿ</h2><ul><li><strong>å †å†…å­˜æº¢å‡º</strong>ï¼šå½“å‡ºç°Java.lang.OutOfMemoryError:Java heap spaceå¼‚å¸¸æ—¶ï¼Œå°±æ˜¯å †å†…å­˜æº¢å‡ºäº†ã€‚åŸå› æ˜¯ä»£ç ä¸­<strong>å¯èƒ½å­˜åœ¨å¤§å¯¹è±¡åˆ†é…ï¼Œæˆ–è€…å‘ç”Ÿäº†å†…å­˜æ³„éœ²</strong>ï¼Œå¯¼è‡´åœ¨å¤šæ¬¡GCä¹‹åï¼Œè¿˜æ˜¯æ— æ³•æ‰¾åˆ°ä¸€å—è¶³å¤Ÿå¤§çš„å†…å­˜å®¹çº³å½“å‰å¯¹è±¡ã€‚</li><li><strong>æ ˆæº¢å‡º</strong>ï¼šå¦‚æœæˆ‘ä»¬<strong>å†™ä¸€æ®µç¨‹åºä¸æ–­çš„è¿›è¡Œé€’å½’è°ƒç”¨ï¼Œè€Œä¸”æ²¡æœ‰é€€å‡ºæ¡ä»¶ï¼Œå°±ä¼šå¯¼è‡´ä¸æ–­åœ°è¿›è¡Œå‹æ ˆã€‚</strong>ç±»ä¼¼è¿™ç§æƒ…å†µï¼ŒJVM å®é™…ä¼šæŠ›å‡º StackOverFlowErrorï¼›<strong>å½“ç„¶ï¼Œå¦‚æœ JVM è¯•å›¾å»æ‰©å±•æ ˆç©ºé—´çš„çš„æ—¶å€™å¤±è´¥ï¼Œåˆ™ä¼šæŠ›å‡º OutOfMemoryErrorã€‚</strong></li><li><strong>å…ƒç©ºé—´æº¢å‡º</strong>ï¼šå…ƒç©ºé—´çš„æº¢å‡ºï¼Œç³»ç»Ÿä¼šæŠ›å‡ºJava.lang.OutOfMemoryError: Metaspaceã€‚å‡ºç°è¿™ä¸ªå¼‚å¸¸çš„é—®é¢˜çš„åŸå› æ˜¯<strong>ç³»ç»Ÿçš„ä»£ç éå¸¸å¤šæˆ–å¼•ç”¨çš„ç¬¬ä¸‰æ–¹åŒ…éå¸¸å¤šæˆ–è€…é€šè¿‡åŠ¨æ€ä»£ç ç”Ÿæˆç±»åŠ è½½ç­‰æ–¹æ³•ï¼Œå¯¼è‡´å…ƒç©ºé—´çš„å†…å­˜å ç”¨å¾ˆå¤§ã€‚</strong></li><li><strong>ç›´æ¥å†…å­˜å†…å­˜æº¢å‡º</strong>ï¼šåœ¨ä½¿ç”¨<strong>ByteBufferä¸­çš„allocateDirect()çš„æ—¶å€™ä¼šç”¨åˆ°</strong>ï¼Œå¾ˆå¤šJavaNIO(åƒnetty)çš„æ¡†æ¶ä¸­è¢«å°è£…ä¸ºå…¶ä»–çš„æ–¹æ³•ï¼Œå‡ºç°è¯¥é—®é¢˜æ—¶ä¼šæŠ›å‡ºJava.lang.OutOfMemoryError: Direct buffer memoryå¼‚å¸¸ã€‚</li></ul><p>é™¤äº†<strong>ç¨‹åºè®¡æ•°å™¨</strong>éƒ½ä¼šå‡ºç°OOM</p><h2 id="6-æœ‰å…·ä½“çš„å†…å­˜æ³„æ¼å’Œå†…å­˜æº¢å‡ºçš„ä¾‹å­ä¹ˆè¯·ä¸¾ä¾‹åŠè§£å†³æ–¹æ¡ˆ"><a href="#6-æœ‰å…·ä½“çš„å†…å­˜æ³„æ¼å’Œå†…å­˜æº¢å‡ºçš„ä¾‹å­ä¹ˆè¯·ä¸¾ä¾‹åŠè§£å†³æ–¹æ¡ˆ" class="headerlink" title="6.æœ‰å…·ä½“çš„å†…å­˜æ³„æ¼å’Œå†…å­˜æº¢å‡ºçš„ä¾‹å­ä¹ˆè¯·ä¸¾ä¾‹åŠè§£å†³æ–¹æ¡ˆ?"></a>6.æœ‰å…·ä½“çš„å†…å­˜æ³„æ¼å’Œå†…å­˜æº¢å‡ºçš„ä¾‹å­ä¹ˆè¯·ä¸¾ä¾‹åŠè§£å†³æ–¹æ¡ˆ?</h2><blockquote><p>1ã€é™æ€å±æ€§å¯¼è‡´å†…å­˜æ³„éœ²</p></blockquote><p>ä¼šå¯¼è‡´å†…å­˜æ³„éœ²çš„ä¸€ç§æƒ…å†µå°±æ˜¯<strong>å¤§é‡ä½¿ç”¨staticé™æ€å˜é‡</strong>ã€‚åœ¨Javaä¸­ï¼Œé™æ€å±æ€§çš„ç”Ÿå‘½å‘¨æœŸé€šå¸¸ä¼´éšç€åº”ç”¨æ•´ä¸ªç”Ÿå‘½å‘¨æœŸï¼ˆé™¤éClassLoaderç¬¦åˆåƒåœ¾å›æ”¶çš„æ¡ä»¶ï¼‰ã€‚ä¸‹é¢æ¥çœ‹ä¸€ä¸ªå…·ä½“çš„ä¼šå¯¼è‡´å†…å­˜æ³„éœ²çš„å®ä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">StaticTest</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> List&lt;Double&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">populateList</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">10000000</span>; i++) &#123;</span><br><span class="line">            list.add(Math.random());</span><br><span class="line">        &#125;</span><br><span class="line">        Log.info(<span class="string">&quot;Debug Point 2&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        Log.info(<span class="string">&quot;Debug Point 1&quot;</span>);</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">StaticTest</span>().populateList();</span><br><span class="line">        Log.info(<span class="string">&quot;Debug Point 3&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœç›‘æ§å†…å­˜å †å†…å­˜çš„å˜åŒ–ï¼Œä¼šå‘ç°åœ¨æ‰“å°Point1å’ŒPoint2ä¹‹é—´ï¼Œå †å†…å­˜ä¼šæœ‰ä¸€ä¸ªæ˜æ˜¾çš„å¢é•¿è¶‹åŠ¿å›¾ã€‚ä½†å½“æ‰§è¡Œå®ŒpopulateListæ–¹æ³•ä¹‹åï¼Œå¯¹å †å†…å­˜å¹¶æ²¡æœ‰è¢«åƒåœ¾å›æ”¶å™¨è¿›è¡Œå›æ”¶ã€‚</p><p><img src="https://cdn.xiaolincoding.com//picgo/image-20240820112907539.png" alt="image-20240820112907539"></p><p>ä½†é’ˆå¯¹ä¸Šè¿°ç¨‹åºï¼Œå¦‚æœå°†å®šä¹‰listçš„å˜é‡å‰çš„staticå…³é”®å­—å»æ‰ï¼Œå†æ¬¡æ‰§è¡Œç¨‹åºï¼Œä¼šå‘ç°å†…å­˜å‘ç”Ÿäº†å…·ä½“çš„å˜åŒ–ã€‚VisualVMç›‘æ§ä¿¡æ¯å¦‚ä¸‹å›¾ï¼š</p><p><img src="https://cdn.xiaolincoding.com//picgo/image-20240820112851893.png" alt="image-20240820112851893"></p><p>å¯¹æ¯”ä¸¤ä¸ªå›¾å¯ä»¥çœ‹å‡ºï¼Œç¨‹åºæ‰§è¡Œçš„å‰åŠéƒ¨åˆ†å†…å­˜ä½¿ç”¨æƒ…å†µéƒ½ä¸€æ ·ï¼Œä½†å½“æ‰§è¡Œå®ŒpopulateListæ–¹æ³•ä¹‹åï¼Œåè€…ä¸å†æœ‰å¼•ç”¨æŒ‡å‘å¯¹åº”çš„æ•°æ®ï¼Œåƒåœ¾å›æ”¶å™¨ä¾¿è¿›è¡Œäº†å›æ”¶æ“ä½œã€‚å› æ­¤ï¼Œæˆ‘ä»¬è¦ååˆ†ç•™æ„staticçš„å˜é‡ï¼Œ<strong>å¦‚æœé›†åˆæˆ–å¤§é‡çš„å¯¹è±¡å®šä¹‰ä¸ºstaticçš„ï¼Œå®ƒä»¬ä¼šåœç•™åœ¨æ•´ä¸ªåº”ç”¨ç¨‹åºçš„ç”Ÿå‘½å‘¨æœŸå½“ä¸­ã€‚è€Œå®ƒä»¬æ‰€å ç”¨çš„å†…å­˜ç©ºé—´ï¼Œæœ¬å¯ä»¥ç”¨äºå…¶ä»–åœ°æ–¹ã€‚</strong></p><p>é‚£ä¹ˆå¦‚ä½•ä¼˜åŒ–å‘¢ï¼Ÿ<strong>ç¬¬ä¸€ï¼Œè¿›æ¥å‡å°‘é™æ€å˜é‡ï¼›ç¬¬äºŒï¼Œå¦‚æœä½¿ç”¨å•ä¾‹ï¼Œå°½é‡é‡‡ç”¨æ‡’åŠ è½½ã€‚</strong></p><blockquote><p>2ã€ æœªå…³é—­çš„èµ„æº</p></blockquote><p>æ— è®ºä»€ä¹ˆæ—¶å€™å½“æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªè¿æ¥æˆ–æ‰“å¼€ä¸€ä¸ªæµï¼ŒJVMéƒ½ä¼šåˆ†é…å†…å­˜ç»™è¿™äº›èµ„æºã€‚æ¯”å¦‚ï¼Œæ•°æ®åº“é“¾æ¥ã€è¾“å…¥æµå’Œsessionå¯¹è±¡ã€‚</p><p><strong>å¿˜è®°å…³é—­è¿™äº›èµ„æºï¼Œä¼šé˜»å¡å†…å­˜ï¼Œä»è€Œå¯¼è‡´GCæ— æ³•è¿›è¡Œæ¸…ç†ã€‚</strong>ç‰¹åˆ«æ˜¯å½“ç¨‹åºå‘ç”Ÿå¼‚å¸¸æ—¶ï¼Œæ²¡æœ‰åœ¨finallyä¸­è¿›è¡Œèµ„æºå…³é—­çš„æƒ…å†µã€‚è¿™äº›æœªæ­£å¸¸å…³é—­çš„è¿æ¥ï¼Œå¦‚æœä¸è¿›è¡Œå¤„ç†ï¼Œè½»åˆ™å½±å“ç¨‹åºæ€§èƒ½ï¼Œé‡åˆ™å¯¼è‡´OutOfMemoryErrorå¼‚å¸¸å‘ç”Ÿã€‚</p><p>å¦‚æœè¿›è¡Œå¤„ç†å‘¢ï¼Ÿ<strong>ç¬¬ä¸€ï¼Œå§‹ç»ˆè®°å¾—åœ¨finallyä¸­è¿›è¡Œèµ„æºçš„å…³é—­ï¼›ç¬¬äºŒï¼Œå…³é—­è¿æ¥çš„è‡ªèº«ä»£ç ä¸èƒ½å‘ç”Ÿå¼‚å¸¸ï¼›ç¬¬ä¸‰ï¼ŒJava7ä»¥ä¸Šç‰ˆæœ¬å¯ä½¿ç”¨try-with-resourcesä»£ç æ–¹å¼è¿›è¡Œèµ„æºå…³é—­ã€‚</strong></p><p>try-with-resources:</p><p><code>try()</code> ä¸­å®šä¹‰çš„å¯¹è±¡ï¼Œå¿…é¡»å®ç° <code>AutoCloseable</code> æ¥å£ï¼ˆ<code>Closeable</code> ä¹Ÿå¯ä»¥ï¼Œé—´æ¥ç»§æ‰¿ï¼‰ï¼›</p><p>try å—æ‰§è¡Œå®Œåï¼ŒJava ä¼šè‡ªåŠ¨è°ƒç”¨è¿™äº›èµ„æºçš„ <code>.close()</code> æ–¹æ³•ï¼›</p><blockquote><p>3ã€ ä½¿ç”¨ThreadLocal</p></blockquote><p>ThreadLocalæä¾›äº†<strong>çº¿ç¨‹æœ¬åœ°å˜é‡</strong>ï¼Œå®ƒå¯ä»¥ä¿è¯è®¿é—®åˆ°çš„å˜é‡å±äºå½“å‰çº¿ç¨‹ï¼Œæ¯ä¸ªçº¿ç¨‹éƒ½ä¿å­˜æœ‰ä¸€ä¸ªå˜é‡å‰¯æœ¬ï¼Œæ¯ä¸ªçº¿ç¨‹çš„å˜é‡éƒ½ä¸åŒã€‚<strong>ThreadLocalç›¸å½“äºæä¾›äº†ä¸€ç§çº¿ç¨‹éš”ç¦»</strong>ï¼Œå°†å˜é‡ä¸çº¿ç¨‹ç›¸ç»‘å®šï¼Œä»è€Œå®ç°çº¿ç¨‹å®‰å…¨çš„ç‰¹æ€§ã€‚</p><p><img src="https://cdn.xiaolincoding.com//picgo/image-20240820112835783.png" alt="image-20240820112835783"></p><p>ThreadLocalçš„å®ç°ä¸­ï¼Œ<strong>æ¯ä¸ªThreadç»´æŠ¤ä¸€ä¸ªThreadLocalMapæ˜ å°„è¡¨ï¼Œkeyæ˜¯ThreadLocalå®ä¾‹æœ¬èº«ï¼Œvalueæ˜¯çœŸæ­£éœ€è¦å­˜å‚¨çš„Objectã€‚</strong></p><p>ThreadLocalMapä½¿ç”¨ThreadLocalçš„<strong>å¼±å¼•ç”¨ä½œä¸ºkey</strong>ï¼Œå¦‚æœä¸€ä¸ªThreadLocal<strong>æ²¡æœ‰å¤–éƒ¨å¼ºå¼•ç”¨æ¥å¼•ç”¨å®ƒï¼Œé‚£ä¹ˆç³»ç»ŸGCæ—¶ï¼Œè¿™ä¸ªThreadLocalåŠ¿å¿…ä¼šè¢«å›æ”¶ï¼Œè¿™æ ·ä¸€æ¥ï¼ŒThreadLocalMapä¸­å°±ä¼šå‡ºç°keyä¸ºnullçš„Entryï¼Œå°±æ²¡æœ‰åŠæ³•è®¿é—®è¿™äº›keyä¸ºnullçš„Entryçš„valueã€‚</strong></p><p>å¦‚æœå½“å‰çº¿ç¨‹è¿Ÿè¿Ÿä¸ç»“æŸçš„è¯ï¼Œ<strong>è¿™äº›keyä¸ºnullçš„Entryçš„valueå°±ä¼šä¸€ç›´å­˜åœ¨ä¸€æ¡å¼ºå¼•ç”¨é“¾</strong>ï¼šThread Ref -&gt; Thread -&gt; ThreaLocalMap -&gt; Entry -&gt; valueæ°¸è¿œæ— æ³•å›æ”¶ï¼Œé€ æˆå†…å­˜æ³„æ¼ã€‚</p><p>å¦‚ä½•è§£å†³æ­¤é—®é¢˜ï¼Ÿ</p><ul><li>ç¬¬ä¸€ï¼Œ<strong>ä½¿ç”¨ThreadLocalæä¾›çš„removeæ–¹æ³•ï¼Œå¯å¯¹å½“å‰çº¿ç¨‹ä¸­çš„valueå€¼è¿›è¡Œç§»é™¤</strong>ï¼›</li><li>ç¬¬äºŒï¼Œä¸è¦ä½¿ç”¨ThreadLocal.set(null) çš„æ–¹å¼æ¸…é™¤valueï¼Œå®ƒå®é™…ä¸Šå¹¶æ²¡æœ‰æ¸…é™¤å€¼ï¼Œè€Œæ˜¯<strong>æŸ¥æ‰¾ä¸å½“å‰çº¿ç¨‹å…³è”çš„Mapå¹¶å°†é”®å€¼å¯¹åˆ†åˆ«è®¾ç½®ä¸ºå½“å‰çº¿ç¨‹å’Œnullã€‚</strong></li><li>ç¬¬ä¸‰ï¼Œ<strong>æœ€å¥½å°†ThreadLocalè§†ä¸ºéœ€è¦åœ¨finallyå—ä¸­å…³é—­çš„èµ„æºï¼Œä»¥ç¡®ä¿å³ä½¿åœ¨å‘ç”Ÿå¼‚å¸¸çš„æƒ…å†µä¸‹ä¹Ÿå§‹ç»ˆå…³é—­è¯¥èµ„æºã€‚</strong></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    threadLocal.set(System.nanoTime());</span><br><span class="line">    <span class="comment">//... further processing</span></span><br><span class="line">&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">    threadLocal.remove();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="ç±»çš„åŠ è½½"><a href="#ç±»çš„åŠ è½½" class="headerlink" title="ç±»çš„åŠ è½½"></a>ç±»çš„åŠ è½½</h1><h2 id="1-åˆ›å»ºå¯¹è±¡çš„è¿‡ç¨‹ï¼Ÿ"><a href="#1-åˆ›å»ºå¯¹è±¡çš„è¿‡ç¨‹ï¼Ÿ" class="headerlink" title="1.åˆ›å»ºå¯¹è±¡çš„è¿‡ç¨‹ï¼Ÿ"></a>1.åˆ›å»ºå¯¹è±¡çš„è¿‡ç¨‹ï¼Ÿ</h2><p>åœ¨Javaä¸­åˆ›å»ºå¯¹è±¡çš„è¿‡ç¨‹åŒ…æ‹¬ä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š</p><ol><li><strong>ç±»åŠ è½½æ£€æŸ¥</strong>ï¼šè™šæ‹Ÿæœºé‡åˆ°ä¸€æ¡ new æŒ‡ä»¤æ—¶ï¼Œé¦–å…ˆå°†å»æ£€æŸ¥è¿™ä¸ªæŒ‡ä»¤çš„å‚æ•°æ˜¯å¦èƒ½åœ¨<strong>å¸¸é‡æ± </strong>ä¸­å®šä½åˆ°ä¸€ä¸ªç±»çš„<strong>ç¬¦å·å¼•ç”¨</strong>ï¼Œå¹¶ä¸”æ£€æŸ¥è¿™ä¸ªç¬¦å·å¼•ç”¨ä»£è¡¨çš„ç±»æ˜¯å¦å·²è¢«<strong>åŠ è½½è¿‡ã€è§£æå’Œåˆå§‹åŒ–</strong>è¿‡ã€‚å¦‚æœæ²¡æœ‰ï¼Œé‚£å¿…é¡»å…ˆæ‰§è¡Œç›¸åº”çš„<strong>ç±»åŠ è½½è¿‡ç¨‹</strong>ã€‚</li><li><strong>åˆ†é…å†…å­˜</strong>ï¼šåœ¨ç±»åŠ è½½æ£€æŸ¥é€šè¿‡åï¼Œæ¥ä¸‹æ¥è™šæ‹Ÿæœºå°†ä¸º<strong>æ–°ç”Ÿå¯¹è±¡åˆ†é…å†…å­˜</strong>ã€‚å¯¹è±¡æ‰€éœ€çš„<strong>å†…å­˜å¤§å°</strong>åœ¨<strong>ç±»åŠ è½½</strong>å®Œæˆåä¾¿å¯ç¡®å®šï¼Œä¸ºå¯¹è±¡åˆ†é…ç©ºé—´çš„ä»»åŠ¡ç­‰åŒäºæŠŠä¸€å—ç¡®å®šå¤§å°çš„å†…å­˜ä» Java å †ä¸­åˆ’åˆ†å‡ºæ¥ã€‚</li><li><strong>åˆå§‹åŒ–é›¶å€¼</strong>ï¼šå†…å­˜åˆ†é…å®Œæˆåï¼Œè™šæ‹Ÿæœºéœ€è¦<strong>å°†åˆ†é…åˆ°çš„å†…å­˜ç©ºé—´éƒ½åˆå§‹åŒ–ä¸ºé›¶å€¼</strong>ï¼ˆä¸åŒ…æ‹¬å¯¹è±¡å¤´ï¼‰ï¼Œè¿™ä¸€æ­¥æ“ä½œä¿è¯äº†å¯¹è±¡çš„å®ä¾‹å­—æ®µåœ¨ Java ä»£ç ä¸­å¯ä»¥ä¸èµ‹åˆå§‹å€¼å°±ç›´æ¥ä½¿ç”¨ï¼Œç¨‹åºèƒ½è®¿é—®åˆ°è¿™äº›å­—æ®µçš„æ•°æ®ç±»å‹æ‰€å¯¹åº”çš„é›¶å€¼ã€‚</li><li><strong>è¿›è¡Œå¿…è¦è®¾ç½®ï¼Œæ¯”å¦‚å¯¹è±¡å¤´</strong>ï¼šåˆå§‹åŒ–é›¶å€¼å®Œæˆä¹‹åï¼Œè™šæ‹Ÿæœºè¦å¯¹å¯¹è±¡è¿›è¡Œ<strong>å¿…è¦çš„è®¾ç½®</strong>ï¼Œä¾‹å¦‚è¿™ä¸ªå¯¹è±¡æ˜¯å“ªä¸ªç±»çš„å®ä¾‹ã€å¦‚ä½•æ‰èƒ½æ‰¾åˆ°ç±»çš„å…ƒæ•°æ®ä¿¡æ¯ã€å¯¹è±¡çš„å“ˆå¸Œç ã€å¯¹è±¡çš„ GC åˆ†ä»£å¹´é¾„ç­‰ä¿¡æ¯ã€‚è¿™äº›ä¿¡æ¯å­˜æ”¾åœ¨<strong>å¯¹è±¡å¤´</strong>ä¸­ã€‚å¦å¤–ï¼Œæ ¹æ®è™šæ‹Ÿæœºå½“å‰è¿è¡ŒçŠ¶æ€çš„ä¸åŒï¼Œå¦‚æ˜¯å¦å¯ç”¨åå‘é”ç­‰ï¼Œå¯¹è±¡å¤´ä¼šæœ‰ä¸åŒçš„è®¾ç½®æ–¹å¼ã€‚</li><li><strong>æ‰§è¡Œ init æ–¹æ³•</strong>ï¼šåœ¨ä¸Šé¢å·¥ä½œéƒ½å®Œæˆä¹‹åï¼Œä»è™šæ‹Ÿæœºçš„è§†è§’æ¥çœ‹ï¼Œä¸€ä¸ªæ–°çš„å¯¹è±¡å·²ç»äº§ç”Ÿäº†ï¼Œä½†ä» Java ç¨‹åºçš„è§†è§’æ¥çœ‹ï¼Œå¯¹è±¡åˆ›å»ºæ‰åˆšå¼€å§‹â€”â€”æ„é€ å‡½æ•°ï¼Œå³classæ–‡ä»¶ä¸­çš„æ–¹æ³•è¿˜æ²¡æœ‰æ‰§è¡Œï¼Œæ‰€æœ‰çš„å­—æ®µéƒ½è¿˜ä¸ºé›¶ï¼Œ<strong>å¯¹è±¡éœ€è¦çš„å…¶ä»–èµ„æºå’ŒçŠ¶æ€ä¿¡æ¯</strong>è¿˜æ²¡æœ‰æŒ‰ç…§é¢„å®šçš„æ„å›¾æ„é€ å¥½ã€‚æ‰€<strong>ä»¥ä¸€èˆ¬æ¥è¯´ï¼Œæ‰§è¡Œ new æŒ‡ä»¤ä¹‹åä¼šæ¥ç€æ‰§è¡Œæ–¹æ³•ï¼ŒæŠŠå¯¹è±¡æŒ‰ç…§ç¨‹åºå‘˜çš„æ„æ„¿è¿›è¡Œåˆå§‹åŒ–ï¼Œè¿™æ ·ä¸€ä¸ªçœŸæ­£å¯ç”¨çš„å¯¹è±¡æ‰ç®—å®Œå…¨è¢«æ„é€ å‡ºæ¥ã€‚</strong></li></ol><h2 id="2-å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸ"><a href="#2-å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸ" class="headerlink" title="2.å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸ"></a>2.å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸ</h2><p>å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸåŒ…æ‹¬åˆ›å»ºã€ä½¿ç”¨å’Œé”€æ¯ä¸‰ä¸ªé˜¶æ®µï¼š</p><ul><li>åˆ›å»ºï¼šå¯¹è±¡é€šè¿‡<strong>å…³é”®å­—newåœ¨å †å†…å­˜ä¸­è¢«å®ä¾‹åŒ–</strong>ï¼Œæ„é€ å‡½æ•°è¢«è°ƒç”¨ï¼Œå¯¹è±¡çš„å†…å­˜ç©ºé—´è¢«åˆ†é…ã€‚</li><li>ä½¿ç”¨ï¼šå¯¹è±¡è¢«å¼•ç”¨å¹¶æ‰§è¡Œç›¸åº”çš„æ“ä½œï¼Œå¯ä»¥é€šè¿‡å¼•ç”¨è®¿é—®å¯¹è±¡çš„å±æ€§å’Œæ–¹æ³•ï¼Œåœ¨ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­è¢«ä¸æ–­ä½¿ç”¨ã€‚</li><li>é”€æ¯ï¼šå½“å¯¹è±¡ä¸å†è¢«å¼•ç”¨æ—¶ï¼Œé€šè¿‡<strong>åƒåœ¾å›æ”¶æœºåˆ¶è‡ªåŠ¨å›æ”¶å¯¹è±¡æ‰€å ç”¨çš„å†…å­˜ç©ºé—´</strong>ã€‚åƒåœ¾å›æ”¶å™¨ä¼šåœ¨é€‚å½“çš„æ—¶å€™æ£€æµ‹å¹¶å›æ”¶ä¸å†è¢«å¼•ç”¨çš„å¯¹è±¡ï¼Œé‡Šæ”¾å¯¹è±¡å ç”¨çš„å†…å­˜ç©ºé—´ï¼Œå®Œæˆå¯¹è±¡çš„é”€æ¯è¿‡ç¨‹ã€‚</li></ul><h2 id="3-ç±»åŠ è½½å™¨æœ‰å“ªäº›ï¼Ÿ"><a href="#3-ç±»åŠ è½½å™¨æœ‰å“ªäº›ï¼Ÿ" class="headerlink" title="3.ç±»åŠ è½½å™¨æœ‰å“ªäº›ï¼Ÿ"></a>3.ç±»åŠ è½½å™¨æœ‰å“ªäº›ï¼Ÿ</h2><p><img src="https://cdn.xiaolincoding.com//picgo/1719491243997-d62ceba6-2073-41a6-8320-dbe47ce9dbe4.png" alt=""></p><ul><li><strong>å¯åŠ¨ç±»åŠ è½½å™¨ï¼ˆBootstrap Class Loaderï¼‰</strong>ï¼šè¿™æ˜¯<strong>æœ€é¡¶å±‚çš„ç±»åŠ è½½å™¨</strong>ï¼Œè´Ÿè´£åŠ è½½Javaçš„æ ¸å¿ƒåº“ï¼ˆå¦‚ä½äºjre/lib/rt.jarä¸­çš„ç±»ï¼‰ï¼Œå®ƒæ˜¯ç”¨C++ç¼–å†™çš„ï¼Œæ˜¯JVMçš„ä¸€éƒ¨åˆ†ã€‚å¯åŠ¨ç±»åŠ è½½å™¨æ— æ³•è¢«Javaç¨‹åºç›´æ¥å¼•ç”¨ã€‚</li><li><strong>æ‰©å±•ç±»åŠ è½½å™¨ï¼ˆExtension Class Loaderï¼‰</strong>ï¼šå®ƒæ˜¯Javaè¯­è¨€å®ç°çš„ï¼Œ<strong>ç»§æ‰¿è‡ªClassLoaderç±»</strong>ï¼Œè´Ÿè´£åŠ è½½Javaæ‰©å±•ç›®å½•ï¼ˆjre/lib/extæˆ–ç”±ç³»ç»Ÿå˜é‡Java.ext.dirsæŒ‡å®šçš„ç›®å½•ï¼‰ä¸‹çš„jaråŒ…å’Œç±»åº“ã€‚<strong>æ‰©å±•ç±»åŠ è½½å™¨ç”±å¯åŠ¨ç±»åŠ è½½å™¨åŠ è½½ï¼Œå¹¶ä¸”çˆ¶åŠ è½½å™¨å°±æ˜¯å¯åŠ¨ç±»åŠ è½½å™¨ã€‚</strong></li><li><strong>ç³»ç»Ÿç±»åŠ è½½å™¨ï¼ˆSystem Class Loaderï¼‰/ åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨ï¼ˆApplication Class Loaderï¼‰</strong>ï¼šè¿™ä¹Ÿæ˜¯Javaè¯­è¨€å®ç°çš„ï¼Œ<strong>è´Ÿè´£åŠ è½½ç”¨æˆ·ç±»è·¯å¾„ï¼ˆClassPathï¼‰ä¸Šçš„æŒ‡å®šç±»åº“</strong>ï¼Œæ˜¯æˆ‘ä»¬å¹³æ—¶ç¼–å†™Javaç¨‹åºæ—¶é»˜è®¤ä½¿ç”¨çš„ç±»åŠ è½½å™¨ã€‚ç³»ç»Ÿç±»åŠ è½½å™¨çš„çˆ¶åŠ è½½å™¨æ˜¯æ‰©å±•ç±»åŠ è½½å™¨ã€‚å®ƒå¯ä»¥é€šè¿‡ClassLoader.getSystemClassLoader()æ–¹æ³•è·å–åˆ°ã€‚</li><li><strong>è‡ªå®šä¹‰ç±»åŠ è½½å™¨ï¼ˆCustom Class Loaderï¼‰</strong>ï¼šå¼€å‘è€…å¯ä»¥æ ¹æ®éœ€æ±‚å®šåˆ¶ç±»çš„åŠ è½½æ–¹å¼ï¼Œæ¯”å¦‚ä»ç½‘ç»œåŠ è½½classæ–‡ä»¶ã€æ•°æ®åº“ã€ç”šè‡³æ˜¯åŠ å¯†çš„æ–‡ä»¶ä¸­åŠ è½½ç±»ç­‰ã€‚è‡ªå®šä¹‰ç±»åŠ è½½å™¨å¯ä»¥ç”¨æ¥æ‰©å±•Javaåº”ç”¨ç¨‹åºçš„çµæ´»æ€§å’Œå®‰å…¨æ€§ï¼Œæ˜¯JavaåŠ¨æ€æ€§çš„ä¸€ä¸ªé‡è¦ä½“ç°ã€‚</li></ul><p>è¿™äº›ç±»åŠ è½½å™¨ä¹‹é—´çš„å…³ç³»å½¢æˆäº†åŒäº²å§”æ´¾æ¨¡å‹ï¼Œå…¶æ ¸å¿ƒæ€æƒ³æ˜¯å½“ä¸€ä¸ªç±»åŠ è½½å™¨æ”¶åˆ°ç±»åŠ è½½çš„è¯·æ±‚æ—¶ï¼Œé¦–å…ˆä¸ä¼šè‡ªå·±å»å°è¯•åŠ è½½è¿™ä¸ªç±»ï¼Œ<strong>è€Œæ˜¯æŠŠè¿™ä¸ªè¯·æ±‚å§”æ´¾ç»™çˆ¶ç±»åŠ è½½å™¨å»å®Œæˆï¼Œæ¯ä¸€å±‚æ¬¡çš„ç±»åŠ è½½å™¨éƒ½æ˜¯å¦‚æ­¤ï¼Œå› æ­¤æ‰€æœ‰çš„åŠ è½½è¯·æ±‚æœ€ç»ˆéƒ½åº”è¯¥ä¼ é€åˆ°é¡¶å±‚çš„å¯åŠ¨ç±»åŠ è½½å™¨ä¸­ã€‚</strong></p><p>åªæœ‰å½“çˆ¶åŠ è½½å™¨åé¦ˆè‡ªå·±æ— æ³•å®Œæˆè¿™ä¸ªåŠ è½½è¯·æ±‚ï¼ˆå®ƒçš„æœç´¢èŒƒå›´ä¸­æ²¡æœ‰æ‰¾åˆ°æ‰€éœ€çš„ç±»ï¼‰æ—¶ï¼Œå­åŠ è½½å™¨æ‰ä¼šå°è¯•è‡ªå·±å»åŠ è½½</p><h2 id="3-åŒäº²å§”æ´¾æ¨¡å‹çš„ä½œç”¨"><a href="#3-åŒäº²å§”æ´¾æ¨¡å‹çš„ä½œç”¨" class="headerlink" title="3.åŒäº²å§”æ´¾æ¨¡å‹çš„ä½œç”¨"></a>3.åŒäº²å§”æ´¾æ¨¡å‹çš„ä½œç”¨</h2><ul><li><strong>ä¿è¯ç±»çš„å”¯ä¸€æ€§</strong>ï¼šé€šè¿‡å§”æ‰˜æœºåˆ¶ï¼Œ<strong>ç¡®ä¿äº†æ‰€æœ‰åŠ è½½è¯·æ±‚éƒ½ä¼šä¼ é€’åˆ°å¯åŠ¨ç±»åŠ è½½å™¨ï¼Œé¿å…äº†ä¸åŒç±»åŠ è½½å™¨é‡å¤åŠ è½½ç›¸åŒç±»çš„æƒ…å†µ</strong>ï¼Œä¿è¯äº†Javaæ ¸å¿ƒç±»åº“çš„ç»Ÿä¸€æ€§ï¼Œä¹Ÿé˜²æ­¢äº†ç”¨æˆ·è‡ªå®šä¹‰ç±»è¦†ç›–æ ¸å¿ƒç±»åº“çš„å¯èƒ½ã€‚</li><li><strong>ä¿è¯å®‰å…¨æ€§</strong>ï¼šç”±äºJavaæ ¸å¿ƒåº“è¢«å¯åŠ¨ç±»åŠ è½½å™¨åŠ è½½ï¼Œè€Œ<strong>å¯åŠ¨ç±»åŠ è½½å™¨åªåŠ è½½ä¿¡ä»»çš„ç±»è·¯å¾„ä¸­çš„ç±»</strong>ï¼Œè¿™æ ·å¯ä»¥é˜²æ­¢ä¸å¯ä¿¡çš„ç±»å‡å†’æ ¸å¿ƒç±»ï¼Œå¢å¼ºäº†ç³»ç»Ÿçš„å®‰å…¨æ€§ã€‚ä¾‹å¦‚ï¼Œæ¶æ„ä»£ç æ— æ³•è‡ªå®šä¹‰ä¸€ä¸ªJava.lang.Systemç±»å¹¶åŠ è½½åˆ°JVMä¸­ï¼Œå› ä¸ºè¿™ä¸ªè¯·æ±‚ä¼šè¢«å§”æ‰˜ç»™å¯åŠ¨ç±»åŠ è½½å™¨ï¼Œè€Œå¯åŠ¨ç±»åŠ è½½å™¨åªä¼šåŠ è½½æ ‡å‡†çš„Javaåº“ä¸­çš„ç±»ã€‚</li><li><strong>æ”¯æŒéš”ç¦»å’Œå±‚æ¬¡åˆ’åˆ†</strong>ï¼šåŒäº²å§”æ´¾æ¨¡å‹<strong>æ”¯æŒä¸åŒå±‚æ¬¡çš„ç±»åŠ è½½å™¨æœåŠ¡äºä¸åŒçš„ç±»åŠ è½½éœ€æ±‚</strong>ï¼Œå¦‚åº”ç”¨ç¨‹åºç±»åŠ è½½å™¨åŠ è½½ç”¨æˆ·ä»£ç ï¼Œæ‰©å±•ç±»åŠ è½½å™¨åŠ è½½æ‰©å±•æ¡†æ¶ï¼Œå¯åŠ¨ç±»åŠ è½½å™¨åŠ è½½æ ¸å¿ƒåº“ã€‚è¿™ç§å±‚æ¬¡åŒ–çš„åˆ’åˆ†æœ‰åŠ©äºå®ç°æ²™ç®±å®‰å…¨æœºåˆ¶ï¼Œä¿è¯äº†å„ä¸ªå±‚çº§ç±»åŠ è½½å™¨çš„èŒè´£æ¸…æ™°ï¼Œä¹Ÿä¾¿äºç»´æŠ¤å’Œæ‰©å±•ã€‚</li><li><strong>ç®€åŒ–äº†åŠ è½½æµç¨‹</strong>ï¼šé€šè¿‡å§”æ´¾ï¼Œ<strong>å¤§éƒ¨åˆ†ç±»èƒ½å¤Ÿè¢«æ­£ç¡®çš„ç±»åŠ è½½å™¨åŠ è½½ï¼Œå‡å°‘äº†æ¯ä¸ªåŠ è½½å™¨éœ€è¦å¤„ç†çš„ç±»çš„æ•°é‡ï¼Œç®€åŒ–äº†ç±»çš„åŠ è½½è¿‡ç¨‹ï¼Œæé«˜äº†åŠ è½½æ•ˆç‡ã€‚</strong></li></ul><h2 id="4-è®²ä¸€ä¸‹ç±»åŠ è½½è¿‡ç¨‹ï¼Ÿ"><a href="#4-è®²ä¸€ä¸‹ç±»åŠ è½½è¿‡ç¨‹ï¼Ÿ" class="headerlink" title="4.è®²ä¸€ä¸‹ç±»åŠ è½½è¿‡ç¨‹ï¼Ÿ"></a>4.è®²ä¸€ä¸‹ç±»åŠ è½½è¿‡ç¨‹ï¼Ÿ</h2><h3 id=""><a href="#" class="headerlink" title=""></a><img src="https://cdn.xiaolincoding.com//picgo/1719491354969-a7c861d7-531e-45d3-a4aa-4696710ec297.webp" alt=""></h3><ul><li><strong>åŠ è½½</strong>ï¼šé€šè¿‡ç±»çš„å…¨é™å®šåï¼ˆåŒ…å + ç±»åï¼‰ï¼Œè·å–åˆ°è¯¥ç±»çš„.classæ–‡ä»¶çš„äºŒè¿›åˆ¶å­—èŠ‚æµï¼Œå°†äºŒè¿›åˆ¶å­—èŠ‚æµæ‰€ä»£è¡¨çš„é™æ€å­˜å‚¨ç»“æ„ï¼Œ<strong>è½¬åŒ–ä¸ºæ–¹æ³•åŒºè¿è¡Œæ—¶çš„æ•°æ®ç»“æ„</strong>ï¼Œåœ¨å†…å­˜ä¸­ç”Ÿæˆä¸€ä¸ªä»£è¡¨è¯¥ç±»çš„Java.lang.Classå¯¹è±¡ï¼Œä½œä¸ºæ–¹æ³•åŒºè¿™ä¸ªç±»çš„å„ç§æ•°æ®çš„è®¿é—®å…¥å£</li><li><strong>è¿æ¥</strong>ï¼šéªŒè¯ã€å‡†å¤‡ã€è§£æ 3 ä¸ªé˜¶æ®µç»Ÿç§°ä¸ºè¿æ¥ã€‚<ul><li><strong>éªŒè¯</strong>ï¼š<strong>ç¡®ä¿classæ–‡ä»¶ä¸­çš„å­—èŠ‚æµåŒ…å«çš„ä¿¡æ¯ï¼Œç¬¦åˆå½“å‰è™šæ‹Ÿæœºçš„è¦æ±‚</strong>ï¼Œä¿è¯è¿™ä¸ªè¢«åŠ è½½çš„classç±»çš„æ­£ç¡®æ€§ï¼Œä¸ä¼šå±å®³åˆ°è™šæ‹Ÿæœºçš„å®‰å…¨ã€‚éªŒè¯é˜¶æ®µå¤§è‡´ä¼šå®Œæˆä»¥ä¸‹å››ä¸ªé˜¶æ®µçš„æ£€éªŒåŠ¨ä½œï¼šæ–‡ä»¶æ ¼å¼æ ¡éªŒã€å…ƒæ•°æ®éªŒè¯ã€å­—èŠ‚ç éªŒè¯ã€ç¬¦å·å¼•ç”¨éªŒè¯</li><li><strong>å‡†å¤‡</strong>ï¼šä¸ºç±»ä¸­çš„<strong>é™æ€å­—æ®µåˆ†é…å†…å­˜ï¼Œå¹¶è®¾ç½®é»˜è®¤çš„åˆå§‹å€¼</strong>ï¼Œæ¯”å¦‚intç±»å‹åˆå§‹å€¼æ˜¯0ã€‚è¢«finalä¿®é¥°çš„staticå­—æ®µä¸ä¼šè®¾ç½®ï¼Œå› ä¸ºfinalåœ¨ç¼–è¯‘çš„æ—¶å€™å°±åˆ†é…äº†</li><li><strong>è§£æ</strong>ï¼šè§£æé˜¶æ®µæ˜¯<strong>è™šæ‹Ÿæœºå°†å¸¸é‡æ± çš„ã€Œç¬¦å·å¼•ç”¨ã€ç›´æ¥æ›¿æ¢ä¸ºã€Œç›´æ¥å¼•ç”¨ã€çš„è¿‡ç¨‹</strong>ã€‚ç¬¦å·å¼•ç”¨æ˜¯ä»¥ä¸€ç»„ç¬¦å·æ¥æè¿°æ‰€å¼•ç”¨çš„ç›®æ ‡ï¼Œç¬¦å·å¯ä»¥æ˜¯ä»»ä½•å½¢å¼çš„å­—é¢é‡ï¼Œåªè¦ä½¿ç”¨çš„æ—¶å€™å¯ä»¥æ— æ­§ä¹‰åœ°å®šä½åˆ°ç›®æ ‡å³å¯ã€‚ç›´æ¥å¼•ç”¨å¯ä»¥æ˜¯ç›´æ¥æŒ‡å‘ç›®æ ‡çš„æŒ‡é’ˆã€ç›¸å¯¹åç§»é‡æˆ–æ˜¯ä¸€ä¸ªèƒ½é—´æ¥å®šä½åˆ°ç›®æ ‡çš„å¥æŸ„ï¼Œç›´æ¥å¼•ç”¨æ˜¯å’Œè™šæ‹Ÿæœºå®ç°çš„å†…å­˜å¸ƒå±€ç›¸å…³çš„ã€‚å¦‚æœæœ‰äº†ç›´æ¥å¼•ç”¨ï¼Œ é‚£å¼•ç”¨çš„ç›®æ ‡å¿…å®šå·²ç»å­˜åœ¨åœ¨å†…å­˜ä¸­äº†ã€‚</li></ul></li><li><strong>åˆå§‹åŒ–</strong>ï¼šåˆå§‹åŒ–æ˜¯æ•´ä¸ªç±»åŠ è½½è¿‡ç¨‹çš„æœ€åä¸€ä¸ªé˜¶æ®µï¼Œåˆå§‹åŒ–é˜¶æ®µç®€å•æ¥è¯´å°±æ˜¯<strong>æ‰§è¡Œç±»çš„æ„é€ å™¨æ–¹æ³•ï¼ˆ()</strong> ï¼‰ï¼Œè¦æ³¨æ„çš„æ˜¯è¿™é‡Œçš„æ„é€ å™¨æ–¹æ³•()å¹¶ä¸æ˜¯å¼€å‘è€…å†™çš„ï¼Œè€Œæ˜¯ç¼–è¯‘å™¨è‡ªåŠ¨ç”Ÿæˆçš„ã€‚</li><li><strong>ä½¿ç”¨</strong>ï¼šä½¿ç”¨ç±»æˆ–è€…åˆ›å»ºå¯¹è±¡</li><li><strong>å¸è½½</strong>ï¼šå¦‚æœæœ‰ä¸‹é¢çš„æƒ…å†µï¼Œç±»å°±ä¼šè¢«å¸è½½ï¼š1. è¯¥ç±»æ‰€æœ‰çš„å®ä¾‹éƒ½å·²ç»è¢«å›æ”¶ï¼Œä¹Ÿå°±æ˜¯Javaå †ä¸­ä¸å­˜åœ¨è¯¥ç±»çš„ä»»ä½•å®ä¾‹ã€‚2. åŠ è½½è¯¥ç±»çš„ClassLoaderå·²ç»è¢«å›æ”¶ã€‚ 3. ç±»å¯¹åº”çš„Java.lang.Classå¯¹è±¡æ²¡æœ‰ä»»ä½•åœ°æ–¹è¢«å¼•ç”¨ï¼Œæ— æ³•åœ¨ä»»ä½•åœ°æ–¹é€šè¿‡åå°„è®¿é—®è¯¥ç±»çš„æ–¹æ³•ã€‚</li></ul><h2 id="5-è®²ä¸€ä¸‹ç±»çš„åŠ è½½å’ŒåŒäº²å§”æ´¾åŸåˆ™"><a href="#5-è®²ä¸€ä¸‹ç±»çš„åŠ è½½å’ŒåŒäº²å§”æ´¾åŸåˆ™" class="headerlink" title="5.è®²ä¸€ä¸‹ç±»çš„åŠ è½½å’ŒåŒäº²å§”æ´¾åŸåˆ™"></a>5.è®²ä¸€ä¸‹ç±»çš„åŠ è½½å’ŒåŒäº²å§”æ´¾åŸåˆ™</h2><p>æˆ‘ä»¬æŠŠ Java çš„ç±»åŠ è½½è¿‡ç¨‹åˆ†ä¸ºä¸‰ä¸ªä¸»è¦æ­¥éª¤ï¼šåŠ è½½ã€é“¾æ¥ã€åˆå§‹åŒ–ã€‚</p><p>é¦–å…ˆæ˜¯åŠ è½½é˜¶æ®µï¼ˆLoadingï¼‰ï¼Œå®ƒæ˜¯ Java å°†å­—èŠ‚ç æ•°æ®ä»ä¸åŒçš„æ•°æ®æºè¯»å–åˆ° JVM ä¸­ï¼Œå¹¶æ˜ å°„ä¸º JVM è®¤å¯çš„æ•°æ®ç»“æ„ï¼ˆClass å¯¹è±¡ï¼‰ï¼Œè¿™é‡Œçš„æ•°æ®æºå¯èƒ½æ˜¯å„ç§å„æ ·çš„å½¢æ€ï¼Œå¦‚ jar æ–‡ä»¶ã€class æ–‡ä»¶ï¼Œç”šè‡³æ˜¯ç½‘ç»œæ•°æ®æºç­‰ï¼›å¦‚æœè¾“å…¥æ•°æ®ä¸æ˜¯ ClassFile çš„ç»“æ„ï¼Œåˆ™ä¼šæŠ›å‡º ClassFormatErrorã€‚</p><p>åŠ è½½é˜¶æ®µæ˜¯ç”¨æˆ·å‚ä¸çš„é˜¶æ®µï¼Œæˆ‘ä»¬å¯ä»¥è‡ªå®šä¹‰ç±»åŠ è½½å™¨ï¼Œå»å®ç°è‡ªå·±çš„ç±»åŠ è½½è¿‡ç¨‹ã€‚</p><p>ç¬¬äºŒé˜¶æ®µæ˜¯é“¾æ¥ï¼ˆLinkingï¼‰ï¼Œè¿™æ˜¯æ ¸å¿ƒçš„æ­¥éª¤ï¼Œç®€å•è¯´æ˜¯æŠŠåŸå§‹çš„ç±»å®šä¹‰ä¿¡æ¯å¹³æ»‘åœ°è½¬åŒ–å…¥ JVM è¿è¡Œçš„è¿‡ç¨‹ä¸­ã€‚è¿™é‡Œå¯è¿›ä¸€æ­¥ç»†åˆ†ä¸ºä¸‰ä¸ªæ­¥éª¤ï¼š</p><ul><li>éªŒè¯ï¼ˆVerificationï¼‰ï¼Œè¿™æ˜¯è™šæ‹Ÿæœºå®‰å…¨çš„é‡è¦ä¿éšœï¼ŒJVM éœ€è¦æ ¸éªŒå­—èŠ‚ä¿¡æ¯æ˜¯ç¬¦åˆ Java è™šæ‹Ÿæœºè§„èŒƒçš„ï¼Œå¦åˆ™å°±è¢«è®¤ä¸ºæ˜¯ VerifyErrorï¼Œè¿™æ ·å°±é˜²æ­¢äº†æ¶æ„ä¿¡æ¯æˆ–è€…ä¸åˆè§„çš„ä¿¡æ¯å±å®³ JVM çš„è¿è¡Œï¼ŒéªŒè¯é˜¶æ®µæœ‰å¯èƒ½è§¦å‘æ›´å¤š class çš„åŠ è½½ã€‚</li><li>å‡†å¤‡ï¼ˆPreparationï¼‰ï¼Œåˆ›å»ºç±»æˆ–æ¥å£ä¸­çš„é™æ€å˜é‡ï¼Œå¹¶åˆå§‹åŒ–é™æ€å˜é‡çš„åˆå§‹å€¼ã€‚ä½†è¿™é‡Œçš„â€œåˆå§‹åŒ–â€å’Œä¸‹é¢çš„æ˜¾å¼åˆå§‹åŒ–é˜¶æ®µæ˜¯æœ‰åŒºåˆ«çš„ï¼Œä¾§é‡ç‚¹åœ¨äºåˆ†é…æ‰€éœ€è¦çš„å†…å­˜ç©ºé—´ï¼Œä¸ä¼šå»æ‰§è¡Œæ›´è¿›ä¸€æ­¥çš„ JVM æŒ‡ä»¤ã€‚</li><li>è§£æï¼ˆResolutionï¼‰ï¼Œåœ¨è¿™ä¸€æ­¥ä¼šå°†å¸¸é‡æ± ä¸­çš„ç¬¦å·å¼•ç”¨ï¼ˆsymbolic referenceï¼‰æ›¿æ¢ä¸ºç›´æ¥å¼•ç”¨ã€‚</li></ul><p>æœ€åæ˜¯åˆå§‹åŒ–é˜¶æ®µï¼ˆinitializationï¼‰ï¼Œè¿™ä¸€æ­¥çœŸæ­£å»æ‰§è¡Œç±»åˆå§‹åŒ–çš„ä»£ç é€»è¾‘ï¼ŒåŒ…æ‹¬é™æ€å­—æ®µèµ‹å€¼çš„åŠ¨ä½œï¼Œä»¥åŠæ‰§è¡Œç±»å®šä¹‰ä¸­çš„é™æ€åˆå§‹åŒ–å—å†…çš„é€»è¾‘ï¼Œç¼–è¯‘å™¨åœ¨ç¼–è¯‘é˜¶æ®µå°±ä¼šæŠŠè¿™éƒ¨åˆ†é€»è¾‘æ•´ç†å¥½ï¼Œçˆ¶ç±»å‹çš„åˆå§‹åŒ–é€»è¾‘ä¼˜å…ˆäºå½“å‰ç±»å‹çš„é€»è¾‘ã€‚</p><p>å†æ¥è°ˆè°ˆåŒäº²å§”æ´¾æ¨¡å‹ï¼Œç®€å•è¯´å°±æ˜¯å½“ç±»åŠ è½½å™¨ï¼ˆClass-Loaderï¼‰è¯•å›¾åŠ è½½æŸä¸ªç±»å‹çš„æ—¶å€™ï¼Œé™¤éçˆ¶åŠ è½½å™¨æ‰¾ä¸åˆ°ç›¸åº”ç±»å‹ï¼Œå¦åˆ™å°½é‡å°†è¿™ä¸ªä»»åŠ¡ä»£ç†ç»™å½“å‰åŠ è½½å™¨çš„çˆ¶åŠ è½½å™¨å»åšã€‚ä½¿ç”¨å§”æ´¾æ¨¡å‹çš„ç›®çš„æ˜¯é¿å…é‡å¤åŠ è½½ Java ç±»å‹ã€‚</p><h1 id="åƒåœ¾å›æ”¶ç®—æ³•"><a href="#åƒåœ¾å›æ”¶ç®—æ³•" class="headerlink" title="åƒåœ¾å›æ”¶ç®—æ³•"></a>åƒåœ¾å›æ”¶ç®—æ³•</h1><h2 id="1-ä»€ä¹ˆæ˜¯Javaé‡Œçš„åƒåœ¾å›æ”¶ï¼Ÿå¦‚ä½•è§¦å‘åƒåœ¾å›æ”¶ï¼Ÿ"><a href="#1-ä»€ä¹ˆæ˜¯Javaé‡Œçš„åƒåœ¾å›æ”¶ï¼Ÿå¦‚ä½•è§¦å‘åƒåœ¾å›æ”¶ï¼Ÿ" class="headerlink" title="1.ä»€ä¹ˆæ˜¯Javaé‡Œçš„åƒåœ¾å›æ”¶ï¼Ÿå¦‚ä½•è§¦å‘åƒåœ¾å›æ”¶ï¼Ÿ"></a>1.ä»€ä¹ˆæ˜¯Javaé‡Œçš„åƒåœ¾å›æ”¶ï¼Ÿå¦‚ä½•è§¦å‘åƒåœ¾å›æ”¶ï¼Ÿ</h2><p>åƒåœ¾å›æ”¶ï¼ˆGarbage Collection, GCï¼‰æ˜¯è‡ªåŠ¨ç®¡ç†å†…å­˜çš„ä¸€ç§æœºåˆ¶ï¼Œå®ƒè´Ÿè´£è‡ªåŠ¨é‡Šæ”¾ä¸å†è¢«ç¨‹åºå¼•ç”¨çš„å¯¹è±¡æ‰€å ç”¨çš„å†…å­˜ï¼Œè¿™ç§æœºåˆ¶å‡å°‘äº†å†…å­˜æ³„æ¼å’Œå†…å­˜ç®¡ç†é”™è¯¯çš„å¯èƒ½æ€§ã€‚åƒåœ¾å›æ”¶å¯ä»¥é€šè¿‡å¤šç§æ–¹å¼è§¦å‘ï¼Œå…·ä½“å¦‚ä¸‹ï¼š</p><ul><li><strong>å†…å­˜ä¸è¶³æ—¶</strong>ï¼šå½“JVMæ£€æµ‹åˆ°<strong>å †å†…å­˜ä¸è¶³</strong>ï¼Œæ— æ³•ä¸ºæ–°çš„å¯¹è±¡åˆ†é…å†…å­˜æ—¶ï¼Œä¼šè‡ªåŠ¨è§¦å‘åƒåœ¾å›æ”¶ã€‚</li><li><strong>æ‰‹åŠ¨è¯·æ±‚</strong>ï¼šè™½ç„¶åƒåœ¾å›æ”¶æ˜¯è‡ªåŠ¨çš„ï¼Œ<strong>å¼€å‘è€…å¯ä»¥é€šè¿‡è°ƒç”¨ <code>System.gc()</code> æˆ– <code>Runtime.getRuntime().gc()</code> å»ºè®® JVM è¿›è¡Œåƒåœ¾å›æ”¶ã€‚</strong>ä¸è¿‡è¿™åªæ˜¯ä¸€ä¸ªå»ºè®®ï¼Œå¹¶ä¸èƒ½ä¿è¯ç«‹å³æ‰§è¡Œã€‚</li><li><strong>JVMå‚æ•°</strong>ï¼šå¯åŠ¨ Java åº”ç”¨æ—¶å¯ä»¥é€šè¿‡ <strong>JVM å‚æ•°æ¥è°ƒæ•´åƒåœ¾å›æ”¶çš„è¡Œä¸º</strong>ï¼Œæ¯”å¦‚ï¼š<code>-Xmx</code>ï¼ˆæœ€å¤§å †å¤§å°ï¼‰ã€<code>-Xms</code>ï¼ˆåˆå§‹å †å¤§å°ï¼‰ç­‰ã€‚</li><li><strong>å¯¹è±¡æ•°é‡æˆ–å†…å­˜ä½¿ç”¨è¾¾åˆ°é˜ˆå€¼</strong>ï¼šåƒåœ¾æ”¶é›†å™¨å†…éƒ¨å®ç°äº†ä¸€äº›ç­–ç•¥ï¼Œä»¥ç›‘æ§å¯¹è±¡çš„åˆ›å»ºå’Œå†…å­˜ä½¿ç”¨ï¼Œè¾¾åˆ°æŸä¸ªé˜ˆå€¼æ—¶è§¦å‘åƒåœ¾å›æ”¶ã€‚</li></ul><h2 id="2-åˆ¤æ–­åƒåœ¾çš„æ–¹æ³•æœ‰å“ªäº›ï¼Ÿ"><a href="#2-åˆ¤æ–­åƒåœ¾çš„æ–¹æ³•æœ‰å“ªäº›ï¼Ÿ" class="headerlink" title="2.åˆ¤æ–­åƒåœ¾çš„æ–¹æ³•æœ‰å“ªäº›ï¼Ÿ"></a>2.åˆ¤æ–­åƒåœ¾çš„æ–¹æ³•æœ‰å“ªäº›ï¼Ÿ</h2><p>åœ¨Javaä¸­ï¼Œåˆ¤æ–­å¯¹è±¡æ˜¯å¦ä¸ºåƒåœ¾ï¼ˆå³ä¸å†è¢«ä½¿ç”¨ï¼Œå¯ä»¥è¢«åƒåœ¾å›æ”¶å™¨å›æ”¶ï¼‰ä¸»è¦ä¾æ®ä¸¤ç§ä¸»æµçš„åƒåœ¾å›æ”¶ç®—æ³•æ¥å®ç°ï¼š<strong>å¼•ç”¨è®¡æ•°æ³•å’Œå¯è¾¾æ€§åˆ†æç®—æ³•</strong>ã€‚</p><blockquote><p>å¼•ç”¨è®¡æ•°æ³•ï¼ˆReference Countingï¼‰</p></blockquote><ul><li><strong>åŸç†</strong>ï¼šä¸ºæ¯ä¸ªå¯¹è±¡åˆ†é…ä¸€ä¸ªå¼•ç”¨è®¡æ•°å™¨ï¼Œæ¯å½“æœ‰ä¸€ä¸ªåœ°æ–¹å¼•ç”¨å®ƒæ—¶ï¼Œè®¡æ•°å™¨åŠ 1ï¼›å½“å¼•ç”¨å¤±æ•ˆæ—¶ï¼Œè®¡æ•°å™¨å‡1ã€‚å½“è®¡æ•°å™¨ä¸º0æ—¶ï¼Œè¡¨ç¤ºå¯¹è±¡ä¸å†è¢«ä»»ä½•å˜é‡å¼•ç”¨ï¼Œå¯ä»¥è¢«å›æ”¶ã€‚</li><li><strong>ç¼ºç‚¹</strong>ï¼š<strong>ä¸èƒ½è§£å†³å¾ªç¯å¼•ç”¨çš„é—®é¢˜</strong>ï¼Œå³ä¸¤ä¸ªå¯¹è±¡ç›¸äº’å¼•ç”¨ï¼Œä½†ä¸å†è¢«å…¶ä»–ä»»ä½•å¯¹è±¡å¼•ç”¨ï¼Œè¿™æ—¶å¼•ç”¨è®¡æ•°å™¨ä¸ä¼šä¸º0ï¼Œå¯¼è‡´å¯¹è±¡æ— æ³•è¢«å›æ”¶ã€‚</li></ul><blockquote><p>å¯è¾¾æ€§åˆ†æç®—æ³•ï¼ˆReachability Analysisï¼‰</p></blockquote><p><img src="https://cdn.xiaolincoding.com//picgo/1719111821599-650b1691-2737-453b-ba4b-26b065a96e88.png" alt="img"></p><p>Javaè™šæ‹Ÿæœºä¸»è¦é‡‡ç”¨æ­¤ç®—æ³•æ¥åˆ¤æ–­å¯¹è±¡æ˜¯å¦ä¸ºåƒåœ¾ã€‚</p><ul><li><strong>åŸç†</strong>ï¼šä»ä¸€ç»„ç§°ä¸º<strong>GC Rootsï¼ˆåƒåœ¾æ”¶é›†æ ¹ï¼‰çš„å¯¹è±¡å‡ºå‘</strong>ï¼Œå‘ä¸‹è¿½æº¯å®ƒä»¬å¼•ç”¨çš„å¯¹è±¡ï¼Œä»¥åŠè¿™äº›å¯¹è±¡å¼•ç”¨çš„å…¶ä»–å¯¹è±¡ï¼Œä»¥æ­¤ç±»æ¨ã€‚<strong>å¦‚æœä¸€ä¸ªå¯¹è±¡åˆ°GC Rootsæ²¡æœ‰ä»»ä½•å¼•ç”¨é“¾ç›¸è¿ï¼ˆå³ä»GC Rootsåˆ°è¿™ä¸ªå¯¹è±¡ä¸å¯è¾¾ï¼‰ï¼Œé‚£ä¹ˆè¿™ä¸ªå¯¹è±¡å°±è¢«è®¤ä¸ºæ˜¯ä¸å¯è¾¾çš„ï¼Œå¯ä»¥è¢«å›æ”¶ã€‚</strong>GC Rootså¯¹è±¡åŒ…æ‹¬ï¼šè™šæ‹Ÿæœºæ ˆï¼ˆæ ˆå¸§ä¸­çš„æœ¬åœ°å˜é‡è¡¨ï¼‰ä¸­å¼•ç”¨çš„å¯¹è±¡ã€æ–¹æ³•åŒºä¸­ç±»é™æ€å±æ€§å¼•ç”¨çš„å¯¹è±¡ã€æœ¬åœ°æ–¹æ³•æ ˆä¸­JNIï¼ˆJava Native Interfaceï¼‰å¼•ç”¨çš„å¯¹è±¡ã€æ´»è·ƒçº¿ç¨‹çš„å¼•ç”¨ç­‰ã€‚</li></ul><h2 id="3-åƒåœ¾å›æ”¶ç®—æ³•æ˜¯ä»€ä¹ˆï¼Œæ˜¯ä¸ºäº†è§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿ"><a href="#3-åƒåœ¾å›æ”¶ç®—æ³•æ˜¯ä»€ä¹ˆï¼Œæ˜¯ä¸ºäº†è§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿ" class="headerlink" title="3.åƒåœ¾å›æ”¶ç®—æ³•æ˜¯ä»€ä¹ˆï¼Œæ˜¯ä¸ºäº†è§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿ"></a>3.åƒåœ¾å›æ”¶ç®—æ³•æ˜¯ä»€ä¹ˆï¼Œæ˜¯ä¸ºäº†è§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿ</h2><p>JVMæœ‰åƒåœ¾å›æ”¶æœºåˆ¶çš„åŸå› æ˜¯ä¸ºäº†<strong>è§£å†³å†…å­˜ç®¡ç†çš„é—®é¢˜</strong>ã€‚åœ¨ä¼ ç»Ÿçš„ç¼–ç¨‹è¯­è¨€ä¸­ï¼Œå¼€å‘äººå‘˜éœ€è¦æ‰‹åŠ¨åˆ†é…å’Œé‡Šæ”¾å†…å­˜ï¼Œè¿™å¯èƒ½å¯¼è‡´<strong>å†…å­˜æ³„æ¼ã€å†…å­˜æº¢å‡º</strong>ç­‰é—®é¢˜ã€‚è€ŒJavaä½œä¸ºä¸€ç§é«˜çº§è¯­è¨€ï¼Œæ—¨åœ¨æä¾›æ›´ç®€å•ã€æ›´å®‰å…¨çš„ç¼–ç¨‹ç¯å¢ƒï¼Œå› æ­¤å¼•å…¥äº†åƒåœ¾å›æ”¶æœºåˆ¶æ¥è‡ªåŠ¨ç®¡ç†å†…å­˜ã€‚</p><p>åƒåœ¾å›æ”¶æœºåˆ¶çš„ä¸»è¦ç›®æ ‡æ˜¯<strong>è‡ªåŠ¨æ£€æµ‹å’Œå›æ”¶**</strong>ä¸å†ä½¿ç”¨çš„å¯¹è±¡<strong>ï¼Œä»è€Œé‡Šæ”¾å®ƒä»¬æ‰€å ç”¨çš„å†…å­˜ç©ºé—´ã€‚è¿™æ ·å¯ä»¥</strong>é¿å…å†…å­˜æ³„æ¼ï¼ˆä¸€äº›å¯¹è±¡è¢«åˆ†é…äº†å†…å­˜å´æ— æ³•è¢«é‡Šæ”¾ï¼Œå¯¼è‡´å†…å­˜èµ„æºçš„æµªè´¹ï¼‰ã€‚åŒæ—¶ï¼Œåƒåœ¾å›æ”¶æœºåˆ¶è¿˜å¯ä»¥é˜²æ­¢å†…å­˜æº¢å‡ºï¼ˆå³ç¨‹åºéœ€è¦çš„å†…å­˜è¶…è¿‡äº†å¯ç”¨å†…å­˜çš„æƒ…å†µï¼‰ã€‚**</p><p>é€šè¿‡åƒåœ¾å›æ”¶æœºåˆ¶ï¼ŒJVMå¯ä»¥åœ¨ç¨‹åºè¿è¡Œæ—¶è‡ªåŠ¨è¯†åˆ«å’Œæ¸…ç†ä¸å†ä½¿ç”¨çš„å¯¹è±¡ï¼Œä½¿å¾—å¼€å‘äººå‘˜æ— éœ€æ‰‹åŠ¨ç®¡ç†å†…å­˜ã€‚è¿™æ ·å¯ä»¥æé«˜å¼€å‘æ•ˆç‡ã€å‡å°‘é”™è¯¯ï¼Œå¹¶ä¸”ä½¿ç¨‹åºæ›´åŠ å¯é å’Œç¨³å®šã€‚</p><h2 id="4-åƒåœ¾å›æ”¶ç®—æ³•æœ‰å“ªäº›ï¼Ÿ"><a href="#4-åƒåœ¾å›æ”¶ç®—æ³•æœ‰å“ªäº›ï¼Ÿ" class="headerlink" title="4.åƒåœ¾å›æ”¶ç®—æ³•æœ‰å“ªäº›ï¼Ÿ"></a>4.åƒåœ¾å›æ”¶ç®—æ³•æœ‰å“ªäº›ï¼Ÿ</h2><ul><li><strong>æ ‡è®°-æ¸…é™¤ç®—æ³•</strong>ï¼šæ ‡è®°-æ¸…é™¤ç®—æ³•åˆ†ä¸º<strong>â€œæ ‡è®°â€å’Œâ€œæ¸…é™¤â€</strong>ä¸¤ä¸ªé˜¶æ®µï¼Œé¦–å…ˆé€šè¿‡å¯è¾¾æ€§åˆ†æï¼Œæ ‡è®°å‡ºæ‰€æœ‰éœ€è¦å›æ”¶çš„å¯¹è±¡ï¼Œç„¶åç»Ÿä¸€å›æ”¶æ‰€æœ‰è¢«æ ‡è®°çš„å¯¹è±¡ã€‚æ ‡è®°-æ¸…é™¤ç®—æ³•æœ‰ä¸¤ä¸ªç¼ºé™·ï¼Œä¸€ä¸ªæ˜¯æ•ˆç‡é—®é¢˜ï¼Œ<strong>æ ‡è®°å’Œæ¸…é™¤çš„è¿‡ç¨‹æ•ˆç‡éƒ½ä¸é«˜ï¼Œå¦å¤–ä¸€ä¸ªå°±æ˜¯ï¼Œæ¸…é™¤ç»“æŸåä¼šé€ æˆå¤§é‡çš„ç¢ç‰‡ç©ºé—´ã€‚</strong>æœ‰å¯èƒ½ä¼šé€ æˆåœ¨ç”³è¯·å¤§å—å†…å­˜çš„æ—¶å€™å› ä¸ºæ²¡æœ‰è¶³å¤Ÿçš„è¿ç»­ç©ºé—´å¯¼è‡´å†æ¬¡ GCã€‚</li><li><strong>å¤åˆ¶ç®—æ³•</strong>ï¼šä¸ºäº†è§£å†³ç¢ç‰‡ç©ºé—´çš„é—®é¢˜ï¼Œå‡ºç°äº†â€œå¤åˆ¶ç®—æ³•â€ã€‚å¤åˆ¶ç®—æ³•çš„åŸç†æ˜¯ï¼Œå°†å†…å­˜åˆ†æˆä¸¤å—ï¼Œæ¯æ¬¡ç”³è¯·å†…å­˜æ—¶éƒ½ä½¿ç”¨å…¶ä¸­çš„ä¸€å—ï¼Œå½“å†…å­˜ä¸å¤Ÿæ—¶ï¼Œå°†è¿™ä¸€å—å†…å­˜ä¸­æ‰€æœ‰å­˜æ´»çš„å¤åˆ¶åˆ°å¦ä¸€å—ä¸Šã€‚ç„¶åå°†ç„¶åå†æŠŠå·²ä½¿ç”¨çš„å†…å­˜æ•´ä¸ªæ¸…ç†æ‰ã€‚å¤åˆ¶ç®—æ³•è§£å†³äº†ç©ºé—´ç¢ç‰‡çš„é—®é¢˜ã€‚ä½†æ˜¯ä¹Ÿå¸¦æ¥äº†æ–°çš„é—®é¢˜ã€‚<strong>å› ä¸ºæ¯æ¬¡åœ¨ç”³è¯·å†…å­˜æ—¶ï¼Œéƒ½åªèƒ½ä½¿ç”¨ä¸€åŠçš„å†…å­˜ç©ºé—´ã€‚å†…å­˜åˆ©ç”¨ç‡ä¸¥é‡ä¸è¶³ã€‚</strong></li><li><strong>æ ‡è®°-æ•´ç†ç®—æ³•</strong>ï¼šå¤åˆ¶ç®—æ³•åœ¨ GC ä¹‹åå­˜æ´»å¯¹è±¡è¾ƒå°‘çš„æƒ…å†µä¸‹æ•ˆç‡æ¯”è¾ƒé«˜ï¼Œä½†å¦‚æœå­˜æ´»å¯¹è±¡æ¯”è¾ƒå¤šæ—¶ï¼Œä¼šæ‰§è¡Œè¾ƒå¤šçš„å¤åˆ¶æ“ä½œï¼Œæ•ˆç‡å°±ä¼šä¸‹é™ã€‚è€Œè€å¹´ä»£çš„å¯¹è±¡åœ¨ GC ä¹‹åçš„å­˜æ´»ç‡å°±æ¯”è¾ƒé«˜ï¼Œæ‰€ä»¥å°±æœ‰äººæå‡ºäº†â€œæ ‡è®°-æ•´ç†ç®—æ³•â€ã€‚æ ‡è®°-æ•´ç†ç®—æ³•çš„â€œæ ‡è®°â€è¿‡ç¨‹ä¸â€œæ ‡è®°-æ¸…é™¤ç®—æ³•â€çš„æ ‡è®°è¿‡ç¨‹ä¸€è‡´ï¼Œ<strong>ä½†æ ‡è®°ä¹‹åä¸ä¼šç›´æ¥æ¸…ç†ã€‚è€Œæ˜¯å°†æ‰€æœ‰å­˜æ´»å¯¹è±¡éƒ½ç§»åŠ¨åˆ°å†…å­˜çš„ä¸€ç«¯ã€‚ç§»åŠ¨ç»“æŸåç›´æ¥æ¸…ç†æ‰å‰©ä½™éƒ¨åˆ†ã€‚</strong></li><li><strong>åˆ†ä»£å›æ”¶ç®—æ³•</strong>ï¼šåˆ†ä»£æ”¶é›†æ˜¯å°†å†…å­˜åˆ’åˆ†æˆäº†<strong>æ–°ç”Ÿä»£å’Œè€å¹´ä»£</strong>ã€‚åˆ†é…çš„ä¾æ®æ˜¯å¯¹è±¡çš„ç”Ÿå­˜å‘¨æœŸï¼Œæˆ–è€…è¯´ç»å†è¿‡çš„ GC æ¬¡æ•°ã€‚å¯¹è±¡åˆ›å»ºæ—¶ï¼Œ<strong>ä¸€èˆ¬åœ¨æ–°ç”Ÿä»£ç”³è¯·å†…å­˜ï¼Œå½“ç»å†ä¸€æ¬¡ GC ä¹‹åå¦‚æœå¯¹è¿˜å­˜æ´»ï¼Œé‚£ä¹ˆå¯¹è±¡çš„å¹´é¾„ +1ã€‚å½“å¹´é¾„è¶…è¿‡ä¸€å®šå€¼(é»˜è®¤æ˜¯ 15ï¼Œå¯ä»¥é€šè¿‡å‚æ•° -XX:MaxTenuringThreshold æ¥è®¾å®š)åï¼Œå¦‚æœå¯¹è±¡è¿˜å­˜æ´»ï¼Œé‚£ä¹ˆè¯¥å¯¹è±¡ä¼šè¿›å…¥è€å¹´ä»£ã€‚</strong></li></ul><p>æ¯”å¦‚æ–°ç”Ÿä»£æˆ‘ä»¬ä½¿ç”¨å¤åˆ¶ç®—æ³•æ•ˆç‡è¾ƒé«˜ï¼Œè€å¹´ä»£ä½¿ç”¨æ ‡è®°-æ•´ç†ç®—æ³•æ›´å¥½</p><h2 id="5-åƒåœ¾å›æ”¶å™¨æœ‰å“ªäº›ï¼Ÿ"><a href="#5-åƒåœ¾å›æ”¶å™¨æœ‰å“ªäº›ï¼Ÿ" class="headerlink" title="5.åƒåœ¾å›æ”¶å™¨æœ‰å“ªäº›ï¼Ÿ"></a>5.åƒåœ¾å›æ”¶å™¨æœ‰å“ªäº›ï¼Ÿ</h2><p><img src="https://cdn.xiaolincoding.com//picgo/1712649527581-d6aee0bf-35ab-4406-8a26-270b35ae8771.png" alt=""></p><h2 id="6-æ ‡è®°æ¸…é™¤ç®—æ³•çš„ç¼ºç‚¹æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#6-æ ‡è®°æ¸…é™¤ç®—æ³•çš„ç¼ºç‚¹æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="6.æ ‡è®°æ¸…é™¤ç®—æ³•çš„ç¼ºç‚¹æ˜¯ä»€ä¹ˆï¼Ÿ"></a>6.æ ‡è®°æ¸…é™¤ç®—æ³•çš„ç¼ºç‚¹æ˜¯ä»€ä¹ˆï¼Ÿ</h2><p>ä¸»è¦ç¼ºç‚¹æœ‰ä¸¤ä¸ªï¼š</p><ul><li>ä¸€ä¸ªæ˜¯æ•ˆç‡é—®é¢˜ï¼Œæ ‡è®°å’Œæ¸…é™¤è¿‡ç¨‹çš„æ•ˆç‡éƒ½ä¸é«˜ï¼›</li><li>å¦å¤–ä¸€ä¸ªæ˜¯ç©ºé—´é—®é¢˜ï¼Œæ ‡è®°æ¸…é™¤ä¹‹åä¼šäº§ç”Ÿ<strong>å¤§é‡ä¸è¿ç»­çš„å†…å­˜ç¢ç‰‡</strong>ï¼Œç©ºé—´ç¢ç‰‡å¤ªå¤šå¯èƒ½ä¼šå¯¼è‡´ï¼Œå½“ç¨‹åºåœ¨ä»¥åçš„è¿è¡Œè¿‡ç¨‹ä¸­éœ€è¦åˆ†é…è¾ƒå¤§å¯¹è±¡æ—¶æ— æ³•æ‰¾åˆ°<strong>è¶³å¤Ÿçš„è¿ç»­å†…å­˜è€Œä¸å¾—ä¸æå‰è§¦å‘å¦ä¸€æ¬¡åƒåœ¾æ”¶é›†åŠ¨ä½œã€‚</strong></li></ul><h2 id="7-åƒåœ¾å›æ”¶ç®—æ³•å“ªäº›é˜¶æ®µä¼šstop-the-world"><a href="#7-åƒåœ¾å›æ”¶ç®—æ³•å“ªäº›é˜¶æ®µä¼šstop-the-world" class="headerlink" title="7.åƒåœ¾å›æ”¶ç®—æ³•å“ªäº›é˜¶æ®µä¼šstop the world?"></a>7.åƒåœ¾å›æ”¶ç®—æ³•å“ªäº›é˜¶æ®µä¼šstop the world?</h2><p>æ ‡è®°-å¤åˆ¶ç®—æ³•åº”ç”¨åœ¨CMSæ–°ç”Ÿä»£ï¼ˆParNewæ˜¯CMSé»˜è®¤çš„æ–°ç”Ÿä»£åƒåœ¾å›æ”¶å™¨ï¼‰å’ŒG1åƒåœ¾å›æ”¶å™¨ä¸­ã€‚æ ‡è®°-å¤åˆ¶ç®—æ³•å¯ä»¥åˆ†ä¸ºä¸‰ä¸ªé˜¶æ®µï¼š</p><ul><li><strong>æ ‡è®°é˜¶æ®µï¼Œå³ä»GC Rootsé›†åˆå¼€å§‹ï¼Œæ ‡è®°æ´»è·ƒå¯¹è±¡ï¼›</strong></li><li><strong>è½¬ç§»é˜¶æ®µï¼Œå³æŠŠæ´»è·ƒå¯¹è±¡å¤åˆ¶åˆ°æ–°çš„å†…å­˜åœ°å€ä¸Šï¼›</strong></li><li><strong>é‡å®šä½é˜¶æ®µï¼Œå› ä¸ºè½¬ç§»å¯¼è‡´å¯¹è±¡çš„åœ°å€å‘ç”Ÿäº†å˜åŒ–ï¼Œåœ¨é‡å®šä½é˜¶æ®µï¼Œæ‰€æœ‰æŒ‡å‘å¯¹è±¡æ—§åœ°å€çš„æŒ‡é’ˆéƒ½è¦è°ƒæ•´åˆ°å¯¹è±¡æ–°çš„åœ°å€ä¸Šã€‚</strong></li></ul><p>ä¸‹é¢ä»¥G1ä¸ºä¾‹ï¼Œé€šè¿‡G1ä¸­æ ‡è®°-å¤åˆ¶ç®—æ³•è¿‡ç¨‹ï¼ˆG1çš„Young GCå’ŒMixed GCå‡é‡‡ç”¨è¯¥ç®—æ³•ï¼‰ï¼Œåˆ†æG1åœé¡¿è€—æ—¶çš„ä¸»è¦ç“¶é¢ˆã€‚G1åƒåœ¾å›æ”¶å‘¨æœŸå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="https://cdn.xiaolincoding.com//picgo/1718783586342-9da40db7-1dac-42ec-8148-81c10d8bfc04.png" alt="img"></p><p>G1çš„æ··åˆå›æ”¶è¿‡ç¨‹å¯ä»¥åˆ†ä¸ºæ ‡è®°é˜¶æ®µã€æ¸…ç†é˜¶æ®µå’Œå¤åˆ¶é˜¶æ®µã€‚</p><p><strong>æ ‡è®°é˜¶æ®µåœé¡¿åˆ†æ</strong></p><ul><li>åˆå§‹æ ‡è®°é˜¶æ®µï¼šåˆå§‹æ ‡è®°é˜¶æ®µæ˜¯æŒ‡ä»GC Rootså‡ºå‘æ ‡è®°<strong>å…¨éƒ¨ç›´æ¥å­èŠ‚ç‚¹</strong>çš„è¿‡ç¨‹ï¼Œè¯¥é˜¶æ®µæ˜¯STWçš„ã€‚ç”±äºGC Rootsæ•°é‡ä¸å¤šï¼Œé€šå¸¸è¯¥é˜¶æ®µè€—æ—¶éå¸¸çŸ­ã€‚</li><li>å¹¶å‘æ ‡è®°é˜¶æ®µï¼šå¹¶å‘æ ‡è®°é˜¶æ®µæ˜¯æŒ‡ä»GC Rootså¼€å§‹å¯¹å †ä¸­å¯¹è±¡è¿›è¡Œå¯è¾¾æ€§åˆ†æï¼Œæ‰¾å‡ºå­˜æ´»å¯¹è±¡ã€‚è¯¥é˜¶æ®µæ˜¯å¹¶å‘çš„ï¼Œå³åº”ç”¨çº¿ç¨‹å’ŒGCçº¿ç¨‹å¯ä»¥åŒæ—¶æ´»åŠ¨ã€‚å¹¶å‘æ ‡è®°è€—æ—¶ç›¸å¯¹é•¿å¾ˆå¤šï¼Œä½†å› ä¸ºä¸æ˜¯STWï¼Œæ‰€ä»¥æˆ‘ä»¬ä¸å¤ªå…³å¿ƒè¯¥é˜¶æ®µè€—æ—¶çš„é•¿çŸ­ã€‚</li><li>å†æ ‡è®°é˜¶æ®µï¼š<strong>é‡æ–°æ ‡è®°é‚£äº›åœ¨å¹¶å‘æ ‡è®°é˜¶æ®µå‘ç”Ÿå˜åŒ–çš„å¯¹è±¡ã€‚è¯¥é˜¶æ®µæ˜¯STWçš„ã€‚</strong></li></ul><p><strong>æ¸…ç†é˜¶æ®µåœé¡¿åˆ†æ</strong></p><ul><li><strong>æ¸…ç†é˜¶æ®µæ¸…ç‚¹</strong>å‡ºæœ‰å­˜æ´»å¯¹è±¡çš„åˆ†åŒºå’Œæ²¡æœ‰å­˜æ´»å¯¹è±¡çš„åˆ†åŒºï¼Œè¯¥é˜¶æ®µä¸ä¼šæ¸…ç†åƒåœ¾å¯¹è±¡ï¼Œä¹Ÿä¸ä¼šæ‰§è¡Œå­˜æ´»å¯¹è±¡çš„å¤åˆ¶ã€‚è¯¥é˜¶æ®µæ˜¯STWçš„ã€‚</li></ul><p><strong>å¤åˆ¶é˜¶æ®µåœé¡¿åˆ†æ</strong></p><ul><li><strong>å¤åˆ¶ç®—æ³•ä¸­çš„è½¬ç§»é˜¶æ®µéœ€è¦åˆ†é…æ–°å†…å­˜å’Œå¤åˆ¶å¯¹è±¡çš„æˆå‘˜å˜é‡ã€‚è½¬ç§»é˜¶æ®µæ˜¯STWçš„ï¼Œ</strong>å…¶ä¸­å†…å­˜åˆ†é…é€šå¸¸è€—æ—¶éå¸¸çŸ­ï¼Œä½†å¯¹è±¡æˆå‘˜å˜é‡çš„å¤åˆ¶è€—æ—¶æœ‰å¯èƒ½è¾ƒé•¿ï¼Œè¿™æ˜¯å› ä¸ºå¤åˆ¶è€—æ—¶ä¸å­˜æ´»å¯¹è±¡æ•°é‡ä¸å¯¹è±¡å¤æ‚åº¦æˆæ­£æ¯”ã€‚å¯¹è±¡è¶Šå¤æ‚ï¼Œå¤åˆ¶è€—æ—¶è¶Šé•¿ã€‚</li></ul><p>å››ä¸ªSTWè¿‡ç¨‹ä¸­ï¼Œåˆå§‹æ ‡è®°å› ä¸ºåªæ ‡è®°GC Rootsï¼Œè€—æ—¶è¾ƒçŸ­ã€‚å†æ ‡è®°å› ä¸ºå¯¹è±¡æ•°å°‘ï¼Œè€—æ—¶ä¹Ÿè¾ƒçŸ­ã€‚æ¸…ç†é˜¶æ®µå› ä¸ºå†…å­˜åˆ†åŒºæ•°é‡å°‘ï¼Œè€—æ—¶ä¹Ÿè¾ƒçŸ­ã€‚è½¬ç§»é˜¶æ®µè¦å¤„ç†æ‰€æœ‰å­˜æ´»çš„å¯¹è±¡ï¼Œè€—æ—¶ä¼šè¾ƒé•¿ã€‚</p><p>å› æ­¤ï¼ŒG1åœé¡¿æ—¶é—´çš„ç“¶é¢ˆ<strong>ä¸»è¦æ˜¯æ ‡è®°-å¤åˆ¶ä¸­çš„è½¬ç§»é˜¶æ®µSTWã€‚</strong></p><h2 id="8-minorGCã€majorGCã€fullGCçš„åŒºåˆ«ï¼Œä»€ä¹ˆåœºæ™¯è§¦å‘full-GC"><a href="#8-minorGCã€majorGCã€fullGCçš„åŒºåˆ«ï¼Œä»€ä¹ˆåœºæ™¯è§¦å‘full-GC" class="headerlink" title="8.minorGCã€majorGCã€fullGCçš„åŒºåˆ«ï¼Œä»€ä¹ˆåœºæ™¯è§¦å‘full GC"></a>8.minorGCã€majorGCã€fullGCçš„åŒºåˆ«ï¼Œä»€ä¹ˆåœºæ™¯è§¦å‘full GC</h2><p>åœ¨Javaä¸­ï¼Œåƒåœ¾å›æ”¶æœºåˆ¶æ˜¯è‡ªåŠ¨ç®¡ç†å†…å­˜çš„é‡è¦ç»„æˆéƒ¨åˆ†ã€‚æ ¹æ®å…¶ä½œç”¨èŒƒå›´å’Œè§¦å‘æ¡ä»¶çš„ä¸åŒï¼Œå¯ä»¥å°†GCåˆ†ä¸ºä¸‰ç§ç±»å‹ï¼šMinor GCï¼ˆä¹Ÿç§°ä¸ºYoung GCï¼‰ã€Major GCï¼ˆæœ‰æ—¶ä¹Ÿç§°ä¸ºOld GCï¼‰ã€ä»¥åŠFull GCã€‚ä»¥ä¸‹æ˜¯è¿™ä¸‰ç§GCçš„åŒºåˆ«å’Œè§¦å‘åœºæ™¯ï¼š</p><blockquote><p>Minor GC (Young GC)</p></blockquote><ul><li><strong>ä½œç”¨èŒƒå›´</strong>ï¼šåªé’ˆå¯¹<strong>å¹´è½»ä»£</strong>è¿›è¡Œå›æ”¶ï¼ŒåŒ…æ‹¬EdenåŒºå’Œä¸¤ä¸ªSurvivoråŒºï¼ˆS0å’ŒS1ï¼‰ã€‚</li><li><strong>è§¦å‘æ¡ä»¶</strong>ï¼šå½“EdenåŒºç©ºé—´ä¸è¶³æ—¶ï¼ŒJVMä¼šè§¦å‘ä¸€æ¬¡Minor GCï¼Œå°†EdenåŒºå’Œä¸€ä¸ªSurvivoråŒºä¸­çš„å­˜æ´»å¯¹è±¡ç§»åŠ¨åˆ°å¦ä¸€ä¸ªSurvivoråŒºæˆ–è€å¹´ä»£ï¼ˆOld Generationï¼‰ã€‚</li><li><strong>ç‰¹ç‚¹</strong>ï¼š<strong>é€šå¸¸å‘ç”Ÿå¾—éå¸¸é¢‘ç¹</strong>ï¼Œå› ä¸ºå¹´è½»ä»£ä¸­å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸè¾ƒçŸ­ï¼Œå›æ”¶æ•ˆç‡é«˜ï¼Œæš‚åœæ—¶é—´ç›¸å¯¹è¾ƒçŸ­ã€‚</li></ul><blockquote><p>Major GC</p></blockquote><ul><li><strong>ä½œç”¨èŒƒå›´</strong>ï¼šä¸»è¦<strong>é’ˆå¯¹è€å¹´ä»£è¿›è¡Œå›æ”¶</strong>ï¼Œä½†ä¸ä¸€å®šåªå›æ”¶è€å¹´ä»£ã€‚</li><li><strong>è§¦å‘æ¡ä»¶</strong>ï¼šå½“è€å¹´ä»£ç©ºé—´ä¸è¶³æ—¶ï¼Œæˆ–è€…ç³»ç»Ÿæ£€æµ‹åˆ°å¹´è½»ä»£å¯¹è±¡æ™‹å‡åˆ°è€å¹´ä»£çš„é€Ÿåº¦è¿‡å¿«ï¼Œå¯èƒ½ä¼šè§¦å‘Major GCã€‚</li><li><strong>ç‰¹ç‚¹</strong>ï¼šç›¸æ¯”Minor GCï¼ŒMajor GCå‘ç”Ÿçš„é¢‘ç‡è¾ƒä½ï¼Œä½†æ¯æ¬¡å›æ”¶å¯èƒ½éœ€è¦æ›´é•¿çš„æ—¶é—´ï¼Œå› ä¸ºè€å¹´ä»£ä¸­çš„å¯¹è±¡å­˜æ´»ç‡è¾ƒé«˜ã€‚</li></ul><blockquote><p>Full GC</p></blockquote><ul><li><strong>ä½œç”¨èŒƒå›´</strong>ï¼š<strong>å¯¹æ•´ä¸ªå †å†…å­˜ï¼ˆåŒ…æ‹¬å¹´è½»ä»£ã€è€å¹´ä»£ä»¥åŠæ°¸ä¹…ä»£/å…ƒç©ºé—´ï¼‰è¿›è¡Œå›æ”¶</strong>ã€‚</li><li><strong>è§¦å‘æ¡ä»¶</strong>ï¼š<ul><li>ç›´æ¥è°ƒç”¨<code>System.gc()</code>æˆ–<code>Runtime.getRuntime().gc()</code>æ–¹æ³•æ—¶ï¼Œè™½ç„¶ä¸èƒ½ä¿è¯ç«‹å³æ‰§è¡Œï¼Œä½†JVMä¼šå°è¯•æ‰§è¡ŒFull GCã€‚</li><li>Minor GCï¼ˆæ–°ç”Ÿä»£åƒåœ¾å›æ”¶ï¼‰æ—¶ï¼Œå¦‚<strong>æœå­˜æ´»çš„å¯¹è±¡æ— æ³•å…¨éƒ¨æ”¾å…¥è€å¹´ä»£ï¼Œæˆ–è€…è€å¹´ä»£ç©ºé—´ä¸è¶³ä»¥å®¹çº³å­˜æ´»çš„å¯¹è±¡ï¼Œåˆ™ä¼šè§¦å‘Full GCï¼Œå¯¹æ•´ä¸ªå †å†…å­˜è¿›è¡Œå›æ”¶ã€‚</strong></li><li>å½“æ°¸ä¹…ä»£ï¼ˆJava 8ä¹‹å‰çš„ç‰ˆæœ¬ï¼‰æˆ–å…ƒç©ºé—´ï¼ˆJava 8åŠä»¥åçš„ç‰ˆæœ¬ï¼‰ç©ºé—´ä¸è¶³æ—¶ã€‚</li></ul></li><li><strong>ç‰¹ç‚¹</strong>ï¼šFull GCæ˜¯æœ€æ˜‚è´µçš„æ“ä½œï¼Œå› ä¸ºå®ƒéœ€è¦åœæ­¢æ‰€æœ‰çš„å·¥ä½œçº¿ç¨‹ï¼ˆStop The Worldï¼‰ï¼Œéå†æ•´ä¸ªå †å†…å­˜æ¥æŸ¥æ‰¾å’Œå›æ”¶ä¸å†ä½¿ç”¨çš„å¯¹è±¡ï¼Œå› æ­¤åº”å°½é‡å‡å°‘Full GCçš„è§¦å‘ã€‚</li></ul><h2 id="9-åƒåœ¾å›æ”¶å™¨-CMS-å’Œ-G1çš„åŒºåˆ«ï¼Ÿ"><a href="#9-åƒåœ¾å›æ”¶å™¨-CMS-å’Œ-G1çš„åŒºåˆ«ï¼Ÿ" class="headerlink" title="9.åƒåœ¾å›æ”¶å™¨ CMS å’Œ G1çš„åŒºåˆ«ï¼Ÿ"></a>9.åƒåœ¾å›æ”¶å™¨ CMS å’Œ G1çš„åŒºåˆ«ï¼Ÿ</h2><p><strong>åŒºåˆ«ä¸€ï¼šä½¿ç”¨çš„èŒƒå›´ä¸ä¸€æ ·ï¼š</strong></p><ul><li>CMSæ”¶é›†å™¨æ˜¯<strong>è€å¹´ä»£</strong>çš„æ”¶é›†å™¨ï¼Œå¯ä»¥<strong>é…åˆæ–°ç”Ÿä»£çš„Serialå’ŒParNewæ”¶é›†å™¨ä¸€èµ·ä½¿ç”¨</strong></li><li>G1æ”¶é›†å™¨æ”¶é›†èŒƒå›´æ˜¯<strong>è€å¹´ä»£å’Œæ–°ç”Ÿä»£</strong>ã€‚ä¸éœ€è¦ç»“åˆå…¶ä»–æ”¶é›†å™¨ä½¿ç”¨</li></ul><p><strong>åŒºåˆ«äºŒï¼šSTWçš„æ—¶é—´ï¼š</strong></p><ul><li>CMSæ”¶é›†å™¨ä»¥<strong>æœ€å°çš„åœé¡¿æ—¶é—´</strong>ä¸ºç›®æ ‡çš„æ”¶é›†å™¨ã€‚ç›®æ ‡æ˜¯äº¤äº’æ›´å¤šä¸€ç‚¹</li><li>G1æ”¶é›†å™¨å¯é¢„æµ‹<a href="https://so.csdn.net/so/search?q=åƒåœ¾å›æ”¶&amp;spm=1001.2101.3001.7020">åƒåœ¾å›æ”¶ (opens new window)</a>çš„åœé¡¿æ—¶é—´ï¼ˆå»ºç«‹å¯é¢„æµ‹çš„åœé¡¿æ—¶é—´æ¨¡å‹ï¼‰ï¼Œç›®æ ‡æ˜¯é«˜ååé‡</li></ul><p><strong>åŒºåˆ«ä¸‰ï¼š åƒåœ¾ç¢ç‰‡</strong></p><ul><li>CMSæ”¶é›†å™¨æ˜¯ä½¿ç”¨â€œæ ‡è®°-æ¸…é™¤â€<strong>ç®—æ³•è¿›è¡Œçš„åƒåœ¾å›æ”¶ï¼Œå®¹æ˜“äº§ç”Ÿå†…å­˜ç¢ç‰‡</strong></li><li>G1æ”¶é›†å™¨ä½¿ç”¨çš„æ˜¯â€œ<strong>æ ‡è®°-æ•´ç†</strong>â€ç®—æ³•ï¼Œè¿›è¡Œäº†ç©ºé—´æ•´åˆï¼Œæ²¡æœ‰å†…å­˜ç©ºé—´ç¢ç‰‡</li></ul><p>å±€éƒ¨ä¸Šçœ‹æ˜¯æ ‡è®°-å¤åˆ¶ç®—æ³•</p><p><strong>åŒºåˆ«å››ï¼š åƒåœ¾å›æ”¶çš„è¿‡ç¨‹ä¸ä¸€æ ·</strong></p><p><img src="https://cdn.xiaolincoding.com//picgo/1716015294690-efd71a12-f4b1-4356-9de2-5164393482a5.png" alt="img"></p><p>æ³¨æ„è¿™ä¸¤ä¸ªæ”¶é›†å™¨ç¬¬å››é˜¶æ®µå¾—ä¸åŒ</p><p><strong>åŒºåˆ«äº”: CMSä¼šäº§ç”Ÿæµ®åŠ¨åƒåœ¾</strong></p><ul><li>CMSäº§ç”Ÿæµ®åŠ¨åƒåœ¾è¿‡å¤šæ—¶<strong>ä¼šé€€åŒ–ä¸ºserial oldï¼Œæ•ˆç‡ä½</strong>ï¼Œå› ä¸ºåœ¨ä¸Šå›¾çš„ç¬¬å››é˜¶æ®µï¼ŒCMSæ¸…é™¤åƒåœ¾æ—¶æ˜¯å¹¶å‘æ¸…é™¤çš„ï¼Œè¿™ä¸ªæ—¶å€™ï¼Œåƒåœ¾å›æ”¶çº¿ç¨‹å’Œç”¨æˆ·çº¿ç¨‹åŒæ—¶å·¥ä½œä¼šäº§ç”Ÿæµ®åŠ¨åƒåœ¾ï¼Œ<strong>ä¹Ÿå°±æ„å‘³ç€CMSåƒåœ¾å›æ”¶å™¨å¿…é¡»é¢„ç•™ä¸€éƒ¨åˆ†å†…å­˜ç©ºé—´ç”¨äºå­˜æ”¾æµ®åŠ¨åƒåœ¾</strong></li><li>è€ŒG1æ²¡æœ‰æµ®åŠ¨åƒåœ¾ï¼Œ<strong>G1çš„ç­›é€‰å›æ”¶æ˜¯å¤šä¸ªåƒåœ¾å›æ”¶çº¿ç¨‹å¹¶è¡Œgcçš„ï¼Œæ²¡æœ‰æµ®åŠ¨åƒåœ¾çš„å›æ”¶ï¼Œ</strong>åœ¨æ‰§è¡Œâ€˜å¹¶å‘æ¸…ç†â€™æ­¥éª¤æ—¶ï¼Œ<strong>ç”¨æˆ·çº¿ç¨‹ä¹Ÿä¼šåŒæ—¶äº§ç”Ÿä¸€éƒ¨åˆ†å¯å›æ”¶å¯¹è±¡ï¼Œä½†æ˜¯è¿™éƒ¨åˆ†å¯å›æ”¶å¯¹è±¡åªèƒ½åœ¨ä¸‹æ¬¡æ‰§è¡Œæ¸…ç†æ˜¯æ‰ä¼šè¢«å›æ”¶ã€‚</strong>å¦‚æœåœ¨æ¸…ç†è¿‡ç¨‹ä¸­é¢„ç•™ç»™ç”¨æˆ·çº¿ç¨‹çš„å†…å­˜ä¸è¶³å°±ä¼šå‡ºç°â€˜Concurrent Mode Failureâ€™,<strong>ä¸€æ—¦å‡ºç°æ­¤é”™è¯¯æ—¶ä¾¿ä¼šåˆ‡æ¢åˆ°SerialOldæ”¶é›†æ–¹å¼ã€‚</strong></li></ul><h2 id="10-ä»€ä¹ˆæƒ…å†µä¸‹ä½¿ç”¨CMSï¼Œä»€ä¹ˆæƒ…å†µä½¿ç”¨G1"><a href="#10-ä»€ä¹ˆæƒ…å†µä¸‹ä½¿ç”¨CMSï¼Œä»€ä¹ˆæƒ…å†µä½¿ç”¨G1" class="headerlink" title="10.ä»€ä¹ˆæƒ…å†µä¸‹ä½¿ç”¨CMSï¼Œä»€ä¹ˆæƒ…å†µä½¿ç”¨G1?"></a>10.ä»€ä¹ˆæƒ…å†µä¸‹ä½¿ç”¨CMSï¼Œä»€ä¹ˆæƒ…å†µä½¿ç”¨G1?</h2><p>CMSé€‚ç”¨åœºæ™¯ï¼š</p><ul><li><strong>ä½å»¶è¿Ÿéœ€æ±‚</strong>ï¼šé€‚ç”¨äºå¯¹åœé¡¿æ—¶é—´è¦æ±‚æ•æ„Ÿçš„åº”ç”¨ç¨‹åºã€‚</li><li><strong>è€ç”Ÿä»£æ”¶é›†</strong>ï¼šä¸»è¦é’ˆå¯¹è€å¹´ä»£çš„åƒåœ¾å›æ”¶ã€‚</li><li><strong>ç¢ç‰‡åŒ–ç®¡ç†</strong>ï¼šå®¹æ˜“å‡ºç°å†…å­˜ç¢ç‰‡ï¼Œå¯èƒ½éœ€è¦å®šæœŸè¿›è¡ŒFull GCæ¥å‹ç¼©å†…å­˜ç©ºé—´ã€‚</li></ul><p>G1é€‚ç”¨åœºæ™¯ï¼š</p><ul><li><strong>å¤§å †å†…å­˜</strong>ï¼šé€‚ç”¨äºéœ€è¦ç®¡ç†å¤§å†…å­˜å †çš„åœºæ™¯ï¼Œèƒ½å¤Ÿæœ‰æ•ˆå¤„ç†æ•°GBä»¥ä¸Šçš„å †å†…å­˜ã€‚</li><li><strong>å¯¹å†…å­˜ç¢ç‰‡æ•æ„Ÿ</strong>ï¼šG1é€šè¿‡ç´§å‡‘æ•´ç†æ¥å‡å°‘å†…å­˜ç¢ç‰‡ï¼Œé™ä½äº†ç¢ç‰‡åŒ–å¯¹æ€§èƒ½çš„å½±å“ã€‚</li><li><strong>æ¯”è¾ƒå¹³è¡¡çš„æ€§èƒ½</strong>ï¼šG1åœ¨æä¾›è¾ƒä½åœé¡¿æ—¶é—´çš„åŒæ—¶ï¼Œä¹Ÿä¿æŒäº†ç›¸å¯¹è¾ƒé«˜çš„ååé‡ã€‚</li></ul><h2 id="11-G1å›æ”¶å™¨çš„ç‰¹è‰²æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#11-G1å›æ”¶å™¨çš„ç‰¹è‰²æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="11.G1å›æ”¶å™¨çš„ç‰¹è‰²æ˜¯ä»€ä¹ˆï¼Ÿ"></a>11.G1å›æ”¶å™¨çš„ç‰¹è‰²æ˜¯ä»€ä¹ˆï¼Ÿ</h2><p><strong>G1 çš„ç‰¹ç‚¹ï¼š</strong></p><ul><li>G1æœ€å¤§çš„ç‰¹ç‚¹æ˜¯<strong>å¼•å…¥åˆ†åŒºçš„æ€è·¯ï¼Œå¼±åŒ–äº†åˆ†ä»£çš„æ¦‚å¿µã€‚</strong></li><li><strong>åˆç†åˆ©ç”¨åƒåœ¾æ”¶é›†å„ä¸ªå‘¨æœŸçš„èµ„æº</strong>ï¼Œè§£å†³äº†å…¶ä»–æ”¶é›†å™¨ã€ç”šè‡³ CMS çš„ä¼—å¤šç¼ºé™·</li></ul><p><strong>G1 ç›¸æ¯”è¾ƒ CMS çš„æ”¹è¿›ï¼š</strong></p><ul><li><strong>ç®—æ³•</strong>ï¼š G1 åŸºäºæ ‡è®°â€”æ•´ç†ç®—æ³•, ä¸ä¼šäº§ç”Ÿç©ºé—´ç¢ç‰‡ï¼Œåœ¨åˆ†é…å¤§å¯¹è±¡æ—¶ï¼Œä¸ä¼šå› æ— æ³•å¾—åˆ°è¿ç»­çš„ç©ºé—´ï¼Œè€Œæå‰è§¦å‘ä¸€æ¬¡ FULL GC ã€‚</li><li><strong>åœé¡¿æ—¶é—´å¯æ§</strong>ï¼š G1å¯ä»¥é€šè¿‡è®¾ç½®é¢„æœŸåœé¡¿æ—¶é—´ï¼ˆPause Timeï¼‰æ¥æ§åˆ¶åƒåœ¾æ”¶é›†æ—¶é—´é¿å…åº”ç”¨é›ªå´©ç°è±¡ã€‚</li><li><strong>å¹¶è¡Œä¸å¹¶å‘</strong>ï¼šG1 èƒ½æ›´å……åˆ†çš„åˆ©ç”¨ <strong>CPU å¤šæ ¸ç¯å¢ƒä¸‹çš„ç¡¬ä»¶ä¼˜åŠ¿</strong>ï¼Œæ¥ç¼©çŸ­ stop the world çš„åœé¡¿æ—¶é—´ã€‚</li></ul><h2 id="12-GCåªä¼šå¯¹å †è¿›è¡ŒGCå—ï¼Ÿ"><a href="#12-GCåªä¼šå¯¹å †è¿›è¡ŒGCå—ï¼Ÿ" class="headerlink" title="12.GCåªä¼šå¯¹å †è¿›è¡ŒGCå—ï¼Ÿ"></a>12.GCåªä¼šå¯¹å †è¿›è¡ŒGCå—ï¼Ÿ</h2><p>JVM çš„åƒåœ¾å›æ”¶å™¨ä¸ä»…ä»…ä¼šå¯¹å †è¿›è¡Œåƒåœ¾å›æ”¶ï¼Œå®ƒè¿˜ä¼šå¯¹æ–¹æ³•åŒºè¿›è¡Œåƒåœ¾å›æ”¶ã€‚</p><ol><li><strong>å †ï¼ˆHeapï¼‰ï¼š</strong> å †æ˜¯ç”¨äºå­˜å‚¨å¯¹è±¡å®ä¾‹çš„å†…å­˜åŒºåŸŸã€‚å¤§éƒ¨åˆ†çš„åƒåœ¾å›æ”¶å·¥ä½œéƒ½å‘ç”Ÿåœ¨å †ä¸Šï¼Œå› ä¸ºå¤§å¤šæ•°å¯¹è±¡éƒ½ä¼šè¢«åˆ†é…åœ¨å †ä¸Šï¼Œè€Œåƒåœ¾å›æ”¶çš„é‡ç‚¹é€šå¸¸ä¹Ÿæ˜¯å›æ”¶å †ä¸­ä¸å†è¢«å¼•ç”¨çš„å¯¹è±¡ï¼Œä»¥é‡Šæ”¾å†…å­˜ç©ºé—´ã€‚</li><li><strong>æ–¹æ³•åŒºï¼ˆMethod Areaï¼‰ï¼š</strong> æ–¹æ³•åŒºæ˜¯ç”¨äº<strong>å­˜å‚¨ç±»ä¿¡æ¯ã€å¸¸é‡ã€é™æ€å˜é‡</strong>ç­‰æ•°æ®çš„åŒºåŸŸã€‚è™½ç„¶æ–¹æ³•åŒºä¸­çš„åƒåœ¾å›æ”¶ä¸å †æœ‰æ‰€ä¸åŒï¼Œ<strong>ä½†æ˜¯åŒæ ·å­˜åœ¨å¯¹ä¸å†éœ€è¦çš„å¸¸é‡ã€æ— ç”¨çš„ç±»ä¿¡æ¯ç­‰è¿›è¡Œæ¸…ç†çš„è¿‡ç¨‹ã€‚</strong></li></ol>]]></content:encoded>
      
      
      <category domain="https://blog.tokenlen.top/categories/%E6%8A%80%E6%9C%AF%E6%A0%88/">æŠ€æœ¯æ ˆ</category>
      
      
      <category domain="https://blog.tokenlen.top/tags/java/">java</category>
      
      <category domain="https://blog.tokenlen.top/tags/%E9%9D%A2%E8%AF%95/">é¢è¯•</category>
      
      <category domain="https://blog.tokenlen.top/tags/jvm/">jvm</category>
      
      
      <comments>https://blog.tokenlen.top/2025/05/25/java-stack/jvm2/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>è®¡ç®—æœºç½‘ç»œæœŸæœ«è€ƒè¯•å¤ä¹ </title>
      <link>https://blog.tokenlen.top/2025/05/25/network/networktest/</link>
      <guid>https://blog.tokenlen.top/2025/05/25/network/networktest/</guid>
      <pubDate>Sat, 24 May 2025 16:00:00 GMT</pubDate>
      
        
        
          
          
      <description>&lt;h1 id=&quot;åè¯è§£é‡Š&quot;&gt;&lt;a href=&quot;#åè¯è§£é‡Š&quot; class=&quot;headerlink&quot; title=&quot;åè¯è§£é‡Š&quot;&gt;&lt;/a&gt;åè¯è§£é‡Š&lt;/h1&gt;&lt;h2 id=&quot;1-ARP&quot;&gt;&lt;a href=&quot;#1-ARP&quot; class=&quot;headerlink&quot;</description>
          
        
      
      
      
      <content:encoded><![CDATA[<h1 id="åè¯è§£é‡Š"><a href="#åè¯è§£é‡Š" class="headerlink" title="åè¯è§£é‡Š"></a>åè¯è§£é‡Š</h1><h2 id="1-ARP"><a href="#1-ARP" class="headerlink" title="1.ARP**"></a>1.ARP**</h2><p>ARPï¼ˆåœ°å€è§£æåè®®ï¼‰ç”¨äº<strong>æ ¹æ® IP åœ°å€è·å–å¯¹åº”çš„ MAC åœ°å€</strong>ï¼Œ<strong>æ˜¯ä¸»æœºé€šä¿¡å‰</strong>å¿…é¡»å®Œæˆçš„åœ°å€è§£ææ­¥éª¤ï¼›RARPï¼ˆé€†åœ°å€è§£æåè®®ï¼‰åˆ™ç›¸åï¼Œ<strong>ç”¨äºæ ¹æ®å·²çŸ¥çš„ MAC åœ°å€è·å– IP åœ°å€</strong>ï¼Œå¸¸ç”¨äºæ— ç›˜å·¥ä½œç«™å¯åŠ¨æ—¶å‘ç½‘ç»œè¯·æ±‚ IPã€‚ARP å¸¸è§äºå±€åŸŸç½‘é€šä¿¡ï¼ŒRARP å·²è¢« DHCP ç­‰åè®®å–ä»£ã€‚</p><p>å…¶ä¸­çš„å•æ’­å’Œå¹¿æ’­</p><h2 id="2-CDN"><a href="#2-CDN" class="headerlink" title="2.CDN*"></a>2.CDN*</h2><p>å†…å®¹åˆ†å‘ç½‘ç»œï¼Œç”¨äºå°†<strong>å†…å®¹ç¼“å­˜è‡³ç¦»ç”¨æˆ·æ›´è¿‘çš„èŠ‚ç‚¹</strong>ï¼Œæé«˜è®¿é—®é€Ÿåº¦ã€é™ä½å»¶è¿Ÿã€‚</p><h2 id="3-CSMA"><a href="#3-CSMA" class="headerlink" title="3.CSMA"></a>3.CSMA</h2><p>è½½æ³¢ç›‘å¬å¤šè·¯è®¿é—®ï¼Œç”¨äºä»¥å¤ªç½‘çš„ä»‹è´¨è®¿é—®æ§åˆ¶æ–¹å¼ï¼Œé€šè¿‡â€œç›‘å¬-å‘é€â€æœºåˆ¶å‡å°‘å†²çªã€‚</p><h2 id="4-CRC"><a href="#4-CRC" class="headerlink" title="4.CRC*"></a>4.CRC*</h2><p><strong>å¾ªç¯å†—ä½™æ ¡éªŒ</strong>ï¼Œé“¾è·¯å±‚å¸¸ç”¨çš„å·®é”™æ£€æµ‹æœºåˆ¶ï¼Œèƒ½å‘ç°ä¼ è¾“è¿‡ç¨‹ä¸­çš„æ•°æ®é”™è¯¯ã€‚</p><h2 id="5-CSP"><a href="#5-CSP" class="headerlink" title="5.CSP"></a>5.CSP</h2><p>å†…å®¹å®‰å…¨ç­–ç•¥ï¼Œç”¨äºé˜²æ­¢ XSS ç­‰ç½‘é¡µæ”»å‡»ï¼Œæµè§ˆå™¨é€šè¿‡è¯¥ç­–ç•¥é™åˆ¶ç½‘é¡µèµ„æºåŠ è½½æ¥æºã€‚</p><h2 id="6-MAC"><a href="#6-MAC" class="headerlink" title="6.MAC*"></a>6.MAC*</h2><p>åª’ä½“è®¿é—®æ§åˆ¶åœ°å€ï¼Œæ˜¯ç½‘å¡çš„ç‰©ç†åœ°å€ï¼Œä¹ŸæŒ‡é“¾è·¯å±‚æ§åˆ¶å­å±‚ï¼Œç”¨äºç½‘ç»œè®¿é—®ç®¡ç†ã€‚</p><h2 id="7-MAN"><a href="#7-MAN" class="headerlink" title="7.MAN"></a>7.MAN</h2><p>åŸåŸŸç½‘ï¼Œè¦†ç›–åŸå¸‚èŒƒå›´çš„è®¡ç®—æœºç½‘ç»œï¼Œè§„æ¨¡ä»‹äºå±€åŸŸç½‘ï¼ˆLANï¼‰å’Œå¹¿åŸŸç½‘ï¼ˆWANï¼‰ä¹‹é—´ã€‚</p><h2 id="8-MTU"><a href="#8-MTU" class="headerlink" title="8.MTU*"></a>8.MTU*</h2><p>æœ€å¤§ä¼ è¾“å•å…ƒï¼ŒæŒ‡ç½‘ç»œå±‚ä¸€æ¬¡èƒ½å¤Ÿä¼ è¾“çš„æœ€å¤§æ•°æ®æŠ¥é•¿åº¦ï¼Œå½±å“åˆ†ç‰‡ä¸ä¼ è¾“æ•ˆç‡ã€‚</p><h2 id="9-NAT"><a href="#9-NAT" class="headerlink" title="9.NAT*"></a>9.NAT*</h2><p>ç½‘ç»œåœ°å€è½¬æ¢ï¼Œç”¨äºå°†ç§æœ‰ IP æ˜ å°„ä¸ºå…¬ç½‘ IPï¼Œå®ç°å†…ç½‘è®¾å¤‡è®¿é—®å¤–ç½‘ã€‚</p><h2 id="10-NTP"><a href="#10-NTP" class="headerlink" title="10.NTP"></a>10.NTP</h2><p>ç½‘ç»œæ—¶é—´åè®®ï¼Œç”¨äºåœ¨äº’è”ç½‘ä¸ŠåŒæ­¥ä¸»æœºæ—¶é—´1ã€‚</p><h2 id="11-RTT"><a href="#11-RTT" class="headerlink" title="11.RTT"></a>11.RTT</h2><p>RTT æ˜¯ä»å‘é€æ–¹å‘å‡ºæ•°æ®åˆ°æ¥æ”¶æ–¹åº”ç­”å›æ¥æ‰€ç»å†çš„æ—¶é—´æ€»å’Œï¼Œè¡¡é‡ç½‘ç»œå»¶è¿Ÿã€‚</p><h2 id="12-RIP"><a href="#12-RIP" class="headerlink" title="12.RIP"></a>12.RIP</h2><p>RIP æ˜¯ä¸€ç§åŸºäºè·³æ•°çš„å†…éƒ¨ç½‘å…³åè®®ï¼Œç”¨äºåœ¨è‡ªæ²»ç³»ç»Ÿå†…éƒ¨ä¼ æ’­è·¯ç”±ä¿¡æ¯ã€‚</p><h2 id="ç®€ç­”é¢˜"><a href="#ç®€ç­”é¢˜" class="headerlink" title="ç®€ç­”é¢˜"></a>ç®€ç­”é¢˜</h2><h2 id="1-httpè¯·æ±‚å’Œå“åº”æŠ¥æ–‡"><a href="#1-httpè¯·æ±‚å’Œå“åº”æŠ¥æ–‡" class="headerlink" title="1.httpè¯·æ±‚å’Œå“åº”æŠ¥æ–‡"></a>1.httpè¯·æ±‚å’Œå“åº”æŠ¥æ–‡</h2><p>åˆ†ä¸ºèµ·å§‹è¡Œã€å¤´éƒ¨å­—æ®µå’Œæ¶ˆæ¯ä¸»ä½“ä¸‰éƒ¨åˆ†</p><p>è¯·æ±‚ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">è¯·æ±‚è¡Œï¼ˆRequest Lineï¼‰</span><br><span class="line">è¯·æ±‚å¤´ï¼ˆRequest Headersï¼‰</span><br><span class="line">ç©ºè¡Œ</span><br><span class="line">è¯·æ±‚ä½“ï¼ˆRequest Bodyï¼‰ã€ä»…éƒ¨åˆ†è¯·æ±‚æœ‰ï¼Œå¦‚ POSTã€‘</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>å¸¸è§è¯·æ±‚å¤´</strong>ï¼šHostã€User-Agentã€Acceptã€Content-Typeã€Authorization</p><p>å“åº”ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">çŠ¶æ€è¡Œï¼ˆStatus Lineï¼‰</span><br><span class="line">å“åº”å¤´ï¼ˆResponse Headersï¼‰</span><br><span class="line">ç©ºè¡Œ</span><br><span class="line">å“åº”ä½“ï¼ˆResponse Bodyï¼‰</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>å¸¸è§å“åº”å¤´</strong>ï¼šContent-Typeã€Content-Lengthã€Set-Cookieã€Cache-Control</p><h2 id="2-ç½‘ç»œä½“ç³»ç»“æ„"><a href="#2-ç½‘ç»œä½“ç³»ç»“æ„" class="headerlink" title="2.ç½‘ç»œä½“ç³»ç»“æ„"></a>2.ç½‘ç»œä½“ç³»ç»“æ„</h2><p>OSIä¸ƒå±‚æ¨¡å‹</p><p>æ¯ä¸€å±‚è´Ÿè´£çš„èŒèƒ½éƒ½ä¸åŒï¼Œå¦‚ä¸‹ï¼š</p><ul><li>åº”ç”¨å±‚ï¼Œè´Ÿè´£ç»™åº”ç”¨ç¨‹åºæä¾›ç»Ÿä¸€çš„æ¥å£ï¼›</li><li>è¡¨ç¤ºå±‚ï¼Œè´Ÿè´£æŠŠæ•°æ®è½¬æ¢æˆå…¼å®¹å¦ä¸€ä¸ªç³»ç»Ÿèƒ½è¯†åˆ«çš„æ ¼å¼ï¼›</li><li>ä¼šè¯å±‚ï¼Œè´Ÿè´£å»ºç«‹ã€ç®¡ç†å’Œç»ˆæ­¢è¡¨ç¤ºå±‚å®ä½“ä¹‹é—´çš„é€šä¿¡ä¼šè¯ï¼›</li><li>ä¼ è¾“å±‚ï¼Œè´Ÿè´£ç«¯åˆ°ç«¯çš„æ•°æ®ä¼ è¾“ï¼›</li><li>ç½‘ç»œå±‚ï¼Œè´Ÿè´£æ•°æ®çš„è·¯ç”±ã€è½¬å‘ã€åˆ†ç‰‡ï¼›</li><li>æ•°æ®é“¾è·¯å±‚ï¼Œè´Ÿè´£æ•°æ®çš„å°å¸§å’Œå·®é”™æ£€æµ‹ï¼Œä»¥åŠ MAC å¯»å€ï¼›</li><li>ç‰©ç†å±‚ï¼Œè´Ÿè´£åœ¨ç‰©ç†ç½‘ç»œä¸­ä¼ è¾“æ•°æ®å¸§ï¼›</li></ul><p>tcp/ipå››å±‚æ¨¡å‹</p><ul><li>åº”ç”¨å±‚ æ”¯æŒ HTTPã€SMTP ç­‰æœ€ç»ˆç”¨æˆ·è¿›ç¨‹</li><li>ä¼ è¾“å±‚ å¤„ç†ä¸»æœºåˆ°ä¸»æœºçš„é€šä¿¡ï¼ˆTCPã€UDPï¼‰</li><li>ç½‘ç»œå±‚ å¯»å€å’Œè·¯ç”±æ•°æ®åŒ…ï¼ˆIP åè®®ï¼‰</li><li>é“¾è·¯å±‚ é€šè¿‡ç½‘ç»œçš„ç‰©ç†ç”µçº¿ã€ç”µç¼†æˆ–æ— çº¿ä¿¡é“ç§»åŠ¨æ¯”ç‰¹</li></ul><p>äº”å±‚æ¨¡å‹</p><h2 id="3-tcp-udpåŒºåˆ«"><a href="#3-tcp-udpåŒºåˆ«" class="headerlink" title="3.tcp/udpåŒºåˆ«"></a>3.tcp/udpåŒºåˆ«</h2><p><strong>TCP é¢å‘è¿æ¥ã€å¯é ä¼ è¾“ï¼Œæœ‰ä¸‰æ¬¡æ¡æ‰‹å’Œå››æ¬¡æŒ¥æ‰‹æœºåˆ¶</strong>ï¼Œé€‚ç”¨äºå¯¹æ•°æ®å®Œæ•´æ€§è¦æ±‚é«˜çš„åœºæ™¯ï¼›è€Œ <strong>UDP æ˜¯æ— è¿æ¥ã€å°½æœ€å¤§åŠªåŠ›äº¤ä»˜ã€æ•ˆç‡é«˜ä½†ä¸ä¿è¯å¯é æ€§</strong>ï¼Œé€‚åˆå®æ—¶æ€§è¦æ±‚é«˜çš„åº”ç”¨å¦‚è§†é¢‘é€šè¯ã€DNS æŸ¥è¯¢ç­‰ã€‚</p><div class="table-container"><table><thead><tr><th>ç‰¹æ€§</th><th>TCP</th><th>UDP</th></tr></thead><tbody><tr><td>æ˜¯å¦è¿æ¥</td><td>æ˜¯ï¼ˆä¸‰æ¬¡æ¡æ‰‹ï¼‰</td><td>å¦</td></tr><tr><td>æ˜¯å¦å¯é </td><td>æ˜¯ï¼ˆç¡®è®¤ã€é‡ä¼ ï¼‰</td><td>å¦ï¼ˆå°½åŠ›è€Œä¸ºï¼‰</td></tr><tr><td>é¡ºåºä¿è¯</td><td>æœ‰</td><td>æ— </td></tr><tr><td>å¼€é”€ä¸é€Ÿåº¦</td><td>å¤§ã€æ…¢</td><td>å°ã€å¿«</td></tr><tr><td>å…¸å‹åº”ç”¨åœºæ™¯</td><td>HTTPã€FTPã€SMTP ç­‰</td><td>DNSã€è§†é¢‘ä¼šè®®ã€VoIP ç­‰</td></tr></tbody></table></div><ul><li>å‡å®šæŸUDPæ¥æ”¶æ–¹å¯¹æ¥æ”¶åˆ°çš„UDPæŠ¥æ–‡æ®µè®¡ç®—å› ç‰¹ç½‘æ£€éªŒå’Œï¼Œå¹¶å‘ç°å®ƒä¸æ‰¿è½½åœ¨æ£€éªŒå’Œå­—æ®µä¸­çš„å€¼<br>ç›¸åŒ¹é…ã€‚è¯¥æ¥æ”¶æ–¹èƒ½å¤Ÿç»å¯¹ç¡®ä¿¡æ²¡æœ‰å‡ºç°è¿‡æ¯”ç‰¹å·®é”™å—ï¼Ÿè¯•è§£é‡Šä¹‹ã€‚</li></ul><p>ä¸èƒ½ï¼Œudpçš„é”™è¯¯æ£€æµ‹æœºåˆ¶ä¸å¯èƒ½æ£€æµ‹åˆ°æ‰€æœ‰çš„é”™è¯¯ï¼Œä¸æ˜¯ç™¾åˆ†æ¯”å¯é çš„</p><ul><li>æˆ‘ä»¬æ›¾ç»è¯´è¿‡ï¼Œåº”ç”¨ç¨‹åºå¯èƒ½é€‰æ‹©UDPä½œä¸ºè¿è¾“åè®®ï¼Œå› ä¸ºUDPæä¾›äº†ï¼ˆæ¯”TCPï¼‰æ›´å¥½çš„åº”ç”¨å±‚<br>æ§åˆ¶ï¼Œä»¥å†³å®šåœ¨æŠ¥æ–‡æ®µä¸­å‘é€ä»€ä¹ˆæ•°æ®å’Œå‘é€æ—¶æœºã€‚<br>a.åº”ç”¨ç¨‹åºä¸ºä»€ä¹ˆå¯¹åœ¨æŠ¥æ–‡æ®µä¸­å‘é€ä»€ä¹ˆæ•°æ®æœ‰æ›´å¤šçš„æ§åˆ¶ï¼Ÿ<br>b-åº”ç”¨ç¨‹åºä¸ºä»€ä¹ˆå¯¹ä½•æ—¶å‘é€æŠ¥æ–‡æ®µæœ‰æ›´å¤šçš„æ§åˆ¶ï¼Ÿ </li></ul><p>å› ä¸ºudpæ˜¯æ— è¿æ¥çš„ï¼Œæ²¡æœ‰å»ºç«‹è¿æ¥ç»´æŒè¿æ¥ç»“æŸè¿æ¥çš„è¿‡ç¨‹ï¼Œå¯ä»¥è‡ªç”±è‡ªåœ¨çš„å†³å®šä½•æ—¶å‘é€å¦‚ä½•å‘é€æ•°æ®</p><p>udpæ— è¿æ¥ï¼Œæ²¡æœ‰æµé‡æ§åˆ¶å’Œæ‹¥å¡æ§åˆ¶æœºåˆ¶ã€‚å¯ä»¥åœ¨ä»»ä½•æ—¶é—´å‘é€</p><h2 id="4-ç½‘ç»œå±‚çš„æ§åˆ¶å¹³é¢å’Œæ•°æ®å¹³é¢"><a href="#4-ç½‘ç»œå±‚çš„æ§åˆ¶å¹³é¢å’Œæ•°æ®å¹³é¢" class="headerlink" title="4.ç½‘ç»œå±‚çš„æ§åˆ¶å¹³é¢å’Œæ•°æ®å¹³é¢"></a>4.ç½‘ç»œå±‚çš„æ§åˆ¶å¹³é¢å’Œæ•°æ®å¹³é¢</h2><p>æˆ‘ä»¬æ³¨æ„åˆ°ç½‘ç»œå±‚åŠŸèƒ½å¯è¢«å¤§ä½“åˆ†æˆæ•°æ®å¹³é¢åŠŸèƒ½å’Œæ§åˆ¶å¹³é¢åŠŸèƒ½ã€‚æ•°æ®å¹³é¢çš„ä¸»è¦åŠŸèƒ½æ˜¯ä»€ä¹ˆ?æ§åˆ¶å¹³é¢çš„ä¸»è¦åŠŸèƒ½å‘¢?</p><p>åœ¨ç½‘ç»œå±‚ï¼Œ<strong>æ§åˆ¶å¹³é¢</strong>è´Ÿè´£â€œå†³ç­–â€â€”â€”å³å¦‚<strong>ä½•é€‰è·¯</strong>ï¼ˆå¦‚è·¯ç”±åè®® OSPFã€BGPï¼‰ï¼Œè€Œ<strong>æ•°æ®å¹³é¢</strong>è´Ÿè´£â€œè½¬å‘â€â€”â€”<strong>å³å°†æ•°æ®åŒ…æŒ‰ç…§è·¯ç”±è¡¨å®é™…è½¬å‘å‡ºå»</strong>ã€‚</p><p>æ§åˆ¶å¹³é¢æ„å»ºå’Œç»´æŠ¤è·¯ç”±è¡¨ï¼Œè½¬å‘è¡¨ï¼Œå¤„ç†åè®®äº¤äº’ã€‚</p><p>æ•°æ®å¹³é¢ä½¿ç”¨è·¯ç”±è¡¨å®Œæˆè½¬å‘ï¼Œå†³å®šå¦‚ä½•è½¬å‘æ•°æ®åŒ…ã€‚åŒ¹é…æ•°æ®åŒ…å¤´éƒ¨ï¼Œè½¬å‘æˆ–è€…ä¸¢å¼ƒä¿®æ”¹æ•°æ®ã€‚</p><p>ç½‘ç»œå±‚æ ¸å¿ƒè§£å†³çš„é—®é¢˜æ˜¯<strong>å¯»å€ä¸é€‰è·¯</strong>ï¼Œç›¸å…³çŸ¥è¯†åŒ…æ‹¬ <strong>IP åœ°å€åˆ’åˆ†ã€å­ç½‘æ©ç ã€è·¯ç”±åè®®ï¼ˆé™æ€/åŠ¨æ€ï¼‰ã€è½¬å‘è¡¨ã€æœ€é•¿å‰ç¼€åŒ¹é…ã€NATã€ICMP</strong> ç­‰ï¼Œæ˜¯ç†è§£ç½‘ç»œé€šä¿¡çš„å…³é”®åŸºç¡€ã€‚</p><h2 id="5-RDT"><a href="#5-RDT" class="headerlink" title="5.RDT"></a>5.RDT</h2><p>åœ¨æˆ‘ä»¬çš„rdtåè®®ä¸­ï¼Œä¸ºä»€ä¹ˆéœ€è¦å¼•å…¥åºå·?</p><p>åœ¨æˆ‘ä»¬çš„rdtåè®®ä¸­ï¼Œä¸ºä»€ä¹ˆéœ€è¦å¼•å…¥å®šæ—¶å™¨?</p><p>åœ¨ RDTï¼ˆå¯é æ•°æ®ä¼ è¾“ï¼‰åè®®ä¸­ï¼Œ<strong>å¼•å…¥è®¡æ—¶å™¨æ˜¯ä¸ºäº†åº”å¯¹æ•°æ®ä¸¢å¤±æˆ– ACK ä¸¢å¤±çš„æƒ…å†µï¼Œä¿è¯å‘é€æ–¹èƒ½åœ¨è¶…æ—¶åé‡ä¼ æ•°æ®</strong>ï¼›<strong>å¯¹å¸§ç¼–å·æ˜¯ä¸ºäº†è§£å†³æ•°æ®é‡å¤ã€ä¹±åºç­‰é—®é¢˜ï¼Œä½¿æ¥æ”¶æ–¹èƒ½å¤Ÿè¯†åˆ«æ¯ä¸ªæ•°æ®å¸§çš„å”¯ä¸€æ€§ä¸é¡ºåº</strong>ã€‚è¿™ä¸¤ä¸ªæœºåˆ¶å…±åŒç¡®ä¿äº†åœ¨ä¸å¯é ä¿¡é“ä¸Šä¼ è¾“çš„å¯é æ€§</p><h2 id="6-urlè§£æçš„è¿‡ç¨‹"><a href="#6-urlè§£æçš„è¿‡ç¨‹" class="headerlink" title="6.urlè§£æçš„è¿‡ç¨‹"></a>6.urlè§£æçš„è¿‡ç¨‹</h2><p><strong>æµè§ˆå™¨è¾“å…¥ URL</strong><br> å¦‚ <code>http://www.example.com/index.html</code></p><p><strong>DNS è§£æ</strong><br> æµè§ˆå™¨<strong>å…ˆæŸ¥è¯¢æœ¬åœ°ç¼“å­˜</strong>ï¼Œæ²¡æœ‰åˆ™é€šè¿‡é€’å½’/è¿­ä»£æ–¹å¼å‘ DNS æœåŠ¡å™¨è¯·æ±‚ï¼Œå°†åŸŸåï¼ˆwww.example.comï¼‰è½¬æ¢ä¸º<strong>å¯¹åº”çš„ IP åœ°å€ã€‚</strong></p><p><strong>CDN èŠ‚ç‚¹é€‰æ‹©ï¼ˆå¦‚æœå¯ç”¨ CDNï¼‰</strong></p><ul><li>DNS è¿”å›çš„ä¸æ˜¯æºç«™ IPï¼Œè€Œæ˜¯ç¦»ç”¨æˆ·æœ€è¿‘çš„ CDN è¾¹ç¼˜èŠ‚ç‚¹ IPã€‚</li><li>ç”¨æˆ·è¯·æ±‚ä¼šè¢«å¼•å¯¼åˆ°è¯¥ CDN èŠ‚ç‚¹ï¼Œå‡å°‘è·¨åŸŸå’Œé•¿è·ç¦»ä¼ è¾“ã€‚</li></ul><p><strong>å»ºç«‹ TCP è¿æ¥</strong><br> æµè§ˆå™¨ä¸ CDN èŠ‚ç‚¹ï¼ˆæˆ–æºç«™æœåŠ¡å™¨ï¼‰ä¹‹é—´å»ºç«‹ TCP è¿æ¥ï¼ˆä¸‰æ¬¡æ¡æ‰‹ï¼‰ï¼Œè‹¥æ˜¯ HTTPSï¼Œè¿˜ä¼šè¿›è¡Œ TLS æ¡æ‰‹ã€‚</p><p><strong>å‘é€ HTTP è¯·æ±‚</strong><br> æµè§ˆå™¨å‘é€è¯·æ±‚æŠ¥æ–‡ï¼Œè¯·æ±‚å…·ä½“èµ„æºï¼ˆå¦‚ index.htmlï¼‰ã€‚</p><p><strong>æœåŠ¡å™¨/CDN èŠ‚ç‚¹å“åº”</strong></p><ul><li>CDN èŠ‚ç‚¹è‹¥<strong>ç¼“å­˜å‘½ä¸­</strong>ï¼Œç›´æ¥è¿”å›ç¼“å­˜å†…å®¹ã€‚</li><li>ç¼“å­˜æœªå‘½ä¸­æ—¶ï¼Œ<strong>CDN èŠ‚ç‚¹å‘æºç«™æœåŠ¡å™¨è¯·æ±‚èµ„æºï¼Œç„¶åç¼“å­˜åè¿”å›ç»™ç”¨æˆ·ã€‚</strong></li></ul><p><strong>æµè§ˆå™¨æ¥æ”¶å“åº”ï¼Œæ¸²æŸ“é¡µé¢</strong><br> æµè§ˆå™¨è§£æ HTMLï¼ŒåŠ è½½ CSSã€JSã€å›¾ç‰‡ç­‰èµ„æºï¼Œå®Œæˆé¡µé¢å±•ç¤ºã€‚</p><h2 id="7-ARPè¯·æ±‚ä¸ºä»€ä¹ˆæ˜¯å¹¿æ’­-åº”ç­”ä¸ºä»€ä¹ˆæ˜¯å•æ’­"><a href="#7-ARPè¯·æ±‚ä¸ºä»€ä¹ˆæ˜¯å¹¿æ’­-åº”ç­”ä¸ºä»€ä¹ˆæ˜¯å•æ’­" class="headerlink" title="7.ARPè¯·æ±‚ä¸ºä»€ä¹ˆæ˜¯å¹¿æ’­,åº”ç­”ä¸ºä»€ä¹ˆæ˜¯å•æ’­"></a>7.ARPè¯·æ±‚ä¸ºä»€ä¹ˆæ˜¯å¹¿æ’­,åº”ç­”ä¸ºä»€ä¹ˆæ˜¯å•æ’­</h2><p>ARP è¯·æ±‚é‡‡ç”¨å¹¿æ’­çš„åŸå› </p><p>æœªçŸ¥ç›®æ ‡ MAC åœ°å€ï¼šARP è¯·æ±‚çš„ç›®çš„æ˜¯é€šè¿‡ IP åœ°å€ æŸ¥è¯¢å¯¹åº”çš„ MAC åœ°å€ï¼Œä½†<strong>åˆå§‹æ—¶å¹¶ä¸çŸ¥é“ç›®æ ‡è®¾å¤‡çš„ MACï¼Œå› æ­¤å¿…é¡»å¹¿æ’­åˆ° å±€åŸŸç½‘ï¼ˆLANï¼‰å†…çš„æ‰€æœ‰è®¾å¤‡</strong>ï¼Œç¡®ä¿ç›®æ ‡è®¾å¤‡èƒ½æ”¶åˆ°è¯·æ±‚ã€‚</p><p>å¹¿æ’­åŸŸé™åˆ¶:ARP ä»…åœ¨åŒä¸€å­ç½‘å†…ç”Ÿæ•ˆï¼Œå¹¿æ’­æ–¹å¼èƒ½è¦†ç›–è¯¥ç½‘ç»œå†…çš„æ‰€æœ‰ä¸»æœºã€‚</p><p>ARP åº”ç­”é‡‡ç”¨å•æ’­çš„åŸå› </p><p>å·²çŸ¥è¯·æ±‚æ–¹çš„ MAC åœ°å€ï¼šåœ¨ ARP è¯·æ±‚æŠ¥æ–‡ä¸­ï¼Œ<strong>å‘é€æ–¹å·²ç»å¡«å†™äº†è‡ªå·±çš„ MAC å’Œ IPï¼Œå› æ­¤ç›®æ ‡è®¾å¤‡å¯ä»¥ç›´æ¥ å•æ’­å›å¤ï¼Œ</strong>æ— éœ€å†æ¬¡å¹¿æ’­ã€‚</p><p>å‡å°‘ç½‘ç»œæµé‡ï¼šå¦‚æœ ARP åº”ç­”ä¹Ÿå¹¿æ’­ï¼Œ<strong>ä¼šå¯¼è‡´ä¸å¿…è¦çš„ç½‘ç»œæ‹¥å¡</strong>ï¼Œè€Œå•æ’­ä»…å‘é€ç»™è¯·æ±‚æ–¹ï¼Œæ›´é«˜æ•ˆã€‚</p><p>ç›®æ ‡æ˜ç¡®ï¼šARP åº”ç­”çš„ ç›®æ ‡ MAC å’Œ IP ç›´æ¥å–è‡ª ARP è¯·æ±‚çš„ å‘é€æ–¹å­—æ®µï¼Œå› æ­¤èƒ½ç²¾å‡†é€è¾¾ã€‚</p><h1 id="è®¡ç®—"><a href="#è®¡ç®—" class="headerlink" title="è®¡ç®—"></a>è®¡ç®—</h1><p><strong>ipåœ°å€åˆ’åˆ†</strong></p><p><strong>crcå¾ªç¯å†—ä½™æ ¡éªŒ</strong></p><p><strong>äºŒè¿›åˆ¶å›é€€ç®—æ³•ï¼Œç­‰å¤šå°‘æ—¶é—´,å‘ç”Ÿäº†å‡ æ¬¡ç¢°æ’</strong></p><p><strong>æœ¬åœ°ç¼“å­˜(åŠ äº†ç¼“å­˜åå¯¹æ‰€åœ¨é“¾è·¯å¾€è¿”æ—¶å»¶æœ‰ä»€ä¹ˆæ”¹è§‚)(è¯¾åä¹ é¢˜å¯èƒ½)</strong></p><p>è€ƒè™‘ä»…æœ‰ä¸€æ¡å•ä¸€çš„TCP ï¼ˆRenoï¼‰è¿æ¥ä½¿ç”¨ä¸€æ¡10Mbpsé“¾è·¯ï¼Œä¸”è¯¥é“¾è·¯æ²¡æœ‰ç¼“å­˜ä»»ä½•æ•°æ®ã€‚å‡è®¾<br>è¿™æ¡é“¾è·¯æ˜¯å‘é€ä¸»æœºå’Œæ¥æ”¶ä¸»æœºä¹‹é—´çš„å”¯ä¸€æ‹¥å¡é“¾è·¯ã€‚å‡å®šæŸTCPå‘é€æ–¹å‘æ¥æ”¶æ–¹æœ‰ä¸€ä¸ªå¤§æ–‡ä»¶è¦<br>å‘é€ï¼Œè€Œæ¥æ”¶æ–¹çš„æ¥æ”¶ç¼“å­˜æ¯”æ‹¥å¡çª—å£è¦å¤§å¾—å¤šã€‚æˆ‘ä»¬ä¹Ÿåšä¸‹åˆ—å‡è®¾ï¼šæ¯ä¸ªTCPæŠ¥æ–‡æ®µé•¿åº¦ä¸º1500<br>å­—èŠ‚ï¼›è¯¥è¿æ¥çš„åŒå‘ä¼ æ’­æ—¶å»¶æ˜¯150msï¼›å¹¶ä¸”è¯¥TCPè¿æ¥æ€»æ˜¯å¤„äºæ‹¥å¡é¿å…é˜¶æ®µï¼Œå³å¿½ç•¥äº†æ…¢<br>å¯åŠ¨ã€‚<br>a.è¿™æ¡TCPè¿æ¥èƒ½å¤Ÿå–å¾—çš„æœ€å¤§çª—å£é•¿åº¦ï¼ˆä»¥æŠ¥æ–‡æ®µè®¡ï¼‰æ˜¯å¤šå°‘ï¼Ÿ<br>b. è¿™æ¡TCPè¿æ¥çš„å¹³å‡çª—å£é•¿åº¦ï¼ˆä»¥æŠ¥æ–‡æ®µè®¡ï¼‰å’Œå¹³å‡ååé‡ï¼ˆä»¥bpsè®¡ï¼‰æ˜¯å¤šå°‘ï¼Ÿ<br>c. è¿™æ¡TCPè¿æ¥åœ¨ä»ä¸¢åŒ…æ¢å¤åï¼Œå†æ¬¡åˆ°è¾¾å…¶æœ€å¤§çª—å£è¦ç»å†å¤šé•¿æ—¶é—´ï¼Ÿ</p><p>æœ€å¤§çª—å£å¤§å°ï¼ˆæŠ¥æ–‡æ®µï¼‰ = <strong>å¸¦å®½ Ã— RTT / MSS</strong></p><script type="math/tex; mode=display">10MbpsÃ—0.15s=1.5Mb=1,500,000bit</script><p>æŠ¥æ–‡æ®µå¤§å° MSS=12,000 bit</p><p>æ‰€ä»¥<strong>æœ€å¤§çª—å£é•¿åº¦</strong>ä¸º125</p><p><strong>å¹³å‡çª—å£å¤§å°</strong>ä¸ºï¼šå¹³å‡çª—å£é•¿åº¦=w/2+w/4=3/4*wï¼Œå¸¦å…¥æŠ¥æ–‡çª—å£ä¸º125ï¼Œç­‰äº93.75ä¸ªæŠ¥æ–‡æ®µ</p><p><strong>å¹³å‡ååé‡</strong>ï¼ˆbpsï¼‰ï¼šå¹³å‡çª—å£å¤§å° Ã— MSS / RTT = 7,500,000 bps=7.5 Mbps</p><p>æ¯ RTT å°†çª—å£å¢åŠ  1 ä¸ªæŠ¥æ–‡æ®µï¼Œä¸¢åŒ…å‘ç”Ÿæ—¶çª—å£å‡åŠï¼šä» <code>W</code> é™åˆ° <code>W/2</code>ï¼Œè¦ä» <code>W/2</code> å¢é•¿åˆ° <code>W</code>ï¼Œéœ€å¢åŠ  <code>W/2</code> ä¸ªæŠ¥æ–‡æ®µã€‚RTT*w/2=9.375</p><p><strong>TCPæ–‡ä»¶å’Œå­—æ®µè”ç³»èµ·æ¥ï¼Œåºå·å­—æ®µ(32ä½)ï¼Œå¯ä»¥è¿ç»­å‘é€å¤šå°‘ä¸ªå­—èŠ‚(2^32ä¸ª) â€”&gt; æœ€å¤§æ–‡ä»¶å¯ä»¥è¾¾åˆ°å¤šå°‘ (è¯¾åä¹ é¢˜) åœ¨ä¸€ä¸ªå›ºå®šçš„ç½‘ç»œé‡Œ,å·²çŸ¥ç½‘ç»œå¸¦å®½è¦æŠŠè¿™ä¸ªæ–‡ä»¶å‘é€è¦å¤šé•¿æ—¶é—´</strong></p><p>å‡è®¾ä¸»æœºAé€šè¿‡ä¸€æ¡TCPè¿æ¥å‘ä¸»æœºBå‘é€ä¸¤ä¸ªç´§æ¥ç€çš„TCPæŠ¥æ–‡æ®µÂ°ç¬¬ä¸€ä¸ªæŠ¥æ–‡æ®µçš„åºå·ä¸º90,<br>ç¬¬äºŒä¸ªæŠ¥æ–‡æ®µåºå·ä¸º110</p><p>a.ç¬¬ä¸€ä¸ªæŠ¥æ–‡æ®µä¸­æœ‰å¤šå°‘æ•°æ®? <strong>20</strong><br>b.å‡è®¾ç¬¬ä¸€ä¸ªæŠ¥æ–‡æ®µä¸¢å¤±è€Œç¬¬äºŒä¸ªæŠ¥æ–‡æ®µåˆ°è¾¾ä¸»æœºBã€‚é‚£ä¹ˆåœ¨ä¸»æœºBå‘å¾€ä¸»æœºAçš„ç¡®è®¤æŠ¥æ–‡ä¸­,<br>ç¡®è®¤å·åº”è¯¥æ˜¯å¤šå°‘ï¼Ÿ <strong>90</strong></p><p><strong>åç </strong>ï¼š</p><p>UDPå’ŒTCPä½¿ç”¨åç æ¥è®¡ç®—å®ƒä»¬çš„æ£€éªŒå’Œã€‚å‡è®¾ä½ æœ‰ä¸‹é¢3ä¸ª8æ¯”ç‰¹å­—èŠ‚ï¼š01010011, 01100110,<br>01110100.è¿™äº›8æ¯”ç‰¹å­—èŠ‚å’Œçš„åç æ˜¯å¤šå°‘ï¼Ÿï¼ˆæ³¨æ„åˆ°å°½ç®¡UDPå’ŒTCPä½¿ç”¨16æ¯”ç‰¹çš„å­—æ¥è®¡ç®—æ£€éªŒ<br>å’Œï¼Œä½†å¯¹äºè¿™ä¸ªé—®é¢˜ï¼Œä½ åº”è¯¥è€ƒè™‘8æ¯”ç‰¹å’Œã€‚ï¼‰å†™å²€æ‰€æœ‰å·¥ä½œè¿‡ç¨‹ã€‚UDPä¸ºä»€ä¹ˆè¦ç”¨è¯¥å’Œçš„åç ï¼Œå³<br>ä¸ºä»€ä¹ˆä¸ç›´æ¥ä½¿ç”¨è¯¥å’Œå‘¢ï¼Ÿä½¿ç”¨è¯¥åç æ–¹æ¡ˆï¼Œæ¥æ”¶æ–¹å¦‚ä½•æ£€æµ‹å‡ºå·®é”™ï¼Ÿ 1æ¯”ç‰¹çš„å·®é”™å°†å¯èƒ½æ£€æµ‹ä¸å‡º<br>æ¥å—ï¼Ÿ 2æ¯”ç‰¹çš„å·®é”™å‘¢ï¼Ÿ</p><p>é€ä¸ªç›¸åŠ ï¼Œä½†éœ€æ³¨æ„ <strong>æº¢å‡ºçš„è¿›ä½ï¼ˆcarryï¼‰è¦åŠ å›</strong></p><p>å¯ä»¥å…ˆå…¨è½¬ä¸ºåè¿›åˆ¶å¾—åˆ°301ï¼Œç„¶åè½¬ä¸º2è¿›åˆ¶ï¼Œå‘ç°ä¸º9ä½è¶…äº†ã€‚ç„¶åå†å›ç»•ï¼ŒæŠŠé«˜ä½çš„1åŠ åˆ°ä½ä½é‡Œé¢</p><p>å°±æ˜¯45+1=46ç„¶åè½¬ä¸º2è¿›åˆ¶å–å</p><p>å¾—åˆ°<strong>11010001</strong></p><p>æˆ–è€…æ˜¯ç›´æ¥äºŒè¿›åˆ¶è¿ç®—ï¼Œä½†æ˜¯æ³¨æ„ä¹Ÿæ˜¯è¦å›é€€çš„ï¼Œ11çš„æ—¶å€™è¿”å›0ï¼Œè¿›ä½1</p><p><strong>ä¼ è¾“</strong>ï¼š</p><h1 id="ç»¼åˆé¢˜ç›®"><a href="#ç»¼åˆé¢˜ç›®" class="headerlink" title="ç»¼åˆé¢˜ç›®"></a>ç»¼åˆé¢˜ç›®</h1><h2 id="CSMA-CD-è¯¾ä»¶6-P33"><a href="#CSMA-CD-è¯¾ä»¶6-P33" class="headerlink" title="CSMA/CD(è¯¾ä»¶6 P33)"></a>CSMA/CD(è¯¾ä»¶6 P33)</h2><p><img src="C:\Users\ikeife\AppData\Roaming\Typora\typora-user-images\image-20250529135805545.png" alt="image-20250529135805545"></p><p><img src="C:\Users\ikeife\AppData\Roaming\Typora\typora-user-images\image-20250529135812262.png" alt="image-20250529135812262"></p><p>ç½‘å¡æ¥å—æ¥è‡ªç½‘ç»œå±‚çš„æ•°æ®æŠ¥ï¼Œå¹¶ç”Ÿæˆå¸§ã€‚</p><p>å¦‚æœç½‘å¡æ£€æµ‹åˆ°ä¿¡é“ç©ºé—²ï¼Œåˆ™å¼€å§‹å¸§çš„ä¼ è¾“ï¼Œå¦‚æœä¿¡é“ç¹å¿™ï¼Œå°±ç­‰åˆ°ç©ºé—²çš„æ—¶å€™å†ç»§ç»­ä¼ è¾“</p><p>å¦‚æœç½‘å¡ä¼ è¾“äº†æ•´ä¸ªå¸§ï¼Œä½†æ˜¯æ²¡æœ‰æ£€æµ‹å¦ä¸€ä¸ªå¸§ã€‚ç½‘å¡å°†å…ˆå®Œæˆå¸§çš„ä¼ è¾“</p><p>å¦‚æœç½‘å¡åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­ï¼Œé‡åˆ°äº†å¦ä¸€ä¸ªä¼ è¾“ï¼Œå°†ä¼šä¸­æ­¢å¹¶å‘é€å¹²æ‰°ä¿¡å·</p><p>ç»ˆæ­¢åï¼Œç½‘å¡å°†è¿›å…¥äºŒè¿›åˆ¶å›é€€ï¼š</p><p>â€‹    åœ¨ç»å†mæ¬¡ç¢°æ’åï¼Œç½‘å¡åœ¨0â€¦2^m-1ä¸­ä»»æ„é€‰æ‹©Kï¼Œç½‘å¡å°†ä¼šç­‰å¾…k*512ä½ä½¿åŠ²æŒ‰</p><p>â€‹    æ›´é•¿çš„å®è·µå›é¿ï¼Œé¿å…æ›´å¤šå†²çª</p><p>Ttorp=LANä¸­ä¸¤ä¸ªèŠ‚ç‚¹ç›´æ¥çš„æœ€å¤§ä¼ æ’­å»¶è¿Ÿ</p><p>ttans=æœ€å¤§ä¼ è¾“å°ºå¯¸å¸§çš„æ—¶é—´</p><p>æ•ˆç‡å°±æ˜¯é‚£ä¸ªå…¬å¼</p><h2 id="bob-cdn"><a href="#bob-cdn" class="headerlink" title="bob cdn"></a>bob cdn</h2><p><img src="C:\Users\ikeife\AppData\Roaming\Typora\typora-user-images\image-20250529135827082.png" alt="image-20250529135827082"></p><p>bobä»ç½‘é¡µçš„urlä¸­è·å–è§†é¢‘çš„urlï¼Œè§£æè§†é¢‘urlåˆ°æœ¬åœ°çš„dnsï¼Œè¿”å›çš„æ˜¯ä¸€ä¸ªcdnåœ°å€ã€‚</p><p>æœ¬åœ°dnsç»§ç»­é€’å½’è§£æcdn urlåƒcdnçš„æƒå¨æœåŠ¡å™¨è¯·æ±‚ï¼Œè·å–ç¦»bobæœ€è¿‘çš„cdnèŠ‚ç‚¹çš„ipåœ°å€</p><p>æµè§ˆå™¨å‘æœ€è¿‘çš„cdnèŠ‚ç‚¹å‘é€httpè¯·æ±‚ã€‚</p><p><img src="C:\Users\ikeife\AppData\Roaming\Typora\typora-user-images\image-20250529135831982.png" alt="image-20250529135831982"></p><p><img src="C:\Users\ikeife\AppData\Roaming\Typora\typora-user-images\image-20250529135844667.png" alt="image-20250529135844667"></p><h1 id="é‡ç‚¹é¢˜ç›®"><a href="#é‡ç‚¹é¢˜ç›®" class="headerlink" title="é‡ç‚¹é¢˜ç›®"></a>é‡ç‚¹é¢˜ç›®</h1><ul><li>æè¿°åº”ç”¨ç¨‹åºå¼€å‘è€…ä¸ºä»€ä¹ˆå¯èƒ½é€‰æ‹©åœ¨UDPä¸Šè¿è¡Œåº”ç”¨ç¨‹åºè€Œä¸æ˜¯åœ¨TCPä¸Šè¿è¡Œçš„åŸå› </li></ul><p>ç”±äº UDP æ˜¯æ— è¿æ¥çš„ä¼ è¾“åè®®ï¼Œä¸éœ€è¦å»ºç«‹è¿æ¥ã€æ— éœ€ä¸‰æ¬¡æ¡æ‰‹ï¼Œä¹Ÿä¸è¿›è¡Œç¡®è®¤åº”ç­”å’Œé‡ä¼ æœºåˆ¶ï¼Œå› æ­¤é€‚åˆå¯¹æ—¶æ•ˆæ€§è¦æ±‚é«˜ã€å¯ä»¥å®¹å¿å°‘é‡æ•°æ®ä¸¢å¤±çš„åº”ç”¨åœºæ™¯ï¼Œå¦‚è§†é¢‘ä¼šè®®ã€åœ¨çº¿æ¸¸æˆã€å®æ—¶è¯­éŸ³é€šä¿¡ç­‰ã€‚æ­¤å¤–ï¼ŒUDP çš„åè®®å¼€é”€æ›´å°ï¼Œèµ„æºæ¶ˆè€—æ›´ä½ï¼Œé€‚åˆéœ€è¦å¿«é€Ÿä¼ è¾“å°æ•°æ®åŒ…çš„è½»é‡çº§åº”ç”¨ã€‚</p><ul><li>å½“æŸåº”ç”¨ç¨‹åºè¿è¡Œåœ¨UDPä¸Šæ—¶ï¼Œè¯¥åº”ç”¨ç¨‹åºå¯èƒ½å¾—åˆ°å¯é æ•°æ®ä¼ è¾“å—ï¼Ÿå¦‚æœèƒ½ï¼Œå¦‚ä½•å®ç°ï¼Ÿ</li></ul><p><strong>å¯ä»¥é€šè¿‡åœ¨åº”ç”¨å±‚è‡ªè¡Œè®¾è®¡æœºåˆ¶</strong>æ¥å®ç°å¯é ä¼ è¾“ã€‚å…·ä½“åšæ³•åŒ…æ‹¬ï¼šä¸ºæ¯ä¸ªæ•°æ®åŒ…æ·»åŠ åºå·ä»¥ä¾¿æ¥æ”¶æ–¹èƒ½æ£€æµ‹æ˜¯å¦æœ‰ä¸¢åŒ…ã€é‡å¤åŒ…æˆ–ä¹±åºæ•°æ®ï¼Œå¹¶åˆ©ç”¨åº”ç­”æœºåˆ¶ï¼ˆACKï¼‰è®©æ¥æ”¶æ–¹å‘ŠçŸ¥å‘é€æ–¹å“ªäº›æ•°æ®å·²æˆåŠŸæ”¶åˆ°ï¼›å¦‚æœå‘é€æ–¹åœ¨ä¸€å®šæ—¶é—´å†…æœªæ”¶åˆ° ACKï¼Œåˆ™å¯ä»¥é‡ä¼ æ•°æ®åŒ…ã€‚æ­¤å¤–ï¼Œè¿˜å¯ä»¥è®¾ç½®è¶…æ—¶é‡ä¼ ã€æ»‘åŠ¨çª—å£ã€æµé‡æ§åˆ¶ç­‰æœºåˆ¶æ¥è¿›ä¸€æ­¥å¢å¼ºå¯é æ€§</p><ul><li>å‡å®šåœ¨ä¸»æœºCç«¯å£ 80ä¸Šè¿è¡Œçš„ä¸€ä¸ªWebæœåŠ¡å™¨ã€‚å‡å®šè¿™ä¸ªWebæœåŠ¡å™¨ä½¿ç”¨æŒç»­è¿æ¥ï¼Œå¹¶ä¸”æ­£åœ¨æ¥ æ”¶æ¥è‡ªä¸¤å°ä¸åŒä¸»æœºAå’ŒBçš„è¯·æ±‚ã€‚è¢«å‘é€çš„æ‰€æœ‰è¯·æ±‚éƒ½é€šè¿‡ä½äºä¸»æœºCçš„ç›¸åŒå¥—æ¥å­—å—ï¼Ÿå¦‚æœå®ƒ ä»¬é€šè¿‡ä¸åŒçš„å¥—æ¥å­—ä¼ é€’ï¼Œè¿™ä¸¤ä¸ªå¥—æ¥å­—éƒ½å…·æœ‰ç«¯å£ 80å—ï¼Ÿè®¨è®ºå’Œè§£é‡Šä¹‹ï¼š</li></ul><p><strong>ä¼šå°†æ¥è‡ªä¸»æœº A å’Œä¸»æœº B çš„è¯·æ±‚éƒ½é€šè¿‡åŒä¸€ä¸ªå¥—æ¥å­—å¤„ç†</strong>ã€‚è™½ç„¶æ‰€æœ‰è¯·æ±‚æœ€åˆéƒ½æ˜¯é€šè¿‡ <strong>ç«¯å£ 80</strong> åˆ°è¾¾æœåŠ¡å™¨çš„ï¼Œä½†æ“ä½œç³»ç»Ÿä¼šä¸ºæ¯ä¸€ä¸ªå®¢æˆ·ç«¯è¿æ¥åˆ›å»ºä¸€ä¸ª <strong>æ–°çš„å¥—æ¥å­—ï¼ˆsocketï¼‰</strong> æ¥è¿›è¡Œå®é™…é€šä¿¡ã€‚</p><ul><li><p>é€šè¿‡ä¸€æ¡TCPè¿æ¥å‘ä¸»æœºBå‘é€ä¸¤ä¸ªç´§æ¥ç€çš„TCPæŠ¥æ–‡æ®µÂ°ç¬¬ä¸€ä¸ªæŠ¥æ–‡æ®µçš„åºå·ä¸º90,<br>ç¬¬äºŒä¸ªæŠ¥æ–‡æ®µåºå·ä¸º110</p><p>ç¬¬ä¸€ä¸ªæŠ¥æ–‡æ®µä¸­æœ‰å¤šå°‘æ•°æ®?<br>b.å‡è®¾ç¬¬ä¸€ä¸ªæŠ¥æ–‡æ®µä¸¢å¤±è€Œç¬¬äºŒä¸ªæŠ¥æ–‡æ®µåˆ°è¾¾ä¸»æœºBã€‚é‚£ä¹ˆåœ¨ä¸»æœºBå‘å¾€ä¸»æœºAçš„ç¡®è®¤æŠ¥æ–‡ä¸­,<br>ç¡®è®¤å·åº”è¯¥æ˜¯å¤šå°‘ï¼Ÿ</p></li></ul><p>æ•°æ®=110-90=20</p><p>è¿˜æ˜¯90ï¼Œç„¶åè§¦å‘é‡ä¼ æœºåˆ¶</p><ul><li>å‡è®¾ä¸¤æ¡TCPè¿æ¥å­˜åœ¨äºä¸€ä¸ªå¸¦å®½ä¸ºR bpsçš„ç“¶é¢ˆé“¾è·¯ä¸Šã€‚å®ƒä»¬éƒ½è¦å‘é€ä¸€ä¸ªå¾ˆå¤§çš„æ–‡ä»¶ï¼ˆä»¥ç›¸åŒ<br>æ–¹å‘ç»è¿‡ç“¶é¢ˆé“¾è·¯ï¼‰ï¼Œå¹¶ä¸”ä¸¤è€…æ˜¯åŒæ—¶å¼€å§‹å‘é€æ–‡ä»¶ã€‚é‚£ä¹ˆTCPå°†ä¸ºæ¯æ¡è¿æ¥åˆ†é…ä»€ä¹ˆæ ·çš„ä¼ è¾“<br>é€Ÿç‡ï¼Ÿ</li></ul><p>å½“ä¸¤æ¡ TCP è¿æ¥åŒæ—¶é€šè¿‡å¸¦å®½ä¸º R bps çš„ç“¶é¢ˆé“¾è·¯å‘é€å¤§æ–‡ä»¶æ—¶ï¼Œç”±äº TCP æ‹¥å¡æ§åˆ¶æœºåˆ¶çš„ä½œç”¨ï¼Œç³»ç»Ÿä¼šæ ¹æ®é“¾è·¯çš„æ‹¥å¡æƒ…å†µ<strong>åŠ¨æ€è°ƒæ•´å‘é€é€Ÿç‡ï¼Œä½¿æ¯æ¡è¿æ¥æœ€ç»ˆè·å¾—çº¦ R/2 bps</strong> çš„ä¼ è¾“é€Ÿç‡ï¼Œä»è€Œå…¬å¹³åœ°å…±äº«ç“¶é¢ˆå¸¦å®½ã€‚è¿™ç§å…¬å¹³æ€§æ˜¯ TCP æ‹¥å¡æ§åˆ¶çš„è‡ªç„¶ç»“æœï¼Œå°¤å…¶æ˜¯åœ¨ç½‘ç»œæ¡ä»¶ä¸€è‡´ã€æ²¡æœ‰å…¶ä»–å½±å“å› ç´ æ—¶æ›´ä¸ºæ˜æ˜¾ã€‚</p><h1 id="ä½œä¸šé¢˜ç›®å­—å…¸"><a href="#ä½œä¸šé¢˜ç›®å­—å…¸" class="headerlink" title="ä½œä¸šé¢˜ç›®å­—å…¸"></a>ä½œä¸šé¢˜ç›®å­—å…¸</h1><p>ç¬¬ä¸€ç« ï¼š</p><ul><li><p>â€œä¸»æœºâ€å’Œâ€œç«¯ç³»ç»Ÿâ€ä¹‹é—´æœ‰ä»€ä¹ˆä¸åŒï¼Ÿåˆ—ä¸¾å‡ ç§ä¸åŒç±»å‹çš„ç«¯ç³»ç»Ÿã€‚WebæœåŠ¡å™¨æ˜¯ä¸€ç§ç«¯ç³»ç»Ÿå—?</p></li><li><p>7.ä»¥å¤ªLANçš„ä¼ è¾“é€Ÿç‡æ˜¯å¤šå°‘?</p></li><li><p>.æè¿°ä»Šå¤©æœ€ä¸ºæµè¡Œçš„æ— çº¿å› ç‰¹ç½‘æ¥å…¥æŠ€æœ¯ã€‚å¯¹å®ƒä»¬è¿›è¡Œæ¯”è¾ƒå’Œå¯¹ç…§ã€‚</p></li><li><p>å‡å®šåœ¨å‘é€ä¸»æœºå’Œæ¥æ”¶ä¸»æœºé—´åªæœ‰ä¸€å°åˆ†ç»„äº¤æ¢æœºã€‚å‘é€ä¸»æœºå’Œäº¤æ¢æœºé—´ä»¥åŠäº¤æ¢æœºå’Œæ¥æ”¶ä¸»æœºé—´<br>çš„ä¼ è¾“é€Ÿç‡åˆ†åˆ«æ˜¯&amp;å’Œå¿Œã€‚å‡è®¾è¯¥äº¤æ¢æœºä½¿ç”¨å­˜å‚¨è½¬å‘åˆ†ç»„äº¤æ¢æ–¹å¼ï¼Œå‘é€ä¸€ä¸ªé•¿åº¦ä¸ºå¶çš„åˆ†ç»„<br>çš„ç«¯åˆ°ç«¯æ€»æ—¶å»¶æ˜¯ä»€ä¹ˆï¼Ÿï¼ˆå¿½ç•¥æ’é˜Ÿæ—¶å»¶ã€ä¼ æ’­æ—¶å»¶å’Œå¤„ç†æ—¶å»¶ã€‚ï¼‰</p></li><li><p>å‡å®šç”¨æˆ·å…±äº«ä¸€æ¡2Mbpsé“¾è·¯ã€‚åŒæ—¶å‡å®šå½“æ¯ä¸ªç”¨æˆ·ä¼ è¾“æ—¶è¿ç»­ä»¥1Mbpsä¼ è¾“ï¼Œä½†æ¯ä¸ªç”¨æˆ·ä»…ä¼ è¾“<br>20%çš„æ—¶é—´ã€‚<br>a.å½“ä½¿ç”¨ç”µè·¯äº¤æ¢æ—¶ï¼Œèƒ½å¤Ÿæ”¯æŒå¤šå°‘ç”¨æˆ·?<br>b. ä½œä¸ºè¯¥é¢˜çš„åç»§é—®é¢˜ï¼Œå‡å®šä½¿ç”¨åˆ†ç»„äº¤æ¢ã€‚ ä¸ºä»€ä¹ˆå¦‚æœä¸¤ä¸ªæˆ–æ›´å°‘çš„ç”¨æˆ·åŒæ—¶ä¼ è¾“çš„è¯ï¼Œåœ¨é“¾<br>è·¯å‰é¢åŸºæœ¬ä¸Šæ²¡æœ‰æ’é˜Ÿæ—¶å»¶ï¼Ÿä¸ºä»€ä¹ˆå¦‚æœ3ä¸ªç”¨æˆ·åŒæ—¶ä¼ è¾“çš„è¯ï¼Œå°†æœ‰æ’é˜Ÿæ—¶å»¶?<br>c. æ±‚å‡ºæŸæŒ‡å®šç”¨æˆ·æ­£åœ¨ä¼ è¾“çš„æ¦‚ç‡ã€‚<br>d. å‡å®šç°åœ¨æœ‰3ä¸ªç”¨æˆ·ã€‚æ±‚å‡ºåœ¨ä»»ä½•ç»™å®šçš„æ—¶é—´ï¼Œæ‰€æœ‰3ä¸ªç”¨æˆ·åœ¨åŒæ—¶ä¼ è¾“çš„æ¦‚ç‡ã€‚æ±‚å‡ºé˜Ÿåˆ—å¢é•¿<br>j çš„æ—¶é—´æ¯”ç‡ã€‚</p></li><li><p>â€”ä¸ªé•¿åº¦ä¸º1000å­—èŠ‚çš„åˆ†ç»„ç»è·ç¦»ä¸º2500kmçš„é“¾è·¯ä¼ æ’­ï¼Œä¼ æ’­é€Ÿç‡ä¸º2.5xl08m/så¹¶ä¸”ä¼ è¾“é€Ÿç‡<br>ä¸º2Mbps,å®ƒéœ€è¦ç”¨å¤šé•¿æ—¶é—´ï¼Ÿæ›´ä¸ºä¸€èˆ¬åœ°ï¼Œä¸€ä¸ªé•¿åº¦ä¸ºå¶çš„åˆ†ç»„ç»è·ç¦»ä¸º/çš„é“¾è·¯ä¼ æ’­ï¼Œä¼ æ’­é€Ÿç‡ä¸ºå¹¶ä¸”ä¼ è¾“é€Ÿç‡ä¸ºRbps,å®ƒéœ€è¦ç”¨å¤šé•¿æ—¶é—´ï¼Ÿè¯¥æ—¶å»¶ä¸ä¼ è¾“é€Ÿç‡ç›¸å…³å—ï¼Ÿ</p></li><li><p>å› ç‰¹ç½‘åè®®æ ˆä¸­çš„5ä¸ªå±‚æ¬¡æœ‰å“ªäº›ï¼Ÿåœ¨è¿™äº›å±‚æ¬¡ä¸­ï¼Œæ¯å±‚çš„ä¸»è¦ä»»åŠ¡æ˜¯ä»€ä¹ˆï¼Ÿ</p></li><li><p>è·¯ç”±å™¨å¤„ç†å› ç‰¹ç½‘åè®®æ ˆä¸­çš„å“ªäº›å±‚æ¬¡ï¼Ÿé“¾è·¯å±‚äº¤æ¢æœºå¤„ç†çš„æ˜¯å“ªäº›å±‚æ¬¡ï¼Ÿä¸»æœºå¤„ç†çš„æ˜¯å“ªäº›å±‚æ¬¡ï¼Ÿ</p></li><li><p>å¼ï¼ˆ1ãƒ»1ï¼‰ç»™å‡ºäº†ç»ä¼ è¾“é€Ÿç‡ä¸ºRçš„7Væ®µé“¾è·¯å‘é€é•¿åº¦å¶çš„ä¸€ä¸ªåˆ†ç»„çš„ç«¯åˆ°ç«¯æ—¶å»¶ã€‚å¯¹äºç»è¿‡/Væ®µé“¾<br>è·¯ä¸€ä¸ªæ¥ä¸€ä¸ªåœ°å‘é€Pä¸ªè¿™æ ·çš„åˆ†ç»„ï¼Œä¸€èˆ¬åŒ–åœ°è¡¨ç¤ºå‡ºè¿™ä¸ªå…¬å¼ã€‚</p></li><li><p>è¿™ä¸ªä¹ é¢˜å¼€å§‹æ¢è®¨ä¼ æ’­æ—¶å»¶å’Œä¼ è¾“æ—¶å»¶ï¼Œè¿™æ˜¯æ•°æ®ç½‘ç»œä¸­çš„ä¸¤ä¸ªé‡è¦æ¦‚å¿µã€‚è€ƒè™‘ä¸¤å°ä¸»æœºAå’ŒBç”±<br>ä¸€æ¡é€Ÿç‡ä¸ºAbpsçš„é“¾è·¯ç›¸è¿ã€‚å‡å®šè¿™ä¸¤å°ä¸»æœºç›¸éš”è‚Œç±³ï¼Œæ²¿è¯¥é“¾è·¯çš„ä¼ æ’­é€Ÿç‡ä¸º.sm/soä¸»æœºAå‘<br>ä¸»æœºBå‘é€é•¿åº¦Læ¯”ç‰¹çš„åˆ†ç»„ã€‚<br>a. ç”¨må’Œsæ¥è¡¨ç¤ºä¼ æ’­æ—¶å»¶â€pmpã€‚<br>b. ç”¨å¶å’Œ/?æ¥ç¡®å®šè¯¥åˆ†ç»„çš„ä¼ è¾“æ—¶é—´è¡€äº¦ã€‚<br>c. å¿½ç•¥å¤„ç†å’Œæ’é˜Ÿæ—¶å»¶ï¼Œå¾—å‡ºç«¯åˆ°ç«¯æ—¶å»¶çš„è¡¨è¾¾å¼ã€‚<br>d. å‡å®šä¸»æœºAåœ¨æ—¶åˆ»20å¼€å§‹ä¼ è¾“è¯¥åˆ†ç»„ã€‚åœ¨æ—¶åˆ»/äºŒè¡€å”¤ï¼Œè¯¥åˆ†ç»„çš„æœ€åä¸€ä¸ªæ¯”ç‰¹åœ¨ä»€ä¹ˆåœ°æ–¹ï¼Ÿ<br>e. å‡å®šå¿ƒå¿å¤§äºï¼œn8oåœ¨æ—¶åˆ»2è¡€g è¯¥åˆ†ç»„çš„ç¬¬ä¸€ä¸ªæ¯”ç‰¹åœ¨ä½•å¤„ï¼Ÿ<br>f. å‡å®šå¦‚ä¸­å°äºè¡€æ˜¨ã€‚åœ¨æ—¶åˆ»2ä¹é˜³ï¼Œè¯¥åˆ†ç»„çš„ç¬¬ä¸€ä¸ªæ¯”ç‰¹åœ¨ä½•å¤„ï¼Ÿ<br>g. å‡å®š5=2.5 xlO8, L = 120æ¯”ç‰¹ï¼Œ56kbpsã€‚ï¼Œæ±‚å‡ºä½¿å¿ƒå“ªç­‰äºè¡€è¾¼çš„è·ç¦»å«</p></li><li><p>å‡å®šç”¨æˆ·å…±äº«ä¸€æ¡3Mbpsçš„é“¾è·¯ã€‚åˆè®¾æ¯ä¸ªç”¨æˆ·ä¼ è¾“æ—¶è¦æ±‚150kbpsï¼Œä½†æ˜¯æ¯ä¸ªç”¨æˆ·ä»…æœ‰10%çš„æ—¶é—´<br>ä¼ è¾“ã€‚ï¼ˆå‚è§1.3èŠ‚ä¸­å…³äºâ€œåˆ†ç»„äº¤æ¢ä¸ç”µè·¯äº¤æ¢çš„å¯¹æ¯”â€çš„è®¨è®ºã€‚ï¼‰<br>å½“ä½¿ç”¨ç”µè·¯äº¤æ¢æ—¶ï¼Œèƒ½å¤Ÿæ”¯æŒå¤šå°‘ç”¨æˆ·ï¼Ÿ<br>å¯¹äºæœ¬ä¹ é¢˜çš„åç»­å°é¢˜ï¼Œå‡å®šä½¿ç”¨åˆ†ç»„äº¤æ¢ã€‚æ±‚å‡ºæŸç»™å®šç”¨æˆ·æ­£åœ¨ä¼ è¾“çš„æ¦‚ç‡ã€‚<br>å‡å®šæœ‰120ä¸ªç”¨æˆ·ã€‚æ±‚å‡ºåœ¨ä»»ä½•ç»™å®šæ—¶åˆ»ï¼Œå®é™…æœ‰nä¸ªç”¨æˆ·åœ¨åŒæ—¶ä¼ è¾“çš„æ¦‚ç‡ã€‚ï¼ˆæç¤ºï¼šä½¿ç”¨äºŒé¡¹<br>å¼åˆ†å¸ƒã€‚ï¼‰<br>æ±‚å‡ºæœ‰21ä¸ªæˆ–æ›´å¤šç”¨æˆ·åŒæ—¶ä¼ è¾“çš„æ¦‚ç‡</p></li><li><p>è€ƒè™‘åœ¨1.3èŠ‚â€œåˆ†ç»„äº¤æ¢ä¸ç”µè·¯äº¤æ¢çš„å¯¹æ¯”â€çš„è®¨è®ºä¸­ï¼Œç»™å‡ºäº†ä¸€ä¸ªå…·æœ‰ä¸€æ¡1Mbpsé“¾è·¯çš„ä¾‹å­ã€‚<br>ç”¨æˆ·åœ¨å¿™æ—¶ä»¥100kbpsé€Ÿç‡äº§ç”Ÿæ•°æ®ï¼Œä½†å¿™æ—¶ä»…ä»¥p=0. 1çš„æ¦‚ç‡äº§ç”Ÿæ•°æ®ã€‚å‡å®šç”¨lGbp$é“¾è·¯æ›¿ä»£<br>1Mbpsçš„é“¾è·¯ã€‚<br>a. å½“é‡‡ç”¨ç”µè·¯äº¤æ¢æŠ€æœ¯æ—¶ï¼Œèƒ½è¢«åŒæ—¶æ”¯æŒçš„æœ€å¤§ç”¨æˆ·æ•°é‡/Væ˜¯å¤šå°‘ï¼Ÿ<br>b. ç°åœ¨è€ƒè™‘åˆ†ç»„äº¤æ¢å’Œæœ‰Mä¸ªç”¨æˆ·çš„æƒ…å†µã€‚ç»™å‡ºå¤šäº/Vç”¨æˆ·å‘é€æ•°æ®çš„æ¦‚ç‡å…¬å¼ï¼ˆç”¨pã€Mã€/V<br>è¡¨ä¸ï¼‰O</p></li><li><p>a.å‡å®šæœ‰Nä¸ªåˆ†ç»„åŒæ—¶åˆ°è¾¾ä¸€æ¡å½“å‰æ²¡æœ‰åˆ†ç»„ä¼ è¾“æˆ–æ’é˜Ÿçš„é“¾è·¯ã€‚æ¯ä¸ªåˆ†ç»„é•¿ä¸ºå¶ï¼Œé“¾è·¯ä¼ è¾“é€Ÿç‡<br>ä¸ºRã€‚å¯¹Nä¸ªåˆ†ç»„è€Œè¨€.å…¶å¹³å‡æ’é˜Ÿæ—¶å»¶æ˜¯å¤šå°‘ï¼Ÿ<br>b.ç°åœ¨å‡å®šæ¯éš”LN/Rç§’æœ‰Nä¸ªåˆ†ç»„åŒæ—¶åˆ°è¾¾é“¾è·¯ã€‚ä¸€ä¸ªåˆ†ç»„çš„å¹³å‡æ’é˜Ÿæ—¶å»¶æ˜¯å¤šå°‘ï¼Ÿ</p></li><li><p>å¯¹ä¸¤è¿›ç¨‹ä¹‹é—´çš„é€šä¿¡ä¼šè¯è€Œè¨€ï¼Œå“ªä¸ªè¿›ç¨‹æ˜¯å®¢æˆ·ï¼Œå“ªä¸ªè¿›ç¨‹æ˜¯æœåŠ¡å™¨?</p></li><li><p>è¿è¡Œåœ¨ä¸€å°ä¸»æœºä¸Šçš„ä¸€ä¸ªè¿›ç¨‹ï¼Œä½¿ç”¨ä»€ä¹ˆä¿¡æ¯æ¥æ ‡è¯†è¿è¡Œåœ¨å¦ä¸€å°ä¸»æœºä¸Šçš„è¿›ç¨‹?</p></li><li><p>å‡å®šä½ æƒ³å°½å¿«åœ°å¤„ç†ä»è¿œç¨‹å®¢æˆ·åˆ°æœåŠ¡å™¨çš„äº‹åŠ¡ï¼Œä½ å°†ä½¿ç”¨UDPè¿˜æ˜¯TCP?ä¸ºä»€ä¹ˆï¼Ÿ</p></li><li><p>å‰é¢è®²è¿‡TCPèƒ½ç”¨SSLæ¥å¼ºåŒ–ï¼Œä»¥æä¾›è¿›ç¨‹åˆ°è¿›ç¨‹çš„å®‰å…¨æ€§æœåŠ¡ï¼ŒåŒ…æ‹¬åŠ å¯†ã€‚SSLè¿è¡Œåœ¨è¿è¾“å±‚è¿˜<br>æ˜¯åº”ç”¨å±‚ï¼Ÿå¦‚æœæŸåº”ç”¨ç¨‹åºç ”åˆ¶è€…æƒ³è¦ç”¨SSLæ¥å¼ºåŒ–UDP,è¯¥ç ”åˆ¶è€…åº”å½“åšäº›ä»€ä¹ˆå·¥ä½œï¼Ÿ</p></li><li><p>æ¡æ‰‹åè®®çš„ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ</p></li><li><p>è€ƒè™‘ä¸€ä¸ªç”µå­å•†åŠ¡ç½‘ç«™éœ€è¦ä¿ç•™æ¯ä¸€ä¸ªå®¢æˆ·çš„è´­ä¹°è®°å½•ã€‚æè¿°å¦‚ä½•ä½¿ç”¨cookieæ¥å®Œæˆè¯¥åŠŸèƒ½ï¼Ÿ</p></li><li><p>CDNé€šå¸¸é‡‡ç”¨ä¸¤ç§ä¸åŒçš„æœåŠ¡å™¨æ”¾ç½®æ–¹æ³•ä¹‹ä¸€ã€‚åˆ—ä¸¾å¹¶ç®€å•æè¿°å®ƒä»¬ã€‚ </p></li><li><p>é™¤äº†å¦‚æ—¶å»¶ã€ä¸¢åŒ…å’Œå¸¦å®½æ€§èƒ½ç­‰ç½‘ç»œç›¸å…³çš„è€ƒè™‘å¤–ï¼Œè®¾è®¡ä¸€ç§CDNæœåŠ¡å™¨é€‰æ‹©ç­–ç•¥æ—¶è¿˜æœ‰å…¶ä»–é‡<br>è¦å› ç´ ã€‚å®ƒä»¬æ˜¯ä»€ä¹ˆï¼Ÿ</p></li><li><p>7èŠ‚ä¸­æ‰€æè¿°çš„UDPæœåŠ¡å™¨ä»…éœ€è¦ä¸€ä¸ªå¥—æ¥å­—ï¼Œè€ŒTCPæœåŠ¡å™¨éœ€è¦ä¸¤ä¸ªå¥—æ¥å­—ã€‚ä¸ºä»€ä¹ˆï¼Ÿå¦‚æœ<br>TCPæœåŠ¡å™¨æ”¯æŒå‡ ä¸ªå¹¶è¡Œè¿æ¥ï¼Œæ¯æ¡è¿æ¥æ¥è‡ªä¸åŒçš„å®¢æˆ·ä¸»æœºï¼Œé‚£ä¹ˆTCPæœåŠ¡å™¨å°†éœ€è¦å¤šå°‘ä¸ªå¥—<br>æ¥å­—ï¼Ÿ</p></li><li><p>å¯¹äº2. 7èŠ‚æ‰€æè¿°çš„è¿è¡Œåœ¨TCPä¹‹ä¸Šçš„å®¢æˆ·-æœåŠ¡å™¨åº”ç”¨ç¨‹åºï¼ŒæœåŠ¡å™¨ç¨‹åºä¸ºä»€ä¹ˆå¿…é¡»å…ˆäºå®¢æˆ·ç¨‹åº<br>è¿è¡Œï¼Ÿå¯¹äºè¿è¡Œåœ¨UDPä¹‹ä¸Šçš„å®¢æˆ·-æœåŠ¡å™¨åº”ç”¨ç¨‹åºï¼Œå®¢æˆ·ç¨‹åºä¸ºä»€ä¹ˆå¯ä»¥å…ˆäºæœåŠ¡å™¨ç¨‹åºè¿è¡Œï¼Ÿ</p></li><li><p>è€ƒè™‘ä¸€ä¸ªè¦è·å–ç»™å®šURLçš„Webæ–‡æ¡£çš„HTTPå®¢æˆ·ã€‚è¯¥HTTPæœåŠ¡å™¨çš„IPåœ°å€å¼€å§‹æ—¶å¹¶ä¸çŸ¥é“ã€‚åœ¨<br>è¿™ç§æƒ…å†µä¸‹ï¼Œé™¤äº† HTTPå¤–ï¼Œè¿˜éœ€è¦ä»€ä¹ˆè¿è¾“å±‚å’Œåº”ç”¨å±‚åè®®ï¼Ÿ</p></li><li><p>å‡å®šä½ åœ¨æµè§ˆå™¨ä¸­ç‚¹å‡»ä¸€æ¡è¶…é“¾æ¥è·å¾—Webé¡µé¢ã€‚ç›¸å…³è”çš„URLçš„IPåœ°å€æ²¡æœ‰ç¼“å­˜åœ¨æœ¬åœ°ä¸»æœºä¸Š,<br>å› æ­¤å¿…é¡»ä½¿ç”¨DNS lookupä»¥è·å¾—è¯¥IPåœ°å€ã€‚å¦‚æœä¸»æœºä»DNSå¾—åˆ°IPåœ°å€ä¹‹å‰å·²ç»è®¿é—®äº† nä¸ªDNS<br>æœåŠ¡å™¨ï¼›ç›¸ç»§äº§ç”Ÿçš„RTTä¾æ¬¡ä¸ºRTT|ã€â€¦ã€RTTâ€œ<br>ã€‚ è¿›ä¸€æ­¥å‡å®šä¸é“¾è·¯ç›¸å…³çš„Webé¡µé¢åªåŒ…å«ä¸€ä¸ª<br>å¯¹è±¡ï¼Œå³ç”±å°‘é‡çš„HTMLæ–‡æœ¬ç»„æˆã€‚ä»¤RTTã€‚è¡¨ç¤ºæœ¬åœ°ä¸»æœºå’ŒåŒ…å«å¯¹è±¡çš„æœåŠ¡å™¨ä¹‹é—´çš„RTTå€¼ã€‚å‡å®š<br>è¯¥å¯¹è±¡ä¼ è¾“æ—¶é—´ä¸ºé›¶ï¼Œåˆ™ä»è¯¥å®¢æˆ·ç‚¹å‡»è¯¥è¶…é“¾æ¥åˆ°å®ƒæ¥æ”¶åˆ°è¯¥å¯¹è±¡éœ€è¦å¤šé•¿æ—¶é—´ï¼Ÿ</p></li><li><p>å‚ç…§ä¹ é¢˜P7,å‡å®šåœ¨åŒä¸€æœåŠ¡å™¨ä¸ŠæŸHTMLæ–‡ä»¶å¼•ç”¨äº† 8ä¸ªéå¸¸å°çš„å¯¹è±¡ã€‚å¿½ç•¥å‘é€æ—¶é—´ï¼Œåœ¨ä¸‹åˆ—<br>æƒ…å†µä¸‹éœ€è¦å¤šé•¿æ—¶é—´ï¼š<br>a.æ²¡æœ‰å¹¶è¡ŒTCPè¿æ¥çš„éæŒç»­HTTPã€‚</p><p>b.é…ç½®æœ‰5ä¸ªå¹¶è¡Œè¿æ¥çš„éæŒç»­HTTPã€‚<br>c.æŒç»­ HTTPO</p></li><li><p>åœ¨ä¸€å°ä¸»æœºä¸Šå®‰è£…ç¼–è¯‘TCPClientå’ŒUDPClient Pythonç¨‹åºï¼Œåœ¨å¦ä¸€å°ä¸»æœºä¸Šå®‰è£…ç¼–è¯‘TCPServerå’Œ<br>UDPServer ç¨‹åºã€‚<br>ä¹©å‡è®¾ä½ åœ¨è¿è¡ŒTCPServerä¹‹å‰è¿è¡ŒTCPClient,å°†å‘ç”Ÿä»€ä¹ˆç°è±¡ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ<br>b. å‡è®¾ä½ åœ¨è¿è¡ŒUDPServerä¹‹å‰è¿è¡ŒUDPClient,å°†å‘ç”Ÿä»€ä¹ˆç°è±¡ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ<br>c. å¦‚æœä½ å¯¹å®¢æˆ·ç«¯å’ŒæœåŠ¡å™¨ç«¯ä½¿ç”¨äº†ä¸åŒçš„ç«¯å£ï¼Œå°†å‘ç”Ÿä»€ä¹ˆç°è±¡ï¼Ÿ</p></li><li><p>ä½ èƒ½å¤Ÿé…ç½®æµè§ˆå™¨ä»¥æ‰“å¼€å¯¹æŸWebç«™ç‚¹çš„å¤šä¸ªå¹¶è¡Œè¿æ¥å—ï¼Ÿæœ‰å¤§é‡çš„å¹¶è¡ŒTCPè¿æ¥çš„ä¼˜ç‚¹å’Œç¼ºç‚¹<br>æ˜¯ä»€ä¹ˆ</p></li><li><p>æˆ‘ä»¬å·²ç»çœ‹åˆ°å› ç‰¹ç½‘TCPå¥—æ¥å­—å°†æ•°æ®å¤„ç†ä¸ºå­—èŠ‚æµï¼Œè€ŒUDPå¥—æ¥å­—è¯†åˆ«æŠ¥æ–‡è¾¹ç•Œã€‚é¢<br>ä¸æ˜¾å¼è¯†åˆ«å’Œç»´æŠ¤åº”ç”¨ç¨‹åºå®šä¹‰çš„æŠ¥æ–‡è¾¹ç•Œçš„APIç›¸æ¯”ï¼Œè¯•ç»™å‡ºä¸€ä¸ªä¼˜ç‚¹å’Œä¸€ä¸ªç¼ºç‚¹ã€‚</p></li><li><p><strong>æè¿°åº”ç”¨ç¨‹åºå¼€å‘è€…ä¸ºä»€ä¹ˆå¯èƒ½é€‰æ‹©åœ¨UDPä¸Šè¿è¡Œåº”ç”¨ç¨‹åºè€Œä¸æ˜¯åœ¨TCPä¸Šè¿è¡Œçš„åŸå› </strong></p></li><li><p>åœ¨ä»Šå¤©çš„å› ç‰¹ç½‘ä¸­ï¼Œä¸ºä»€ä¹ˆè¯­éŸ³å’Œå›¾åƒæµé‡å¸¸å¸¸æ˜¯ç»è¿‡TCPè€Œä¸æ˜¯ç»UDPå‘é€Â° ï¼ˆæç¤ºï¼šæˆ‘ä»¬å¯»æ‰¾<br>çš„ç­”æ¡ˆä¸TCPçš„æ‹¥å¡æ§åˆ¶æœºåˆ¶æ²¡æœ‰å…³ç³»ã€‚ï¼‰ </p></li><li><p>å½“æŸåº”ç”¨ç¨‹åºè¿è¡Œåœ¨UDPä¸Šæ—¶ï¼Œè¯¥åº”ç”¨ç¨‹åºå¯èƒ½å¾—åˆ°å¯é æ•°æ®ä¼ è¾“å—ï¼Ÿå¦‚æœèƒ½ï¼Œå¦‚ä½•å®ç°ï¼Ÿ</p></li><li><p>å‡å®šåœ¨ä¸»æœºCç«¯å£ 80ä¸Šè¿è¡Œçš„ä¸€ä¸ªWebæœåŠ¡å™¨ã€‚å‡å®šè¿™ä¸ªWebæœåŠ¡å™¨ä½¿ç”¨æŒç»­è¿æ¥ï¼Œå¹¶ä¸”æ­£åœ¨æ¥<br>æ”¶æ¥è‡ªä¸¤å°ä¸åŒä¸»æœºAå’ŒBçš„è¯·æ±‚ã€‚è¢«å‘é€çš„æ‰€æœ‰è¯·æ±‚éƒ½é€šè¿‡ä½äºä¸»æœºCçš„ç›¸åŒå¥—æ¥å­—å—ï¼Ÿå¦‚æœå®ƒ<br>ä»¬é€šè¿‡ä¸åŒçš„å¥—æ¥å­—ä¼ é€’ï¼Œè¿™ä¸¤ä¸ªå¥—æ¥å­—éƒ½å…·æœ‰ç«¯å£ 80å—ï¼Ÿè®¨è®ºå’Œè§£é‡Šä¹‹ï¼š</p></li><li><p>.åœ¨æˆ‘ä»¬çš„rdtåè®®ä¸­ï¼Œä¸ºä»€ä¹ˆéœ€è¦å¼•å…¥åºå·?</p></li><li><p>.åœ¨æˆ‘ä»¬çš„rdtåè®®ä¸­ï¼Œä¸ºä»€ä¹ˆéœ€è¦å¼•å…¥å®šæ—¶å™¨?</p></li><li><p>å‡è®¾ä¸»æœºAé€šè¿‡ä¸€æ¡TCPè¿æ¥å‘ä¸»æœºBå‘é€ä¸¤ä¸ªç´§æ¥ç€çš„TCPæŠ¥æ–‡æ®µÂ°ç¬¬ä¸€ä¸ªæŠ¥æ–‡æ®µçš„åºå·ä¸º90,<br>ç¬¬äºŒä¸ªæŠ¥æ–‡æ®µåºå·ä¸º110</p><p>ç¬¬ä¸€ä¸ªæŠ¥æ–‡æ®µä¸­æœ‰å¤šå°‘æ•°æ®?<br>b.å‡è®¾ç¬¬ä¸€ä¸ªæŠ¥æ–‡æ®µä¸¢å¤±è€Œç¬¬äºŒä¸ªæŠ¥æ–‡æ®µåˆ°è¾¾ä¸»æœºBã€‚é‚£ä¹ˆåœ¨ä¸»æœºBå‘å¾€ä¸»æœºAçš„ç¡®è®¤æŠ¥æ–‡ä¸­,<br>ç¡®è®¤å·åº”è¯¥æ˜¯å¤šå°‘ï¼Ÿ</p></li><li><p>å‡è®¾ä¸¤æ¡TCPè¿æ¥å­˜åœ¨äºä¸€ä¸ªå¸¦å®½ä¸ºR bpsçš„ç“¶é¢ˆé“¾è·¯ä¸Šã€‚å®ƒä»¬éƒ½è¦å‘é€ä¸€ä¸ªå¾ˆå¤§çš„æ–‡ä»¶ï¼ˆä»¥ç›¸åŒ<br>æ–¹å‘ç»è¿‡ç“¶é¢ˆé“¾è·¯ï¼‰ï¼Œå¹¶ä¸”ä¸¤è€…æ˜¯åŒæ—¶å¼€å§‹å‘é€æ–‡ä»¶ã€‚é‚£ä¹ˆTCPå°†ä¸ºæ¯æ¡è¿æ¥åˆ†é…ä»€ä¹ˆæ ·çš„ä¼ è¾“<br>é€Ÿç‡ï¼Ÿ</p></li><li><p>UDPå’ŒTCPä½¿ç”¨åç æ¥è®¡ç®—å®ƒä»¬çš„æ£€éªŒå’Œã€‚å‡è®¾ä½ æœ‰ä¸‹é¢3ä¸ª8æ¯”ç‰¹å­—èŠ‚ï¼š01010011, 01100110,<br>01110100.è¿™äº›8æ¯”ç‰¹å­—èŠ‚å’Œçš„åç æ˜¯å¤šå°‘ï¼Ÿï¼ˆæ³¨æ„åˆ°å°½ç®¡UDPå’ŒTCPä½¿ç”¨16æ¯”ç‰¹çš„å­—æ¥è®¡ç®—æ£€éªŒ<br>å’Œï¼Œä½†å¯¹äºè¿™ä¸ªé—®é¢˜ï¼Œä½ åº”è¯¥è€ƒè™‘8æ¯”ç‰¹å’Œã€‚ï¼‰å†™å²€æ‰€æœ‰å·¥ä½œè¿‡ç¨‹ã€‚UDPä¸ºä»€ä¹ˆè¦ç”¨è¯¥å’Œçš„åç ï¼Œå³<br>ä¸ºä»€ä¹ˆä¸ç›´æ¥ä½¿ç”¨è¯¥å’Œå‘¢ï¼Ÿä½¿ç”¨è¯¥åç æ–¹æ¡ˆï¼Œæ¥æ”¶æ–¹å¦‚ä½•æ£€æµ‹å‡ºå·®é”™ï¼Ÿ 1æ¯”ç‰¹çš„å·®é”™å°†å¯èƒ½æ£€æµ‹ä¸å‡º<br>æ¥å—ï¼Ÿ 2æ¯”ç‰¹çš„å·®é”™å‘¢ï¼Ÿ</p></li><li><p>å‡å®šæŸUDPæ¥æ”¶æ–¹å¯¹æ¥æ”¶åˆ°çš„UDPæŠ¥æ–‡æ®µè®¡ç®—å› ç‰¹ç½‘æ£€éªŒå’Œï¼Œå¹¶å‘ç°å®ƒä¸æ‰¿è½½åœ¨æ£€éªŒå’Œå­—æ®µä¸­çš„å€¼<br>ç›¸åŒ¹é…ã€‚è¯¥æ¥æ”¶æ–¹èƒ½å¤Ÿç»å¯¹ç¡®ä¿¡æ²¡æœ‰å‡ºç°è¿‡æ¯”ç‰¹å·®é”™å—ï¼Ÿè¯•è§£é‡Šä¹‹ã€‚</p></li><li><p>æˆ‘ä»¬æ›¾ç»è¯´è¿‡ï¼Œåº”ç”¨ç¨‹åºå¯èƒ½é€‰æ‹©UDPä½œä¸ºè¿è¾“åè®®ï¼Œå› ä¸ºUDPæä¾›äº†ï¼ˆæ¯”TCPï¼‰æ›´å¥½çš„åº”ç”¨å±‚<br>æ§åˆ¶ï¼Œä»¥å†³å®šåœ¨æŠ¥æ–‡æ®µä¸­å‘é€ä»€ä¹ˆæ•°æ®å’Œå‘é€æ—¶æœºã€‚<br>a.åº”ç”¨ç¨‹åºä¸ºä»€ä¹ˆå¯¹åœ¨æŠ¥æ–‡æ®µä¸­å‘é€ä»€ä¹ˆæ•°æ®æœ‰æ›´å¤šçš„æ§åˆ¶ï¼Ÿ<br>b-åº”ç”¨ç¨‹åºä¸ºä»€ä¹ˆå¯¹ä½•æ—¶å‘é€æŠ¥æ–‡æ®µæœ‰æ›´å¤šçš„æ§åˆ¶ï¼Ÿ </p></li><li><p>è€ƒè™‘ä»ä¸»æœºAå‘ä¸»æœºBä¼ è¾“Lå­—èŠ‚çš„å¤§æ–‡ä»¶ï¼Œå‡è®¾MSSä¸º536å­—èŠ‚ã€‚<br>a. ä¸ºäº†ä½¿å¾—TCPåºå·ä¸è‡³äºç”¨å®Œï¼Œå¶çš„æœ€å¤§å€¼æ˜¯å¤šå°‘ï¼Ÿå‰é¢è®²è¿‡TCPçš„åºå·å­—æ®µä¸º4å­—èŠ‚ã€‚<br>b. å¯¹äºä½ åœ¨ï¼ˆaï¼‰ä¸­å¾—åˆ°çš„å¶ï¼Œæ±‚å‡ºä¼ è¾“æ­¤æ–‡ä»¶è¦ç”¨å¤šé•¿æ—¶é—´ï¼Ÿå‡å®šè¿è¾“å±‚ã€ç½‘ç»œå±‚å’Œæ•°æ®é“¾è·¯å±‚<br>é¦–éƒ¨æ€»å…±ä¸º66å­—èŠ‚ï¼Œå¹¶åŠ åœ¨æ¯ä¸ªæŠ¥æ–‡æ®µä¸Šï¼Œç„¶åç»155Mbpsé“¾è·¯å‘é€å¾—åˆ°çš„åˆ†ç»„ã€‚å¿½ç•¥æµé‡æ§<br>åˆ¶å’Œæ‹¥å¡æ§åˆ¶ï¼Œä½¿ä¸»æœºAèƒ½å¤Ÿä¸€ä¸ªæ¥ä¸€ä¸ªå’Œè¿ç»­ä¸æ–­åœ°å‘é€è¿™äº›æŠ¥æ–‡æ®µã€‚</p></li><li><p>ä¸»æœºAå’ŒBç›´æ¥ç»ä¸€æ¡100Mbpsé“¾è·¯è¿æ¥ã€‚åœ¨è¿™ä¸¤å°ä¸»æœºä¹‹é—´æœ‰ä¸€æ¡TCPè¿æ¥ã€‚ä¸»æœºAç»è¿™æ¡è¿<br>æ¥å‘ä¸»æœºBå‘é€ä¸€ä¸ªå¤§æ–‡ä»¶ã€‚ä¸»æœºAèƒ½å¤Ÿå‘å®ƒçš„TCPå¥—æ¥å­—ä»¥é«˜è¾¾120Mbpsçš„é€Ÿç‡å‘é€åº”ç”¨æ•°æ®,<br>è€Œä¸»æœºBèƒ½å¤Ÿä»¥æœ€å¤§50Mbpsçš„é€Ÿç‡ä»å®ƒçš„TCPæ¥æ”¶ç¼“å­˜ä¸­è¯»å²€æ•°æ®ã€‚æè¿°TCPæµé‡æ§åˆ¶çš„å½±å“ã€‚</p></li><li><p>åœ¨3. 5. 4èŠ‚ä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ°TCPç›´åˆ°æ”¶åˆ°3ä¸ªå†—ä½™ACKæ‰æ‰§è¡Œå¿«é€Ÿé‡ä¼ ã€‚ä½ å¯¹TCPè®¾è®¡è€…æ²¡æœ‰é€‰æ‹©<br>åœ¨æ”¶åˆ°å¯¹æŠ¥æ–‡æ®µçš„ç¬¬ä¸€ä¸ªå†—ä½™ACKåå°±å¿«é€Ÿé‡ä¼ æœ‰ä½•çœ‹æ³•ï¼Ÿ</p></li><li><p>è€ƒè™‘å›¾3ãƒ»58ã€‚å‡è®¾TCP Renoæ˜¯ä¸€ä¸ªç»å†å¦‚ä¸Š<br>æ‰€ç¤ºè¡Œä¸ºçš„åè®®ï¼Œå›ç­”ä¸‹åˆ—é—®é¢˜ã€‚åœ¨å„ç§æƒ…<br>å†µä¸­ï¼Œç®€è¦åœ°è®ºè¯ä½ çš„å›ç­”ã€‚<br>æŒ‡å‡ºTCPæ…¢å¯åŠ¨è¿è¡Œæ—¶çš„æ—¶é—´é—´éš”ã€‚<br>æŒ‡å‡ºTCPæ‹¥å¡é¿å…è¿è¡Œæ—¶çš„æ—¶é—´é—´éš”ã€‚<br>åœ¨ç¬¬16ä¸ªä¼ è¾“è½®å›ä¹‹åï¼ŒæŠ¥æ–‡æ®µçš„ä¸¢å¤±æ˜¯<br>æ ¹æ®3ä¸ªå†—ä½™ACKè¿˜æ˜¯æ ¹æ®è¶…æ—¶æ£€æµ‹å²€<br>æ¥çš„ï¼Ÿ ~<br>åœ¨ç¬¬22ä¸ªä¼ è¾“è½®å›ä¹‹åï¼ŒæŠ¥æ–‡æ®µçš„ä¸¢å¤±æ˜¯<br>æ ¹æ®3ä¸ªå†—ä½™ACKè¿˜æ˜¯æ ¹æ®è¶…æ—¶æ£€æµ‹å‡º<br>æ¥çš„ï¼Ÿ<br>åœ¨ç¬¬1ä¸ªä¼ è¾“è½®å›é‡Œï¼Œssthreshçš„åˆå§‹å€¼è®¾ç½®ä¸ºå¤šå°‘ï¼Ÿ<br>åœ¨ç¬¬18ä¸ªä¼ è¾“è½®å›é‡Œï¼Œssthreshçš„å€¼è®¾ç½®ä¸ºå¤šå°‘ï¼Ÿ<br>åœ¨ç¬¬24ä¸ªä¼ è¾“è½®å›é‡Œï¼Œssthreshçš„å€¼è®¾ç½®ä¸ºå¤šå°‘ï¼Ÿ<br>h. åœ¨å“ªä¸ªä¼ è¾“è½®å›å†…å‘é€ç¬¬70ä¸ªæŠ¥æ–‡æ®µï¼Ÿ<br>i. å‡å®šåœ¨ç¬¬26ä¸ªä¼ è¾“è½®å›åï¼Œé€šè¿‡æ”¶åˆ°3ä¸ªå†—ä½™ACKæ£€æµ‹å‡ºæœ‰åˆ†ç»„ä¸¢å¤±ï¼Œæ‹¥å¡çš„çª—å£é•¿åº¦å’Œ<br>ssthreshçš„å€¼åº”å½“æ˜¯å¤šå°‘ï¼Ÿ<br>j. å‡å®šä½¿ç”¨TCP Tahoe ï¼ˆè€Œä¸æ˜¯TCP Renoï¼‰,å¹¶å‡å®šåœ¨ç¬¬16ä¸ªä¼ è¾“è½®å›æ”¶åˆ°3ä¸ªå†—ä½™ACKã€‚åœ¨ç¬¬19<br>ä¸ªä¼ è¾“è½®å›ï¼Œssthreshå’Œæ‹¥å¡çª—å£é•¿åº¦æ˜¯ä»€ä¹ˆï¼Ÿ</p><p>k.å†æ¬¡å‡è®¾ä½¿ç”¨TCP Tahoe,åœ¨ç¬¬22ä¸ªä¼ è¾“è½®å›æœ‰ä¸€ä¸ªè¶…æ—¶äº‹ä»¶ã€‚ä»ç¬¬17ä¸ªä¼ è¾“è½®å›åˆ°ç¬¬22ä¸ªä¼ <br>è¾“è½®å›ï¼ˆåŒ…æ‹¬è¿™ä¸¤ä¸ªä¼ è¾“è½®å›ï¼‰ï¼Œä¸€å…±å‘é€äº†å¤šå°‘åˆ†ç»„ï¼Ÿ</p></li></ul><ul><li>è€ƒè™‘ä»…æœ‰ä¸€æ¡å•ä¸€çš„TCP ï¼ˆRenoï¼‰è¿æ¥ä½¿ç”¨ä¸€æ¡10Mbpsé“¾è·¯ï¼Œä¸”è¯¥é“¾è·¯æ²¡æœ‰ç¼“å­˜ä»»ä½•æ•°æ®ã€‚å‡è®¾<br>è¿™æ¡é“¾è·¯æ˜¯å‘é€ä¸»æœºå’Œæ¥æ”¶ä¸»æœºä¹‹é—´çš„å”¯ä¸€æ‹¥å¡é“¾è·¯ã€‚å‡å®šæŸTCPå‘é€æ–¹å‘æ¥æ”¶æ–¹æœ‰ä¸€ä¸ªå¤§æ–‡ä»¶è¦<br>å‘é€ï¼Œè€Œæ¥æ”¶æ–¹çš„æ¥æ”¶ç¼“å­˜æ¯”æ‹¥å¡çª—å£è¦å¤§å¾—å¤šã€‚æˆ‘ä»¬ä¹Ÿåšä¸‹åˆ—å‡è®¾ï¼šæ¯ä¸ªTCPæŠ¥æ–‡æ®µé•¿åº¦ä¸º1500<br>å­—èŠ‚ï¼›è¯¥è¿æ¥çš„åŒå‘ä¼ æ’­æ—¶å»¶æ˜¯150msï¼›å¹¶ä¸”è¯¥TCPè¿æ¥æ€»æ˜¯å¤„äºæ‹¥å¡é¿å…é˜¶æ®µï¼Œå³å¿½ç•¥äº†æ…¢<br>å¯åŠ¨ã€‚<br>&amp;è¿™æ¡TCPè¿æ¥èƒ½å¤Ÿå–å¾—çš„æœ€å¤§çª—å£é•¿åº¦ï¼ˆä»¥æŠ¥æ–‡æ®µè®¡ï¼‰æ˜¯å¤šå°‘ï¼Ÿ<br>b. è¿™æ¡TCPè¿æ¥çš„å¹³å‡çª—å£é•¿åº¦ï¼ˆä»¥æŠ¥æ–‡æ®µè®¡ï¼‰å’Œå¹³å‡ååé‡ï¼ˆä»¥bpsè®¡ï¼‰æ˜¯å¤šå°‘ï¼Ÿ<br>c. è¿™æ¡TCPè¿æ¥åœ¨ä»ä¸¢åŒ…æ¢å¤åï¼Œå†æ¬¡åˆ°è¾¾å…¶æœ€å¤§çª—å£è¦ç»å†å¤šé•¿æ—¶é—´ï¼Ÿ</li><li>æˆ‘ä»¬æ³¨æ„åˆ°ç½‘ç»œå±‚åŠŸèƒ½å¯è¢«å¤§ä½“åˆ†æˆæ•°æ®å¹³é¢åŠŸèƒ½å’Œæ§åˆ¶å¹³é¢åŠŸèƒ½ã€‚æ•°æ®å¹³é¢çš„ä¸»è¦åŠŸèƒ½æ˜¯ä»€ä¹ˆ?<br>æ§åˆ¶å¹³é¢çš„ä¸»è¦åŠŸèƒ½å‘¢?</li><li>æˆ‘ä»¬å¯¹ç½‘ç»œå±‚æ‰§è¡Œçš„è½¬å‘åŠŸèƒ½å’Œè·¯ç”±é€‰æ‹©åŠŸèƒ½è¿›è¡ŒåŒºåˆ«è·¯ç”±é€‰æ‹©å’Œè½¬å‘çš„ä¸»è¦åŒºåˆ«æ˜¯ä»€ä¹ˆ</li><li>è·¯ç”±å™¨ä¸­è½¬å‘è¡¨çš„ä¸»è¦ä½œç”¨æ˜¯ä»€ä¹ˆ?</li><li>åœ¨4.2èŠ‚ä¸­ï¼Œæˆ‘ä»¬çœ‹åˆ°è·¯ç”±å™¨é€šå¸¸ç”±è¾“å…¥ç«¯å£ã€è¾“å‡ºç«¯å£ã€äº¤æ¢ç»“æ„å’Œè·¯ç”±é€‰æ‹©å¤„ç†å™¨ç»„æˆã€‚å…¶ä¸­<br>å“ªäº›æ˜¯ç”¨ç¡¬ä»¶å®ç°çš„ï¼Œå“ªäº›æ˜¯ç”¨è½¯ä»¶å®ç°çš„ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿè½¬åˆ°ç½‘ç»œå±‚çš„æ•°æ®å¹³é¢å’Œæ§åˆ¶å¹³é¢çš„æ¦‚å¿µ,<br>å“ªäº›æ˜¯ç”¨ç¡¬ä»¶å®ç°çš„ï¼Œå“ªäº›æ˜¯ç”¨è½¯ä»¶å®ç°çš„ï¼Ÿä¸ºä»€ä¹ˆ?</li><li>å‡è®¾ä¸€ä¸ªåˆ°è¾¾åˆ†ç»„åŒ¹é…äº†è·¯ç”±å™¨è½¬å‘è¡¨ä¸­çš„ä¸¤ä¸ªæˆ–æ›´å¤šè¡¨é¡¹ã€‚é‡‡ç”¨ä¼ ç»Ÿçš„åŸºäºç›®çš„åœ°è½¬å‘ï¼Œè·¯ç”±å™¨<br>ç”¨ä»€ä¹ˆåŸåˆ™æ¥ç¡®å®šè¿™æ¡è§„åˆ™å¯ä»¥ç”¨äºç¡®å®šè¾“å‡ºç«¯å£ï¼Œä½¿å¾—åˆ°è¾¾çš„åˆ†ç»„èƒ½äº¤æ¢åˆ°è¾“å‡ºç«¯å£ï¼Ÿ</li><li>æè¿°åœ¨è¾“å…¥ç«¯å£ä¼šå‡ºç°åˆ†ç»„ä¸¢å¤±çš„åŸå› ã€‚æè¿°åœ¨è¾“å…¥ç«¯å£å¦‚ä½•æ¶ˆé™¤åˆ†ç»„ä¸¢å¤±ï¼ˆä¸ä½¿ç”¨æ— é™å¤§ç¼“å­˜åŒºï¼‰</li><li>æè¿°åœ¨è¾“å‡ºç«¯å£ä¼šå‡ºç°åˆ†ç»„ä¸¢å¤±çš„åŸå› ã€‚é€šè¿‡æé«˜äº¤æ¢ç»“æ„é€Ÿç‡ï¼Œèƒ½å¤Ÿé˜²æ­¢è¿™ç§ä¸¢å¤±å—?</li><li>å‡å®šä¸»æœºAå‘ä¸»æœºBå‘é€å°è£…åœ¨ä¸€ä¸ªIPæ•°æ®æŠ¥ä¸­çš„TCPæŠ¥æ–‡æ®µã€‚å½“ä¸»æœºBæ¥æ”¶åˆ°è¯¥æ•°æ®æŠ¥æ—¶ï¼Œä¸»<br>æœºBä¸­çš„ç½‘ç»œå±‚æ€æ ·çŸ¥é“å®ƒåº”å½“å°†è¯¥æŠ¥æ–‡æ®µï¼ˆå³æ•°æ®æŠ¥çš„æœ‰æ•ˆè½½è·ï¼‰äº¤ç»™TCPè€Œä¸æ˜¯UDPæˆ–æŸä¸ª<br>å…¶ä»–ä¸œè¥¿å‘¢ï¼Ÿ</li><li>ä»€ä¹ˆæ—¶å€™ä¸€ä¸ªå¤§æ•°æ®æŠ¥åˆ†å‰²æˆå¤šä¸ªè¾ƒå°çš„æ•°æ®æŠ¥ï¼Ÿè¾ƒå°çš„æ•°æ®æŠ¥åœ¨ä»€ä¹ˆåœ°æ–¹è£…é…æˆä¸€ä¸ªè¾ƒå¤§çš„æ•°æ®æŠ¥ï¼Ÿ</li><li>å‡è®¾åœ¨ä¸€ä¸ªæºä¸»æœºå’Œä¸€ä¸ªç›®çš„ä¸»æœºä¹‹é—´æœ‰3å°è·¯ç”±å™¨ã€‚ä¸è€ƒè™‘åˆ†ç‰‡ï¼Œä¸€ä¸ªä»æºä¸»æœºå‘é€ç»™ç›®çš„ä¸»æœº<br>çš„IPæ•°æ®æŠ¥å°†é€šè¿‡å¤šå°‘ä¸ªæ¥å£ï¼Ÿä¸ºäº†å°†æ•°æ®æŠ¥ä»æºç§»åŠ¨åˆ°ç›®çš„åœ°éœ€è¦æ£€ç´¢å¤šå°‘ä¸ªè½¬å‘è¡¨ï¼Ÿ4</li><li>å‡è®¾æŸåº”ç”¨æ¯20msç”Ÿæˆä¸€ä¸ª40å­—èŠ‚çš„æ•°æ®å—ï¼Œæ¯å—å°è£…åœ¨ä¸€ä¸ªTCPæŠ¥æ–‡æ®µä¸­ï¼ŒTCPæŠ¥æ–‡æ®µå†å°è£…<br>åœ¨ä¸€ä¸ªIPæ•°æ®æŠ¥ä¸­ã€‚æ¯ä¸ªæ•°æ®æŠ¥çš„å¼€é”€æœ‰å¤šå¤§ï¼Ÿåº”ç”¨æ•°æ®æ‰€å ç™¾åˆ†æ¯”æ˜¯å¤šå°‘ï¼Ÿ</li><li>å‡å®šä½ è´­ä¹°äº†ä¸€ä¸ªæ— çº¿è·¯ç”±å™¨å¹¶å°†å…¶ä¸ç”µç¼†è°ƒåˆ¶è§£è°ƒå™¨ç›¸è¿ã€‚åŒæ—¶å‡å®šISPåŠ¨æ€åœ°ä¸ºä½ è¿æ¥çš„è®¾å¤‡<br>ï¼ˆå³ä½ çš„æ— çº¿è·¯ç”±å™¨ï¼‰åˆ†é…ä¸€ä¸ªIPåœ°å€ã€‚è¿˜å‡å®šä½ å®¶æœ‰5å°PC,å‡ä½¿ç”¨802. 11ä»¥æ— çº¿æ–¹å¼ä¸è¯¥æ— <br>çº¿è·¯ç”±å™¨ç›¸è¿ã€‚æ€æ ·ä¸ºè¿™5å°PCåˆ†é…IPåœ°å€ï¼Ÿè¯¥æ— çº¿è·¯ç”±å™¨ä½¿ç”¨NATå—ï¼Ÿä¸ºä»€ä¹ˆ?</li><li>â€œè·¯ç”±èšåˆâ€ ä¸€è¯æ„å‘³ç€ä»€ä¹ˆï¼Ÿè·¯ç”±å™¨æ‰§è¡Œè·¯ç”±èšåˆä¸ºä»€ä¹ˆæ˜¯æœ‰ç”¨çš„</li><li>ä»€ä¹ˆæ˜¯ä¸“ç”¨ç½‘ç»œåœ°å€ï¼Ÿå…·æœ‰ä¸“ç”¨ç½‘ç»œåœ°å€çš„æ•°æ®æŠ¥ä¼šå‡ºç°åœ¨å¤§å‹å…¬å…±å› ç‰¹ç½‘ä¸­å—ï¼Ÿè§£é‡Šç†ç”±ã€‚</li><li>é€šç”¨è½¬å‘ä¸åŸºäºç›®çš„åœ°è½¬å‘æœ‰ä½•ä¸åŒï¼Ÿ</li><li>è·¯ç”±å™¨æˆ–äº¤æ¢æœºçš„â€œåŒ¹é…åŠ åŠ¨ä½œâ€æ„å‘³ç€ä»€ä¹ˆï¼Ÿåœ¨åŸºäºç›®çš„åœ°è½¬å‘çš„åˆ†ç»„äº¤æ¢æœºåœºåˆä¸­ï¼Œè¦åŒ¹é…ä»€<br>ä¹ˆå¹¶é‡‡å–ä»€ä¹ˆåŠ¨ä½œï¼Ÿåœ¨SDNçš„åœºåˆä¸­ï¼Œä¸¾å‡º3ä¸ªèƒ½å¤Ÿè¢«åŒ¹é…çš„å­—æ®µå’Œ3ä¸ªèƒ½è¢«é‡‡å–çš„åŠ¨ä½œã€‚</li><li>å‡è®¾ä¸¤ä¸ªåˆ†ç»„åœ¨å®Œå…¨ç›¸åŒçš„æ—¶åˆ»åˆ°è¾¾ä¸€å°è·¯ç”±å™¨çš„ä¸¤ä¸ªä¸åŒè¾“å…¥ç«¯å£ã€‚åŒæ—¶å‡è®¾åœ¨è¯¥è·¯ç”±å™¨ä¸­æ²¡æœ‰<br>å…¶ä»–åˆ†ç»„ã€‚<br>å‡è®¾è¿™ä¸¤ä¸ªåˆ†ç»„æœç€ä¸¤ä¸ªä¸åŒçš„è¾“å‡ºç«¯å£è½¬å‘ã€‚å½“äº¤æ¢ç»“æ„ä½¿ç”¨ä¸€æ¡å…±äº«æ€»çº¿æ—¶ï¼Œè¿™ä¸¤ä¸ªåˆ†ç»„å¯<br>èƒ½åœ¨ç›¸åŒæ—¶åˆ»é€šè¿‡è¯¥äº¤æ¢ç»“æ„è½¬å‘å—ï¼Ÿ â€˜<br>å‡è®¾è¿™ä¸¤ä¸ªåˆ†ç»„æœç€ä¸¤ä¸ªä¸åŒçš„è¾“å²€ç«¯å£è½¬å‘ã€‚å½“äº¤æ¢ç»“æ„ä½¿ç”¨ç»å†…å­˜äº¤æ¢æ—¶ï¼Œè¿™ä¸¤ä¸ªåˆ†ç»„å¯èƒ½<br>åœ¨ç›¸åŒæ—¶åˆ»é€šè¿‡è¯¥äº¤æ¢ç»“æ„è½¬å‘å—ï¼Ÿ â€œ . å‡è®¾è¿™ä¸¤ä¸ªåˆ†ç»„æœç€ç›¸åŒçš„è¾“å‡ºç«¯å£è½¬å‘ã€‚å½“äº¤æ¢ç»“æ„ä½¿ç”¨çºµæ¨ªå¼æ—¶ï¼Œè¿™ä¸¤ä¸ªåˆ†ç»„å¯èƒ½åœ¨ç›¸åŒæ—¶<br>åˆ»é€šè¿‡è¯¥äº¤æ¢ç»“æ„è½¬å‘å—ï¼Ÿ</li><li>è€ƒè™‘ä½¿ç”¨32æ¯”ç‰¹ä¸»æœºåœ°å€çš„æŸæ•°æ®æŠ¥ç½‘ç»œÂ°å‡å®šä¸€å°è·¯ç”±å™¨å…·æœ‰4æ¡é“¾è·¯.ç¼–å·ä¸º0~3,åˆ†ç»„èƒ½è¢«<br>è½¬å‘åˆ°å¦‚ä¸‹çš„å„é“¾è·¯æ¥å£ï¼š<br>ç›®çš„åœ°å€èŒƒå›´<br>11100000 00000000 00000000 00000000<br>åˆ°<br>11100000 00111111 11111111 11111111<br>é“¾è·¯æ¥å£<br>0<br>11100000 01000000 00000000 00000000<br>åˆ° 1<br>11100000 01000000 11111111 11111111<br>111(X)000 01000(X)1 0(X)00000 00000000<br>åˆ° 2<br>11100001 01111111 11111111 11111111<br>å…¶ä»– 3<br>ç½‘ç»œå±‚:æ•°æ®å¹³ 239<br>a. æä¾›ä¸€ä¸ªå…·æœ‰5ä¸ªè¡¨é¡¹çš„è½¬å‘è¡¨ï¼Œä½¿ç”¨æœ€é•¿å‰ç¼€åŒ¹é…ï¼Œè½¬å‘åˆ†ç»„åˆ°æ­£ç¡®çš„é“¾è·¯æ¥å£ã€‚<br>b. æè¿°ä½ çš„è½¬å‘è¡¨æ˜¯å¦‚ä½•ä¸ºå…·æœ‰ä¸‹åˆ—ç›®çš„åœ°å€çš„æ•°æ®æŠ¥å†³å®šé€‚å½“çš„é“¾è·¯æ¥å£çš„ã€‚<br>11001000 10010001 01010001 01010101<br>11100001 01000000 11000011 00111100<br>11100001 10000000 00010001 01110111</li><li>è€ƒè™‘äº’è”3ä¸ªå­ç½‘ï¼ˆå­ç½‘1ã€å­ç½‘2å’Œå­ç½‘3ï¼‰çš„ä¸€å°è·¯ç”±å™¨ã€‚å‡å®šè¿™3ä¸ªå­ç½‘çš„æ‰€æœ‰æ¥å£è¦æ±‚å…·æœ‰<br>å‰ç¼€223.1.17/24ã€‚è¿˜å‡å®šå­ç½‘1è¦æ±‚æ”¯æŒå¤šè¾¾60ä¸ªæ¥å£ï¼Œå­ç½‘2è¦æ±‚æ”¯æŒå¤šè¾¾90ä¸ªæ¥å£ï¼Œå­ç½‘3<br>è¦æ±‚æ”¯æŒå¤šè¾¾12ä¸ªæ¥å£ã€‚æä¾›3ä¸ªæ»¡è¶³è¿™äº›é™åˆ¶çš„ç½‘ç»œåœ°å€ï¼ˆå½¢å¼ä¸ºa. b.c.d/xï¼‰o</li><li>è€ƒè™‘ä¸€ä¸ªå…·æœ‰å‰ç¼€12&amp; 119. 40. 128/26çš„å­ç½‘ã€‚ç»™å‡ºèƒ½è¢«åˆ†é…ç»™è¯¥ç½‘ç»œçš„ä¸€ä¸ªIPåœ°å€ï¼ˆå½¢å¼ä¸º<br>xxx. XXX. xxx. xxxï¼‰çš„ä¾‹å­oå‡å®šä¸€ä¸ªISPæ‹¥æœ‰å½¢å¼ä¸º12&amp; 119. 40. 64/26çš„åœ°å€å—ã€‚å‡å®šå®ƒè¦ä»è¯¥åœ°<br>å€å—ç”Ÿæˆ4ä¸ªå­ç½‘ï¼Œæ¯å—å…·æœ‰ç›¸åŒæ•°é‡çš„IPåœ°å€ã€‚è¿™4ä¸ªå­ç½‘ï¼ˆå½¢å¼ä¸ºa. b. c. d/xï¼‰çš„å‰ç¼€æ˜¯ä»€ä¹ˆ?</li><li>è€ƒè™‘å‘å…·æœ‰700å­—èŠ‚MTUçš„ä¸€æ¡é“¾è·¯å‘é€ä¸€ä¸ª2400å­—èŠ‚çš„æ•°æ®æŠ¥ã€‚å‡å®šåˆå§‹æ•°æ®æŠ¥æ ‡æœ‰æ ‡è¯†å·<br>422ã€‚å°†ä¼šç”Ÿæˆå¤šå°‘ä¸ªåˆ†ç‰‡ï¼Ÿåœ¨ç”Ÿæˆç›¸å…³åˆ†ç‰‡çš„æ•°æ®æŠ¥ä¸­å„ä¸ªå­—æ®µçš„å€¼æ˜¯å¤šå°‘?</li><li><p>è€ƒè™‘åœ¨å›¾4-25ä¸­å»ºç«‹çš„ç½‘ç»œã€‚å‡å®šISPç°åœ¨ä¸ºè·¯ç”±å™¨åˆ†é…åœ°å€24.34.112.235,å®¶åº­ç½‘ç»œçš„ç½‘ç»œåœ°<br>å€æ˜¯ 192. 16&amp; 1/24ã€‚<br>a.åœ¨å®¶åº­ç½‘ç»œä¸­ä¸ºæ‰€æœ‰æ¥å£åˆ†é…åœ°å€ã€‚<br>P17.<br>b.å‡å®šæ¯å°ä¸»æœºå…·æœ‰ä¸¤ä¸ªè¿›è¡Œä¸­çš„TCPè¿æ¥ï¼Œæ‰€æœ‰éƒ½æ˜¯é’ˆå¯¹ä¸»æœº128.119. 40. 86çš„80ç«¯å£çš„ã€‚åœ¨<br>NATè½¬æ¢è¡¨ä¸­æä¾›6ä¸ªå¯¹åº”è¡¨é¡¹ã€‚</p></li><li><p>æ¯”è¾ƒå’Œå¯¹ç…§é“¾è·¯çŠ¶æ€å’Œè·ç¦»çŸ¢é‡è¿™ä¸¤ç§è·¯ç”±é€‰æ‹©ç®—æ³•</p></li><li>ä¸ºä»€ä¹ˆåœ¨å› ç‰¹ç½‘ä¸­ç”¨åˆ°äº†ä¸åŒçš„ASé—´ä¸ASå†…éƒ¨åè®®ï¼Ÿ</li><li>åœ¨OSPFè‡ªæ²»ç³»ç»Ÿä¸­åŒºåŸŸè¡¨ç¤ºä»€ä¹ˆï¼Ÿä¸ºä»€ä¹ˆå¼•å…¥åŒºåŸŸçš„æ¦‚å¿µ?</li><li>å‡å®šä½ è¦åœ¨SDNæ§åˆ¶å¹³é¢ä¸­å®ç°ä¸€ä¸ªæ–°å‹è·¯ç”±é€‰æ‹©åè®®ã€‚ä½ å°†åœ¨å“ªä¸ªå±‚æ¬¡ä¸­å®ç°è¯¥åè®®ï¼Ÿè§£é‡Š<br>ç†ç”±ã€‚</li><li>.ä»€ä¹ˆç±»å‹çš„æŠ¥æ–‡æµè·¨è¶ŠSDNæ§åˆ¶å™¨çš„åŒ—å‘å’Œå—å‘API?è°æ˜¯ä»æ§åˆ¶å™¨è·¨è¶Šå—å‘æ¥å£å‘é€çš„è¿™äº›æŠ¥æ–‡<br>çš„æ¥æ”¶è€…ï¼Ÿè°æ˜¯è·¨è¶ŠåŒ—å‘æ¥å£ä»æ§åˆ¶å™¨å‘é€çš„è¿™äº›æŠ¥æ–‡çš„æ¥æ”¶è€…ï¼Ÿ</li><li>æè¿°ä¸¤ç§ä»å—æ§è®¾å¤‡åˆ°æ§åˆ¶å™¨å‘é€çš„0penFlowæŠ¥æ–‡ï¼ˆç”±ä½ æ‰€é€‰ï¼‰ç±»å‹çš„ç›®çš„ã€‚æè¿°ä¸¤ç§ä»æ§åˆ¶å™¨<br>åˆ°å—æ§è®¾å¤‡å‘é€çš„OpenFlowæŠ¥æ–‡ï¼ˆç”±ä½ æ‰€é€‰ï¼‰ç±»å‹çš„ç›®çš„ã€‚</li><li>åœ¨å‘é€ä¸»æœºæ‰§è¡ŒTracerouteç¨‹åºï¼Œæ”¶åˆ°å“ªä¸¤ç§ç±»å‹çš„ICMPæŠ¥æ–‡?</li><li><strong>ç¬¬äº”ç« ä¹ é¢˜7</strong> è€ƒè™‘ä¸‹å›¾æ‰€ç¤ºçš„ç½‘ç»œæ®µã€‚å…€åªæœ‰ä¸¤ä¸ªç›¸è¿é‚»å±…â‘·ä¸yã€‚â‘·æœ‰ä¸€æ¡é€šå‘ç›®çš„åœ°ä»ï¼ˆæ²¡æœ‰æ˜¾ç¤ºï¼‰çš„æœ€ä½å¼€<br>é”€è·¯å¾„ï¼Œå…¶å€¼ä¸º5, yæœ‰ä¸€æ¡é€šå‘ç›®çš„åœ°â€çš„æœ€ä½å¼€é”€è·¯å¾„ï¼Œå…¶å€¼ä¸º6ã€‚ä»å¦‚ä¸yåˆ°u ï¼ˆä»¥åŠâ‘·ä¸yä¹‹<br>é—´ï¼‰çš„å®Œæ•´è·¯å¾„æœªæ˜¾ç¤ºå‡ºæ¥ã€‚ç½‘ç»œä¸­æ‰€æœ‰é“¾è·¯å¼€é”€çš†ä¸ºæ­£æ•´æ•°å€¼ã€‚<br>5<br>/<br>a-ç»™å‡ºxå¯¹ç›®çš„åœ°â‘·ã€yå’Œuçš„è·ç¦»å‘é‡ã€‚<br>280 ç¬¬5è¢<br>b. ç»™å‡ºå¯¹äºc&amp;, w)æˆ–c(%, y)çš„é“¾è·¯å¼€é”€çš„å˜åŒ–ï¼Œä½¿å¾—æ‰§è¡Œäº†è·ç¦»å‘é‡ç®—æ³•åï¼Œï¼…å°†é€šçŸ¥å…¶é‚»å±…<br>æœ‰ä¸€æ¡é€šå‘â€œçš„æ–°æœ€ä½å¼€é”€è·¯å¾„ã€‚<br>c. ç»™å‡ºå¯¹c(%, w)æˆ–c(g y)çš„é“¾è·¯å¼€é”€çš„å˜åŒ–ï¼Œä½¿å¾—æ‰§è¡Œäº†è·ç¦»å‘é‡ç®—æ³•åï¼ŒåŠ›å°†ä¸é€šçŸ¥å…¶é‚»å±…<br>æœ‰ä¸€æ¡é€šå‘xçš„æ–°æœ€ä½å¼€é”€è·¯å¾„ã€‚</li><li>å¦‚æœåœ¨å› ç‰¹ç½‘ä¸­çš„æ‰€æœ‰é“¾è·¯éƒ½æä¾›å¯é çš„äº¤ä»˜æœåŠ¡ï¼ŒTCPå¯é ä¼ è¾“æœåŠ¡å°†æ˜¯å¤šä½™çš„å—ï¼Ÿä¸ºä»€ä¹ˆï¼Ÿ</li><li><p>åœ¨CSMA/CDä¸­ï¼Œåœ¨ç¬¬5æ¬¡ç¢°æ’åï¼ŒèŠ‚ç‚¹é€‰æ‹©K =4çš„æ¦‚ç‡æœ‰å¤šå¤§ï¼Ÿç»“æœK=4åœ¨10Mbpsä»¥å¤ªç½‘ä¸Šå¯¹<br>åº”äºå¤šå°‘ç§’çš„æ—¶å»¶ï¼Ÿ</p></li><li><p>MACåœ°å€ç©ºé—´æœ‰å¤šå¤§ï¼Ÿ IPv4çš„åœ°å€ç©ºé—´å‘¢ï¼Ÿ IPv6çš„åœ°å€ç©ºé—´å‘¢?</p></li><li><p>ARPæŸ»è¯¢ä¸ºä»€ä¹ˆè¦åœ¨å¹¿æ’­å¸§ä¸­å‘é€å‘¢ï¼Ÿ ARPå“åº”ä¸ºä»€ä¹ˆè¦åœ¨ä¸€ä¸ªå…·æœ‰ç‰¹å®šç›®çš„MACåœ°å€çš„å¸§ä¸­å‘<br>é€å‘¢?</p></li><li><p>è€ƒè™‘5æ¯”ç‰¹ç”Ÿæˆå¤šé¡¹å¼ï¼Œ6 = 10011,å¹¶ä¸”å‡è®¾ã€‚çš„å€¼ä¸ºlOlOlOlOlOo /?çš„å€¼æ˜¯ä»€ä¹ˆ</p></li><li><p>è€ƒè™‘ä¸Šä¸€ä¸ªä¹ é¢˜ï¼Œè¿™æ—¶å‡è®¾Då…·æœ‰å€¼ï¼š<br>a. 1001010101c<br>b. 0101101010o â€¢ä¸€ä¸€<br>c. 1010100000</p></li><li><p>â€¢å¦‚å›¾6ãƒ»33æ‰€ç¤ºï¼Œè€ƒè™‘é€šè¿‡ä¸¤å°è·¯ç”±å™¨äº’è”çš„3ä¸ªå±€åŸŸç½‘ã€‚<br>a. å¯¹æ‰€æœ‰çš„æ¥å£åˆ†é…IPåœ°å€ã€‚å¯¹å­ç½‘1ä½¿ç”¨å½¢å¼ä¸º192. 168. 1. xxxçš„åœ°å€ï¼Œå¯¹å­ç½‘2ä½¿ç”¨å½¢å¼ä¸º</p><p>xxxçš„åœ°å€ï¼Œå¯¹å­ç½‘3ä½¿ç”¨å½¢å¼ä¸º192. 16&amp; 3. xxxçš„åœ°å€ã€‚<br>b. ä¸ºæ‰€æœ‰çš„é€‚é…å™¨åˆ†é…MACåœ°å€ã€‚<br>c. è€ƒè™‘ä»ä¸»æœºEå‘ä¸»æœºBå‘é€ä¸€ä¸ª1Pæ•°æ®æŠ¥ã€‚å‡è®¾æ‰€æœ‰çš„ARPè¡¨éƒ½æ˜¯æœ€æ–°çš„ã€‚å°±åƒåœ¨6.4.1èŠ‚ä¸­<br>å¯¹å•è·¯ç”±å™¨ä¾‹å­æ‰€åšçš„é‚£æ ·ï¼Œåˆ—ä¸¾å‡ºæ‰€æœ‰æ­¥éª¤ã€‚<br>d. é‡å¤ï¼ˆcï¼‰,ç°åœ¨å‡è®¾åœ¨å‘é€ä¸»æœºä¸­çš„ARPè¡¨ä¸ºç©ºï¼ˆå¹¶ä¸”å…¶ä»–è¡¨éƒ½æ˜¯æœ€æ–°çš„ï¼‰ã€‚</p></li><li><p>åœ¨æŸç½‘ç»œä¸­æ ‡è¯†ä¸ºAåˆ°Fçš„6ä¸ªèŠ‚ç‚¹ä»¥æ˜Ÿå½¢ä¸ä¸€å°äº¤æ¢æœºè¿æ¥ï¼Œè€ƒè™‘åœ¨è¯¥ç½‘ç»œç¯å¢ƒä¸­æŸä¸ªæ­£åœ¨<br>å­¦ä¹ çš„äº¤æ¢æœºçš„è¿è¡Œæƒ…å†µã€‚å‡å®šï¼šï¼ˆiï¼‰ Bå‘Eå‘é€ä¸€ä¸ªå¸§ï¼›ï¼ˆiiï¼‰ Eå‘Bå›ç­”ä¸€ä¸ªå¸§ï¼›ï¼ˆiiiï¼‰ A<br>å‘Bå‘é€ä¸€ä¸ªå¸§ï¼›ï¼ˆivï¼‰ Bå‘Aå›ç­”ä¸€ä¸ªå¸§â€œè¯¥äº¤æ¢æœºè¡¨åˆå§‹ä¸ºç©ºã€‚æ˜¾ç¤ºåœ¨è¿™äº›äº‹ä»¶çš„å‰åè¯¥<br>äº¤æ¢æœºè¡¨çš„çŠ¶æ€ã€‚å¯¹äºæ¯ä¸ªäº‹ä»¶ï¼ŒæŒ‡å‡ºåœ¨å…¶ä¸Šé¢è½¬å‘ä¼ è¾“çš„å¸§çš„é“¾è·¯ï¼Œå¹¶ç®€è¦åœ°è¯„ä»·ä½ çš„<br>ç­”æ¡ˆã€‚</p></li></ul>]]></content:encoded>
      
      
      <category domain="https://blog.tokenlen.top/categories/408/">408</category>
      
      
      <category domain="https://blog.tokenlen.top/tags/net/">net</category>
      
      
      <comments>https://blog.tokenlen.top/2025/05/25/network/networktest/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>javaseé¢è¯•é¢˜ç›®hot2é›†åˆ</title>
      <link>https://blog.tokenlen.top/2025/05/23/javase/javase3/</link>
      <guid>https://blog.tokenlen.top/2025/05/23/javase/javase3/</guid>
      <pubDate>Thu, 22 May 2025 16:00:00 GMT</pubDate>
      
        
        
          
          
      <description>&lt;h1 id=&quot;æ¦‚å¿µ&quot;&gt;&lt;a href=&quot;#æ¦‚å¿µ&quot; class=&quot;headerlink&quot; title=&quot;æ¦‚å¿µ&quot;&gt;&lt;/a&gt;æ¦‚å¿µ&lt;/h1&gt;&lt;h2 id=&quot;1-æ•°ç»„ä¸é›†åˆåŒºåˆ«ï¼Œç”¨è¿‡å“ªäº›ï¼Ÿ&quot;&gt;&lt;a href=&quot;#1-æ•°ç»„ä¸é›†åˆåŒºåˆ«ï¼Œç”¨è¿‡å“ªäº›ï¼Ÿ&quot; class=&quot;headerlink&quot;</description>
          
        
      
      
      
      <content:encoded><![CDATA[<h1 id="æ¦‚å¿µ"><a href="#æ¦‚å¿µ" class="headerlink" title="æ¦‚å¿µ"></a>æ¦‚å¿µ</h1><h2 id="1-æ•°ç»„ä¸é›†åˆåŒºåˆ«ï¼Œç”¨è¿‡å“ªäº›ï¼Ÿ"><a href="#1-æ•°ç»„ä¸é›†åˆåŒºåˆ«ï¼Œç”¨è¿‡å“ªäº›ï¼Ÿ" class="headerlink" title="1.æ•°ç»„ä¸é›†åˆåŒºåˆ«ï¼Œç”¨è¿‡å“ªäº›ï¼Ÿ"></a>1.æ•°ç»„ä¸é›†åˆåŒºåˆ«ï¼Œç”¨è¿‡å“ªäº›ï¼Ÿ</h2><p>æ•°ç»„å’Œé›†åˆçš„åŒºåˆ«ï¼š</p><ul><li>æ•°ç»„æ˜¯<strong>å›ºå®šé•¿åº¦</strong>çš„æ•°æ®ç»“æ„ï¼Œä¸€æ—¦åˆ›å»ºé•¿åº¦å°±æ— æ³•æ”¹å˜ï¼Œè€Œé›†åˆæ˜¯<strong>åŠ¨æ€é•¿åº¦</strong>çš„æ•°æ®ç»“æ„ï¼Œå¯ä»¥æ ¹æ®éœ€è¦åŠ¨æ€å¢åŠ æˆ–å‡å°‘å…ƒç´ ã€‚</li><li>æ•°ç»„å¯ä»¥<strong>åŒ…å«åŸºæœ¬æ•°æ®ç±»å‹å’Œå¯¹è±¡</strong>ï¼Œè€Œé›†åˆ<strong>åªèƒ½åŒ…å«å¯¹è±¡</strong>ã€‚</li><li>æ•°ç»„å¯ä»¥ç›´æ¥è®¿é—®å…ƒç´ ï¼Œè€Œé›†åˆéœ€è¦é€šè¿‡è¿­ä»£å™¨æˆ–å…¶ä»–æ–¹æ³•è®¿é—®å…ƒç´ ã€‚</li></ul><p>æˆ‘ç”¨è¿‡çš„ä¸€äº› Java é›†åˆç±»ï¼š</p><ol><li><strong>ArrayListï¼š</strong> åŠ¨æ€æ•°ç»„ï¼Œå®ç°äº†Listæ¥å£ï¼Œæ”¯æŒåŠ¨æ€å¢é•¿ã€‚</li><li><strong>LinkedListï¼š</strong> åŒå‘é“¾è¡¨ï¼Œä¹Ÿå®ç°äº†Listæ¥å£ï¼Œæ”¯æŒå¿«é€Ÿçš„æ’å…¥å’Œåˆ é™¤æ“ä½œã€‚</li><li><strong>HashMapï¼š</strong> åŸºäºå“ˆå¸Œè¡¨çš„Mapå®ç°ï¼Œå­˜å‚¨é”®å€¼å¯¹ï¼Œé€šè¿‡é”®å¿«é€ŸæŸ¥æ‰¾å€¼ã€‚</li><li><strong>HashSetï¼š</strong> åŸºäºHashMapå®ç°çš„Seté›†åˆï¼Œç”¨äºå­˜å‚¨å”¯ä¸€å…ƒç´ ã€‚</li><li><strong>TreeMapï¼š</strong> åŸºäºçº¢é»‘æ ‘å®ç°çš„æœ‰åºMapé›†åˆï¼Œå¯ä»¥æŒ‰ç…§é”®çš„é¡ºåºè¿›è¡Œæ’åºã€‚</li><li><strong>LinkedHashMapï¼š</strong> åŸºäºå“ˆå¸Œè¡¨å’ŒåŒå‘é“¾è¡¨å®ç°çš„Mapé›†åˆï¼Œä¿æŒæ’å…¥é¡ºåºæˆ–è®¿é—®é¡ºåºã€‚</li><li><strong>PriorityQueueï¼š</strong> ä¼˜å…ˆé˜Ÿåˆ—ï¼Œå¯ä»¥æŒ‰ç…§æ¯”è¾ƒå™¨æˆ–å…ƒç´ çš„è‡ªç„¶é¡ºåºè¿›è¡Œæ’åºã€‚</li></ol><h2 id="2-è¯´è¯´Javaä¸­çš„é›†åˆï¼Ÿ"><a href="#2-è¯´è¯´Javaä¸­çš„é›†åˆï¼Ÿ" class="headerlink" title="2.è¯´è¯´Javaä¸­çš„é›†åˆï¼Ÿ"></a>2.è¯´è¯´Javaä¸­çš„é›†åˆï¼Ÿ</h2><p><img src="https://cdn.xiaolincoding.com//picgo/1717481094793-b8ffe6ae-2ee6-4de5-b61b-8468e32bf269.webp" alt=""></p><p>Listæ˜¯<strong>æœ‰åºçš„Collection</strong>ï¼Œä½¿ç”¨æ­¤æ¥å£èƒ½å¤Ÿç²¾ç¡®çš„æ§åˆ¶æ¯ä¸ªå…ƒç´ çš„æ’å…¥ä½ç½®ï¼Œç”¨æˆ·èƒ½æ ¹æ®ç´¢å¼•è®¿é—®Listä¸­å…ƒç´ ã€‚å¸¸ç”¨çš„å®ç°Listçš„ç±»æœ‰LinkedListï¼ŒArrayListï¼ŒVectorï¼ŒStackã€‚</p><ul><li>ArrayListæ˜¯å®¹é‡å¯å˜çš„éçº¿ç¨‹å®‰å…¨åˆ—è¡¨ï¼Œå…¶åº•å±‚ä½¿ç”¨æ•°ç»„å®ç°ã€‚å½“å‡ ä½•æ‰©å®¹æ—¶ï¼Œä¼šåˆ›å»ºæ›´å¤§çš„æ•°ç»„ï¼Œå¹¶æŠŠåŸæ•°ç»„å¤åˆ¶åˆ°æ–°æ•°ç»„ã€‚<strong>ArrayListæ”¯æŒå¯¹å…ƒç´ çš„å¿«é€Ÿéšæœºè®¿é—®ï¼Œä½†æ’å…¥ä¸åˆ é™¤é€Ÿåº¦å¾ˆæ…¢ã€‚</strong></li><li>LinkedListæœ¬è´¨æ˜¯<strong>ä¸€ä¸ªåŒå‘é“¾è¡¨</strong>ï¼Œä¸ArrayListç›¸æ¯”ï¼Œï¼Œ<strong>å…¶æ’å…¥å’Œåˆ é™¤é€Ÿåº¦æ›´å¿«</strong>ï¼Œä½†éšæœºè®¿é—®é€Ÿåº¦æ›´æ…¢ã€‚</li></ul><p>Setä¸å…è®¸å­˜åœ¨é‡å¤çš„å…ƒç´ ï¼Œä¸Listä¸åŒï¼Œsetä¸­çš„å…ƒç´ æ˜¯<strong>æ— åºçš„</strong>ã€‚å¸¸ç”¨çš„å®ç°æœ‰HashSetï¼ŒLinkedHashSetå’ŒTreeSetã€‚</p><ul><li>HashSeté€šè¿‡HashMapå®ç°ï¼ŒHashMapçš„Keyå³HashSetå­˜å‚¨çš„å…ƒç´ ï¼Œ<strong>æ‰€æœ‰Keyéƒ½æ˜¯ç”¨ç›¸åŒçš„Value</strong>ï¼Œä¸€ä¸ªåä¸º<strong>PRESENT</strong>çš„Objectç±»å‹å¸¸é‡ã€‚ä½¿ç”¨Keyä¿è¯å…ƒç´ å”¯ä¸€æ€§ï¼Œä½†ä¸ä¿è¯æœ‰åºæ€§ã€‚ç”±äºHashSetæ˜¯HashMapå®ç°çš„ï¼Œå› æ­¤çº¿ç¨‹ä¸å®‰å…¨ã€‚</li><li>LinkedHashSetç»§æ‰¿è‡ªHashSetï¼Œé€šè¿‡LinkedHashMapå®ç°ï¼Œä½¿ç”¨åŒå‘é“¾è¡¨ç»´æŠ¤å…ƒç´ æ’å…¥é¡ºåºã€‚</li><li>TreeSeté€šè¿‡TreeMapå®ç°çš„ï¼Œæ·»åŠ å…ƒç´ åˆ°é›†åˆæ—¶æŒ‰ç…§æ¯”è¾ƒè§„åˆ™å°†å…¶æ’å…¥åˆé€‚çš„ä½ç½®ï¼Œä¿è¯æ’å…¥åçš„é›†åˆä»ç„¶æœ‰åºã€‚</li></ul><p>Map æ˜¯<strong>ä¸€ä¸ªé”®å€¼å¯¹é›†åˆ</strong>ï¼Œå­˜å‚¨é”®ã€å€¼å’Œä¹‹é—´çš„æ˜ å°„ã€‚Key æ— åºï¼Œå”¯ä¸€ï¼›value ä¸è¦æ±‚æœ‰åºï¼Œå…è®¸é‡å¤ã€‚Map æ²¡æœ‰ç»§æ‰¿äº Collection æ¥å£ï¼Œä» Map é›†åˆä¸­æ£€ç´¢å…ƒç´ æ—¶ï¼Œ<strong>åªè¦ç»™å‡ºé”®å¯¹è±¡ï¼Œå°±ä¼šè¿”å›å¯¹åº”çš„å€¼å¯¹è±¡</strong>ã€‚ä¸»è¦å®ç°æœ‰TreeMapã€HashMapã€HashTableã€LinkedHashMapã€ConcurrentHashMap</p><ul><li>HashMapï¼šJDK1.8 ä¹‹å‰ HashMap <strong>ç”±æ•°ç»„+é“¾è¡¨ç»„æˆçš„</strong>ï¼Œæ•°ç»„æ˜¯ HashMap çš„ä¸»ä½“ï¼Œ<strong>é“¾è¡¨åˆ™æ˜¯ä¸»è¦ä¸ºäº†è§£å†³å“ˆå¸Œå†²çªè€Œå­˜åœ¨çš„ï¼ˆâ€œæ‹‰é“¾æ³•â€è§£å†³å†²çªï¼‰</strong>ï¼ŒJDK1.8 ä»¥ååœ¨è§£å†³å“ˆå¸Œå†²çªæ—¶æœ‰äº†è¾ƒå¤§çš„å˜åŒ–ï¼Œ<strong>å½“é“¾è¡¨é•¿åº¦å¤§äºé˜ˆå€¼ï¼ˆé»˜è®¤ä¸º 8ï¼‰æ—¶ï¼Œå°†é“¾è¡¨è½¬åŒ–ä¸ºçº¢é»‘æ ‘ï¼Œä»¥å‡å°‘æœç´¢æ—¶é—´</strong></li><li>LinkedHashMapï¼šLinkedHashMap ç»§æ‰¿è‡ª HashMapï¼Œæ‰€ä»¥å®ƒçš„åº•å±‚ä»ç„¶æ˜¯<strong>åŸºäºæ‹‰é“¾å¼æ•£åˆ—ç»“æ„å³ç”±æ•°ç»„å’Œé“¾è¡¨æˆ–çº¢é»‘æ ‘ç»„æˆã€‚</strong>å¦å¤–ï¼ŒLinkedHashMap åœ¨ä¸Šé¢ç»“æ„çš„åŸºç¡€ä¸Šï¼Œå¢åŠ äº†ä¸€æ¡åŒå‘é“¾è¡¨ï¼Œ<strong>ä½¿å¾—ä¸Šé¢çš„ç»“æ„å¯ä»¥ä¿æŒé”®å€¼å¯¹çš„æ’å…¥é¡ºåºã€‚åŒæ—¶é€šè¿‡å¯¹é“¾è¡¨è¿›è¡Œç›¸åº”çš„æ“ä½œï¼Œå®ç°äº†è®¿é—®é¡ºåºç›¸å…³é€»è¾‘ã€‚</strong></li><li>HashTableï¼š<strong>æ•°ç»„+é“¾è¡¨</strong>ç»„æˆçš„ï¼Œæ•°ç»„æ˜¯ HashTable çš„ä¸»ä½“ï¼Œé“¾è¡¨åˆ™æ˜¯ä¸»è¦ä¸ºäº†è§£å†³å“ˆå¸Œå†²çªè€Œå­˜åœ¨çš„</li><li>TreeMapï¼š<strong>çº¢é»‘æ ‘ï¼ˆè‡ªå¹³è¡¡çš„æ’åºäºŒå‰æ ‘ï¼‰</strong></li><li>ConcurrentHashMapï¼š<strong>Nodeæ•°ç»„+é“¾è¡¨+çº¢é»‘æ ‘å®ç°</strong>ï¼Œ<strong>çº¿ç¨‹å®‰å…¨çš„</strong>ï¼ˆjdk1.8ä»¥å‰<strong>Segment</strong>é”ï¼Œ<strong>1.8ä»¥åvolatile + CAS æˆ–è€… synchronizedï¼‰</strong></li></ul><h2 id="3-Javaä¸­çš„çº¿ç¨‹å®‰å…¨çš„é›†åˆæ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#3-Javaä¸­çš„çº¿ç¨‹å®‰å…¨çš„é›†åˆæ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="3.Javaä¸­çš„çº¿ç¨‹å®‰å…¨çš„é›†åˆæ˜¯ä»€ä¹ˆï¼Ÿ"></a>3.Javaä¸­çš„çº¿ç¨‹å®‰å…¨çš„é›†åˆæ˜¯ä»€ä¹ˆï¼Ÿ</h2><ul><li><strong>Vector</strong>ï¼š<strong>çº¿ç¨‹å®‰å…¨çš„åŠ¨æ€æ•°ç»„</strong>ï¼Œå…¶å†…éƒ¨æ–¹æ³•åŸºæœ¬éƒ½ç»è¿‡synchronizedä¿®é¥°ï¼Œå¦‚æœä¸éœ€è¦çº¿ç¨‹å®‰å…¨ï¼Œå¹¶ä¸å»ºè®®é€‰æ‹©ï¼Œæ¯•ç«ŸåŒæ­¥æ˜¯æœ‰é¢å¤–å¼€é”€çš„ã€‚Vector å†…éƒ¨æ˜¯ä½¿ç”¨å¯¹è±¡æ•°ç»„æ¥ä¿å­˜æ•°æ®ï¼Œå¯ä»¥æ ¹æ®éœ€è¦è‡ªåŠ¨çš„å¢åŠ å®¹é‡ï¼Œ<strong>å½“æ•°ç»„å·²æ»¡æ—¶ï¼Œä¼šåˆ›å»ºæ–°çš„æ•°ç»„ï¼Œå¹¶æ‹·è´åŸæœ‰æ•°ç»„æ•°æ®ã€‚</strong></li><li><strong>Hashtable</strong>ï¼šçº¿ç¨‹å®‰å…¨çš„å“ˆå¸Œè¡¨ï¼Œ<strong>HashTable çš„åŠ é”æ–¹æ³•æ˜¯ç»™æ¯ä¸ªæ–¹æ³•åŠ ä¸Š synchronized å…³é”®å­—ï¼Œè¿™æ ·é”ä½çš„æ˜¯æ•´ä¸ª Table å¯¹è±¡ï¼Œ</strong>ä¸æ”¯æŒ null é”®å’Œå€¼**ï¼Œç”±äºåŒæ­¥å¯¼è‡´çš„æ€§èƒ½å¼€é”€ï¼Œæ‰€ä»¥å·²ç»å¾ˆå°‘è¢«æ¨èä½¿ç”¨ï¼Œå¦‚æœè¦ä¿è¯çº¿ç¨‹å®‰å…¨çš„å“ˆå¸Œè¡¨ï¼Œå¯ä»¥ç”¨ConcurrentHashMapã€‚</li></ul><p>java.util.concurrent åŒ…æä¾›çš„éƒ½æ˜¯çº¿ç¨‹å®‰å…¨çš„é›†åˆï¼š</p><p>å¹¶å‘Mapï¼š</p><ul><li><strong>ConcurrentHashMap</strong>ï¼šå®ƒä¸ HashTable çš„ä¸»è¦åŒºåˆ«æ˜¯<strong>äºŒè€…åŠ é”ç²’åº¦</strong>çš„ä¸åŒï¼Œåœ¨<strong>JDK1.7</strong>ï¼ŒConcurrentHashMapåŠ çš„æ˜¯<strong>åˆ†æ®µé”ï¼Œä¹Ÿå°±æ˜¯Segmenté”</strong>ï¼Œæ¯ä¸ªSegment å«æœ‰æ•´ä¸ª table çš„ä¸€éƒ¨åˆ†ï¼Œè¿™æ ·ä¸åŒåˆ†æ®µä¹‹é—´çš„å¹¶å‘æ“ä½œå°±äº’ä¸å½±å“ã€‚åœ¨<strong>JDK 1.8</strong> ï¼Œå®ƒå–æ¶ˆäº†Segmentå­—æ®µï¼Œ<strong>ç›´æ¥åœ¨tableå…ƒç´ ä¸ŠåŠ é”ï¼Œå®ç°å¯¹æ¯ä¸€è¡Œè¿›è¡ŒåŠ é”ï¼Œè¿›ä¸€æ­¥å‡å°äº†å¹¶å‘å†²çªçš„æ¦‚ç‡ã€‚</strong>å¯¹äºputæ“ä½œï¼Œå¦‚æœKeyå¯¹åº”çš„æ•°ç»„å…ƒç´ ä¸ºnullï¼Œ<strong>åˆ™é€šè¿‡CASæ“ä½œï¼ˆCompare and Swapï¼‰å°†å…¶è®¾ç½®ä¸ºå½“å‰å€¼</strong>ã€‚å¦‚æœKeyå¯¹åº”çš„æ•°ç»„å…ƒç´ ï¼ˆä¹Ÿå³é“¾è¡¨è¡¨å¤´æˆ–è€…æ ‘çš„æ ¹å…ƒç´ ï¼‰ä¸ä¸ºnullï¼Œ<strong>åˆ™å¯¹è¯¥å…ƒç´ ä½¿ç”¨ synchronized å…³é”®å­—ç”³è¯·é”ï¼Œç„¶åè¿›è¡Œæ“ä½œ</strong>ã€‚å¦‚æœè¯¥ put æ“ä½œä½¿å¾—å½“å‰é“¾è¡¨é•¿åº¦è¶…è¿‡ä¸€å®šé˜ˆå€¼ï¼Œ<strong>åˆ™å°†è¯¥é“¾è¡¨è½¬æ¢ä¸ºçº¢é»‘æ ‘ï¼Œä»è€Œæé«˜å¯»å€æ•ˆç‡ã€‚</strong></li><li><strong>ConcurrentSkipListMap</strong>ï¼šå®ç°äº†ä¸€ä¸ª<strong>åŸºäºSkipListï¼ˆè·³è¡¨ï¼‰</strong>ç®—æ³•çš„å¯æ’åºçš„å¹¶å‘é›†åˆï¼ŒSkipListæ˜¯<strong>ä¸€ç§å¯ä»¥åœ¨å¯¹æ•°é¢„æœŸæ—¶é—´å†…å®Œæˆæœç´¢ã€æ’å…¥ã€åˆ é™¤ç­‰æ“ä½œçš„æ•°æ®ç»“æ„ï¼Œé€šè¿‡ç»´æŠ¤å¤šä¸ªæŒ‡å‘å…¶ä»–å…ƒç´ çš„â€œè·³è·ƒâ€é“¾æ¥æ¥å®ç°é«˜æ•ˆæŸ¥æ‰¾ã€‚</strong></li></ul><p>å¹¶å‘Setï¼š</p><ul><li><strong>ConcurrentSkipListSet</strong>ï¼šæ˜¯çº¿ç¨‹å®‰å…¨çš„æœ‰åºçš„é›†åˆã€‚åº•å±‚æ˜¯ä½¿ç”¨ConcurrentSkipListMapå®ç°ã€‚</li><li><strong>CopyOnWriteArraySet</strong>ï¼šæ˜¯<strong>çº¿ç¨‹å®‰å…¨çš„Setå®ç°</strong>ï¼Œå®ƒæ˜¯çº¿ç¨‹å®‰å…¨çš„æ— åºçš„é›†åˆï¼Œå¯ä»¥å°†å®ƒç†è§£æˆçº¿ç¨‹å®‰å…¨çš„HashSetã€‚æœ‰æ„æ€çš„æ˜¯ï¼ŒCopyOnWriteArraySetå’ŒHashSetè™½ç„¶éƒ½ç»§æ‰¿äºå…±åŒçš„çˆ¶ç±»AbstractSetï¼›ä½†æ˜¯ï¼Œ<strong>HashSetæ˜¯é€šè¿‡â€œæ•£åˆ—è¡¨â€å®ç°çš„</strong>ï¼Œè€Œ<strong>CopyOnWriteArraySetåˆ™æ˜¯é€šè¿‡â€œåŠ¨æ€æ•°ç»„(CopyOnWriteArrayList)â€å®ç°çš„ï¼Œå¹¶ä¸æ˜¯æ•£åˆ—è¡¨ã€‚</strong></li></ul><p>å¹¶å‘Listï¼š</p><ul><li><strong>CopyOnWriteArrayList</strong>ï¼šå®ƒæ˜¯ ArrayList çš„çº¿ç¨‹å®‰å…¨çš„å˜ä½“ï¼Œ<strong>å…¶ä¸­æ‰€æœ‰å†™æ“ä½œï¼ˆaddï¼Œsetç­‰ï¼‰éƒ½é€šè¿‡å¯¹åº•å±‚æ•°ç»„è¿›è¡Œå…¨æ–°å¤åˆ¶æ¥å®ç°</strong>ï¼Œ<strong>å…è®¸å­˜å‚¨ null å…ƒç´ </strong>ã€‚å³å½“å¯¹è±¡è¿›è¡Œå†™æ“ä½œæ—¶ï¼Œ<strong>ä½¿ç”¨äº†Locké”åšåŒæ­¥å¤„ç†ï¼Œå†…éƒ¨æ‹·è´äº†åŸæ•°ç»„ï¼Œå¹¶åœ¨æ–°æ•°ç»„ä¸Šè¿›è¡Œæ·»åŠ æ“ä½œï¼Œæœ€åå°†æ–°æ•°ç»„æ›¿æ¢æ‰æ—§æ•°ç»„ï¼›</strong>è‹¥è¿›è¡Œçš„è¯»æ“ä½œï¼Œåˆ™ç›´æ¥è¿”å›ç»“æœï¼Œæ“ä½œè¿‡ç¨‹ä¸­ä¸éœ€è¦è¿›è¡ŒåŒæ­¥ã€‚</li></ul><p>å¹¶å‘ Queueï¼š</p><ul><li><strong>ConcurrentLinkedQueue</strong>ï¼šæ˜¯ä¸€ä¸ªé€‚ç”¨äºé«˜å¹¶å‘åœºæ™¯ä¸‹çš„é˜Ÿåˆ—ï¼Œå®ƒé€šè¿‡æ— é”çš„æ–¹å¼(CAS)ï¼Œå®ç°äº†é«˜å¹¶å‘çŠ¶æ€ä¸‹çš„é«˜æ€§èƒ½ã€‚é€šå¸¸ï¼ŒConcurrentLinkedQueue çš„æ€§èƒ½è¦å¥½äº BlockingQueue ã€‚</li><li><strong>BlockingQueue</strong>ï¼šä¸ ConcurrentLinkedQueue çš„ä½¿ç”¨åœºæ™¯ä¸åŒï¼ŒBlockingQueue çš„ä¸»è¦åŠŸèƒ½å¹¶ä¸æ˜¯åœ¨äºæå‡é«˜å¹¶å‘æ—¶çš„é˜Ÿåˆ—æ€§èƒ½ï¼Œ<strong>è€Œåœ¨äºç®€åŒ–å¤šçº¿ç¨‹é—´çš„æ•°æ®å…±äº«ã€‚</strong>BlockingQueue æä¾›ä¸€ç§è¯»å†™é˜»å¡ç­‰å¾…çš„æœºåˆ¶ï¼Œ<strong>å³å¦‚æœæ¶ˆè´¹è€…é€Ÿåº¦è¾ƒå¿«ï¼Œåˆ™ BlockingQueue åˆ™å¯èƒ½è¢«æ¸…ç©ºï¼Œæ­¤æ—¶æ¶ˆè´¹çº¿ç¨‹å†è¯•å›¾ä» BlockingQueue è¯»å–æ•°æ®æ—¶å°±ä¼šè¢«é˜»å¡ã€‚</strong>åä¹‹ï¼Œå¦‚æœç”Ÿäº§çº¿ç¨‹è¾ƒå¿«ï¼Œåˆ™ BlockingQueue å¯èƒ½ä¼šè¢«è£…æ»¡ï¼Œæ­¤æ—¶ï¼Œç”Ÿäº§çº¿ç¨‹å†è¯•å›¾å‘ BlockingQueue é˜Ÿåˆ—è£…å…¥æ•°æ®æ—¶ï¼Œä¾¿ä¼šè¢«é˜»å¡ç­‰å¾…ã€‚</li></ul><p>å¹¶å‘ Dequeï¼š</p><ul><li><strong>LinkedBlockingDeque</strong>ï¼šæ˜¯<strong>ä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„åŒç«¯é˜Ÿåˆ—</strong>å®ç°ã€‚å®ƒçš„å†…éƒ¨ä½¿ç”¨<strong>é“¾è¡¨ç»“æ„</strong>ï¼Œæ¯ä¸€ä¸ªèŠ‚ç‚¹éƒ½ç»´æŠ¤äº†ä¸€ä¸ªå‰é©±èŠ‚ç‚¹å’Œä¸€ä¸ªåé©±èŠ‚ç‚¹ã€‚<strong>LinkedBlockingDeque æ²¡æœ‰è¿›è¡Œè¯»å†™é”çš„åˆ†ç¦»ï¼Œå› æ­¤åŒä¸€æ—¶é—´åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹å¯¹å…¶è¿›è¡Œæ“ä½œ</strong></li><li><strong>ConcurrentLinkedDeque</strong>ï¼šConcurrentLinkedDequeæ˜¯ä¸€ç§<strong>åŸºäºé“¾æ¥èŠ‚ç‚¹çš„æ— é™å¹¶å‘é“¾è¡¨ã€‚å¯ä»¥å®‰å…¨åœ°å¹¶å‘æ‰§è¡Œæ’å…¥ã€åˆ é™¤å’Œè®¿é—®æ“ä½œ</strong>ã€‚å½“<strong>è®¸å¤šçº¿ç¨‹åŒæ—¶è®¿é—®ä¸€ä¸ªå…¬å…±é›†åˆæ—¶</strong>ï¼ŒConcurrentLinkedDequeæ˜¯ä¸€ä¸ªåˆé€‚çš„é€‰æ‹©</li></ul><h2 id="4-Collectionså’ŒCollectionçš„åŒºåˆ«"><a href="#4-Collectionså’ŒCollectionçš„åŒºåˆ«" class="headerlink" title="4.Collectionså’ŒCollectionçš„åŒºåˆ«"></a>4.Collectionså’ŒCollectionçš„åŒºåˆ«</h2><ul><li>Collectionæ˜¯<strong>Javaé›†åˆæ¡†æ¶ä¸­çš„ä¸€ä¸ªæ¥å£</strong>ï¼Œå®ƒæ˜¯æ‰€æœ‰é›†åˆç±»çš„åŸºç¡€æ¥å£ã€‚å®ƒå®šä¹‰äº†ä¸€ç»„é€šç”¨çš„æ“ä½œå’Œæ–¹æ³•ï¼Œå¦‚æ·»åŠ ã€åˆ é™¤ã€éå†ç­‰ï¼Œç”¨äºæ“ä½œå’Œç®¡ç†ä¸€ç»„å¯¹è±¡ã€‚Collectionæ¥å£æœ‰è®¸å¤šå®ç°ç±»ï¼Œå¦‚Listã€Setå’ŒQueueç­‰ã€‚</li><li>Collectionsï¼ˆæ³¨æ„æœ‰ä¸€ä¸ªsï¼‰<strong>æ˜¯Javaæä¾›çš„ä¸€ä¸ªå·¥å…·ç±»</strong>ï¼Œä½äºjava.utilåŒ…ä¸­ã€‚å®ƒæä¾›äº†ä¸€ç³»åˆ—é™æ€æ–¹æ³•ï¼Œç”¨äºå¯¹é›†åˆè¿›è¡Œæ“ä½œå’Œç®—æ³•ã€‚Collectionsç±»ä¸­çš„æ–¹æ³•åŒ…æ‹¬æ’åºã€æŸ¥æ‰¾ã€æ›¿æ¢ã€åè½¬ã€éšæœºåŒ–ç­‰ç­‰ã€‚è¿™äº›æ–¹æ³•å¯ä»¥å¯¹å®ç°äº†Collectionæ¥å£çš„é›†åˆè¿›è¡Œæ“ä½œï¼Œå¦‚Listå’ŒSetã€‚</li></ul><h2 id="5-é›†åˆéå†çš„æ–¹æ³•æœ‰å“ªäº›ï¼Ÿ"><a href="#5-é›†åˆéå†çš„æ–¹æ³•æœ‰å“ªäº›ï¼Ÿ" class="headerlink" title="5.é›†åˆéå†çš„æ–¹æ³•æœ‰å“ªäº›ï¼Ÿ"></a>5.é›†åˆéå†çš„æ–¹æ³•æœ‰å“ªäº›ï¼Ÿ</h2><ul><li><strong>æ™®é€š for å¾ªç¯ï¼š</strong> å¯ä»¥ä½¿ç”¨å¸¦æœ‰ç´¢å¼•çš„æ™®é€š for å¾ªç¯æ¥éå† Listã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; list.size(); i++) &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">element</span> <span class="operator">=</span> list.get(i);</span><br><span class="line">    System.out.println(element);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><strong>å¢å¼º for å¾ªç¯ï¼ˆfor-eachå¾ªç¯ï¼‰ï¼š</strong> ç”¨äºå¾ªç¯è®¿é—®æ•°ç»„æˆ–é›†åˆä¸­çš„å…ƒç´ ã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (String element : list) &#123;</span><br><span class="line">    System.out.println(element);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><strong>Iterator è¿­ä»£å™¨ï¼š</strong> å¯ä»¥ä½¿ç”¨è¿­ä»£å™¨æ¥éå†é›†åˆï¼Œç‰¹åˆ«é€‚ç”¨äºéœ€è¦åˆ é™¤å…ƒç´ çš„æƒ…å†µã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Iterator&lt;String&gt; iterator = list.iterator();</span><br><span class="line"><span class="keyword">while</span>(iterator.hasNext()) &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">element</span> <span class="operator">=</span> iterator.next();</span><br><span class="line">    System.out.println(element);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><strong>ListIterator åˆ—è¡¨è¿­ä»£å™¨ï¼š</strong> ListIteratoræ˜¯è¿­ä»£å™¨çš„å­ç±»ï¼Œå¯ä»¥åŒå‘è®¿é—®åˆ—è¡¨å¹¶åœ¨è¿­ä»£è¿‡ç¨‹ä¸­ä¿®æ”¹å…ƒç´ ã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ListIterator&lt;String&gt; listIterator= list.listIterator();</span><br><span class="line"><span class="keyword">while</span>(listIterator.hasNext()) &#123;</span><br><span class="line">    <span class="type">String</span> <span class="variable">element</span> <span class="operator">=</span> listIterator.next();</span><br><span class="line">    System.out.println(element);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><strong>ä½¿ç”¨ forEach æ–¹æ³•ï¼š</strong> Java 8å¼•å…¥äº† forEach æ–¹æ³•ï¼Œå¯ä»¥å¯¹é›†åˆè¿›è¡Œå¿«é€Ÿéå†ã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">list.forEach(element -&gt; System.out.println(element));</span><br></pre></td></tr></table></figure><ul><li><strong>Stream APIï¼š</strong> Java 8çš„Stream APIæä¾›äº†ä¸°å¯Œçš„åŠŸèƒ½ï¼Œå¯ä»¥å¯¹é›†åˆè¿›è¡Œå‡½æ•°å¼æ“ä½œï¼Œå¦‚è¿‡æ»¤ã€æ˜ å°„ç­‰ã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">list.stream().forEach(element -&gt; System.out.println(element));</span><br></pre></td></tr></table></figure><h1 id="List"><a href="#List" class="headerlink" title="List"></a>List</h1><h2 id="1-è®²ä¸€ä¸‹javaé‡Œé¢listçš„å‡ ç§å®ç°ï¼Œå‡ ç§å®ç°æœ‰ä»€ä¹ˆä¸åŒï¼Ÿ"><a href="#1-è®²ä¸€ä¸‹javaé‡Œé¢listçš„å‡ ç§å®ç°ï¼Œå‡ ç§å®ç°æœ‰ä»€ä¹ˆä¸åŒï¼Ÿ" class="headerlink" title="1.è®²ä¸€ä¸‹javaé‡Œé¢listçš„å‡ ç§å®ç°ï¼Œå‡ ç§å®ç°æœ‰ä»€ä¹ˆä¸åŒï¼Ÿ"></a>1.è®²ä¸€ä¸‹javaé‡Œé¢listçš„å‡ ç§å®ç°ï¼Œå‡ ç§å®ç°æœ‰ä»€ä¹ˆä¸åŒï¼Ÿ</h2><ul><li>Vector æ˜¯ Java æ—©æœŸæä¾›çš„çº¿ç¨‹å®‰å…¨çš„åŠ¨æ€æ•°ç»„ï¼Œå¦‚æœä¸éœ€è¦çº¿ç¨‹å®‰å…¨ï¼Œå¹¶ä¸å»ºè®®é€‰æ‹©ï¼Œæ¯•ç«ŸåŒæ­¥æ˜¯æœ‰é¢å¤–å¼€é”€çš„ã€‚Vector å†…éƒ¨æ˜¯ä½¿ç”¨<strong>å¯¹è±¡æ•°ç»„</strong>æ¥ä¿å­˜æ•°æ®ï¼Œå¯ä»¥æ ¹æ®éœ€è¦è‡ªåŠ¨çš„å¢åŠ å®¹é‡ï¼Œå½“æ•°ç»„å·²æ»¡æ—¶ï¼Œä¼šåˆ›å»ºæ–°çš„æ•°ç»„ï¼Œå¹¶æ‹·è´åŸæœ‰æ•°ç»„æ•°æ®ã€‚</li><li>ArrayList æ˜¯åº”ç”¨æ›´åŠ å¹¿æ³›çš„åŠ¨æ€æ•°ç»„å®ç°ï¼Œå®ƒæœ¬èº«ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œæ‰€ä»¥æ€§èƒ½è¦å¥½å¾ˆå¤šã€‚ä¸ Vector è¿‘ä¼¼ï¼ŒArrayList ä¹Ÿæ˜¯å¯ä»¥æ ¹æ®éœ€è¦è°ƒæ•´å®¹é‡ï¼Œä¸è¿‡ä¸¤è€…çš„è°ƒæ•´é€»è¾‘æœ‰æ‰€åŒºåˆ«ï¼Œ<strong>Vector åœ¨æ‰©å®¹æ—¶ä¼šæé«˜ 1 å€ï¼Œ</strong>è€Œ ArrayList åˆ™æ˜¯å¢åŠ  <strong>50%ã€‚</strong></li><li>LinkedList é¡¾åæ€ä¹‰æ˜¯ Java æä¾›çš„åŒå‘é“¾è¡¨ï¼Œæ‰€ä»¥å®ƒä¸éœ€è¦åƒä¸Šé¢ä¸¤ç§é‚£æ ·è°ƒæ•´å®¹é‡ï¼Œå®ƒä¹Ÿä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚</li></ul><blockquote><p>è¿™å‡ ç§å®ç°å…·ä½“åœ¨ä»€ä¹ˆåœºæ™¯ä¸‹åº”è¯¥ç”¨å“ªç§ï¼Ÿ</p></blockquote><ul><li>Vector å’Œ ArrayList ä½œä¸ºåŠ¨æ€æ•°ç»„ï¼Œå…¶å†…éƒ¨å…ƒç´ ä»¥æ•°ç»„å½¢å¼é¡ºåºå­˜å‚¨çš„ï¼Œæ‰€ä»¥éå¸¸é€‚åˆ<strong>éšæœºè®¿é—®</strong>çš„åœºåˆã€‚é™¤äº†å°¾éƒ¨æ’å…¥å’Œåˆ é™¤å…ƒç´ ï¼Œå¾€å¾€æ€§èƒ½ä¼šç›¸å¯¹è¾ƒå·®ï¼Œæ¯”å¦‚æˆ‘ä»¬åœ¨ä¸­é—´ä½ç½®æ’å…¥ä¸€ä¸ªå…ƒç´ ï¼Œéœ€è¦ç§»åŠ¨åç»­æ‰€æœ‰å…ƒç´ ã€‚</li><li>è€Œ LinkedList è¿›è¡ŒèŠ‚ç‚¹æ’å…¥ã€<strong>åˆ é™¤å´è¦é«˜æ•ˆå¾—å¤šï¼Œä½†æ˜¯éšæœºè®¿é—®æ€§èƒ½åˆ™è¦æ¯”åŠ¨æ€æ•°ç»„æ…¢ã€‚</strong></li></ul><h2 id="2-listå¯ä»¥ä¸€è¾¹éå†ä¸€è¾¹ä¿®æ”¹å…ƒç´ å—ï¼Ÿ"><a href="#2-listå¯ä»¥ä¸€è¾¹éå†ä¸€è¾¹ä¿®æ”¹å…ƒç´ å—ï¼Ÿ" class="headerlink" title="2.listå¯ä»¥ä¸€è¾¹éå†ä¸€è¾¹ä¿®æ”¹å…ƒç´ å—ï¼Ÿ"></a>2.listå¯ä»¥ä¸€è¾¹éå†ä¸€è¾¹ä¿®æ”¹å…ƒç´ å—ï¼Ÿ</h2><ul><li>ä½¿ç”¨æ™®é€šforå¾ªç¯éå†ï¼šå¯ä»¥åœ¨éå†è¿‡ç¨‹ä¸­ä¿®æ”¹å…ƒç´ ï¼Œåªè¦ä¿®æ”¹çš„ç´¢å¼•ä¸è¶…å‡º<code>List</code>çš„èŒƒå›´å³å¯ã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ListTraversalAndModification</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        List&lt;Integer&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        list.add(<span class="number">1</span>);</span><br><span class="line">        list.add(<span class="number">2</span>);</span><br><span class="line">        list.add(<span class="number">3</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ä½¿ç”¨æ™®é€šforå¾ªç¯éå†å¹¶ä¿®æ”¹å…ƒç´ </span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; list.size(); i++) &#123;</span><br><span class="line">            list.set(i, list.get(i) * <span class="number">2</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        System.out.println(list);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>ä½¿ç”¨foreachå¾ªç¯éå†ï¼šä¸€èˆ¬ä¸å»ºè®®åœ¨<code>foreach</code>å¾ªç¯ä¸­ç›´æ¥ä¿®æ”¹æ­£åœ¨éå†çš„<code>List</code>å…ƒç´ ï¼Œå› ä¸º<strong>è¿™å¯èƒ½ä¼šå¯¼è‡´æ„å¤–çš„ç»“æœæˆ–<code>ConcurrentModificationException</code>å¼‚</strong>å¸¸ã€‚åœ¨<code>foreach</code>å¾ªç¯ä¸­ä¿®æ”¹å…ƒç´ å¯èƒ½ä¼šç ´åè¿­ä»£å™¨çš„å†…éƒ¨çŠ¶æ€ï¼Œå› ä¸º<code>foreach</code>å¾ªç¯åº•å±‚æ˜¯åŸºäºè¿­ä»£å™¨å®ç°çš„ï¼Œåœ¨éå†è¿‡ç¨‹ä¸­ä¿®æ”¹é›†åˆç»“æ„ï¼Œä¼šå¯¼è‡´è¿­ä»£å™¨çš„é¢„æœŸç»“æ„å’Œå®é™…ç»“æ„ä¸ä¸€è‡´ã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ListTraversalAndModification</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        List&lt;Integer&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        list.add(<span class="number">1</span>);</span><br><span class="line">        list.add(<span class="number">2</span>);</span><br><span class="line">        list.add(<span class="number">3</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ä½¿ç”¨foreachå¾ªç¯éå†å¹¶å°è¯•ä¿®æ”¹å…ƒç´ ï¼Œä¼šæŠ›å‡ºConcurrentModificationExceptionå¼‚å¸¸</span></span><br><span class="line">        <span class="keyword">for</span> (Integer num : list) &#123;</span><br><span class="line">            list.set(list.indexOf(num), num * <span class="number">2</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        System.out.println(list);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>ä½¿ç”¨è¿­ä»£å™¨éå†ï¼š<strong>å¯ä»¥ä½¿ç”¨è¿­ä»£å™¨çš„<code>remove</code>æ–¹æ³•æ¥åˆ é™¤å…ƒç´ ï¼Œä½†å¦‚æœè¦ä¿®æ”¹å…ƒç´ çš„å€¼ï¼Œéœ€è¦é€šè¿‡è¿­ä»£å™¨çš„<code>set</code>æ–¹æ³•æ¥è¿›è¡Œ</strong>ï¼Œè€Œä¸æ˜¯ç›´æ¥é€šè¿‡<code>List</code>çš„<code>set</code>æ–¹æ³•ï¼Œå¦åˆ™ä¹Ÿå¯èƒ½ä¼šæŠ›å‡º<code>ConcurrentModificationException</code>å¼‚å¸¸ã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.Iterator;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ListTraversalAndModification</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        List&lt;Integer&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        list.add(<span class="number">1</span>);</span><br><span class="line">        list.add(<span class="number">2</span>);</span><br><span class="line">        list.add(<span class="number">3</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ä½¿ç”¨è¿­ä»£å™¨éå†å¹¶ä¿®æ”¹å…ƒç´ </span></span><br><span class="line">        Iterator&lt;Integer&gt; iterator = list.iterator();</span><br><span class="line">        <span class="keyword">while</span> (iterator.hasNext()) &#123;</span><br><span class="line">            <span class="type">Integer</span> <span class="variable">num</span> <span class="operator">=</span> iterator.next();</span><br><span class="line">            <span class="keyword">if</span> (num == <span class="number">2</span>) &#123;</span><br><span class="line">                <span class="comment">// ä½¿ç”¨è¿­ä»£å™¨çš„setæ–¹æ³•ä¿®æ”¹å…ƒç´ </span></span><br><span class="line">                iterator.set(<span class="number">4</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        System.out.println(list);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯¹äºçº¿ç¨‹å®‰å…¨çš„<code>List</code>ï¼Œå¦‚<code>CopyOnWriteArrayList</code>ï¼Œç”±äºå…¶é‡‡ç”¨äº†å†™æ—¶å¤åˆ¶çš„æœºåˆ¶ï¼Œ<strong>åœ¨éå†çš„åŒæ—¶å¯ä»¥è¿›è¡Œä¿®æ”¹æ“ä½œï¼Œä¸ä¼šæŠ›å‡º<code>ConcurrentModificationException</code>å¼‚å¸¸ï¼Œ</strong>ä½†å¯èƒ½ä¼šè¯»å–åˆ°æ—§çš„æ•°æ®ï¼Œå› ä¸ºä¿®æ”¹æ“ä½œæ˜¯åœ¨æ–°çš„å‰¯æœ¬ä¸Šè¿›è¡Œçš„ã€‚</p><h2 id="3-listå¦‚ä½•å¿«é€Ÿåˆ é™¤æŸä¸ªæŒ‡å®šä¸‹æ ‡çš„å…ƒç´ ï¼Ÿ"><a href="#3-listå¦‚ä½•å¿«é€Ÿåˆ é™¤æŸä¸ªæŒ‡å®šä¸‹æ ‡çš„å…ƒç´ ï¼Ÿ" class="headerlink" title="3.listå¦‚ä½•å¿«é€Ÿåˆ é™¤æŸä¸ªæŒ‡å®šä¸‹æ ‡çš„å…ƒç´ ï¼Ÿ"></a>3.listå¦‚ä½•å¿«é€Ÿåˆ é™¤æŸä¸ªæŒ‡å®šä¸‹æ ‡çš„å…ƒç´ ï¼Ÿ</h2><p><code>ArrayList</code>æä¾›äº†<code>remove(int index)</code>æ–¹æ³•æ¥åˆ é™¤æŒ‡å®šä¸‹æ ‡çš„å…ƒç´ ï¼Œ<strong>è¯¥æ–¹æ³•åœ¨åˆ é™¤å…ƒç´ åï¼Œä¼šå°†åç»­å…ƒç´ å‘å‰ç§»åŠ¨ï¼Œä»¥å¡«è¡¥è¢«åˆ é™¤å…ƒç´ çš„ä½ç½®ã€‚</strong>å¦‚æœåˆ é™¤çš„æ˜¯åˆ—è¡¨æœ«å°¾çš„å…ƒç´ ï¼Œæ—¶é—´å¤æ‚åº¦ä¸º O (1)ï¼›å¦‚æœåˆ é™¤çš„æ˜¯åˆ—è¡¨ä¸­é—´çš„å…ƒç´ ï¼Œæ—¶é—´å¤æ‚åº¦ä¸º O (n)ï¼Œn ä¸ºåˆ—è¡¨ä¸­å…ƒç´ çš„ä¸ªæ•°ï¼Œå› ä¸ºéœ€è¦ç§»åŠ¨åç»­çš„å…ƒç´ ã€‚ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ArrayListRemoveExample</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        List&lt;Integer&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        list.add(<span class="number">1</span>);</span><br><span class="line">        list.add(<span class="number">2</span>);</span><br><span class="line">        list.add(<span class="number">3</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åˆ é™¤ä¸‹æ ‡ä¸º1çš„å…ƒç´ </span></span><br><span class="line">        list.remove(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        System.out.println(list);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>LinkedList</code>çš„<code>remove(int index)</code>æ–¹æ³•ä¹Ÿå¯ä»¥ç”¨æ¥åˆ é™¤æŒ‡å®šä¸‹æ ‡çš„å…ƒç´ ã€‚<strong>å®ƒéœ€è¦å…ˆéå†åˆ°æŒ‡å®šä¸‹æ ‡ä½ç½®ï¼Œç„¶åä¿®æ”¹é“¾è¡¨çš„æŒ‡é’ˆæ¥åˆ é™¤å…ƒç´ ã€‚</strong>æ—¶é—´å¤æ‚åº¦ä¸º O (n)ï¼Œn ä¸ºè¦åˆ é™¤å…ƒç´ çš„ä¸‹æ ‡ã€‚ä¸è¿‡ï¼Œå¦‚æœå·²çŸ¥è¦åˆ é™¤çš„å…ƒç´ æ˜¯é“¾è¡¨çš„å¤´èŠ‚ç‚¹æˆ–å°¾èŠ‚ç‚¹ï¼Œå¯ä»¥ç›´æ¥é€šè¿‡ä¿®æ”¹å¤´æŒ‡é’ˆæˆ–å°¾æŒ‡é’ˆæ¥å®ç°åˆ é™¤ï¼Œæ—¶é—´å¤æ‚åº¦ä¸º O (1)ã€‚ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.LinkedList;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LinkedListRemoveExample</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        List&lt;Integer&gt; list = <span class="keyword">new</span> <span class="title class_">LinkedList</span>&lt;&gt;();</span><br><span class="line">        list.add(<span class="number">1</span>);</span><br><span class="line">        list.add(<span class="number">2</span>);</span><br><span class="line">        list.add(<span class="number">3</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åˆ é™¤ä¸‹æ ‡ä¸º1çš„å…ƒç´ </span></span><br><span class="line">        list.remove(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        System.out.println(list);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>copyOnWriteArrayList</code>çš„<code>remove</code>æ–¹æ³•åŒæ ·å¯ä»¥åˆ é™¤æŒ‡å®šä¸‹æ ‡çš„å…ƒç´ ã€‚ç”±äº<code>CopyOnWriteArrayList</code>åœ¨å†™æ“ä½œæ—¶ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„æ•°ç»„ï¼Œ<strong>æ‰€ä»¥åˆ é™¤æ“ä½œçš„æ—¶é—´å¤æ‚åº¦å–å†³äºæ•°ç»„çš„å¤åˆ¶é€Ÿåº¦ï¼Œé€šå¸¸ä¸º O (n)</strong>ï¼Œn ä¸ºæ•°ç»„çš„é•¿åº¦ã€‚ä½†åœ¨å¹¶å‘ç¯å¢ƒä¸‹ï¼Œå®ƒçš„åˆ é™¤æ“ä½œä¸ä¼šå½±å“è¯»æ“ä½œï¼Œå…·æœ‰è¾ƒå¥½çš„å¹¶å‘æ€§èƒ½ã€‚ç¤ºä¾‹ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.concurrent.CopyOnWriteArrayList;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CopyOnWriteArrayListRemoveExample</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        CopyOnWriteArrayList&lt;Integer&gt; list = <span class="keyword">new</span> <span class="title class_">CopyOnWriteArrayList</span>&lt;&gt;();</span><br><span class="line">        list.add(<span class="number">1</span>);</span><br><span class="line">        list.add(<span class="number">2</span>);</span><br><span class="line">        list.add(<span class="number">3</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åˆ é™¤ä¸‹æ ‡ä¸º1çš„å…ƒç´ </span></span><br><span class="line">        list.remove(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        System.out.println(list);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="4-Arraylistå’ŒLinkedListçš„åŒºåˆ«ï¼Œå“ªä¸ªé›†åˆæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Ÿ"><a href="#4-Arraylistå’ŒLinkedListçš„åŒºåˆ«ï¼Œå“ªä¸ªé›†åˆæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Ÿ" class="headerlink" title="4.Arraylistå’ŒLinkedListçš„åŒºåˆ«ï¼Œå“ªä¸ªé›†åˆæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Ÿ"></a>4.Arraylistå’ŒLinkedListçš„åŒºåˆ«ï¼Œå“ªä¸ªé›†åˆæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Ÿ</h2><p>ArrayListå’ŒLinkedListéƒ½æ˜¯Javaä¸­å¸¸è§çš„é›†åˆç±»ï¼Œå®ƒä»¬éƒ½å®ç°äº†Listæ¥å£ã€‚</p><ul><li><strong>åº•å±‚æ•°æ®ç»“æ„ä¸åŒ</strong>ï¼šArrayListä½¿ç”¨<strong>æ•°ç»„</strong>å®ç°ï¼Œé€šè¿‡ç´¢å¼•è¿›è¡Œå¿«é€Ÿè®¿é—®å…ƒç´ ã€‚LinkedListä½¿ç”¨<strong>é“¾è¡¨</strong>å®ç°ï¼Œé€šè¿‡èŠ‚ç‚¹ä¹‹é—´çš„æŒ‡é’ˆè¿›è¡Œå…ƒç´ çš„è®¿é—®å’Œæ“ä½œã€‚</li><li><strong>æ’å…¥å’Œåˆ é™¤æ“ä½œçš„æ•ˆç‡ä¸åŒ</strong>ï¼šArrayList<strong>åœ¨å°¾éƒ¨çš„æ’å…¥å’Œåˆ é™¤æ“ä½œæ•ˆç‡è¾ƒé«˜ï¼Œä½†åœ¨ä¸­é—´æˆ–å¼€å¤´çš„æ’å…¥å’Œåˆ é™¤æ“ä½œæ•ˆç‡è¾ƒä½</strong>ï¼Œéœ€è¦ç§»åŠ¨å…ƒç´ ã€‚<strong>LinkedListåœ¨ä»»æ„ä½ç½®çš„æ’å…¥å’Œåˆ é™¤æ“ä½œæ•ˆç‡éƒ½æ¯”è¾ƒé«˜</strong>ï¼Œå› ä¸ºåªéœ€è¦è°ƒæ•´èŠ‚ç‚¹ä¹‹é—´çš„æŒ‡é’ˆï¼Œä½†æ˜¯LinkedListæ˜¯<strong>ä¸æ”¯æŒéšæœºè®¿é—®çš„</strong>ï¼Œæ‰€ä»¥é™¤äº†å¤´ç»“ç‚¹å¤–æ’å…¥å’Œåˆ é™¤çš„æ—¶é—´å¤æ‚åº¦éƒ½æ˜¯0(n)ï¼Œæ•ˆç‡ä¹Ÿä¸æ˜¯å¾ˆé«˜æ‰€ä»¥LinkedListåŸºæœ¬æ²¡äººç”¨ã€‚</li><li><strong>éšæœºè®¿é—®çš„æ•ˆç‡ä¸åŒ</strong>ï¼šArrayList<strong>æ”¯æŒé€šè¿‡ç´¢å¼•è¿›è¡Œå¿«é€Ÿéšæœºè®¿é—®</strong>ï¼Œæ—¶é—´å¤æ‚åº¦ä¸ºO(1)ã€‚LinkedListéœ€è¦ä»å¤´æˆ–å°¾å¼€å§‹éå†é“¾è¡¨ï¼Œæ—¶é—´å¤æ‚åº¦ä¸ºO(n)ã€‚</li><li><strong>ç©ºé—´å ç”¨</strong>ï¼šArrayListåœ¨åˆ›å»ºæ—¶éœ€è¦<strong>åˆ†é…ä¸€æ®µè¿ç»­çš„å†…å­˜ç©ºé—´ï¼Œå› æ­¤ä¼šå ç”¨è¾ƒå¤§çš„ç©º</strong>é—´ã€‚LinkedListæ¯ä¸ªèŠ‚ç‚¹åªéœ€è¦å­˜å‚¨å…ƒç´ å’ŒæŒ‡é’ˆï¼Œå› æ­¤ç›¸å¯¹è¾ƒå°ã€‚</li><li><strong>ä½¿ç”¨åœºæ™¯</strong>ï¼š<strong>ArrayListé€‚ç”¨äºé¢‘ç¹éšæœºè®¿é—®å’Œå°¾éƒ¨çš„æ’å…¥åˆ é™¤æ“ä½œï¼Œè€ŒLinkedListé€‚ç”¨äºé¢‘ç¹çš„ä¸­é—´æ’å…¥åˆ é™¤æ“ä½œå’Œä¸éœ€è¦éšæœºè®¿é—®çš„åœºæ™¯ã€‚</strong></li><li><strong>çº¿ç¨‹å®‰å…¨</strong>ï¼šè¿™ä¸¤ä¸ªé›†åˆ<strong>éƒ½ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„</strong>ï¼ŒVectoræ˜¯çº¿ç¨‹å®‰å…¨çš„</li></ul><h2 id="5-ArrayListçº¿ç¨‹å®‰å…¨å—ï¼ŸæŠŠArrayListå˜æˆçº¿ç¨‹å®‰å…¨æœ‰å“ªäº›æ–¹æ³•ï¼Ÿ"><a href="#5-ArrayListçº¿ç¨‹å®‰å…¨å—ï¼ŸæŠŠArrayListå˜æˆçº¿ç¨‹å®‰å…¨æœ‰å“ªäº›æ–¹æ³•ï¼Ÿ" class="headerlink" title="5.ArrayListçº¿ç¨‹å®‰å…¨å—ï¼ŸæŠŠArrayListå˜æˆçº¿ç¨‹å®‰å…¨æœ‰å“ªäº›æ–¹æ³•ï¼Ÿ"></a>5.ArrayListçº¿ç¨‹å®‰å…¨å—ï¼ŸæŠŠArrayListå˜æˆçº¿ç¨‹å®‰å…¨æœ‰å“ªäº›æ–¹æ³•ï¼Ÿ</h2><p>ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼ŒArrayListå˜æˆçº¿ç¨‹å®‰å…¨çš„æ–¹å¼æœ‰ï¼š</p><ul><li>ä½¿ç”¨Collectionsç±»çš„synchronizedListæ–¹æ³•å°†ArrayListåŒ…è£…æˆçº¿ç¨‹å®‰å…¨çš„Listï¼š</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;String&gt; synchronizedList = Collections.synchronizedList(arrayList);</span><br></pre></td></tr></table></figure><ul><li>ä½¿ç”¨CopyOnWriteArrayListç±»ä»£æ›¿ArrayListï¼Œå®ƒæ˜¯ä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„Listå®ç°ï¼š</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CopyOnWriteArrayList&lt;String&gt; copyOnWriteArrayList = <span class="keyword">new</span> <span class="title class_">CopyOnWriteArrayList</span>&lt;&gt;(arrayList);</span><br></pre></td></tr></table></figure><ul><li>ä½¿ç”¨Vectorç±»ä»£æ›¿ArrayListï¼ŒVectoræ˜¯çº¿ç¨‹å®‰å…¨çš„Listå®ç°ï¼š</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Vector&lt;String&gt; vector = <span class="keyword">new</span> <span class="title class_">Vector</span>&lt;&gt;(arrayList);</span><br></pre></td></tr></table></figure><h2 id="6-çº¿ç¨‹å®‰å…¨çš„-Listï¼Œ-CopyonWriteArraylistæ˜¯å¦‚ä½•å®ç°çº¿ç¨‹å®‰å…¨çš„"><a href="#6-çº¿ç¨‹å®‰å…¨çš„-Listï¼Œ-CopyonWriteArraylistæ˜¯å¦‚ä½•å®ç°çº¿ç¨‹å®‰å…¨çš„" class="headerlink" title="6.çº¿ç¨‹å®‰å…¨çš„ Listï¼Œ CopyonWriteArraylistæ˜¯å¦‚ä½•å®ç°çº¿ç¨‹å®‰å…¨çš„"></a>6.çº¿ç¨‹å®‰å…¨çš„ Listï¼Œ CopyonWriteArraylistæ˜¯å¦‚ä½•å®ç°çº¿ç¨‹å®‰å…¨çš„</h2><p>CopyOnWriteArrayListåº•å±‚ä¹Ÿæ˜¯<strong>é€šè¿‡ä¸€ä¸ªæ•°ç»„ä¿å­˜æ•°æ®ï¼Œä½¿ç”¨volatileå…³é”®å­—ä¿®é¥°æ•°ç»„ï¼Œä¿è¯å½“å‰çº¿ç¨‹å¯¹æ•°ç»„å¯¹è±¡é‡æ–°èµ‹å€¼åï¼Œå…¶ä»–çº¿ç¨‹å¯ä»¥åŠæ—¶æ„ŸçŸ¥åˆ°ã€‚</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">transient</span> <span class="keyword">volatile</span> Object[] array;</span><br></pre></td></tr></table></figure><p><strong>åœ¨å†™å…¥æ“ä½œæ—¶ï¼ŒåŠ äº†ä¸€æŠŠäº’æ–¥é”ReentrantLockä»¥ä¿è¯çº¿ç¨‹å®‰å…¨ã€‚</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">add</span><span class="params">(E e)</span> &#123;</span><br><span class="line">    <span class="comment">//è·å–é”</span></span><br><span class="line">    <span class="keyword">final</span> <span class="type">ReentrantLock</span> <span class="variable">lock</span> <span class="operator">=</span> <span class="built_in">this</span>.lock;</span><br><span class="line">    <span class="comment">//åŠ é”</span></span><br><span class="line">    lock.lock();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">//è·å–åˆ°å½“å‰Listé›†åˆä¿å­˜æ•°æ®çš„æ•°ç»„</span></span><br><span class="line">        Object[] elements = getArray();</span><br><span class="line">        <span class="comment">//è·å–è¯¥æ•°ç»„çš„é•¿åº¦ï¼ˆè¿™æ˜¯ä¸€ä¸ªä¼ç¬”ï¼ŒåŒæ—¶lenä¹Ÿæ˜¯æ–°æ•°ç»„çš„æœ€åä¸€ä¸ªå…ƒç´ çš„ç´¢å¼•å€¼ï¼‰</span></span><br><span class="line">        <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> elements.length;</span><br><span class="line">        <span class="comment">//å°†å½“å‰æ•°ç»„æ‹·è´ä¸€ä»½çš„åŒæ—¶ï¼Œè®©å…¶é•¿åº¦åŠ 1</span></span><br><span class="line">        Object[] newElements = Arrays.copyOf(elements, len + <span class="number">1</span>);</span><br><span class="line">        <span class="comment">//å°†åŠ å…¥çš„å…ƒç´ æ”¾åœ¨æ–°æ•°ç»„æœ€åä¸€ä½ï¼Œlenä¸æ˜¯æ—§æ•°ç»„é•¿åº¦å—ï¼Œä¸ºä»€ä¹ˆç°åœ¨ç”¨å®ƒå½“æˆæ–°æ•°ç»„çš„æœ€åä¸€ä¸ªå…ƒç´ çš„ä¸‹æ ‡ï¼Ÿå»ºè®®è‡ªè¡Œç”»å›¾æ¨æ¼”ï¼Œå°±å¾ˆå®¹æ˜“ç†è§£ã€‚</span></span><br><span class="line">        newElements[len] = e;</span><br><span class="line">        <span class="comment">//æ›¿æ¢å¼•ç”¨ï¼Œå°†æ•°ç»„çš„å¼•ç”¨æŒ‡å‘ç»™æ–°æ•°ç»„çš„åœ°å€</span></span><br><span class="line">        setArray(newElements);</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="comment">//é‡Šæ”¾é”</span></span><br><span class="line">        lock.unlock();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>çœ‹åˆ°æºç å¯ä»¥çŸ¥é“å†™å…¥æ–°å…ƒç´ æ—¶ï¼Œé¦–å…ˆ<strong>ä¼šå…ˆå°†åŸæ¥çš„æ•°ç»„æ‹·è´ä¸€ä»½å¹¶ä¸”è®©åŸæ¥æ•°ç»„çš„é•¿åº¦+1åå°±å¾—åˆ°äº†ä¸€ä¸ªæ–°æ•°ç»„ï¼Œæ–°æ•°ç»„é‡Œçš„å…ƒç´ å’Œæ—§æ•°ç»„çš„å…ƒç´ ä¸€æ ·å¹¶ä¸”é•¿åº¦æ¯”æ—§æ•°ç»„å¤šä¸€ä¸ªé•¿åº¦ï¼Œç„¶åå°†æ–°åŠ å…¥çš„å…ƒç´ æ”¾ç½®éƒ½åœ¨æ–°æ•°ç»„æœ€åä¸€ä¸ªä½ç½®åï¼Œç”¨æ–°æ•°ç»„çš„åœ°å€æ›¿æ¢æ‰è€æ•°ç»„çš„åœ°å€å°±èƒ½å¾—åˆ°æœ€æ–°çš„æ•°æ®äº†ã€‚</strong></p><p>åœ¨æˆ‘ä»¬æ‰§è¡Œæ›¿æ¢åœ°å€æ“ä½œä¹‹å‰ï¼Œè¯»å–çš„æ˜¯è€æ•°ç»„çš„æ•°æ®ï¼Œæ•°æ®æ˜¯æœ‰æ•ˆæ•°æ®ï¼›æ‰§è¡Œæ›¿æ¢åœ°å€æ“ä½œä¹‹åï¼Œè¯»å–çš„æ˜¯æ–°æ•°ç»„çš„æ•°æ®ï¼ŒåŒæ ·ä¹Ÿæ˜¯æœ‰æ•ˆæ•°æ®ï¼Œè€Œä¸”ä½¿ç”¨è¯¥æ–¹å¼èƒ½æ¯”è¯»å†™éƒ½åŠ é”è¦æ›´åŠ çš„æ•ˆç‡ã€‚</p><p>ç°åœ¨æˆ‘ä»¬æ¥çœ‹è¯»æ“ä½œï¼Œè¯»æ˜¯æ²¡æœ‰åŠ é”çš„ï¼Œæ‰€ä»¥è¯»æ˜¯ä¸€ç›´éƒ½èƒ½è¯»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> E <span class="title function_">get</span><span class="params">(<span class="type">int</span> index)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> get(getArray(), index);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="7-ä¸ºä»€ä¹ˆArrayListä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå…·ä½“æ¥è¯´æ˜¯å“ªé‡Œä¸å®‰å…¨ï¼Ÿ"><a href="#7-ä¸ºä»€ä¹ˆArrayListä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå…·ä½“æ¥è¯´æ˜¯å“ªé‡Œä¸å®‰å…¨ï¼Ÿ" class="headerlink" title="7.ä¸ºä»€ä¹ˆArrayListä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå…·ä½“æ¥è¯´æ˜¯å“ªé‡Œä¸å®‰å…¨ï¼Ÿ"></a>7.ä¸ºä»€ä¹ˆArrayListä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå…·ä½“æ¥è¯´æ˜¯å“ªé‡Œä¸å®‰å…¨ï¼Ÿ</h2><p>åœ¨é«˜å¹¶å‘æ·»åŠ æ•°æ®ä¸‹ï¼ŒArrayListä¼šæš´éœ²ä¸‰ä¸ªé—®é¢˜;</p><ul><li>éƒ¨åˆ†å€¼ä¸ºnullï¼ˆæˆ‘ä»¬å¹¶æ²¡æœ‰add nullè¿›å»ï¼‰</li><li>ç´¢å¼•è¶Šç•Œå¼‚å¸¸</li><li>sizeä¸æˆ‘ä»¬addçš„æ•°é‡ä¸ç¬¦</li></ul><p>ä¸ºäº†çŸ¥é“è¿™ä¸‰ç§æƒ…å†µæ˜¯æ€ä¹ˆå‘ç”Ÿçš„ï¼ŒArrayListï¼Œadd å¢åŠ å…ƒç´ çš„ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">add</span><span class="params">(E e)</span> &#123;</span><br><span class="line">        ensureCapacityInternal(size + <span class="number">1</span>);  <span class="comment">// Increments modCount!!</span></span><br><span class="line">        elementData[size++] = e;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>ensureCapacityInternal()è¿™ä¸ªæ–¹æ³•çš„è¯¦ç»†ä»£ç æˆ‘ä»¬å¯ä»¥æš‚æ—¶ä¸çœ‹ï¼Œå®ƒçš„ä½œç”¨å°±æ˜¯åˆ¤æ–­å¦‚æœå°†å½“å‰çš„æ–°å…ƒç´ åŠ åˆ°åˆ—è¡¨åé¢ï¼Œåˆ—è¡¨çš„elementDataæ•°ç»„çš„å¤§å°æ˜¯å¦æ»¡è¶³ï¼Œå¦‚æœsize + 1çš„è¿™ä¸ªéœ€æ±‚é•¿åº¦å¤§äºäº†elementDataè¿™ä¸ªæ•°ç»„çš„é•¿åº¦ï¼Œé‚£ä¹ˆå°±è¦å¯¹è¿™ä¸ªæ•°ç»„è¿›è¡Œæ‰©å®¹ã€‚</p><p>å¤§ä½“å¯ä»¥åˆ†ä¸ºä¸‰æ­¥ï¼š</p><ul><li>åˆ¤æ–­æ•°ç»„éœ€ä¸éœ€è¦æ‰©å®¹ï¼Œå¦‚æœéœ€è¦çš„è¯ï¼Œè°ƒç”¨growæ–¹æ³•è¿›è¡Œæ‰©å®¹ï¼›</li><li>å°†æ•°ç»„çš„sizeä½ç½®è®¾ç½®å€¼ï¼ˆå› ä¸ºæ•°ç»„çš„ä¸‹æ ‡æ˜¯ä»0å¼€å§‹çš„ï¼‰ï¼›</li><li>å°†å½“å‰é›†åˆçš„å¤§å°åŠ 1</li></ul><p>ä¸‹é¢æˆ‘ä»¬æ¥åˆ†æä¸‰ç§æƒ…å†µéƒ½æ˜¯å¦‚ä½•äº§ç”Ÿçš„ï¼š</p><ul><li>éƒ¨åˆ†å€¼ä¸ºnullï¼šå½“çº¿ç¨‹1èµ°åˆ°äº†æ‰©å®¹é‚£é‡Œå‘ç°å½“å‰sizeæ˜¯9ï¼Œè€Œæ•°ç»„å®¹é‡æ˜¯10ï¼Œæ‰€ä»¥ä¸ç”¨æ‰©å®¹ï¼Œè¿™æ—¶å€™cpuè®©å‡ºæ‰§è¡Œæƒï¼Œçº¿ç¨‹2ä¹Ÿè¿›æ¥äº†ï¼Œå‘ç°sizeæ˜¯9ï¼Œè€Œæ•°ç»„å®¹é‡æ˜¯10ï¼Œæ‰€ä»¥ä¸ç”¨æ‰©å®¹ï¼Œè¿™æ—¶å€™çº¿ç¨‹1ç»§ç»­æ‰§è¡Œï¼Œå°†æ•°ç»„ä¸‹æ ‡ç´¢å¼•ä¸º9çš„ä½ç½®setå€¼äº†ï¼Œè¿˜æ²¡æœ‰æ¥å¾—åŠæ‰§è¡Œsize++ï¼Œè¿™æ—¶å€™çº¿ç¨‹2ä¹Ÿæ¥æ‰§è¡Œäº†ï¼ŒåˆæŠŠæ•°ç»„ä¸‹æ ‡ç´¢å¼•ä¸º9çš„ä½ç½®setäº†ä¸€éï¼Œè¿™æ—¶å€™ä¸¤ä¸ªå…ˆåè¿›è¡Œsize++ï¼Œå¯¼è‡´ä¸‹æ ‡ç´¢å¼•10çš„åœ°æ–¹å°±ä¸ºnulläº†ã€‚</li><li>ç´¢å¼•è¶Šç•Œå¼‚å¸¸ï¼šçº¿ç¨‹1èµ°åˆ°æ‰©å®¹é‚£é‡Œå‘ç°å½“å‰sizeæ˜¯9ï¼Œæ•°ç»„å®¹é‡æ˜¯10ä¸ç”¨æ‰©å®¹ï¼Œcpuè®©å‡ºæ‰§è¡Œæƒï¼Œçº¿ç¨‹2ä¹Ÿå‘ç°ä¸ç”¨æ‰©å®¹ï¼Œè¿™æ—¶å€™æ•°ç»„çš„å®¹é‡å°±æ˜¯10ï¼Œè€Œçº¿ç¨‹1 setå®Œä¹‹åsize++ï¼Œè¿™æ—¶å€™çº¿ç¨‹2å†è¿›æ¥sizeå°±æ˜¯10ï¼Œæ•°ç»„çš„å¤§å°åªæœ‰10ï¼Œè€Œä½ è¦è®¾ç½®ä¸‹æ ‡ç´¢å¼•ä¸º10çš„å°±ä¼šè¶Šç•Œï¼ˆæ•°ç»„çš„ä¸‹æ ‡ç´¢å¼•ä»0å¼€å§‹ï¼‰ï¼›</li><li>sizeä¸æˆ‘ä»¬addçš„æ•°é‡ä¸ç¬¦ï¼šè¿™ä¸ªåŸºæœ¬ä¸Šæ¯æ¬¡éƒ½ä¼šå‘ç”Ÿï¼Œè¿™ä¸ªç†è§£èµ·æ¥ä¹Ÿå¾ˆç®€å•ï¼Œå› ä¸ºsize++æœ¬èº«å°±ä¸æ˜¯åŸå­æ“ä½œï¼Œå¯ä»¥åˆ†ä¸ºä¸‰æ­¥ï¼šè·å–sizeçš„å€¼ï¼Œå°†sizeçš„å€¼åŠ 1ï¼Œå°†æ–°çš„sizeå€¼è¦†ç›–æ‰åŸæ¥çš„ï¼Œçº¿ç¨‹1å’Œçº¿ç¨‹2æ‹¿åˆ°ä¸€æ ·çš„sizeå€¼åŠ å®Œäº†åŒæ—¶è¦†ç›–ï¼Œå°±ä¼šå¯¼è‡´ä¸€æ¬¡æ²¡æœ‰åŠ ä¸Šï¼Œæ‰€ä»¥è‚¯å®šä¸ä¼šä¸æˆ‘ä»¬addçš„æ•°é‡ä¿æŒä¸€è‡´çš„ï¼›</li><li></li></ul><h2 id="8-ArrayListçš„æ‰©å®¹æœºåˆ¶è¯´ä¸€ä¸‹"><a href="#8-ArrayListçš„æ‰©å®¹æœºåˆ¶è¯´ä¸€ä¸‹" class="headerlink" title="8.ArrayListçš„æ‰©å®¹æœºåˆ¶è¯´ä¸€ä¸‹"></a>8.ArrayListçš„æ‰©å®¹æœºåˆ¶è¯´ä¸€ä¸‹</h2><p>ArrayListåœ¨æ·»åŠ å…ƒç´ æ—¶ï¼Œå¦‚æœå½“å‰å…ƒç´ ä¸ªæ•°å·²ç»è¾¾åˆ°äº†å†…éƒ¨æ•°ç»„çš„å®¹é‡ä¸Šé™ï¼Œå°±ä¼šè§¦å‘æ‰©å®¹æ“ä½œã€‚ArrayListçš„æ‰©å®¹æ“ä½œä¸»è¦åŒ…æ‹¬ä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š</p><ul><li>è®¡ç®—æ–°çš„å®¹é‡ï¼šä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæ–°çš„å®¹é‡ä¼šæ‰©å¤§ä¸ºåŸå®¹é‡çš„1.5å€ï¼ˆåœ¨JDK 10ä¹‹åï¼Œæ‰©å®¹ç­–ç•¥åšäº†è°ƒæ•´ï¼‰ï¼Œç„¶åæ£€æŸ¥æ˜¯å¦è¶…è¿‡äº†æœ€å¤§å®¹é‡é™åˆ¶ã€‚</li><li>åˆ›å»ºæ–°çš„æ•°ç»„ï¼šæ ¹æ®è®¡ç®—å¾—åˆ°çš„æ–°å®¹é‡ï¼Œåˆ›å»ºä¸€ä¸ªæ–°çš„æ›´å¤§çš„æ•°ç»„ã€‚</li><li>å°†å…ƒç´ å¤åˆ¶ï¼šå°†åŸæ¥æ•°ç»„ä¸­çš„å…ƒç´ é€ä¸ªå¤åˆ¶åˆ°æ–°æ•°ç»„ä¸­ã€‚</li><li>æ›´æ–°å¼•ç”¨ï¼šå°†ArrayListå†…éƒ¨æŒ‡å‘åŸæ•°ç»„çš„å¼•ç”¨æŒ‡å‘æ–°æ•°ç»„ã€‚</li><li>å®Œæˆæ‰©å®¹ï¼šæ‰©å®¹å®Œæˆåï¼Œå¯ä»¥ç»§ç»­æ·»åŠ æ–°å…ƒç´ ã€‚</li></ul><p>ArrayListçš„æ‰©å®¹æ“ä½œæ¶‰åŠåˆ°æ•°ç»„çš„å¤åˆ¶å’Œå†…å­˜çš„é‡æ–°åˆ†é…ï¼Œæ‰€ä»¥åœ¨é¢‘ç¹æ·»åŠ å¤§é‡å…ƒç´ æ—¶ï¼Œæ‰©å®¹æ“ä½œå¯èƒ½ä¼šå½±å“æ€§èƒ½ã€‚ä¸ºäº†å‡å°‘æ‰©å®¹å¸¦æ¥çš„æ€§èƒ½æŸè€—ï¼Œå¯ä»¥åœ¨åˆå§‹åŒ–ArrayListæ—¶é¢„åˆ†é…è¶³å¤Ÿå¤§çš„å®¹é‡ï¼Œé¿å…é¢‘ç¹è§¦å‘æ‰©å®¹æ“ä½œã€‚</p><p>ä¹‹æ‰€ä»¥æ‰©å®¹æ˜¯ 1.5 å€ï¼Œæ˜¯å› ä¸º <strong>1.5 å¯ä»¥å……åˆ†åˆ©ç”¨ç§»ä½æ“ä½œï¼Œå‡å°‘æµ®ç‚¹æ•°æˆ–è€…è¿ç®—æ—¶é—´å’Œè¿ç®—æ¬¡æ•°ã€‚</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ–°å®¹é‡è®¡ç®—</span></span><br><span class="line"><span class="type">int</span> <span class="variable">newCapacity</span> <span class="operator">=</span> oldCapacity + (oldCapacity &gt;&gt; <span class="number">1</span>);</span><br></pre></td></tr></table></figure><h2 id="9-arratlistçš„å°¾æ’æ³•ï¼Œä¸ºä»€ä¹ˆè¦ç”¨æ¢å°¾æ’æ³•"><a href="#9-arratlistçš„å°¾æ’æ³•ï¼Œä¸ºä»€ä¹ˆè¦ç”¨æ¢å°¾æ’æ³•" class="headerlink" title="9.arratlistçš„å°¾æ’æ³•ï¼Œä¸ºä»€ä¹ˆè¦ç”¨æ¢å°¾æ’æ³•"></a>9.arratlistçš„å°¾æ’æ³•ï¼Œä¸ºä»€ä¹ˆè¦ç”¨æ¢å°¾æ’æ³•</h2><p>é€šå¸¸æ¨èä½¿ç”¨å°¾æ’æ³•</p><p>å¤´æ’æ³•ï¼š</p><p>æ¯æ¬¡æ’å…¥éƒ½éœ€è¦å°†<strong>æ‰€æœ‰å·²æœ‰å…ƒç´ æ•´ä½“åç§»ä¸€ä½</strong>ã€‚</p><p>æ—¶é—´å¤æ‚åº¦ï¼š<code>O(n)</code>ï¼Œn ä¸ºå½“å‰å…ƒç´ æ•°é‡ã€‚</p><p>å°¾æ’æ³•ï¼š</p><p>ç›´æ¥æ’å…¥åˆ°æ•°ç»„æœ«å°¾ï¼Œæ— éœ€ç§»åŠ¨å…ƒç´ ã€‚</p><p>æ—¶é—´å¤æ‚åº¦ï¼š<code>O(1)</code>ï¼ˆæ‘Šè¿˜ï¼‰ï¼Œåªåœ¨æ‰©å®¹æ—¶éœ€è¦é‡æ–°åˆ†é…æ•°ç»„å¹¶æ‹·è´æ•°æ®ï¼Œå…¶ä»–æƒ…å†µä¸ºå¸¸æ•°æ—¶é—´ã€‚</p><p>âœ… <strong>æ€§èƒ½æ›´é«˜</strong>ï¼š</p><ul><li>å°¾æ’æ³•ä¸ä¼šé¢‘ç¹ç§»åŠ¨å…ƒç´ ï¼Œå°¤å…¶æ˜¯æ•°æ®é‡å¤§æ—¶ï¼Œæ€§èƒ½å·®è·æ˜æ˜¾ã€‚</li><li>å¤´æ’æ³•æ¯æ¬¡æ’å…¥éƒ½è¦æ•´ä½“ç§»åŠ¨ï¼Œæ•ˆç‡ä½ä¸‹ã€‚</li></ul><p>âœ… <strong>å‡å°‘å†…å­˜æ‹·è´å¼€é”€</strong>ï¼š</p><ul><li>å°¾æ’æ³•åªåœ¨æ‰©å®¹æ—¶æ‰æ•´ä½“æ‹·è´æ•°ç»„ã€‚</li><li>å¤´æ’æ³•<strong>æ¯æ¬¡æ’å…¥éƒ½åœ¨è§¦å‘æ‹·è´</strong>ï¼ˆä½ç½®åç§»ï¼‰ï¼Œæµªè´¹ CPU æ—¶é—´å’Œå†…å­˜å¸¦å®½ã€‚</li></ul><p>âœ… <strong>ç¬¦åˆ <code>ArrayList</code> çš„è®¾è®¡ç‰¹ç‚¹</strong>ï¼š</p><ul><li><code>ArrayList</code> æœ¬è´¨æ˜¯ä¸€ä¸ª<strong>åŠ¨æ€æ•°ç»„</strong>ï¼Œä¸é€‚åˆé¢‘ç¹ä»å¤´éƒ¨æ’å…¥æˆ–åˆ é™¤ã€‚</li></ul><h1 id="MAP"><a href="#MAP" class="headerlink" title="MAP"></a>MAP</h1><h2 id="1-hashmapçš„keyå¯ä»¥é‡å¤å—ï¼Ÿå¦‚æœä¸èƒ½é‡å¤è¯´å‡ºä»–çš„åŸå› ã€‚"><a href="#1-hashmapçš„keyå¯ä»¥é‡å¤å—ï¼Ÿå¦‚æœä¸èƒ½é‡å¤è¯´å‡ºä»–çš„åŸå› ã€‚" class="headerlink" title="1.hashmapçš„keyå¯ä»¥é‡å¤å—ï¼Ÿå¦‚æœä¸èƒ½é‡å¤è¯´å‡ºä»–çš„åŸå› ã€‚"></a>1.hashmapçš„keyå¯ä»¥é‡å¤å—ï¼Ÿå¦‚æœä¸èƒ½é‡å¤è¯´å‡ºä»–çš„åŸå› ã€‚</h2><p>HashMapçš„<strong>keyä¸å…è®¸é‡å¤ï¼Œ</strong>å½“ä½ å°è¯•ä½¿ç”¨å·²å­˜åœ¨çš„é”®æ’å…¥æ–°å€¼æ—¶ï¼Œ<strong>ä¼šè¦†ç›–åŸæœ‰çš„å€¼</strong>ã€‚</p><p>HashMapåŸºäºå“ˆå¸Œè¡¨å®ç°ï¼Œæ¯ä¸ªé”®ï¼ˆkeyï¼‰é€šè¿‡å“ˆå¸Œå‡½æ•°è®¡ç®—å‡ºä¸€ä¸ªå”¯ä¸€çš„å“ˆå¸Œå€¼ï¼Œç”¨äºç¡®å®šå­˜å‚¨ä½ç½®ã€‚</p><p><code>HashMap</code> é€šè¿‡ <code>hashCode()</code> è®¡ç®—é”®çš„å“ˆå¸Œå€¼ï¼Œå†³å®šå…¶åœ¨æ•°ç»„ä¸­çš„ä½ç½®ï¼Œå¦‚æœä¸¤ä¸ªä¸åŒçš„é”®äº§ç”Ÿç›¸åŒå“ˆå¸Œå€¼ï¼ˆå“ˆå¸Œå†²çªï¼‰ï¼Œåˆ™é€šè¿‡ <code>equals()</code> æ–¹æ³•è¿›ä¸€æ­¥æ¯”è¾ƒé”®çš„å†…å®¹ï¼š</p><ul><li><strong>è‹¥</strong> <code>equals()</code> <strong>è¿”å›</strong> <code>true</code>ï¼šè§†ä¸ºåŒä¸€é”®ï¼Œæ–°å€¼è¦†ç›–æ—§å€¼ã€‚</li><li><strong>è‹¥</strong> <code>equals()</code> <strong>è¿”å›</strong> <code>false</code>ï¼šè§†ä¸ºä¸åŒé”®ï¼Œé€šè¿‡é“¾è¡¨æˆ–çº¢é»‘æ ‘å­˜å‚¨</li></ul><p>è§£å†³hashå†²çªçš„æ–¹æ³•æ˜¯<strong>é“¾åœ°å€æ³•</strong>ï¼Œé“¾è¡¨è¶…è¿‡ 8 è½¬çº¢é»‘æ ‘</p><p>ä¸ºä»€ä¹ˆä¸èƒ½é‡å¤çš„åŸå› ï¼š</p><ul><li><strong>å“ˆå¸Œè¡¨çš„åŸºæœ¬è¯­ä¹‰</strong>ï¼šå“ˆå¸Œè¡¨é€šè¿‡é”®å¿«é€Ÿå®šä½å€¼ï¼Œè‹¥é”®é‡å¤ä¼šå¯¼è‡´è¯­ä¹‰æ··ä¹±ã€‚</li><li><strong>æ•°æ®ä¸€è‡´æ€§</strong>ï¼šé¿å…åŒä¸€é”®å¯¹åº”å¤šä¸ªå€¼ï¼Œç¡®ä¿æ•°æ®çš„ç¡®å®šæ€§ã€‚</li><li><strong>ä¸šåŠ¡éœ€æ±‚</strong>ï¼šå¤§å¤šæ•°åœºæ™¯ä¸‹ï¼Œé”®ä½œä¸ºå”¯ä¸€æ ‡è¯†ï¼ˆå¦‚ç”¨æˆ· IDã€è®¢å•å·ï¼‰ï¼Œä¸å…è®¸é‡å¤ã€‚</li></ul><h2 id="2-å¦‚ä½•å¯¹mapè¿›è¡Œå¿«é€Ÿéå†ï¼Ÿ"><a href="#2-å¦‚ä½•å¯¹mapè¿›è¡Œå¿«é€Ÿéå†ï¼Ÿ" class="headerlink" title="2.å¦‚ä½•å¯¹mapè¿›è¡Œå¿«é€Ÿéå†ï¼Ÿ"></a>2.å¦‚ä½•å¯¹mapè¿›è¡Œå¿«é€Ÿéå†ï¼Ÿ</h2><ul><li>ä½¿ç”¨for-eachå¾ªç¯å’ŒentrySet()æ–¹æ³•ï¼šè¿™æ˜¯ä¸€ç§è¾ƒä¸ºå¸¸è§å’Œç®€æ´çš„éå†æ–¹å¼ï¼Œå®ƒå¯ä»¥åŒæ—¶è·å–<code>Map</code>ä¸­çš„é”®å’Œå€¼</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MapTraversalExample</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        Map&lt;String, Integer&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        map.put(<span class="string">&quot;key1&quot;</span>, <span class="number">1</span>);</span><br><span class="line">        map.put(<span class="string">&quot;key2&quot;</span>, <span class="number">2</span>);</span><br><span class="line">        map.put(<span class="string">&quot;key3&quot;</span>, <span class="number">3</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ä½¿ç”¨for-eachå¾ªç¯å’ŒentrySet()éå†Map</span></span><br><span class="line">        <span class="keyword">for</span> (Map.Entry&lt;String, Integer&gt; entry : map.entrySet()) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;Key: &quot;</span> + entry.getKey() + <span class="string">&quot;, Value: &quot;</span> + entry.getValue());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>ä½¿ç”¨for-eachå¾ªç¯å’ŒkeySet()æ–¹æ³•ï¼šå¦‚æœåªéœ€è¦éå†<code>Map</code>ä¸­çš„é”®ï¼Œå¯ä»¥ä½¿ç”¨<code>keySet()</code>æ–¹æ³•ï¼Œè¿™ç§æ–¹å¼ç›¸å¯¹ç®€å•ï¼Œæ€§èƒ½ä¹Ÿè¾ƒå¥½ã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MapTraversalExample</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        Map&lt;String, Integer&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        map.put(<span class="string">&quot;key1&quot;</span>, <span class="number">1</span>);</span><br><span class="line">        map.put(<span class="string">&quot;key2&quot;</span>, <span class="number">2</span>);</span><br><span class="line">        map.put(<span class="string">&quot;key3&quot;</span>, <span class="number">3</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ä½¿ç”¨for-eachå¾ªç¯å’ŒkeySet()éå†Mapçš„é”®</span></span><br><span class="line">        <span class="keyword">for</span> (String key : map.keySet()) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;Key: &quot;</span> + key + <span class="string">&quot;, Value: &quot;</span> + map.get(key));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>ä½¿ç”¨è¿­ä»£å™¨ï¼šé€šè¿‡è·å–Mapçš„entrySet()æˆ–keySet()çš„è¿­ä»£å™¨ï¼Œä¹Ÿå¯ä»¥å®ç°å¯¹Mapçš„éå†ï¼Œè¿™ç§æ–¹å¼åœ¨éœ€è¦<strong>åˆ é™¤å…ƒç´ </strong>ç­‰æ“ä½œæ—¶æ¯”è¾ƒæœ‰ç”¨ã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Iterator;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> java.util.Map.Entry;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MapTraversalExample</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        Map&lt;String, Integer&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        map.put(<span class="string">&quot;key1&quot;</span>, <span class="number">1</span>);</span><br><span class="line">        map.put(<span class="string">&quot;key2&quot;</span>, <span class="number">2</span>);</span><br><span class="line">        map.put(<span class="string">&quot;key3&quot;</span>, <span class="number">3</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ä½¿ç”¨è¿­ä»£å™¨éå†Map</span></span><br><span class="line">        Iterator&lt;Entry&lt;String, Integer&gt;&gt; iterator = map.entrySet().iterator();</span><br><span class="line">        <span class="keyword">while</span> (iterator.hasNext()) &#123;</span><br><span class="line">            Entry&lt;String, Integer&gt; entry = iterator.next();</span><br><span class="line">            System.out.println(<span class="string">&quot;Key: &quot;</span> + entry.getKey() + <span class="string">&quot;, Value: &quot;</span> + entry.getValue());</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>ä½¿ç”¨ Lambda è¡¨è¾¾å¼å’ŒforEach()æ–¹æ³•ï¼šåœ¨ Java 8 åŠä»¥ä¸Šç‰ˆæœ¬ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ Lambda è¡¨è¾¾å¼å’Œ<code>forEach()</code>æ–¹æ³•æ¥éå†<code>Map</code>ï¼Œè¿™ç§æ–¹å¼æ›´åŠ ç®€æ´å’Œå‡½æ•°å¼ã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MapTraversalExample</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        Map&lt;String, Integer&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        map.put(<span class="string">&quot;key1&quot;</span>, <span class="number">1</span>);</span><br><span class="line">        map.put(<span class="string">&quot;key2&quot;</span>, <span class="number">2</span>);</span><br><span class="line">        map.put(<span class="string">&quot;key3&quot;</span>, <span class="number">3</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ä½¿ç”¨Lambdaè¡¨è¾¾å¼å’ŒforEach()æ–¹æ³•éå†Map</span></span><br><span class="line">        map.forEach((key, value) -&gt; System.out.println(<span class="string">&quot;Key: &quot;</span> + key + <span class="string">&quot;, Value: &quot;</span> + value));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>ä½¿ç”¨Stream APIï¼šJava 8 å¼•å…¥çš„<code>Stream API</code>ä¹Ÿå¯ä»¥ç”¨äºéå†<code>Map</code>ï¼Œå¯ä»¥å°†<code>Map</code>è½¬æ¢ä¸ºæµï¼Œç„¶åè¿›è¡Œå„ç§æ“ä½œã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> java.util.stream.Collectors;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MapTraversalExample</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        Map&lt;String, Integer&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        map.put(<span class="string">&quot;key1&quot;</span>, <span class="number">1</span>);</span><br><span class="line">        map.put(<span class="string">&quot;key2&quot;</span>, <span class="number">2</span>);</span><br><span class="line">        map.put(<span class="string">&quot;key3&quot;</span>, <span class="number">3</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ä½¿ç”¨Stream APIéå†Map</span></span><br><span class="line">        map.entrySet().stream()</span><br><span class="line">          .forEach(entry -&gt; System.out.println(<span class="string">&quot;Key: &quot;</span> + entry.getKey() + <span class="string">&quot;, Value: &quot;</span> + entry.getValue()));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è¿˜å¯ä»¥è¿›è¡Œå…¶ä»–æ“ä½œï¼Œå¦‚è¿‡æ»¤ã€æ˜ å°„ç­‰</span></span><br><span class="line">        Map&lt;String, Integer&gt; filteredMap = map.entrySet().stream()</span><br><span class="line">                                            .filter(entry -&gt; entry.getValue() &gt; <span class="number">1</span>)</span><br><span class="line">                                            .collect(Collectors.toMap(Map.Entry::getKey, Map.Entry::getValue));</span><br><span class="line">        System.out.println(filteredMap);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="3-HashMapå®ç°åŸç†ä»‹ç»ä¸€ä¸‹ï¼Ÿ"><a href="#3-HashMapå®ç°åŸç†ä»‹ç»ä¸€ä¸‹ï¼Ÿ" class="headerlink" title="3.HashMapå®ç°åŸç†ä»‹ç»ä¸€ä¸‹ï¼Ÿ"></a>3.HashMapå®ç°åŸç†ä»‹ç»ä¸€ä¸‹ï¼Ÿ</h2><p>åœ¨ JDK 1.7 ç‰ˆæœ¬ä¹‹å‰ï¼Œ HashMap æ•°æ®ç»“æ„æ˜¯<strong>æ•°ç»„å’Œé“¾è¡¨</strong>ï¼ŒHashMapé€šè¿‡å“ˆå¸Œç®—æ³•å°†å…ƒç´ çš„é”®ï¼ˆKeyï¼‰æ˜ å°„åˆ°æ•°ç»„ä¸­çš„<strong>æ§½ä½ï¼ˆBucketï¼‰</strong>ã€‚<strong>å¦‚æœå¤šä¸ªé”®æ˜ å°„åˆ°åŒä¸€ä¸ªæ§½ä½ï¼Œå®ƒä»¬ä¼šä»¥é“¾è¡¨çš„å½¢å¼å­˜å‚¨åœ¨åŒä¸€ä¸ªæ§½ä½ä¸Šï¼Œ</strong>å› ä¸ºé“¾è¡¨çš„<strong>æŸ¥è¯¢æ—¶é—´æ˜¯O(n)</strong>ï¼Œæ‰€ä»¥å†²çªå¾ˆä¸¥é‡ï¼Œä¸€ä¸ªç´¢å¼•ä¸Šçš„é“¾è¡¨éå¸¸é•¿ï¼Œæ•ˆç‡å°±å¾ˆä½äº†ã€‚</p><p><img src="https://cdn.xiaolincoding.com//picgo/1719565480532-57a14329-c36b-4514-8e7d-2f2f1df88a82.webp" alt=""></p><p>æ‰€ä»¥åœ¨ <strong>JDK 1.8</strong> ç‰ˆæœ¬çš„æ—¶å€™åšäº†ä¼˜åŒ–ï¼Œå½“ä¸€ä¸ªé“¾è¡¨çš„é•¿åº¦è¶…è¿‡8çš„æ—¶å€™å°±è½¬æ¢æ•°æ®ç»“æ„ï¼Œä¸å†ä½¿ç”¨é“¾è¡¨å­˜å‚¨ï¼Œè€Œæ˜¯ä½¿ç”¨<strong>çº¢é»‘æ ‘</strong>ï¼ŒæŸ¥æ‰¾æ—¶ä½¿ç”¨çº¢é»‘æ ‘ï¼Œæ—¶é—´å¤æ‚åº¦Oï¼ˆlog nï¼‰ï¼Œå¯ä»¥æé«˜æŸ¥è¯¢æ€§èƒ½ï¼Œ<strong>ä½†æ˜¯åœ¨æ•°é‡è¾ƒå°‘æ—¶ï¼Œå³æ•°é‡å°äº6æ—¶ï¼Œä¼šå°†çº¢é»‘æ ‘è½¬æ¢å›é“¾è¡¨ã€‚</strong></p><p><img src="https://cdn.xiaolincoding.com//picgo/1719565481289-0c2164f4-f755-46e3-bb39-b5f28621bb6b.webp" alt=""></p><h2 id="4-äº†è§£çš„å“ˆå¸Œå†²çªè§£å†³æ–¹æ³•æœ‰å“ªäº›ï¼Ÿ"><a href="#4-äº†è§£çš„å“ˆå¸Œå†²çªè§£å†³æ–¹æ³•æœ‰å“ªäº›ï¼Ÿ" class="headerlink" title="4.äº†è§£çš„å“ˆå¸Œå†²çªè§£å†³æ–¹æ³•æœ‰å“ªäº›ï¼Ÿ"></a>4.äº†è§£çš„å“ˆå¸Œå†²çªè§£å†³æ–¹æ³•æœ‰å“ªäº›ï¼Ÿ</h2><ul><li><p>é“¾æ¥æ³•ï¼šä½¿ç”¨é“¾è¡¨æˆ–<strong>å…¶ä»–æ•°æ®ç»“æ„ï¼ˆçº¢é»‘æ ‘ï¼‰</strong>æ¥å­˜å‚¨å†²çªçš„é”®å€¼å¯¹ï¼Œå°†å®ƒä»¬é“¾æ¥åœ¨åŒä¸€ä¸ªå“ˆå¸Œæ¡¶ä¸­ã€‚</p><p>hashmapå°±ç”¨çš„è¿™ä¸ªæ–¹æ³•</p></li><li><p>å¼€æ”¾å¯»å€æ³•ï¼šåœ¨<strong>å“ˆå¸Œè¡¨ä¸­æ‰¾åˆ°å¦ä¸€ä¸ªå¯ç”¨çš„ä½ç½®æ¥å­˜å‚¨å†²çªçš„é”®å€¼å¯¹</strong>ï¼Œè€Œä¸æ˜¯å­˜å‚¨åœ¨é“¾è¡¨ä¸­ã€‚å¸¸è§çš„å¼€æ”¾å¯»å€æ–¹æ³•åŒ…æ‹¬çº¿æ€§æ¢æµ‹ã€äºŒæ¬¡æ¢æµ‹å’ŒåŒé‡æ•£åˆ—ã€‚</p><p>Redis çš„ Hash å­—å…¸åº•å±‚ç”¨çš„æ˜¯ <strong>å¼€æ”¾å¯»å€ + rehash + å¹³æ»‘æ‰©å®¹</strong></p></li><li><p>å†å“ˆå¸Œæ³•ï¼ˆRehashingï¼‰ï¼šå½“å‘ç”Ÿå†²çªæ—¶ï¼Œ<strong>ä½¿ç”¨å¦ä¸€ä¸ªå“ˆå¸Œå‡½æ•°å†æ¬¡è®¡ç®—é”®çš„å“ˆå¸Œå€¼ï¼Œç›´åˆ°æ‰¾åˆ°ä¸€ä¸ªç©ºæ§½æ¥å­˜å‚¨é”®å€¼å¯¹ã€‚</strong></p></li></ul><p><strong>ä¸€äº›åµŒå…¥å¼è®¾å¤‡ä¸­çš„ Hash è¡¨å®ç°</strong>ï¼Œæˆ–è€…ä¸€äº› <strong>ç©ºé—´æ•æ„Ÿçš„æ•°æ®ç»“æ„åº“</strong></p><ul><li>å“ˆå¸Œæ¡¶æ‰©å®¹ï¼šå½“å“ˆå¸Œå†²çªè¿‡å¤šæ—¶ï¼Œ<strong>å¯ä»¥åŠ¨æ€åœ°æ‰©å¤§å“ˆå¸Œæ¡¶çš„æ•°é‡ï¼Œé‡æ–°åˆ†é…é”®å€¼å¯¹ï¼Œä»¥å‡å°‘å†²çªçš„æ¦‚ç‡ã€‚</strong></li></ul><p>Java HashMap æ‰©å®¹ï¼ŒRedis æ¸è¿›å¼ rehash</p><h2 id="5-HashMapæ˜¯çº¿ç¨‹å®‰å…¨çš„å—ï¼Ÿ"><a href="#5-HashMapæ˜¯çº¿ç¨‹å®‰å…¨çš„å—ï¼Ÿ" class="headerlink" title="5.HashMapæ˜¯çº¿ç¨‹å®‰å…¨çš„å—ï¼Ÿ"></a>5.HashMapæ˜¯çº¿ç¨‹å®‰å…¨çš„å—ï¼Ÿ</h2><p>hashmapä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œhashmapåœ¨å¤šçº¿ç¨‹ä¼šå­˜åœ¨ä¸‹é¢çš„é—®é¢˜ï¼š</p><ul><li>JDK 1.7 HashMap é‡‡ç”¨æ•°ç»„ + é“¾è¡¨çš„æ•°æ®ç»“æ„ï¼Œå¤šçº¿ç¨‹èƒŒæ™¯ä¸‹ï¼Œ<strong>åœ¨æ•°ç»„æ‰©å®¹çš„æ—¶å€™ï¼Œå­˜åœ¨ Entry é“¾æ­»å¾ªç¯å’Œæ•°æ®ä¸¢å¤±é—®é¢˜ã€‚</strong></li><li>JDK 1.8 HashMap é‡‡ç”¨æ•°ç»„ + é“¾è¡¨ + çº¢é»‘äºŒå‰æ ‘çš„æ•°æ®ç»“æ„ï¼Œä¼˜åŒ–äº† 1.7 ä¸­æ•°ç»„æ‰©å®¹çš„æ–¹æ¡ˆï¼Œè§£å†³äº† Entry é“¾æ­»å¾ªç¯å’Œæ•°æ®ä¸¢å¤±é—®é¢˜ã€‚<strong>ä½†æ˜¯å¤šçº¿ç¨‹èƒŒæ™¯ä¸‹ï¼Œput æ–¹æ³•å­˜åœ¨æ•°æ®è¦†ç›–çš„é—®é¢˜ã€‚</strong></li></ul><p>å¦‚æœè¦ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œå¯ä»¥é€šè¿‡è¿™äº›æ–¹æ³•æ¥ä¿è¯ï¼š</p><ul><li>å¤šçº¿ç¨‹ç¯å¢ƒå¯ä»¥ä½¿ç”¨<strong>Collections.synchronizedMap</strong>åŒæ­¥åŠ é”çš„æ–¹å¼ï¼Œè¿˜å¯ä»¥ä½¿ç”¨HashTableï¼Œä½†æ˜¯åŒæ­¥çš„æ–¹å¼æ˜¾ç„¶æ€§èƒ½ä¸è¾¾æ ‡ï¼Œè€ŒConurrentHashMapæ›´é€‚åˆé«˜å¹¶å‘åœºæ™¯ä½¿ç”¨ã€‚</li><li><strong>ConcurrentHashmap</strong>åœ¨JDK1.7å’Œ1.8çš„ç‰ˆæœ¬æ”¹åŠ¨æ¯”è¾ƒå¤§ï¼Œ<strong>1.7ä½¿ç”¨Segment+HashEntryåˆ†æ®µé”</strong>çš„æ–¹å¼å®ç°ï¼Œ1.8åˆ™æŠ›å¼ƒäº†Segmentï¼Œæ”¹ä¸ºä½¿ç”¨<strong>CAS+synchronized+Node</strong>å®ç°ï¼ŒåŒæ ·ä¹ŸåŠ å…¥äº†çº¢é»‘æ ‘ï¼Œé¿å…é“¾è¡¨è¿‡é•¿å¯¼è‡´æ€§èƒ½çš„é—®é¢˜ã€‚</li></ul><h2 id="6-hashmapçš„putè¿‡ç¨‹ä»‹ç»ä¸€ä¸‹"><a href="#6-hashmapçš„putè¿‡ç¨‹ä»‹ç»ä¸€ä¸‹" class="headerlink" title="6. hashmapçš„putè¿‡ç¨‹ä»‹ç»ä¸€ä¸‹"></a>6. hashmapçš„putè¿‡ç¨‹ä»‹ç»ä¸€ä¸‹</h2><p>HashMap HashMapçš„put()æ–¹æ³•ç”¨äºå‘HashMapä¸­æ·»åŠ é”®å€¼å¯¹ï¼Œå½“è°ƒç”¨HashMapçš„put()æ–¹æ³•æ—¶ï¼Œä¼šæŒ‰ç…§ä»¥ä¸‹è¯¦ç»†æµç¨‹æ‰§è¡Œï¼ˆJDK8 1.8ç‰ˆæœ¬ï¼‰ï¼š</p><blockquote><p>ç¬¬ä¸€æ­¥ï¼šæ ¹æ®è¦æ·»åŠ çš„é”®çš„å“ˆå¸Œç è®¡ç®—åœ¨æ•°ç»„ä¸­çš„ä½ç½®ï¼ˆç´¢å¼•ï¼‰ã€‚</p><p>ç¬¬äºŒæ­¥ï¼šæ£€æŸ¥è¯¥ä½ç½®æ˜¯å¦ä¸ºç©ºï¼ˆå³æ²¡æœ‰é”®å€¼å¯¹å­˜åœ¨ï¼‰</p></blockquote><ul><li>å¦‚æœä¸ºç©ºï¼Œåˆ™ç›´æ¥åœ¨è¯¥ä½ç½®<strong>åˆ›å»ºä¸€ä¸ªæ–°çš„Entryå¯¹è±¡</strong>æ¥å­˜å‚¨é”®å€¼å¯¹ã€‚å°†è¦æ·»åŠ çš„é”®å€¼å¯¹ä½œä¸ºè¯¥Entryçš„é”®å’Œå€¼ï¼Œå¹¶ä¿å­˜åœ¨æ•°ç»„çš„å¯¹åº”ä½ç½®ã€‚<strong>å°†HashMapçš„ä¿®æ”¹æ¬¡æ•°ï¼ˆmodCountï¼‰åŠ 1ï¼Œä»¥ä¾¿åœ¨è¿›è¡Œè¿­ä»£æ—¶å‘ç°å¹¶å‘ä¿®æ”¹ã€‚</strong></li></ul><blockquote><p>ç¬¬ä¸‰æ­¥ï¼šå¦‚æœè¯¥ä½ç½®å·²ç»å­˜åœ¨å…¶ä»–é”®å€¼å¯¹ï¼Œæ£€æŸ¥è¯¥ä½ç½®çš„ç¬¬ä¸€ä¸ªé”®å€¼å¯¹çš„å“ˆå¸Œç å’Œé”®æ˜¯å¦ä¸è¦æ·»åŠ çš„é”®å€¼å¯¹ç›¸åŒï¼Ÿ</p></blockquote><ul><li><strong>å¦‚æœç›¸åŒï¼Œåˆ™è¡¨ç¤ºæ‰¾åˆ°äº†ç›¸åŒçš„é”®ï¼Œç›´æ¥å°†æ–°çš„å€¼æ›¿æ¢æ—§çš„å€¼ï¼Œå®Œæˆæ›´æ–°æ“ä½œã€‚</strong></li></ul><blockquote><p>ç¬¬å››æ­¥ï¼šå¦‚æœç¬¬ä¸€ä¸ªé”®å€¼å¯¹çš„å“ˆå¸Œç å’Œé”®ä¸ç›¸åŒï¼Œåˆ™éœ€è¦éå†é“¾è¡¨æˆ–çº¢é»‘æ ‘æ¥æŸ¥æ‰¾æ˜¯å¦æœ‰ç›¸åŒçš„é”®ï¼š</p></blockquote><p>å¦‚æœé”®å€¼å¯¹é›†åˆæ˜¯é“¾è¡¨ç»“æ„ï¼Œ<strong>ä»é“¾è¡¨çš„å¤´éƒ¨å¼€å§‹é€ä¸ªæ¯”è¾ƒé”®çš„å“ˆå¸Œç å’Œequals()æ–¹æ³•ï¼Œç›´åˆ°æ‰¾åˆ°ç›¸åŒçš„é”®æˆ–è¾¾åˆ°é“¾è¡¨æœ«å°¾ã€‚</strong></p><ul><li>å¦‚æœæ‰¾åˆ°äº†ç›¸åŒçš„é”®ï¼Œåˆ™ä½¿ç”¨æ–°çš„å€¼å–ä»£æ—§çš„å€¼ï¼Œå³æ›´æ–°é”®å¯¹åº”çš„å€¼ã€‚</li><li>å¦‚æœæ²¡æœ‰æ‰¾åˆ°ç›¸åŒçš„é”®ï¼Œ<strong>åˆ™å°†æ–°çš„é”®å€¼å¯¹æ·»åŠ åˆ°é“¾è¡¨çš„å¤´éƒ¨ã€‚</strong></li></ul><p>å¦‚æœé”®å€¼å¯¹é›†åˆæ˜¯çº¢é»‘æ ‘ç»“æ„ï¼Œåœ¨çº¢é»‘æ ‘ä¸­ä½¿ç”¨<strong>å“ˆå¸Œç å’Œequals()æ–¹æ³•</strong>è¿›è¡ŒæŸ¥æ‰¾ã€‚æ ¹æ®é”®çš„å“ˆå¸Œç ï¼Œå®šä½åˆ°çº¢é»‘æ ‘ä¸­çš„æŸä¸ªèŠ‚ç‚¹ï¼Œç„¶åé€ä¸ªæ¯”è¾ƒé”®ï¼Œ<strong>ç›´åˆ°æ‰¾åˆ°ç›¸åŒçš„é”®æˆ–è¾¾åˆ°çº¢é»‘æ ‘æœ«å°¾ã€‚</strong></p><ul><li>å¦‚æœæ‰¾åˆ°äº†ç›¸åŒçš„é”®ï¼Œåˆ™ä½¿ç”¨æ–°çš„å€¼å–ä»£æ—§çš„å€¼ï¼Œå³æ›´æ–°é”®å¯¹åº”çš„å€¼ã€‚</li><li>å¦‚æœæ²¡æœ‰æ‰¾åˆ°ç›¸åŒçš„é”®ï¼Œ<strong>åˆ™å°†æ–°çš„é”®å€¼å¯¹æ·»åŠ åˆ°çº¢é»‘æ ‘ä¸­ã€‚</strong></li></ul><blockquote><p>ç¬¬äº”æ­¥ï¼šæ£€æŸ¥é“¾è¡¨é•¿åº¦æ˜¯å¦è¾¾åˆ°é˜ˆå€¼ï¼ˆé»˜è®¤ä¸º8ï¼‰ï¼š</p></blockquote><ul><li>å¦‚æœ<strong>é“¾è¡¨é•¿åº¦è¶…è¿‡é˜ˆå€¼ï¼Œä¸”HashMapçš„æ•°ç»„é•¿åº¦å¤§äºç­‰äº64</strong>ï¼Œåˆ™ä¼šå°†é“¾è¡¨è½¬æ¢ä¸ºçº¢é»‘æ ‘ï¼Œä»¥æé«˜æŸ¥è¯¢æ•ˆç‡ã€‚</li></ul><blockquote><p>ç¬¬å…­æ­¥ï¼šæ£€æŸ¥è´Ÿè½½å› å­æ˜¯å¦è¶…è¿‡é˜ˆå€¼ï¼ˆé»˜è®¤ä¸º0.75ï¼‰ï¼š</p></blockquote><ul><li><strong>å¦‚æœé”®å€¼å¯¹çš„æ•°é‡ï¼ˆsizeï¼‰ä¸æ•°ç»„çš„é•¿åº¦çš„æ¯”å€¼å¤§äºé˜ˆå€¼ï¼Œåˆ™éœ€è¦è¿›è¡Œæ‰©å®¹æ“ä½œ</strong>ã€‚</li></ul><blockquote><p>ç¬¬ä¸ƒæ­¥ï¼šæ‰©å®¹æ“ä½œï¼š</p></blockquote><ul><li>åˆ›å»ºä¸€ä¸ª<strong>æ–°çš„ä¸¤å€å¤§å°</strong>çš„æ•°ç»„ã€‚</li><li>å°†æ—§æ•°ç»„ä¸­çš„é”®å€¼å¯¹<strong>é‡æ–°è®¡ç®—å“ˆå¸Œç </strong>å¹¶åˆ†é…åˆ°æ–°æ•°ç»„ä¸­çš„ä½ç½®ã€‚</li><li>æ›´æ–°HashMapçš„æ•°ç»„å¼•ç”¨å’Œé˜ˆå€¼å‚æ•°ã€‚</li></ul><blockquote><p>ç¬¬å…«æ­¥ï¼šå®Œæˆæ·»åŠ æ“ä½œã€‚</p></blockquote><p>æ­¤å¤–ï¼ŒHashMapæ˜¯éçº¿ç¨‹å®‰å…¨çš„ï¼Œå¦‚æœåœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ä½¿ç”¨ï¼Œéœ€è¦é‡‡å–é¢å¤–çš„åŒæ­¥æªæ–½æˆ–ä½¿ç”¨çº¿ç¨‹å®‰å…¨çš„ConcurrentHashMapã€‚</p><h2 id="7-HashMapçš„put-key-val-å’Œget-key-è¿‡ç¨‹"><a href="#7-HashMapçš„put-key-val-å’Œget-key-è¿‡ç¨‹" class="headerlink" title="7.HashMapçš„put(key,val)å’Œget(key)è¿‡ç¨‹"></a>7.HashMapçš„put(key,val)å’Œget(key)è¿‡ç¨‹</h2><ul><li>å­˜å‚¨å¯¹è±¡æ—¶ï¼Œæˆ‘ä»¬å°†K/Vä¼ ç»™putæ–¹æ³•æ—¶ï¼Œå®ƒè°ƒç”¨hashCodeè®¡ç®—hash<strong>ä»è€Œå¾—åˆ°bucketä½</strong>ç½®ï¼Œè¿›ä¸€æ­¥å­˜å‚¨ï¼ŒHashMapä¼šæ ¹æ®å½“å‰bucketçš„å ç”¨æƒ…å†µè‡ªåŠ¨è°ƒæ•´å®¹é‡(<strong>è¶…è¿‡Load Facotråˆ™resizeä¸ºåŸæ¥çš„2å€</strong>)ã€‚</li><li>è·å–å¯¹è±¡æ—¶ï¼Œæˆ‘ä»¬å°†Kä¼ ç»™getï¼Œå®ƒè°ƒç”¨hashCodeè®¡ç®—hashä»è€Œå¾—åˆ°<strong>bucke</strong>tä½ç½®ï¼Œå¹¶è¿›ä¸€æ­¥è°ƒ<strong>ç”¨equals()æ–¹æ³•ç¡®å®šé”®å€¼å¯¹</strong>ã€‚å¦‚æœå‘ç”Ÿç¢°æ’çš„æ—¶å€™ï¼ŒHashmapé€šè¿‡é“¾è¡¨å°†äº§ç”Ÿç¢°æ’å†²çªçš„å…ƒç´ ç»„ç»‡èµ·æ¥ï¼Œåœ¨Java 8ä¸­ï¼Œå¦‚æœä¸€ä¸ªbucketä¸­ç¢°æ’å†²çªçš„å…ƒç´ è¶…è¿‡æŸä¸ªé™åˆ¶(é»˜è®¤æ˜¯8)ï¼Œåˆ™ä½¿ç”¨çº¢é»‘æ ‘æ¥æ›¿æ¢é“¾è¡¨ï¼Œä»è€Œæé«˜é€Ÿåº¦ã€‚</li></ul><h2 id="8-hashmap-è°ƒç”¨getæ–¹æ³•ä¸€å®šå®‰å…¨å—ï¼Ÿ"><a href="#8-hashmap-è°ƒç”¨getæ–¹æ³•ä¸€å®šå®‰å…¨å—ï¼Ÿ" class="headerlink" title="8.hashmap è°ƒç”¨getæ–¹æ³•ä¸€å®šå®‰å…¨å—ï¼Ÿ"></a>8.hashmap è°ƒç”¨getæ–¹æ³•ä¸€å®šå®‰å…¨å—ï¼Ÿ</h2><p>ä¸æ˜¯ï¼Œè°ƒç”¨ get æ–¹æ³•æœ‰å‡ ç‚¹éœ€è¦æ³¨æ„çš„åœ°æ–¹ï¼š</p><ul><li><strong>ç©ºæŒ‡é’ˆå¼‚å¸¸ï¼ˆNullPointerExceptionï¼‰</strong>ï¼šå¦‚æœä½ å°è¯•ç”¨ <code>null</code> ä½œä¸ºé”®è°ƒç”¨ <code>get</code> æ–¹æ³•ï¼Œ<strong>è€Œ <code>HashMap</code> æ²¡æœ‰è¢«åˆå§‹åŒ–ï¼ˆå³ä¸º <code>null</code>ï¼‰</strong>ï¼Œé‚£ä¹ˆä¼šæŠ›å‡ºç©ºæŒ‡é’ˆå¼‚å¸¸ã€‚ä¸è¿‡ï¼Œå¦‚æœ <code>HashMap</code> å·²ç»åˆå§‹åŒ–ï¼Œä½¿ç”¨ <code>null</code> ä½œä¸ºé”®æ˜¯å…è®¸çš„ï¼Œå› ä¸º <code>HashMap</code> æ”¯æŒ <code>null</code> é”®ã€‚</li><li><strong>çº¿ç¨‹å®‰å…¨</strong>ï¼š<code>HashMap</code> æœ¬èº«ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ã€‚å¦‚æœåœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­ï¼Œæ²¡æœ‰é€‚å½“çš„åŒæ­¥æªæ–½ï¼ŒåŒæ—¶å¯¹ <code>HashMap</code> è¿›è¡Œè¯»å†™æ“ä½œå¯èƒ½ä¼šå¯¼è‡´ä¸å¯é¢„æµ‹çš„è¡Œä¸ºã€‚ä¾‹å¦‚ï¼Œ<strong>åœ¨ä¸€ä¸ªçº¿ç¨‹ä¸­è°ƒç”¨ <code>get</code> æ–¹æ³•è¯»å–æ•°æ®ï¼Œè€Œå¦ä¸€ä¸ªçº¿ç¨‹åŒæ—¶ä¿®æ”¹äº†ç»“æ„ï¼ˆå¦‚å¢åŠ æˆ–åˆ é™¤å…ƒç´ ï¼‰ï¼Œå¯èƒ½ä¼šå¯¼è‡´è¯»å–æ“ä½œå¾—åˆ°é”™è¯¯çš„ç»“æœæˆ–æŠ›å‡º <code>ConcurrentModificationException</code>ã€‚</strong>å¦‚æœéœ€è¦åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­ä½¿ç”¨ç±»ä¼¼ <code>HashMap</code> çš„æ•°æ®ç»“æ„ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨ <code>ConcurrentHashMap</code>ã€‚</li></ul><h2 id="9-HashMapä¸€èˆ¬ç”¨ä»€ä¹ˆåšKeyï¼Ÿä¸ºå•¥Stringé€‚åˆåšKeyå‘¢ï¼Ÿ"><a href="#9-HashMapä¸€èˆ¬ç”¨ä»€ä¹ˆåšKeyï¼Ÿä¸ºå•¥Stringé€‚åˆåšKeyå‘¢ï¼Ÿ" class="headerlink" title="9.HashMapä¸€èˆ¬ç”¨ä»€ä¹ˆåšKeyï¼Ÿä¸ºå•¥Stringé€‚åˆåšKeyå‘¢ï¼Ÿ"></a>9.HashMapä¸€èˆ¬ç”¨ä»€ä¹ˆåšKeyï¼Ÿä¸ºå•¥Stringé€‚åˆåšKeyå‘¢ï¼Ÿ</h2><p>ç”¨ string åš keyï¼Œ<strong>å› ä¸º Stringå¯¹è±¡æ˜¯ä¸å¯å˜çš„</strong>ï¼Œä¸€æ—¦åˆ›å»ºå°±ä¸èƒ½è¢«ä¿®æ”¹ï¼Œè¿™ç¡®ä¿äº†Keyçš„ç¨³å®šæ€§ã€‚å¦‚æœKeyæ˜¯å¯å˜çš„ï¼Œ<strong>å¯èƒ½ä¼šå¯¼è‡´hashCodeå’Œequalsæ–¹æ³•çš„ä¸ä¸€è‡´ï¼Œ</strong>è¿›è€Œå½±å“HashMapçš„æ­£ç¡®æ€§ã€‚</p><h2 id="10-ä¸ºä»€ä¹ˆHashMapè¦ç”¨çº¢é»‘æ ‘è€Œä¸æ˜¯å¹³è¡¡äºŒå‰æ ‘ï¼Ÿ"><a href="#10-ä¸ºä»€ä¹ˆHashMapè¦ç”¨çº¢é»‘æ ‘è€Œä¸æ˜¯å¹³è¡¡äºŒå‰æ ‘ï¼Ÿ" class="headerlink" title="10.ä¸ºä»€ä¹ˆHashMapè¦ç”¨çº¢é»‘æ ‘è€Œä¸æ˜¯å¹³è¡¡äºŒå‰æ ‘ï¼Ÿ"></a>10.ä¸ºä»€ä¹ˆHashMapè¦ç”¨çº¢é»‘æ ‘è€Œä¸æ˜¯å¹³è¡¡äºŒå‰æ ‘ï¼Ÿ</h2><ul><li>å¹³è¡¡äºŒå‰æ ‘è¿½æ±‚çš„æ˜¯ä¸€ç§ <strong>â€œå®Œå…¨å¹³è¡¡â€</strong> çŠ¶æ€ï¼šä»»ä½•ç»“ç‚¹çš„å·¦å³å­æ ‘çš„é«˜åº¦å·®ä¸ä¼šè¶…è¿‡ 1ï¼Œä¼˜åŠ¿æ˜¯æ ‘çš„ç»“ç‚¹æ˜¯å¾ˆå¹³å‡åˆ†é…çš„ã€‚è¿™ä¸ªè¦æ±‚å®åœ¨æ˜¯å¤ªä¸¥äº†ï¼Œ<strong>å¯¼è‡´æ¯æ¬¡è¿›è¡Œæ’å…¥/åˆ é™¤èŠ‚ç‚¹çš„æ—¶å€™ï¼Œå‡ ä¹éƒ½ä¼šç ´åå¹³è¡¡æ ‘çš„ç¬¬äºŒä¸ªè§„åˆ™</strong>ï¼Œè¿›è€Œæˆ‘ä»¬éƒ½éœ€è¦é€šè¿‡<strong>å·¦æ—‹</strong>å’Œ<strong>å³æ—‹</strong>æ¥è¿›è¡Œè°ƒæ•´ï¼Œä½¿ä¹‹å†æ¬¡æˆä¸ºä¸€é¢—ç¬¦åˆè¦æ±‚çš„å¹³è¡¡æ ‘ã€‚</li><li>çº¢é»‘æ ‘ä¸è¿½æ±‚è¿™ç§å®Œå…¨å¹³è¡¡çŠ¶æ€ï¼Œè€Œæ˜¯è¿½æ±‚ä¸€ç§ <strong>â€œå¼±å¹³è¡¡â€</strong> çŠ¶æ€ï¼šæ•´ä¸ªæ ‘æœ€é•¿è·¯å¾„ä¸ä¼šè¶…è¿‡æœ€çŸ­è·¯å¾„çš„ 2 å€ã€‚ä¼˜åŠ¿æ˜¯è™½ç„¶ç‰ºç‰²äº†ä¸€éƒ¨åˆ†æŸ¥æ‰¾çš„æ€§èƒ½æ•ˆç‡ï¼Œä½†æ˜¯èƒ½å¤Ÿæ¢å–ä¸€éƒ¨åˆ†ç»´æŒæ ‘å¹³è¡¡çŠ¶æ€çš„æˆæœ¬ã€‚ä¸å¹³è¡¡æ ‘ä¸åŒçš„æ˜¯ï¼Œçº¢é»‘æ ‘åœ¨æ’å…¥ã€åˆ é™¤ç­‰æ“ä½œï¼Œ<strong>ä¸ä¼šåƒå¹³è¡¡æ ‘é‚£æ ·ï¼Œé¢‘ç¹ç€ç ´åçº¢é»‘æ ‘çš„è§„åˆ™ï¼Œæ‰€ä»¥ä¸éœ€è¦é¢‘ç¹ç€è°ƒæ•´</strong>ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ä»¬ä¸ºä»€ä¹ˆå¤§å¤šæ•°æƒ…å†µä¸‹ä½¿ç”¨çº¢é»‘æ ‘çš„åŸå› ã€‚</li></ul><h2 id="11-hashmap-keyå¯ä»¥ä¸ºnullå—ï¼Ÿ"><a href="#11-hashmap-keyå¯ä»¥ä¸ºnullå—ï¼Ÿ" class="headerlink" title="11.hashmap keyå¯ä»¥ä¸ºnullå—ï¼Ÿ"></a>11.hashmap keyå¯ä»¥ä¸ºnullå—ï¼Ÿ</h2><p>å¯ä»¥ä¸º nullã€‚ä½†æ˜¯éœ€è¦<strong>åˆå§‹åŒ–</strong></p><ul><li>hashMapä¸­ä½¿ç”¨hash()æ–¹æ³•æ¥è®¡ç®—keyçš„å“ˆå¸Œå€¼ï¼Œå½“keyä¸ºç©ºæ—¶ï¼Œç›´æ¥å¦keyçš„å“ˆå¸Œå€¼ä¸º0ï¼Œä¸èµ°key.hashCode()æ–¹æ³•ï¼›</li></ul><p><img src="https://cdn.xiaolincoding.com//picgo/1720685862193-66a32b79-ddf0-46d5-87df-d2fc2b3d87cb.png" alt="img"></p><ul><li>hashMapè™½ç„¶æ”¯æŒkeyå’Œvalueä¸ºnullï¼Œ<strong>ä½†æ˜¯nullä½œä¸ºkeyåªèƒ½æœ‰ä¸€ä¸ª</strong>ï¼Œnullä½œä¸ºvalueå¯ä»¥æœ‰å¤šä¸ªï¼›</li><li>å› ä¸ºhashMapä¸­ï¼Œå¦‚æœkeyå€¼ä¸€æ ·ï¼Œé‚£ä¹ˆä¼šè¦†ç›–ç›¸åŒkeyå€¼çš„valueä¸ºæœ€æ–°ï¼Œæ‰€ä»¥keyä¸ºnullåªèƒ½æœ‰ä¸€ä¸ª</li></ul><h2 id="12-é‡å†™HashMapçš„equalå’Œhashcodeæ–¹æ³•éœ€è¦æ³¨æ„ä»€ä¹ˆï¼Ÿ"><a href="#12-é‡å†™HashMapçš„equalå’Œhashcodeæ–¹æ³•éœ€è¦æ³¨æ„ä»€ä¹ˆï¼Ÿ" class="headerlink" title="12.é‡å†™HashMapçš„equalå’Œhashcodeæ–¹æ³•éœ€è¦æ³¨æ„ä»€ä¹ˆï¼Ÿ"></a>12.é‡å†™HashMapçš„equalå’Œhashcodeæ–¹æ³•éœ€è¦æ³¨æ„ä»€ä¹ˆï¼Ÿ</h2><p>HashMapä½¿ç”¨Keyå¯¹è±¡çš„<strong>hashCode()å’Œequalsæ–¹æ³•å»å†³å®škey-valueå¯¹çš„ç´¢å¼•</strong>ã€‚å½“æˆ‘ä»¬è¯•ç€ä»HashMapä¸­è·å–å€¼çš„æ—¶å€™ï¼Œè¿™äº›æ–¹æ³•ä¹Ÿä¼šè¢«ç”¨åˆ°ã€‚å¦‚æœè¿™äº›æ–¹æ³•æ²¡æœ‰è¢«æ­£ç¡®åœ°å®ç°ï¼Œåœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œ<strong>ä¸¤ä¸ªä¸åŒKeyä¹Ÿè®¸ä¼šäº§ç”Ÿç›¸åŒçš„hashCode()å’Œequals()è¾“å‡ºï¼ŒHashMapå°†ä¼šè®¤ä¸ºå®ƒä»¬æ˜¯ç›¸åŒçš„ï¼Œç„¶åè¦†ç›–å®ƒä»¬ï¼Œè€ŒéæŠŠå®ƒä»¬å­˜å‚¨åˆ°ä¸åŒçš„åœ°æ–¹ã€‚</strong></p><p>åŒæ ·çš„ï¼Œ<strong>æ‰€æœ‰ä¸å…è®¸å­˜å‚¨é‡å¤æ•°æ®çš„é›†åˆç±»éƒ½ä½¿ç”¨hashCode()å’Œequals()å»æŸ¥æ‰¾é‡å¤</strong>ï¼Œæ‰€ä»¥æ­£ç¡®å®ç°å®ƒä»¬éå¸¸é‡è¦ã€‚equals()å’ŒhashCode()çš„å®ç°åº”è¯¥éµå¾ªä»¥ä¸‹è§„åˆ™ï¼š</p><ul><li>å¦‚æœo1.equals(o2)ï¼Œé‚£ä¹ˆo1.hashCode() == o2.hashCode()æ€»æ˜¯ä¸ºtrueçš„ã€‚</li><li>å¦‚æœo1.hashCode() == o2.hashCode()ï¼Œå¹¶ä¸æ„å‘³ç€o1.equals(o2)ä¼šä¸ºtrueã€‚</li></ul><h2 id="13-é‡å†™HashMapçš„equalæ–¹æ³•ä¸å½“ä¼šå‡ºç°ä»€ä¹ˆé—®é¢˜ï¼Ÿ"><a href="#13-é‡å†™HashMapçš„equalæ–¹æ³•ä¸å½“ä¼šå‡ºç°ä»€ä¹ˆé—®é¢˜ï¼Ÿ" class="headerlink" title="13.é‡å†™HashMapçš„equalæ–¹æ³•ä¸å½“ä¼šå‡ºç°ä»€ä¹ˆé—®é¢˜ï¼Ÿ"></a>13.é‡å†™HashMapçš„equalæ–¹æ³•ä¸å½“ä¼šå‡ºç°ä»€ä¹ˆé—®é¢˜ï¼Ÿ</h2><p>HashMapåœ¨æ¯”è¾ƒå…ƒç´ æ—¶ï¼Œ<strong>ä¼šå…ˆé€šè¿‡hashCodeè¿›è¡Œæ¯”è¾ƒï¼Œç›¸åŒçš„æƒ…å†µä¸‹å†é€šè¿‡equalsè¿›è¡Œæ¯”è¾ƒã€‚</strong></p><p>æ‰€ä»¥ equalsç›¸ç­‰çš„ä¸¤ä¸ªå¯¹è±¡ï¼ŒhashCodeä¸€å®šç›¸ç­‰ã€‚<strong>hashCodeç›¸ç­‰çš„ä¸¤ä¸ªå¯¹è±¡ï¼Œequalsä¸ä¸€å®šç›¸ç­‰ï¼ˆæ¯”å¦‚æ•£åˆ—å†²çªçš„æƒ…å†µï¼‰</strong>æ•£åˆ—å†²çªæ˜¯æŒ‡ï¼šä¸¤ä¸ªä¸åŒçš„å¯¹è±¡ï¼ˆæˆ–å€¼ï¼‰ç»è¿‡å“ˆå¸Œå‡½æ•°è®¡ç®—åï¼Œå¾—åˆ°ç›¸åŒçš„å“ˆå¸Œå€¼</p><p><strong>é‡å†™äº†equalsæ–¹æ³•ï¼Œä¸é‡å†™hashCodeæ–¹æ³•æ—¶</strong>ï¼Œå¯èƒ½ä¼šå‡ºç°equalsæ–¹æ³•è¿”å›ä¸ºtrueï¼Œè€ŒhashCodeæ–¹æ³•å´è¿”å›falseï¼Œ<strong>è¿™æ ·çš„ä¸€ä¸ªåæœä¼šå¯¼è‡´åœ¨hashmapç­‰ç±»ä¸­å­˜å‚¨å¤šä¸ªä¸€æ¨¡ä¸€æ ·çš„å¯¹è±¡ï¼Œå¯¼è‡´å‡ºç°è¦†ç›–å­˜å‚¨çš„æ•°æ®çš„é—®é¢˜ï¼Œè¿™ä¸hashmapåªèƒ½æœ‰å”¯ä¸€çš„keyçš„è§„èŒƒä¸ç¬¦åˆã€‚</strong></p><h2 id="14-åˆ—ä¸¾HashMapåœ¨å¤šçº¿ç¨‹ä¸‹å¯èƒ½ä¼šå‡ºç°çš„é—®é¢˜ï¼Ÿ"><a href="#14-åˆ—ä¸¾HashMapåœ¨å¤šçº¿ç¨‹ä¸‹å¯èƒ½ä¼šå‡ºç°çš„é—®é¢˜ï¼Ÿ" class="headerlink" title="14.åˆ—ä¸¾HashMapåœ¨å¤šçº¿ç¨‹ä¸‹å¯èƒ½ä¼šå‡ºç°çš„é—®é¢˜ï¼Ÿ"></a>14.åˆ—ä¸¾HashMapåœ¨å¤šçº¿ç¨‹ä¸‹å¯èƒ½ä¼šå‡ºç°çš„é—®é¢˜ï¼Ÿ</h2><ul><li>JDK1.7ä¸­çš„ HashMap ä½¿ç”¨<strong>å¤´æ’æ³•</strong>æ’å…¥å…ƒç´ ï¼Œåœ¨å¤šçº¿ç¨‹çš„ç¯å¢ƒä¸‹ï¼Œ<strong>æ‰©å®¹çš„æ—¶å€™æœ‰å¯èƒ½å¯¼è‡´ç¯å½¢é“¾è¡¨çš„å‡ºç°ï¼Œå½¢æˆæ­»å¾ªç¯ã€‚</strong>å› æ­¤ï¼ŒJDK1.8ä½¿ç”¨<strong>å°¾æ’æ³•</strong>æ’å…¥å…ƒç´ ï¼Œåœ¨æ‰©å®¹æ—¶ä¼šä¿æŒé“¾è¡¨å…ƒç´ åŸæœ¬çš„é¡ºåºï¼Œä¸ä¼šå‡ºç°ç¯å½¢é“¾è¡¨çš„é—®é¢˜ã€‚</li><li><strong>å¤šçº¿ç¨‹åŒæ—¶æ‰§è¡Œ put æ“ä½œ</strong>ï¼Œå¦‚æœè®¡ç®—å‡ºæ¥çš„ç´¢å¼•ä½ç½®æ˜¯ç›¸åŒçš„ï¼Œé‚£ä¼šé€ æˆå‰ä¸€ä¸ª key è¢«åä¸€ä¸ª key è¦†ç›–ï¼Œä»è€Œå¯¼è‡´å…ƒç´ çš„ä¸¢å¤±ã€‚æ­¤é—®é¢˜åœ¨JDK 1.7å’Œ JDK 1.8 ä¸­éƒ½å­˜åœ¨ã€‚</li></ul><h2 id="15-HashMapçš„æ‰©å®¹æœºåˆ¶ä»‹ç»ä¸€ä¸‹"><a href="#15-HashMapçš„æ‰©å®¹æœºåˆ¶ä»‹ç»ä¸€ä¸‹" class="headerlink" title="15.HashMapçš„æ‰©å®¹æœºåˆ¶ä»‹ç»ä¸€ä¸‹"></a>15.HashMapçš„æ‰©å®¹æœºåˆ¶ä»‹ç»ä¸€ä¸‹</h2><p>hashMapé»˜è®¤çš„<strong>è´Ÿè½½å› å­æ˜¯0.75</strong>ï¼Œå³å¦‚æœhashmapä¸­çš„å…ƒç´ ä¸ªæ•°è¶…è¿‡äº†æ€»å®¹é‡75%ï¼Œåˆ™ä¼šè§¦å‘æ‰©å®¹ï¼Œæ‰©å®¹åˆ†ä¸ºä¸¤ä¸ªæ­¥éª¤ï¼š</p><ul><li><strong>ç¬¬1æ­¥</strong>æ˜¯å¯¹<strong>å“ˆå¸Œè¡¨é•¿åº¦çš„æ‰©å±•ï¼ˆ2å€ï¼‰</strong></li><li><strong>ç¬¬2æ­¥</strong>æ˜¯å°†æ—§å“ˆå¸Œè¡¨ä¸­çš„æ•°æ®æ”¾åˆ°æ–°çš„å“ˆå¸Œè¡¨ä¸­ã€‚</li></ul><p>å› ä¸ºæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯2æ¬¡å¹‚çš„æ‰©å±•(æŒ‡é•¿åº¦æ‰©ä¸ºåŸæ¥2å€)ï¼Œæ‰€ä»¥ï¼Œ<strong>å…ƒç´ çš„ä½ç½®è¦ä¹ˆæ˜¯åœ¨åŸä½ç½®ï¼Œè¦ä¹ˆæ˜¯åœ¨åŸä½ç½®å†ç§»åŠ¨2æ¬¡å¹‚çš„ä½ç½®ã€‚</strong></p><p>å¦‚æˆ‘ä»¬ä»16æ‰©å±•ä¸º32æ—¶ï¼Œå…·ä½“çš„å˜åŒ–å¦‚ä¸‹æ‰€ç¤ºï¼š</p><p><img src="https://cdn.xiaolincoding.com//picgo/1713514753772-9467a399-6b18-4a47-89d4-957adcc53cc0.webp" alt="img"></p><p>å› æ­¤å…ƒç´ åœ¨é‡æ–°è®¡ç®—hashä¹‹åï¼Œå› ä¸ºnå˜ä¸º2å€ï¼Œé‚£ä¹ˆn-1çš„maskèŒƒå›´åœ¨é«˜ä½å¤š1bit(çº¢è‰²)ï¼Œå› æ­¤æ–°çš„indexå°±ä¼šå‘ç”Ÿè¿™æ ·çš„å˜åŒ–ï¼š</p><p><img src="https://cdn.xiaolincoding.com//picgo/1713514753786-cdca10bf-6eda-47f9-9bbe-0cc3beb67d76.webp" alt="img"></p><p>å› æ­¤ï¼Œæˆ‘ä»¬åœ¨æ‰©å……HashMapçš„æ—¶å€™ï¼Œä¸éœ€è¦é‡æ–°è®¡ç®—hashï¼Œ<strong>åªéœ€è¦çœ‹çœ‹åŸæ¥çš„hashå€¼æ–°å¢çš„é‚£ä¸ªbitæ˜¯1è¿˜æ˜¯0å°±å¥½äº†ï¼Œæ˜¯0çš„è¯ç´¢å¼•æ²¡å˜ï¼Œæ˜¯1çš„è¯ç´¢å¼•å˜æˆâ€œåŸç´¢å¼•+oldCapâ€</strong>ã€‚å¯ä»¥çœ‹çœ‹ä¸‹å›¾ä¸º16æ‰©å……ä¸º32çš„resizeç¤ºæ„å›¾ï¼š</p><p><img src="https://cdn.xiaolincoding.com//picgo/1713514753885-d1529537-322c-49b1-beec-5d9953da5150.webp" alt="img"></p><p>è¿™ä¸ªè®¾è®¡ç¡®å®éå¸¸çš„å·§å¦™ï¼Œ<strong>æ—¢çœå»äº†é‡æ–°è®¡ç®—hashå€¼çš„æ—¶é—´ï¼Œè€Œä¸”åŒæ—¶ï¼Œç”±äºæ–°å¢çš„1bitæ˜¯0è¿˜æ˜¯1å¯ä»¥è®¤ä¸ºæ˜¯éšæœºçš„ï¼Œå› æ­¤resizeçš„è¿‡ç¨‹ï¼Œå‡åŒ€çš„æŠŠä¹‹å‰çš„å†²çªçš„èŠ‚ç‚¹åˆ†æ•£åˆ°æ–°çš„bucketäº†</strong></p><h2 id="16-HashMapçš„å¤§å°ä¸ºä»€ä¹ˆæ˜¯2çš„næ¬¡æ–¹å¤§å°å‘¢ï¼Ÿ"><a href="#16-HashMapçš„å¤§å°ä¸ºä»€ä¹ˆæ˜¯2çš„næ¬¡æ–¹å¤§å°å‘¢ï¼Ÿ" class="headerlink" title="16.HashMapçš„å¤§å°ä¸ºä»€ä¹ˆæ˜¯2çš„næ¬¡æ–¹å¤§å°å‘¢ï¼Ÿ"></a>16.HashMapçš„å¤§å°ä¸ºä»€ä¹ˆæ˜¯2çš„næ¬¡æ–¹å¤§å°å‘¢ï¼Ÿ</h2><p>åœ¨ JDK1.7 ä¸­ï¼ŒHashMap <strong>æ•´ä¸ªæ‰©å®¹è¿‡ç¨‹å°±æ˜¯åˆ†åˆ«å–å‡ºæ•°ç»„å…ƒç´ ï¼Œä¸€èˆ¬è¯¥å…ƒç´ æ˜¯æœ€åä¸€ä¸ªæ”¾å…¥é“¾è¡¨ä¸­çš„å…ƒç´ ï¼Œç„¶åéå†ä»¥è¯¥å…ƒç´ ä¸ºå¤´çš„å•å‘é“¾è¡¨å…ƒç´ ï¼Œä¾æ®æ¯ä¸ªè¢«éå†å…ƒç´ çš„ hash å€¼è®¡ç®—å…¶åœ¨æ–°æ•°ç»„ä¸­çš„ä¸‹æ ‡ï¼Œç„¶åè¿›è¡Œäº¤æ¢ã€‚</strong>è¿™æ ·çš„æ‰©å®¹æ–¹å¼ä¼šå°†åŸæ¥å“ˆå¸Œå†²çªçš„å•å‘é“¾è¡¨å°¾éƒ¨å˜æˆæ‰©å®¹åå•å‘é“¾è¡¨çš„å¤´éƒ¨ã€‚</p><p>è€Œåœ¨ JDK 1.8 ä¸­ï¼ŒHashMap å¯¹æ‰©å®¹æ“ä½œåšäº†ä¼˜åŒ–ã€‚<strong>ç”±äºæ‰©å®¹æ•°ç»„çš„é•¿åº¦æ˜¯ 2 å€å…³ç³»</strong>ï¼Œæ‰€ä»¥å¯¹äºå‡è®¾åˆå§‹ tableSize = 4 è¦æ‰©å®¹åˆ° 8 æ¥è¯´å°±æ˜¯ 0100 åˆ° 1000 çš„å˜åŒ–ï¼ˆå·¦ç§»ä¸€ä½å°±æ˜¯ 2 å€ï¼‰ï¼Œ<strong>åœ¨æ‰©å®¹ä¸­åªç”¨åˆ¤æ–­åŸæ¥çš„ hash å€¼å’Œå·¦ç§»åŠ¨çš„ä¸€ä½ï¼ˆnewtable çš„å€¼ï¼‰æŒ‰ä½ä¸æ“ä½œæ˜¯ 0 æˆ– 1 å°±è¡Œï¼Œ0 çš„è¯ç´¢å¼•ä¸å˜ï¼Œ1 çš„è¯ç´¢å¼•å˜æˆåŸç´¢å¼•åŠ ä¸Šæ‰©å®¹å‰æ•°ç»„ã€‚</strong></p><p>ä¹‹æ‰€ä»¥èƒ½é€šè¿‡è¿™ç§â€œä¸è¿ç®—â€œæ¥é‡æ–°åˆ†é…ç´¢å¼•ï¼Œ<strong>æ˜¯å› ä¸º hash å€¼æœ¬æ¥å°±æ˜¯éšæœºçš„ï¼Œè€Œ hash æŒ‰ä½ä¸ä¸Š newTable å¾—åˆ°çš„ 0ï¼ˆæ‰©å®¹å‰çš„ç´¢å¼•ä½ç½®ï¼‰å’Œ 1ï¼ˆæ‰©å®¹å‰ç´¢å¼•ä½ç½®åŠ ä¸Šæ‰©å®¹å‰æ•°ç»„é•¿åº¦çš„æ•°å€¼ç´¢å¼•å¤„ï¼‰å°±æ˜¯éšæœºçš„ï¼Œ</strong>æ‰€ä»¥æ‰©å®¹çš„è¿‡ç¨‹å°±èƒ½<strong>æŠŠä¹‹å‰å“ˆå¸Œå†²çªçš„å…ƒç´ å†éšæœºåˆ†å¸ƒåˆ°ä¸åŒçš„ç´¢å¼•ä¸­å»ã€‚</strong></p><h2 id="17-å¾€hashmapå­˜20ä¸ªå…ƒç´ ï¼Œä¼šæ‰©å®¹å‡ æ¬¡ï¼Ÿ"><a href="#17-å¾€hashmapå­˜20ä¸ªå…ƒç´ ï¼Œä¼šæ‰©å®¹å‡ æ¬¡ï¼Ÿ" class="headerlink" title="17.å¾€hashmapå­˜20ä¸ªå…ƒç´ ï¼Œä¼šæ‰©å®¹å‡ æ¬¡ï¼Ÿ"></a>17.å¾€hashmapå­˜20ä¸ªå…ƒç´ ï¼Œä¼šæ‰©å®¹å‡ æ¬¡ï¼Ÿ</h2><p>å½“æ’å…¥ 20 ä¸ªå…ƒç´ æ—¶ï¼ŒHashMap çš„æ‰©å®¹è¿‡ç¨‹å¦‚ä¸‹ï¼š</p><p><strong>åˆå§‹å®¹é‡</strong>ï¼š16</p><ul><li>æ’å…¥ç¬¬ 1 åˆ°ç¬¬ 12 ä¸ªå…ƒç´ æ—¶ï¼Œä¸éœ€è¦æ‰©å®¹ã€‚</li><li>æ’å…¥ç¬¬ 13 ä¸ªå…ƒç´ æ—¶ï¼Œè¾¾åˆ°è´Ÿè½½å› å­é™åˆ¶ï¼Œ<strong>éœ€è¦æ‰©å®¹ã€‚æ­¤æ—¶ï¼ŒHashMap çš„å®¹é‡ä» 16 æ‰©å®¹åˆ° 32ã€‚</strong></li></ul><p><strong>æ‰©å®¹åçš„å®¹é‡</strong>ï¼š32</p><ul><li>æ’å…¥ç¬¬ 14 åˆ°ç¬¬ 24 ä¸ªå…ƒç´ æ—¶ï¼Œä¸éœ€è¦æ‰©å®¹ã€‚</li></ul><p>å› æ­¤ï¼Œæ€»å…±ä¼šè¿›è¡Œ<strong>ä¸€æ¬¡æ‰©å®¹</strong>ã€‚</p><h2 id="18-è¯´è¯´hashmapçš„è´Ÿè½½å› å­"><a href="#18-è¯´è¯´hashmapçš„è´Ÿè½½å› å­" class="headerlink" title="18.è¯´è¯´hashmapçš„è´Ÿè½½å› å­"></a>18.è¯´è¯´hashmapçš„è´Ÿè½½å› å­</h2><p>HashMap è´Ÿè½½å› å­ loadFactor çš„é»˜è®¤å€¼æ˜¯ 0.75ï¼Œå½“ HashMap ä¸­çš„å…ƒç´ ä¸ªæ•°è¶…è¿‡äº†å®¹é‡çš„ 75% æ—¶ï¼Œå°±ä¼šè¿›è¡Œæ‰©å®¹ã€‚</p><p>é»˜è®¤è´Ÿè½½å› å­ä¸º 0.75ï¼Œæ˜¯å› ä¸ºå®ƒ<strong>æä¾›äº†ç©ºé—´å’Œæ—¶é—´å¤æ‚åº¦ä¹‹é—´çš„è‰¯å¥½å¹³è¡¡</strong>ã€‚</p><p><strong>è´Ÿè½½å› å­å¤ªä½ä¼šå¯¼è‡´å¤§é‡çš„ç©ºæ¡¶æµªè´¹ç©ºé—´</strong>ï¼Œ<strong>è´Ÿè½½å› å­å¤ªé«˜ä¼šå¯¼è‡´å¤§é‡çš„ç¢°æ’</strong>ï¼Œé™ä½æ€§èƒ½ã€‚0.75 çš„è´Ÿè½½å› å­åœ¨è¿™ä¸¤ä¸ªå› ç´ ä¹‹é—´å–å¾—äº†è‰¯å¥½çš„å¹³è¡¡ã€‚</p><h2 id="19-Hashmapå’ŒHashtableæœ‰ä»€ä¹ˆä¸ä¸€æ ·çš„ï¼ŸHashmapä¸€èˆ¬æ€ä¹ˆç”¨ï¼Ÿ"><a href="#19-Hashmapå’ŒHashtableæœ‰ä»€ä¹ˆä¸ä¸€æ ·çš„ï¼ŸHashmapä¸€èˆ¬æ€ä¹ˆç”¨ï¼Ÿ" class="headerlink" title="19.Hashmapå’ŒHashtableæœ‰ä»€ä¹ˆä¸ä¸€æ ·çš„ï¼ŸHashmapä¸€èˆ¬æ€ä¹ˆç”¨ï¼Ÿ"></a>19.Hashmapå’ŒHashtableæœ‰ä»€ä¹ˆä¸ä¸€æ ·çš„ï¼ŸHashmapä¸€èˆ¬æ€ä¹ˆç”¨ï¼Ÿ</h2><ul><li><strong>HashMapçº¿ç¨‹ä¸å®‰å…¨</strong>ï¼Œ<strong>æ•ˆç‡é«˜ä¸€ç‚¹ï¼Œå¯ä»¥å­˜å‚¨nullçš„keyå’Œvalueï¼Œ</strong>nullçš„keyåªèƒ½æœ‰ä¸€ä¸ªï¼Œnullçš„valueå¯ä»¥æœ‰å¤šä¸ªã€‚<strong>é»˜è®¤åˆå§‹å®¹é‡ä¸º16</strong>ï¼Œæ¯æ¬¡æ‰©å……å˜ä¸ºåŸæ¥2å€ã€‚åˆ›å»ºæ—¶å¦‚æœç»™å®šäº†åˆå§‹å®¹é‡ï¼Œåˆ™æ‰©å……ä¸º2çš„å¹‚æ¬¡æ–¹å¤§å°ã€‚åº•å±‚æ•°æ®ç»“æ„ä¸ºæ•°ç»„+é“¾è¡¨ï¼Œæ’å…¥å…ƒç´ åå¦‚æœé“¾è¡¨é•¿åº¦å¤§äºé˜ˆå€¼ï¼ˆé»˜è®¤ä¸º8ï¼‰ï¼Œå…ˆåˆ¤æ–­æ•°ç»„é•¿åº¦æ˜¯å¦å°äº64ï¼Œå¦‚æœå°äºï¼Œåˆ™æ‰©å……æ•°ç»„ï¼Œåä¹‹å°†é“¾è¡¨è½¬åŒ–ä¸ºçº¢é»‘æ ‘ï¼Œä»¥å‡å°‘æœç´¢æ—¶é—´ã€‚</li><li><strong>HashTableçº¿ç¨‹å®‰å…¨</strong>ï¼Œ<strong>æ•ˆç‡ä½ä¸€ç‚¹ï¼Œå…¶å†…éƒ¨æ–¹æ³•åŸºæœ¬éƒ½ç»è¿‡synchronizedä¿®é¥°</strong>ï¼Œ<strong>ä¸å¯ä»¥æœ‰nullçš„keyå’Œvalue</strong>ã€‚<strong>é»˜è®¤åˆå§‹å®¹é‡ä¸º11</strong>ï¼Œ<strong>æ¯æ¬¡æ‰©å®¹å˜ä¸ºåŸæ¥çš„2n+1</strong>ã€‚åˆ›å»ºæ—¶ç»™å®šäº†åˆå§‹å®¹é‡ï¼Œä¼šç›´æ¥ç”¨ç»™å®šçš„å¤§å°ã€‚åº•å±‚æ•°æ®ç»“æ„ä¸ºæ•°ç»„+é“¾è¡¨ã€‚å®ƒåŸºæœ¬è¢«æ·˜æ±°äº†ï¼Œè¦ä¿è¯çº¿ç¨‹å®‰å…¨å¯ä»¥ç”¨ConcurrentHashMapã€‚</li><li><strong>æ€ä¹ˆç”¨</strong>ï¼šHashMapä¸»è¦ç”¨æ¥å­˜å‚¨é”®å€¼å¯¹ï¼Œå¯ä»¥è°ƒç”¨putæ–¹æ³•å‘å…¶ä¸­åŠ å…¥å…ƒç´ ï¼Œè°ƒç”¨getæ–¹æ³•è·å–æŸä¸ªé”®å¯¹åº”çš„å€¼ï¼Œä¹Ÿå¯ä»¥é€šè¿‡containsKeyæ–¹æ³•æŸ¥çœ‹æŸä¸ªé”®æ˜¯å¦å­˜åœ¨ç­‰</li></ul><h2 id="20-ConcurrentHashMapæ€ä¹ˆå®ç°çš„ï¼Ÿ"><a href="#20-ConcurrentHashMapæ€ä¹ˆå®ç°çš„ï¼Ÿ" class="headerlink" title="20.ConcurrentHashMapæ€ä¹ˆå®ç°çš„ï¼Ÿ"></a>20.ConcurrentHashMapæ€ä¹ˆå®ç°çš„ï¼Ÿ</h2><blockquote><p>JDK 1.7 ConcurrentHashMap</p></blockquote><p>åœ¨ JDK 1.7 ä¸­å®ƒä½¿ç”¨çš„æ˜¯<strong>æ•°ç»„åŠ é“¾è¡¨çš„å½¢å¼</strong>å®ç°çš„ï¼Œè€Œæ•°ç»„åˆåˆ†ä¸ºï¼š<strong>å¤§æ•°ç»„ Segment å’Œå°æ•°ç»„ HashEntry</strong>ã€‚ Segment æ˜¯ä¸€ç§<strong>å¯é‡å…¥é”</strong>ï¼ˆReentrantLockï¼‰ï¼Œåœ¨ ConcurrentHashMap é‡Œæ‰®æ¼”é”çš„è§’è‰²ï¼›<strong>HashEntry åˆ™ç”¨äºå­˜å‚¨é”®å€¼å¯¹æ•°æ®ã€‚ä¸€ä¸ª ConcurrentHashMap é‡ŒåŒ…å«ä¸€ä¸ª Segment æ•°ç»„ï¼Œä¸€ä¸ª Segment é‡ŒåŒ…å«ä¸€ä¸ª HashEntry æ•°ç»„ï¼Œæ¯ä¸ª HashEntry æ˜¯ä¸€ä¸ªé“¾è¡¨ç»“æ„çš„å…ƒç´ ã€‚</strong></p><p><img src="https://cdn.xiaolincoding.com//picgo/1721807523151-41ad316a-6264-48e8-9704-5b362bc0083c.webp" alt="img"></p><p>JDK 1.7 ConcurrentHashMap <strong>åˆ†æ®µé”æŠ€æœ¯å°†æ•°æ®åˆ†æˆä¸€æ®µä¸€æ®µçš„å­˜å‚¨ï¼Œç„¶åç»™æ¯ä¸€æ®µæ•°æ®é…ä¸€æŠŠé”ï¼Œå½“ä¸€ä¸ªçº¿ç¨‹å ç”¨é”è®¿é—®å…¶ä¸­ä¸€ä¸ªæ®µæ•°æ®çš„æ—¶å€™ï¼Œå…¶ä»–æ®µçš„æ•°æ®ä¹Ÿèƒ½è¢«å…¶ä»–çº¿ç¨‹è®¿é—®ï¼Œèƒ½å¤Ÿå®ç°çœŸæ­£çš„å¹¶å‘è®¿é—®ã€‚</strong></p><blockquote><p>JDK 1.8 ConcurrentHashMap</p></blockquote><p>åœ¨ JDK 1.7 ä¸­ï¼ŒConcurrentHashMap è™½ç„¶æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œ<strong>ä½†å› ä¸ºå®ƒçš„åº•å±‚å®ç°æ˜¯æ•°ç»„ + é“¾è¡¨çš„å½¢å¼ï¼Œæ‰€ä»¥åœ¨æ•°æ®æ¯”è¾ƒå¤šçš„æƒ…å†µä¸‹è®¿é—®æ˜¯å¾ˆæ…¢çš„ï¼Œå› ä¸ºè¦éå†æ•´ä¸ªé“¾è¡¨</strong>ï¼Œè€Œ JDK 1.8 åˆ™ä½¿ç”¨äº†æ•°ç»„ + é“¾è¡¨/çº¢é»‘æ ‘çš„æ–¹å¼ä¼˜åŒ–äº† ConcurrentHashMap çš„å®ç°ï¼Œå…·ä½“å®ç°ç»“æ„å¦‚ä¸‹ï¼š</p><p><img src="https://cdn.xiaolincoding.com//picgo/1721807523128-7b1419e7-e6ba-47e6-aba0-8b29423a8ce7.webp" alt="img"></p><p>JDK 1.8 ConcurrentHashMap JDK 1.8 ConcurrentHashMap <strong>ä¸»è¦é€šè¿‡ volatile + CAS æˆ–è€… synchronized æ¥å®ç°çš„çº¿ç¨‹å®‰å…¨çš„</strong>ã€‚æ·»åŠ å…ƒç´ æ—¶é¦–å…ˆä¼šåˆ¤æ–­å®¹å™¨æ˜¯å¦ä¸ºç©ºï¼š</p><ul><li>å¦‚æœä¸ºç©ºåˆ™ä½¿ç”¨ volatile åŠ  CAS æ¥åˆå§‹åŒ–</li><li>å¦‚æœå®¹å™¨ä¸ä¸ºç©ºï¼Œåˆ™æ ¹æ®å­˜å‚¨çš„å…ƒç´ è®¡ç®—è¯¥ä½ç½®æ˜¯å¦ä¸ºç©ºã€‚<ul><li>å¦‚æœæ ¹æ®å­˜å‚¨çš„å…ƒç´ è®¡ç®—ç»“æœä¸ºç©ºï¼Œåˆ™åˆ©ç”¨ CAS è®¾ç½®è¯¥èŠ‚ç‚¹ï¼›</li><li>å¦‚æœæ ¹æ®å­˜å‚¨çš„å…ƒç´ è®¡ç®—ç»“æœä¸ä¸ºç©ºï¼Œ<strong>åˆ™ä½¿ç”¨ synchronized ï¼Œç„¶åï¼Œéå†æ¡¶ä¸­çš„æ•°æ®ï¼Œå¹¶æ›¿æ¢æˆ–æ–°å¢èŠ‚ç‚¹åˆ°æ¡¶ä¸­</strong>ï¼Œæœ€åå†åˆ¤æ–­æ˜¯å¦éœ€è¦è½¬ä¸ºçº¢é»‘æ ‘ï¼Œè¿™æ ·å°±èƒ½ä¿è¯å¹¶å‘è®¿é—®æ—¶çš„çº¿ç¨‹å®‰å…¨äº†ã€‚</li></ul></li></ul><p>å¦‚æœæŠŠä¸Šé¢çš„æ‰§è¡Œç”¨ä¸€å¥è¯å½’çº³çš„è¯ï¼Œ<strong>å°±ç›¸å½“äºæ˜¯ConcurrentHashMapé€šè¿‡å¯¹å¤´ç»“ç‚¹åŠ é”æ¥ä¿è¯çº¿ç¨‹å®‰å…¨çš„ï¼Œé”çš„ç²’åº¦ç›¸æ¯” Segment æ¥è¯´æ›´å°äº†ï¼Œå‘ç”Ÿå†²çªå’ŒåŠ é”çš„é¢‘ç‡é™ä½äº†ï¼Œå¹¶å‘æ“ä½œçš„æ€§èƒ½å°±æé«˜äº†ã€‚</strong></p><p>è€Œä¸” JDK 1.8 ä½¿ç”¨çš„æ˜¯çº¢é»‘æ ‘ä¼˜åŒ–äº†ä¹‹å‰çš„å›ºå®šé“¾è¡¨ï¼Œé‚£ä¹ˆå½“æ•°æ®é‡æ¯”è¾ƒå¤§çš„æ—¶å€™ï¼ŒæŸ¥è¯¢æ€§èƒ½ä¹Ÿå¾—åˆ°äº†å¾ˆå¤§çš„æå‡ï¼Œä»ä¹‹å‰çš„ O(n) ä¼˜åŒ–åˆ°äº† O(logn) çš„æ—¶é—´å¤æ‚åº¦ã€‚</p><h2 id="21-åˆ†æ®µé”æ€ä¹ˆåŠ é”çš„ï¼Ÿ"><a href="#21-åˆ†æ®µé”æ€ä¹ˆåŠ é”çš„ï¼Ÿ" class="headerlink" title="21.åˆ†æ®µé”æ€ä¹ˆåŠ é”çš„ï¼Ÿ"></a>21.åˆ†æ®µé”æ€ä¹ˆåŠ é”çš„ï¼Ÿ</h2><p>åœ¨ ConcurrentHashMap ä¸­ï¼Œå°†æ•´ä¸ªæ•°æ®ç»“æ„åˆ†ä¸º<strong>å¤šä¸ª Segmentï¼Œæ¯ä¸ª Segment éƒ½ç±»ä¼¼äºä¸€ä¸ªå°çš„ HashMapï¼Œ</strong>æ¯ä¸ª Segment éƒ½æœ‰è‡ªå·±çš„é”ï¼Œä¸åŒ Segment ä¹‹é—´çš„æ“ä½œäº’ä¸å½±å“ï¼Œä»è€Œæé«˜å¹¶å‘æ€§èƒ½ã€‚</p><p>åœ¨ ConcurrentHashMap ä¸­ï¼Œå¯¹äºæ’å…¥ã€æ›´æ–°ã€åˆ é™¤ç­‰æ“ä½œï¼Œ<strong>éœ€è¦å…ˆå®šä½åˆ°å…·ä½“çš„ Segmentï¼Œç„¶åå†åœ¨è¯¥ Segment ä¸ŠåŠ é”ï¼Œ</strong>è€Œä¸æ˜¯åƒä¼ ç»Ÿçš„ HashMap ä¸€æ ·å¯¹æ•´ä¸ªæ•°æ®ç»“æ„åŠ é”ã€‚è¿™æ ·å¯ä»¥ä½¿å¾—ä¸åŒ Segment ä¹‹é—´çš„æ“ä½œå¹¶è¡Œè¿›è¡Œï¼Œæé«˜äº†å¹¶å‘æ€§èƒ½ã€‚</p><h2 id="22-å·²ç»ç”¨äº†synchronizedï¼Œä¸ºä»€ä¹ˆè¿˜è¦ç”¨CASå‘¢ï¼Ÿ"><a href="#22-å·²ç»ç”¨äº†synchronizedï¼Œä¸ºä»€ä¹ˆè¿˜è¦ç”¨CASå‘¢ï¼Ÿ" class="headerlink" title="22.å·²ç»ç”¨äº†synchronizedï¼Œä¸ºä»€ä¹ˆè¿˜è¦ç”¨CASå‘¢ï¼Ÿ"></a>22.å·²ç»ç”¨äº†synchronizedï¼Œä¸ºä»€ä¹ˆè¿˜è¦ç”¨CASå‘¢ï¼Ÿ</h2><p>ConcurrentHashMapä½¿ç”¨è¿™ä¸¤ç§æ‰‹æ®µæ¥ä¿è¯çº¿ç¨‹å®‰å…¨ä¸»è¦æ˜¯ä¸€ç§æƒè¡¡çš„è€ƒè™‘ï¼Œåœ¨æŸäº›æ“ä½œä¸­ä½¿ç”¨synchronizedï¼Œè¿˜æ˜¯ä½¿ç”¨CASï¼Œ<strong>ä¸»è¦æ˜¯æ ¹æ®é”ç«äº‰ç¨‹åº¦æ¥åˆ¤æ–­çš„</strong>ã€‚</p><p>æ¯”å¦‚ï¼šåœ¨putValä¸­ï¼Œå¦‚æœ<strong>è®¡ç®—å‡ºæ¥çš„hashæ§½æ²¡æœ‰å­˜æ”¾å…ƒç´ ï¼Œé‚£ä¹ˆå°±å¯ä»¥ç›´æ¥ä½¿ç”¨CASæ¥è¿›è¡Œè®¾ç½®å€¼</strong>ï¼Œè¿™æ˜¯å› ä¸ºåœ¨è®¾ç½®å…ƒç´ çš„æ—¶å€™ï¼Œå› ä¸ºhashå€¼ç»è¿‡äº†å„ç§æ‰°åŠ¨åï¼Œé€ æˆhashç¢°æ’çš„å‡ ç‡è¾ƒä½ï¼Œ<strong>é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥é¢„æµ‹ä½¿ç”¨è¾ƒå°‘çš„è‡ªæ—‹æ¥å®Œæˆå…·ä½“çš„hashè½æ§½æ“ä½œã€‚</strong></p><p>å½“<strong>å‘ç”Ÿäº†hashç¢°æ’çš„æ—¶å€™è¯´æ˜å®¹é‡ä¸å¤Ÿç”¨äº†æˆ–è€…å·²ç»æœ‰å¤§é‡çº¿ç¨‹è®¿é—®äº†</strong>ï¼Œå› æ­¤è¿™æ—¶å€™ä½¿ç”¨<strong>synchronizedæ¥å¤„ç†hashç¢°æ’æ¯”CASæ•ˆç‡è¦é«˜ï¼Œå› ä¸ºå‘ç”Ÿäº†hashç¢°æ’å¤§æ¦‚ç‡æ¥è¯´æ˜¯çº¿ç¨‹ç«äº‰æ¯”è¾ƒå¼ºçƒˆã€‚</strong></p><h2 id="23-ConcurrentHashMapç”¨äº†æ‚²è§‚é”è¿˜æ˜¯ä¹è§‚é”"><a href="#23-ConcurrentHashMapç”¨äº†æ‚²è§‚é”è¿˜æ˜¯ä¹è§‚é”" class="headerlink" title="23.ConcurrentHashMapç”¨äº†æ‚²è§‚é”è¿˜æ˜¯ä¹è§‚é”?"></a>23.ConcurrentHashMapç”¨äº†æ‚²è§‚é”è¿˜æ˜¯ä¹è§‚é”?</h2><p>æ‚²è§‚é”å’Œä¹è§‚é”éƒ½æœ‰ç”¨åˆ°ã€‚</p><p>æ·»åŠ å…ƒç´ æ—¶é¦–å…ˆä¼šåˆ¤æ–­å®¹å™¨æ˜¯å¦ä¸ºç©ºï¼š</p><ul><li>å¦‚æœä¸ºç©ºåˆ™ä½¿ç”¨ volatile åŠ  <strong>CAS ï¼ˆä¹è§‚é”ï¼‰</strong> æ¥åˆå§‹åŒ–ã€‚</li><li>å¦‚æœå®¹å™¨ä¸ä¸ºç©ºï¼Œåˆ™<strong>æ ¹æ®å­˜å‚¨çš„å…ƒç´ è®¡ç®—è¯¥ä½ç½®æ˜¯å¦ä¸ºç©ºã€‚</strong></li><li>å¦‚æœæ ¹æ®å­˜å‚¨çš„å…ƒç´ è®¡ç®—ç»“æœä¸ºç©ºï¼Œåˆ™åˆ©ç”¨ <strong>CASï¼ˆä¹è§‚é”ï¼‰</strong> è®¾ç½®è¯¥èŠ‚ç‚¹ï¼›</li><li>å¦‚æœæ ¹æ®å­˜å‚¨çš„å…ƒç´ è®¡ç®—ç»“æœä¸ä¸ºç©ºï¼Œåˆ™ä½¿ç”¨ <strong>synchronizedï¼ˆæ‚²è§‚é”ï¼‰</strong> ï¼Œç„¶åï¼Œéå†æ¡¶ä¸­çš„æ•°æ®ï¼Œå¹¶æ›¿æ¢æˆ–æ–°å¢èŠ‚ç‚¹åˆ°æ¡¶ä¸­ï¼Œæœ€åå†åˆ¤æ–­æ˜¯å¦éœ€è¦è½¬ä¸ºçº¢é»‘æ ‘ï¼Œè¿™æ ·å°±èƒ½ä¿è¯å¹¶å‘è®¿é—®æ—¶çš„çº¿ç¨‹å®‰å…¨äº†ã€‚</li></ul><h2 id="24-HashTable-åº•å±‚å®ç°åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#24-HashTable-åº•å±‚å®ç°åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="24.HashTable åº•å±‚å®ç°åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ"></a>24.HashTable åº•å±‚å®ç°åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ</h2><ul><li>Hashtableçš„åº•å±‚æ•°æ®ç»“æ„ä¸»è¦æ˜¯<strong>æ•°ç»„åŠ ä¸Šé“¾è¡¨</strong>ï¼Œæ•°ç»„æ˜¯ä¸»ä½“ï¼Œ<strong>é“¾è¡¨æ˜¯è§£å†³hashå†²çªå­˜åœ¨çš„ã€‚</strong></li><li>HashTableæ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå®ç°æ–¹å¼æ˜¯<strong>Hashtableçš„æ‰€æœ‰å…¬å…±æ–¹æ³•å‡é‡‡ç”¨synchronizedå…³é”®å­—</strong>ï¼Œå½“ä¸€ä¸ªçº¿ç¨‹è®¿é—®åŒæ­¥æ–¹æ³•ï¼Œå¦ä¸€ä¸ªçº¿ç¨‹ä¹Ÿè®¿é—®çš„æ—¶å€™ï¼Œå°±ä¼šé™·å…¥é˜»å¡æˆ–è€…è½®è¯¢çš„çŠ¶æ€ã€‚</li></ul><p><img src="https://cdn.xiaolincoding.com//picgo/1719982934770-8587cb0a-6e1d-4007-9a22-bc1e41276491.png" alt=""></p><h2 id="25-HashTableçº¿ç¨‹å®‰å…¨æ˜¯æ€ä¹ˆå®ç°çš„ï¼Ÿ"><a href="#25-HashTableçº¿ç¨‹å®‰å…¨æ˜¯æ€ä¹ˆå®ç°çš„ï¼Ÿ" class="headerlink" title="25.HashTableçº¿ç¨‹å®‰å…¨æ˜¯æ€ä¹ˆå®ç°çš„ï¼Ÿ"></a>25.HashTableçº¿ç¨‹å®‰å…¨æ˜¯æ€ä¹ˆå®ç°çš„ï¼Ÿ</h2><p>å› ä¸ºå®ƒçš„putï¼Œgetåšæˆäº†åŒæ­¥æ–¹æ³•ï¼Œä¿è¯äº†Hashtableçš„çº¿ç¨‹å®‰å…¨æ€§ï¼Œæ¯ä¸ªæ“ä½œæ•°æ®çš„æ–¹æ³•éƒ½è¿›è¡ŒåŒæ­¥æ§åˆ¶ä¹‹åï¼Œç”±æ­¤å¸¦æ¥çš„é—®é¢˜ä»»ä½•ä¸€ä¸ªæ—¶åˆ»<strong>åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥æ“çºµHashtableï¼Œæ‰€ä»¥å…¶æ•ˆç‡æ¯”è¾ƒä½</strong>ã€‚</p><p>Hashtable çš„ put(K key, V value) å’Œ get(Object key) æ–¹æ³•çš„æºç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">synchronized</span> V <span class="title function_">put</span><span class="params">(K key, V value)</span> &#123;</span><br><span class="line"><span class="comment">// Make sure the value is not null</span></span><br><span class="line"><span class="keyword">if</span> (value == <span class="literal">null</span>) &#123;</span><br><span class="line">    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">NullPointerException</span>();</span><br><span class="line">&#125;</span><br><span class="line"> <span class="comment">// Makes sure the key is not already in the hashtable.</span></span><br><span class="line">Entry&lt;?,?&gt; tab[] = table;</span><br><span class="line"><span class="type">int</span> <span class="variable">hash</span> <span class="operator">=</span> key.hashCode();</span><br><span class="line"><span class="type">int</span> <span class="variable">index</span> <span class="operator">=</span> (hash &amp; <span class="number">0x7FFFFFFF</span>) % tab.length;</span><br><span class="line"><span class="meta">@SuppressWarnings(&quot;unchecked&quot;)</span></span><br><span class="line">Entry&lt;K,V&gt; entry = (Entry&lt;K,V&gt;)tab[index];</span><br><span class="line"><span class="keyword">for</span>(; entry != <span class="literal">null</span> ; entry = entry.next) &#123;</span><br><span class="line">    <span class="keyword">if</span> ((entry.hash == hash) &amp;&amp; entry.key.equals(key)) &#123;</span><br><span class="line">        <span class="type">V</span> <span class="variable">old</span> <span class="operator">=</span> entry.value;</span><br><span class="line">        entry.value = value;</span><br><span class="line">        <span class="keyword">return</span> old;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"> addEntry(hash, key, value, index);</span><br><span class="line"><span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">synchronized</span> V <span class="title function_">get</span><span class="params">(Object key)</span> &#123;</span><br><span class="line">Entry&lt;?,?&gt; tab[] = table;</span><br><span class="line"><span class="type">int</span> <span class="variable">hash</span> <span class="operator">=</span> key.hashCode();</span><br><span class="line"><span class="type">int</span> <span class="variable">index</span> <span class="operator">=</span> (hash &amp; <span class="number">0x7FFFFFFF</span>) % tab.length;</span><br><span class="line"><span class="keyword">for</span> (Entry&lt;?,?&gt; e = tab[index] ; e != <span class="literal">null</span> ; e = e.next) &#123;</span><br><span class="line">    <span class="keyword">if</span> ((e.hash == hash) &amp;&amp; e.key.equals(key)) &#123;</span><br><span class="line">        <span class="keyword">return</span> (V)e.value;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œ<strong>Hashtableæ˜¯é€šè¿‡ä½¿ç”¨äº† synchronized å…³é”®å­—æ¥ä¿è¯å…¶çº¿ç¨‹å®‰å…¨</strong>ã€‚</p><p>åœ¨Javaä¸­ï¼Œå¯ä»¥ä½¿ç”¨synchronizedå…³é”®å­—æ¥æ ‡è®°ä¸€ä¸ªæ–¹æ³•æˆ–è€…ä»£ç å—ï¼Œ<strong>å½“æŸä¸ªçº¿ç¨‹è°ƒç”¨è¯¥å¯¹è±¡çš„synchronizedæ–¹æ³•æˆ–è€…è®¿é—®synchronizedä»£ç å—æ—¶ï¼Œè¿™ä¸ªçº¿ç¨‹ä¾¿è·å¾—äº†è¯¥å¯¹è±¡çš„é”ï¼Œå…¶ä»–çº¿ç¨‹æš‚æ—¶æ— æ³•è®¿é—®è¿™ä¸ªæ–¹æ³•ï¼Œåªæœ‰ç­‰å¾…è¿™ä¸ªæ–¹æ³•æ‰§è¡Œå®Œæ¯•æˆ–è€…ä»£ç å—æ‰§è¡Œå®Œæ¯•ï¼Œè¿™ä¸ªçº¿ç¨‹æ‰ä¼šé‡Šæ”¾è¯¥å¯¹è±¡çš„é”ï¼Œå…¶ä»–çº¿ç¨‹æ‰èƒ½æ‰§è¡Œè¿™ä¸ªæ–¹æ³•æˆ–è€…ä»£ç å—ã€‚</strong></p><h2 id="26-è¯´ä¸€ä¸‹HashMapå’ŒHashtableã€ConcurrentMapçš„åŒºåˆ«"><a href="#26-è¯´ä¸€ä¸‹HashMapå’ŒHashtableã€ConcurrentMapçš„åŒºåˆ«" class="headerlink" title="26.è¯´ä¸€ä¸‹HashMapå’ŒHashtableã€ConcurrentMapçš„åŒºåˆ«"></a>26.è¯´ä¸€ä¸‹HashMapå’ŒHashtableã€ConcurrentMapçš„åŒºåˆ«</h2><ul><li>HashMap<strong>çº¿ç¨‹ä¸å®‰å…¨</strong>ï¼Œæ•ˆç‡é«˜ä¸€ç‚¹ï¼Œ<strong>å¯ä»¥å­˜å‚¨nullçš„keyå’Œvalueï¼Œnullçš„keyåªèƒ½æœ‰ä¸€ä¸ªï¼Œnullçš„valueå¯ä»¥æœ‰å¤šä¸ª</strong>ã€‚é»˜è®¤åˆå§‹å®¹é‡ä¸º16ï¼Œæ¯æ¬¡æ‰©å……å˜ä¸ºåŸæ¥2å€ã€‚åˆ›å»ºæ—¶å¦‚æœç»™å®šäº†åˆå§‹å®¹é‡ï¼Œåˆ™æ‰©å……ä¸º2çš„å¹‚æ¬¡æ–¹å¤§å°ã€‚åº•å±‚æ•°æ®ç»“æ„ä¸ºæ•°ç»„+é“¾è¡¨ï¼Œæ’å…¥å…ƒç´ åå¦‚æœé“¾è¡¨é•¿åº¦å¤§äºé˜ˆå€¼ï¼ˆé»˜è®¤ä¸º8ï¼‰ï¼Œå…ˆåˆ¤æ–­æ•°ç»„é•¿åº¦æ˜¯å¦å°äº64ï¼Œå¦‚æœå°äºï¼Œåˆ™æ‰©å……æ•°ç»„ï¼Œåä¹‹å°†é“¾è¡¨è½¬åŒ–ä¸ºçº¢é»‘æ ‘ï¼Œä»¥å‡å°‘æœç´¢æ—¶é—´ã€‚</li><li>HashTableçº¿ç¨‹å®‰å…¨ï¼Œæ•ˆç‡ä½ä¸€ç‚¹ï¼Œ<strong>å…¶å†…éƒ¨æ–¹æ³•åŸºæœ¬éƒ½ç»è¿‡synchronizedä¿®é¥°</strong>ï¼Œä¸å¯ä»¥æœ‰nullçš„keyå’Œvalueã€‚<strong>é»˜è®¤åˆå§‹å®¹é‡ä¸º11</strong>ï¼Œæ¯æ¬¡æ‰©å®¹å˜ä¸ºåŸæ¥çš„2n+1ã€‚åˆ›å»ºæ—¶ç»™å®šäº†åˆå§‹å®¹é‡ï¼Œä¼šç›´æ¥ç”¨ç»™å®šçš„å¤§å°ã€‚åº•å±‚æ•°æ®ç»“æ„ä¸ºæ•°ç»„+é“¾è¡¨ã€‚å®ƒåŸºæœ¬è¢«æ·˜æ±°äº†ï¼Œè¦ä¿è¯çº¿ç¨‹å®‰å…¨å¯ä»¥ç”¨ConcurrentHashMapã€‚</li><li>ConcurrentHashMapæ˜¯Javaä¸­çš„ä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„å“ˆå¸Œè¡¨å®ç°ï¼Œå®ƒå¯ä»¥åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹å¹¶å‘åœ°è¿›è¡Œè¯»å†™æ“ä½œï¼Œè€Œä¸éœ€è¦åƒä¼ ç»Ÿçš„HashTableé‚£æ ·åœ¨è¯»å†™æ—¶åŠ é”ã€‚ConcurrentHashMapçš„<strong>å®ç°åŸç†ä¸»è¦åŸºäºåˆ†æ®µé”å’ŒCASæ“ä½œ</strong>ã€‚å®ƒå°†æ•´ä¸ªå“ˆå¸Œè¡¨åˆ†æˆäº†å¤šSegmentï¼ˆæ®µï¼‰ï¼Œæ¯ä¸ªSegmentéƒ½ç±»ä¼¼äºä¸€ä¸ªå°çš„HashMapï¼Œå®ƒæ‹¥æœ‰è‡ªå·±çš„æ•°ç»„å’Œä¸€ä¸ªç‹¬ç«‹çš„é”ã€‚<strong>åœ¨ConcurrentHashMapä¸­ï¼Œè¯»æ“ä½œä¸éœ€è¦é”ï¼Œå¯ä»¥ç›´æ¥å¯¹Segmentè¿›è¡Œè¯»å–ï¼Œè€Œå†™æ“ä½œåˆ™åªéœ€è¦é”å®šå¯¹åº”çš„Segmentï¼Œè€Œä¸æ˜¯æ•´ä¸ªå“ˆå¸Œè¡¨ï¼Œè¿™æ ·å¯ä»¥å¤§å¤§æé«˜å¹¶å‘æ€§èƒ½ã€‚</strong></li></ul><h2 id="27-è¯´è¯´concurrenthashmapå’Œhashmapçš„åŒºåˆ«ï¼Œè¯´è¯´copyonwritearraylistï¼Œcopyonwriteä¼šåŠ é”å—ï¼Ÿ"><a href="#27-è¯´è¯´concurrenthashmapå’Œhashmapçš„åŒºåˆ«ï¼Œè¯´è¯´copyonwritearraylistï¼Œcopyonwriteä¼šåŠ é”å—ï¼Ÿ" class="headerlink" title="27.è¯´è¯´concurrenthashmapå’Œhashmapçš„åŒºåˆ«ï¼Œè¯´è¯´copyonwritearraylistï¼Œcopyonwriteä¼šåŠ é”å—ï¼Ÿ"></a>27.è¯´è¯´concurrenthashmapå’Œhashmapçš„åŒºåˆ«ï¼Œè¯´è¯´copyonwritearraylistï¼Œcopyonwriteä¼šåŠ é”å—ï¼Ÿ</h2><p><strong>HashMap</strong>ï¼š<strong>éçº¿ç¨‹å®‰å…¨</strong>ï¼Œåœ¨å¹¶å‘å†™å…¥æ—¶å¯èƒ½å¯¼è‡´æ•°æ®ä¸ä¸€è‡´ï¼Œç”šè‡³æ­»å¾ªç¯ï¼ˆJDK 1.7 é“¾è¡¨è½¬æˆç¯å½¢ï¼‰ã€‚</p><p><strong>ConcurrentHashMap</strong>ï¼š<strong>çº¿ç¨‹å®‰å…¨</strong>ï¼Œå†…éƒ¨é€šè¿‡åˆ†æ®µé”ï¼ˆJDK 1.7ï¼‰æˆ– <strong>CAS + synchronizedï¼ˆJDK 1.8ï¼‰</strong> å®ç°å¹¶å‘è®¿é—®æ§åˆ¶ã€‚</p><p><code>ConcurrentHashMap</code> ç”¨ <strong>CAS + synchronized</strong> æ§åˆ¶ç²’åº¦ç»†çš„å†™æ“ä½œ</p><p>ä½¿ç”¨ <code>Node</code> æ•°ç»„ + é“¾è¡¨ + çº¢é»‘æ ‘ç»“æ„ï¼Œæå‡æŸ¥è¯¢æ•ˆç‡</p><p>è¯»æ“ä½œï¼ˆå¦‚ <code>get</code>ï¼‰<strong>æ— é”</strong></p><p>å†™æ“ä½œï¼ˆå¦‚ <code>put/remove</code>ï¼‰ä½¿ç”¨ <code>synchronized</code> ä»…é”ä½<strong>å½“å‰æ¡¶</strong></p><div class="table-container"><table><thead><tr><th>ç‰¹æ€§</th><th>HashMap</th><th>ConcurrentHashMap</th></tr></thead><tbody><tr><td>çº¿ç¨‹å®‰å…¨</td><td>âŒ å¦</td><td>âœ… æ˜¯</td></tr><tr><td>åº•å±‚ç»“æ„</td><td>æ•°ç»„ + é“¾è¡¨/çº¢é»‘æ ‘</td><td>ç›¸åŒï¼Œä½†åŠ äº†çº¿ç¨‹å®‰å…¨æ§åˆ¶</td></tr><tr><td>å¹¶å‘æœºåˆ¶</td><td>æ— </td><td>åˆ†æ®µé”ï¼ˆ1.7ï¼‰ï¼ŒCAS+é”ï¼ˆ1.8ï¼‰</td></tr><tr><td>å…è®¸ null key/value</td><td>âœ… æ˜¯</td><td>âŒ éƒ½ä¸å…è®¸</td></tr></tbody></table></div><p>CopyOnWriteArrayList</p><ul><li>å†™æ—¶å¤åˆ¶ï¼Œè¯»æ— é”ï¼Œ<strong>å†™æ“ä½œåŠ é”</strong></li><li>é€‚åˆ<strong>è¯»å¤šå†™å°‘</strong>åœºæ™¯</li><li>ä¸é€‚åˆé¢‘ç¹å†™å…¥ï¼ˆå¤åˆ¶å¼€é”€å¤§</li></ul><p>æ˜¯çš„ï¼Œ<strong><code>CopyOnWriteArrayList</code> çš„å†™æ“ä½œä¼šåŠ é”</strong>ï¼Œä½¿ç”¨çš„æ˜¯ <strong><code>ReentrantLock</code></strong></p><blockquote><p><strong>å†™æ“ä½œæ—¶å¤åˆ¶æ•°ç»„ï¼Œä¿®æ”¹æ–°æ•°ç»„ï¼Œæœ€åæ›¿æ¢åŸæ•°ç»„å¼•ç”¨</strong>ã€‚</p></blockquote><p>ä¸ºäº†ä¿è¯â€œå¤åˆ¶ + ä¿®æ”¹ + æ›¿æ¢â€è¿™æ•´ä¸ªè¿‡ç¨‹æ˜¯<strong>åŸå­çš„ã€çº¿ç¨‹å®‰å…¨çš„</strong>ï¼Œå°±å¿…é¡»åœ¨å†™æ“ä½œæ—¶åŠ é”ã€‚</p><h1 id="Set"><a href="#Set" class="headerlink" title="Set"></a>Set</h1><h2 id="1-Seté›†åˆæœ‰ä»€ä¹ˆç‰¹ç‚¹ï¼Ÿå¦‚ä½•å®ç°keyæ— é‡å¤çš„ï¼Ÿ"><a href="#1-Seté›†åˆæœ‰ä»€ä¹ˆç‰¹ç‚¹ï¼Ÿå¦‚ä½•å®ç°keyæ— é‡å¤çš„ï¼Ÿ" class="headerlink" title="1.Seté›†åˆæœ‰ä»€ä¹ˆç‰¹ç‚¹ï¼Ÿå¦‚ä½•å®ç°keyæ— é‡å¤çš„ï¼Ÿ"></a>1.Seté›†åˆæœ‰ä»€ä¹ˆç‰¹ç‚¹ï¼Ÿå¦‚ä½•å®ç°keyæ— é‡å¤çš„ï¼Ÿ</h2><ul><li><strong>seté›†åˆç‰¹ç‚¹</strong>ï¼šSeté›†åˆä¸­çš„å…ƒç´ æ˜¯<strong>å”¯ä¸€</strong>çš„ï¼Œä¸ä¼šå‡ºç°é‡å¤çš„å…ƒç´ ã€‚</li><li><strong>setå®ç°åŸç†</strong>ï¼šSeté›†åˆé€šè¿‡<strong>å†…éƒ¨çš„æ•°æ®ç»“æ„ï¼ˆå¦‚å“ˆå¸Œè¡¨ã€çº¢é»‘æ ‘ç­‰ï¼‰æ¥å®ç°keyçš„æ— é‡å¤ã€‚</strong>å½“å‘Seté›†åˆä¸­æ’å…¥å…ƒç´ æ—¶ï¼Œä¼š<strong>å…ˆæ ¹æ®å…ƒç´ çš„hashCodeå€¼æ¥ç¡®å®šå…ƒç´ çš„å­˜å‚¨ä½ç½®ï¼Œç„¶åå†é€šè¿‡equalsæ–¹æ³•æ¥åˆ¤æ–­æ˜¯å¦å·²ç»å­˜åœ¨ç›¸åŒçš„å…ƒç´ </strong>ï¼Œå¦‚æœå­˜åœ¨åˆ™ä¸ä¼šå†æ¬¡æ’å…¥ï¼Œä¿è¯äº†å…ƒç´ çš„å”¯ä¸€æ€§ã€‚</li></ul><h2 id="2-æœ‰åºçš„Setæ˜¯ä»€ä¹ˆï¼Ÿè®°å½•æ’å…¥é¡ºåºçš„é›†åˆæ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#2-æœ‰åºçš„Setæ˜¯ä»€ä¹ˆï¼Ÿè®°å½•æ’å…¥é¡ºåºçš„é›†åˆæ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="2.æœ‰åºçš„Setæ˜¯ä»€ä¹ˆï¼Ÿè®°å½•æ’å…¥é¡ºåºçš„é›†åˆæ˜¯ä»€ä¹ˆï¼Ÿ"></a>2.æœ‰åºçš„Setæ˜¯ä»€ä¹ˆï¼Ÿè®°å½•æ’å…¥é¡ºåºçš„é›†åˆæ˜¯ä»€ä¹ˆï¼Ÿ</h2><ul><li><strong>æœ‰åºçš„ Set æ˜¯TreeSetå’ŒLinkedHashSet</strong>ã€‚<strong>TreeSetæ˜¯åŸºäºçº¢é»‘æ ‘å®ç°ï¼Œä¿è¯å…ƒç´ çš„è‡ªç„¶é¡ºåºã€‚LinkedHashSetæ˜¯åŸºäºåŒé‡é“¾è¡¨å’Œå“ˆå¸Œè¡¨çš„ç»“åˆæ¥å®ç°å…ƒç´ çš„æœ‰åºå­˜å‚¨ï¼Œä¿è¯å…ƒç´ æ·»åŠ çš„è‡ªç„¶é¡ºåº</strong></li><li><strong>è®°å½•æ’å…¥é¡ºåºçš„é›†åˆé€šå¸¸æŒ‡çš„æ˜¯LinkedHashSet</strong>ï¼Œå®ƒä¸ä»…ä¿è¯å…ƒç´ çš„å”¯ä¸€æ€§ï¼Œ<strong>è¿˜å¯ä»¥ä¿æŒå…ƒç´ çš„æ’å…¥é¡ºåº</strong>ã€‚å½“éœ€è¦åœ¨Seté›†åˆä¸­è®°å½•å…ƒç´ çš„æ’å…¥é¡ºåºæ—¶ï¼Œå¯ä»¥é€‰æ‹©ä½¿ç”¨LinkedHashSetæ¥å®ç°ã€‚</li></ul>]]></content:encoded>
      
      
      <category domain="https://blog.tokenlen.top/categories/javase/">javase</category>
      
      <category domain="https://blog.tokenlen.top/categories/javase/java/">java</category>
      
      
      <category domain="https://blog.tokenlen.top/tags/java/">java</category>
      
      <category domain="https://blog.tokenlen.top/tags/%E9%9D%A2%E8%AF%95/">é¢è¯•</category>
      
      
      <comments>https://blog.tokenlen.top/2025/05/23/javase/javase3/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>JUC-çº¿ç¨‹æ± é¢è¯•é¢˜hot</title>
      <link>https://blog.tokenlen.top/2025/05/22/java-stack/juc2/</link>
      <guid>https://blog.tokenlen.top/2025/05/22/java-stack/juc2/</guid>
      <pubDate>Wed, 21 May 2025 16:00:00 GMT</pubDate>
      
        
        
          
          
      <description>&lt;h1 id=&quot;çº¿ç¨‹æ± &quot;&gt;&lt;a href=&quot;#çº¿ç¨‹æ± &quot; class=&quot;headerlink&quot; title=&quot;çº¿ç¨‹æ± &quot;&gt;&lt;/a&gt;çº¿ç¨‹æ± &lt;/h1&gt;&lt;h2 id=&quot;1-çº¿ç¨‹æ± ç”¨è¿‡æ²¡æœ‰ï¼Ÿ-è¯´è¯´ä»–çš„æ ¸å¿ƒå‚æ•°ï¼Ÿ&quot;&gt;&lt;a href=&quot;#1-çº¿ç¨‹æ± ç”¨è¿‡æ²¡æœ‰ï¼Ÿ-è¯´è¯´ä»–çš„æ ¸å¿ƒå‚æ•°ï¼Ÿ&quot;</description>
          
        
      
      
      
      <content:encoded><![CDATA[<h1 id="çº¿ç¨‹æ± "><a href="#çº¿ç¨‹æ± " class="headerlink" title="çº¿ç¨‹æ± "></a>çº¿ç¨‹æ± </h1><h2 id="1-çº¿ç¨‹æ± ç”¨è¿‡æ²¡æœ‰ï¼Ÿ-è¯´è¯´ä»–çš„æ ¸å¿ƒå‚æ•°ï¼Ÿ"><a href="#1-çº¿ç¨‹æ± ç”¨è¿‡æ²¡æœ‰ï¼Ÿ-è¯´è¯´ä»–çš„æ ¸å¿ƒå‚æ•°ï¼Ÿ" class="headerlink" title="1.çº¿ç¨‹æ± ç”¨è¿‡æ²¡æœ‰ï¼Ÿ è¯´è¯´ä»–çš„æ ¸å¿ƒå‚æ•°ï¼Ÿ"></a>1.çº¿ç¨‹æ± ç”¨è¿‡æ²¡æœ‰ï¼Ÿ è¯´è¯´ä»–çš„æ ¸å¿ƒå‚æ•°ï¼Ÿ</h2><p>çº¿ç¨‹åœ¨æ­£å¸¸æ‰§è¡Œæˆ–è€…å¼‚å¸¸ä¸­æ–­æ—¶ä¼šè¢«é”€æ¯ï¼Œå¦‚æœé¢‘ç¹çš„åˆ›å»ºå¾ˆå¤šçº¿ç¨‹ï¼Œä¸ä»…ä¼šæ¶ˆè€—ç³»ç»Ÿèµ„æºï¼Œè¿˜ä¼šé™ä½ç³»ç»Ÿçš„ç¨³å®šæ€§ï¼Œä¸€ä¸å°å¿ƒæŠŠç³»ç»Ÿæå´©äº†ã€‚</p><p>ä½¿ç”¨çº¿ç¨‹æ± å¯ä»¥å¸¦æ¥ä»¥ä¸‹å‡ ä¸ªå¥½å¤„ï¼š</p><ul><li>çº¿ç¨‹æ± å†…éƒ¨çš„çº¿ç¨‹æ•°æ˜¯å¯æ§çš„ï¼Œå¯ä»¥çµæ´»çš„è®¾ç½®å‚æ•°ï¼›</li><li>çº¿ç¨‹æ± å†…ä¼šä¿ç•™éƒ¨åˆ†çº¿ç¨‹ï¼Œå½“æäº¤æ–°çš„ä»»åŠ¡å¯ä»¥ç›´æ¥è¿è¡Œï¼›</li><li>æ–¹ä¾¿å†…éƒ¨çº¿ç¨‹èµ„æºçš„ç®¡ç†ï¼Œè°ƒä¼˜å’Œç›‘æ§ï¼›</li></ul><p><strong>ä¸ºäº†å‡å°‘é¢‘ç¹çš„åˆ›å»ºçº¿ç¨‹å’Œé”€æ¯çº¿ç¨‹å¸¦æ¥çš„æ€§èƒ½æŸè€—</strong></p><p>é¦–å…ˆï¼Œæ‰€æœ‰ä»»åŠ¡çš„è°ƒåº¦éƒ½æ˜¯ç”±<strong>execute</strong>æ–¹æ³•å®Œæˆçš„ï¼Œè¿™éƒ¨åˆ†å®Œæˆçš„å·¥ä½œæ˜¯ï¼šæ£€æŸ¥ç°åœ¨çº¿ç¨‹æ± çš„<strong>è¿è¡ŒçŠ¶æ€ã€è¿è¡Œçº¿ç¨‹æ•°ã€è¿è¡Œç­–ç•¥</strong>ï¼Œå†³å®šæ¥ä¸‹æ¥æ‰§è¡Œçš„æµç¨‹ï¼Œæ˜¯ç›´æ¥ç”³è¯·çº¿ç¨‹æ‰§è¡Œï¼Œæˆ–æ˜¯ç¼“å†²åˆ°é˜Ÿåˆ—ä¸­æ‰§è¡Œï¼Œäº¦æˆ–æ˜¯ç›´æ¥æ‹’ç»è¯¥ä»»åŠ¡ã€‚å…¶æ‰§è¡Œè¿‡ç¨‹å¦‚ä¸‹ï¼š</p><p>é¦–å…ˆæ£€æµ‹çº¿ç¨‹æ± è¿è¡ŒçŠ¶æ€ï¼Œå¦‚æœä¸æ˜¯<strong>RUNNING</strong>ï¼Œåˆ™ç›´æ¥æ‹’ç»ï¼Œçº¿ç¨‹æ± è¦ä¿è¯åœ¨RUNNINGçš„çŠ¶æ€ä¸‹æ‰§è¡Œä»»åŠ¡ã€‚</p><p>å¦‚æœworkerCount &lt; corePoolSizeï¼Œåˆ™åˆ›å»ºå¹¶å¯åŠ¨ä¸€ä¸ªçº¿ç¨‹æ¥æ‰§è¡Œæ–°æäº¤çš„ä»»åŠ¡ã€‚</p><p>å¦‚æœworkerCount &gt;= corePoolSizeï¼Œä¸”çº¿ç¨‹æ± å†…çš„<strong>é˜»å¡é˜Ÿåˆ—</strong>æœªæ»¡ï¼Œåˆ™å°†ä»»åŠ¡æ·»åŠ åˆ°è¯¥é˜»å¡é˜Ÿåˆ—ä¸­ã€‚</p><p>å¦‚æœworkerCount &gt;= corePoolSize &amp;&amp; workerCount &lt; maximumPoolSizeï¼Œä¸”çº¿ç¨‹æ± å†…çš„é˜»å¡é˜Ÿåˆ—å·²æ»¡ï¼Œåˆ™<strong>åˆ›å»ºå¹¶å¯åŠ¨ä¸€ä¸ªçº¿ç¨‹</strong>æ¥æ‰§è¡Œæ–°æäº¤çš„ä»»åŠ¡ã€‚</p><p>å¦‚æœworkerCount &gt;= maximumPoolSizeï¼Œå¹¶ä¸”çº¿ç¨‹æ± å†…çš„é˜»å¡é˜Ÿåˆ—å·²æ»¡, åˆ™æ ¹æ®<strong>æ‹’ç»ç­–ç•¥</strong>æ¥å¤„ç†è¯¥ä»»åŠ¡, <strong>é»˜è®¤çš„å¤„ç†æ–¹å¼æ˜¯ç›´æ¥æŠ›å¼‚å¸¸ã€‚</strong></p><p>ä¸ƒå¤§æ ¸å¿ƒå‚æ•°ï¼š</p><p><strong>corePoolSize</strong>ï¼šçº¿ç¨‹æ± æ ¸å¿ƒçº¿ç¨‹æ•°é‡ï¼Œå¦‚æœè®¾ç½®ä¸º5ï¼Œçº¿ç¨‹æ± åˆå§‹åŒ–åé»˜è®¤ä¿æŒ5ä¸ªçº¿ç¨‹å¾…å‘½ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œçº¿ç¨‹æ± ä¸­çº¿ç¨‹çš„æ•°é‡å¦‚æœ &lt;= corePoolSizeï¼Œé‚£ä¹ˆå³ä½¿è¿™äº›çº¿ç¨‹å¤„äºç©ºé—²çŠ¶æ€ï¼Œé‚£ä¹Ÿä¸ä¼šè¢«é”€æ¯ã€‚</p><p><strong>maximumPoolSize</strong>ï¼šçº¿ç¨‹æ± å…è®¸çš„æœ€å¤§çº¿ç¨‹æ•°ã€‚å½“ä»»åŠ¡é˜Ÿåˆ—å·²æ»¡ï¼Œä¸”å½“å‰çº¿ç¨‹æ•°å°äº <code>maximumPoolSize</code> æ—¶ï¼Œçº¿ç¨‹æ± ä¼šåˆ›å»ºæ–°çš„çº¿ç¨‹æ¥å¤„ç†ä»»åŠ¡ï¼Œç›´è‡³çº¿ç¨‹æ•°è¾¾åˆ° <code>maximumPoolSize</code>ã€‚</p><p><strong>keepAliveTime</strong>ï¼šå½“çº¿ç¨‹æ± ä¸­çº¿ç¨‹çš„æ•°é‡å¤§äºcorePoolSizeï¼Œå¹¶ä¸”æŸä¸ªçº¿ç¨‹çš„ç©ºé—²æ—¶é—´è¶…è¿‡äº†keepAliveTimeï¼Œé‚£ä¹ˆè¿™ä¸ªçº¿ç¨‹å°±ä¼šè¢«é”€æ¯ã€‚</p><p><strong>unit</strong>ï¼šå°±æ˜¯keepAliveTimeæ—¶é—´çš„å•ä½ã€‚</p><p><strong>workQueue</strong>ï¼šå·¥ä½œé˜Ÿåˆ—ã€‚å½“æ²¡æœ‰ç©ºé—²çš„çº¿ç¨‹æ‰§è¡Œæ–°ä»»åŠ¡æ—¶ï¼Œè¯¥ä»»åŠ¡å°±ä¼šè¢«æ”¾å…¥å·¥ä½œé˜Ÿåˆ—ä¸­ï¼Œç­‰å¾…æ‰§è¡Œã€‚</p><p><strong>threadFactory</strong>ï¼šç”¨äºåˆ›å»ºçº¿ç¨‹çš„å·¥å‚ã€‚é€šè¿‡è‡ªå®šä¹‰çº¿ç¨‹å·¥å‚ï¼Œä½ å¯ä»¥ä¸ºçº¿ç¨‹è®¾ç½®åç§°ã€ä¼˜å…ˆçº§ç­‰å±æ€§ã€‚</p><p><strong>handler</strong>ï¼šæ‹’ç»ç­–ç•¥ã€‚å½“ä¸€ä¸ªæ–°ä»»åŠ¡äº¤ç»™çº¿ç¨‹æ± ï¼Œå¦‚æœæ­¤æ—¶çº¿ç¨‹æ± ä¸­æœ‰ç©ºé—²çš„çº¿ç¨‹ï¼Œå°±ä¼šç›´æ¥æ‰§è¡Œï¼Œå¦‚æœæ²¡æœ‰ç©ºé—²çš„çº¿ç¨‹ï¼Œå°±ä¼šå°†è¯¥ä»»åŠ¡åŠ å…¥åˆ°é˜»å¡é˜Ÿåˆ—ä¸­ï¼Œå¦‚æœé˜»å¡é˜Ÿåˆ—æ»¡äº†ï¼Œå°±ä¼šåˆ›å»ºä¸€ä¸ªæ–°çº¿ç¨‹ï¼Œä»é˜»å¡é˜Ÿåˆ—å¤´éƒ¨å–å‡ºä¸€ä¸ªä»»åŠ¡æ¥æ‰§è¡Œï¼Œå¹¶å°†æ–°ä»»åŠ¡åŠ å…¥åˆ°é˜»å¡é˜Ÿåˆ—æœ«å°¾ã€‚å¦‚æœå½“å‰çº¿ç¨‹æ± ä¸­çº¿ç¨‹çš„æ•°é‡ç­‰äºmaximumPoolSizeï¼Œå°±ä¸ä¼šåˆ›å»ºæ–°çº¿ç¨‹ï¼Œå°±ä¼šå»æ‰§è¡Œæ‹’ç»ç­–ç•¥</p><h2 id="2-çº¿ç¨‹æ± çš„æ‹’ç»ç­–ç•¥"><a href="#2-çº¿ç¨‹æ± çš„æ‹’ç»ç­–ç•¥" class="headerlink" title="2.çº¿ç¨‹æ± çš„æ‹’ç»ç­–ç•¥"></a>2.çº¿ç¨‹æ± çš„æ‹’ç»ç­–ç•¥</h2><p>å¸¸ç”¨çš„å››ç§æ‹’ç»ç­–ç•¥åŒ…æ‹¬ï¼šCallerRunsPolicyã€AbortPolicyã€DiscardPolicyã€DiscardOldestPolicyï¼Œæ­¤å¤–ï¼Œè¿˜å¯ä»¥é€šè¿‡å®ç°<strong>RejectedExecutionHandler</strong>æ¥å£æ¥è‡ªå®šä¹‰æ‹’ç»ç­–ç•¥ã€‚</p><p>CallerRunsPolicyï¼Œä½¿ç”¨çº¿ç¨‹æ± çš„è°ƒç”¨è€…æ‰€åœ¨çš„çº¿ç¨‹å»æ‰§è¡Œè¢«æ‹’ç»çš„ä»»åŠ¡ï¼Œé™¤éçº¿ç¨‹æ± è¢«åœæ­¢æˆ–è€…çº¿ç¨‹æ± çš„ä»»åŠ¡é˜Ÿåˆ—å·²æœ‰ç©ºç¼ºã€‚</p><p><strong>AbortPolicyï¼Œç›´æ¥æŠ›å‡ºä¸€ä¸ªä»»åŠ¡è¢«çº¿ç¨‹æ± æ‹’ç»çš„å¼‚å¸¸ã€‚</strong>è¿™ä¸ªæ˜¯é»˜è®¤çš„</p><p>DiscardPolicyï¼Œä¸åšä»»ä½•å¤„ç†ï¼Œé™é»˜æ‹’ç»æäº¤çš„ä»»åŠ¡ã€‚</p><p>DiscardOldestPolicyï¼ŒæŠ›å¼ƒæœ€è€çš„ä»»åŠ¡ï¼Œç„¶åæ‰§è¡Œè¯¥ä»»åŠ¡ã€‚</p><p>è‡ªå®šä¹‰æ‹’ç»ç­–ç•¥ï¼Œé€šè¿‡å®ç°æ¥å£å¯ä»¥è‡ªå®šä¹‰ä»»åŠ¡æ‹’ç»ç­–ç•¥ã€‚</p><p><strong>RejectedExecutionHandlerå®ç°</strong></p><h2 id="3-æè¿°ä¸€ä¸‹åˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ± ï¼Œæäº¤ä»»åŠ¡çš„è¿‡ç¨‹"><a href="#3-æè¿°ä¸€ä¸‹åˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ± ï¼Œæäº¤ä»»åŠ¡çš„è¿‡ç¨‹" class="headerlink" title="3.æè¿°ä¸€ä¸‹åˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ± ï¼Œæäº¤ä»»åŠ¡çš„è¿‡ç¨‹"></a>3.æè¿°ä¸€ä¸‹åˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ± ï¼Œæäº¤ä»»åŠ¡çš„è¿‡ç¨‹</h2><p>æˆ‘ä»¬åˆ›å»ºçº¿ç¨‹æ± çš„æ—¶å€™ï¼Œéœ€è¦ä½¿ç”¨åˆ°ThreadPoolExecutor</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ExecutorService</span> <span class="variable">executor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ThreadPoolExecutor</span>(</span><br><span class="line">    corePoolSize,     <span class="comment">// æ ¸å¿ƒçº¿ç¨‹æ•°</span></span><br><span class="line">    maximumPoolSize,  <span class="comment">// æœ€å¤§çº¿ç¨‹æ•°</span></span><br><span class="line">    keepAliveTime,    <span class="comment">// éæ ¸å¿ƒçº¿ç¨‹æœ€å¤§ç©ºé—²å­˜æ´»æ—¶é—´</span></span><br><span class="line">    unit,             <span class="comment">// æ—¶é—´å•ä½</span></span><br><span class="line">    workQueue,        <span class="comment">// é˜»å¡é˜Ÿåˆ—ï¼ˆä»»åŠ¡é˜Ÿåˆ—ï¼‰</span></span><br><span class="line">    threadFactory,    <span class="comment">// çº¿ç¨‹å·¥å‚ï¼ˆåˆ›å»ºçº¿ç¨‹çš„ç­–ç•¥ï¼‰</span></span><br><span class="line">    handler           <span class="comment">// æ‹’ç»ç­–ç•¥</span></span><br><span class="line">);</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æäº¤ä»»åŠ¡çš„è¿‡ç¨‹ï¼š</p><p>è°ƒç”¨ <code>ThreadPoolExecutor.execute()</code> </p><p>åˆ¤æ–­çº¿ç¨‹æ•°æ˜¯å¦å°äºæ ¸å¿ƒçº¿ç¨‹æ•°</p><p>å¦‚æœå½“å‰çº¿ç¨‹æ•° <strong>&lt; æ ¸å¿ƒçº¿ç¨‹æ•°</strong>ï¼š</p><ul><li>ç›´æ¥åˆ›å»ºçº¿ç¨‹æ‰§è¡Œä»»åŠ¡ï¼ˆ<strong>ç«‹åˆ»æ‰§è¡Œï¼Œä¸å…¥é˜Ÿåˆ—</strong>ï¼‰</li></ul><p>æ ¸å¿ƒçº¿ç¨‹å·²æ»¡ â†’ å°è¯•å°†ä»»åŠ¡æ”¾å…¥å·¥ä½œé˜Ÿåˆ—</p><p>å¦‚æœæ ¸å¿ƒçº¿ç¨‹éƒ½åœ¨è¿è¡Œï¼Œä»»åŠ¡ä¼šå°è¯•<strong>è¿›å…¥é˜»å¡é˜Ÿåˆ—</strong>ã€‚</p><p>å¦‚æœå…¥é˜ŸæˆåŠŸï¼š</p><ul><li>ç­‰å¾…ç©ºé—²çº¿ç¨‹ä»é˜Ÿåˆ—ä¸­å–ä»»åŠ¡æ‰§è¡Œ</li></ul><p>å¦‚æœå…¥é˜Ÿå¤±è´¥ï¼ˆé˜Ÿåˆ—æ»¡äº†ï¼‰ï¼šå°è¯•åˆ›å»ºéæ ¸å¿ƒçº¿ç¨‹ï¼Œå¦‚æœçº¿ç¨‹æ•° &lt; æœ€å¤§çº¿ç¨‹æ•°ï¼Œåˆ™åˆ›å»ºéæ ¸å¿ƒçº¿ç¨‹æ‰§è¡Œä»»åŠ¡ã€‚</p><p>çº¿ç¨‹æ•°ä¹Ÿæ»¡äº† â†’ å¯åŠ¨æ‹’ç»ç­–ç•¥</p><p>è¿˜åŒ…æ‹¬ä¸€ä¸ªaddWorker()æ–¹æ³•ï¼Œæ˜¯åˆ›å»ºçº¿ç¨‹çš„æ ¸å¿ƒæ–¹æ³•</p><p>ä½¿ç”¨çº¿ç¨‹å·¥å‚åˆ›å»ºçº¿ç¨‹</p><p>å°†çº¿ç¨‹å°è£…ä¸º <code>Worker</code> å¯¹è±¡</p><p>åŠ å…¥ <code>workers</code> å·¥ä½œçº¿ç¨‹é›†åˆ</p><p>å¯åŠ¨çº¿ç¨‹å¹¶æ‰§è¡Œä»»åŠ¡</p><p>æ¯ä¸ªå·¥ä½œçº¿ç¨‹åœ¨å¯åŠ¨åä¼šä¸æ–­å¾ªç¯ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span> (task != <span class="literal">null</span> || (task = getTask()) != <span class="literal">null</span>) &#123;</span><br><span class="line">    <span class="comment">// æ‰§è¡Œä»»åŠ¡</span></span><br><span class="line">    task.run();</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å…¶ä¸­ <code>getTask()</code> ä»é˜»å¡é˜Ÿåˆ—ä¸­è·å–ä»»åŠ¡ã€‚</p><p>æ ¸å¿ƒçº¿ç¨‹ï¼šç©ºé—²æ—¶ä»ä¿ç•™</p><p>éæ ¸å¿ƒçº¿ç¨‹ï¼šå¦‚æœè¶…è¿‡ keepAliveTime æœªè·å–åˆ°ä»»åŠ¡ï¼Œåˆ™è¢«é”€æ¯</p><h2 id="4-ä¸€ä¸ªä»»åŠ¡æ‰§è¡Œå®Œåï¼Œå¦‚æœå†å¾€çº¿ç¨‹æ± ä¸­æäº¤ä¸€ä¸ªä»»åŠ¡ï¼Œè¿‡ç¨‹æ˜¯ä»€ä¹ˆæ ·çš„"><a href="#4-ä¸€ä¸ªä»»åŠ¡æ‰§è¡Œå®Œåï¼Œå¦‚æœå†å¾€çº¿ç¨‹æ± ä¸­æäº¤ä¸€ä¸ªä»»åŠ¡ï¼Œè¿‡ç¨‹æ˜¯ä»€ä¹ˆæ ·çš„" class="headerlink" title="4.ä¸€ä¸ªä»»åŠ¡æ‰§è¡Œå®Œåï¼Œå¦‚æœå†å¾€çº¿ç¨‹æ± ä¸­æäº¤ä¸€ä¸ªä»»åŠ¡ï¼Œè¿‡ç¨‹æ˜¯ä»€ä¹ˆæ ·çš„"></a>4.ä¸€ä¸ªä»»åŠ¡æ‰§è¡Œå®Œåï¼Œå¦‚æœå†å¾€çº¿ç¨‹æ± ä¸­æäº¤ä¸€ä¸ªä»»åŠ¡ï¼Œè¿‡ç¨‹æ˜¯ä»€ä¹ˆæ ·çš„</h2><p>å¦‚æœ<strong>çº¿ç¨‹æ± ä»ç„¶å­˜æ´»</strong>ï¼Œæ­¤æ—¶<strong>å†æäº¤ä¸€ä¸ªä»»åŠ¡çš„è¿‡ç¨‹</strong>ï¼Œä¸æœ€åˆæäº¤ä»»åŠ¡æ—¶å‡ ä¹ç›¸åŒï¼Œä½†ä¼šå—åˆ°<strong>å·²æœ‰çº¿ç¨‹ç©ºé—²å¯å¤ç”¨</strong>çš„å½±å“.</p><p>çº¿ç¨‹æ± ä¸­å·²æœ‰çº¿ç¨‹æ‰§è¡Œå®Œä»»åŠ¡ï¼Œè¿›å…¥<strong>ç©ºé—²çŠ¶æ€</strong>ï¼›</p><p>æ­¤æ—¶å†æ¬¡æäº¤ä¸€ä¸ªæ–°ä»»åŠ¡ã€‚</p><p>ä¾æ—§ä¼šæ‰§è¡Œ <code>ThreadPoolExecutor.execute(Runnable command)</code></p><p>æ£€æŸ¥æ˜¯å¦éœ€è¦åˆ›å»ºæ–°çº¿ç¨‹,ä¸€èˆ¬æ˜¯å½“å‰çº¿ç¨‹æ•°å·²è¾¾åˆ°æ ¸å¿ƒçº¿ç¨‹æ•°ï¼›ä¸Šä¸€ä¸ªä»»åŠ¡åˆšæ‰§è¡Œå®Œï¼Œçº¿ç¨‹å¤„äºç©ºé—²çŠ¶æ€ï¼›</p><p>å°è¯•å°†ä»»åŠ¡åŠ å…¥é˜Ÿåˆ—ï¼Œå¦‚æœçº¿ç¨‹æ± ä½¿ç”¨çš„æ˜¯æœ‰ç•Œé˜Ÿåˆ—ï¼ˆLinkedBlockingQueueï¼‰ä»»åŠ¡ç›´æ¥å…¥é˜Ÿï¼›<strong>ç­‰å¾…ç©ºé—²çº¿ç¨‹æ¥å–ä»»åŠ¡æ‰§è¡Œ</strong>ï¼Œä¸å†æ–°å»ºçº¿ç¨‹ã€‚</p><p>å¦‚æœæ˜¯ <code>SynchronousQueue</code>ï¼Œè¿›è¡Œä¸‹ä¸€æ­¥</p><p>æ˜¯å¦éœ€è¦åˆ›å»ºéæ ¸å¿ƒçº¿ç¨‹ï¼Œï¼Œå¦‚æœé˜Ÿåˆ—å¤±è´¥ï¼Œçº¿ç¨‹æ•°å°šæœªè¶…è¿‡æœ€å¤§çº¿ç¨‹æ•°ï¼šï¼Œåˆ›å»ºçº¿ç¨‹æ‰§è¡Œä»»åŠ¡ï¼ˆéæ ¸å¿ƒçº¿ç¨‹ï¼‰</p><p>å¦åˆ™ï¼Œè¿›å…¥æ‹’ç»ç­–ç•¥ï¼Œé˜Ÿåˆ—æ»¡ã€çº¿ç¨‹ä¹Ÿæ»¡ â†’ æ‹’ç»ä»»åŠ¡</p><p>Wokerå¾ªç¯</p><p>ä¼šå°è¯•ä»é˜Ÿåˆ—ä¸­è·å–ä¸‹ä¸€ä¸ªä»»åŠ¡ï¼›</p><p>å¦‚æœä»»åŠ¡é˜Ÿåˆ—ä¸­æœ‰æ–°ä»»åŠ¡ï¼š</p><ul><li>è¯¥çº¿ç¨‹<strong>ç»§ç»­æ‰§è¡Œæ–°ä»»åŠ¡</strong>ï¼›</li></ul><p>å¦‚æœé˜Ÿåˆ—æ— ä»»åŠ¡ï¼š</p><ul><li>æ ¸å¿ƒçº¿ç¨‹ï¼šä¸€ç›´ç­‰å¾…ï¼›</li><li>éæ ¸å¿ƒçº¿ç¨‹ï¼šç©ºé—²è¶…è¿‡ <code>keepAliveTime</code> ä¼šé”€æ¯ã€‚</li></ul><p>å¦‚æœçº¿ç¨‹æ± è¢« shutdownï¼Œåˆ™ <code>execute()</code> ä¼šæ‹’ç»ä»»åŠ¡ï¼›</p><h2 id="5-æ‰§è¡Œå®Œç¬¬äºŒä¸ªä»»åŠ¡åï¼Œçº¿ç¨‹æ± é‡Œé¢è¿˜ä¼šæœ‰å‡ ä¸ªçº¿ç¨‹"><a href="#5-æ‰§è¡Œå®Œç¬¬äºŒä¸ªä»»åŠ¡åï¼Œçº¿ç¨‹æ± é‡Œé¢è¿˜ä¼šæœ‰å‡ ä¸ªçº¿ç¨‹" class="headerlink" title="5.æ‰§è¡Œå®Œç¬¬äºŒä¸ªä»»åŠ¡åï¼Œçº¿ç¨‹æ± é‡Œé¢è¿˜ä¼šæœ‰å‡ ä¸ªçº¿ç¨‹"></a>5.æ‰§è¡Œå®Œç¬¬äºŒä¸ªä»»åŠ¡åï¼Œçº¿ç¨‹æ± é‡Œé¢è¿˜ä¼šæœ‰å‡ ä¸ªçº¿ç¨‹</h2><p>ä¸€èˆ¬æƒ…å†µï¼ˆé»˜è®¤é…ç½®ã€æ ¸å¿ƒçº¿ç¨‹ä¸å›æ”¶ï¼‰ï¼š</p><ul><li><strong>æ‰§è¡Œä¸¤ä¸ªä»»åŠ¡åï¼Œçº¿ç¨‹æ± ä¸­ä¼šä¿ç•™ä¸¤ä¸ªæ ¸å¿ƒçº¿ç¨‹</strong>ã€‚</li></ul><p>è‹¥ç”¨éæ ¸å¿ƒçº¿ç¨‹ã€ä»»åŠ¡æ‰§è¡Œå®Œåç­‰å¾…ç©ºé—²ï¼š</p><ul><li>æ‰§è¡Œå®Œç«‹å³ï¼šçº¿ç¨‹æ± ä¸­è¿˜æœ‰ 2 ä¸ªçº¿ç¨‹ï¼ˆæ ¸å¿ƒ + éæ ¸å¿ƒï¼‰ï¼›</li><li>è¶…è¿‡ <code>keepAliveTime</code> åï¼šåªå‰©ä¸‹æ ¸å¿ƒçº¿ç¨‹ï¼›</li></ul><h2 id="6-æœ‰çº¿ç¨‹æ± å‚æ•°è®¾ç½®çš„ç»éªŒå—ï¼Ÿ"><a href="#6-æœ‰çº¿ç¨‹æ± å‚æ•°è®¾ç½®çš„ç»éªŒå—ï¼Ÿ" class="headerlink" title="6.æœ‰çº¿ç¨‹æ± å‚æ•°è®¾ç½®çš„ç»éªŒå—ï¼Ÿ"></a>6.æœ‰çº¿ç¨‹æ± å‚æ•°è®¾ç½®çš„ç»éªŒå—ï¼Ÿ</h2><p>æ ¸å¿ƒçº¿ç¨‹æ•°ï¼ˆcorePoolSizeï¼‰è®¾ç½®çš„ç»éªŒï¼š</p><ul><li>CPUå¯†é›†å‹ï¼šcorePoolSize = CPUæ ¸æ•° + 1ï¼ˆé¿å…è¿‡å¤šçº¿ç¨‹ç«äº‰CPUï¼‰</li><li>IOå¯†é›†å‹ï¼šcorePoolSize = CPUæ ¸æ•° x 2ï¼ˆæˆ–æ›´é«˜ï¼Œå…·ä½“çœ‹IOç­‰å¾…æ—¶é—´ï¼‰</li></ul><p>åœºæ™¯ä¸€ï¼šç”µå•†åœºæ™¯ï¼Œ<strong>ç‰¹ç‚¹ç¬æ—¶é«˜å¹¶å‘ã€ä»»åŠ¡å¤„ç†æ—¶é—´çŸ­</strong>ï¼Œçº¿ç¨‹æ± çš„é…ç½®å¯è®¾ç½®å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">ThreadPoolExecutor</span>(</span><br><span class="line">    <span class="number">16</span>,                     <span class="comment">// corePoolSize = 16ï¼ˆå‡è®¾8æ ¸CPU Ã— 2ï¼‰</span></span><br><span class="line">    <span class="number">32</span>,                     <span class="comment">// maximumPoolSize = 32ï¼ˆçªå‘æµé‡æ‰©å®¹ï¼‰</span></span><br><span class="line">    <span class="number">10</span>, TimeUnit.SECONDS,   <span class="comment">// éæ ¸å¿ƒçº¿ç¨‹ç©ºé—²10ç§’å›æ”¶</span></span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">SynchronousQueue</span>&lt;&gt;(), <span class="comment">// ä¸ç¼“å­˜ä»»åŠ¡ï¼Œç›´æ¥æ‰©å®¹çº¿ç¨‹</span></span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">AbortPolicy</span>()       <span class="comment">// ç›´æ¥æ‹’ç»ï¼Œé¿å…ç³»ç»Ÿè¿‡è½½</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure><p>è¯´æ˜ï¼š</p><ul><li>ä½¿ç”¨<code>SynchronousQueue</code><strong>ç¡®ä¿ä»»åŠ¡ç›´è¾¾çº¿ç¨‹ï¼Œé¿å…é˜Ÿåˆ—å»¶è¿Ÿ</strong>ã€‚</li><li>æ‹’ç»ç­–ç•¥å¿«é€Ÿå¤±è´¥ï¼Œå‰ç«¯è¿”å›â€œæ´»åŠ¨ç«çˆ†â€æç¤ºï¼Œç»“åˆé™çº§ç­–ç•¥ï¼ˆå¦‚ç¼“å­˜é¢„çƒ­ï¼‰ã€‚</li></ul><p>åœºæ™¯äºŒï¼šåå°æ•°æ®å¤„ç†æœåŠ¡ï¼Œç‰¹ç‚¹ç¨³å®šæµé‡ã€ä»»åŠ¡å¤„ç†æ—¶é—´é•¿ï¼ˆç§’çº§ï¼‰ã€å…è®¸ä¸€å®šå»¶è¿Ÿï¼Œçº¿ç¨‹æ± çš„é…ç½®å¯è®¾ç½®å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">ThreadPoolExecutor</span>(</span><br><span class="line">    <span class="number">8</span>,                      <span class="comment">// corePoolSize = 8ï¼ˆ8æ ¸CPUï¼‰</span></span><br><span class="line">    <span class="number">8</span>,                      <span class="comment">// maximumPoolSize = 8ï¼ˆç¦æ­¢æ‰©å®¹ï¼Œé¿å…èµ„æºè€—å°½ï¼‰</span></span><br><span class="line">    <span class="number">0</span>, TimeUnit.SECONDS,    <span class="comment">// ä¸å›æ”¶çº¿ç¨‹</span></span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">ArrayBlockingQueue</span>&lt;&gt;(<span class="number">1000</span>), <span class="comment">// æœ‰ç•Œé˜Ÿåˆ—ï¼Œå®¹é‡1000</span></span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">CallerRunsPolicy</span>()  <span class="comment">// é˜Ÿåˆ—æ»¡åç”±è°ƒç”¨çº¿ç¨‹æ‰§è¡Œ</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure><p>è¯´æ˜ï¼š</p><ul><li>å›ºå®šçº¿ç¨‹æ•°é¿å…èµ„æºæ³¢åŠ¨ï¼Œé˜Ÿåˆ—ç¼“å†²ä»»åŠ¡ï¼Œæ‹’ç»ç­–ç•¥å…œåº•ã€‚</li><li>é…åˆç›‘æ§å‘Šè­¦ï¼ˆå¦‚é˜Ÿåˆ—ä½¿ç”¨ç‡&gt;80%è§¦å‘æ‰©å®¹ï¼‰ã€‚</li></ul><p>åœºæ™¯ä¸‰ï¼šå¾®æœåŠ¡HTTPè¯·æ±‚å¤„ç†ï¼Œç‰¹ç‚¹IOå¯†é›†å‹ã€ä¾èµ–ä¸‹æ¸¸æœåŠ¡å“åº”æ—¶é—´ï¼Œçº¿ç¨‹æ± çš„é…ç½®å¯è®¾ç½®å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> <span class="title class_">ThreadPoolExecutor</span>(</span><br><span class="line">    <span class="number">16</span>,                     <span class="comment">// corePoolSize = 16ï¼ˆ8æ ¸ Ã— 2ï¼‰</span></span><br><span class="line">    <span class="number">64</span>,                     <span class="comment">// maximumPoolSize = 64ï¼ˆåº”å¯¹æ…¢ä¸‹æ¸¸ï¼‰</span></span><br><span class="line">    <span class="number">60</span>, TimeUnit.SECONDS,   <span class="comment">// éæ ¸å¿ƒçº¿ç¨‹ç©ºé—²60ç§’å›æ”¶</span></span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">LinkedBlockingQueue</span>&lt;&gt;(<span class="number">200</span>), <span class="comment">// æœ‰ç•Œé˜Ÿåˆ—å®¹é‡200</span></span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">CustomRetryPolicy</span>() <span class="comment">// è‡ªå®šä¹‰æ‹’ç»ç­–ç•¥ï¼ˆé‡è¯•æˆ–é™çº§ï¼‰</span></span><br><span class="line">);</span><br></pre></td></tr></table></figure><p>è¯´æ˜ï¼š</p><ul><li>æ ¹æ®ä¸‹æ¸¸RTï¼ˆå“åº”æ—¶é—´ï¼‰è°ƒæ•´çº¿ç¨‹æ•°ï¼Œé˜Ÿåˆ—é˜²æ­¢ç¬æ—¶å³°å€¼ã€‚</li><li>è‡ªå®šä¹‰æ‹’ç»ç­–ç•¥å°†ä»»åŠ¡æš‚å­˜Redisï¼Œå¼‚æ­¥é‡è¯•ã€‚</li></ul><h2 id="7-æ ¸å¿ƒçº¿ç¨‹æ•°è®¾ç½®ä¸º0å¯ä¸å¯ä»¥ï¼Ÿ"><a href="#7-æ ¸å¿ƒçº¿ç¨‹æ•°è®¾ç½®ä¸º0å¯ä¸å¯ä»¥ï¼Ÿ" class="headerlink" title="7.æ ¸å¿ƒçº¿ç¨‹æ•°è®¾ç½®ä¸º0å¯ä¸å¯ä»¥ï¼Ÿ"></a>7.<strong>æ ¸å¿ƒçº¿ç¨‹æ•°è®¾ç½®ä¸º0å¯ä¸å¯ä»¥ï¼Ÿ</strong></h2><p>å¯ä»¥ï¼Œå½“æ ¸å¿ƒçº¿ç¨‹æ•°ä¸º0çš„æ—¶å€™ï¼Œä¼šåˆ›å»ºä¸€ä¸ªéæ ¸å¿ƒçº¿ç¨‹è¿›è¡Œæ‰§è¡Œã€‚</p><p>ä»ä¸‹é¢çš„æºç ä¹Ÿå¯ä»¥çœ‹åˆ°ï¼Œå½“æ ¸å¿ƒçº¿ç¨‹æ•°ä¸º 0 æ—¶ï¼Œæ¥äº†ä¸€ä¸ªä»»åŠ¡ä¹‹åï¼Œä¼šå…ˆå°†ä»»åŠ¡æ·»åŠ åˆ°ä»»åŠ¡é˜Ÿåˆ—ï¼ŒåŒæ—¶ä¹Ÿä¼šåˆ¤æ–­å½“å‰å·¥ä½œçš„çº¿ç¨‹æ•°æ˜¯å¦ä¸º 0ï¼Œå¦‚æœä¸º 0ï¼Œåˆ™ä¼šåˆ›å»ºçº¿ç¨‹æ¥æ‰§è¡Œçº¿ç¨‹æ± çš„ä»»åŠ¡ã€‚</p><p><img src="https://cdn.xiaolincoding.com//picgo/image-20240820113849549.png" alt="image-20240820113849549"></p><h2 id="8-çº¿ç¨‹æ± ç§ç±»æœ‰å“ªäº›ï¼Ÿ"><a href="#8-çº¿ç¨‹æ± ç§ç±»æœ‰å“ªäº›ï¼Ÿ" class="headerlink" title="8.çº¿ç¨‹æ± ç§ç±»æœ‰å“ªäº›ï¼Ÿ"></a>8.çº¿ç¨‹æ± ç§ç±»æœ‰å“ªäº›ï¼Ÿ</h2><ul><li><strong>ScheduledThreadPool</strong>ï¼šå¯ä»¥<strong>è®¾ç½®å®šæœŸçš„æ‰§è¡Œä»»åŠ¡</strong>ï¼Œå®ƒæ”¯æŒå®šæ—¶æˆ–å‘¨æœŸæ€§æ‰§è¡Œä»»åŠ¡ï¼Œæ¯”å¦‚æ¯éš” 10 ç§’é’Ÿæ‰§è¡Œä¸€æ¬¡ä»»åŠ¡ï¼Œæˆ‘é€šè¿‡è¿™ä¸ªå®ç°ç±»è®¾ç½®å®šæœŸæ‰§è¡Œä»»åŠ¡çš„ç­–ç•¥ã€‚</li><li>FixedThreadPoolï¼šå®ƒçš„<strong>æ ¸å¿ƒçº¿ç¨‹æ•°å’Œæœ€å¤§çº¿ç¨‹æ•°æ˜¯ä¸€æ ·çš„ï¼Œæ‰€ä»¥å¯ä»¥æŠŠå®ƒçœ‹ä½œæ˜¯å›ºå®šçº¿ç¨‹æ•°çš„çº¿ç¨‹æ± </strong>ï¼Œå®ƒçš„ç‰¹ç‚¹æ˜¯çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°é™¤äº†åˆå§‹é˜¶æ®µéœ€è¦ä» 0 å¼€å§‹å¢åŠ å¤–ï¼Œä¹‹åçš„çº¿ç¨‹æ•°é‡å°±æ˜¯å›ºå®šçš„ï¼Œå°±ç®—ä»»åŠ¡æ•°è¶…è¿‡çº¿ç¨‹æ•°ï¼Œçº¿ç¨‹æ± ä¹Ÿä¸ä¼šå†åˆ›å»ºæ›´å¤šçš„çº¿ç¨‹æ¥å¤„ç†ä»»åŠ¡ï¼Œè€Œæ˜¯ä¼šæŠŠè¶…å‡ºçº¿ç¨‹å¤„ç†èƒ½åŠ›çš„ä»»åŠ¡æ”¾åˆ°ä»»åŠ¡é˜Ÿåˆ—ä¸­è¿›è¡Œç­‰å¾…ã€‚è€Œä¸”å°±ç®—ä»»åŠ¡é˜Ÿåˆ—æ»¡äº†ï¼Œåˆ°äº†æœ¬è¯¥ç»§ç»­å¢åŠ çº¿ç¨‹æ•°çš„æ—¶å€™ï¼Œç”±äºå®ƒçš„æœ€å¤§çº¿ç¨‹æ•°å’Œæ ¸å¿ƒçº¿ç¨‹æ•°æ˜¯ä¸€æ ·çš„ï¼Œæ‰€ä»¥ä¹Ÿæ— æ³•å†å¢åŠ æ–°çš„çº¿ç¨‹äº†ã€‚</li><li>CachedThreadPoolï¼šå¯ä»¥ç§°ä½œ<strong>å¯ç¼“å­˜çº¿ç¨‹æ± </strong>ï¼Œ<strong>å®ƒçš„ç‰¹ç‚¹åœ¨äºçº¿ç¨‹æ•°æ˜¯å‡ ä¹å¯ä»¥æ— é™å¢åŠ </strong>çš„ï¼ˆå®é™…æœ€å¤§å¯ä»¥è¾¾åˆ° Integer.MAX_VALUEï¼Œä¸º 2^31-1ï¼Œè¿™ä¸ªæ•°éå¸¸å¤§ï¼Œæ‰€ä»¥åŸºæœ¬ä¸å¯èƒ½è¾¾åˆ°ï¼‰ï¼Œè€Œå½“çº¿ç¨‹é—²ç½®æ—¶è¿˜å¯ä»¥å¯¹çº¿ç¨‹è¿›è¡Œå›æ”¶ã€‚ä¹Ÿå°±æ˜¯è¯´è¯¥çº¿ç¨‹æ± çš„çº¿ç¨‹æ•°é‡ä¸æ˜¯å›ºå®šä¸å˜çš„ï¼Œå½“ç„¶å®ƒä¹Ÿæœ‰ä¸€ä¸ªç”¨äºå­˜å‚¨æäº¤ä»»åŠ¡çš„é˜Ÿåˆ—ï¼Œä½†è¿™ä¸ªé˜Ÿåˆ—æ˜¯ SynchronousQueueï¼Œé˜Ÿåˆ—çš„å®¹é‡ä¸º0ï¼Œå®é™…ä¸å­˜å‚¨ä»»ä½•ä»»åŠ¡ï¼Œå®ƒåªè´Ÿè´£å¯¹ä»»åŠ¡è¿›è¡Œä¸­è½¬å’Œä¼ é€’ï¼Œæ‰€ä»¥æ•ˆç‡æ¯”è¾ƒé«˜ã€‚</li><li>SingleThreadExecutorï¼šå®ƒä¼š<strong>ä½¿ç”¨å”¯ä¸€çš„çº¿ç¨‹å»æ‰§è¡Œä»»åŠ¡</strong>ï¼ŒåŸç†å’Œ FixedThreadPool æ˜¯ä¸€æ ·çš„ï¼Œåªä¸è¿‡è¿™é‡Œçº¿ç¨‹åªæœ‰ä¸€ä¸ªï¼Œå¦‚æœçº¿ç¨‹åœ¨æ‰§è¡Œä»»åŠ¡çš„è¿‡ç¨‹ä¸­å‘ç”Ÿå¼‚å¸¸ï¼Œçº¿ç¨‹æ± ä¹Ÿä¼šé‡æ–°åˆ›å»ºä¸€ä¸ªçº¿ç¨‹æ¥æ‰§è¡Œåç»­çš„ä»»åŠ¡ã€‚è¿™ç§çº¿ç¨‹æ± ç”±äºåªæœ‰ä¸€ä¸ªçº¿ç¨‹ï¼Œ<strong>æ‰€ä»¥éå¸¸é€‚åˆç”¨äºæ‰€æœ‰ä»»åŠ¡éƒ½éœ€è¦æŒ‰è¢«æäº¤çš„é¡ºåºä¾æ¬¡æ‰§è¡Œçš„åœºæ™¯</strong>ï¼Œè€Œå‰å‡ ç§çº¿ç¨‹æ± ä¸ä¸€å®šèƒ½å¤Ÿä¿éšœä»»åŠ¡çš„æ‰§è¡Œé¡ºåºç­‰äºè¢«æäº¤çš„é¡ºåºï¼Œå› ä¸ºå®ƒä»¬æ˜¯å¤šçº¿ç¨‹å¹¶è¡Œæ‰§è¡Œçš„ã€‚</li><li>SingleThreadScheduledExecutorï¼šå®ƒå®é™…å’Œ ScheduledThreadPool çº¿ç¨‹æ± éå¸¸ç›¸ä¼¼ï¼Œå®ƒåªæ˜¯ ScheduledThreadPool çš„ä¸€ä¸ªç‰¹ä¾‹ï¼Œå†…éƒ¨åªæœ‰ä¸€ä¸ªçº¿ç¨‹ã€‚</li></ul><h2 id="9-çº¿ç¨‹æ± ä¸€èˆ¬æ˜¯æ€ä¹ˆç”¨çš„ï¼Ÿ"><a href="#9-çº¿ç¨‹æ± ä¸€èˆ¬æ˜¯æ€ä¹ˆç”¨çš„ï¼Ÿ" class="headerlink" title="9.çº¿ç¨‹æ± ä¸€èˆ¬æ˜¯æ€ä¹ˆç”¨çš„ï¼Ÿ"></a>9.çº¿ç¨‹æ± ä¸€èˆ¬æ˜¯æ€ä¹ˆç”¨çš„ï¼Ÿ</h2><p>Java ä¸­çš„ Executors ç±»å®šä¹‰äº†ä¸€äº›å¿«æ·çš„å·¥å…·æ–¹æ³•ï¼Œæ¥å¸®åŠ©æˆ‘ä»¬å¿«é€Ÿåˆ›å»ºçº¿ç¨‹æ± ã€‚ã€Šé˜¿é‡Œå·´å·´ Java å¼€å‘æ‰‹å†Œã€‹ä¸­æåˆ°ï¼Œç¦æ­¢ä½¿ç”¨è¿™äº›æ–¹æ³•æ¥åˆ›å»ºçº¿ç¨‹æ± ï¼Œ<strong>è€Œåº”è¯¥æ‰‹åŠ¨ new ThreadPoolExecutor æ¥åˆ›å»ºçº¿ç¨‹æ± ã€‚</strong>è¿™ä¸€æ¡è§„åˆ™çš„èƒŒåï¼Œæ˜¯å¤§é‡è¡€æ·‹æ·‹çš„ç”Ÿäº§äº‹æ•…ï¼Œæœ€å…¸å‹çš„å°±æ˜¯ newFixedThreadPool å’Œ newCachedThreadPoolï¼Œå¯èƒ½å› ä¸ºèµ„æºè€—å°½å¯¼è‡´ OOM é—®é¢˜ã€‚</p><p>æ‰€ä»¥ï¼Œä¸å»ºè®®ä½¿ç”¨ Executors æä¾›çš„ä¸¤ç§å¿«æ·çš„çº¿ç¨‹æ± ï¼ŒåŸå› å¦‚ä¸‹ï¼š</p><ul><li>æˆ‘ä»¬éœ€è¦æ ¹æ®è‡ªå·±çš„åœºæ™¯ã€å¹¶å‘æƒ…å†µæ¥è¯„ä¼°çº¿ç¨‹æ± çš„å‡ ä¸ªæ ¸å¿ƒå‚æ•°ï¼ŒåŒ…æ‹¬æ ¸å¿ƒçº¿ç¨‹æ•°ã€æœ€å¤§çº¿ç¨‹æ•°ã€çº¿ç¨‹å›æ”¶ç­–ç•¥ã€å·¥ä½œé˜Ÿåˆ—çš„ç±»å‹ï¼Œä»¥åŠæ‹’ç»ç­–ç•¥ï¼Œç¡®ä¿çº¿ç¨‹æ± çš„å·¥ä½œè¡Œä¸ºç¬¦åˆéœ€æ±‚ï¼Œä¸€èˆ¬éƒ½éœ€è¦è®¾ç½®æœ‰ç•Œçš„å·¥ä½œé˜Ÿåˆ—å’Œå¯æ§çš„çº¿ç¨‹æ•°ã€‚</li><li>ä»»ä½•æ—¶å€™ï¼Œéƒ½åº”è¯¥ä¸º<strong>è‡ªå®šä¹‰çº¿ç¨‹æ± æŒ‡å®šæœ‰æ„ä¹‰çš„åç§°</strong>ï¼Œä»¥æ–¹ä¾¿æ’æŸ¥é—®é¢˜ã€‚å½“å‡ºç°çº¿ç¨‹æ•°é‡æš´å¢ã€çº¿ç¨‹æ­»é”ã€çº¿ç¨‹å ç”¨å¤§é‡ CPUã€çº¿ç¨‹æ‰§è¡Œå‡ºç°å¼‚å¸¸ç­‰é—®é¢˜æ—¶ï¼Œæˆ‘ä»¬å¾€å¾€ä¼šæŠ“å–çº¿ç¨‹æ ˆã€‚æ­¤æ—¶ï¼Œæœ‰æ„ä¹‰çš„çº¿ç¨‹åç§°ï¼Œå°±å¯ä»¥æ–¹ä¾¿æˆ‘ä»¬å®šä½é—®é¢˜ã€‚</li></ul><p>é™¤äº†å»ºè®®æ‰‹åŠ¨å£°æ˜çº¿ç¨‹æ± ä»¥å¤–ï¼Œæˆ‘è¿˜å»ºè®®ç”¨<strong>ä¸€äº›ç›‘æ§æ‰‹æ®µæ¥è§‚å¯Ÿçº¿ç¨‹æ± çš„çŠ¶æ€</strong>ã€‚çº¿ç¨‹æ± è¿™ä¸ªç»„ä»¶å¾€å¾€ä¼šè¡¨ç°å¾—ä»»åŠ³ä»»æ€¨ã€é»˜é»˜æ— é—»ï¼Œé™¤éæ˜¯å‡ºç°äº†æ‹’ç»ç­–ç•¥ï¼Œå¦åˆ™å‹åŠ›å†å¤§éƒ½ä¸ä¼šæŠ›å‡ºä¸€ä¸ªå¼‚å¸¸ã€‚å¦‚æœæˆ‘ä»¬èƒ½æå‰è§‚å¯Ÿåˆ°çº¿ç¨‹æ± é˜Ÿåˆ—çš„ç§¯å‹ï¼Œæˆ–è€…çº¿ç¨‹æ•°é‡çš„å¿«é€Ÿè†¨èƒ€ï¼Œå¾€å¾€å¯ä»¥ææ—©å‘ç°å¹¶è§£å†³é—®é¢˜ã€‚</p><h2 id="10-çº¿ç¨‹æ± ä¸­shutdown-ï¼ŒshutdownNow-è¿™ä¸¤ä¸ªæ–¹æ³•æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ"><a href="#10-çº¿ç¨‹æ± ä¸­shutdown-ï¼ŒshutdownNow-è¿™ä¸¤ä¸ªæ–¹æ³•æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ" class="headerlink" title="10.çº¿ç¨‹æ± ä¸­shutdown ()ï¼ŒshutdownNow()è¿™ä¸¤ä¸ªæ–¹æ³•æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ"></a>10.çº¿ç¨‹æ± ä¸­shutdown ()ï¼ŒshutdownNow()è¿™ä¸¤ä¸ªæ–¹æ³•æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ</h2><p>ä»ä¸‹é¢çš„æºç ã€é«˜äº®ã€‘æ³¨é‡Šå¯ä»¥å¾ˆæ¸…æ™°çš„çœ‹å‡ºä¸¤è€…çš„åŒºåˆ«ï¼š</p><ul><li>shutdown<strong>ä½¿ç”¨äº†ä»¥åä¼šç½®çŠ¶æ€ä¸ºSHUTDOWN</strong>ï¼Œæ­£åœ¨æ‰§è¡Œçš„ä»»åŠ¡ä¼šç»§ç»­æ‰§è¡Œä¸‹å»ï¼Œæ²¡æœ‰è¢«æ‰§è¡Œçš„åˆ™ä¸­æ–­ã€‚<strong>æ­¤æ—¶ï¼Œåˆ™ä¸èƒ½å†å¾€çº¿ç¨‹æ± ä¸­æ·»åŠ ä»»ä½•ä»»åŠ¡ï¼Œå¦åˆ™å°†ä¼šæŠ›å‡º RejectedExecutionException å¼‚å¸¸</strong> æ¯”è¾ƒå¹³ç¼“çš„å…³é—­æ–¹å¼</li><li>è€Œ shutdownNow <strong>ä¸ºSTOPï¼Œå¹¶è¯•å›¾åœæ­¢æ‰€æœ‰æ­£åœ¨æ‰§è¡Œçš„çº¿ç¨‹ï¼Œä¸å†å¤„ç†è¿˜åœ¨æ± é˜Ÿåˆ—ä¸­ç­‰å¾…çš„ä»»åŠ¡ï¼Œå½“ç„¶ï¼Œå®ƒä¼šè¿”å›é‚£äº›æœªæ‰§è¡Œçš„ä»»åŠ¡ã€‚</strong> å®ƒè¯•å›¾ç»ˆæ­¢çº¿ç¨‹çš„æ–¹æ³•æ˜¯é€šè¿‡è°ƒç”¨ <strong>Thread.interrupt() æ–¹æ³•æ¥å®ç°çš„ï¼Œ</strong>ä½†æ˜¯è¿™ç§æ–¹æ³•çš„ä½œç”¨æœ‰é™ï¼Œ<strong>å¦‚æœçº¿ç¨‹ä¸­æ²¡æœ‰sleep ã€waitã€Conditionã€å®šæ—¶é”ç­‰åº”ç”¨, interrupt()æ–¹æ³•æ˜¯æ— æ³•ä¸­æ–­å½“å‰çš„çº¿ç¨‹çš„ã€‚</strong>æ‰€ä»¥ï¼ŒShutdownNow()å¹¶ä¸ä»£è¡¨çº¿ç¨‹æ± å°±ä¸€å®šç«‹å³å°±èƒ½é€€å‡ºï¼Œå®ƒå¯èƒ½å¿…é¡»è¦ç­‰å¾…æ‰€æœ‰æ­£åœ¨æ‰§è¡Œçš„ä»»åŠ¡éƒ½æ‰§è¡Œå®Œæˆäº†æ‰èƒ½é€€å‡ºã€‚</li></ul><p><strong>shutdown æºç ï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">shutdown</span><span class="params">()</span> &#123;</span><br><span class="line"><span class="keyword">final</span> <span class="type">ReentrantLock</span> <span class="variable">mainLock</span> <span class="operator">=</span> <span class="built_in">this</span>.mainLock;</span><br><span class="line">mainLock.lock();</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">checkShutdownAccess();</span><br><span class="line"><span class="comment">// é«˜äº®</span></span><br><span class="line">advanceRunState(SHUTDOWN);</span><br><span class="line">interruptIdleWorkers();</span><br><span class="line">onShutdown();</span><br><span class="line">&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">mainLock.unlock();</span><br><span class="line">&#125;</span><br><span class="line">tryTerminate();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>shutdownNow æºç ï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> List&lt;Runnable&gt; <span class="title function_">shutdownNow</span><span class="params">()</span> &#123;</span><br><span class="line">List&lt;Runnable&gt; tasks;</span><br><span class="line"><span class="keyword">final</span> <span class="type">ReentrantLock</span> <span class="variable">mainLock</span> <span class="operator">=</span> <span class="built_in">this</span>.mainLock;</span><br><span class="line">mainLock.lock();</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">checkShutdownAccess();</span><br><span class="line"><span class="comment">// é«˜äº®</span></span><br><span class="line">advanceRunState(STOP);</span><br><span class="line">interruptWorkers();</span><br><span class="line"><span class="comment">// é«˜äº®</span></span><br><span class="line">tasks = drainQueue();</span><br><span class="line">&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">mainLock.unlock();</span><br><span class="line">&#125;</span><br><span class="line">tryTerminate();</span><br><span class="line"><span class="comment">// é«˜äº®</span></span><br><span class="line"><span class="keyword">return</span> tasks;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="11-æäº¤ç»™çº¿ç¨‹æ± ä¸­çš„ä»»åŠ¡å¯ä»¥è¢«æ’¤å›å—ï¼Ÿ"><a href="#11-æäº¤ç»™çº¿ç¨‹æ± ä¸­çš„ä»»åŠ¡å¯ä»¥è¢«æ’¤å›å—ï¼Ÿ" class="headerlink" title="11.æäº¤ç»™çº¿ç¨‹æ± ä¸­çš„ä»»åŠ¡å¯ä»¥è¢«æ’¤å›å—ï¼Ÿ"></a>11.æäº¤ç»™çº¿ç¨‹æ± ä¸­çš„ä»»åŠ¡å¯ä»¥è¢«æ’¤å›å—ï¼Ÿ</h2><p>å¯ä»¥ï¼Œå½“å‘çº¿ç¨‹æ± æäº¤ä»»åŠ¡æ—¶ï¼Œ<strong>ä¼šå¾—åˆ°ä¸€ä¸ª<code>Future</code>å¯¹è±¡ã€‚è¿™ä¸ª<code>Future</code>å¯¹è±¡æä¾›äº†å‡ ç§æ–¹æ³•æ¥ç®¡ç†ä»»åŠ¡çš„æ‰§è¡Œï¼ŒåŒ…æ‹¬å–æ¶ˆä»»åŠ¡ã€‚</strong></p><p>å–æ¶ˆä»»åŠ¡çš„ä¸»è¦æ–¹æ³•æ˜¯<code>Future</code>æ¥å£ä¸­çš„<code>cancel(boolean mayInterruptIfRunning)</code>æ–¹æ³•ã€‚è¿™ä¸ªæ–¹æ³•å°è¯•å–æ¶ˆæ‰§è¡Œçš„ä»»åŠ¡ã€‚<strong>å‚æ•°<code>mayInterruptIfRunning</code>æŒ‡ç¤ºæ˜¯å¦å…è®¸ä¸­æ–­æ­£åœ¨æ‰§è¡Œçš„ä»»åŠ¡</strong>ã€‚å¦‚æœè®¾ç½®ä¸º<code>true</code>ï¼Œåˆ™è¡¨ç¤ºå¦‚æœä»»åŠ¡å·²ç»å¼€å§‹æ‰§è¡Œï¼Œé‚£ä¹ˆå…è®¸ä¸­æ–­ä»»åŠ¡ï¼›å¦‚æœè®¾ç½®ä¸º<code>false</code>ï¼Œä»»åŠ¡å·²ç»å¼€å§‹æ‰§è¡Œåˆ™ä¸ä¼šè¢«ä¸­æ–­ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Future</span>&lt;V&gt; &#123;</span><br><span class="line">    <span class="comment">// æ˜¯å¦å–æ¶ˆçº¿ç¨‹çš„æ‰§è¡Œ</span></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">cancel</span><span class="params">(<span class="type">boolean</span> mayInterruptIfRunning)</span>;</span><br><span class="line">    <span class="comment">// çº¿ç¨‹æ˜¯å¦è¢«å–æ¶ˆ</span></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">isCancelled</span><span class="params">()</span>;</span><br><span class="line">    <span class="comment">//çº¿ç¨‹æ˜¯å¦æ‰§è¡Œå®Œæ¯•</span></span><br><span class="line">    <span class="type">boolean</span> <span class="title function_">isDone</span><span class="params">()</span>;</span><br><span class="line">      <span class="comment">// ç«‹å³è·å¾—çº¿ç¨‹è¿”å›çš„ç»“æœ</span></span><br><span class="line">    V <span class="title function_">get</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException, ExecutionException;</span><br><span class="line">      <span class="comment">// å»¶æ—¶æ—¶é—´åå†è·å¾—çº¿ç¨‹è¿”å›çš„ç»“æœ</span></span><br><span class="line">    V <span class="title function_">get</span><span class="params">(<span class="type">long</span> timeout, TimeUnit unit)</span></span><br><span class="line">        <span class="keyword">throws</span> InterruptedException, ExecutionException, TimeoutException;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å–æ¶ˆçº¿ç¨‹æ± ä¸­ä»»åŠ¡çš„æ–¹å¼ï¼Œä»£ç å¦‚ä¸‹ï¼Œé€šè¿‡ future å¯¹è±¡çš„ cancel(boolean) å‡½æ•°æ¥å®šå‘å–æ¶ˆç‰¹å®šçš„ä»»åŠ¡ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">ExecutorService</span> <span class="variable">service</span> <span class="operator">=</span> Executors.newSingleThreadExecutor();</span><br><span class="line">        <span class="type">Future</span> <span class="variable">future</span> <span class="operator">=</span> service.submit(<span class="keyword">new</span> <span class="title class_">TheradDemo</span>());</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">          <span class="comment">// å¯èƒ½æŠ›å‡ºå¼‚å¸¸</span></span><br><span class="line">            future.get();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ExecutionException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;<span class="keyword">finally</span> &#123;</span><br><span class="line">          <span class="comment">//ç»ˆæ­¢ä»»åŠ¡çš„æ‰§è¡Œ</span></span><br><span class="line">            future.cancel(<span class="literal">true</span>);</span><br><span class="line">        &#125;</span><br><span class="line"> &#125;</span><br></pre></td></tr></table></figure><h1 id="å¤šçº¿ç¨‹"><a href="#å¤šçº¿ç¨‹" class="headerlink" title="å¤šçº¿ç¨‹"></a>å¤šçº¿ç¨‹</h1><h2 id="1-javaé‡Œé¢çš„çº¿ç¨‹å’Œæ“ä½œç³»ç»Ÿçš„çº¿ç¨‹ä¸€æ ·å—ï¼Ÿ"><a href="#1-javaé‡Œé¢çš„çº¿ç¨‹å’Œæ“ä½œç³»ç»Ÿçš„çº¿ç¨‹ä¸€æ ·å—ï¼Ÿ" class="headerlink" title="1.javaé‡Œé¢çš„çº¿ç¨‹å’Œæ“ä½œç³»ç»Ÿçš„çº¿ç¨‹ä¸€æ ·å—ï¼Ÿ"></a>1.javaé‡Œé¢çš„çº¿ç¨‹å’Œæ“ä½œç³»ç»Ÿçš„çº¿ç¨‹ä¸€æ ·å—ï¼Ÿ</h2><p>Java åº•å±‚ä¼šè°ƒç”¨ pthread_create æ¥åˆ›å»ºçº¿ç¨‹ï¼Œæ‰€ä»¥æœ¬è´¨ä¸Š java ç¨‹åºåˆ›å»ºçš„çº¿ç¨‹ï¼Œå°±æ˜¯å’Œæ“ä½œç³»ç»Ÿçº¿ç¨‹æ˜¯ä¸€æ ·çš„ï¼Œæ˜¯ 1 å¯¹ 1 çš„çº¿ç¨‹æ¨¡å‹ã€‚</p><h2 id="2-ä½¿ç”¨å¤šçº¿ç¨‹è¦æ³¨æ„å“ªäº›é—®é¢˜ï¼Ÿ"><a href="#2-ä½¿ç”¨å¤šçº¿ç¨‹è¦æ³¨æ„å“ªäº›é—®é¢˜ï¼Ÿ" class="headerlink" title="2.ä½¿ç”¨å¤šçº¿ç¨‹è¦æ³¨æ„å“ªäº›é—®é¢˜ï¼Ÿ"></a>2.ä½¿ç”¨å¤šçº¿ç¨‹è¦æ³¨æ„å“ªäº›é—®é¢˜ï¼Ÿ</h2><p>è¦ä¿è¯å¤šçº¿ç¨‹çš„ç¨‹åºæ˜¯å®‰å…¨ï¼Œä¸è¦å‡ºç°æ•°æ®ç«äº‰é€ æˆçš„æ•°æ®æ··ä¹±çš„é—®é¢˜ã€‚</p><p>Javaçš„çº¿ç¨‹å®‰å…¨åœ¨ä¸‰ä¸ªæ–¹é¢ä½“ç°ï¼š</p><ul><li><strong>åŸå­æ€§</strong>ï¼šæä¾›äº’æ–¥è®¿é—®ï¼ŒåŒä¸€æ—¶åˆ»åªèƒ½æœ‰ä¸€ä¸ªçº¿ç¨‹å¯¹æ•°æ®è¿›è¡Œæ“ä½œï¼Œåœ¨Javaä¸­ä½¿ç”¨äº†<strong>atomic</strong>åŒ…ï¼ˆè¿™ä¸ªåŒ…æä¾›äº†ä¸€äº›æ”¯æŒåŸå­æ“ä½œçš„ç±»ï¼Œè¿™äº›ç±»å¯ä»¥åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ä¿è¯æ“ä½œçš„åŸå­æ€§ï¼‰å’Œsynchronizedå…³é”®å­—æ¥ç¡®ä¿åŸå­æ€§ï¼›æ¯”å¦‚CAS</li><li><strong>å¯è§æ€§</strong>ï¼šä¸€ä¸ªçº¿ç¨‹å¯¹ä¸»å†…å­˜çš„ä¿®æ”¹å¯ä»¥åŠæ—¶åœ°è¢«å…¶ä»–çº¿ç¨‹çœ‹åˆ°ï¼Œåœ¨Javaä¸­ä½¿ç”¨äº†<strong>synchronizedå’Œvolatile</strong>è¿™ä¸¤ä¸ªå…³é”®å­—ç¡®ä¿å¯è§æ€§ï¼›</li><li><strong>æœ‰åºæ€§</strong>ï¼šä¸€ä¸ªçº¿ç¨‹è§‚å¯Ÿå…¶ä»–çº¿ç¨‹ä¸­çš„æŒ‡ä»¤æ‰§è¡Œé¡ºåºï¼Œç”±äºæŒ‡ä»¤é‡æ’åºï¼Œè¯¥è§‚å¯Ÿç»“æœä¸€èˆ¬æ‚ä¹±æ— åºï¼Œåœ¨Javaä¸­ä½¿ç”¨äº†happens-beforeåŸåˆ™æ¥ç¡®ä¿æœ‰åºæ€§ã€‚æ¯”å¦‚volatile</li></ul><h2 id="3-ä¿è¯æ•°æ®çš„ä¸€è‡´æ€§æœ‰å“ªäº›æ–¹æ¡ˆå‘¢ï¼Ÿ"><a href="#3-ä¿è¯æ•°æ®çš„ä¸€è‡´æ€§æœ‰å“ªäº›æ–¹æ¡ˆå‘¢ï¼Ÿ" class="headerlink" title="3.ä¿è¯æ•°æ®çš„ä¸€è‡´æ€§æœ‰å“ªäº›æ–¹æ¡ˆå‘¢ï¼Ÿ"></a>3.ä¿è¯æ•°æ®çš„ä¸€è‡´æ€§æœ‰å“ªäº›æ–¹æ¡ˆå‘¢ï¼Ÿ</h2><ul><li><strong>äº‹åŠ¡ç®¡ç†</strong>ï¼šä½¿ç”¨æ•°æ®åº“äº‹åŠ¡æ¥ç¡®ä¿ä¸€ç»„æ•°æ®åº“æ“ä½œè¦ä¹ˆå…¨éƒ¨æˆåŠŸæäº¤ï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥å›æ»šã€‚é€šè¿‡ACIDï¼ˆåŸå­æ€§ã€ä¸€è‡´æ€§ã€éš”ç¦»æ€§ã€æŒä¹…æ€§ï¼‰å±æ€§ï¼Œæ•°æ®åº“äº‹åŠ¡å¯ä»¥ä¿è¯æ•°æ®çš„ä¸€è‡´æ€§ã€‚</li><li><strong>é”æœºåˆ¶</strong>ï¼šä½¿ç”¨é”æ¥å®ç°å¯¹å…±äº«èµ„æºçš„äº’æ–¥è®¿é—®ã€‚åœ¨ Java ä¸­ï¼Œå¯ä»¥ä½¿ç”¨ synchronized å…³é”®å­—ã€ReentrantLock æˆ–å…¶ä»–é”æœºåˆ¶æ¥æ§åˆ¶å¹¶å‘è®¿é—®ï¼Œä»è€Œé¿å…å¹¶å‘æ“ä½œå¯¼è‡´æ•°æ®ä¸ä¸€è‡´ã€‚</li><li><strong>ç‰ˆæœ¬æ§åˆ¶</strong>ï¼šé€šè¿‡ä¹è§‚é”çš„æ–¹å¼ï¼Œåœ¨<strong>æ›´æ–°æ•°æ®æ—¶è®°å½•æ•°æ®çš„ç‰ˆæœ¬ä¿¡æ¯</strong>ï¼Œä»è€Œé¿å…åŒæ—¶å¯¹åŒä¸€æ•°æ®è¿›è¡Œä¿®æ”¹ï¼Œè¿›è€Œä¿è¯æ•°æ®çš„ä¸€è‡´æ€§ã€‚</li></ul><h2 id="4-çº¿ç¨‹çš„åˆ›å»ºæ–¹å¼æœ‰å“ªäº›"><a href="#4-çº¿ç¨‹çš„åˆ›å»ºæ–¹å¼æœ‰å“ªäº›" class="headerlink" title="4.çº¿ç¨‹çš„åˆ›å»ºæ–¹å¼æœ‰å“ªäº›?"></a>4.çº¿ç¨‹çš„åˆ›å»ºæ–¹å¼æœ‰å“ªäº›?</h2><blockquote><p>1.ç»§æ‰¿Threadç±»</p></blockquote><p>è¿™æ˜¯æœ€ç›´æ¥çš„ä¸€ç§æ–¹å¼ï¼Œç”¨æˆ·è‡ªå®šä¹‰ç±»ç»§æ‰¿java.lang.Threadç±»ï¼Œ<strong>é‡å†™å…¶run()æ–¹æ³•</strong>ï¼Œrun()æ–¹æ³•ä¸­å®šä¹‰äº†çº¿ç¨‹æ‰§è¡Œçš„å…·ä½“ä»»åŠ¡ã€‚åˆ›å»ºè¯¥ç±»çš„å®ä¾‹åï¼Œé€šè¿‡è°ƒç”¨start()æ–¹æ³•å¯åŠ¨çº¿ç¨‹ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyThread</span> <span class="keyword">extends</span> <span class="title class_">Thread</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// çº¿ç¨‹æ‰§è¡Œçš„ä»£ç </span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="type">MyThread</span> <span class="variable">t</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyThread</span>();</span><br><span class="line">    t.start();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é‡‡ç”¨ç»§æ‰¿Threadç±»æ–¹å¼</p><ul><li>ä¼˜ç‚¹: ç¼–å†™ç®€å•ï¼Œå¦‚æœéœ€è¦è®¿é—®å½“å‰çº¿ç¨‹ï¼Œæ— éœ€ä½¿ç”¨Thread.currentThread ()æ–¹æ³•ï¼Œç›´æ¥ä½¿ç”¨thisï¼Œå³å¯è·å¾—å½“å‰çº¿ç¨‹</li><li>ç¼ºç‚¹:å› ä¸ºçº¿ç¨‹ç±»å·²ç»<strong>ç»§æ‰¿äº†Threadç±»ï¼Œæ‰€ä»¥ä¸èƒ½å†ç»§æ‰¿å…¶ä»–çš„çˆ¶ç±»</strong></li></ul><blockquote><p>2.å®ç°Runnableæ¥å£</p></blockquote><p>å¦‚æœä¸€ä¸ªç±»å·²ç»ç»§æ‰¿äº†å…¶ä»–ç±»ï¼Œå°±ä¸èƒ½å†ç»§æ‰¿Threadç±»ï¼Œæ­¤æ—¶å¯ä»¥å®ç°java.lang.Runnableæ¥å£ã€‚<strong>å®ç°Runnableæ¥å£éœ€è¦é‡å†™run()æ–¹æ³•</strong>ï¼Œç„¶åå°†æ­¤Runnableå¯¹è±¡ä½œä¸ºå‚æ•°ä¼ é€’ç»™Threadç±»çš„æ„é€ å™¨ï¼Œåˆ›å»ºThreadå¯¹è±¡åè°ƒç”¨å…¶start()æ–¹æ³•å¯åŠ¨çº¿ç¨‹ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyRunnable</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// çº¿ç¨‹æ‰§è¡Œçš„ä»£ç </span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="type">Thread</span> <span class="variable">t</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(<span class="keyword">new</span> <span class="title class_">MyRunnable</span>());</span><br><span class="line">    t.start();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é‡‡ç”¨å®ç°Runnableæ¥å£æ–¹å¼ï¼š</p><ul><li>ä¼˜ç‚¹ï¼šçº¿ç¨‹ç±»åªæ˜¯å®ç°äº†Runableæ¥å£ï¼Œè¿˜å¯ä»¥ç»§æ‰¿å…¶ä»–çš„ç±»ã€‚åœ¨è¿™ç§æ–¹å¼ä¸‹ï¼Œå¯ä»¥å¤šä¸ªçº¿ç¨‹å…±äº«åŒä¸€ä¸ªç›®æ ‡å¯¹è±¡ï¼Œæ‰€ä»¥éå¸¸é€‚åˆå¤šä¸ªç›¸åŒçº¿ç¨‹æ¥å¤„ç†åŒä¸€ä»½èµ„æºçš„æƒ…å†µï¼Œä»è€Œå¯ä»¥å°†CPUä»£ç å’Œæ•°æ®åˆ†å¼€ï¼Œå½¢æˆæ¸…æ™°çš„æ¨¡å‹ï¼Œè¾ƒå¥½åœ°ä½“ç°äº†é¢å‘å¯¹è±¡çš„æ€æƒ³ã€‚</li><li>ç¼ºç‚¹ï¼š<strong>ç¼–ç¨‹ç¨å¾®å¤æ‚ï¼Œå¦‚æœéœ€è¦è®¿é—®å½“å‰çº¿ç¨‹ï¼Œå¿…é¡»ä½¿ç”¨Thread.currentThread()æ–¹æ³•ã€‚</strong></li></ul><blockquote><ol><li>å®ç°Callableæ¥å£ä¸FutureTask</li></ol></blockquote><p>java.util.concurrent.Callableæ¥å£ç±»ä¼¼äºRunnableï¼Œ<strong>ä½†Callableçš„call()æ–¹æ³•å¯ä»¥æœ‰è¿”å›å€¼å¹¶ä¸”å¯ä»¥æŠ›å‡ºå¼‚å¸¸ã€‚</strong>è¦æ‰§è¡ŒCallableä»»åŠ¡ï¼Œéœ€å°†å®ƒåŒ…è£…è¿›ä¸€ä¸ª<strong>FutureTask</strong>ï¼Œå› ä¸ºThreadç±»çš„æ„é€ å™¨åªæ¥å—Runnableå‚æ•°ï¼Œè€ŒFutureTaskå®ç°äº†Runnableæ¥å£ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyCallable</span> <span class="keyword">implements</span> <span class="title class_">Callable</span>&lt;Integer&gt; &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Integer <span class="title function_">call</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="comment">// çº¿ç¨‹æ‰§è¡Œçš„ä»£ç ï¼Œè¿™é‡Œè¿”å›ä¸€ä¸ªæ•´å‹ç»“æœ</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="type">MyCallable</span> <span class="variable">task</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyCallable</span>();</span><br><span class="line">    FutureTask&lt;Integer&gt; futureTask = <span class="keyword">new</span> <span class="title class_">FutureTask</span>&lt;&gt;(task);</span><br><span class="line">    <span class="type">Thread</span> <span class="variable">t</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(futureTask);</span><br><span class="line">    t.start();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="type">Integer</span> <span class="variable">result</span> <span class="operator">=</span> futureTask.get();  <span class="comment">// è·å–çº¿ç¨‹æ‰§è¡Œç»“æœ</span></span><br><span class="line">        System.out.println(<span class="string">&quot;Result: &quot;</span> + result);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (InterruptedException | ExecutionException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é‡‡ç”¨å®ç°Callableæ¥å£æ–¹å¼ï¼š</p><ul><li>ç¼ºç‚¹ï¼šç¼–ç¨‹ç¨å¾®å¤æ‚ï¼Œå¦‚æœéœ€è¦è®¿é—®å½“å‰çº¿ç¨‹ï¼Œ<strong>å¿…é¡»è°ƒç”¨Thread.currentThread()æ–¹æ³•ã€‚</strong></li><li>ä¼˜ç‚¹ï¼šçº¿ç¨‹åªæ˜¯å®ç°Runnableæˆ–å®ç°Callableæ¥å£ï¼Œè¿˜å¯ä»¥ç»§æ‰¿å…¶ä»–ç±»ã€‚è¿™ç§æ–¹å¼ä¸‹ï¼Œå¤šä¸ªçº¿ç¨‹å¯ä»¥å…±äº«ä¸€ä¸ªtargetå¯¹è±¡ï¼Œéå¸¸é€‚åˆå¤šçº¿ç¨‹å¤„ç†åŒä¸€ä»½èµ„æºçš„æƒ…å½¢ã€‚</li></ul><blockquote><ol><li>ä½¿ç”¨çº¿ç¨‹æ± ï¼ˆExecutoræ¡†æ¶ï¼‰</li></ol></blockquote><p>ä»Java 5å¼€å§‹å¼•å…¥çš„java.util.concurrent.ExecutorServiceå’Œç›¸å…³ç±»æä¾›äº†çº¿ç¨‹æ± çš„æ”¯æŒï¼Œè¿™æ˜¯ä¸€ç§æ›´é«˜æ•ˆçš„çº¿ç¨‹ç®¡ç†æ–¹å¼ï¼Œé¿å…äº†é¢‘ç¹åˆ›å»ºå’Œé”€æ¯çº¿ç¨‹çš„å¼€é”€ã€‚å¯ä»¥é€šè¿‡<strong>Executors</strong>ç±»çš„é™æ€æ–¹æ³•åˆ›å»ºä¸åŒç±»å‹çš„çº¿ç¨‹æ± ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Task</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// çº¿ç¨‹æ‰§è¡Œçš„ä»£ç </span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">    <span class="type">ExecutorService</span> <span class="variable">executor</span> <span class="operator">=</span> Executors.newFixedThreadPool(<span class="number">10</span>);  <span class="comment">// åˆ›å»ºå›ºå®šå¤§å°çš„çº¿ç¨‹æ± </span></span><br><span class="line">    <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">100</span>; i++) &#123;</span><br><span class="line">        executor.submit(<span class="keyword">new</span> <span class="title class_">Task</span>());  <span class="comment">// æäº¤ä»»åŠ¡åˆ°çº¿ç¨‹æ± æ‰§è¡Œ</span></span><br><span class="line">    &#125;</span><br><span class="line">    executor.shutdown();  <span class="comment">// å…³é—­çº¿ç¨‹æ± </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é‡‡ç”¨çº¿ç¨‹æ± æ–¹å¼ï¼š</p><ul><li>ç¼ºç‚¹ï¼šç¨‹æ± å¢åŠ äº†ç¨‹åºçš„å¤æ‚åº¦ï¼Œç‰¹åˆ«æ˜¯å½“æ¶‰åŠçº¿ç¨‹æ± å‚æ•°è°ƒæ•´å’Œæ•…éšœæ’æŸ¥æ—¶ã€‚<strong>é”™è¯¯çš„é…ç½®å¯èƒ½å¯¼è‡´æ­»é”ã€èµ„æºè€—å°½ç­‰é—®é¢˜</strong>ï¼Œè¿™äº›é—®é¢˜çš„è¯Šæ–­å’Œä¿®å¤å¯èƒ½è¾ƒä¸ºå¤æ‚ã€‚</li><li>ä¼˜ç‚¹ï¼šçº¿ç¨‹æ± å¯ä»¥é‡ç”¨é¢„å…ˆåˆ›å»ºçš„çº¿ç¨‹ï¼Œé¿å…äº†çº¿ç¨‹åˆ›å»ºå’Œé”€æ¯çš„å¼€é”€ï¼Œæ˜¾è‘—æé«˜äº†ç¨‹åºçš„æ€§èƒ½ã€‚å¯¹äºéœ€è¦å¿«é€Ÿå“åº”çš„å¹¶å‘è¯·æ±‚ï¼Œçº¿ç¨‹æ± å¯ä»¥è¿…é€Ÿæä¾›çº¿ç¨‹æ¥å¤„ç†ä»»åŠ¡ï¼Œå‡å°‘ç­‰å¾…æ—¶é—´ã€‚å¹¶ä¸”ï¼Œçº¿ç¨‹æ± èƒ½å¤Ÿæœ‰æ•ˆæ§åˆ¶è¿è¡Œçš„çº¿ç¨‹æ•°é‡ï¼Œé˜²æ­¢å› åˆ›å»ºè¿‡å¤šçº¿ç¨‹å¯¼è‡´çš„ç³»ç»Ÿèµ„æºè€—å°½ï¼ˆå¦‚å†…å­˜æº¢å‡ºï¼‰ã€‚é€šè¿‡åˆç†é…ç½®çº¿ç¨‹æ± å¤§å°ï¼Œå¯ä»¥æœ€å¤§åŒ–CPUåˆ©ç”¨ç‡å’Œç³»ç»Ÿååé‡ã€‚</li></ul><p>Exectorsæä¾›çš„ä¸‰ä¸ªçº¿ç¨‹æ± ä¸å¥½ä½¿ï¼Œè¦å®é™…åº”è¯¥è¿˜æ˜¯åº”è¯¥è‡ªå·±è®¾è®¡ä¸€ä¸ªçº¿ç¨‹æ± </p><h2 id="5-æ€ä¹ˆå¯åŠ¨çº¿ç¨‹-ï¼Ÿ"><a href="#5-æ€ä¹ˆå¯åŠ¨çº¿ç¨‹-ï¼Ÿ" class="headerlink" title="5.æ€ä¹ˆå¯åŠ¨çº¿ç¨‹ ï¼Ÿ"></a>5.æ€ä¹ˆå¯åŠ¨çº¿ç¨‹ ï¼Ÿ</h2><p>å¯åŠ¨çº¿ç¨‹çš„é€šè¿‡Threadç±»çš„<strong>start()</strong>ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//åˆ›å»ºä¸¤ä¸ªçº¿ç¨‹ï¼Œç”¨startå¯åŠ¨çº¿ç¨‹</span></span><br><span class="line"><span class="type">MyThread</span> <span class="variable">myThread1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyThread</span>();  </span><br><span class="line"><span class="type">MyThread</span> <span class="variable">myThread2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyThread</span>();  </span><br><span class="line">myThread1.start();  </span><br><span class="line">myThread2.start();  </span><br></pre></td></tr></table></figure><p>æ–°å»ºçº¿ç¨‹è°ƒç”¨<strong>start()æ–¹æ³•å</strong>ï¼Œçº¿ç¨‹å¹¶ä¸ä¼šç«‹å³è¿›å…¥è¿è¡ŒçŠ¶æ€ã€‚çº¿ç¨‹çš„çŠ¶æ€å˜åŒ–æ˜¯ï¼š<strong>æ–°å»ºâ†’å°±ç»ªâ†’è¿è¡Œ</strong>ã€‚è°ƒç”¨start()æ–¹æ³•åï¼Œçº¿ç¨‹ä¼šè¿›å…¥å°±ç»ªçŠ¶æ€ï¼Œç­‰å¾…CPUè°ƒåº¦æ‰èƒ½è¿›å…¥è¿è¡ŒçŠ¶æ€ã€‚è¿™å–å†³äºçº¿ç¨‹è°ƒåº¦å™¨çš„è°ƒåº¦ç­–ç•¥ã€‚start()æ–¹æ³•ä¼š<strong>åˆ›å»ºæ–°çš„çº¿ç¨‹å¹¶æ‰§è¡Œrun()æ–¹æ³•</strong>ï¼Œè€Œç›´æ¥è°ƒç”¨run()æ–¹æ³•åªä¼šåœ¨<strong>å½“å‰çº¿ç¨‹ä¸­æ‰§è¡Œ</strong>ï¼Œä¸ä¼šå¯åŠ¨æ–°çº¿ç¨‹ã€‚</p><h2 id="6-å¦‚ä½•åœæ­¢ä¸€ä¸ªçº¿ç¨‹çš„è¿è¡Œ"><a href="#6-å¦‚ä½•åœæ­¢ä¸€ä¸ªçº¿ç¨‹çš„è¿è¡Œ" class="headerlink" title="6.å¦‚ä½•åœæ­¢ä¸€ä¸ªçº¿ç¨‹çš„è¿è¡Œ?"></a>6.å¦‚ä½•åœæ­¢ä¸€ä¸ªçº¿ç¨‹çš„è¿è¡Œ?</h2><p>ä¸»è¦æœ‰è¿™äº›æ–¹æ³•ï¼š</p><ul><li><strong>å¼‚å¸¸æ³•åœæ­¢</strong>ï¼š<strong>çº¿ç¨‹è°ƒç”¨interrupt()æ–¹æ³•åï¼Œåœ¨çº¿ç¨‹çš„runæ–¹æ³•ä¸­åˆ¤æ–­å½“å‰å¯¹è±¡çš„interrupted()çŠ¶æ€</strong>ï¼Œå¦‚æœæ˜¯ä¸­æ–­çŠ¶æ€åˆ™æŠ›å‡ºå¼‚å¸¸ï¼Œè¾¾åˆ°ä¸­æ–­çº¿ç¨‹çš„æ•ˆæœã€‚</li><li><strong>åœ¨æ²‰ç¡ä¸­åœæ­¢</strong>ï¼šå…ˆå°†<strong>çº¿ç¨‹sleep</strong>ï¼Œç„¶å<strong>è°ƒç”¨interruptæ ‡è®°ä¸­æ–­çŠ¶æ€</strong>ï¼Œinterruptä¼šå°†é˜»å¡çŠ¶æ€çš„çº¿ç¨‹ä¸­æ–­ã€‚ä¼šæŠ›å‡ºä¸­æ–­å¼‚å¸¸ï¼Œè¾¾åˆ°åœæ­¢çº¿ç¨‹çš„æ•ˆæœ</li><li><strong>stop()æš´åŠ›åœæ­¢</strong>ï¼šçº¿ç¨‹è°ƒç”¨stop()æ–¹æ³•ä¼šè¢«æš´åŠ›åœæ­¢ï¼Œæ–¹æ³•å·²å¼ƒç”¨ï¼Œè¯¥æ–¹æ³•ä¼šæœ‰ä¸å¥½çš„åæœï¼šå¼ºåˆ¶è®©çº¿ç¨‹åœæ­¢æœ‰å¯èƒ½ä½¿ä¸€äº›è¯·ç†æ€§çš„å·¥ä½œå¾—ä¸åˆ°å®Œæˆã€‚å¯ä»¥ä½¿ç”¨shutdownæ–¹æ³•</li><li><strong>ä½¿ç”¨returnåœæ­¢çº¿ç¨‹</strong>ï¼š<strong>è°ƒç”¨interruptæ ‡è®°ä¸ºä¸­æ–­çŠ¶æ€åï¼Œåœ¨runæ–¹æ³•ä¸­åˆ¤æ–­å½“å‰çº¿ç¨‹çŠ¶æ€ï¼Œå¦‚æœä¸ºä¸­æ–­çŠ¶æ€åˆ™return</strong>ï¼Œèƒ½è¾¾åˆ°åœæ­¢çº¿ç¨‹çš„æ•ˆæœã€‚</li></ul><h2 id="7-è°ƒç”¨-interrupt-æ˜¯å¦‚ä½•è®©çº¿ç¨‹æŠ›å‡ºå¼‚å¸¸çš„"><a href="#7-è°ƒç”¨-interrupt-æ˜¯å¦‚ä½•è®©çº¿ç¨‹æŠ›å‡ºå¼‚å¸¸çš„" class="headerlink" title="7.è°ƒç”¨ interrupt æ˜¯å¦‚ä½•è®©çº¿ç¨‹æŠ›å‡ºå¼‚å¸¸çš„?"></a>7.è°ƒç”¨ interrupt æ˜¯å¦‚ä½•è®©çº¿ç¨‹æŠ›å‡ºå¼‚å¸¸çš„?</h2><p>æ¯ä¸ªçº¿ç¨‹éƒ½ä¸€ä¸ªä¸ä¹‹å…³è”çš„å¸ƒå°”å±æ€§æ¥è¡¨ç¤ºå…¶ä¸­æ–­çŠ¶æ€ï¼Œ<strong>ä¸­æ–­çŠ¶æ€çš„åˆå§‹å€¼ä¸ºfalse</strong>ï¼Œå½“ä¸€ä¸ªçº¿ç¨‹è¢«å…¶å®ƒçº¿ç¨‹è°ƒç”¨<code>Thread.interrupt()</code>æ–¹æ³•ä¸­æ–­æ—¶ï¼Œä¼šæ ¹æ®å®é™…æƒ…å†µåšå‡ºå“åº”ã€‚</p><ul><li>å¦‚æœè¯¥çº¿ç¨‹æ­£åœ¨æ‰§è¡Œä½çº§åˆ«çš„å¯ä¸­æ–­æ–¹æ³•ï¼ˆå¦‚<code>Thread.sleep()</code>ã€<code>Thread.join()</code>æˆ–<code>Object.wait()</code>ï¼‰ï¼Œåˆ™ä¼š<strong>è§£é™¤é˜»å¡</strong>å¹¶<strong>æŠ›å‡º<code>InterruptedException</code>å¼‚å¸¸</strong>ã€‚</li><li>å¦åˆ™<code>Thread.interrupt()</code>ä»…è®¾ç½®çº¿ç¨‹çš„ä¸­æ–­çŠ¶æ€ï¼Œ<strong>åœ¨è¯¥è¢«ä¸­æ–­çš„çº¿ç¨‹ä¸­ç¨åå¯é€šè¿‡è½®è¯¢ä¸­æ–­çŠ¶æ€æ¥å†³å®šæ˜¯å¦è¦åœæ­¢å½“å‰æ­£åœ¨æ‰§è¡Œçš„ä»»åŠ¡ã€‚</strong></li></ul><p><img src="https://uploadfiles.nowcoder.com/images/20250422/59_1745314586904/AB85F6C1A80F74538F959A181704EA92" alt=""></p><h2 id="8-Javaçº¿ç¨‹çš„çŠ¶æ€æœ‰å“ªäº›ï¼Ÿ"><a href="#8-Javaçº¿ç¨‹çš„çŠ¶æ€æœ‰å“ªäº›ï¼Ÿ" class="headerlink" title="8.Javaçº¿ç¨‹çš„çŠ¶æ€æœ‰å“ªäº›ï¼Ÿ"></a>8.Javaçº¿ç¨‹çš„çŠ¶æ€æœ‰å“ªäº›ï¼Ÿ</h2><div class="table-container"><table><thead><tr><th>çº¿ç¨‹çŠ¶æ€</th><th>è§£é‡Š</th></tr></thead><tbody><tr><td>NEW</td><td>å°šæœªå¯åŠ¨çš„çº¿ç¨‹çŠ¶æ€ï¼Œå³çº¿ç¨‹åˆ›å»ºï¼Œ<strong>è¿˜æœªè°ƒç”¨startæ–¹æ³•</strong></td></tr><tr><td>RUNNABLE</td><td><strong>å°±ç»ªçŠ¶æ€</strong>ï¼ˆè°ƒç”¨startï¼Œç­‰å¾…è°ƒåº¦ï¼‰+<strong>æ­£åœ¨è¿è¡Œ</strong></td></tr><tr><td>BLOCKED</td><td><strong>ç­‰å¾…ç›‘è§†å™¨é”</strong>æ—¶ï¼Œé™·å…¥é˜»å¡çŠ¶æ€</td></tr><tr><td>WAITING</td><td>ç­‰å¾…çŠ¶æ€çš„çº¿ç¨‹æ­£åœ¨<strong>ç­‰å¾…</strong>å¦ä¸€çº¿ç¨‹æ‰§è¡Œç‰¹å®šçš„æ“ä½œï¼ˆå¦‚notifyï¼‰</td></tr><tr><td>TIMED_WAITING</td><td>å…·æœ‰<strong>æŒ‡å®šç­‰å¾…æ—¶é—´</strong>çš„ç­‰å¾…çŠ¶æ€</td></tr><tr><td>TERMINATED</td><td>çº¿ç¨‹å®Œæˆæ‰§è¡Œï¼Œ<strong>ç»ˆæ­¢çŠ¶æ€</strong></td></tr></tbody></table></div><h2 id="9-sleep-å’Œ-waitçš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#9-sleep-å’Œ-waitçš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="9.sleep å’Œ waitçš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ"></a>9.sleep å’Œ waitçš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ</h2><p>å¯¹æ¯”ä¾‹è¡¨ï¼š</p><div class="table-container"><table><thead><tr><th><strong>ç‰¹æ€§</strong></th><th><code>sleep()</code></th><th><code>wait()</code></th></tr></thead><tbody><tr><td>æ‰€å±ç±»</td><td><code>Thread</code> ç±»ï¼ˆé™æ€æ–¹æ³•ï¼‰</td><td><code>Object</code> ç±»ï¼ˆå®ä¾‹æ–¹æ³•ï¼‰</td></tr><tr><td>é”é‡Šæ”¾</td><td>âŒ</td><td>âœ…</td></tr><tr><td>ä½¿ç”¨å‰æ</td><td>ä»»æ„ä½ç½®è°ƒç”¨</td><td>å¿…é¡»åœ¨åŒæ­¥å—å†…ï¼ˆæŒæœ‰é”ï¼‰</td></tr><tr><td>å”¤é†’æœºåˆ¶</td><td>è¶…æ—¶è‡ªåŠ¨æ¢å¤</td><td>éœ€ <code>notify()</code>/<code>notifyAll()</code> æˆ–è¶…æ—¶</td></tr><tr><td>è®¾è®¡ç”¨é€”</td><td>æš‚åœçº¿ç¨‹æ‰§è¡Œï¼Œä¸æ¶‰åŠé”åä½œ</td><td>çº¿ç¨‹é—´åè°ƒï¼Œé‡Šæ”¾é”è®©å…¶ä»–çº¿ç¨‹å·¥ä½œ</td></tr></tbody></table></div><ul><li><strong>æ‰€å±åˆ†ç±»çš„ä¸åŒ</strong>ï¼šsleep æ˜¯ <code>Thread</code> ç±»çš„é™æ€æ–¹æ³•ï¼Œå¯ä»¥åœ¨ä»»ä½•åœ°æ–¹ç›´æ¥é€šè¿‡ <code>Thread.sleep()</code> è°ƒç”¨ï¼Œæ— éœ€ä¾èµ–å¯¹è±¡å®ä¾‹ã€‚wait æ˜¯ <code>Object</code> ç±»çš„å®ä¾‹æ–¹æ³•ï¼Œè¿™æ„å‘³ç€å¿…é¡»é€šè¿‡å¯¹è±¡å®ä¾‹æ¥è°ƒç”¨ã€‚</li><li><strong>é”é‡Šæ”¾çš„æƒ…å†µ</strong>ï¼š<code>Thread.sleep()</code> åœ¨è°ƒç”¨æ—¶ï¼Œçº¿ç¨‹ä¼šæš‚åœæ‰§è¡ŒæŒ‡å®šçš„æ—¶é—´ï¼Œä½†ä¸ä¼šé‡Šæ”¾æŒæœ‰çš„å¯¹è±¡é”ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨ <code>sleep</code> æœŸé—´ï¼Œå…¶ä»–çº¿ç¨‹æ— æ³•è·å¾—è¯¥çº¿ç¨‹æŒæœ‰çš„é”ã€‚<code>Object.wait()</code>ï¼šè°ƒç”¨è¯¥æ–¹æ³•æ—¶ï¼Œ<strong>çº¿ç¨‹ä¼šé‡Šæ”¾æŒæœ‰çš„å¯¹è±¡é”ï¼Œè¿›å…¥ç­‰å¾…çŠ¶æ€ï¼Œç›´åˆ°å…¶ä»–çº¿ç¨‹è°ƒç”¨ç›¸åŒå¯¹è±¡çš„ <code>notify()</code> æˆ– <code>notifyAll()</code> æ–¹æ³•å”¤é†’å®ƒ</strong></li><li><strong>ä½¿ç”¨æ¡ä»¶</strong>ï¼šsleep å¯åœ¨ä»»æ„ä½ç½®è°ƒç”¨ï¼Œæ— éœ€äº‹å…ˆè·å–é”ã€‚ <strong>wait å¿…é¡»åœ¨åŒæ­¥å—æˆ–åŒæ­¥æ–¹æ³•å†…è°ƒç”¨ï¼ˆå³çº¿ç¨‹éœ€æŒæœ‰è¯¥å¯¹è±¡çš„é”ï¼‰ï¼Œå¦åˆ™æŠ›å‡º <code>IllegalMonitorStateException</code>ã€‚</strong></li><li><strong>å”¤é†’æœºåˆ¶</strong>ï¼šsleep ä¼‘çœ æ—¶é—´ç»“æŸåï¼Œçº¿ç¨‹ è‡ªåŠ¨æ¢å¤ åˆ°å°±ç»ªçŠ¶æ€ï¼Œç­‰å¾…CPUè°ƒåº¦ã€‚wait éœ€è¦å…¶ä»–çº¿ç¨‹è°ƒç”¨ç›¸åŒå¯¹è±¡çš„ <code>notify()</code> æˆ– <code>notifyAll()</code> æ–¹æ³•æ‰èƒ½è¢«å”¤é†’ã€‚<code>notify()</code> ä¼šéšæœºå”¤é†’ä¸€ä¸ªåœ¨è¯¥å¯¹è±¡ä¸Šç­‰å¾…çš„çº¿ç¨‹ï¼Œè€Œ <code>notifyAll()</code> ä¼šå”¤é†’æ‰€æœ‰åœ¨è¯¥å¯¹è±¡ä¸Šç­‰å¾…çš„çº¿ç¨‹ã€‚</li></ul><h2 id="10-sleepä¼šé‡Šæ”¾cpuå—ï¼Ÿ"><a href="#10-sleepä¼šé‡Šæ”¾cpuå—ï¼Ÿ" class="headerlink" title="10.sleepä¼šé‡Šæ”¾cpuå—ï¼Ÿ"></a>10.sleepä¼šé‡Šæ”¾cpuå—ï¼Ÿ</h2><p>æ˜¯çš„ï¼Œè°ƒç”¨ <code>Thread.sleep()</code> æ—¶ï¼Œçº¿ç¨‹ä¼šé‡Šæ”¾ CPUï¼Œä½†ä¸ä¼šé‡Šæ”¾æŒæœ‰çš„é”ã€‚</p><p><strong>å½“çº¿ç¨‹è°ƒç”¨</strong> <code>sleep()</code> <strong>åï¼Œä¼šä¸»åŠ¨è®©å‡º CPU æ—¶é—´ç‰‡</strong>ï¼Œè¿›å…¥ <code>TIMED_WAITING</code> çŠ¶æ€ã€‚æ­¤æ—¶æ“ä½œç³»ç»Ÿä¼šè§¦å‘è°ƒåº¦ï¼Œå°† CPU åˆ†é…ç»™å…¶ä»–å¤„äºå°±ç»ªçŠ¶æ€çš„çº¿ç¨‹ã€‚è¿™æ ·å…¶ä»–çº¿ç¨‹ï¼ˆæ— è®ºæ˜¯éœ€è¦åŒä¸€é”çš„çº¿ç¨‹è¿˜æ˜¯ä¸ç›¸å…³çº¿ç¨‹ï¼‰ä¾¿æœ‰æœºä¼šæ‰§è¡Œã€‚</p><p><code>sleep()</code> <strong>ä¸ä¼šé‡Šæ”¾çº¿ç¨‹å·²æŒæœ‰çš„ä»»ä½•é”</strong>ï¼ˆå¦‚ <code>synchronized</code> åŒæ­¥ä»£ç å—æˆ–æ–¹æ³•ä¸­è·å–çš„é”ï¼‰ã€‚å› æ­¤ï¼Œå¦‚æœæœ‰å…¶ä»–çº¿ç¨‹è¯•å›¾è·å–åŒä¸€æŠŠé”ï¼Œå®ƒä»¬ä»ä¼šè¢«é˜»å¡ï¼Œç›´åˆ°åŸçº¿ç¨‹é€€å‡ºåŒæ­¥ä»£ç å—ã€‚</p><h2 id="11-blockedå’Œwaitingæœ‰å•¥åŒºåˆ«"><a href="#11-blockedå’Œwaitingæœ‰å•¥åŒºåˆ«" class="headerlink" title="11.blockedå’Œwaitingæœ‰å•¥åŒºåˆ«"></a>11.blockedå’Œwaitingæœ‰å•¥åŒºåˆ«</h2><p>åŒºåˆ«å¦‚ä¸‹ï¼š</p><ul><li><strong>è§¦å‘æ¡ä»¶</strong>:çº¿ç¨‹è¿›å…¥BLOCKEDçŠ¶æ€é€šå¸¸æ˜¯<strong>å› ä¸ºè¯•å›¾è·å–ä¸€ä¸ªå¯¹è±¡çš„é”ï¼ˆmonitor lockï¼‰ï¼Œä½†è¯¥é”å·²ç»è¢«å¦ä¸€ä¸ªçº¿ç¨‹æŒæœ‰ã€‚</strong>è¿™é€šå¸¸å‘ç”Ÿåœ¨å°è¯•è¿›å…¥synchronizedå—æˆ–æ–¹æ³•æ—¶ï¼Œå¦‚æœé”å·²è¢«å ç”¨ï¼Œåˆ™çº¿ç¨‹å°†è¢«é˜»å¡ç›´åˆ°é”å¯ç”¨ã€‚<strong>çº¿ç¨‹è¿›å…¥WAITINGçŠ¶æ€æ˜¯å› ä¸ºå®ƒæ­£åœ¨ç­‰å¾…å¦ä¸€ä¸ªçº¿ç¨‹æ‰§è¡ŒæŸäº›æ“ä½œ</strong>ï¼Œä¾‹å¦‚è°ƒç”¨Object.wait()æ–¹æ³•ã€Thread.join()æ–¹æ³•æˆ–LockSupport.park()æ–¹æ³•ã€‚åœ¨è¿™ç§çŠ¶æ€ä¸‹ï¼Œ<strong>çº¿ç¨‹å°†ä¸ä¼šæ¶ˆè€—CPUèµ„æºï¼Œå¹¶ä¸”ä¸ä¼šå‚ä¸é”çš„ç«äº‰ã€‚</strong></li></ul><p><img src="https://cdn.xiaolincoding.com//picgo/93a0d1531ea1271770686b9e91664a9c.png" alt="img"></p><ul><li><strong>å”¤é†’æœºåˆ¶</strong>:å½“ä¸€ä¸ªçº¿ç¨‹è¢«é˜»å¡ç­‰å¾…é”æ—¶ï¼Œ<strong>ä¸€æ—¦é”è¢«é‡Šæ”¾ï¼Œçº¿ç¨‹å°†æœ‰æœºä¼šé‡æ–°å°è¯•è·å–é”</strong>ã€‚å¦‚æœé”æ­¤æ—¶æœªè¢«å…¶ä»–çº¿ç¨‹è·å–ï¼Œé‚£ä¹ˆçº¿ç¨‹å¯ä»¥ä»BLOCKEDçŠ¶æ€å˜ä¸ºRUNNABLEçŠ¶æ€ã€‚çº¿ç¨‹åœ¨<strong>WAITINGçŠ¶æ€ä¸­éœ€è¦è¢«æ˜¾å¼å”¤é†’</strong>ã€‚ä¾‹å¦‚ï¼Œå¦‚æœçº¿ç¨‹è°ƒç”¨äº†Object.wait()ï¼Œé‚£ä¹ˆå®ƒå¿…é¡»ç­‰å¾…å¦ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨åŒä¸€å¯¹è±¡ä¸Šçš„Object.notify()æˆ–Object.notifyAll()æ–¹æ³•æ‰èƒ½è¢«å”¤é†’ã€‚</li></ul><p>æ‰€ä»¥ï¼ŒBLOCKEDå’ŒWAITINGä¸¤ä¸ªçŠ¶æ€æœ€å¤§çš„åŒºåˆ«æœ‰ä¸¤ä¸ªï¼š</p><ul><li>BLOCKEDæ˜¯<strong>é”ç«äº‰å¤±è´¥åè¢«è¢«åŠ¨è§¦å‘çš„çŠ¶æ€ï¼ŒWAITINGæ˜¯äººä¸ºçš„ä¸»åŠ¨è§¦å‘çš„çŠ¶æ€</strong></li><li>BLCKEDçš„<strong>å”¤é†’æ—¶è‡ªåŠ¨è§¦å‘</strong>çš„ï¼Œè€ŒWAITINGçŠ¶æ€æ˜¯å¿…é¡»è¦é€šè¿‡ç‰¹å®šçš„æ–¹æ³•æ¥ä¸»åŠ¨å”¤é†’</li></ul><h2 id="12-wait-çŠ¶æ€ä¸‹çš„çº¿ç¨‹å¦‚ä½•è¿›è¡Œæ¢å¤åˆ°-running-çŠ¶æ€"><a href="#12-wait-çŠ¶æ€ä¸‹çš„çº¿ç¨‹å¦‚ä½•è¿›è¡Œæ¢å¤åˆ°-running-çŠ¶æ€" class="headerlink" title="12.wait çŠ¶æ€ä¸‹çš„çº¿ç¨‹å¦‚ä½•è¿›è¡Œæ¢å¤åˆ° running çŠ¶æ€?"></a>12.wait çŠ¶æ€ä¸‹çš„çº¿ç¨‹å¦‚ä½•è¿›è¡Œæ¢å¤åˆ° running çŠ¶æ€?</h2><p>ç¨‹ä» <code>ç­‰å¾…ï¼ˆWAITï¼‰</code> çŠ¶æ€æ¢å¤åˆ° <code>è¿è¡Œï¼ˆRUNNINGï¼‰</code> çŠ¶æ€çš„æ ¸å¿ƒæœºåˆ¶æ˜¯ <strong>é€šè¿‡å¤–éƒ¨äº‹ä»¶è§¦å‘æˆ–èµ„æºå¯ç”¨æ€§å˜åŒ–</strong>ï¼Œæ¯”å¦‚ç­‰å¾…çš„çº¿ç¨‹<strong>è¢«å…¶ä»–çº¿ç¨‹å¯¹è±¡å”¤é†’</strong>ï¼Œ<code>notify()</code>å’Œ<code>notifyAll()</code>ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">synchronized</span> (lock) &#123;</span><br><span class="line">    <span class="comment">// çº¿ç¨‹è¿›å…¥ç­‰å¾…çŠ¶æ€ï¼Œé‡Šæ”¾é”</span></span><br><span class="line">    lock.wait(); </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å…¶ä»–çº¿ç¨‹è°ƒç”¨ä»¥ä¸‹ä»£ç å”¤é†’ç­‰å¾…çº¿ç¨‹</span></span><br><span class="line"><span class="keyword">synchronized</span> (lock) &#123;</span><br><span class="line">    lock.notify();      <span class="comment">// å”¤é†’å•ä¸ªçº¿ç¨‹</span></span><br><span class="line">    <span class="comment">// lock.notifyAll(); // å”¤é†’æ‰€æœ‰ç­‰å¾…çº¿ç¨‹</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="13-notify-å’Œ-notifyAll-çš„åŒºåˆ«"><a href="#13-notify-å’Œ-notifyAll-çš„åŒºåˆ«" class="headerlink" title="13.notify å’Œ notifyAll çš„åŒºåˆ«?"></a>13.notify å’Œ notifyAll çš„åŒºåˆ«?</h2><p>åŒæ ·æ˜¯å”¤é†’ç­‰å¾…çš„çº¿ç¨‹ï¼ŒåŒæ ·æœ€å¤šåªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½è·å¾—é”ï¼ŒåŒæ ·ä¸èƒ½æ§åˆ¶å“ªä¸ªçº¿ç¨‹è·å¾—é”ã€‚</p><p>åŒºåˆ«åœ¨äºï¼š</p><ul><li>notifyï¼š<strong>å”¤é†’ä¸€ä¸ªçº¿ç¨‹</strong>ï¼Œå…¶ä»–çº¿ç¨‹ä¾ç„¶å¤„äºwaitçš„ç­‰å¾…å”¤é†’çŠ¶æ€ï¼Œå¦‚æœè¢«å”¤é†’çš„çº¿ç¨‹ç»“æŸæ—¶æ²¡è°ƒç”¨notifyï¼Œå…¶ä»–çº¿ç¨‹å°±æ°¸è¿œæ²¡äººå»å”¤é†’ï¼Œåªèƒ½ç­‰å¾…è¶…æ—¶ï¼Œæˆ–è€…è¢«ä¸­æ–­</li><li>notifyAllï¼šæ‰€æœ‰çº¿ç¨‹é€€å‡ºwaitçš„çŠ¶æ€ï¼Œ<strong>å¼€å§‹ç«äº‰é”</strong>ï¼Œ<strong>ä½†åªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½æŠ¢åˆ°ï¼Œè¿™ä¸ªçº¿ç¨‹æ‰§è¡Œå®Œåï¼Œå…¶ä»–çº¿ç¨‹åˆä¼šæœ‰ä¸€ä¸ªå¹¸è¿å„¿è„±é¢–è€Œå‡ºå¾—åˆ°é”</strong></li></ul><h2 id="14-notify-é€‰æ‹©å“ªä¸ªçº¿ç¨‹"><a href="#14-notify-é€‰æ‹©å“ªä¸ªçº¿ç¨‹" class="headerlink" title="14.notify é€‰æ‹©å“ªä¸ªçº¿ç¨‹?"></a>14.notify é€‰æ‹©å“ªä¸ªçº¿ç¨‹?</h2><p>notifyåœ¨æºç çš„æ³¨é‡Šä¸­è¯´åˆ°notifyé€‰æ‹©å”¤é†’çš„çº¿ç¨‹æ˜¯ä»»æ„çš„ï¼Œä½†æ˜¯ä¾èµ–äºå…·ä½“å®ç°çš„jvmã€‚</p><p><img src="https://cdn.xiaolincoding.com//picgo/image-20240725230457096.png" alt="image-20240725230457096"></p><p>JVMæœ‰å¾ˆå¤šå®ç°ï¼Œæ¯”è¾ƒæµè¡Œçš„å°±æ˜¯<strong>hotspot</strong>ï¼Œhotspotå¯¹notofy()çš„å®ç°å¹¶ä¸æ˜¯æˆ‘ä»¬ä»¥ä¸ºçš„éšæœºå”¤é†’,ï¼Œ<strong>è€Œæ˜¯â€œå…ˆè¿›å…ˆå‡ºâ€çš„é¡ºåºå”¤é†’ã€‚</strong></p><h2 id="15-ä¸åŒçš„çº¿ç¨‹ä¹‹é—´å¦‚ä½•é€šä¿¡ï¼Ÿ"><a href="#15-ä¸åŒçš„çº¿ç¨‹ä¹‹é—´å¦‚ä½•é€šä¿¡ï¼Ÿ" class="headerlink" title="15.ä¸åŒçš„çº¿ç¨‹ä¹‹é—´å¦‚ä½•é€šä¿¡ï¼Ÿ"></a>15.ä¸åŒçš„çº¿ç¨‹ä¹‹é—´å¦‚ä½•é€šä¿¡ï¼Ÿ</h2><p><strong>å…±äº«å˜é‡</strong>æ˜¯æœ€åŸºæœ¬çš„çº¿ç¨‹é—´é€šä¿¡æ–¹å¼ã€‚å¤šä¸ªçº¿ç¨‹å¯ä»¥è®¿é—®å’Œä¿®æ”¹åŒä¸€ä¸ªå…±äº«å˜é‡ï¼Œä»è€Œå®ç°ä¿¡æ¯çš„ä¼ é€’ã€‚ä¸ºäº†ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œé€šå¸¸éœ€è¦ä½¿ç”¨ <code>synchronized</code> å…³é”®å­—æˆ– <code>volatile</code> å…³é”®å­—ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">SharedVariableExample</span> &#123;</span><br><span class="line">    <span class="comment">// ä½¿ç”¨ volatile å…³é”®å­—ä¿è¯å˜é‡çš„å¯è§æ€§</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">volatile</span> <span class="type">boolean</span> <span class="variable">flag</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// ç”Ÿäº§è€…çº¿ç¨‹</span></span><br><span class="line">        <span class="type">Thread</span> <span class="variable">producer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                Thread.sleep(<span class="number">2000</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// ä¿®æ”¹å…±äº«å˜é‡</span></span><br><span class="line">            flag = <span class="literal">true</span>;</span><br><span class="line">            System.out.println(<span class="string">&quot;Producer: Flag is set to true.&quot;</span>);</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ¶ˆè´¹è€…çº¿ç¨‹</span></span><br><span class="line">        <span class="type">Thread</span> <span class="variable">consumer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">while</span> (!flag) &#123;</span><br><span class="line">                <span class="comment">// ç­‰å¾…å…±äº«å˜é‡è¢«ä¿®æ”¹</span></span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(<span class="string">&quot;Consumer: Flag is now true.&quot;</span>);</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        producer.start();</span><br><span class="line">        consumer.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»£ç è§£é‡Š</p><ul><li><code>volatile</code> å…³é”®å­—ç¡®ä¿äº† <code>flag</code> å˜é‡åœ¨å¤šä¸ªçº¿ç¨‹ä¹‹é—´çš„å¯è§æ€§ï¼Œå³ä¸€ä¸ªçº¿ç¨‹ä¿®æ”¹äº† <code>flag</code> çš„å€¼ï¼Œå…¶ä»–çº¿ç¨‹èƒ½ç«‹å³çœ‹åˆ°ã€‚</li><li>ç”Ÿäº§è€…çº¿ç¨‹åœ¨ç¡çœ  2 ç§’åå°† <code>flag</code> è®¾ç½®ä¸º <code>true</code>ï¼Œæ¶ˆè´¹è€…çº¿ç¨‹åœ¨ <code>flag</code> ä¸º <code>false</code> æ—¶ä¸€ç›´ç­‰å¾…ï¼Œç›´åˆ° <code>flag</code> å˜ä¸º <code>true</code> æ‰ç»§ç»­æ‰§è¡Œã€‚</li></ul><p><strong><code>Object</code> ç±»ä¸­çš„ <code>wait()</code>ã€<code>notify()</code> å’Œ <code>notifyAll()</code> æ–¹æ³•å¯ä»¥ç”¨äºçº¿ç¨‹é—´çš„åä½œ</strong>ã€‚<code>wait()</code> æ–¹æ³•ä½¿å½“å‰çº¿ç¨‹è¿›å…¥ç­‰å¾…çŠ¶æ€ï¼Œ<code>notify()</code> æ–¹æ³•å”¤é†’åœ¨æ­¤å¯¹è±¡ç›‘è§†å™¨ä¸Šç­‰å¾…çš„å•ä¸ªçº¿ç¨‹ï¼Œ<code>notifyAll()</code> æ–¹æ³•å”¤é†’åœ¨æ­¤å¯¹è±¡ç›‘è§†å™¨ä¸Šç­‰å¾…çš„æ‰€æœ‰çº¿ç¨‹ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">WaitNotifyExample</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Object</span> <span class="variable">lock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// ç”Ÿäº§è€…çº¿ç¨‹</span></span><br><span class="line">        <span class="type">Thread</span> <span class="variable">producer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (lock) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;Producer: Producing...&quot;</span>);</span><br><span class="line">                    Thread.sleep(<span class="number">2000</span>);</span><br><span class="line">                    System.out.println(<span class="string">&quot;Producer: Production finished. Notifying consumer.&quot;</span>);</span><br><span class="line">                    <span class="comment">// å”¤é†’ç­‰å¾…çš„çº¿ç¨‹</span></span><br><span class="line">                    lock.notify();</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ¶ˆè´¹è€…çº¿ç¨‹</span></span><br><span class="line">        <span class="type">Thread</span> <span class="variable">consumer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (lock) &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;Consumer: Waiting for production to finish.&quot;</span>);</span><br><span class="line">                    <span class="comment">// è¿›å…¥ç­‰å¾…çŠ¶æ€</span></span><br><span class="line">                    lock.wait();</span><br><span class="line">                    System.out.println(<span class="string">&quot;Consumer: Production finished. Consuming...&quot;</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        consumer.start();</span><br><span class="line">        producer.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»£ç è§£é‡Šï¼š</p><ul><li><code>lock</code> æ˜¯ä¸€ä¸ªç”¨äºåŒæ­¥çš„å¯¹è±¡ï¼Œç”Ÿäº§è€…å’Œæ¶ˆè´¹è€…çº¿ç¨‹éƒ½éœ€è¦è·å–è¯¥å¯¹è±¡çš„é”æ‰èƒ½æ‰§è¡Œç›¸åº”çš„æ“ä½œã€‚</li><li>æ¶ˆè´¹è€…çº¿ç¨‹è°ƒç”¨ <code>lock.wait()</code> æ–¹æ³•è¿›å…¥ç­‰å¾…çŠ¶æ€ï¼Œé‡Šæ”¾é”ï¼›ç”Ÿäº§è€…çº¿ç¨‹æ‰§è¡Œå®Œç”Ÿäº§ä»»åŠ¡åè°ƒç”¨ <code>lock.notify()</code> æ–¹æ³•å”¤é†’ç­‰å¾…çš„æ¶ˆè´¹è€…çº¿ç¨‹ã€‚</li></ul><p><strong><code>java.util.concurrent.locks</code> åŒ…ä¸­çš„ <code>Lock</code> å’Œ <code>Condition</code> æ¥å£æä¾›äº†æ¯” <code>synchronized</code> æ›´çµæ´»çš„çº¿ç¨‹é—´é€šä¿¡æ–¹å¼ã€‚</strong><code>Condition</code> æ¥å£çš„ <code>await()</code> æ–¹æ³•ç±»ä¼¼äº <code>wait()</code> æ–¹æ³•ï¼Œ<code>signal()</code> æ–¹æ³•ç±»ä¼¼äº <code>notify()</code> æ–¹æ³•ï¼Œ<code>signalAll()</code> æ–¹æ³•ç±»ä¼¼äº <code>notifyAll()</code> æ–¹æ³•ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.concurrent.locks.Condition;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.locks.Lock;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.locks.ReentrantLock;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">LockConditionExample</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Lock</span> <span class="variable">lock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReentrantLock</span>();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Condition</span> <span class="variable">condition</span> <span class="operator">=</span> lock.newCondition();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// ç”Ÿäº§è€…çº¿ç¨‹</span></span><br><span class="line">        <span class="type">Thread</span> <span class="variable">producer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            lock.lock();</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;Producer: Producing...&quot;</span>);</span><br><span class="line">                Thread.sleep(<span class="number">2000</span>);</span><br><span class="line">                System.out.println(<span class="string">&quot;Producer: Production finished. Notifying consumer.&quot;</span>);</span><br><span class="line">                <span class="comment">// å”¤é†’ç­‰å¾…çš„çº¿ç¨‹</span></span><br><span class="line">                condition.signal();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                lock.unlock();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ¶ˆè´¹è€…çº¿ç¨‹</span></span><br><span class="line">        <span class="type">Thread</span> <span class="variable">consumer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            lock.lock();</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;Consumer: Waiting for production to finish.&quot;</span>);</span><br><span class="line">                <span class="comment">// è¿›å…¥ç­‰å¾…çŠ¶æ€</span></span><br><span class="line">                condition.await();</span><br><span class="line">                System.out.println(<span class="string">&quot;Consumer: Production finished. Consuming...&quot;</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                lock.unlock();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        consumer.start();</span><br><span class="line">        producer.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»£ç è§£é‡Šï¼š</p><ul><li><code>ReentrantLock</code> æ˜¯ <code>Lock</code> æ¥å£çš„ä¸€ä¸ªå®ç°ç±»ï¼Œ<code>condition</code> æ˜¯é€šè¿‡ <code>lock.newCondition()</code> æ–¹æ³•åˆ›å»ºçš„ã€‚</li><li>æ¶ˆè´¹è€…çº¿ç¨‹è°ƒç”¨ <code>condition.await()</code> æ–¹æ³•è¿›å…¥ç­‰å¾…çŠ¶æ€ï¼Œç”Ÿäº§è€…çº¿ç¨‹æ‰§è¡Œå®Œç”Ÿäº§ä»»åŠ¡åè°ƒç”¨ <code>condition.signal()</code> æ–¹æ³•å”¤é†’ç­‰å¾…çš„æ¶ˆè´¹è€…çº¿ç¨‹ã€‚</li></ul><p><strong><code>java.util.concurrent</code> åŒ…ä¸­çš„ <code>BlockingQueue</code> æ¥å£æä¾›äº†çº¿ç¨‹å®‰å…¨çš„é˜Ÿåˆ—æ“ä½œ</strong>ï¼Œå½“é˜Ÿåˆ—æ»¡æ—¶ï¼Œæ’å…¥å…ƒç´ çš„çº¿ç¨‹ä¼šè¢«é˜»å¡ï¼›å½“é˜Ÿåˆ—ä¸ºç©ºæ—¶ï¼Œè·å–å…ƒç´ çš„çº¿ç¨‹ä¼šè¢«é˜»å¡ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.concurrent.BlockingQueue;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.LinkedBlockingQueue;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">BlockingQueueExample</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> BlockingQueue&lt;Integer&gt; queue = <span class="keyword">new</span> <span class="title class_">LinkedBlockingQueue</span>&lt;&gt;(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// ç”Ÿäº§è€…çº¿ç¨‹</span></span><br><span class="line">        <span class="type">Thread</span> <span class="variable">producer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;Producer: Producing...&quot;</span>);</span><br><span class="line">                queue.put(<span class="number">1</span>);</span><br><span class="line">                System.out.println(<span class="string">&quot;Producer: Production finished.&quot;</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æ¶ˆè´¹è€…çº¿ç¨‹</span></span><br><span class="line">        <span class="type">Thread</span> <span class="variable">consumer</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;Consumer: Waiting for production to finish.&quot;</span>);</span><br><span class="line">                <span class="type">int</span> <span class="variable">item</span> <span class="operator">=</span> queue.take();</span><br><span class="line">                System.out.println(<span class="string">&quot;Consumer: Consumed item: &quot;</span> + item);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        consumer.start();</span><br><span class="line">        producer.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»£ç è§£é‡Šï¼š</p><ul><li><code>LinkedBlockingQueue</code> æ˜¯ <code>BlockingQueue</code> æ¥å£çš„ä¸€ä¸ªå®ç°ç±»ï¼Œå®¹é‡ä¸º 1ã€‚</li><li>ç”Ÿäº§è€…çº¿ç¨‹è°ƒç”¨ <code>queue.put(1)</code> æ–¹æ³•å°†å…ƒç´ æ’å…¥é˜Ÿåˆ—ï¼Œå¦‚æœé˜Ÿåˆ—å·²æ»¡ï¼Œçº¿ç¨‹ä¼šè¢«é˜»å¡ï¼›æ¶ˆè´¹è€…çº¿ç¨‹è°ƒç”¨ <code>queue.take()</code> æ–¹æ³•ä»é˜Ÿåˆ—ä¸­å–å‡ºå…ƒç´ ï¼Œå¦‚æœé˜Ÿåˆ—ä¸ºç©ºï¼Œçº¿ç¨‹ä¼šè¢«é˜»å¡ã€‚</li></ul><h2 id="16-çº¿ç¨‹é—´é€šä¿¡æ–¹å¼æœ‰å“ªäº›ï¼Ÿ"><a href="#16-çº¿ç¨‹é—´é€šä¿¡æ–¹å¼æœ‰å“ªäº›ï¼Ÿ" class="headerlink" title="16.çº¿ç¨‹é—´é€šä¿¡æ–¹å¼æœ‰å“ªäº›ï¼Ÿ"></a>16.çº¿ç¨‹é—´é€šä¿¡æ–¹å¼æœ‰å“ªäº›ï¼Ÿ</h2><p><strong>Object ç±»çš„ wait()ã€notify() å’Œ notifyAll() æ–¹æ³•ã€‚</strong>è¿™æ˜¯ Java ä¸­æœ€åŸºç¡€çš„çº¿ç¨‹é—´é€šä¿¡æ–¹å¼ï¼ŒåŸºäºå¯¹è±¡çš„ç›‘è§†å™¨ï¼ˆé”ï¼‰æœºåˆ¶ã€‚</p><ul><li><code>wait()</code>ï¼šä½¿å½“å‰çº¿ç¨‹è¿›å…¥ç­‰å¾…çŠ¶æ€ï¼Œç›´åˆ°å…¶ä»–çº¿ç¨‹è°ƒç”¨è¯¥å¯¹è±¡çš„ <code>notify()</code> æˆ– <code>notifyAll()</code> æ–¹æ³•ã€‚</li><li><code>notify()</code>ï¼šå”¤é†’åœ¨æ­¤å¯¹è±¡ç›‘è§†å™¨ä¸Šç­‰å¾…çš„å•ä¸ªçº¿ç¨‹ã€‚</li><li><code>notifyAll()</code>ï¼šå”¤é†’åœ¨æ­¤å¯¹è±¡ç›‘è§†å™¨ä¸Šç­‰å¾…çš„æ‰€æœ‰çº¿ç¨‹ã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">SharedObject</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">consumerMethod</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="comment">/* æ¡ä»¶ä¸æ»¡è¶³ */</span>) &#123;</span><br><span class="line">            wait();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// æ‰§è¡Œç›¸åº”æ“ä½œ</span></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">producerMethod</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="comment">// æ‰§è¡Œç›¸åº”æ“ä½œ</span></span><br><span class="line">        notify(); <span class="comment">// æˆ–è€… notifyAll()</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>2ã€<strong><code>Lock</code> å’Œ <code>Condition</code> æ¥å£ã€‚<code>Lock</code> æ¥å£æä¾›äº†æ¯” <code>synchronized</code> æ›´çµæ´»çš„é”æœºåˆ¶ï¼Œ<code>Condition</code> æ¥å£åˆ™é…åˆ <code>Lock</code> å®ç°çº¿ç¨‹é—´çš„ç­‰å¾… / é€šçŸ¥æœºåˆ¶ã€‚</strong></p><ul><li><code>await()</code>ï¼šä½¿å½“å‰çº¿ç¨‹è¿›å…¥ç­‰å¾…çŠ¶æ€ï¼Œç›´åˆ°è¢«å…¶ä»–çº¿ç¨‹å”¤é†’ã€‚</li><li><code>signal()</code>ï¼šå”¤é†’ä¸€ä¸ªç­‰å¾…åœ¨è¯¥ <code>Condition</code> ä¸Šçš„çº¿ç¨‹ã€‚</li><li><code>signalAll()</code>ï¼šå”¤é†’æ‰€æœ‰ç­‰å¾…åœ¨è¯¥ <code>Condition</code> ä¸Šçš„çº¿ç¨‹ã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.concurrent.locks.Condition;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.locks.Lock;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.locks.ReentrantLock;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">SharedResource</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">Lock</span> <span class="variable">lock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReentrantLock</span>();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">Condition</span> <span class="variable">condition</span> <span class="operator">=</span> lock.newCondition();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">consumer</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        lock.lock();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">while</span> (<span class="comment">/* æ¡ä»¶ä¸æ»¡è¶³ */</span>) &#123;</span><br><span class="line">                condition.await();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// æ‰§è¡Œç›¸åº”æ“ä½œ</span></span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">producer</span><span class="params">()</span> &#123;</span><br><span class="line">        lock.lock();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// æ‰§è¡Œç›¸åº”æ“ä½œ</span></span><br><span class="line">            condition.signal(); <span class="comment">// æˆ–è€… signalAll()</span></span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>3ã€<code>volatile</code> å…³é”®å­—ã€‚<code>volatile</code> <strong>å…³é”®å­—ç”¨äºä¿è¯å˜é‡çš„å¯è§æ€§ï¼Œå³å½“ä¸€ä¸ªå˜é‡è¢«å£°æ˜ä¸º <code>volatile</code> æ—¶ï¼Œå®ƒä¼šä¿è¯å¯¹è¯¥å˜é‡çš„å†™æ“ä½œä¼šç«‹å³åˆ·æ–°åˆ°ä¸»å†…å­˜ä¸­ï¼Œè€Œè¯»æ“ä½œä¼šä»ä¸»å†…å­˜ä¸­è¯»å–æœ€æ–°çš„å€¼ã€‚</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">VolatileExample</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span> <span class="type">boolean</span> <span class="variable">flag</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">writer</span><span class="params">()</span> &#123;</span><br><span class="line">        flag = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">reader</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">while</span> (!flag) &#123;</span><br><span class="line">            <span class="comment">// ç­‰å¾…</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// æ‰§è¡Œç›¸åº”æ“ä½œ</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>4ã€<strong>CountDownLatchã€‚<code>CountDownLatch</code> æ˜¯ä¸€ä¸ªåŒæ­¥è¾…åŠ©ç±»ï¼Œå®ƒå…è®¸ä¸€ä¸ªæˆ–å¤šä¸ªçº¿ç¨‹ç­‰å¾…å…¶ä»–çº¿ç¨‹å®Œæˆæ“ä½œã€‚</strong></p><ul><li><code>CountDownLatch(int count)</code>ï¼šæ„é€ å‡½æ•°ï¼ŒæŒ‡å®šéœ€è¦ç­‰å¾…çš„çº¿ç¨‹æ•°é‡ã€‚</li><li><code>countDown()</code>ï¼šå‡å°‘è®¡æ•°å™¨çš„å€¼ã€‚</li><li><code>await()</code>ï¼šä½¿å½“å‰çº¿ç¨‹ç­‰å¾…ï¼Œç›´åˆ°è®¡æ•°å™¨çš„å€¼ä¸º 0ã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.concurrent.CountDownLatch;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CountDownLatchExample</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">threadCount</span> <span class="operator">=</span> <span class="number">3</span>;</span><br><span class="line">        <span class="type">CountDownLatch</span> <span class="variable">latch</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CountDownLatch</span>(threadCount);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; threadCount; i++) &#123;</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="comment">// æ‰§è¡Œä»»åŠ¡</span></span><br><span class="line">                    System.out.println(Thread.currentThread().getName() + <span class="string">&quot; å®Œæˆä»»åŠ¡&quot;</span>);</span><br><span class="line">                &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                    latch.countDown();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;).start();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        latch.await();</span><br><span class="line">        System.out.println(<span class="string">&quot;æ‰€æœ‰çº¿ç¨‹ä»»åŠ¡å®Œæˆ&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>5ã€<strong>CyclicBarrierã€‚<code>CyclicBarrier</code> æ˜¯ä¸€ä¸ªåŒæ­¥è¾…åŠ©ç±»ï¼Œå®ƒå…è®¸ä¸€ç»„çº¿ç¨‹ç›¸äº’ç­‰å¾…ï¼Œç›´åˆ°æ‰€æœ‰çº¿ç¨‹éƒ½åˆ°è¾¾æŸä¸ªå…¬å…±å±éšœç‚¹ã€‚</strong></p><ul><li><code>CyclicBarrier(int parties, Runnable barrierAction)</code>ï¼šæ„é€ å‡½æ•°ï¼ŒæŒ‡å®šå‚ä¸çš„çº¿ç¨‹æ•°é‡å’Œæ‰€æœ‰çº¿ç¨‹åˆ°è¾¾å±éšœç‚¹åè¦æ‰§è¡Œçš„æ“ä½œã€‚</li><li><code>await()</code>ï¼šä½¿å½“å‰çº¿ç¨‹ç­‰å¾…ï¼Œç›´åˆ°æ‰€æœ‰çº¿ç¨‹éƒ½åˆ°è¾¾å±éšœç‚¹ã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.concurrent.CyclicBarrier;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CyclicBarrierExample</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">threadCount</span> <span class="operator">=</span> <span class="number">3</span>;</span><br><span class="line">        <span class="type">CyclicBarrier</span> <span class="variable">barrier</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CyclicBarrier</span>(threadCount, () -&gt; &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;æ‰€æœ‰çº¿ç¨‹éƒ½åˆ°è¾¾å±éšœç‚¹&quot;</span>);</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; threadCount; i++) &#123;</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    <span class="comment">// æ‰§è¡Œä»»åŠ¡</span></span><br><span class="line">                    System.out.println(Thread.currentThread().getName() + <span class="string">&quot; åˆ°è¾¾å±éšœç‚¹&quot;</span>);</span><br><span class="line">                    barrier.await();</span><br><span class="line">                    <span class="comment">// ç»§ç»­æ‰§è¡Œåç»­ä»»åŠ¡</span></span><br><span class="line">                &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;).start();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>6ã€<strong>Semaphoreã€‚<code>Semaphore</code> æ˜¯ä¸€ä¸ªè®¡æ•°ä¿¡å·é‡ï¼Œå®ƒå¯ä»¥æ§åˆ¶åŒæ—¶è®¿é—®ç‰¹å®šèµ„æºçš„çº¿ç¨‹æ•°é‡ã€‚</strong></p><ul><li><code>Semaphore(int permits)</code>ï¼šæ„é€ å‡½æ•°ï¼ŒæŒ‡å®šä¿¡å·é‡çš„åˆå§‹è®¸å¯æ•°é‡ã€‚</li><li><code>acquire()</code>ï¼šè·å–ä¸€ä¸ªè®¸å¯ï¼Œå¦‚æœæ²¡æœ‰å¯ç”¨è®¸å¯åˆ™é˜»å¡ã€‚</li><li><code>release()</code>ï¼šé‡Šæ”¾ä¸€ä¸ªè®¸å¯ã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.concurrent.Semaphore;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SemaphoreExample</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">permitCount</span> <span class="operator">=</span> <span class="number">2</span>;</span><br><span class="line">        <span class="type">Semaphore</span> <span class="variable">semaphore</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Semaphore</span>(permitCount);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    semaphore.acquire();</span><br><span class="line">                    System.out.println(Thread.currentThread().getName() + <span class="string">&quot; è·å¾—è®¸å¯&quot;</span>);</span><br><span class="line">                    <span class="comment">// æ‰§è¡Œä»»åŠ¡</span></span><br><span class="line">                    Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                    semaphore.release();</span><br><span class="line">                    System.out.println(Thread.currentThread().getName() + <span class="string">&quot; é‡Šæ”¾è®¸å¯&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;).start();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="17-å¦‚ä½•åœæ­¢ä¸€ä¸ªçº¿ç¨‹ï¼Ÿ"><a href="#17-å¦‚ä½•åœæ­¢ä¸€ä¸ªçº¿ç¨‹ï¼Ÿ" class="headerlink" title="17.å¦‚ä½•åœæ­¢ä¸€ä¸ªçº¿ç¨‹ï¼Ÿ"></a>17.å¦‚ä½•åœæ­¢ä¸€ä¸ªçº¿ç¨‹ï¼Ÿ</h2><p>åœ¨ Java ä¸­ï¼Œåœæ­¢çº¿ç¨‹çš„æ­£ç¡®æ–¹å¼æ˜¯ <strong>é€šè¿‡åä½œå¼çš„é€»è¾‘æ§åˆ¶çº¿ç¨‹ç»ˆæ­¢</strong>ï¼Œè€Œéå¼ºåˆ¶æš´åŠ›ç»ˆæ­¢ï¼ˆå¦‚å·²åºŸå¼ƒçš„ <code>Thread.stop()</code>ï¼‰ã€‚ä»¥ä¸‹æ˜¯å®ç°å®‰å…¨åœæ­¢çº¿ç¨‹çš„å¤šç§æ–¹æ³•ï¼š</p><p><strong>ç¬¬ä¸€ç§æ–¹å¼ï¼šé€šè¿‡å…±äº«æ ‡å¿—ä½ä¸»åŠ¨ç»ˆæ­¢</strong>ã€‚<strong>å®šä¹‰ä¸€ä¸ª å¯è§çš„ çŠ¶æ€å˜é‡ï¼Œç”±ä¸»çº¿ç¨‹æ§åˆ¶å…¶å€¼ï¼Œå·¥ä½œçº¿ç¨‹å¾ªç¯æ£€æµ‹è¯¥å˜é‡ä»¥å†³å®šæ˜¯å¦é€€å‡ºã€‚</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SafeStopWithFlag</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span> &#123;</span><br><span class="line">    <span class="comment">// ä½¿ç”¨ volatile ä¿è¯å¯è§æ€§</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span> <span class="type">boolean</span> <span class="variable">running</span> <span class="operator">=</span> <span class="literal">true</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">while</span> (running) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="comment">// å¤„ç†ä»»åŠ¡é€»è¾‘</span></span><br><span class="line">                System.out.println(<span class="string">&quot;Thread is running...&quot;</span>);</span><br><span class="line">                Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                <span class="comment">// æ•è·ä¸­æ–­å¼‚å¸¸åè®¾ç½® running=false</span></span><br><span class="line">                running = <span class="literal">false</span>;</span><br><span class="line">                Thread.currentThread().interrupt(); <span class="comment">// é‡æ–°è®¾ç½®ä¸­æ–­æ ‡å¿—</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;Thread terminated safely.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åœæ­¢çº¿ç¨‹çš„æ–¹æ³•ï¼ˆç”±å¤–éƒ¨è°ƒç”¨ï¼‰</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">stop</span><span class="params">()</span> &#123;</span><br><span class="line">        running = <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è°ƒç”¨æ–¹å¼ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">SafeStopWithFlag</span> <span class="variable">task</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">SafeStopWithFlag</span>();</span><br><span class="line"><span class="type">Thread</span> <span class="variable">thread</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(task);</span><br><span class="line">thread.start();</span><br><span class="line"><span class="comment">// æŸä¸ªæ—¶åˆ»è°ƒç”¨åœæ­¢</span></span><br><span class="line">Thread.sleep(<span class="number">3000</span>);</span><br><span class="line">task.stop();</span><br></pre></td></tr></table></figure><p><strong>ç¬¬äºŒç§æ–¹å¼ä½¿ç”¨çº¿ç¨‹ä¸­æ–­æœºåˆ¶</strong>ã€‚é€šè¿‡ <code>Thread.interrupt()</code> è§¦å‘çº¿ç¨‹ä¸­æ–­çŠ¶æ€ï¼Œç»“åˆä¸­æ–­æ£€æµ‹é€»è¾‘å®ç°å®‰å…¨åœæ­¢ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">InterruptExample</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span> &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">while</span> (!Thread.currentThread().isInterrupted()) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;Working...&quot;</span>);</span><br><span class="line">                Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                <span class="comment">// å½“é˜»å¡æ—¶è¢«ä¸­æ–­ï¼ŒæŠ›å‡ºå¼‚å¸¸å¹¶æ¸…é™¤ä¸­æ–­çŠ¶æ€</span></span><br><span class="line">                System.out.println(<span class="string">&quot;Interrupted during sleep!&quot;</span>);</span><br><span class="line">                Thread.currentThread().interrupt(); <span class="comment">// é‡æ–°è®¾ç½®ä¸­æ–­æ ‡å¿—</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;Thread terminated by interrupt.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è°ƒç”¨æ–¹å¼ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Thread thread = new Thread(new InterruptExample());</span><br><span class="line">thread.start();</span><br><span class="line">// ä¸­æ–­çº¿ç¨‹</span><br><span class="line">Thread.sleep(3000);</span><br><span class="line">thread.interrupt();</span><br></pre></td></tr></table></figure><ul><li><code>interrupt()</code> <strong>ä¸ä¼šç«‹åˆ»ç»ˆæ­¢çº¿ç¨‹ï¼Œåªæ˜¯è®¾ç½®ä¸­æ–­æ ‡å¿—ä½ã€‚</strong></li><li>çº¿ç¨‹éœ€æ‰‹åŠ¨æ£€æŸ¥ä¸­æ–­çŠ¶æ€ï¼ˆ<code>isInterrupted()</code>ï¼‰æˆ–è§¦å‘å¯ä¸­æ–­æ“ä½œï¼ˆå¦‚<code>sleep()</code>ï¼Œ<code>wait()</code>ï¼Œ<code>join()</code>)å“åº”ä¸­æ–­ã€‚</li><li>é˜»å¡æ“ä½œä¸­æ”¶åˆ°ä¸­æ–­è¯·æ±‚æ—¶ï¼Œä¼šæŠ›å‡º <code>InterruptedException</code> å¹¶æ¸…é™¤ä¸­æ–­çŠ¶æ€ã€‚</li></ul><p><strong>ç¬¬ä¸‰ç§æ–¹å¼é€šè¿‡ <code>Future</code> å–æ¶ˆä»»åŠ¡</strong>ã€‚ä½¿ç”¨çº¿ç¨‹æ± æäº¤ä»»åŠ¡ï¼Œå¹¶é€šè¿‡ <code>Future.cancel()</code> åœæ­¢çº¿ç¨‹ï¼Œä¾èµ–ä¸­æ–­æœºåˆ¶ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FutureCancelDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">ExecutorService</span> <span class="variable">executor</span> <span class="operator">=</span> Executors.newSingleThreadExecutor();</span><br><span class="line">        Future&lt;?&gt; future = executor.submit(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">while</span> (!Thread.currentThread().isInterrupted()) &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;Task running...&quot;</span>);</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;Task interrupted.&quot;</span>);</span><br><span class="line">                    Thread.currentThread().interrupt();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep(<span class="number">3000</span>);</span><br><span class="line">            future.cancel(<span class="literal">true</span>); <span class="comment">// trueè¡¨ç¤ºå°è¯•ä¸­æ–­ä»»åŠ¡çº¿ç¨‹</span></span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            Thread.currentThread().interrupt();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            executor.shutdown();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>ç¬¬å››ç§æ–¹å¼**</strong>å¤„ç†ä¸å¯ä¸­æ–­çš„é˜»å¡æ“ä½œã€‚**æŸäº› I/O æˆ–åŒæ­¥æ“ä½œï¼ˆå¦‚ <code>Socket.accept()</code>ã€<code>Lock.lock()</code>ï¼‰æ— æ³•é€šè¿‡ä¸­æ–­ç›´æ¥å“åº”ã€‚æ­¤æ—¶éœ€ç»“åˆèµ„æºå…³é—­æ“ä½œã€‚æ¯”å¦‚ï¼Œå…³é—­ Socket é‡Šæ”¾é˜»å¡ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SocketHandler</span> <span class="keyword">implements</span> <span class="title class_">Runnable</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> ServerSocket serverSocket;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">SocketHandler</span><span class="params">(ServerSocket serverSocket)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.serverSocket = serverSocket;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">run</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// serverSocket.accept()é˜»å¡æ—¶æ— æ³•å“åº”ä¸­æ–­</span></span><br><span class="line">            <span class="keyword">while</span> (!Thread.currentThread().isInterrupted()) &#123;</span><br><span class="line">                <span class="type">Socket</span> <span class="variable">socket</span> <span class="operator">=</span> serverSocket.accept();</span><br><span class="line">                <span class="comment">// å¤„ç†è¿æ¥...</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            <span class="keyword">if</span> (Thread.currentThread().isInterrupted()) &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;Thread stopped by interrupt.&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç‰¹æ®Šå…³é—­æ–¹æ³•ï¼ˆé”€æ¯èµ„æºï¼‰</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">stop</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            serverSocket.close(); <span class="comment">// å…³é—­èµ„æºä½¿accept()æŠ›å‡ºå¼‚å¸¸</span></span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;Error closing socket: &quot;</span> + e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è°ƒç”¨æ–¹å¼ï¼šè°ƒç”¨ <code>stop()</code> æ–¹æ³•å…³é—­èµ„æºä»¥è§£é™¤é˜»å¡ã€‚</p><p>çº¿ç¨‹åœæ­¢çš„æ­£ç¡®å®è·µï¼Œå¦‚ä¸‹è¡¨æ ¼ï¼š</p><div class="table-container"><table><thead><tr><th><strong>æ–¹æ³•</strong></th><th><strong>é€‚ç”¨åœºæ™¯</strong></th><th><strong>æ³¨æ„äº‹é¡¹</strong></th></tr></thead><tbody><tr><td><strong>å¾ªç¯æ£€æµ‹æ ‡å¿—ä½</strong></td><td>ç®€å•æ— é˜»å¡çš„é€»è¾‘</td><td>ç¡®ä¿æ ‡å¿—ä½ä½¿ç”¨ <code>volatile</code> æˆ–é€šè¿‡é”ä¿è¯å¯è§æ€§</td></tr><tr><td><strong>ä¸­æ–­æœºåˆ¶</strong></td><td>å¯ä¸­æ–­çš„é˜»å¡æ“ä½œ</td><td>æ­£ç¡®å¤„ç† <code>InterruptedException</code> å¹¶æ¢å¤ä¸­æ–­æ ‡å¿—</td></tr><tr><td><strong>Future.cancel()</strong></td><td>çº¿ç¨‹æ± ç®¡ç†ä»»åŠ¡</td><td>éœ€è¦çº¿ç¨‹æ± ä»»åŠ¡æ”¯æŒä¸­æ–­å¤„ç†æœºåˆ¶</td></tr><tr><td><strong>èµ„æºå…³é—­</strong></td><td>ä¸å¯ä¸­æ–­çš„é˜»å¡æ“ä½œï¼ˆå¦‚Socketsï¼‰</td><td>æ˜¾å¼å…³é—­èµ„æºè§¦å‘å¼‚å¸¸ï¼Œç»“åˆä¸­æ–­çŠ¶æ€åˆ¤æ–­å›æ»š</td></tr></tbody></table></div><p>é¿å…ä½¿ç”¨ä»¥ä¸‹å·²åºŸå¼ƒæ–¹æ³•ï¼š</p><ul><li><code>Thread.stop()</code>ï¼šæš´åŠ›ç»ˆæ­¢ï¼Œå¯èƒ½å¯¼è‡´çŠ¶æ€ä¸ä¸€è‡´ã€‚</li><li><code>Thread.suspend()</code>/<code>resume()</code>ï¼šæ˜“å¯¼è‡´æ­»é”ã€‚</li></ul><h1 id="å¹¶å‘"><a href="#å¹¶å‘" class="headerlink" title="å¹¶å‘"></a>å¹¶å‘</h1><h2 id="1-jucåŒ…ä¸‹ä½ å¸¸ç”¨çš„ç±»ï¼Ÿ"><a href="#1-jucåŒ…ä¸‹ä½ å¸¸ç”¨çš„ç±»ï¼Ÿ" class="headerlink" title="1.jucåŒ…ä¸‹ä½ å¸¸ç”¨çš„ç±»ï¼Ÿ"></a>1.jucåŒ…ä¸‹ä½ å¸¸ç”¨çš„ç±»ï¼Ÿ</h2><p><strong>çº¿ç¨‹æ± ç›¸å…³ï¼š</strong></p><ul><li><code>ThreadPoolExecutor</code>ï¼šæœ€æ ¸å¿ƒçš„çº¿ç¨‹æ± ç±»ï¼Œç”¨äºåˆ›å»ºå’Œç®¡ç†çº¿ç¨‹æ± ã€‚é€šè¿‡å®ƒå¯ä»¥çµæ´»åœ°é…ç½®çº¿ç¨‹æ± çš„å‚æ•°ï¼Œå¦‚æ ¸å¿ƒçº¿ç¨‹æ•°ã€æœ€å¤§çº¿ç¨‹æ•°ã€ä»»åŠ¡é˜Ÿåˆ—ç­‰ï¼Œä»¥æ»¡è¶³ä¸åŒçš„å¹¶å‘å¤„ç†éœ€æ±‚ã€‚</li><li><code>Executors</code>ï¼šçº¿ç¨‹æ± å·¥å‚ç±»ï¼Œæä¾›äº†ä¸€ç³»åˆ—é™æ€æ–¹æ³•æ¥åˆ›å»ºä¸åŒç±»å‹çš„çº¿ç¨‹æ± ï¼Œå¦‚<code>newFixedThreadPool</code>ï¼ˆåˆ›å»ºå›ºå®šçº¿ç¨‹æ•°çš„çº¿ç¨‹æ± ï¼‰ã€<code>newCachedThreadPool</code>ï¼ˆåˆ›å»ºå¯ç¼“å­˜çº¿ç¨‹æ± ï¼‰ã€<code>newSingleThreadExecutor</code>ï¼ˆåˆ›å»ºå•çº¿ç¨‹çº¿ç¨‹æ± ï¼‰ç­‰ï¼Œæ–¹ä¾¿å¼€å‘è€…å¿«é€Ÿåˆ›å»ºçº¿ç¨‹æ± ã€‚</li></ul><p><strong>å¹¶å‘é›†åˆç±»ï¼š</strong></p><ul><li><code>ConcurrentHashMap</code>ï¼šçº¿ç¨‹å®‰å…¨çš„å“ˆå¸Œæ˜ å°„è¡¨ï¼Œç”¨äºåœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹é«˜æ•ˆåœ°å­˜å‚¨å’Œè®¿é—®é”®å€¼å¯¹ã€‚å®ƒé‡‡ç”¨äº†<strong>åˆ†æ®µé”</strong>ç­‰æŠ€æœ¯ï¼Œå…è®¸å¤šä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®ä¸åŒçš„æ®µï¼Œæé«˜äº†å¹¶å‘æ€§èƒ½ï¼Œåœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹æ¯”ä¼ ç»Ÿçš„<code>Hashtable</code>æ€§èƒ½æ›´å¥½ã€‚</li><li><code>CopyOnWriteArrayList</code>ï¼šçº¿ç¨‹å®‰å…¨çš„åˆ—è¡¨ï¼Œåœ¨å¯¹åˆ—è¡¨è¿›è¡Œä¿®æ”¹æ“ä½œæ—¶ï¼Œä¼š<strong>åˆ›å»ºä¸€ä¸ªæ–°çš„åº•å±‚æ•°ç»„ï¼Œå°†ä¿®æ”¹æ“ä½œåº”ç”¨åˆ°æ–°æ•°ç»„ä¸Šï¼Œè€Œè¯»æ“ä½œä»ç„¶å¯ä»¥åœ¨æ—§æ•°ç»„ä¸Šè¿›è¡Œï¼Œä»è€Œå®ç°äº†è¯»å†™åˆ†ç¦»ï¼Œæé«˜äº†å¹¶å‘è¯»çš„æ€§èƒ½ï¼Œé€‚ç”¨äºè¯»å¤šå†™å°‘çš„åœºæ™¯ã€‚</strong></li></ul><p><strong>åŒæ­¥å·¥å…·ç±»ï¼š</strong></p><ul><li><code>CountDownLatch</code>ï¼šå…è®¸ä¸€ä¸ªæˆ–å¤šä¸ªçº¿ç¨‹ç­‰å¾…å…¶ä»–ä¸€ç»„çº¿ç¨‹å®Œæˆæ“ä½œåå†ç»§ç»­æ‰§è¡Œã€‚å®ƒé€šè¿‡ä¸€ä¸ªè®¡æ•°å™¨æ¥å®ç°ï¼Œè®¡æ•°å™¨åˆå§‹åŒ–ä¸ºçº¿ç¨‹çš„æ•°é‡ï¼Œæ¯ä¸ªçº¿ç¨‹å®Œæˆä»»åŠ¡åè°ƒç”¨<code>countDown</code>æ–¹æ³•å°†è®¡æ•°å™¨å‡ä¸€ï¼Œå½“è®¡æ•°å™¨ä¸ºé›¶æ—¶ï¼Œç­‰å¾…çš„çº¿ç¨‹å¯ä»¥ç»§ç»­æ‰§è¡Œã€‚<strong>å¸¸ç”¨äºå¤šä¸ªçº¿ç¨‹å®Œæˆå„è‡ªä»»åŠ¡åï¼Œå†è¿›è¡Œæ±‡æ€»æˆ–ä¸‹ä¸€æ­¥æ“ä½œçš„åœºæ™¯ã€‚</strong></li><li><code>CyclicBarrier</code>ï¼šè®©ä¸€ç»„çº¿ç¨‹äº’ç›¸ç­‰å¾…ï¼Œç›´åˆ°æ‰€æœ‰çº¿ç¨‹éƒ½åˆ°è¾¾æŸä¸ªå±éšœç‚¹åï¼Œå†ä¸€èµ·ç»§ç»­æ‰§è¡Œã€‚ä¸<code>CountDownLatch</code>ä¸åŒçš„æ˜¯ï¼Œ<code>CyclicBarrier</code>å¯ä»¥é‡å¤ä½¿ç”¨ï¼Œå½“æ‰€æœ‰çº¿ç¨‹éƒ½é€šè¿‡å±éšœåï¼Œè®¡æ•°å™¨ä¼šé‡ç½®ï¼Œå¯ä»¥å†æ¬¡ç”¨äºä¸‹ä¸€è½®çš„ç­‰å¾…ã€‚<strong>é€‚ç”¨äºå¤šä¸ªçº¿ç¨‹éœ€è¦ååŒå·¥ä½œï¼Œåœ¨æŸä¸ªé˜¶æ®µå®Œæˆåå†ä¸€èµ·è¿›å…¥ä¸‹ä¸€ä¸ªé˜¶æ®µçš„åœºæ™¯ã€‚</strong></li><li><code>Semaphore</code>ï¼šä¿¡å·é‡ï¼Œ<strong>ç”¨äºæ§åˆ¶åŒæ—¶è®¿é—®æŸä¸ªèµ„æºçš„çº¿ç¨‹æ•°é‡ã€‚</strong>å®ƒç»´æŠ¤äº†ä¸€ä¸ªè®¸å¯è®¡æ•°å™¨ï¼Œçº¿ç¨‹åœ¨è®¿é—®èµ„æºå‰éœ€è¦è·å–è®¸å¯ï¼Œå¦‚æœæœ‰å¯ç”¨è®¸å¯ï¼Œåˆ™è·å–æˆåŠŸå¹¶å°†è®¸å¯è®¡æ•°å™¨å‡ä¸€ï¼Œå¦åˆ™çº¿ç¨‹éœ€è¦ç­‰å¾…ï¼Œç›´åˆ°æœ‰å…¶ä»–çº¿ç¨‹é‡Šæ”¾è®¸å¯ã€‚å¸¸ç”¨äºæ§åˆ¶å¯¹æœ‰é™èµ„æºçš„è®¿é—®ï¼Œå¦‚æ•°æ®åº“è¿æ¥æ± ã€çº¿ç¨‹æ± ä¸­çš„çº¿ç¨‹æ•°é‡ç­‰ã€‚</li></ul><p><strong>åŸå­ç±»ï¼š</strong></p><ul><li><code>AtomicInteger</code>ï¼šåŸå­æ•´æ•°ç±»ï¼Œæä¾›äº†<strong>å¯¹æ•´æ•°ç±»å‹çš„åŸå­æ“ä½œ</strong>ï¼Œå¦‚è‡ªå¢ã€è‡ªå‡ã€æ¯”è¾ƒå¹¶äº¤æ¢ç­‰ã€‚é€šè¿‡ç¡¬ä»¶çº§åˆ«çš„åŸå­æŒ‡ä»¤æ¥ä¿è¯æ“ä½œçš„åŸå­æ€§å’Œçº¿ç¨‹å®‰å…¨æ€§ï¼Œé¿å…äº†ä½¿ç”¨é”å¸¦æ¥çš„æ€§èƒ½å¼€é”€ï¼Œåœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹å¯¹æ•´æ•°è¿›è¡Œè®¡æ•°ã€çŠ¶æ€æ ‡è®°ç­‰æ“ä½œéå¸¸æ–¹ä¾¿ã€‚</li><li><code>AtomicReference</code>ï¼šåŸå­å¼•ç”¨ç±»ï¼Œç”¨äºå¯¹å¯¹è±¡å¼•ç”¨è¿›è¡ŒåŸå­æ“ä½œã€‚å¯ä»¥ä¿è¯åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œå¯¹å¯¹è±¡çš„æ›´æ–°æ“ä½œæ˜¯åŸå­æ€§çš„ï¼Œå³è¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥ï¼Œä¸ä¼šå‡ºç°æ•°æ®ä¸ä¸€è‡´çš„æƒ…å†µã€‚å¸¸ç”¨äºå®ç°æ— é”æ•°æ®ç»“æ„æˆ–éœ€è¦å¯¹å¯¹è±¡è¿›è¡ŒåŸå­æ›´æ–°çš„åœºæ™¯ã€‚</li></ul><h2 id="2-æ€ä¹ˆä¿è¯å¤šçº¿ç¨‹å®‰å…¨ï¼Ÿ"><a href="#2-æ€ä¹ˆä¿è¯å¤šçº¿ç¨‹å®‰å…¨ï¼Ÿ" class="headerlink" title="2.æ€ä¹ˆä¿è¯å¤šçº¿ç¨‹å®‰å…¨ï¼Ÿ"></a>2.æ€ä¹ˆä¿è¯å¤šçº¿ç¨‹å®‰å…¨ï¼Ÿ</h2><ul><li><strong>synchronizedå…³é”®å­—</strong>:å¯ä»¥ä½¿ç”¨<code>synchronized</code>å…³é”®å­—æ¥åŒæ­¥ä»£ç å—æˆ–æ–¹æ³•ï¼Œ<strong>ç¡®ä¿åŒä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥è®¿é—®è¿™äº›ä»£ç </strong>ã€‚å¯¹è±¡é”æ˜¯é€šè¿‡<code>synchronized</code>å…³é”®å­—é”å®šå¯¹è±¡çš„ç›‘è§†å™¨ï¼ˆmonitorï¼‰æ¥å®ç°çš„ã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">someMethod</span><span class="params">()</span> &#123; <span class="comment">/* ... */</span> &#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">anotherMethod</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">synchronized</span> (someObject) &#123;</span><br><span class="line">        <span class="comment">/* ... */</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><strong>volatileå…³é”®å­—</strong>:<code>volatile</code>å…³é”®å­—ç”¨äºå˜é‡ï¼Œç¡®ä¿æ‰€æœ‰çº¿ç¨‹çœ‹åˆ°çš„æ˜¯è¯¥å˜é‡çš„æœ€æ–°å€¼ï¼Œè€Œä¸æ˜¯å¯èƒ½å­˜å‚¨åœ¨æœ¬åœ°å¯„å­˜å™¨ä¸­çš„å‰¯æœ¬ã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">volatile</span> <span class="type">int</span> sharedVariable;</span><br></pre></td></tr></table></figure><ul><li><strong>Lockæ¥å£å’ŒReentrantLockç±»</strong>:<code>java.util.concurrent.locks.Lock</code>æ¥å£æä¾›äº†æ¯”<code>synchronized</code>æ›´å¼ºå¤§çš„é”å®šæœºåˆ¶ï¼Œ<code>ReentrantLock</code>æ˜¯ä¸€ä¸ªå®ç°è¯¥æ¥å£çš„ä¾‹å­ï¼Œæä¾›äº†æ›´çµæ´»çš„é”ç®¡ç†å’Œæ›´é«˜çš„æ€§èƒ½ã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">final</span> <span class="type">ReentrantLock</span> <span class="variable">lock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReentrantLock</span>();</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">someMethod</span><span class="params">()</span> &#123;</span><br><span class="line">    lock.lock();</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">/* ... */</span></span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        lock.unlock();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><strong>åŸå­ç±»</strong>ï¼šJavaå¹¶å‘åº“ï¼ˆ<code>java.util.concurrent.atomic</code>ï¼‰æä¾›äº†åŸå­ç±»ï¼Œå¦‚<code>AtomicInteger</code>ã€<code>AtomicLong</code>ç­‰ï¼Œè¿™äº›ç±»æä¾›äº†åŸå­æ“ä½œï¼Œå¯ä»¥ç”¨äºæ›´æ–°åŸºæœ¬ç±»å‹çš„å˜é‡è€Œæ— éœ€é¢å¤–çš„åŒæ­¥ã€‚</li></ul><p>ç¤ºä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">AtomicInteger</span> <span class="variable">counter</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AtomicInteger</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="type">int</span> <span class="variable">newValue</span> <span class="operator">=</span> counter.incrementAndGet();</span><br></pre></td></tr></table></figure><ul><li><strong>çº¿ç¨‹å±€éƒ¨å˜é‡</strong>:<code>ThreadLocal</code>ç±»å¯ä»¥ä¸ºæ¯ä¸ªçº¿ç¨‹æä¾›ç‹¬ç«‹çš„å˜é‡å‰¯æœ¬ï¼Œè¿™æ ·æ¯ä¸ªçº¿ç¨‹éƒ½æ‹¥æœ‰è‡ªå·±çš„å˜é‡ï¼Œæ¶ˆé™¤äº†ç«äº‰æ¡ä»¶ã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ThreadLocal&lt;Integer&gt; threadLocalVar = <span class="keyword">new</span> <span class="title class_">ThreadLocal</span>&lt;&gt;();</span><br><span class="line"></span><br><span class="line">threadLocalVar.set(<span class="number">10</span>);</span><br><span class="line"><span class="type">int</span> <span class="variable">value</span> <span class="operator">=</span> threadLocalVar.get();</span><br></pre></td></tr></table></figure><ul><li><strong>å¹¶å‘é›†åˆ</strong>:ä½¿ç”¨<code>java.util.concurrent</code>åŒ…ä¸­çš„çº¿ç¨‹å®‰å…¨é›†åˆï¼Œå¦‚<code>ConcurrentHashMap</code>ã€<code>ConcurrentLinkedQueue</code>ç­‰ï¼Œè¿™äº›é›†åˆå†…éƒ¨å·²ç»å®ç°äº†çº¿ç¨‹å®‰å…¨çš„é€»è¾‘ã€‚</li><li><strong>JUCå·¥å…·ç±»</strong>: ä½¿ç”¨<code>java.util.concurrent</code>åŒ…ä¸­çš„ä¸€äº›å·¥å…·ç±»å¯ä»¥ç”¨äºæ§åˆ¶çº¿ç¨‹é—´çš„åŒæ­¥å’Œåä½œã€‚ä¾‹å¦‚ï¼š<code>Semaphore</code>å’Œ<code>CyclicBarrier</code>ç­‰ã€‚</li></ul><h2 id="3-Javaä¸­æœ‰å“ªäº›å¸¸ç”¨çš„é”ï¼Œåœ¨ä»€ä¹ˆåœºæ™¯ä¸‹ä½¿ç”¨ï¼Ÿ"><a href="#3-Javaä¸­æœ‰å“ªäº›å¸¸ç”¨çš„é”ï¼Œåœ¨ä»€ä¹ˆåœºæ™¯ä¸‹ä½¿ç”¨ï¼Ÿ" class="headerlink" title="3.Javaä¸­æœ‰å“ªäº›å¸¸ç”¨çš„é”ï¼Œåœ¨ä»€ä¹ˆåœºæ™¯ä¸‹ä½¿ç”¨ï¼Ÿ"></a>3.Javaä¸­æœ‰å“ªäº›å¸¸ç”¨çš„é”ï¼Œåœ¨ä»€ä¹ˆåœºæ™¯ä¸‹ä½¿ç”¨ï¼Ÿ</h2><p>Javaä¸­çš„é”æ˜¯ç”¨äºç®¡ç†å¤šçº¿ç¨‹å¹¶å‘è®¿é—®å…±äº«èµ„æºçš„å…³é”®æœºåˆ¶ã€‚é”å¯ä»¥ç¡®ä¿åœ¨ä»»æ„ç»™å®šæ—¶é—´å†…åªæœ‰ä¸€ä¸ªçº¿ç¨‹å¯ä»¥è®¿é—®ç‰¹å®šçš„èµ„æºï¼Œä»è€Œé¿å…æ•°æ®ç«äº‰å’Œä¸ä¸€è‡´æ€§ã€‚Javaæä¾›äº†å¤šç§é”æœºåˆ¶ï¼Œå¯ä»¥åˆ†ä¸ºä»¥ä¸‹å‡ ç±»ï¼š</p><ul><li><strong>å†…ç½®é”ï¼ˆsynchronizedï¼‰</strong>ï¼šJavaä¸­çš„<code>synchronized</code>å…³é”®å­—æ˜¯å†…ç½®é”æœºåˆ¶çš„åŸºç¡€ï¼Œå¯ä»¥ç”¨äºæ–¹æ³•æˆ–ä»£ç å—ã€‚<strong>å½“ä¸€ä¸ªçº¿ç¨‹è¿›å…¥<code>synchronized</code>ä»£ç å—æˆ–æ–¹æ³•æ—¶ï¼Œå®ƒä¼šè·å–å…³è”å¯¹è±¡çš„é”ï¼›å½“çº¿ç¨‹ç¦»å¼€è¯¥ä»£ç å—æˆ–æ–¹æ³•æ—¶ï¼Œé”ä¼šè¢«é‡Šæ”¾ã€‚</strong>å¦‚æœå…¶ä»–çº¿ç¨‹å°è¯•è·å–åŒä¸€ä¸ªå¯¹è±¡çš„é”ï¼Œå®ƒä»¬å°†è¢«<strong>é˜»å¡</strong>ï¼Œç›´åˆ°é”è¢«é‡Šæ”¾ã€‚å…¶ä¸­ï¼ŒsyncronizedåŠ é”æ—¶<strong>æœ‰æ— é”ã€åå‘é”ã€è½»é‡çº§é”å’Œé‡é‡çº§é”å‡ ä¸ªçº§åˆ«</strong>ã€‚åå‘é”ç”¨äºå½“ä¸€ä¸ªçº¿ç¨‹è¿›å…¥åŒæ­¥å—æ—¶ï¼Œå¦‚æœæ²¡æœ‰ä»»ä½•å…¶ä»–çº¿ç¨‹ç«äº‰ï¼Œå°±ä¼šä½¿ç”¨<strong>åå‘é”</strong>ï¼Œä»¥å‡å°‘é”çš„å¼€é”€ã€‚<strong>è½»é‡çº§é”</strong>ä½¿ç”¨çº¿ç¨‹æ ˆä¸Šçš„æ•°æ®ç»“æ„ï¼Œé¿å…äº†æ“ä½œç³»ç»Ÿçº§åˆ«çš„é”ã€‚<strong>é‡é‡çº§é”åˆ™æ¶‰åŠæ“ä½œç³»ç»Ÿçº§çš„äº’æ–¥é”</strong>ã€‚</li><li><strong>ReentrantLock</strong>ï¼š<code>java.util.concurrent.locks.ReentrantLock</code>æ˜¯ä¸€ä¸ªæ˜¾å¼çš„é”ç±»ï¼Œæä¾›äº†æ¯”<code>synchronized</code>æ›´é«˜çº§çš„åŠŸèƒ½ï¼Œå¦‚å¯<strong>ä¸­æ–­çš„é”ç­‰å¾…ã€å®šæ—¶é”ç­‰å¾…ã€å…¬å¹³é”é€‰é¡¹</strong>ç­‰ã€‚<code>ReentrantLock</code>ä½¿ç”¨<code>lock()</code>å’Œ<code>unlock()</code>æ–¹æ³•æ¥è·å–å’Œé‡Šæ”¾é”ã€‚å…¶ä¸­ï¼Œå…¬å¹³é”æŒ‰ç…§çº¿ç¨‹è¯·æ±‚é”çš„é¡ºåºæ¥åˆ†é…é”ï¼Œä¿è¯äº†é”åˆ†é…çš„å…¬å¹³æ€§ï¼Œä½†å¯èƒ½å¢åŠ é”çš„ç­‰å¾…æ—¶é—´ã€‚éå…¬å¹³é”ä¸ä¿è¯é”åˆ†é…çš„é¡ºåºï¼Œå¯ä»¥å‡å°‘é”çš„ç«äº‰ï¼Œæé«˜æ€§èƒ½ï¼Œä½†å¯èƒ½é€ æˆæŸäº›çº¿ç¨‹çš„é¥¥é¥¿ã€‚</li><li><strong>è¯»å†™é”ï¼ˆReadWriteLockï¼‰</strong>ï¼š<code>java.util.concurrent.locks.ReadWriteLock</code>æ¥å£å®šä¹‰äº†ä¸€ç§é”ï¼Œå…è®¸å¤šä¸ªè¯»å–è€…åŒæ—¶è®¿é—®å…±äº«èµ„æºï¼Œä½†åªå…è®¸ä¸€ä¸ªå†™å…¥è€…ã€‚è¯»å†™é”é€šå¸¸ç”¨äºè¯»å–è¿œå¤šäºå†™å…¥çš„æƒ…å†µï¼Œä»¥æé«˜å¹¶å‘æ€§ã€‚</li><li><strong>ä¹è§‚é”å’Œæ‚²è§‚é”</strong>ï¼šæ‚²è§‚é”ï¼ˆPessimistic Lockingï¼‰é€šå¸¸æŒ‡<strong>åœ¨è®¿é—®æ•°æ®å‰å°±é”å®šèµ„æº</strong>ï¼Œå‡è®¾æœ€åçš„æƒ…å†µï¼Œå³æ•°æ®å¾ˆå¯èƒ½è¢«å…¶ä»–çº¿ç¨‹ä¿®æ”¹ã€‚<code>synchronized</code>å’Œ<code>ReentrantLock</code>éƒ½æ˜¯æ‚²è§‚é”çš„ä¾‹å­ã€‚ä¹è§‚é”ï¼ˆOptimistic Lockingï¼‰é€šå¸¸ä¸é”å®šèµ„æºï¼Œ<strong>è€Œæ˜¯åœ¨æ›´æ–°æ•°æ®æ—¶æ£€æŸ¥æ•°æ®æ˜¯å¦å·²è¢«å…¶ä»–çº¿ç¨‹ä¿®æ”¹ã€‚ä¹è§‚é”å¸¸ä½¿ç”¨ç‰ˆæœ¬å·æˆ–æ—¶é—´æˆ³æ¥å®ç°ã€‚æ¯”å¦‚CAS</strong></li><li><strong>è‡ªæ—‹é”</strong>ï¼šè‡ªæ—‹é”æ˜¯ä¸€ç§é”æœºåˆ¶ï¼Œçº¿ç¨‹åœ¨ç­‰å¾…é”æ—¶ä¼š<strong>æŒç»­å¾ªç¯æ£€æŸ¥é”æ˜¯å¦å¯ç”¨ï¼Œ</strong>è€Œä¸æ˜¯æ”¾å¼ƒCPUå¹¶é˜»å¡ã€‚é€šå¸¸å¯ä»¥ä½¿ç”¨CASæ¥å®ç°ã€‚<strong>è¿™åœ¨é”ç­‰å¾…æ—¶é—´å¾ˆçŸ­çš„æƒ…å†µä¸‹å¯ä»¥æé«˜æ€§èƒ½ï¼Œä½†è¿‡åº¦è‡ªæ—‹ä¼šæµªè´¹CPUèµ„æºã€‚</strong></li></ul><h2 id="4-æ€ä¹ˆåœ¨å®è·µä¸­ç”¨é”çš„ï¼Ÿ"><a href="#4-æ€ä¹ˆåœ¨å®è·µä¸­ç”¨é”çš„ï¼Ÿ" class="headerlink" title="4.æ€ä¹ˆåœ¨å®è·µä¸­ç”¨é”çš„ï¼Ÿ"></a>4.æ€ä¹ˆåœ¨å®è·µä¸­ç”¨é”çš„ï¼Ÿ</h2><p>Javaæä¾›äº†å¤šç§é”çš„å®ç°ï¼ŒåŒ…æ‹¬<code>synchronized</code>å…³é”®å­—ã€<code>java.util.concurrent.locks</code>åŒ…ä¸‹çš„<code>Lock</code>æ¥å£åŠå…¶å…·ä½“å®ç°å¦‚<code>ReentrantLock</code>ã€<code>ReadWriteLock</code>ç­‰ã€‚ä¸‹é¢æˆ‘ä»¬æ¥çœ‹çœ‹è¿™äº›é”çš„ä½¿ç”¨æ–¹å¼ã€‚</p><blockquote><ol><li><code>synchronized</code></li></ol></blockquote><p><code>synchronized</code>å…³é”®å­—å¯ä»¥ç”¨äºæ–¹æ³•æˆ–ä»£ç å—ï¼Œå®ƒæ˜¯Javaä¸­æœ€æ—©çš„é”å®ç°ï¼Œä½¿ç”¨èµ·æ¥éå¸¸ç®€å•ã€‚</p><p><strong>ç¤ºä¾‹ï¼šsynchronizedæ–¹æ³•</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Counter</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title function_">increment</span><span class="params">()</span> &#123;</span><br><span class="line">        count++;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="type">int</span> <span class="title function_">getCount</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> count;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>ç¤ºä¾‹ï¼šsynchronizedä»£ç å—</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Counter</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">Object</span> <span class="variable">lock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">increment</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">synchronized</span> (lock) &#123;</span><br><span class="line">            count++;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><ol><li>ä½¿ç”¨<code>Lock</code>æ¥å£</li></ol></blockquote><p><code>Lock</code>æ¥å£æä¾›äº†æ¯”<code>synchronized</code>æ›´çµæ´»çš„é”æ“ä½œï¼ŒåŒ…æ‹¬å°è¯•é”ã€å¯ä¸­æ–­é”ã€å®šæ—¶é”ç­‰ã€‚<code>ReentrantLock</code>æ˜¯<code>Lock</code>æ¥å£çš„ä¸€ä¸ªå®ç°ã€‚</p><p><strong>ç¤ºä¾‹ï¼šä½¿ç”¨ReentrantLock</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.concurrent.locks.Lock;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.locks.ReentrantLock;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Counter</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">Lock</span> <span class="variable">lock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReentrantLock</span>();</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">increment</span><span class="params">()</span> &#123;</span><br><span class="line">        lock.lock();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            count++;</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><ol><li>ä½¿ç”¨<code>ReadWriteLock</code></li></ol></blockquote><p><code>ReadWriteLock</code>æ¥å£æä¾›äº†ä¸€ç§è¯»å†™é”çš„å®ç°ï¼Œå…è®¸å¤šä¸ªè¯»æ“ä½œåŒæ—¶è¿›è¡Œï¼Œä½†å†™æ“ä½œæ˜¯<strong>ç‹¬å </strong>çš„ã€‚</p><p><strong>ç¤ºä¾‹ï¼šä½¿ç”¨ReadWriteLock</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.concurrent.locks.Lock;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.locks.ReadWriteLock;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.locks.ReentrantReadWriteLock;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Cache</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">ReadWriteLock</span> <span class="variable">lock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReentrantReadWriteLock</span>();</span><br><span class="line">    <span class="keyword">private</span> <span class="type">Lock</span> <span class="variable">readLock</span> <span class="operator">=</span> lock.readLock();</span><br><span class="line">    <span class="keyword">private</span> <span class="type">Lock</span> <span class="variable">writeLock</span> <span class="operator">=</span> lock.writeLock();</span><br><span class="line">    <span class="keyword">private</span> Object data;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">readData</span><span class="params">()</span> &#123;</span><br><span class="line">        readLock.lock();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> data;</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            readLock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">writeData</span><span class="params">(Object newData)</span> &#123;</span><br><span class="line">        writeLock.lock();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            data = newData;</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            writeLock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="5-Java-å¹¶å‘å·¥å…·ä½ çŸ¥é“å“ªäº›ï¼Ÿ"><a href="#5-Java-å¹¶å‘å·¥å…·ä½ çŸ¥é“å“ªäº›ï¼Ÿ" class="headerlink" title="5.Java å¹¶å‘å·¥å…·ä½ çŸ¥é“å“ªäº›ï¼Ÿ"></a>5.Java å¹¶å‘å·¥å…·ä½ çŸ¥é“å“ªäº›ï¼Ÿ</h2><ul><li><strong>CountDownLatch</strong>ï¼šCountDownLatch æ˜¯ä¸€ä¸ªåŒæ­¥è¾…åŠ©ç±»ï¼Œå®ƒå…è®¸ä¸€ä¸ªæˆ–å¤šä¸ªçº¿ç¨‹ç­‰å¾…å…¶ä»–çº¿ç¨‹å®Œæˆæ“ä½œã€‚å®ƒä½¿ç”¨ä¸€ä¸ªè®¡æ•°å™¨è¿›è¡Œåˆå§‹åŒ–ï¼Œè°ƒç”¨ <code>countDown()</code> æ–¹æ³•ä¼šä½¿è®¡æ•°å™¨å‡ä¸€ï¼Œå½“è®¡æ•°å™¨çš„å€¼å‡ä¸º 0 æ—¶ï¼Œç­‰å¾…çš„çº¿ç¨‹ä¼šè¢«å”¤é†’ã€‚å¯ä»¥æŠŠå®ƒæƒ³è±¡æˆä¸€ä¸ªå€’è®¡æ—¶å™¨ï¼Œå½“å€’è®¡æ—¶ç»“æŸï¼ˆè®¡æ•°å™¨ä¸º 0ï¼‰æ—¶ï¼Œç­‰å¾…çš„äº‹ä»¶å°±ä¼šå‘ç”Ÿã€‚ç¤ºä¾‹ä»£ç ï¼š</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.concurrent.CountDownLatch;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CountDownLatchExample</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">numberOfThreads</span> <span class="operator">=</span> <span class="number">3</span>;</span><br><span class="line">        <span class="type">CountDownLatch</span> <span class="variable">latch</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CountDownLatch</span>(numberOfThreads);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åˆ›å»ºå¹¶å¯åŠ¨ä¸‰ä¸ªå·¥ä½œçº¿ç¨‹</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; numberOfThreads; i++) &#123;</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">                System.out.println(Thread.currentThread().getName() + <span class="string">&quot; æ­£åœ¨å·¥ä½œ&quot;</span>);</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    Thread.sleep(<span class="number">1000</span>);  <span class="comment">// æ¨¡æ‹Ÿå·¥ä½œæ—¶é—´</span></span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">                latch.countDown();  <span class="comment">// å®Œæˆå·¥ä½œï¼Œè®¡æ•°å™¨å‡ä¸€</span></span><br><span class="line">                System.out.println(Thread.currentThread().getName() + <span class="string">&quot; å®Œæˆå·¥ä½œ&quot;</span>);</span><br><span class="line">            &#125;).start();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;ä¸»çº¿ç¨‹ç­‰å¾…å·¥ä½œçº¿ç¨‹å®Œæˆ&quot;</span>);</span><br><span class="line">        latch.await();  <span class="comment">// ä¸»çº¿ç¨‹ç­‰å¾…ï¼Œç›´åˆ°è®¡æ•°å™¨ä¸º 0</span></span><br><span class="line">        System.out.println(<span class="string">&quot;æ‰€æœ‰å·¥ä½œçº¿ç¨‹å·²å®Œæˆï¼Œä¸»çº¿ç¨‹ç»§ç»­æ‰§è¡Œ&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><strong>CyclicBarrier</strong>ï¼šCyclicBarrier å…è®¸ä¸€ç»„çº¿ç¨‹äº’ç›¸ç­‰å¾…ï¼Œç›´åˆ°åˆ°è¾¾ä¸€ä¸ªå…¬å…±çš„å±éšœç‚¹ã€‚å½“æ‰€æœ‰çº¿ç¨‹éƒ½åˆ°è¾¾è¿™ä¸ªå±éšœç‚¹åï¼Œå®ƒä»¬å¯ä»¥ç»§ç»­æ‰§è¡Œåç»­æ“ä½œï¼Œå¹¶ä¸”è¿™ä¸ªå±éšœå¯ä»¥è¢«é‡ç½®å¾ªç¯ä½¿ç”¨ã€‚ä¸ <code>CountDownLatch</code> ä¸åŒï¼Œ<code>CyclicBarrier</code> ä¾§é‡äºçº¿ç¨‹é—´çš„ç›¸äº’ç­‰å¾…ï¼Œè€Œä¸æ˜¯ç­‰å¾…æŸäº›æ“ä½œå®Œæˆã€‚ç¤ºä¾‹ä»£ç ï¼š</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.concurrent.CyclicBarrier;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CyclicBarrierExample</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">numberOfThreads</span> <span class="operator">=</span> <span class="number">3</span>;</span><br><span class="line">        <span class="type">CyclicBarrier</span> <span class="variable">barrier</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CyclicBarrier</span>(numberOfThreads, () -&gt; &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;æ‰€æœ‰çº¿ç¨‹éƒ½åˆ°è¾¾äº†å±éšœï¼Œç»§ç»­æ‰§è¡Œåç»­æ“ä½œ&quot;</span>);</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; numberOfThreads; i++) &#123;</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    System.out.println(Thread.currentThread().getName() + <span class="string">&quot; æ­£åœ¨è¿è¡Œ&quot;</span>);</span><br><span class="line">                    Thread.sleep(<span class="number">1000</span>);  <span class="comment">// æ¨¡æ‹Ÿè¿è¡Œæ—¶é—´</span></span><br><span class="line">                    barrier.await();  <span class="comment">// ç­‰å¾…å…¶ä»–çº¿ç¨‹</span></span><br><span class="line">                    System.out.println(Thread.currentThread().getName() + <span class="string">&quot; å·²ç»é€šè¿‡å±éšœ&quot;</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;).start();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><strong>Semaphore</strong>ï¼šSemaphore æ˜¯ä¸€ä¸ªè®¡æ•°ä¿¡å·é‡ï¼Œç”¨äºæ§åˆ¶åŒæ—¶è®¿é—®æŸä¸ªå…±äº«èµ„æºçš„çº¿ç¨‹æ•°é‡ã€‚é€šè¿‡ <code>acquire()</code> æ–¹æ³•è·å–è®¸å¯ï¼Œä½¿ç”¨ <code>release()</code> æ–¹æ³•é‡Šæ”¾è®¸å¯ã€‚å¦‚æœæ²¡æœ‰è®¸å¯å¯ç”¨ï¼Œçº¿ç¨‹å°†è¢«é˜»å¡ï¼Œç›´åˆ°æœ‰è®¸å¯è¢«é‡Šæ”¾ã€‚å¯ä»¥ç”¨æ¥é™åˆ¶å¯¹æŸäº›èµ„æºï¼ˆå¦‚æ•°æ®åº“è¿æ¥æ± ã€æ–‡ä»¶æ“ä½œç­‰ï¼‰çš„å¹¶å‘è®¿é—®é‡ã€‚ä»£ç å¦‚ä¸‹ï¼š</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.concurrent.Semaphore;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SemaphoreExample</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Semaphore</span> <span class="variable">semaphore</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Semaphore</span>(<span class="number">2</span>);  <span class="comment">// å…è®¸ 2 ä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    semaphore.acquire();  <span class="comment">// è·å–è®¸å¯</span></span><br><span class="line">                    System.out.println(Thread.currentThread().getName() + <span class="string">&quot; è·å¾—äº†è®¸å¯&quot;</span>);</span><br><span class="line">                    Thread.sleep(<span class="number">2000</span>);  <span class="comment">// æ¨¡æ‹Ÿèµ„æºä½¿ç”¨</span></span><br><span class="line">                    System.out.println(Thread.currentThread().getName() + <span class="string">&quot; é‡Šæ”¾äº†è®¸å¯&quot;</span>);</span><br><span class="line">                    semaphore.release();  <span class="comment">// é‡Šæ”¾è®¸å¯</span></span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;).start();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><strong>Future å’Œ Callable</strong>ï¼šCallable æ˜¯ä¸€ä¸ªç±»ä¼¼äº <code>Runnable</code> çš„æ¥å£ï¼Œä½†å®ƒå¯ä»¥è¿”å›ç»“æœï¼Œå¹¶ä¸”å¯ä»¥æŠ›å‡ºå¼‚å¸¸ã€‚<strong>Future ç”¨äºè¡¨ç¤ºä¸€ä¸ªå¼‚æ­¥è®¡ç®—çš„ç»“æœï¼Œå¯ä»¥é€šè¿‡å®ƒæ¥è·å– <code>Callable</code> ä»»åŠ¡çš„æ‰§è¡Œç»“æœæˆ–å–æ¶ˆä»»åŠ¡ã€‚ä»£ç å¦‚ä¸‹ï¼š</strong></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.concurrent.Callable;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ExecutorService;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.Executors;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.Future;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FutureCallableExample</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="type">ExecutorService</span> <span class="variable">executorService</span> <span class="operator">=</span> Executors.newSingleThreadExecutor();</span><br><span class="line"></span><br><span class="line">        Callable&lt;Integer&gt; callable = () -&gt; &#123;</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot; å¼€å§‹æ‰§è¡Œ Callable ä»»åŠ¡&quot;</span>);</span><br><span class="line">            Thread.sleep(<span class="number">2000</span>);  <span class="comment">// æ¨¡æ‹Ÿè€—æ—¶æ“ä½œ</span></span><br><span class="line">            <span class="keyword">return</span> <span class="number">42</span>;  <span class="comment">// è¿”å›ç»“æœ</span></span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        Future&lt;Integer&gt; future = executorService.submit(callable);</span><br><span class="line">        System.out.println(<span class="string">&quot;ä¸»çº¿ç¨‹ç»§ç»­æ‰§è¡Œå…¶ä»–ä»»åŠ¡&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">Integer</span> <span class="variable">result</span> <span class="operator">=</span> future.get();  <span class="comment">// ç­‰å¾… Callable ä»»åŠ¡å®Œæˆå¹¶è·å–ç»“æœ</span></span><br><span class="line">            System.out.println(<span class="string">&quot;Callable ä»»åŠ¡çš„ç»“æœ: &quot;</span> + result);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        executorService.shutdown();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><strong>ConcurrentHashMap</strong>ï¼šConcurrentHashMap æ˜¯ä¸€ä¸ªçº¿ç¨‹å®‰å…¨çš„å“ˆå¸Œè¡¨ï¼Œå®ƒå…è®¸å¤šä¸ªçº¿ç¨‹åŒæ—¶è¿›è¡Œè¯»æ“ä½œï¼Œåœ¨ä¸€å®šç¨‹åº¦ä¸Šæ”¯æŒå¹¶å‘çš„ä¿®æ”¹æ“ä½œï¼Œé¿å…äº† <code>HashMap</code> åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹éœ€è¦ä½¿ç”¨ <code>synchronized</code> æˆ– <code>Collections.synchronizedMap()</code> è¿›è¡ŒåŒæ­¥çš„æ€§èƒ½é—®é¢˜ã€‚ä»£ç å¦‚ä¸‹ï¼š</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.concurrent.ConcurrentHashMap;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ConcurrentHashMapExample</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        ConcurrentHashMap&lt;String, Integer&gt; map = <span class="keyword">new</span> <span class="title class_">ConcurrentHashMap</span>&lt;&gt;();</span><br><span class="line">        map.put(<span class="string">&quot;key1&quot;</span>, <span class="number">1</span>);</span><br><span class="line">        map.put(<span class="string">&quot;key2&quot;</span>, <span class="number">2</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å¹¶å‘è¯»æ“ä½œ</span></span><br><span class="line">        map.forEach((key, value) -&gt; System.out.println(key + <span class="string">&quot;: &quot;</span> + value));</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å¹¶å‘å†™æ“ä½œ</span></span><br><span class="line">        map.computeIfAbsent(<span class="string">&quot;key3&quot;</span>, k -&gt; <span class="number">3</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="6-CountDownLatch-æ˜¯åšä»€ä¹ˆçš„è®²ä¸€è®²ï¼Ÿ"><a href="#6-CountDownLatch-æ˜¯åšä»€ä¹ˆçš„è®²ä¸€è®²ï¼Ÿ" class="headerlink" title="6.CountDownLatch æ˜¯åšä»€ä¹ˆçš„è®²ä¸€è®²ï¼Ÿ"></a>6.CountDownLatch æ˜¯åšä»€ä¹ˆçš„è®²ä¸€è®²ï¼Ÿ</h2><p>CountDownLatch æ˜¯ Java å¹¶å‘åŒ…ï¼ˆ<code>java.util.concurrent</code>ï¼‰ä¸­çš„ä¸€ä¸ªåŒæ­¥å·¥å…·ç±»ï¼Œ<strong>ç”¨äºè®©ä¸€ä¸ªæˆ–å¤šä¸ªçº¿ç¨‹ç­‰å¾…å…¶ä»–çº¿ç¨‹å®Œæˆæ“ä½œåå†ç»§ç»­æ‰§è¡Œ</strong>ã€‚</p><p>å…¶æ ¸å¿ƒæ˜¯é€šè¿‡ä¸€ä¸ªè®¡æ•°å™¨ï¼ˆCounterï¼‰å®ç°çº¿ç¨‹é—´çš„åè°ƒï¼Œå¸¸ç”¨äºå¤šçº¿ç¨‹ä»»åŠ¡çš„åˆ†é˜¶æ®µæ§åˆ¶æˆ–ä¸»çº¿ç¨‹ç­‰å¾…å¤šä¸ªå­çº¿ç¨‹å°±ç»ªçš„åœºæ™¯ï¼Œæ ¸å¿ƒåŸç†ï¼š</p><ul><li><strong>åˆå§‹åŒ–è®¡æ•°å™¨</strong>ï¼šåˆ›å»º <code>CountDownLatch</code> æ—¶æŒ‡å®šä¸€ä¸ªåˆå§‹è®¡æ•°å€¼ï¼ˆå¦‚ <code>N</code>ï¼‰ã€‚</li><li><strong>ç­‰å¾…çº¿ç¨‹é˜»å¡</strong>ï¼šè°ƒç”¨ <code>await()</code> çš„çº¿ç¨‹ä¼šè¢«é˜»å¡ï¼Œç›´åˆ°è®¡æ•°å™¨å˜ä¸º 0ã€‚</li><li><strong>ä»»åŠ¡å®Œæˆé€šçŸ¥</strong>ï¼šå…¶ä»–çº¿ç¨‹å®Œæˆä»»åŠ¡åè°ƒç”¨ <code>countDown()</code>ï¼Œä½¿è®¡æ•°å™¨å‡ 1ã€‚</li><li><strong>å”¤é†’ç­‰å¾…çº¿ç¨‹</strong>ï¼šå½“è®¡æ•°å™¨å‡åˆ° 0 æ—¶ï¼Œæ‰€æœ‰ç­‰å¾…çš„çº¿ç¨‹ä¼šè¢«å”¤é†’ã€‚</li></ul><p>ä¸»çº¿ç¨‹ç­‰å¾…æ‰€æœ‰å­çº¿ç¨‹å°±ç»ªåå¯åŠ¨ï¼Œä»£ç ä¾‹å­å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// ä¸»çº¿ç¨‹å¯åŠ¨å¤šä¸ªå­çº¿ç¨‹æ‰§è¡Œä»»åŠ¡ï¼Œç­‰å¾…å…¨éƒ¨å®Œæˆåç»Ÿè®¡ç»“æœ</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MainThreadWaitExample</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">threadCount</span> <span class="operator">=</span> <span class="number">3</span>;</span><br><span class="line">        <span class="type">CountDownLatch</span> <span class="variable">latch</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CountDownLatch</span>(threadCount);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; threadCount; i++) &#123;</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    System.out.println(Thread.currentThread().getName() + <span class="string">&quot; æ‰§è¡Œä»»åŠ¡&quot;</span>);</span><br><span class="line">                    Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">                    latch.countDown(); <span class="comment">// ä»»åŠ¡å®Œæˆï¼Œè®¡æ•°å™¨-1</span></span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;, <span class="string">&quot;Worker-&quot;</span> + i).start();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        latch.await(); <span class="comment">// ä¸»çº¿ç¨‹ç­‰å¾…æ‰€æœ‰å­çº¿ç¨‹å®Œæˆä»»åŠ¡</span></span><br><span class="line">        System.out.println(<span class="string">&quot;æ‰€æœ‰ä»»åŠ¡å·²å®Œæˆ&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="7-synchronizedå’ŒreentrantlockåŠå…¶åº”ç”¨åœºæ™¯ï¼Ÿ"><a href="#7-synchronizedå’ŒreentrantlockåŠå…¶åº”ç”¨åœºæ™¯ï¼Ÿ" class="headerlink" title="7.synchronizedå’ŒreentrantlockåŠå…¶åº”ç”¨åœºæ™¯ï¼Ÿ"></a>7.synchronizedå’ŒreentrantlockåŠå…¶åº”ç”¨åœºæ™¯ï¼Ÿ</h2><blockquote><p>synchronized å·¥ä½œåŸç†</p></blockquote><p>synchronizedæ˜¯Javaæä¾›çš„åŸå­æ€§å†…ç½®é”ï¼Œè¿™ç§å†…ç½®çš„å¹¶ä¸”ä½¿ç”¨è€…çœ‹ä¸åˆ°çš„é”ä¹Ÿè¢«ç§°ä¸º<strong>ç›‘è§†å™¨é”</strong>ï¼Œ</p><p>ä½¿ç”¨synchronizedä¹‹åï¼Œä¼šåœ¨<strong>ç¼–è¯‘ä¹‹ååœ¨åŒæ­¥çš„ä»£ç å—å‰ååŠ ä¸Šmonitorenterå’Œmonitorexitå­—èŠ‚ç æŒ‡ä»¤ï¼Œä»–ä¾èµ–æ“ä½œç³»ç»Ÿåº•å±‚äº’æ–¥é”å®ç°ã€‚ä»–çš„ä½œç”¨ä¸»è¦å°±æ˜¯å®ç°åŸå­æ€§æ“ä½œå’Œè§£å†³å…±äº«å˜é‡çš„å†…å­˜å¯è§æ€§é—®é¢˜ã€‚</strong></p><p>æ‰§è¡ŒmonitorenteræŒ‡ä»¤æ—¶ä¼šå°è¯•è·å–å¯¹è±¡é”ï¼Œ<strong>å¦‚æœå¯¹è±¡æ²¡æœ‰è¢«é”å®šæˆ–è€…å·²ç»è·å¾—äº†é”ï¼Œé”çš„è®¡æ•°å™¨+1</strong>ã€‚æ­¤æ—¶å…¶ä»–ç«äº‰é”çš„çº¿ç¨‹åˆ™ä¼šè¿›å…¥ç­‰å¾…é˜Ÿåˆ—ä¸­ã€‚<strong>æ‰§è¡ŒmonitorexitæŒ‡ä»¤æ—¶åˆ™ä¼šæŠŠè®¡æ•°å™¨-1ï¼Œå½“è®¡æ•°å™¨å€¼ä¸º0æ—¶ï¼Œåˆ™é”é‡Šæ”¾ï¼Œå¤„äºç­‰å¾…é˜Ÿåˆ—ä¸­çš„çº¿ç¨‹å†ç»§ç»­ç«äº‰é”ã€‚</strong></p><p>synchronizedæ˜¯<strong>æ’å®ƒé”</strong>ï¼Œå½“ä¸€ä¸ªçº¿ç¨‹è·å¾—é”ä¹‹åï¼Œå…¶ä»–çº¿ç¨‹å¿…é¡»ç­‰å¾…è¯¥çº¿ç¨‹é‡Šæ”¾é”åæ‰èƒ½è·å¾—é”ï¼Œè€Œä¸”ç”±äºJavaä¸­çš„çº¿ç¨‹å’Œæ“ä½œç³»ç»ŸåŸç”Ÿçº¿ç¨‹æ˜¯ä¸€ä¸€å¯¹åº”çš„ï¼Œçº¿ç¨‹è¢«é˜»å¡æˆ–è€…å”¤é†’æ—¶æ—¶ä¼šä»ç”¨æˆ·æ€åˆ‡æ¢åˆ°å†…æ ¸æ€ï¼Œè¿™ç§è½¬æ¢éå¸¸æ¶ˆè€—æ€§èƒ½ã€‚</p><p>ä»å†…å­˜è¯­ä¹‰æ¥è¯´ï¼ŒåŠ é”çš„è¿‡ç¨‹ä¼š<strong>æ¸…é™¤å·¥ä½œå†…å­˜ä¸­çš„å…±äº«å˜é‡ï¼Œå†ä»ä¸»å†…å­˜è¯»å–</strong>ï¼Œè€Œé‡Šæ”¾é”çš„è¿‡ç¨‹åˆ™æ˜¯å°†å·¥ä½œå†…å­˜ä¸­çš„å…±äº«å˜é‡å†™å›ä¸»å†…å­˜ã€‚</p><p>å®é™…ä¸Šå¤§éƒ¨åˆ†æ—¶å€™æˆ‘è®¤ä¸ºè¯´åˆ°monitorenterå°±è¡Œäº†ï¼Œä½†æ˜¯ä¸ºäº†æ›´æ¸…æ¥šçš„æè¿°ï¼Œè¿˜æ˜¯å†å…·ä½“ä¸€ç‚¹ã€‚</p><p>å¦‚æœå†æ·±å…¥åˆ°æºç æ¥è¯´ï¼Œsynchronizedå®é™…ä¸Šæœ‰ä¸¤ä¸ªé˜Ÿåˆ—waitSetå’ŒentryListã€‚</p><ol><li>å½“å¤šä¸ªçº¿ç¨‹è¿›å…¥åŒæ­¥ä»£ç å—æ—¶ï¼Œé¦–å…ˆè¿›å…¥entryList</li><li>æœ‰ä¸€ä¸ªçº¿ç¨‹è·å–åˆ°monitoré”åï¼Œå°±èµ‹å€¼ç»™å½“å‰çº¿ç¨‹ï¼Œå¹¶ä¸”è®¡æ•°å™¨+1</li><li>å¦‚æœçº¿ç¨‹è°ƒç”¨waitæ–¹æ³•ï¼Œå°†é‡Šæ”¾é”ï¼Œå½“å‰çº¿ç¨‹ç½®ä¸ºnullï¼Œè®¡æ•°å™¨-1ï¼ŒåŒæ—¶è¿›å…¥waitSetç­‰å¾…è¢«å”¤é†’ï¼Œè°ƒç”¨notifyæˆ–è€…notifyAllä¹‹ååˆä¼šè¿›å…¥entryListç«äº‰é”</li><li>å¦‚æœçº¿ç¨‹æ‰§è¡Œå®Œæ¯•ï¼ŒåŒæ ·é‡Šæ”¾é”ï¼Œè®¡æ•°å™¨-1ï¼Œå½“å‰çº¿ç¨‹ç½®ä¸ºnull<img src="https://cdn.xiaolincoding.com//picgo/1719918642412-181e3769-49d8-4c78-8f33-a866367a4693.png" alt="img"></li></ol><blockquote><p>reentrantlockå·¥ä½œåŸç†</p></blockquote><p>ReentrantLock çš„åº•å±‚å®ç°ä¸»è¦ä¾èµ–äº AbstractQueuedSynchronizer<strong>ï¼ˆAQSï¼‰è¿™ä¸ªæŠ½è±¡ç±»ã€‚AQS æ˜¯ä¸€ä¸ªæä¾›äº†åŸºæœ¬åŒæ­¥æœºåˆ¶çš„æ¡†æ¶ï¼Œå…¶ä¸­åŒ…æ‹¬äº†é˜Ÿåˆ—ã€çŠ¶æ€å€¼ç­‰ã€‚</strong></p><p>ReentrantLock åœ¨ AQS çš„åŸºç¡€ä¸Šé€šè¿‡å†…éƒ¨ç±» <strong>Sync</strong> æ¥å®ç°å…·ä½“çš„é”æ“ä½œã€‚<strong>ä¸åŒçš„ Sync å­ç±»å®ç°äº†å…¬å¹³é”å’Œéå…¬å¹³é”çš„ä¸åŒé€»è¾‘ï¼š</strong></p><ul><li><strong>å¯ä¸­æ–­æ€§</strong>ï¼š ReentrantLock å®ç°äº†<strong>å¯ä¸­æ–­æ€§</strong>ï¼Œè¿™æ„å‘³ç€çº¿ç¨‹åœ¨ç­‰å¾…é”çš„è¿‡ç¨‹ä¸­ï¼Œå¯ä»¥è¢«å…¶ä»–çº¿ç¨‹ä¸­æ–­è€Œæå‰ç»“æŸç­‰å¾…ã€‚åœ¨åº•å±‚ï¼ŒReentrantLock ä½¿ç”¨äº†ä¸ <strong>LockSupport.park() å’Œ LockSupport.unpark() ç›¸å…³çš„æœºåˆ¶æ¥å®ç°å¯ä¸­æ–­æ€§ã€‚</strong></li><li><strong>è®¾ç½®è¶…æ—¶æ—¶é—´</strong>ï¼š ReentrantLock <strong>æ”¯æŒåœ¨å°è¯•è·å–é”æ—¶è®¾ç½®è¶…æ—¶æ—¶é—´</strong>ï¼Œå³ç­‰å¾…ä¸€å®šæ—¶é—´åå¦‚æœè¿˜æœªè·å¾—é”ï¼Œåˆ™æ”¾å¼ƒé”çš„è·å–ã€‚è¿™æ˜¯é€šè¿‡å†…éƒ¨çš„ <strong>tryAcquireNanos æ–¹æ³•æ¥å®ç°çš„</strong>ã€‚</li><li><strong>å…¬å¹³é”å’Œéå…¬å¹³é”</strong>ï¼š åœ¨ç›´æ¥åˆ›å»º ReentrantLock å¯¹è±¡æ—¶ï¼Œ<strong>é»˜è®¤æƒ…å†µä¸‹æ˜¯éå…¬å¹³é”</strong>ã€‚å…¬å¹³é”æ˜¯æŒ‰ç…§çº¿ç¨‹ç­‰å¾…çš„é¡ºåºæ¥è·å–é”ï¼Œè€Œéå…¬å¹³é”åˆ™å…è®¸å¤šä¸ªçº¿ç¨‹åœ¨åŒä¸€æ—¶åˆ»ç«äº‰é”ï¼Œä¸è€ƒè™‘å®ƒä»¬ç”³è¯·é”çš„é¡ºåºã€‚å…¬å¹³é”å¯ä»¥é€šè¿‡åœ¨åˆ›å»º ReentrantLock æ—¶ä¼ å…¥ true æ¥è®¾ç½®ï¼Œä¾‹å¦‚ï¼š</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ReentrantLock</span> <span class="variable">fairLock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReentrantLock</span>(<span class="literal">true</span>);</span><br></pre></td></tr></table></figure><ul><li><strong>å¤šä¸ªæ¡ä»¶å˜é‡</strong>ï¼š ReentrantLock <strong>æ”¯æŒå¤šä¸ªæ¡ä»¶å˜é‡</strong>ï¼Œæ¯ä¸ªæ¡ä»¶å˜é‡å¯ä»¥ä¸ä¸€ä¸ª ReentrantLock å…³è”ã€‚è¿™ä½¿å¾—çº¿ç¨‹å¯ä»¥æ›´çµæ´»åœ°è¿›è¡Œç­‰å¾…å’Œå”¤é†’æ“ä½œï¼Œè€Œä¸ä»…ä»…æ˜¯åŸºäºå¯¹è±¡ç›‘è§†å™¨çš„ wait() å’Œ notify()ã€‚å¤šä¸ªæ¡ä»¶å˜é‡çš„å®ç°ä¾èµ–äº Condition æ¥å£ï¼Œä¾‹å¦‚ï¼š</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ReentrantLock</span> <span class="variable">lock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReentrantLock</span>();</span><br><span class="line"><span class="type">Condition</span> <span class="variable">condition</span> <span class="operator">=</span> lock.newCondition();</span><br><span class="line"><span class="comment">// ä½¿ç”¨ä¸‹é¢æ–¹æ³•è¿›è¡Œç­‰å¾…å’Œå”¤é†’</span></span><br><span class="line">condition.await();</span><br><span class="line">condition.signal();</span><br></pre></td></tr></table></figure><ul><li><strong>å¯é‡å…¥æ€§</strong>ï¼š ReentrantLock <strong>æ”¯æŒå¯é‡å…¥æ€§</strong>ï¼Œ<strong>å³åŒä¸€ä¸ªçº¿ç¨‹å¯ä»¥å¤šæ¬¡è·å¾—åŒä¸€æŠŠé”</strong>ï¼Œè€Œä¸ä¼šé€ æˆæ­»é”ã€‚è¿™æ˜¯é€šè¿‡<strong>å†…éƒ¨çš„ holdCount è®¡æ•°æ¥å®ç°çš„</strong>ã€‚å½“ä¸€ä¸ªçº¿ç¨‹å¤šæ¬¡è·å–é”æ—¶ï¼ŒholdCount é€’å¢ï¼Œé‡Šæ”¾é”æ—¶é€’å‡ï¼Œåªæœ‰å½“ holdCount ä¸ºé›¶æ—¶ï¼Œå…¶ä»–çº¿ç¨‹æ‰æœ‰æœºä¼šè·å–é”ã€‚</li></ul><blockquote><p>åº”ç”¨åœºæ™¯çš„åŒºåˆ«</p></blockquote><p><strong>synchronized</strong>ï¼š</p><ul><li><strong>ç®€å•åŒæ­¥éœ€æ±‚</strong>ï¼š å½“ä½ éœ€è¦å¯¹<strong>ä»£ç å—æˆ–æ–¹æ³•è¿›è¡Œç®€å•çš„åŒæ­¥æ§åˆ¶æ—¶</strong>ï¼Œ<code>synchronized</code>æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é€‰æ‹©ã€‚å®ƒä½¿ç”¨èµ·æ¥ç®€å•ï¼Œä¸éœ€è¦é¢å¤–çš„èµ„æºç®¡ç†ï¼Œå› ä¸ºé”ä¼šåœ¨æ–¹æ³•é€€å‡ºæˆ–ä»£ç å—æ‰§è¡Œå®Œæ¯•åè‡ªåŠ¨é‡Šæ”¾ã€‚</li><li><strong>ä»£ç å—åŒæ­¥</strong>ï¼š å¦‚æœä½ æƒ³å¯¹ç‰¹å®šä»£ç æ®µè¿›è¡ŒåŒæ­¥ï¼Œè€Œä¸æ˜¯æ•´ä¸ªæ–¹æ³•ï¼Œå¯ä»¥ä½¿ç”¨<code>synchronized</code>ä»£ç å—ã€‚è¿™å¯ä»¥è®©ä½ æ›´ç²¾ç»†åœ°æ§åˆ¶åŒæ­¥çš„èŒƒå›´ï¼Œä»è€Œå‡å°‘é”çš„æŒæœ‰æ—¶é—´ï¼Œæé«˜å¹¶å‘æ€§èƒ½ã€‚</li><li><strong>å†…ç½®é”çš„ä½¿ç”¨</strong>ï¼š <code>synchronized</code>å…³é”®å­—ä½¿ç”¨å¯¹è±¡çš„å†…ç½®é”ï¼ˆä¹Ÿç§°ä¸ºç›‘è§†å™¨é”ï¼‰ï¼Œè¿™åœ¨éœ€è¦ä½¿ç”¨å¯¹è±¡ä½œä¸ºé”å¯¹è±¡çš„æƒ…å†µä¸‹å¾ˆæœ‰ç”¨ï¼Œå°¤å…¶æ˜¯åœ¨å¯¹è±¡çŠ¶æ€ä¸é”ä¿æŠ¤çš„ä»£ç ç´§å¯†ç›¸å…³æ—¶ã€‚</li></ul><p><strong>ReentrantLockï¼š</strong></p><ul><li><strong>é«˜çº§é”åŠŸèƒ½éœ€æ±‚</strong>ï¼š <code>ReentrantLock</code>æä¾›äº†<code>synchronized</code>æ‰€ä¸å…·å¤‡çš„é«˜çº§åŠŸèƒ½ï¼Œå¦‚å…¬å¹³é”ã€å“åº”ä¸­æ–­ã€å®šæ—¶é”å°è¯•ã€ä»¥åŠå¤šä¸ªæ¡ä»¶å˜é‡ã€‚å½“ä½ éœ€è¦è¿™äº›åŠŸèƒ½æ—¶ï¼Œ<code>ReentrantLock</code>æ˜¯æ›´å¥½çš„é€‰æ‹©ã€‚</li><li><strong>æ€§èƒ½ä¼˜åŒ–</strong>ï¼š åœ¨é«˜åº¦ç«äº‰çš„ç¯å¢ƒä¸­ï¼Œ<code>ReentrantLock</code>å¯ä»¥æä¾›æ¯”<code>synchronized</code>æ›´å¥½çš„æ€§èƒ½ï¼Œå› ä¸ºå®ƒæä¾›äº†<strong>æ›´ç»†ç²’åº¦çš„æ§åˆ¶ï¼Œå¦‚å°è¯•é”å®šå’Œå®šæ—¶é”å®šï¼Œå¯ä»¥å‡å°‘çº¿ç¨‹é˜»å¡çš„å¯èƒ½æ€§</strong>ã€‚</li><li><strong>å¤æ‚åŒæ­¥ç»“æ„</strong>ï¼š å½“ä½ éœ€è¦æ›´å¤æ‚çš„åŒæ­¥ç»“æ„ï¼Œå¦‚éœ€è¦å¤šä¸ªæ¡ä»¶å˜é‡æ¥åè°ƒçº¿ç¨‹ä¹‹é—´çš„é€šä¿¡æ—¶ï¼Œ<code>ReentrantLock</code>åŠå…¶é…å¥—çš„<code>Condition</code>å¯¹è±¡å¯ä»¥æä¾›æ›´çµæ´»çš„è§£å†³æ–¹æ¡ˆã€‚</li></ul><p>ç»¼ä¸Šï¼Œ<code>synchronized</code>é€‚ç”¨äºç®€å•åŒæ­¥éœ€æ±‚å’Œä¸éœ€è¦é¢å¤–é”åŠŸèƒ½çš„åœºæ™¯ï¼Œè€Œ<code>ReentrantLock</code>é€‚ç”¨äºéœ€è¦æ›´é«˜çº§é”åŠŸèƒ½ã€æ€§èƒ½ä¼˜åŒ–æˆ–å¤æ‚åŒæ­¥é€»è¾‘çš„æƒ…å†µã€‚é€‰æ‹©å“ªç§åŒæ­¥æœºåˆ¶å–å†³äºå…·ä½“çš„åº”ç”¨éœ€æ±‚å’Œæ€§èƒ½è€ƒè™‘ã€‚</p><h2 id="8-é™¤äº†ç”¨synchronizedï¼Œè¿˜æœ‰ä»€ä¹ˆæ–¹æ³•å¯ä»¥å®ç°çº¿ç¨‹åŒæ­¥ï¼Ÿ"><a href="#8-é™¤äº†ç”¨synchronizedï¼Œè¿˜æœ‰ä»€ä¹ˆæ–¹æ³•å¯ä»¥å®ç°çº¿ç¨‹åŒæ­¥ï¼Ÿ" class="headerlink" title="8.é™¤äº†ç”¨synchronizedï¼Œè¿˜æœ‰ä»€ä¹ˆæ–¹æ³•å¯ä»¥å®ç°çº¿ç¨‹åŒæ­¥ï¼Ÿ"></a>8.é™¤äº†ç”¨synchronizedï¼Œè¿˜æœ‰ä»€ä¹ˆæ–¹æ³•å¯ä»¥å®ç°çº¿ç¨‹åŒæ­¥ï¼Ÿ</h2><ul><li><strong>ä½¿ç”¨<code>ReentrantLock</code>ç±»</strong>ï¼š<code>ReentrantLock</code>æ˜¯ä¸€ä¸ªå¯é‡å…¥çš„äº’æ–¥é”ï¼Œç›¸æ¯”<code>synchronized</code>æä¾›äº†æ›´çµæ´»çš„é”å®šå’Œè§£é”æ“ä½œã€‚å®ƒè¿˜æ”¯æŒå…¬å¹³é”å’Œéå…¬å¹³é”ï¼Œä»¥åŠå¯ä»¥å“åº”ä¸­æ–­çš„é”è·å–æ“ä½œã€‚</li><li><strong>ä½¿ç”¨<code>volatile</code>å…³é”®å­—</strong>ï¼šè™½ç„¶<code>volatile</code>ä¸æ˜¯ä¸€ç§é”æœºåˆ¶ï¼Œä½†å®ƒå¯ä»¥ç¡®ä¿å˜é‡çš„å¯è§æ€§ã€‚å½“ä¸€ä¸ªå˜é‡è¢«å£°æ˜ä¸º<code>volatile</code>åï¼Œçº¿ç¨‹å°†ç›´æ¥ä»ä¸»å†…å­˜ä¸­è¯»å–è¯¥å˜é‡çš„å€¼ï¼Œè¿™æ ·å°±èƒ½ä¿è¯çº¿ç¨‹é—´å˜é‡çš„å¯è§æ€§ã€‚ä½†å®ƒä¸å…·å¤‡åŸå­æ€§ã€‚</li><li><strong>ä½¿ç”¨<code>Atomic</code>ç±»</strong>ï¼šJavaæä¾›äº†ä¸€ç³»åˆ—çš„åŸå­ç±»ï¼Œä¾‹å¦‚<code>AtomicInteger</code>ã€<code>AtomicLong</code>ã€<code>AtomicReference</code>ç­‰ï¼Œç”¨äºå®ç°å¯¹å•ä¸ªå˜é‡çš„åŸå­æ“ä½œï¼Œè¿™äº›ç±»åœ¨å®ç°ç»†èŠ‚ä¸Šåˆ©ç”¨äº†CASï¼ˆCompare-And-Swapï¼‰ç®—æ³•ï¼Œå¯ä»¥ç”¨æ¥å®ç°æ— é”çš„çº¿ç¨‹å®‰å…¨ã€‚</li></ul><h2 id="9-synchronizedé”é™æ€æ–¹æ³•å’Œæ™®é€šæ–¹æ³•åŒºåˆ«ï¼Ÿ"><a href="#9-synchronizedé”é™æ€æ–¹æ³•å’Œæ™®é€šæ–¹æ³•åŒºåˆ«ï¼Ÿ" class="headerlink" title="9.synchronizedé”é™æ€æ–¹æ³•å’Œæ™®é€šæ–¹æ³•åŒºåˆ«ï¼Ÿ"></a>9.synchronizedé”é™æ€æ–¹æ³•å’Œæ™®é€šæ–¹æ³•åŒºåˆ«ï¼Ÿ</h2><p>é”çš„å¯¹è±¡ä¸åŒï¼š</p><ul><li><strong>æ™®é€šæ–¹æ³•</strong>ï¼šé”çš„æ˜¯<strong>å½“å‰å¯¹è±¡å®ä¾‹</strong>ï¼ˆ<code>this</code>ï¼‰ã€‚åŒä¸€å¯¹è±¡å®ä¾‹çš„ <code>synchronized</code> æ™®é€šæ–¹æ³•ï¼ŒåŒä¸€æ—¶é—´åªèƒ½è¢«ä¸€ä¸ªçº¿ç¨‹è®¿é—®ï¼›ä¸åŒå¯¹è±¡å®ä¾‹é—´äº’ä¸å½±å“ï¼Œå¯è¢«ä¸åŒçº¿ç¨‹åŒæ—¶è®¿é—®å„è‡ªçš„åŒæ­¥æ™®é€šæ–¹æ³•ã€‚</li><li><strong>é™æ€æ–¹æ³•</strong>ï¼šé”çš„æ˜¯<strong>å½“å‰ç±»çš„ <code>Class</code> å¯¹è±¡</strong>ã€‚ç”±äºç±»çš„ <code>Class</code> å¯¹è±¡å…¨å±€å”¯ä¸€ï¼Œæ— è®ºå¤šå°‘ä¸ªå¯¹è±¡å®ä¾‹ï¼Œè¯¥é™æ€åŒæ­¥æ–¹æ³•åŒä¸€æ—¶é—´åªèƒ½è¢«ä¸€ä¸ªçº¿ç¨‹è®¿é—®ã€‚</li></ul><p>ä½œç”¨èŒƒå›´ä¸åŒï¼š</p><ul><li><strong>æ™®é€šæ–¹æ³•</strong>ï¼šä»…å¯¹åŒä¸€å¯¹è±¡å®ä¾‹çš„åŒæ­¥æ–¹æ³•è°ƒç”¨äº’æ–¥ï¼Œä¸åŒå¯¹è±¡å®ä¾‹çš„åŒæ­¥æ™®é€šæ–¹æ³•å¯å¹¶è¡Œæ‰§è¡Œã€‚</li><li><strong>é™æ€æ–¹æ³•</strong>ï¼šå¯¹æ•´ä¸ªç±»çš„æ‰€æœ‰å®ä¾‹çš„è¯¥é™æ€æ–¹æ³•è°ƒç”¨éƒ½äº’æ–¥ï¼Œä¸€ä¸ªçº¿ç¨‹è¿›å…¥é™æ€åŒæ­¥æ–¹æ³•ï¼Œå…¶ä»–çº¿ç¨‹æ— æ³•è¿›å…¥åŒä¸€ç±»ä»»ä½•å®ä¾‹çš„è¯¥æ–¹æ³•ã€‚</li></ul><p>å¤šå®ä¾‹åœºæ™¯å½±å“ä¸åŒï¼š</p><ul><li><strong>æ™®é€šæ–¹æ³•</strong>ï¼šå¤šçº¿ç¨‹è®¿é—®ä¸åŒå¯¹è±¡å®ä¾‹çš„åŒæ­¥æ™®é€šæ–¹æ³•æ—¶ï¼Œå¯åŒæ—¶æ‰§è¡Œã€‚</li><li><strong>é™æ€æ–¹æ³•</strong>ï¼šä¸ç®¡æœ‰å¤šå°‘å¯¹è±¡å®ä¾‹ï¼ŒåŒä¸€æ—¶é—´ä»…ä¸€ä¸ªçº¿ç¨‹èƒ½æ‰§è¡Œè¯¥é™æ€åŒæ­¥æ–¹æ³•ã€‚</li></ul><h2 id="10-synchronizedå’ŒreentrantlockåŒºåˆ«ï¼Ÿ"><a href="#10-synchronizedå’ŒreentrantlockåŒºåˆ«ï¼Ÿ" class="headerlink" title="10.synchronizedå’ŒreentrantlockåŒºåˆ«ï¼Ÿ"></a>10.synchronizedå’ŒreentrantlockåŒºåˆ«ï¼Ÿ</h2><p>synchronized å’Œ ReentrantLock éƒ½æ˜¯ Java ä¸­æä¾›çš„å¯é‡å…¥é”ï¼š</p><ul><li><strong>ç”¨æ³•ä¸åŒ</strong>ï¼šsynchronized å¯ç”¨æ¥ä¿®é¥°æ™®é€šæ–¹æ³•ã€é™æ€æ–¹æ³•å’Œä»£ç å—ï¼Œè€Œ ReentrantLock åªèƒ½ç”¨åœ¨ä»£ç å—ä¸Šã€‚</li><li><strong>è·å–é”å’Œé‡Šæ”¾é”æ–¹å¼ä¸åŒ</strong>ï¼šsynchronized ä¼š<strong>è‡ªåŠ¨åŠ é”å’Œé‡Šæ”¾é”</strong>ï¼Œå½“è¿›å…¥ synchronized ä¿®é¥°çš„ä»£ç å—ä¹‹åä¼šè‡ªåŠ¨åŠ é”ï¼Œå½“ç¦»å¼€ synchronized çš„ä»£ç æ®µä¹‹åä¼šè‡ªåŠ¨é‡Šæ”¾é”ã€‚è€Œ ReentrantLock éœ€è¦<strong>æ‰‹åŠ¨åŠ é”å’Œé‡Šæ”¾é”</strong></li><li><strong>é”ç±»å‹ä¸åŒ</strong>ï¼šsynchronized å±äºéå…¬å¹³é”ï¼Œè€Œ ReentrantLock æ—¢å¯ä»¥æ˜¯å…¬å¹³é”ä¹Ÿå¯ä»¥æ˜¯éå…¬å¹³é”ã€‚</li><li><strong>å“åº”ä¸­æ–­ä¸åŒ</strong>ï¼šReentrantLock å¯ä»¥å“åº”ä¸­æ–­ï¼Œè§£å†³æ­»é”çš„é—®é¢˜ï¼Œè€Œ synchronized ä¸èƒ½å“åº”ä¸­æ–­ã€‚</li><li><strong>åº•å±‚å®ç°ä¸åŒ</strong>ï¼šsynchronized æ˜¯ JVM å±‚é¢é€šè¿‡ç›‘è§†å™¨å®ç°çš„ï¼Œè€Œ ReentrantLock æ˜¯åŸºäº AQS å®ç°çš„ã€‚</li></ul><h2 id="11-æ€ä¹ˆç†è§£å¯é‡å…¥é”ï¼Ÿ"><a href="#11-æ€ä¹ˆç†è§£å¯é‡å…¥é”ï¼Ÿ" class="headerlink" title="11.æ€ä¹ˆç†è§£å¯é‡å…¥é”ï¼Ÿ"></a>11.æ€ä¹ˆç†è§£å¯é‡å…¥é”ï¼Ÿ</h2><p>å¯é‡å…¥é”æ˜¯æŒ‡åŒä¸€ä¸ªçº¿ç¨‹åœ¨è·å–äº†é”ä¹‹åï¼Œ<strong>å¯ä»¥å†æ¬¡é‡å¤è·å–è¯¥é”è€Œä¸ä¼šé€ æˆæ­»é”æˆ–å…¶ä»–é—®é¢˜</strong>ã€‚å½“ä¸€ä¸ªçº¿ç¨‹æŒæœ‰é”æ—¶ï¼Œå¦‚æœå†æ¬¡å°è¯•è·å–è¯¥é”ï¼Œå°±ä¼šæˆåŠŸè·å–è€Œä¸ä¼šè¢«é˜»å¡ã€‚</p><p>ReentrantLockå®ç°å¯é‡å…¥é”çš„æœºåˆ¶æ˜¯åŸºäºçº¿ç¨‹æŒæœ‰é”çš„è®¡æ•°å™¨ã€‚</p><ul><li>å½“ä¸€ä¸ªçº¿ç¨‹ç¬¬ä¸€æ¬¡è·å–é”æ—¶ï¼Œè®¡æ•°å™¨ä¼šåŠ 1ï¼Œè¡¨ç¤ºè¯¥çº¿ç¨‹æŒæœ‰äº†é”ã€‚åœ¨æ­¤ä¹‹åï¼Œå¦‚æœåŒä¸€ä¸ªçº¿ç¨‹å†æ¬¡è·å–é”ï¼Œè®¡æ•°å™¨ä¼šå†æ¬¡åŠ 1ã€‚æ¯æ¬¡çº¿ç¨‹æˆåŠŸè·å–é”æ—¶ï¼Œéƒ½ä¼šå°†è®¡æ•°å™¨åŠ 1ã€‚</li><li>å½“çº¿ç¨‹é‡Šæ”¾é”æ—¶ï¼Œè®¡æ•°å™¨ä¼šç›¸åº”åœ°å‡1ã€‚<strong>åªæœ‰å½“è®¡æ•°å™¨å‡åˆ°0æ—¶ï¼Œé”æ‰ä¼šå®Œå…¨é‡Šæ”¾ï¼Œå…¶ä»–çº¿ç¨‹æ‰æœ‰æœºä¼šè·å–é”ã€‚</strong></li></ul><p>è¿™ç§è®¡æ•°å™¨çš„è®¾è®¡ä½¿å¾—åŒä¸€ä¸ªçº¿ç¨‹å¯ä»¥å¤šæ¬¡è·å–åŒä¸€ä¸ªé”ï¼Œè€Œä¸ä¼šé€ æˆæ­»é”æˆ–å…¶ä»–é—®é¢˜ã€‚æ¯æ¬¡è·å–é”æ—¶ï¼Œè®¡æ•°å™¨åŠ 1ï¼›æ¯æ¬¡é‡Šæ”¾é”æ—¶ï¼Œè®¡æ•°å™¨å‡1ã€‚åªæœ‰å½“è®¡æ•°å™¨å‡åˆ°0æ—¶ï¼Œé”æ‰ä¼šå®Œå…¨é‡Šæ”¾ã€‚</p><p><strong>ReentrantLocké€šè¿‡è¿™ç§è®¡æ•°å™¨çš„æ–¹å¼ï¼Œå®ç°äº†å¯é‡å…¥é”çš„æœºåˆ¶ã€‚å®ƒå…è®¸åŒä¸€ä¸ªçº¿ç¨‹å¤šæ¬¡è·å–åŒä¸€ä¸ªé”ï¼Œå¹¶ä¸”èƒ½å¤Ÿæ­£ç¡®åœ°å¤„ç†é”çš„è·å–å’Œé‡Šæ”¾ï¼Œé¿å…äº†æ­»é”å’Œå…¶ä»–å¹¶å‘é—®é¢˜ã€‚</strong></p><h2 id="12-synchronized-æ”¯æŒé‡å…¥å—ï¼Ÿå¦‚ä½•å®ç°çš„"><a href="#12-synchronized-æ”¯æŒé‡å…¥å—ï¼Ÿå¦‚ä½•å®ç°çš„" class="headerlink" title="12.synchronized æ”¯æŒé‡å…¥å—ï¼Ÿå¦‚ä½•å®ç°çš„?"></a>12.synchronized æ”¯æŒé‡å…¥å—ï¼Ÿå¦‚ä½•å®ç°çš„?</h2><p>synchronizedæ˜¯åŸºäº<strong>åŸå­æ€§çš„å†…éƒ¨é”æœºåˆ¶</strong>ï¼Œæ˜¯å¯é‡å…¥çš„ï¼Œå› æ­¤åœ¨ä¸€ä¸ªçº¿ç¨‹è°ƒç”¨synchronizedæ–¹æ³•çš„åŒæ—¶åœ¨å…¶æ–¹æ³•ä½“å†…éƒ¨è°ƒç”¨è¯¥å¯¹è±¡å¦ä¸€ä¸ªsynchronizedæ–¹æ³•ï¼Œ<strong>ä¹Ÿå°±æ˜¯è¯´ä¸€ä¸ªçº¿ç¨‹å¾—åˆ°ä¸€ä¸ªå¯¹è±¡é”åå†æ¬¡è¯·æ±‚è¯¥å¯¹è±¡é”ï¼Œæ˜¯å…è®¸çš„ï¼Œè¿™å°±æ˜¯synchronizedçš„å¯é‡å…¥æ€§ã€‚</strong></p><p>synchronizedåº•å±‚æ˜¯åˆ©ç”¨<strong>è®¡ç®—æœºç³»ç»Ÿmutex Lockå®ç°çš„ã€‚æ¯ä¸€ä¸ªå¯é‡å…¥é”éƒ½ä¼šå…³è”ä¸€ä¸ªçº¿ç¨‹IDå’Œä¸€ä¸ªé”çŠ¶æ€statusã€‚</strong></p><p>å½“ä¸€ä¸ªçº¿ç¨‹è¯·æ±‚æ–¹æ³•æ—¶ï¼Œä¼šå»æ£€æŸ¥é”çŠ¶æ€ã€‚</p><ol><li>å¦‚æœé”çŠ¶æ€æ˜¯0ï¼Œä»£è¡¨è¯¥é”æ²¡æœ‰è¢«å ç”¨ï¼Œä½¿ç”¨CASæ“ä½œè·å–é”ï¼Œå°†çº¿ç¨‹IDæ›¿æ¢æˆè‡ªå·±çš„çº¿ç¨‹IDã€‚</li><li>å¦‚æœé”çŠ¶æ€ä¸æ˜¯0ï¼Œä»£è¡¨æœ‰çº¿ç¨‹åœ¨è®¿é—®è¯¥æ–¹æ³•ã€‚æ­¤<strong>æ—¶ï¼Œå¦‚æœçº¿ç¨‹IDæ˜¯è‡ªå·±çš„çº¿ç¨‹IDï¼Œå¦‚æœæ˜¯å¯é‡å…¥é”ï¼Œä¼šå°†statusè‡ªå¢1ï¼Œç„¶åè·å–åˆ°è¯¥é”ï¼Œè¿›è€Œæ‰§è¡Œç›¸åº”çš„æ–¹æ³•ï¼›å¦‚æœæ˜¯éé‡å…¥é”ï¼Œå°±ä¼šè¿›å…¥é˜»å¡é˜Ÿåˆ—ç­‰å¾…ã€‚</strong></li></ol><p>åœ¨é‡Šæ”¾é”æ—¶ï¼Œ</p><ol><li>å¦‚æœæ˜¯å¯é‡å…¥é”çš„ï¼Œæ¯ä¸€æ¬¡é€€å‡ºæ–¹æ³•ï¼Œå°±ä¼šå°†statuså‡1ï¼Œç›´è‡³statusçš„å€¼ä¸º0ï¼Œæœ€åé‡Šæ”¾è¯¥é”ã€‚</li><li>å¦‚æœéå¯é‡å…¥é”çš„ï¼Œçº¿ç¨‹é€€å‡ºæ–¹æ³•ï¼Œç›´æ¥å°±ä¼šé‡Šæ”¾è¯¥é”ã€‚</li></ol><h2 id="13-syncronizedé”å‡çº§çš„è¿‡ç¨‹è®²ä¸€ä¸‹"><a href="#13-syncronizedé”å‡çº§çš„è¿‡ç¨‹è®²ä¸€ä¸‹" class="headerlink" title="13.syncronizedé”å‡çº§çš„è¿‡ç¨‹è®²ä¸€ä¸‹"></a>13.syncronizedé”å‡çº§çš„è¿‡ç¨‹è®²ä¸€ä¸‹</h2><p>å…·ä½“çš„é”å‡çº§çš„è¿‡ç¨‹æ˜¯ï¼š<strong>æ— é”-&gt;åå‘é”-&gt;è½»é‡çº§é”-&gt;é‡é‡çº§é”</strong>ã€‚</p><ul><li><strong>æ— é”</strong>ï¼šè¿™æ˜¯æ²¡æœ‰å¼€å¯åå‘é”çš„æ—¶å€™çš„çŠ¶æ€ï¼Œåœ¨JDK1.6ä¹‹ååå‘é”çš„é»˜è®¤å¼€å¯çš„ï¼Œä½†æ˜¯æœ‰ä¸€ä¸ªåå‘å»¶è¿Ÿï¼Œéœ€è¦åœ¨JVMå¯åŠ¨ä¹‹åçš„å¤šå°‘ç§’ä¹‹åæ‰èƒ½å¼€å¯ï¼Œè¿™ä¸ªå¯ä»¥é€šè¿‡JVMå‚æ•°è¿›è¡Œè®¾ç½®ï¼ŒåŒæ—¶æ˜¯å¦å¼€å¯åå‘é”ä¹Ÿå¯ä»¥é€šè¿‡JVMå‚æ•°è®¾ç½®ã€‚</li><li><strong>åå‘é”</strong>ï¼šè¿™ä¸ªæ˜¯åœ¨åå‘é”å¼€å¯ä¹‹åçš„é”çš„çŠ¶æ€ï¼Œå¦‚æœè¿˜æ²¡æœ‰ä¸€ä¸ªçº¿ç¨‹æ‹¿åˆ°è¿™ä¸ªé”çš„è¯ï¼Œè¿™ä¸ªçŠ¶æ€å«åšåŒ¿ååå‘ï¼Œå½“ä¸€ä¸ªçº¿ç¨‹æ‹¿åˆ°åå‘é”çš„æ—¶å€™ï¼Œä¸‹æ¬¡æƒ³è¦ç«äº‰é”åªéœ€è¦æ‹¿çº¿ç¨‹IDè·ŸMarkWordå½“ä¸­å­˜å‚¨çš„çº¿ç¨‹IDè¿›è¡Œæ¯”è¾ƒï¼Œå¦‚æœçº¿ç¨‹IDç›¸åŒåˆ™ç›´æ¥è·å–é”ï¼ˆç›¸å½“äºé”åå‘äºè¿™ä¸ªçº¿ç¨‹ï¼‰ï¼Œä¸éœ€è¦è¿›è¡ŒCASæ“ä½œå’Œå°†çº¿ç¨‹æŒ‚èµ·çš„æ“ä½œã€‚</li><li><strong>è½»é‡çº§é”</strong>ï¼šåœ¨è¿™ä¸ªçŠ¶æ€ä¸‹çº¿ç¨‹ä¸»è¦æ˜¯é€šè¿‡CASæ“ä½œå®ç°çš„ã€‚å°†å¯¹è±¡çš„MarkWordå­˜å‚¨åˆ°çº¿ç¨‹çš„è™šæ‹Ÿæœºæ ˆä¸Šï¼Œç„¶åé€šè¿‡CASå°†å¯¹è±¡çš„MarkWordçš„å†…å®¹è®¾ç½®ä¸ºæŒ‡å‘Displaced Mark Wordçš„æŒ‡é’ˆï¼Œå¦‚æœè®¾ç½®æˆåŠŸåˆ™è·å–é”ã€‚åœ¨çº¿ç¨‹å‡ºä¸´ç•ŒåŒºçš„æ—¶å€™ï¼Œä¹Ÿéœ€è¦ä½¿ç”¨CASï¼Œå¦‚æœä½¿ç”¨CASæ›¿æ¢æˆåŠŸåˆ™åŒæ­¥æˆåŠŸï¼Œå¦‚æœå¤±è´¥è¡¨ç¤ºæœ‰å…¶ä»–çº¿ç¨‹åœ¨è·å–é”ï¼Œé‚£ä¹ˆå°±éœ€è¦åœ¨é‡Šæ”¾é”ä¹‹åå°†è¢«æŒ‚èµ·çš„çº¿ç¨‹å”¤é†’ã€‚</li><li><strong>é‡é‡çº§é”</strong>ï¼š<strong>å½“æœ‰ä¸¤ä¸ªä»¥ä¸Šçš„çº¿ç¨‹è·å–é”çš„æ—¶å€™è½»é‡çº§é”å°±ä¼šå‡çº§ä¸ºé‡é‡çº§é”</strong>ï¼Œå› ä¸ºCASå¦‚æœæ²¡æœ‰æˆåŠŸçš„è¯å§‹ç»ˆéƒ½åœ¨è‡ªæ—‹ï¼Œè¿›è¡Œwhileå¾ªç¯æ“ä½œï¼Œè¿™æ˜¯éå¸¸æ¶ˆè€—CPUçš„ï¼Œä½†æ˜¯åœ¨å‡çº§ä¸ºé‡é‡çº§é”ä¹‹åï¼Œçº¿ç¨‹ä¼šè¢«æ“ä½œç³»ç»Ÿè°ƒåº¦ç„¶åæŒ‚èµ·ï¼Œè¿™å¯ä»¥èŠ‚çº¦CPUèµ„æºã€‚</li></ul><p>äº†è§£å®Œ 4 ç§é”çŠ¶æ€ä¹‹åï¼Œæˆ‘ä»¬å°±å¯ä»¥æ•´ä½“çš„æ¥çœ‹ä¸€ä¸‹é”å‡çº§çš„è¿‡ç¨‹äº†ã€‚ <img src="https://cdn.xiaolincoding.com//picgo/1721808326210-cce43537-20e7-4b7d-bed3-737dc7904d9a.png" alt="image.png"> çº¿ç¨‹Aè¿›å…¥ synchronized å¼€å§‹æŠ¢é”ï¼ŒJVM ä¼šåˆ¤æ–­å½“å‰æ˜¯å¦æ˜¯åå‘é”çš„çŠ¶æ€ï¼Œå¦‚æœæ˜¯å°±ä¼šæ ¹æ® Mark Word ä¸­å­˜å‚¨çš„çº¿ç¨‹ ID æ¥åˆ¤æ–­ï¼Œå½“å‰çº¿ç¨‹Aæ˜¯å¦å°±æ˜¯æŒæœ‰åå‘é”çš„çº¿ç¨‹ã€‚å¦‚æœæ˜¯ï¼Œåˆ™å¿½ç•¥ checkï¼Œçº¿ç¨‹Aç›´æ¥æ‰§è¡Œä¸´ç•ŒåŒºå†…çš„ä»£ç ã€‚</p><p>ä½†å¦‚æœ Mark Word é‡Œçš„çº¿ç¨‹ä¸æ˜¯çº¿ç¨‹ Aï¼Œå°±ä¼šé€šè¿‡è‡ªæ—‹å°è¯•è·å–é”ï¼Œå¦‚æœè·å–åˆ°äº†ï¼Œå°±å°† Mark Word ä¸­çš„çº¿ç¨‹ ID æ”¹ä¸ºè‡ªå·±çš„;å¦‚æœç«äº‰å¤±è´¥ï¼Œå°±ä¼šç«‹é©¬æ’¤é”€åå‘é”ï¼Œè†¨èƒ€ä¸ºè½»é‡çº§é”ã€‚</p><p>åç»­çš„ç«äº‰çº¿ç¨‹éƒ½ä¼šé€šè¿‡è‡ªæ—‹æ¥å°è¯•è·å–é”ï¼Œå¦‚æœè‡ªæ—‹æˆåŠŸé‚£ä¹ˆé”çš„çŠ¶æ€ä»ç„¶æ˜¯è½»é‡çº§é”ã€‚ç„¶è€Œå¦‚æœç«äº‰å¤±è´¥ï¼Œé”ä¼šè†¨èƒ€ä¸ºé‡é‡çº§é”ï¼Œåç»­ç­‰å¾…çš„ç«äº‰çš„çº¿ç¨‹éƒ½ä¼šè¢«é˜»å¡ã€‚</p><h2 id="14-JVMå¯¹Synchornizedçš„ä¼˜åŒ–ï¼Ÿ"><a href="#14-JVMå¯¹Synchornizedçš„ä¼˜åŒ–ï¼Ÿ" class="headerlink" title="14.JVMå¯¹Synchornizedçš„ä¼˜åŒ–ï¼Ÿ"></a>14.JVMå¯¹Synchornizedçš„ä¼˜åŒ–ï¼Ÿ</h2><p>synchronized æ ¸å¿ƒä¼˜åŒ–æ–¹æ¡ˆä¸»è¦åŒ…å«ä»¥ä¸‹ 4 ä¸ªï¼š</p><ul><li><strong>é”è†¨èƒ€</strong>ï¼šsynchronized ä»æ— é”å‡çº§åˆ°åå‘é”ï¼Œå†åˆ°è½»é‡çº§é”ï¼Œæœ€ååˆ°é‡é‡çº§é”çš„è¿‡ç¨‹ï¼Œå®ƒå«åšé”è†¨èƒ€ä¹Ÿå«åšé”å‡çº§ã€‚JDK 1.6 ä¹‹å‰ï¼Œsynchronized æ˜¯é‡é‡çº§é”ï¼Œä¹Ÿå°±æ˜¯è¯´ synchronized åœ¨é‡Šæ”¾å’Œè·å–é”æ—¶éƒ½ä¼šä»ç”¨æˆ·æ€è½¬æ¢æˆå†…æ ¸æ€ï¼Œè€Œè½¬æ¢çš„æ•ˆç‡æ˜¯æ¯”è¾ƒä½çš„ã€‚ä½†æœ‰äº†é”è†¨èƒ€æœºåˆ¶ä¹‹åï¼Œsynchronized çš„çŠ¶æ€å°±å¤šäº†æ— é”ã€åå‘é”ä»¥åŠè½»é‡çº§é”äº†ï¼Œè¿™æ—¶å€™åœ¨è¿›è¡Œå¹¶å‘æ“ä½œæ—¶ï¼Œ<strong>å¤§éƒ¨åˆ†çš„åœºæ™¯éƒ½ä¸éœ€è¦ç”¨æˆ·æ€åˆ°å†…æ ¸æ€çš„è½¬æ¢äº†</strong>ï¼Œè¿™æ ·å°±å¤§å¹…çš„æå‡äº† synchronized çš„æ€§èƒ½ã€‚</li><li><strong>é”æ¶ˆé™¤</strong>ï¼šæŒ‡çš„æ˜¯åœ¨æŸäº›æƒ…å†µä¸‹ï¼ŒJVM è™šæ‹Ÿæœºå¦‚æœ<strong>æ£€æµ‹ä¸åˆ°æŸæ®µä»£ç è¢«å…±äº«å’Œç«äº‰çš„å¯èƒ½æ€§ï¼Œå°±ä¼šå°†è¿™æ®µä»£ç æ‰€å±çš„åŒæ­¥é”æ¶ˆé™¤æ‰</strong>ï¼Œä»è€Œåˆ°åº•æé«˜ç¨‹åºæ€§èƒ½çš„ç›®çš„ã€‚</li><li><strong>é”ç²—åŒ–</strong>ï¼šå°†å¤šä¸ªè¿ç»­çš„åŠ é”ã€è§£é”æ“ä½œè¿æ¥åœ¨ä¸€èµ·ï¼Œæ‰©å±•æˆä¸€ä¸ªèŒƒå›´æ›´å¤§çš„é”ã€‚</li><li><strong>è‡ªé€‚åº”è‡ªæ—‹é”</strong>ï¼šæŒ‡é€šè¿‡è‡ªèº«å¾ªç¯ï¼Œå°è¯•è·å–é”çš„ä¸€ç§æ–¹å¼ï¼Œä¼˜ç‚¹åœ¨äºå®ƒ<strong>é¿å…ä¸€äº›çº¿ç¨‹çš„æŒ‚èµ·å’Œæ¢å¤æ“ä½œ</strong>ï¼Œå› ä¸ºæŒ‚èµ·çº¿ç¨‹å’Œæ¢å¤çº¿ç¨‹éƒ½éœ€è¦ä»ç”¨æˆ·æ€è½¬å…¥å†…æ ¸æ€ï¼Œè¿™ä¸ªè¿‡ç¨‹æ˜¯æ¯”è¾ƒæ…¢çš„ï¼Œæ‰€ä»¥é€šè¿‡è‡ªæ—‹çš„æ–¹å¼å¯ä»¥ä¸€å®šç¨‹åº¦ä¸Šé¿å…çº¿ç¨‹æŒ‚èµ·å’Œæ¢å¤æ‰€é€ æˆçš„æ€§èƒ½å¼€é”€ã€‚</li></ul><h2 id="15-ä»‹ç»ä¸€ä¸‹AQS"><a href="#15-ä»‹ç»ä¸€ä¸‹AQS" class="headerlink" title="15.ä»‹ç»ä¸€ä¸‹AQS"></a>15.ä»‹ç»ä¸€ä¸‹AQS</h2><p>AQSå…¨ç§°ä¸ºAbstractQueuedSynchronizerï¼Œæ˜¯Javaä¸­çš„ä¸€ä¸ªæŠ½è±¡ç±»ã€‚ AQSæ˜¯ä¸€ä¸ªç”¨äºæ„å»ºé”ã€åŒæ­¥å™¨ã€åä½œå·¥å…·ç±»çš„å·¥å…·ç±»ï¼ˆæ¡†æ¶ï¼‰ã€‚</p><p>AQSæ ¸å¿ƒæ€æƒ³æ˜¯ï¼Œ<strong>å¦‚æœè¢«è¯·æ±‚çš„å…±äº«èµ„æºç©ºé—²ï¼Œé‚£ä¹ˆå°±å°†å½“å‰è¯·æ±‚èµ„æºçš„çº¿ç¨‹è®¾ç½®ä¸ºæœ‰æ•ˆçš„å·¥ä½œçº¿ç¨‹ï¼Œå°†å…±äº«èµ„æºè®¾ç½®ä¸ºé”å®šçŠ¶æ€ï¼›å¦‚æœå…±äº«èµ„æºè¢«å ç”¨ï¼Œå°±éœ€è¦ä¸€å®šçš„é˜»å¡ç­‰å¾…å”¤é†’æœºåˆ¶æ¥ä¿è¯é”åˆ†é…ã€‚</strong>è¿™ä¸ªæœºåˆ¶ä¸»è¦ç”¨çš„æ˜¯CLHé˜Ÿåˆ—çš„å˜ä½“å®ç°çš„ï¼Œå°†æš‚æ—¶è·å–ä¸åˆ°é”çš„çº¿ç¨‹åŠ å…¥åˆ°é˜Ÿåˆ—ä¸­ã€‚</p><p>CLHï¼šCraigã€Landin and Hagerstené˜Ÿåˆ—ï¼Œæ˜¯å•å‘é“¾è¡¨ï¼ŒAQSä¸­çš„é˜Ÿåˆ—æ˜¯CLHå˜ä½“çš„è™šæ‹ŸåŒå‘é˜Ÿåˆ—ï¼ˆFIFOï¼‰ï¼ŒAQSæ˜¯é€šè¿‡å°†æ¯æ¡è¯·æ±‚å…±äº«èµ„æºçš„çº¿ç¨‹å°è£…æˆä¸€ä¸ªèŠ‚ç‚¹æ¥å®ç°é”çš„åˆ†é…ã€‚</p><p>ä¸»è¦åŸç†å›¾å¦‚ä¸‹ï¼š <img src="https://cdn.xiaolincoding.com//picgo/1721809581196-7c09ce04-1429-4810-ade4-bb3098a9303d.png" alt="image.png"></p><p>AQSä½¿ç”¨ä¸€ä¸ªVolatileçš„intç±»å‹çš„æˆå‘˜å˜é‡æ¥è¡¨ç¤ºåŒæ­¥çŠ¶æ€ï¼Œé€šè¿‡å†…ç½®çš„FIFOé˜Ÿåˆ—æ¥å®Œæˆèµ„æºè·å–çš„æ’é˜Ÿå·¥ä½œï¼Œé€šè¿‡CASå®Œæˆå¯¹Stateå€¼çš„ä¿®æ”¹ã€‚</p><p>AQSå¹¿æ³›ç”¨äºæ§åˆ¶å¹¶å‘æµç¨‹çš„ç±»ï¼Œå¦‚ä¸‹å›¾ï¼š</p><p><img src="https://cdn.xiaolincoding.com//picgo/1720958362111-45aa351b-c338-4eb8-8dad-da5e6f95a3c3.png" alt="img"></p><p>å…¶ä¸­<code>Sync</code>æ˜¯è¿™äº›ç±»ä¸­éƒ½æœ‰çš„å†…éƒ¨ç±»ï¼Œå…¶ç»“æ„å¦‚ä¸‹ï¼š</p><p><img src="https://cdn.xiaolincoding.com//picgo/1720958362187-35b5e5ef-04e0-44a6-b5f8-205f43df8847.png" alt="img"></p><p>å¯ä»¥çœ‹åˆ°ï¼š<code>Sync</code>æ˜¯<code>AQS</code>çš„å®ç°ã€‚ <code>AQS</code>ä¸»è¦å®Œæˆçš„ä»»åŠ¡ï¼š</p><ul><li>åŒæ­¥çŠ¶æ€ï¼ˆæ¯”å¦‚è¯´è®¡æ•°å™¨ï¼‰çš„åŸå­æ€§ç®¡ç†ï¼›</li><li>çº¿ç¨‹çš„é˜»å¡å’Œè§£é™¤é˜»å¡ï¼›</li><li>é˜Ÿåˆ—çš„ç®¡ç†ã€‚</li></ul><blockquote><p>AQSåŸç†</p></blockquote><p>AQSæœ€æ ¸å¿ƒçš„å°±æ˜¯ä¸‰å¤§éƒ¨åˆ†ï¼š</p><ul><li>çŠ¶æ€ï¼šstateï¼›</li><li>æ§åˆ¶çº¿ç¨‹æŠ¢é”å’Œé…åˆçš„FIFOé˜Ÿåˆ—ï¼ˆåŒå‘é“¾è¡¨ï¼‰ï¼›</li><li>æœŸæœ›åä½œå·¥å…·ç±»å»å®ç°çš„è·å–/é‡Šæ”¾ç­‰é‡è¦æ–¹æ³•ï¼ˆé‡å†™ï¼‰ã€‚</li></ul><p><strong>çŠ¶æ€state</strong></p><ul><li>è¿™é‡Œstateçš„å…·ä½“å«ä¹‰ï¼Œä¼šæ ¹æ®å…·ä½“å®ç°ç±»çš„ä¸åŒè€Œä¸åŒï¼šæ¯”å¦‚åœ¨Semaporeé‡Œï¼Œä»–è¡¨ç¤ºå‰©ä½™è®¸å¯è¯çš„æ•°é‡ï¼›åœ¨CountDownLatché‡Œï¼Œå®ƒè¡¨ç¤ºè¿˜éœ€è¦å€’æ•°çš„æ•°é‡ï¼›åœ¨ReentrantLockä¸­ï¼Œstateç”¨æ¥è¡¨ç¤ºâ€œé”â€çš„å æœ‰æƒ…å†µï¼Œ<strong>åŒ…æ‹¬å¯é‡å…¥è®¡æ•°ï¼Œå½“stateçš„å€¼ä¸º0çš„æ—¶å€™ï¼Œæ ‡è¯†è¯¥Lockä¸è¢«ä»»ä½•çº¿ç¨‹æ‰€å æœ‰ã€‚</strong></li><li><strong>stateæ˜¯volatileä¿®é¥°çš„ï¼Œå¹¶è¢«å¹¶å‘ä¿®æ”¹</strong>ï¼Œæ‰€ä»¥ä¿®æ”¹stateçš„æ–¹æ³•éƒ½éœ€è¦ä¿è¯çº¿ç¨‹å®‰å…¨ï¼Œæ¯”å¦‚getStateã€setStateä»¥åŠcompareAndSetStateæ“ä½œæ¥è¯»å–å’Œæ›´æ–°è¿™ä¸ªçŠ¶æ€ã€‚è¿™äº›æ–¹æ³•éƒ½ä¾èµ–äºunsafeç±»ã€‚</li></ul><p><strong>FIFOé˜Ÿåˆ—</strong></p><ul><li>è¿™ä¸ªé˜Ÿåˆ—ç”¨æ¥å­˜æ”¾â€œç­‰å¾…çš„çº¿ç¨‹ï¼ŒAQSå°±æ˜¯â€œæ’é˜Ÿç®¡ç†å™¨â€ï¼Œ<strong>å½“å¤šä¸ªçº¿ç¨‹äº‰ç”¨åŒä¸€æŠŠé”æ—¶ï¼Œå¿…é¡»æœ‰æ’é˜Ÿæœºåˆ¶å°†é‚£äº›æ²¡èƒ½æ‹¿åˆ°é”çš„çº¿ç¨‹ä¸²åœ¨ä¸€èµ·ã€‚å½“é”é‡Šæ”¾æ—¶ï¼Œé”ç®¡ç†å™¨å°±ä¼šæŒ‘é€‰ä¸€ä¸ªåˆé€‚çš„çº¿ç¨‹æ¥å æœ‰è¿™ä¸ªåˆšåˆšé‡Šæ”¾çš„é”ã€‚</strong></li><li>AQSä¼šç»´æŠ¤ä¸€ä¸ªç­‰å¾…çš„çº¿ç¨‹é˜Ÿåˆ—ï¼ŒæŠŠçº¿ç¨‹éƒ½æ”¾åˆ°è¿™ä¸ªé˜Ÿåˆ—é‡Œï¼Œè¿™ä¸ªé˜Ÿåˆ—æ˜¯åŒå‘é“¾è¡¨å½¢å¼ã€‚</li></ul><p><strong>å®ç°è·å–/é‡Šæ”¾ç­‰æ–¹æ³•</strong></p><ul><li>è¿™é‡Œçš„è·å–å’Œé‡Šæ”¾æ–¹æ³•ï¼Œæ˜¯åˆ©ç”¨AQSçš„åä½œå·¥å…·ç±»é‡Œæœ€é‡è¦çš„æ–¹æ³•ï¼Œæ˜¯ç”±åä½œç±»è‡ªå·±å»å®ç°çš„ï¼Œå¹¶ä¸”å«ä¹‰å„ä¸ç›¸åŒï¼›</li><li>è·å–æ–¹æ³•ï¼šè·å–æ“ä½œä¼šä»¥æ¥stateå˜é‡ï¼Œç»å¸¸ä¼šé˜»å¡ï¼ˆæ¯”å¦‚è·å–ä¸åˆ°é”çš„æ—¶å€™ï¼‰ã€‚åœ¨Semaphoreä¸­ï¼Œè·å–å°±æ˜¯acquireæ–¹æ³•ï¼Œä½œç”¨æ˜¯è·å–ä¸€ä¸ªè®¸å¯è¯ï¼› è€Œåœ¨CountDownLatché‡Œé¢ï¼Œè·å–å°±æ˜¯awaitæ–¹æ³•ï¼Œä½œç”¨æ˜¯ç­‰å¾…ï¼Œç›´åˆ°å€’æ•°ç»“æŸï¼›</li><li>é‡Šæ”¾æ–¹æ³•ï¼šåœ¨Semaphoreä¸­ï¼Œé‡Šæ”¾å°±æ˜¯releaseæ–¹æ³•ï¼Œä½œç”¨æ˜¯é‡Šæ”¾ä¸€ä¸ªè®¸å¯è¯ï¼› åœ¨CountDownLatché‡Œé¢ï¼Œè·å–å°±æ˜¯countDownæ–¹æ³•ï¼Œä½œç”¨æ˜¯å°†å€’æ•°çš„æ•°å‡ä¸€ï¼›</li><li><strong>éœ€è¦æ¯ä¸ªå®ç°ç±»é‡å†™tryAcquireå’ŒtryReleaseç­‰æ–¹æ³•ã€‚</strong></li></ul><h2 id="16-CAS-å’Œ-AQS-æœ‰ä»€ä¹ˆå…³ç³»ï¼Ÿ"><a href="#16-CAS-å’Œ-AQS-æœ‰ä»€ä¹ˆå…³ç³»ï¼Ÿ" class="headerlink" title="16.CAS å’Œ AQS æœ‰ä»€ä¹ˆå…³ç³»ï¼Ÿ"></a>16.CAS å’Œ AQS æœ‰ä»€ä¹ˆå…³ç³»ï¼Ÿ</h2><p>CAS å’Œ AQS ä¸¤è€…çš„åŒºåˆ«ï¼š</p><ul><li>CAS æ˜¯ä¸€ç§<strong>ä¹è§‚é”æœºåˆ¶</strong>ï¼Œå®ƒåŒ…å«ä¸‰ä¸ªæ“ä½œæ•°ï¼šå†…å­˜ä½ç½®ï¼ˆVï¼‰ã€é¢„æœŸå€¼ï¼ˆAï¼‰å’Œæ–°å€¼ï¼ˆBï¼‰ã€‚CAS æ“ä½œçš„é€»è¾‘æ˜¯ï¼Œå¦‚æœå†…å­˜ä½ç½® V çš„å€¼ç­‰äºé¢„æœŸå€¼ Aï¼Œåˆ™å°†å…¶æ›´æ–°ä¸ºæ–°å€¼ Bï¼Œå¦åˆ™ä¸åšä»»ä½•æ“ä½œã€‚æ•´ä¸ªè¿‡ç¨‹æ˜¯åŸå­æ€§çš„ï¼Œé€šå¸¸ç”±ç¡¬ä»¶æŒ‡ä»¤æ”¯æŒï¼Œå¦‚åœ¨ç°ä»£å¤„ç†å™¨ä¸Šï¼Œ<code>cmpxchg</code> æŒ‡ä»¤å¯ä»¥å®ç° CAS æ“ä½œã€‚</li><li>AQS æ˜¯ä¸€ä¸ªç”¨äº<strong>æ„å»ºé”å’ŒåŒæ­¥å™¨çš„æ¡†æ¶</strong>ï¼Œè®¸å¤šåŒæ­¥å™¨å¦‚ <code>ReentrantLock</code>ã€<code>Semaphore</code>ã€<code>CountDownLatch</code> ç­‰éƒ½æ˜¯åŸºäº AQS æ„å»ºçš„ã€‚AQS ä½¿ç”¨ä¸€ä¸ª <code>volatile</code> çš„æ•´æ•°å˜é‡ <code>state</code> æ¥è¡¨ç¤ºåŒæ­¥çŠ¶æ€ï¼Œé€šè¿‡å†…ç½®çš„ <code>FIFO</code> é˜Ÿåˆ—æ¥ç®¡ç†ç­‰å¾…çº¿ç¨‹ã€‚å®ƒæä¾›äº†ä¸€äº›åŸºæœ¬çš„æ“ä½œï¼Œå¦‚ <code>acquire</code>ï¼ˆè·å–èµ„æºï¼‰å’Œ <code>release</code>ï¼ˆé‡Šæ”¾èµ„æºï¼‰ï¼Œè¿™äº›æ“ä½œä¼šä¿®æ”¹ <code>state</code> çš„å€¼ï¼Œå¹¶æ ¹æ® <code>state</code> çš„å€¼æ¥åˆ¤æ–­çº¿ç¨‹æ˜¯å¦å¯ä»¥è·å–æˆ–é‡Šæ”¾èµ„æºã€‚AQS çš„ <code>acquire</code> æ“ä½œé€šå¸¸ä¼šå…ˆå°è¯•è·å–èµ„æºï¼Œå¦‚æœå¤±è´¥ï¼Œçº¿ç¨‹å°†è¢«æ·»åŠ åˆ°ç­‰å¾…é˜Ÿåˆ—ä¸­ï¼Œå¹¶é˜»å¡ç­‰å¾…ã€‚<code>release</code> æ“ä½œä¼šé‡Šæ”¾èµ„æºï¼Œå¹¶å”¤é†’ç­‰å¾…é˜Ÿåˆ—ä¸­çš„çº¿ç¨‹ã€‚</li></ul><p>CAS å’Œ AQS ä¸¤è€…çš„è”ç³»ï¼š</p><ul><li><strong>CAS ä¸º AQS æä¾›åŸå­æ“ä½œæ”¯æŒ</strong>ï¼šAQS å†…éƒ¨ä½¿ç”¨ CAS æ“ä½œæ¥æ›´æ–° <code>state</code> å˜é‡ï¼Œä»¥å®ç°çº¿ç¨‹å®‰å…¨çš„çŠ¶æ€ä¿®æ”¹ã€‚åœ¨ <code>acquire</code> æ“ä½œä¸­ï¼Œå½“çº¿ç¨‹å°è¯•è·å–èµ„æºæ—¶ï¼Œä¼šä½¿ç”¨ CAS æ“ä½œå°è¯•å°† <code>state</code> ä»ä¸€ä¸ªå€¼æ›´æ–°ä¸ºå¦ä¸€ä¸ªå€¼ï¼Œå¦‚æœæ›´æ–°å¤±è´¥ï¼Œè¯´æ˜èµ„æºå·²è¢«å ç”¨ï¼Œçº¿ç¨‹ä¼šè¿›å…¥ç­‰å¾…é˜Ÿåˆ—ã€‚åœ¨ <code>release</code> æ“ä½œä¸­ï¼Œå½“çº¿ç¨‹é‡Šæ”¾èµ„æºæ—¶ï¼Œä¹Ÿä¼šä½¿ç”¨ CAS æ“ä½œå°† <code>state</code> æ¢å¤åˆ°ç›¸åº”çš„å€¼ï¼Œä»¥ä¿è¯çŠ¶æ€æ›´æ–°çš„åŸå­æ€§ã€‚</li></ul><h2 id="17-å¦‚ä½•ç”¨-AQS-å®ç°ä¸€ä¸ªå¯é‡å…¥çš„å…¬å¹³é”ï¼Ÿ"><a href="#17-å¦‚ä½•ç”¨-AQS-å®ç°ä¸€ä¸ªå¯é‡å…¥çš„å…¬å¹³é”ï¼Ÿ" class="headerlink" title="17.å¦‚ä½•ç”¨ AQS å®ç°ä¸€ä¸ªå¯é‡å…¥çš„å…¬å¹³é”ï¼Ÿ"></a>17.å¦‚ä½•ç”¨ AQS å®ç°ä¸€ä¸ªå¯é‡å…¥çš„å…¬å¹³é”ï¼Ÿ</h2><p>AQS å®ç°ä¸€ä¸ªå¯é‡å…¥çš„å…¬å¹³é”çš„è¯¦ç»†æ­¥éª¤ï¼š</p><ol><li><strong>ç»§æ‰¿ AbstractQueuedSynchronizer</strong>ï¼šåˆ›å»ºä¸€ä¸ªå†…éƒ¨ç±»ç»§æ‰¿è‡ª <code>AbstractQueuedSynchronizer</code>ï¼Œé‡å†™ <code>tryAcquire</code>ã€<code>tryRelease</code>ã€<code>isHeldExclusively</code> ç­‰æ–¹æ³•ï¼Œè¿™äº›æ–¹æ³•å°†ç”¨äºå®ç°é”çš„è·å–ã€é‡Šæ”¾å’Œåˆ¤æ–­é”æ˜¯å¦è¢«å½“å‰çº¿ç¨‹æŒæœ‰ã€‚</li><li><strong>å®ç°å¯é‡å…¥é€»è¾‘</strong>ï¼šåœ¨ <code>tryAcquire</code> æ–¹æ³•ä¸­ï¼Œæ£€æŸ¥å½“å‰çº¿ç¨‹æ˜¯å¦å·²ç»æŒæœ‰é”ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™å¢åŠ é”çš„æŒæœ‰æ¬¡æ•°ï¼ˆé€šè¿‡ <code>state</code> å˜é‡ï¼‰ï¼›å¦‚æœä¸æ˜¯ï¼Œå°è¯•ä½¿ç”¨ CASæ“ä½œæ¥è·å–é”ã€‚</li><li><strong>å®ç°å…¬å¹³æ€§</strong>ï¼šåœ¨ <code>tryAcquire</code> æ–¹æ³•ä¸­ï¼ŒæŒ‰ç…§é˜Ÿåˆ—é¡ºåºæ¥è·å–é”ï¼Œå³å…ˆæ£€æŸ¥ç­‰å¾…é˜Ÿåˆ—ä¸­æ˜¯å¦æœ‰çº¿ç¨‹åœ¨ç­‰å¾…ï¼Œå¦‚æœæœ‰ï¼Œå½“å‰çº¿ç¨‹å¿…é¡»è¿›å…¥é˜Ÿåˆ—ç­‰å¾…ï¼Œè€Œä¸æ˜¯ç›´æ¥ç«äº‰é”ã€‚</li><li><strong>åˆ›å»ºé”çš„å¤–éƒ¨ç±»</strong>ï¼šåˆ›å»ºä¸€ä¸ªå¤–éƒ¨ç±»ï¼Œå†…éƒ¨æŒæœ‰ <code>AbstractQueuedSynchronizer</code> çš„å­ç±»å¯¹è±¡ï¼Œå¹¶æä¾› <code>lock</code> å’Œ <code>unlock</code> æ–¹æ³•ï¼Œè¿™äº›æ–¹æ³•å°†è°ƒç”¨ <code>AbstractQueuedSynchronizer</code> å­ç±»ä¸­çš„æ–¹æ³•ã€‚</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.concurrent.locks.AbstractQueuedSynchronizer;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FairReentrantLock</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">class</span> <span class="title class_">Sync</span> <span class="keyword">extends</span> <span class="title class_">AbstractQueuedSynchronizer</span> &#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åˆ¤æ–­é”æ˜¯å¦è¢«å½“å‰çº¿ç¨‹æŒæœ‰</span></span><br><span class="line">        <span class="keyword">protected</span> <span class="type">boolean</span> <span class="title function_">isHeldExclusively</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> getExclusiveOwnerThread() == Thread.currentThread();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å°è¯•è·å–é”</span></span><br><span class="line">        <span class="keyword">protected</span> <span class="type">boolean</span> <span class="title function_">tryAcquire</span><span class="params">(<span class="type">int</span> acquires)</span> &#123;</span><br><span class="line">            <span class="keyword">final</span> <span class="type">Thread</span> <span class="variable">current</span> <span class="operator">=</span> Thread.currentThread();</span><br><span class="line">            <span class="type">int</span> <span class="variable">c</span> <span class="operator">=</span> getState();</span><br><span class="line">            <span class="keyword">if</span> (c == <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="comment">// å…¬å¹³æ€§æ£€æŸ¥ï¼šæ£€æŸ¥é˜Ÿåˆ—ä¸­æ˜¯å¦æœ‰å‰é©±èŠ‚ç‚¹ï¼Œå¦‚æœæœ‰ï¼Œåˆ™å½“å‰çº¿ç¨‹ä¸èƒ½è·å–é”</span></span><br><span class="line">                <span class="keyword">if</span> (!hasQueuedPredecessors() &amp;&amp; compareAndSetState(<span class="number">0</span>, acquires)) &#123;</span><br><span class="line">                    setExclusiveOwnerThread(current);</span><br><span class="line">                    <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> <span class="keyword">if</span> (current == getExclusiveOwnerThread()) &#123;</span><br><span class="line">                <span class="comment">// å¯é‡å…¥é€»è¾‘ï¼šå¦‚æœæ˜¯å½“å‰çº¿ç¨‹æŒæœ‰é”ï¼Œåˆ™å¢åŠ æŒæœ‰æ¬¡æ•°</span></span><br><span class="line">                <span class="type">int</span> <span class="variable">nextc</span> <span class="operator">=</span> c + acquires;</span><br><span class="line">                <span class="keyword">if</span> (nextc &lt; <span class="number">0</span>) &#123;</span><br><span class="line">                    <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">Error</span>(<span class="string">&quot;Maximum lock count exceeded&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                setState(nextc);</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å°è¯•é‡Šæ”¾é”</span></span><br><span class="line">        <span class="keyword">protected</span> <span class="type">boolean</span> <span class="title function_">tryRelease</span><span class="params">(<span class="type">int</span> releases)</span> &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">c</span> <span class="operator">=</span> getState() - releases;</span><br><span class="line">            <span class="keyword">if</span> (Thread.currentThread()!= getExclusiveOwnerThread()) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalMonitorStateException</span>();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="type">boolean</span> <span class="variable">free</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">            <span class="keyword">if</span> (c == <span class="number">0</span>) &#123;</span><br><span class="line">                free = <span class="literal">true</span>;</span><br><span class="line">                setExclusiveOwnerThread(<span class="literal">null</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            setState(c);</span><br><span class="line">            <span class="keyword">return</span> free;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æä¾›ä¸€ä¸ªæ¡ä»¶å˜é‡ï¼Œç”¨äºå®ç°æ›´å¤æ‚çš„åŒæ­¥éœ€æ±‚ï¼Œè¿™é‡Œåªæ˜¯ç®€å•å®ç°</span></span><br><span class="line">        ConditionObject <span class="title function_">newCondition</span><span class="params">()</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">ConditionObject</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">Sync</span> <span class="variable">sync</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Sync</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åŠ é”æ–¹æ³•</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">lock</span><span class="params">()</span> &#123;</span><br><span class="line">        sync.acquire(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è§£é”æ–¹æ³•</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">unlock</span><span class="params">()</span> &#123;</span><br><span class="line">        sync.release(<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ¤æ–­å½“å‰çº¿ç¨‹æ˜¯å¦æŒæœ‰é”</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isLocked</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> sync.isHeldExclusively();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æä¾›ä¸€ä¸ªæ¡ä»¶å˜é‡ï¼Œç”¨äºå®ç°æ›´å¤æ‚çš„åŒæ­¥éœ€æ±‚ï¼Œè¿™é‡Œåªæ˜¯ç®€å•å®ç°</span></span><br><span class="line">    <span class="keyword">public</span> Condition <span class="title function_">newCondition</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> sync.newCondition();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»£ç è§£é‡Šï¼š</p><p><strong>å†…éƒ¨ç±» Sync</strong>ï¼š</p><ul><li><code>isHeldExclusively</code>ï¼šä½¿ç”¨ <code>getExclusiveOwnerThread</code> æ–¹æ³•æ£€æŸ¥å½“å‰é”æ˜¯å¦è¢«å½“å‰çº¿ç¨‹æŒæœ‰ã€‚</li><li><code>tryAcquire</code>ï¼š<ul><li>é¦–å…ˆè·å–å½“å‰é”çš„çŠ¶æ€ <code>c</code>ã€‚</li><li>å¦‚æœ <code>c</code> ä¸º 0ï¼Œè¡¨ç¤ºé”æœªè¢«æŒæœ‰ï¼Œæ­¤æ—¶è¿›è¡Œå…¬å¹³æ€§æ£€æŸ¥ï¼Œé€šè¿‡ <code>hasQueuedPredecessors</code> æ£€æŸ¥æ˜¯å¦æœ‰å‰é©±èŠ‚ç‚¹åœ¨ç­‰å¾…é˜Ÿåˆ—ä¸­ã€‚å¦‚æœæ²¡æœ‰ï¼Œä½¿ç”¨ <code>compareAndSetState</code> å°è¯•å°†çŠ¶æ€è®¾ç½®ä¸º <code>acquires</code>ï¼ˆé€šå¸¸ä¸º 1ï¼‰ï¼Œå¹¶è®¾ç½®å½“å‰çº¿ç¨‹ä¸ºé”çš„æŒæœ‰çº¿ç¨‹ã€‚</li><li>å¦‚æœ <code>c</code> ä¸ä¸º 0ï¼Œè¯´æ˜é”å·²è¢«æŒæœ‰ï¼Œæ£€æŸ¥æ˜¯å¦ä¸ºå½“å‰çº¿ç¨‹æŒæœ‰ã€‚å¦‚æœæ˜¯ï¼Œå¢åŠ é”çš„æŒæœ‰æ¬¡æ•°ï¼ˆå¯é‡å…¥ï¼‰ï¼Œä½†è¦é˜²æ­¢æº¢å‡ºã€‚</li></ul></li><li><code>tryRelease</code>ï¼š<ul><li>å…ˆå°†çŠ¶æ€å‡ <code>releases</code>ï¼ˆé€šå¸¸ä¸º 1ï¼‰ã€‚</li><li>æ£€æŸ¥å½“å‰çº¿ç¨‹æ˜¯å¦ä¸ºé”çš„æŒæœ‰çº¿ç¨‹ï¼Œå¦‚æœä¸æ˜¯ï¼ŒæŠ›å‡ºå¼‚å¸¸ã€‚</li><li>å¦‚æœçŠ¶æ€å‡ä¸º 0ï¼Œè¯´æ˜é”è¢«å®Œå…¨é‡Šæ”¾ï¼Œå°†æŒæœ‰çº¿ç¨‹è®¾ä¸º <code>null</code>ã€‚</li></ul></li><li><code>newCondition</code>ï¼šåˆ›å»ºä¸€ä¸ª <code>ConditionObject</code> ç”¨äºæ›´å¤æ‚çš„åŒæ­¥æ“ä½œï¼Œå¦‚ç­‰å¾… / é€šçŸ¥æœºåˆ¶ã€‚</li></ul><p><strong>å¤–éƒ¨ç±» FairReentrantLock</strong>ï¼š</p><ul><li><code>lock</code> æ–¹æ³•ï¼šè°ƒç”¨ <code>sync.acquire(1)</code> å°è¯•è·å–é”ã€‚</li><li><code>unlock</code> æ–¹æ³•ï¼šè°ƒç”¨ <code>sync.release(1)</code> é‡Šæ”¾é”ã€‚</li><li><code>isLocked</code> æ–¹æ³•ï¼šè°ƒç”¨ <code>sync.isHeldExclusively</code> åˆ¤æ–­é”æ˜¯å¦è¢«å½“å‰çº¿ç¨‹æŒæœ‰ã€‚</li><li><code>newCondition</code> æ–¹æ³•ï¼šè°ƒç”¨ <code>sync.newCondition</code> æä¾›æ¡ä»¶å˜é‡ã€‚</li></ul><h2 id="18-Threadlocalä½œç”¨ï¼ŒåŸç†ï¼Œå…·ä½“é‡Œé¢å­˜çš„key-valueæ˜¯å•¥ï¼Œä¼šæœ‰ä»€ä¹ˆé—®é¢˜ï¼Œå¦‚ä½•è§£å†³"><a href="#18-Threadlocalä½œç”¨ï¼ŒåŸç†ï¼Œå…·ä½“é‡Œé¢å­˜çš„key-valueæ˜¯å•¥ï¼Œä¼šæœ‰ä»€ä¹ˆé—®é¢˜ï¼Œå¦‚ä½•è§£å†³" class="headerlink" title="18.Threadlocalä½œç”¨ï¼ŒåŸç†ï¼Œå…·ä½“é‡Œé¢å­˜çš„key valueæ˜¯å•¥ï¼Œä¼šæœ‰ä»€ä¹ˆé—®é¢˜ï¼Œå¦‚ä½•è§£å†³?"></a>18.Threadlocalä½œç”¨ï¼ŒåŸç†ï¼Œå…·ä½“é‡Œé¢å­˜çš„key valueæ˜¯å•¥ï¼Œä¼šæœ‰ä»€ä¹ˆé—®é¢˜ï¼Œå¦‚ä½•è§£å†³?</h2><p><code>ThreadLocal</code>æ˜¯Javaä¸­ç”¨äºè§£å†³çº¿ç¨‹å®‰å…¨é—®é¢˜çš„ä¸€ç§æœºåˆ¶ï¼Œå®ƒå…è®¸åˆ›å»ºçº¿ç¨‹å±€éƒ¨å˜é‡ï¼Œå³æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±ç‹¬ç«‹çš„å˜é‡å‰¯æœ¬ï¼Œä»è€Œé¿å…äº†çº¿ç¨‹é—´çš„èµ„æºå…±äº«å’ŒåŒæ­¥é—®é¢˜ã€‚</p><p><img src="https://cdn.xiaolincoding.com//picgo/1719982991053-c983c4b8-7c5f-4e2d-a90d-5b42ebd533d5.png" alt="img"></p><p>ä»å†…å­˜ç»“æ„å›¾ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼š</p><ul><li>Threadç±»ä¸­ï¼Œæœ‰ä¸ªThreadLocal.ThreadLocalMap çš„æˆå‘˜å˜é‡ã€‚</li><li>ThreadLocalMapå†…éƒ¨ç»´æŠ¤äº†Entryæ•°ç»„ï¼Œæ¯ä¸ªEntryä»£è¡¨ä¸€ä¸ªå®Œæ•´çš„å¯¹è±¡ï¼Œkey<strong>æ˜¯</strong>ThreadLocal<strong>æœ¬èº«</strong>ï¼Œvalueæ˜¯ThreadLocalçš„æ³›å‹å¯¹è±¡å€¼ã€‚</li></ul><blockquote><p>ThreadLocalçš„ä½œç”¨</p></blockquote><ul><li><strong>çº¿ç¨‹éš”ç¦»</strong>ï¼š<code>ThreadLocal</code>ä¸ºæ¯ä¸ªçº¿ç¨‹æä¾›äº†<strong>ç‹¬ç«‹çš„å˜é‡å‰¯æœ¬ï¼Œè¿™æ„å‘³ç€çº¿ç¨‹ä¹‹é—´ä¸ä¼šç›¸äº’å½±å“ï¼Œå¯ä»¥å®‰å…¨åœ°åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸­ä½¿ç”¨è¿™äº›å˜é‡è€Œä¸å¿…æ‹…å¿ƒæ•°æ®ç«äº‰æˆ–åŒæ­¥é—®é¢˜ã€‚</strong></li><li><strong>é™ä½è€¦åˆåº¦</strong>ï¼šåœ¨åŒä¸€ä¸ªçº¿ç¨‹å†…çš„å¤šä¸ªå‡½æ•°æˆ–ç»„ä»¶ä¹‹é—´ï¼Œä½¿ç”¨<code>ThreadLocal</code>å¯ä»¥å‡å°‘å‚æ•°çš„ä¼ é€’ï¼Œé™ä½ä»£ç ä¹‹é—´çš„è€¦åˆåº¦ï¼Œä½¿ä»£ç æ›´åŠ æ¸…æ™°å’Œæ¨¡å—åŒ–ã€‚</li><li><strong>æ€§èƒ½ä¼˜åŠ¿</strong>ï¼šç”±äº<code>ThreadLocal</code>é¿å…äº†çº¿ç¨‹é—´çš„åŒæ­¥å¼€é”€ï¼Œæ‰€ä»¥åœ¨å¤§é‡çº¿ç¨‹å¹¶å‘æ‰§è¡Œæ—¶ï¼Œç›¸æ¯”ä¼ ç»Ÿçš„é”æœºåˆ¶ï¼Œå®ƒå¯ä»¥æä¾›æ›´å¥½çš„æ€§èƒ½ã€‚</li></ul><blockquote><p>ThreadLocalçš„åŸç†</p></blockquote><p><code>ThreadLocal</code>çš„å®ç°ä¾èµ–äº<code>Thread</code>ç±»ä¸­çš„ä¸€ä¸ª<code>ThreadLocalMap</code>å­—æ®µï¼Œè¿™æ˜¯ä¸€ä¸ªå­˜å‚¨<code>ThreadLocal</code>å˜é‡æœ¬èº«å’Œå¯¹åº”å€¼çš„æ˜ å°„ã€‚æ¯ä¸ªçº¿ç¨‹éƒ½æœ‰è‡ªå·±çš„<code>ThreadLocalMap</code>å®ä¾‹ï¼Œç”¨äºå­˜å‚¨è¯¥çº¿ç¨‹æ‰€æŒæœ‰çš„æ‰€æœ‰<code>ThreadLocal</code>å˜é‡çš„å€¼ã€‚</p><p>å½“ä½ åˆ›å»ºä¸€ä¸ª<code>ThreadLocal</code>å˜é‡æ—¶ï¼Œå®ƒå®é™…ä¸Šå°±æ˜¯ä¸€ä¸ª<code>ThreadLocal</code>å¯¹è±¡çš„å®ä¾‹ã€‚æ¯ä¸ª<code>ThreadLocal</code>å¯¹è±¡éƒ½å¯ä»¥å­˜å‚¨ä»»æ„ç±»å‹çš„å€¼ï¼Œè¿™ä¸ªå€¼å¯¹æ¯ä¸ªçº¿ç¨‹æ¥è¯´æ˜¯ç‹¬ç«‹çš„ã€‚</p><ul><li>å½“è°ƒç”¨<code>ThreadLocal</code>çš„<code>get()</code>æ–¹æ³•æ—¶ï¼Œ<code>ThreadLocal</code>ä¼šæ£€æŸ¥å½“å‰çº¿ç¨‹çš„<code>ThreadLocalMap</code>ä¸­æ˜¯å¦æœ‰ä¸ä¹‹å…³è”çš„å€¼ã€‚</li><li>å¦‚æœæœ‰ï¼Œè¿”å›è¯¥å€¼ï¼›</li><li>å¦‚æœæ²¡æœ‰ï¼Œä¼šè°ƒç”¨<code>initialValue()</code>æ–¹æ³•ï¼ˆå¦‚æœé‡å†™äº†çš„è¯ï¼‰æ¥åˆå§‹åŒ–è¯¥å€¼ï¼Œç„¶åå°†å…¶æ”¾å…¥<code>ThreadLocalMap</code>ä¸­å¹¶è¿”å›ã€‚</li><li>å½“è°ƒç”¨<code>set()</code>æ–¹æ³•æ—¶ï¼Œ<code>ThreadLocal</code>ä¼šå°†ç»™å®šçš„å€¼ä¸å½“å‰çº¿ç¨‹å…³è”èµ·æ¥ï¼Œå³åœ¨å½“å‰çº¿ç¨‹çš„<code>ThreadLocalMap</code>ä¸­å­˜å‚¨ä¸€ä¸ªé”®å€¼å¯¹ï¼Œé”®æ˜¯<code>ThreadLocal</code>å¯¹è±¡è‡ªèº«ï¼Œå€¼æ˜¯ä¼ å…¥çš„å€¼ã€‚</li><li>å½“è°ƒç”¨<code>remove()</code>æ–¹æ³•æ—¶ï¼Œä¼šä»å½“å‰çº¿ç¨‹çš„<code>ThreadLocalMap</code>ä¸­ç§»é™¤ä¸è¯¥<code>ThreadLocal</code>å¯¹è±¡å…³è”çš„æ¡ç›®ã€‚</li></ul><blockquote><p>å¯èƒ½å­˜åœ¨çš„é—®é¢˜</p></blockquote><p>å½“ä¸€ä¸ªçº¿ç¨‹ç»“æŸæ—¶ï¼Œå…¶<code>ThreadLocalMap</code>ä¹Ÿä¼šéšä¹‹é”€æ¯ï¼Œä½†æ˜¯<code>ThreadLocal</code>å¯¹è±¡æœ¬èº«ä¸ä¼šç«‹å³è¢«åƒåœ¾å›æ”¶ï¼Œç›´åˆ°æ²¡æœ‰å…¶ä»–å¼•ç”¨æŒ‡å‘å®ƒä¸ºæ­¢ã€‚</p><p>å› æ­¤ï¼Œåœ¨ä½¿ç”¨<code>ThreadLocal</code>æ—¶éœ€è¦æ³¨æ„ï¼Œ<strong>å¦‚æœä¸æ˜¾å¼è°ƒç”¨<code>remove()</code>æ–¹æ³•ï¼Œæˆ–è€…çº¿ç¨‹ç»“æŸæ—¶æœªæ­£ç¡®æ¸…ç†<code>ThreadLocal</code>å˜é‡ï¼Œå¯èƒ½ä¼šå¯¼è‡´å†…å­˜æ³„æ¼ï¼Œå› ä¸º<code>ThreadLocalMap</code>ä¼šæŒç»­æŒæœ‰<code>ThreadLocal</code>å˜é‡çš„å¼•ç”¨ï¼Œå³ä½¿è¿™äº›å˜é‡ä¸å†è¢«å…¶ä»–åœ°æ–¹å¼•ç”¨ã€‚</strong></p><p>å› æ­¤ï¼Œå®é™…åº”ç”¨ä¸­éœ€è¦åœ¨ä½¿ç”¨å®Œ<code>ThreadLocal</code>å˜é‡åè°ƒç”¨<code>remove()</code>æ–¹æ³•é‡Šæ”¾èµ„æºã€‚</p><h2 id="19-æ‚²è§‚é”å’Œä¹è§‚é”çš„åŒºåˆ«ï¼Ÿ"><a href="#19-æ‚²è§‚é”å’Œä¹è§‚é”çš„åŒºåˆ«ï¼Ÿ" class="headerlink" title="19.æ‚²è§‚é”å’Œä¹è§‚é”çš„åŒºåˆ«ï¼Ÿ"></a>19.æ‚²è§‚é”å’Œä¹è§‚é”çš„åŒºåˆ«ï¼Ÿ</h2><ul><li>ä¹è§‚é”ï¼š å°±åƒå®ƒçš„åå­—ä¸€æ ·ï¼Œå¯¹äºå¹¶å‘é—´æ“ä½œäº§ç”Ÿçš„çº¿ç¨‹å®‰å…¨é—®é¢˜æŒä¹è§‚çŠ¶æ€ï¼Œä¹è§‚é”è®¤ä¸ºç«äº‰ä¸æ€» æ˜¯ä¼šå‘ç”Ÿï¼Œ<strong>å› æ­¤å®ƒä¸éœ€è¦æŒæœ‰é”</strong>ï¼Œ<strong>å°†æ¯”è¾ƒ-æ›¿æ¢è¿™ä¸¤ä¸ªåŠ¨ä½œä½œä¸ºä¸€ä¸ªåŸå­æ“ä½œå°è¯•å»ä¿®æ”¹å†…å­˜ä¸­çš„å˜é‡ï¼Œå¦‚æœå¤±è´¥åˆ™è¡¨ç¤ºå‘ç”Ÿå†²çªï¼Œé‚£ä¹ˆå°±åº”è¯¥æœ‰ç›¸åº”çš„é‡è¯•é€»è¾‘ã€‚</strong></li><li>æ‚²è§‚é”ï¼š è¿˜æ˜¯åƒå®ƒçš„åå­—ä¸€æ ·ï¼Œå¯¹äºå¹¶å‘é—´æ“ä½œäº§ç”Ÿçš„çº¿ç¨‹å®‰å…¨é—®é¢˜æŒæ‚²è§‚çŠ¶æ€ï¼Œæ‚²è§‚é”è®¤ä¸ºç«äº‰æ€» æ˜¯ä¼šå‘ç”Ÿï¼Œ<strong>å› æ­¤æ¯æ¬¡å¯¹æŸèµ„æºè¿›è¡Œæ“ä½œæ—¶ï¼Œéƒ½ä¼šæŒæœ‰ä¸€ä¸ªç‹¬å çš„é”ï¼Œå°±åƒ synchronizedï¼Œä¸ç®¡ä¸‰ä¸ƒäºŒåä¸€ï¼Œç›´æ¥ä¸Šäº†é”å°±æ“ä½œèµ„æºäº†ã€‚</strong></li></ul><h2 id="20-Javaä¸­æƒ³å®ç°ä¸€ä¸ªä¹è§‚é”ï¼Œéƒ½æœ‰å“ªäº›æ–¹å¼ï¼Ÿ"><a href="#20-Javaä¸­æƒ³å®ç°ä¸€ä¸ªä¹è§‚é”ï¼Œéƒ½æœ‰å“ªäº›æ–¹å¼ï¼Ÿ" class="headerlink" title="20.Javaä¸­æƒ³å®ç°ä¸€ä¸ªä¹è§‚é”ï¼Œéƒ½æœ‰å“ªäº›æ–¹å¼ï¼Ÿ"></a>20.Javaä¸­æƒ³å®ç°ä¸€ä¸ªä¹è§‚é”ï¼Œéƒ½æœ‰å“ªäº›æ–¹å¼ï¼Ÿ</h2><ol><li><strong>CASï¼ˆCompare and Swapï¼‰æ“ä½œï¼š</strong> CAS æ˜¯ä¹è§‚é”çš„åŸºç¡€ã€‚Java æä¾›äº† java.util.concurrent.atomic åŒ…ï¼ŒåŒ…å«å„ç§åŸå­å˜é‡ç±»ï¼ˆå¦‚ AtomicIntegerã€AtomicLongï¼‰ï¼Œè¿™äº›ç±»ä½¿ç”¨ CAS æ“ä½œå®ç°äº†çº¿ç¨‹å®‰å…¨çš„åŸå­æ“ä½œï¼Œå¯ä»¥ç”¨æ¥å®ç°ä¹è§‚é”ã€‚</li><li><strong>ç‰ˆæœ¬å·æ§åˆ¶</strong>ï¼š<strong>å¢åŠ ä¸€ä¸ªç‰ˆæœ¬å·å­—æ®µè®°å½•æ•°æ®æ›´æ–°æ—¶å€™çš„ç‰ˆæœ¬</strong>ï¼Œæ¯æ¬¡æ›´æ–°æ—¶é€’å¢ç‰ˆæœ¬å·ã€‚åœ¨æ›´æ–°æ•°æ®æ—¶ï¼ŒåŒæ—¶æ¯”è¾ƒç‰ˆæœ¬å·ï¼Œè‹¥å½“å‰ç‰ˆæœ¬å·å’Œæ›´æ–°å‰è·å–çš„ç‰ˆæœ¬å·ä¸€è‡´ï¼Œåˆ™æ›´æ–°æˆåŠŸï¼Œå¦åˆ™å¤±è´¥ã€‚</li><li><strong>æ—¶é—´æˆ³</strong>ï¼šä½¿ç”¨æ—¶é—´æˆ³è®°å½•æ•°æ®çš„æ›´æ–°æ—¶é—´ï¼Œåœ¨æ›´æ–°æ•°æ®æ—¶ï¼Œåœ¨æ¯”è¾ƒæ—¶é—´æˆ³ã€‚å¦‚æœå½“å‰æ—¶é—´æˆ³å¤§äºæ•°æ®çš„æ—¶é—´æˆ³ï¼Œåˆ™è¯´æ˜æ•°æ®å·²ç»è¢«å…¶ä»–çº¿ç¨‹æ›´æ–°ï¼Œæ›´æ–°å¤±è´¥ã€‚</li></ol><h2 id="21-CAS-æœ‰ä»€ä¹ˆç¼ºç‚¹ï¼Ÿ"><a href="#21-CAS-æœ‰ä»€ä¹ˆç¼ºç‚¹ï¼Ÿ" class="headerlink" title="21.CAS æœ‰ä»€ä¹ˆç¼ºç‚¹ï¼Ÿ"></a>21.CAS æœ‰ä»€ä¹ˆç¼ºç‚¹ï¼Ÿ</h2><p>CASçš„ç¼ºç‚¹ä¸»è¦æœ‰3ç‚¹ï¼š</p><ul><li><strong>ABAé—®é¢˜</strong>ï¼šABAçš„é—®é¢˜æŒ‡çš„æ˜¯åœ¨CASæ›´æ–°çš„è¿‡ç¨‹ä¸­ï¼Œ<strong>å½“è¯»å–åˆ°çš„å€¼æ˜¯Aï¼Œç„¶åå‡†å¤‡èµ‹å€¼çš„æ—¶å€™ä»ç„¶æ˜¯Aï¼Œä½†æ˜¯å®é™…ä¸Šæœ‰å¯èƒ½Açš„å€¼è¢«æ”¹æˆäº†Bï¼Œç„¶ååˆè¢«æ”¹å›äº†A</strong>ï¼Œè¿™ä¸ªCASæ›´æ–°çš„æ¼æ´å°±å«åšABAã€‚åªæ˜¯ABAçš„é—®é¢˜å¤§éƒ¨åˆ†åœºæ™¯ä¸‹éƒ½ä¸å½±å“å¹¶å‘çš„æœ€ç»ˆæ•ˆæœã€‚Javaä¸­æœ‰<strong>AtomicStampedReference</strong>æ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œä»–åŠ å…¥äº†é¢„æœŸæ ‡å¿—å’Œæ›´æ–°åæ ‡å¿—ä¸¤ä¸ªå­—æ®µï¼Œæ›´æ–°æ—¶ä¸å…‰æ£€æŸ¥å€¼ï¼Œè¿˜è¦æ£€æŸ¥å½“å‰çš„æ ‡å¿—æ˜¯å¦ç­‰äºé¢„æœŸæ ‡å¿—ï¼Œå…¨éƒ¨ç›¸ç­‰çš„è¯æ‰ä¼šæ›´æ–°ã€‚</li><li><strong>å¾ªç¯æ—¶é—´é•¿å¼€é”€å¤§</strong>ï¼šè‡ªæ—‹CASçš„æ–¹å¼å¦‚æœé•¿æ—¶é—´ä¸æˆåŠŸï¼Œä¼šç»™CPUå¸¦æ¥å¾ˆå¤§çš„å¼€é”€ã€‚</li><li><strong>åªèƒ½ä¿è¯ä¸€ä¸ªå…±äº«å˜é‡çš„åŸå­æ“ä½œ</strong>ï¼šåªå¯¹ä¸€ä¸ªå…±äº«å˜é‡æ“ä½œå¯ä»¥ä¿è¯åŸå­æ€§ï¼Œä½†æ˜¯å¤šä¸ªåˆ™ä¸è¡Œï¼Œå¤šä¸ªå¯ä»¥é€šè¿‡AtomicReferenceæ¥å¤„ç†æˆ–è€…ä½¿ç”¨é”synchronizedå®ç°ã€‚</li></ul><h2 id="22-ä¸ºä»€ä¹ˆä¸èƒ½æ‰€æœ‰çš„é”éƒ½ç”¨CASï¼Ÿ"><a href="#22-ä¸ºä»€ä¹ˆä¸èƒ½æ‰€æœ‰çš„é”éƒ½ç”¨CASï¼Ÿ" class="headerlink" title="22.ä¸ºä»€ä¹ˆä¸èƒ½æ‰€æœ‰çš„é”éƒ½ç”¨CASï¼Ÿ"></a>22.ä¸ºä»€ä¹ˆä¸èƒ½æ‰€æœ‰çš„é”éƒ½ç”¨CASï¼Ÿ</h2><p>CASæ“ä½œæ˜¯åŸºäºå¾ªç¯é‡è¯•çš„æœºåˆ¶ï¼Œå¦‚æœCASæ“ä½œä¸€ç›´æœªèƒ½æˆåŠŸï¼Œçº¿ç¨‹ä¼šä¸€ç›´è‡ªæ—‹é‡è¯•ï¼Œå ç”¨CPUèµ„æºã€‚åœ¨é«˜å¹¶å‘æƒ…å†µä¸‹ï¼Œå¤§é‡çº¿ç¨‹è‡ªæ—‹ä¼šå¯¼è‡´CPUèµ„æºæµªè´¹ã€‚</p><h2 id="23-CAS-æœ‰ä»€ä¹ˆé—®é¢˜ï¼ŒJavaæ˜¯æ€ä¹ˆè§£å†³çš„ï¼Ÿ"><a href="#23-CAS-æœ‰ä»€ä¹ˆé—®é¢˜ï¼ŒJavaæ˜¯æ€ä¹ˆè§£å†³çš„ï¼Ÿ" class="headerlink" title="23.CAS æœ‰ä»€ä¹ˆé—®é¢˜ï¼ŒJavaæ˜¯æ€ä¹ˆè§£å†³çš„ï¼Ÿ"></a>23.CAS æœ‰ä»€ä¹ˆé—®é¢˜ï¼ŒJavaæ˜¯æ€ä¹ˆè§£å†³çš„ï¼Ÿ</h2><p>ä¼šæœ‰ ABA çš„é—®é¢˜ï¼Œå˜é‡å€¼åœ¨æ“ä½œè¿‡ç¨‹ä¸­å…ˆè¢«å…¶ä»–çº¿ç¨‹ä» <strong>A</strong> ä¿®æ”¹ä¸º <strong>B</strong>ï¼Œåˆè¢«æ”¹å› <strong>A</strong>ï¼ŒCAS æ— æ³•æ„ŸçŸ¥ä¸­é€”å˜åŒ–ï¼Œå¯¼è‡´æ“ä½œè¯¯åˆ¤ä¸ºâ€œæœªå˜æ›´â€ã€‚æ¯”å¦‚ï¼š</p><ul><li>çº¿ç¨‹1è¯»å–å˜é‡ä¸º<code>A</code>ï¼Œå‡†å¤‡æ”¹ä¸º<code>C</code>ã€‚</li><li>æ­¤æ—¶çº¿ç¨‹2å°†å˜é‡<code>A</code>â†’<code>B</code>â†’<code>A</code>ã€‚</li><li>çº¿ç¨‹1çš„CASæ‰§è¡Œæ—¶å‘ç°ä»æ˜¯<code>A</code>ï¼Œä½†çŠ¶æ€å·²ä¸¢å¤±ä¸­é—´å˜åŒ–ã€‚</li></ul><p>Java æä¾›çš„å·¥å…·ç±»ä¼šåœ¨ CAS æ“ä½œä¸­å¢åŠ <strong>ç‰ˆæœ¬å·ï¼ˆStampï¼‰æˆ–æ ‡è®°</strong>ï¼Œæ¯æ¬¡ä¿®æ”¹éƒ½æ›´æ–°ç‰ˆæœ¬å·ï¼Œä½¿å¾—å³ä½¿å€¼ç›¸åŒä¹Ÿèƒ½è¯†åˆ«å˜æ›´å†å²ã€‚æ¯”å¦‚ï¼Œå¯ä»¥ç”¨ AtomicStampedReference æ¥è§£å†³ ABA é—®é¢˜ï¼Œé€šè¿‡æ¯”å¯¹å€¼<strong>å’Œ</strong>ç‰ˆæœ¬å·è¯†åˆ«ABAé—®é¢˜ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">AtomicStampedReference&lt;Integer&gt; ref = <span class="keyword">new</span> <span class="title class_">AtomicStampedReference</span>&lt;&gt;(<span class="number">100</span>, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// å°è¯•ä¿®æ”¹å€¼å¹¶æ›´æ–°ç‰ˆæœ¬å·</span></span><br><span class="line"><span class="type">boolean</span> <span class="variable">success</span> <span class="operator">=</span> ref.compareAndSet(<span class="number">100</span>, <span class="number">200</span>, <span class="number">0</span>, <span class="number">1</span>); </span><br><span class="line"><span class="comment">// å‰æï¼šå½“å‰å€¼=100 ä¸” ç‰ˆæœ¬å·=0ï¼Œæ‰ä¼šæ›´æ–°ä¸ºï¼ˆ200,1ï¼‰</span></span><br></pre></td></tr></table></figure><h2 id="24-voliatleå…³é”®å­—æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ"><a href="#24-voliatleå…³é”®å­—æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ" class="headerlink" title="24.voliatleå…³é”®å­—æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ"></a>24.voliatleå…³é”®å­—æœ‰ä»€ä¹ˆä½œç”¨ï¼Ÿ</h2><p>volatiteä½œç”¨æœ‰ 2 ä¸ªï¼š</p><ul><li><strong>ä¿è¯å˜é‡å¯¹æ‰€æœ‰çº¿ç¨‹çš„å¯è§æ€§</strong>ã€‚å½“ä¸€ä¸ªå˜é‡è¢«å£°æ˜ä¸ºvolatileæ—¶ï¼Œå®ƒä¼šä¿è¯å¯¹è¿™ä¸ªå˜é‡çš„å†™æ“ä½œä¼šç«‹å³åˆ·æ–°åˆ°ä¸»å­˜ä¸­ï¼Œè€Œå¯¹è¿™ä¸ªå˜é‡çš„è¯»æ“ä½œä¼šç›´æ¥ä»ä¸»å­˜ä¸­è¯»å–ï¼Œä»è€Œç¡®ä¿äº†å¤šçº¿ç¨‹ç¯å¢ƒä¸‹å¯¹è¯¥å˜é‡è®¿é—®çš„å¯è§æ€§ã€‚è¿™æ„å‘³ç€ä¸€ä¸ªçº¿ç¨‹ä¿®æ”¹äº†volatileå˜é‡çš„å€¼ï¼Œå…¶ä»–çº¿ç¨‹èƒ½å¤Ÿç«‹åˆ»çœ‹åˆ°è¿™ä¸ªä¿®æ”¹ï¼Œä¸ä¼šå—åˆ°å„è‡ªçº¿ç¨‹å·¥ä½œå†…å­˜çš„å½±å“ã€‚</li><li><strong>ç¦æ­¢æŒ‡ä»¤é‡æ’åºä¼˜åŒ–</strong>ã€‚volatileå…³é”®å­—åœ¨Javaä¸­ä¸»è¦é€šè¿‡å†…å­˜å±éšœæ¥ç¦æ­¢ç‰¹å®šç±»å‹çš„æŒ‡ä»¤é‡æ’åºã€‚<ul><li>1ï¼‰<strong>å†™-å†™ï¼ˆWrite-Writeï¼‰å±éšœ</strong>ï¼šåœ¨å¯¹volatileå˜é‡æ‰§è¡Œå†™æ“ä½œä¹‹å‰ï¼Œä¼šæ’å…¥ä¸€ä¸ªå†™å±éšœã€‚è¿™ç¡®ä¿äº†åœ¨è¯¥å˜é‡å†™æ“ä½œä¹‹å‰çš„æ‰€æœ‰æ™®é€šå†™æ“ä½œéƒ½å·²å®Œæˆï¼Œé˜²æ­¢äº†è¿™äº›å†™æ“ä½œè¢«ç§»åˆ°volatileå†™æ“ä½œä¹‹åã€‚</li><li>2ï¼‰<strong>è¯»-å†™ï¼ˆRead-Writeï¼‰å±éšœ</strong>ï¼šåœ¨å¯¹volatileå˜é‡æ‰§è¡Œè¯»æ“ä½œä¹‹åï¼Œä¼šæ’å…¥ä¸€ä¸ªè¯»å±éšœã€‚å®ƒç¡®ä¿äº†å¯¹volatileå˜é‡çš„è¯»æ“ä½œä¹‹åçš„æ‰€æœ‰æ™®é€šè¯»æ“ä½œéƒ½ä¸ä¼šè¢«æå‰åˆ°volatileè¯»ä¹‹å‰æ‰§è¡Œï¼Œä¿è¯äº†è¯»å–åˆ°çš„æ•°æ®æ˜¯æœ€æ–°çš„ã€‚</li><li>3ï¼‰<strong>å†™-è¯»ï¼ˆWrite-Readï¼‰å±éšœ</strong>ï¼šè¿™æ˜¯æœ€é‡è¦çš„ä¸€ä¸ªå±éšœï¼Œå®ƒå‘ç”Ÿåœ¨volatileå†™ä¹‹åå’Œvolatileè¯»ä¹‹å‰ã€‚è¿™ä¸ªå±éšœç¡®ä¿äº†volatileå†™æ“ä½œä¹‹å‰çš„æ‰€æœ‰å†…å­˜æ“ä½œï¼ˆåŒ…æ‹¬å†™æ“ä½œï¼‰éƒ½ä¸ä¼šè¢«é‡æ’åºåˆ°volatileè¯»ä¹‹åï¼ŒåŒæ—¶ä¹Ÿç¡®ä¿äº†volatileè¯»æ“ä½œä¹‹åçš„æ‰€æœ‰å†…å­˜æ“ä½œï¼ˆåŒ…æ‹¬è¯»æ“ä½œï¼‰éƒ½ä¸ä¼šè¢«é‡æ’åºåˆ°volatileå†™ä¹‹å‰ã€‚</li></ul></li></ul><h2 id="25-æŒ‡ä»¤é‡æ’åºçš„åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#25-æŒ‡ä»¤é‡æ’åºçš„åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="25.æŒ‡ä»¤é‡æ’åºçš„åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ"></a>25.æŒ‡ä»¤é‡æ’åºçš„åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ</h2><p>åœ¨æ‰§è¡Œç¨‹åºæ—¶ï¼Œä¸ºäº†æé«˜æ€§èƒ½ï¼Œå¤„ç†å™¨å’Œç¼–è¯‘å™¨å¸¸å¸¸ä¼šå¯¹æŒ‡ä»¤è¿›è¡Œé‡æ’åºï¼Œä½†æ˜¯é‡æ’åºè¦æ»¡è¶³ä¸‹é¢ 2 ä¸ªæ¡ä»¶æ‰èƒ½è¿›è¡Œï¼š</p><ul><li><strong>åœ¨å•çº¿ç¨‹ç¯å¢ƒä¸‹ä¸èƒ½æ”¹å˜ç¨‹åºè¿è¡Œçš„ç»“æœ</strong></li><li><strong>å­˜åœ¨æ•°æ®ä¾èµ–å…³ç³»çš„ä¸å…è®¸é‡æ’åºã€‚</strong></li></ul><p>æ‰€ä»¥<strong>é‡æ’åºä¸ä¼šå¯¹å•çº¿ç¨‹æœ‰å½±å“ï¼Œåªä¼šç ´åå¤šçº¿ç¨‹çš„æ‰§è¡Œè¯­ä¹‰ã€‚</strong></p><p>æˆ‘ä»¬çœ‹è¿™ä¸ªä¾‹å­ï¼ŒAå’ŒCä¹‹é—´å­˜åœ¨æ•°æ®ä¾èµ–å…³ç³»ï¼ŒåŒæ—¶Bå’ŒCä¹‹é—´ä¹Ÿå­˜åœ¨æ•°æ®ä¾èµ–å…³ç³»ã€‚å› æ­¤åœ¨æœ€ç»ˆæ‰§è¡Œçš„æŒ‡ä»¤åºåˆ—ä¸­ï¼ŒCä¸èƒ½è¢«é‡æ’åºåˆ°Aå’ŒBçš„å‰é¢ï¼Œå¦‚æœCæ’åˆ°Aå’ŒBçš„å‰é¢ï¼Œé‚£ä¹ˆç¨‹åºçš„ç»“æœå°†ä¼šè¢«æ”¹å˜ã€‚ä½†Aå’ŒBä¹‹é—´æ²¡æœ‰æ•°æ®ä¾èµ–å…³ç³»ï¼Œç¼–è¯‘å™¨å’Œå¤„ç†å™¨å¯ä»¥é‡æ’åºAå’ŒBä¹‹é—´çš„æ‰§è¡Œé¡ºåºã€‚</p><h2 id="26-volatileå¯ä»¥ä¿è¯çº¿ç¨‹å®‰å…¨å—ï¼Ÿ"><a href="#26-volatileå¯ä»¥ä¿è¯çº¿ç¨‹å®‰å…¨å—ï¼Ÿ" class="headerlink" title="26.volatileå¯ä»¥ä¿è¯çº¿ç¨‹å®‰å…¨å—ï¼Ÿ"></a>26.volatileå¯ä»¥ä¿è¯çº¿ç¨‹å®‰å…¨å—ï¼Ÿ</h2><p>volatileå…³é”®å­—å¯ä»¥ä¿è¯å¯è§æ€§ï¼Œ<strong>ä½†ä¸èƒ½ä¿è¯åŸå­æ€§</strong>ï¼Œå› æ­¤ä¸èƒ½å®Œå…¨ä¿è¯çº¿ç¨‹å®‰å…¨ã€‚volatileå…³é”®å­—ç”¨äºä¿®é¥°å˜é‡ï¼Œå½“ä¸€ä¸ªçº¿ç¨‹ä¿®æ”¹äº†volatileä¿®é¥°çš„å˜é‡çš„å€¼ï¼Œå…¶ä»–çº¿ç¨‹èƒ½å¤Ÿç«‹å³çœ‹åˆ°æœ€æ–°çš„å€¼ï¼Œä»è€Œé¿å…äº†çº¿ç¨‹ä¹‹é—´çš„æ•°æ®ä¸ä¸€è‡´ã€‚</p><p>ä½†æ˜¯ï¼Œvolatileå¹¶ä¸èƒ½è§£å†³å¤šçº¿ç¨‹å¹¶å‘ä¸‹çš„å¤åˆæ“ä½œé—®é¢˜ï¼Œ<strong>æ¯”å¦‚i++è¿™ç§æ“ä½œä¸æ˜¯åŸå­æ“ä½œï¼Œå¦‚æœå¤šä¸ªçº¿ç¨‹åŒæ—¶å¯¹iè¿›è¡Œè‡ªå¢æ“ä½œï¼Œvolatileä¸èƒ½ä¿è¯çº¿ç¨‹å®‰å…¨ã€‚</strong>å¯¹äºå¤åˆæ“ä½œï¼Œéœ€è¦ä½¿ç”¨synchronizedå…³é”®å­—æˆ–è€…Lockæ¥ä¿è¯åŸå­æ€§å’Œçº¿ç¨‹å®‰å…¨ã€‚</p><h2 id="27-volatileå’Œsychronizedæ¯”è¾ƒï¼Ÿ"><a href="#27-volatileå’Œsychronizedæ¯”è¾ƒï¼Ÿ" class="headerlink" title="27.volatileå’Œsychronizedæ¯”è¾ƒï¼Ÿ"></a>27.volatileå’Œsychronizedæ¯”è¾ƒï¼Ÿ</h2><p>Synchronizedè§£å†³äº†å¤šçº¿ç¨‹è®¿é—®å…±äº«èµ„æºæ—¶å¯èƒ½å‡ºç°çš„ç«æ€æ¡ä»¶å’Œæ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜ï¼Œä¿è¯äº†çº¿ç¨‹å®‰å…¨æ€§ã€‚Volatileè§£å†³äº†å˜é‡åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹çš„å¯è§æ€§å’Œæœ‰åºæ€§é—®é¢˜ï¼Œç¡®ä¿äº†å˜é‡çš„ä¿®æ”¹å¯¹å…¶ä»–çº¿ç¨‹æ˜¯å¯è§çš„ã€‚</p><ul><li>Synchronized: Synchronizedæ˜¯ä¸€ç§æ’ä»–æ€§çš„åŒæ­¥æœºåˆ¶ï¼Œä¿è¯äº†å¤šä¸ªçº¿ç¨‹è®¿é—®å…±äº«èµ„æºæ—¶çš„äº’æ–¥æ€§ï¼Œå³<strong>åŒä¸€æ—¶åˆ»åªå…è®¸ä¸€ä¸ªçº¿ç¨‹è®¿é—®å…±äº«èµ„æº</strong>ã€‚é€šè¿‡å¯¹ä»£ç å—æˆ–æ–¹æ³•æ·»åŠ Synchronizedå…³é”®å­—æ¥å®ç°åŒæ­¥ã€‚</li><li>Volatile: Volatileæ˜¯ä¸€ç§è½»é‡çº§çš„åŒæ­¥æœºåˆ¶ï¼Œç”¨æ¥ä¿è¯å˜é‡çš„å¯è§æ€§å’Œç¦æ­¢æŒ‡ä»¤é‡æ’åºã€‚å½“ä¸€ä¸ªå˜é‡è¢«å£°æ˜ä¸ºVolatileæ—¶ï¼Œçº¿ç¨‹åœ¨è¯»å–è¯¥å˜é‡æ—¶ä¼šç›´æ¥ä»å†…å­˜ä¸­è¯»å–ï¼Œè€Œä¸ä¼šä½¿ç”¨ç¼“å­˜ï¼ŒåŒæ—¶å¯¹è¯¥å˜é‡çš„å†™æ“ä½œä¼šç«‹å³åˆ·å›ä¸»å†…å­˜ï¼Œè€Œä¸æ˜¯ç¼“å­˜åœ¨æœ¬åœ°å†…å­˜ä¸­ã€‚</li></ul><h2 id="28-ä»€ä¹ˆæ˜¯å…¬å¹³é”å’Œéå…¬å¹³é”ï¼Ÿ"><a href="#28-ä»€ä¹ˆæ˜¯å…¬å¹³é”å’Œéå…¬å¹³é”ï¼Ÿ" class="headerlink" title="28.ä»€ä¹ˆæ˜¯å…¬å¹³é”å’Œéå…¬å¹³é”ï¼Ÿ"></a>28.ä»€ä¹ˆæ˜¯å…¬å¹³é”å’Œéå…¬å¹³é”ï¼Ÿ</h2><ul><li><strong>å…¬å¹³é”ï¼š</strong> æŒ‡å¤šä¸ªçº¿ç¨‹<strong>æŒ‰ç…§ç”³è¯·é”çš„é¡ºåºæ¥è·å–é”</strong>ï¼Œçº¿ç¨‹ç›´æ¥è¿›å…¥é˜Ÿåˆ—ä¸­æ’é˜Ÿï¼Œé˜Ÿåˆ—ä¸­çš„ç¬¬ä¸€ä¸ªçº¿ç¨‹æ‰èƒ½è·å¾—é”ã€‚å…¬å¹³é”çš„ä¼˜ç‚¹åœ¨äºå„ä¸ªçº¿ç¨‹å…¬å¹³å¹³ç­‰ï¼Œæ¯ä¸ªçº¿ç¨‹ç­‰å¾…ä¸€æ®µæ—¶é—´åï¼Œéƒ½æœ‰æ‰§è¡Œçš„æœºä¼šï¼Œè€Œå®ƒçš„ç¼ºç‚¹å°±åœ¨äºæ•´ä½“æ‰§è¡Œé€Ÿåº¦æ›´æ…¢ï¼Œååé‡æ›´å°ã€‚</li><li><strong>éå…¬å¹³é”ï¼š</strong> <strong>å¤šä¸ªçº¿ç¨‹åŠ é”æ—¶ç›´æ¥å°è¯•è·å–é”ï¼Œèƒ½æŠ¢åˆ°é”åˆ°ç›´æ¥å æœ‰é”</strong>ï¼ŒæŠ¢ä¸åˆ°æ‰ä¼šåˆ°ç­‰å¾…é˜Ÿåˆ—çš„é˜Ÿå°¾ç­‰å¾…ã€‚éå…¬å¹³é”çš„ä¼˜åŠ¿å°±åœ¨äºæ•´ä½“æ‰§è¡Œé€Ÿåº¦æ›´å¿«ï¼Œååé‡æ›´å¤§ï¼Œä½†åŒæ—¶ä¹Ÿå¯èƒ½äº§ç”Ÿçº¿ç¨‹é¥¥é¥¿é—®é¢˜ï¼Œä¹Ÿå°±æ˜¯è¯´å¦‚æœä¸€ç›´æœ‰çº¿ç¨‹æ’é˜Ÿï¼Œé‚£ä¹ˆåœ¨ç­‰å¾…é˜Ÿåˆ—ä¸­çš„çº¿ç¨‹å¯èƒ½é•¿æ—¶é—´å¾—ä¸åˆ°è¿è¡Œã€‚</li></ul><h2 id="29-éå…¬å¹³é”ååé‡ä¸ºä»€ä¹ˆæ¯”å…¬å¹³é”å¤§ï¼Ÿ"><a href="#29-éå…¬å¹³é”ååé‡ä¸ºä»€ä¹ˆæ¯”å…¬å¹³é”å¤§ï¼Ÿ" class="headerlink" title="29.éå…¬å¹³é”ååé‡ä¸ºä»€ä¹ˆæ¯”å…¬å¹³é”å¤§ï¼Ÿ"></a>29.éå…¬å¹³é”ååé‡ä¸ºä»€ä¹ˆæ¯”å…¬å¹³é”å¤§ï¼Ÿ</h2><ul><li><strong>å…¬å¹³é”æ‰§è¡Œæµç¨‹</strong>ï¼šè·å–é”æ—¶ï¼Œå…ˆå°†çº¿ç¨‹è‡ªå·±æ·»åŠ åˆ°ç­‰å¾…é˜Ÿåˆ—çš„é˜Ÿå°¾å¹¶ä¼‘çœ ï¼Œå½“æŸçº¿ç¨‹ç”¨å®Œé”ä¹‹åï¼Œä¼šå»å”¤é†’ç­‰å¾…é˜Ÿåˆ—ä¸­é˜Ÿé¦–çš„çº¿ç¨‹å°è¯•å»è·å–é”ï¼Œ<strong>é”çš„ä½¿ç”¨é¡ºåºä¹Ÿå°±æ˜¯é˜Ÿåˆ—ä¸­çš„å…ˆåé¡ºåºï¼Œåœ¨æ•´ä¸ªè¿‡ç¨‹ä¸­ï¼Œçº¿ç¨‹ä¼šä»è¿è¡ŒçŠ¶æ€åˆ‡æ¢åˆ°ä¼‘çœ çŠ¶æ€ï¼Œå†ä»ä¼‘çœ çŠ¶æ€æ¢å¤æˆè¿è¡ŒçŠ¶æ€</strong>ï¼Œä½†çº¿ç¨‹<strong>æ¯æ¬¡ä¼‘çœ å’Œæ¢å¤éƒ½éœ€è¦ä»ç”¨æˆ·æ€è½¬æ¢æˆå†…æ ¸æ€</strong>ï¼Œè€Œè¿™ä¸ªçŠ¶æ€çš„è½¬æ¢æ˜¯æ¯”è¾ƒæ…¢çš„ï¼Œæ‰€ä»¥å…¬å¹³é”çš„æ‰§è¡Œé€Ÿåº¦ä¼šæ¯”è¾ƒæ…¢ã€‚</li><li><strong>éå…¬å¹³é”æ‰§è¡Œæµç¨‹</strong>ï¼šå½“çº¿ç¨‹è·å–é”æ—¶ï¼Œ<strong>ä¼šå…ˆé€šè¿‡ CAS å°è¯•è·å–é”ï¼Œå¦‚æœè·å–æˆåŠŸå°±ç›´æ¥æ‹¥æœ‰é”ï¼Œå¦‚æœè·å–é”å¤±è´¥æ‰ä¼šè¿›å…¥ç­‰å¾…é˜Ÿåˆ—ï¼Œç­‰å¾…ä¸‹æ¬¡å°è¯•è·å–é”ã€‚</strong>è¿™æ ·åšçš„å¥½å¤„æ˜¯ï¼Œè·å–é”ä¸ç”¨éµå¾ªå…ˆåˆ°å…ˆå¾—çš„è§„åˆ™ï¼Œä»è€Œé¿å…äº†çº¿ç¨‹ä¼‘çœ å’Œæ¢å¤çš„æ“ä½œï¼Œè¿™æ ·å°±åŠ é€Ÿäº†ç¨‹åºçš„æ‰§è¡Œæ•ˆç‡ã€‚</li></ul><p>çœ‹å‡ºå…¬å¹³é”ä¸éå…¬å¹³é”çš„ lock() æ–¹æ³•å”¯ä¸€çš„åŒºåˆ«å°±åœ¨äºå…¬å¹³é”åœ¨è·å–é”æ—¶å¤šäº†ä¸€ä¸ªé™åˆ¶æ¡ä»¶ï¼š<strong>hasQueuedPredecessors() ä¸º false</strong>ï¼Œè¿™ä¸ªæ–¹æ³•å°±æ˜¯åˆ¤æ–­åœ¨ç­‰å¾…é˜Ÿåˆ—ä¸­æ˜¯å¦å·²ç»æœ‰çº¿ç¨‹åœ¨æ’é˜Ÿäº†ã€‚</p><h2 id="30-ä»€ä¹ˆæƒ…å†µä¼šäº§ç”Ÿæ­»é”é—®é¢˜ï¼Ÿå¦‚ä½•è§£å†³ï¼Ÿ"><a href="#30-ä»€ä¹ˆæƒ…å†µä¼šäº§ç”Ÿæ­»é”é—®é¢˜ï¼Ÿå¦‚ä½•è§£å†³ï¼Ÿ" class="headerlink" title="30.ä»€ä¹ˆæƒ…å†µä¼šäº§ç”Ÿæ­»é”é—®é¢˜ï¼Ÿå¦‚ä½•è§£å†³ï¼Ÿ"></a>30.ä»€ä¹ˆæƒ…å†µä¼šäº§ç”Ÿæ­»é”é—®é¢˜ï¼Ÿå¦‚ä½•è§£å†³ï¼Ÿ</h2><p>æ­»é”åªæœ‰<strong>åŒæ—¶æ»¡è¶³</strong>ä»¥ä¸‹å››ä¸ªæ¡ä»¶æ‰ä¼šå‘ç”Ÿï¼š</p><ul><li>äº’æ–¥æ¡ä»¶ï¼šäº’æ–¥æ¡ä»¶æ˜¯æŒ‡<strong>å¤šä¸ªçº¿ç¨‹ä¸èƒ½åŒæ—¶ä½¿ç”¨åŒä¸€ä¸ªèµ„æº</strong>ã€‚</li><li>æŒæœ‰å¹¶ç­‰å¾…æ¡ä»¶ï¼šæŒæœ‰å¹¶ç­‰å¾…æ¡ä»¶æ˜¯æŒ‡ï¼Œå½“çº¿ç¨‹ A å·²ç»æŒæœ‰äº†èµ„æº 1ï¼Œåˆæƒ³ç”³è¯·èµ„æº 2ï¼Œè€Œèµ„æº 2 å·²ç»è¢«çº¿ç¨‹ C æŒæœ‰äº†ï¼Œæ‰€ä»¥çº¿ç¨‹ A å°±ä¼šå¤„äºç­‰å¾…çŠ¶æ€ï¼Œä½†æ˜¯<strong>çº¿ç¨‹ A åœ¨ç­‰å¾…èµ„æº 2 çš„åŒæ—¶å¹¶ä¸ä¼šé‡Šæ”¾è‡ªå·±å·²ç»æŒæœ‰çš„èµ„æº 1</strong>ã€‚</li><li>ä¸å¯å‰¥å¤ºæ¡ä»¶ï¼šä¸å¯å‰¥å¤ºæ¡ä»¶æ˜¯æŒ‡ï¼Œå½“çº¿ç¨‹å·²ç»æŒæœ‰äº†èµ„æº ï¼Œ<strong>åœ¨è‡ªå·±ä½¿ç”¨å®Œä¹‹å‰ä¸èƒ½è¢«å…¶ä»–çº¿ç¨‹è·å–</strong>ï¼Œçº¿ç¨‹ B å¦‚æœä¹Ÿæƒ³ä½¿ç”¨æ­¤èµ„æºï¼Œåˆ™åªèƒ½åœ¨çº¿ç¨‹ A ä½¿ç”¨å®Œå¹¶é‡Šæ”¾åæ‰èƒ½è·å–ã€‚</li><li>ç¯è·¯ç­‰å¾…æ¡ä»¶ï¼šç¯è·¯ç­‰å¾…æ¡ä»¶æŒ‡çš„æ˜¯ï¼Œåœ¨æ­»é”å‘ç”Ÿçš„æ—¶å€™ï¼Œ<strong>ä¸¤ä¸ªçº¿ç¨‹è·å–èµ„æºçš„é¡ºåºæ„æˆäº†ç¯å½¢é“¾</strong>ã€‚</li></ul><p>ä¾‹å¦‚ï¼Œçº¿ç¨‹ A æŒæœ‰èµ„æº R1 å¹¶è¯•å›¾è·å–èµ„æº R2ï¼Œè€Œçº¿ç¨‹ B æŒæœ‰èµ„æº R2 å¹¶è¯•å›¾è·å–èµ„æº R1ï¼Œæ­¤æ—¶ä¸¤ä¸ªçº¿ç¨‹ç›¸äº’ç­‰å¾…å¯¹æ–¹é‡Šæ”¾èµ„æºï¼Œä»è€Œå¯¼è‡´æ­»é”ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">DeadlockExample</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Object</span> <span class="variable">resource1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Object</span> <span class="variable">resource2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">threadA</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (resource1) &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;Thread A acquired resource1&quot;</span>);</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    Thread.sleep(<span class="number">100</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">synchronized</span> (resource2) &#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;Thread A acquired resource2&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="type">Thread</span> <span class="variable">threadB</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (resource2) &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;Thread B acquired resource2&quot;</span>);</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    Thread.sleep(<span class="number">100</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">synchronized</span> (resource1) &#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;Thread B acquired resource1&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        threadA.start();</span><br><span class="line">        threadB.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é¿å…æ­»é”é—®é¢˜å°±åªéœ€è¦ç ´ç¯å…¶ä¸­ä¸€ä¸ªæ¡ä»¶å°±å¯ä»¥ï¼Œæœ€å¸¸è§çš„å¹¶ä¸”å¯è¡Œçš„å°±æ˜¯<strong>ä½¿ç”¨èµ„æºæœ‰åºåˆ†é…æ³•ï¼Œæ¥ç ´ç¯ç¯è·¯ç­‰å¾…æ¡ä»¶</strong>ã€‚</p><p>é‚£ä»€ä¹ˆæ˜¯èµ„æºæœ‰åºåˆ†é…æ³•å‘¢ï¼Ÿçº¿ç¨‹ A å’Œ çº¿ç¨‹ B è·å–èµ„æºçš„é¡ºåºè¦ä¸€æ ·ï¼Œå½“çº¿ç¨‹ A æ˜¯å…ˆå°è¯•è·å–èµ„æº Aï¼Œç„¶åå°è¯•è·å–èµ„æº B çš„æ—¶å€™ï¼Œçº¿ç¨‹ B åŒæ ·ä¹Ÿæ˜¯å…ˆå°è¯•è·å–èµ„æº Aï¼Œç„¶åå°è¯•è·å–èµ„æº Bã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œçº¿ç¨‹ A å’Œ çº¿ç¨‹ B æ€»æ˜¯ä»¥ç›¸åŒçš„é¡ºåºç”³è¯·è‡ªå·±æƒ³è¦çš„èµ„æºã€‚</p><p><img src="https://cdn.xiaolincoding.com//picgo/1737006711792-cd31cdf7-f5e3-4091-8fb7-bde2d5f117bc.webp" alt="null"></p><h1 id="åœºæ™¯"><a href="#åœºæ™¯" class="headerlink" title="åœºæ™¯"></a>åœºæ™¯</h1><h2 id="1-å¤šçº¿ç¨‹æ‰“å°å¥‡å¶æ•°ï¼Œæ€ä¹ˆæ§åˆ¶æ‰“å°çš„é¡ºåº"><a href="#1-å¤šçº¿ç¨‹æ‰“å°å¥‡å¶æ•°ï¼Œæ€ä¹ˆæ§åˆ¶æ‰“å°çš„é¡ºåº" class="headerlink" title="1.å¤šçº¿ç¨‹æ‰“å°å¥‡å¶æ•°ï¼Œæ€ä¹ˆæ§åˆ¶æ‰“å°çš„é¡ºåº"></a>1.å¤šçº¿ç¨‹æ‰“å°å¥‡å¶æ•°ï¼Œæ€ä¹ˆæ§åˆ¶æ‰“å°çš„é¡ºåº</h2><p>å¯ä»¥åˆ©ç”¨wait()å’Œnotify()æ¥æ§åˆ¶çº¿ç¨‹çš„æ‰§è¡Œé¡ºåºã€‚</p><p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªåŸºäºè¿™ç§æ–¹æ³•çš„ç®€å•ç¤ºä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PrintOddEven</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Object</span> <span class="variable">lock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> <span class="variable">count</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">int</span> <span class="variable">MAX_COUNT</span> <span class="operator">=</span> <span class="number">10</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Runnable</span> <span class="variable">printOdd</span> <span class="operator">=</span> () -&gt; &#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (lock) &#123;</span><br><span class="line">                <span class="keyword">while</span> (count &lt;= MAX_COUNT) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (count % <span class="number">2</span> != <span class="number">0</span>) &#123;</span><br><span class="line">                        System.out.println(Thread.currentThread().getName() + <span class="string">&quot;: &quot;</span> + count++);</span><br><span class="line">                        lock.notify();</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        <span class="keyword">try</span> &#123;</span><br><span class="line">                            lock.wait();</span><br><span class="line">                        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                            e.printStackTrace();</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="type">Runnable</span> <span class="variable">printEven</span> <span class="operator">=</span> () -&gt; &#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (lock) &#123;</span><br><span class="line">                <span class="keyword">while</span> (count &lt;= MAX_COUNT) &#123;</span><br><span class="line">                    <span class="keyword">if</span> (count % <span class="number">2</span> == <span class="number">0</span>) &#123;</span><br><span class="line">                        System.out.println(Thread.currentThread().getName() + <span class="string">&quot;: &quot;</span> + count++);</span><br><span class="line">                        lock.notify();</span><br><span class="line">                    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                        <span class="keyword">try</span> &#123;</span><br><span class="line">                            lock.wait();</span><br><span class="line">                        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                            e.printStackTrace();</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line"></span><br><span class="line">        <span class="type">Thread</span> <span class="variable">oddThread</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(printOdd, <span class="string">&quot;OddThread&quot;</span>);</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">evenThread</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(printEven, <span class="string">&quot;EvenThread&quot;</span>);</span><br><span class="line"></span><br><span class="line">        oddThread.start();</span><br><span class="line">        evenThread.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä¸­ï¼Œ<strong>é€šè¿‡ä¸€ä¸ªå…±äº«çš„é”å¯¹è±¡lockæ¥æ§åˆ¶ä¸¤ä¸ªçº¿ç¨‹çš„äº¤æ›¿æ‰§è¡Œ</strong>ã€‚ä¸€ä¸ªçº¿ç¨‹è´Ÿè´£æ‰“å°å¥‡æ•°ï¼Œå¦ä¸€ä¸ªçº¿ç¨‹è´Ÿè´£æ‰“å°å¶æ•°ï¼Œ<strong>é€šè¿‡wait()å’Œnotify()æ–¹æ³•æ¥åœ¨ä¸¤ä¸ªçº¿ç¨‹ä¹‹é—´å®ç°é¡ºåºæ§åˆ¶ã€‚å½“å½“å‰åº”è¯¥æ‰“å°å¥‡æ•°æ—¶ï¼Œå¶æ•°çº¿ç¨‹ä¼šè¿›å…¥ç­‰å¾…çŠ¶æ€ï¼Œåä¹‹äº¦ç„¶ã€‚</strong></p><h2 id="2-3ä¸ªçº¿ç¨‹å¹¶å‘æ‰§è¡Œï¼Œ1ä¸ªçº¿ç¨‹ç­‰å¾…è¿™ä¸‰ä¸ªçº¿ç¨‹å…¨éƒ¨æ‰§è¡Œå®Œåœ¨æ‰§è¡Œï¼Œæ€ä¹ˆå®ç°ï¼Ÿ"><a href="#2-3ä¸ªçº¿ç¨‹å¹¶å‘æ‰§è¡Œï¼Œ1ä¸ªçº¿ç¨‹ç­‰å¾…è¿™ä¸‰ä¸ªçº¿ç¨‹å…¨éƒ¨æ‰§è¡Œå®Œåœ¨æ‰§è¡Œï¼Œæ€ä¹ˆå®ç°ï¼Ÿ" class="headerlink" title="2.3ä¸ªçº¿ç¨‹å¹¶å‘æ‰§è¡Œï¼Œ1ä¸ªçº¿ç¨‹ç­‰å¾…è¿™ä¸‰ä¸ªçº¿ç¨‹å…¨éƒ¨æ‰§è¡Œå®Œåœ¨æ‰§è¡Œï¼Œæ€ä¹ˆå®ç°ï¼Ÿ"></a>2.3ä¸ªçº¿ç¨‹å¹¶å‘æ‰§è¡Œï¼Œ1ä¸ªçº¿ç¨‹ç­‰å¾…è¿™ä¸‰ä¸ªçº¿ç¨‹å…¨éƒ¨æ‰§è¡Œå®Œåœ¨æ‰§è¡Œï¼Œæ€ä¹ˆå®ç°ï¼Ÿ</h2><ul><li>åˆ›å»º 3 ä¸ªå¹¶å‘æ‰§è¡Œçš„çº¿ç¨‹ï¼Œåœ¨æ¯ä¸ªçº¿ç¨‹çš„ä»»åŠ¡ç»“æŸæ—¶è°ƒç”¨ <code>countDown</code> æ–¹æ³•å°†è®¡æ•°å™¨å‡ 1ã€‚</li><li>åˆ›å»ºç¬¬ 4 ä¸ªçº¿ç¨‹ï¼Œä½¿ç”¨ <code>await</code> æ–¹æ³•ç­‰å¾…è®¡æ•°å™¨ä¸º 0ï¼Œå³ç­‰å¾…å…¶ä»– 3 ä¸ªçº¿ç¨‹å®Œæˆä»»åŠ¡ã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.concurrent.CountDownLatch;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CountDownLatchExample</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// åˆ›å»ºä¸€ä¸ª CountDownLatchï¼Œåˆå§‹è®¡æ•°ä¸º 3</span></span><br><span class="line">        <span class="type">CountDownLatch</span> <span class="variable">latch</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CountDownLatch</span>(<span class="number">3</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åˆ›å»ºå¹¶å¯åŠ¨ 3 ä¸ªå¹¶å‘çº¿ç¨‹</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">3</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">final</span> <span class="type">int</span> <span class="variable">threadNumber</span> <span class="operator">=</span> i + <span class="number">1</span>;</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    System.out.println(<span class="string">&quot;Thread &quot;</span> + threadNumber + <span class="string">&quot; is working.&quot;</span>);</span><br><span class="line">                    <span class="comment">// æ¨¡æ‹Ÿçº¿ç¨‹æ‰§è¡Œä»»åŠ¡</span></span><br><span class="line">                    Thread.sleep((<span class="type">long</span>) (Math.random() * <span class="number">1000</span>));</span><br><span class="line">                    System.out.println(<span class="string">&quot;Thread &quot;</span> + threadNumber + <span class="string">&quot; has finished.&quot;</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                    <span class="comment">// ä»»åŠ¡å®Œæˆåï¼Œè®¡æ•°å™¨å‡ 1</span></span><br><span class="line">                    latch.countDown();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;).start();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// åˆ›å»ºå¹¶å¯åŠ¨ç¬¬ 4 ä¸ªçº¿ç¨‹ï¼Œç­‰å¾…å…¶ä»– 3 ä¸ªçº¿ç¨‹å®Œæˆ</span></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;Waiting for other threads to finish.&quot;</span>);</span><br><span class="line">                <span class="comment">// ç­‰å¾…è®¡æ•°å™¨ä¸º 0</span></span><br><span class="line">                latch.await();</span><br><span class="line">                System.out.println(<span class="string">&quot;All threads have finished, this thread starts to work.&quot;</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>ä»£ç è§£é‡Š</strong>ï¼š</p><ul><li>é¦–å…ˆï¼Œåˆ›å»ºäº†ä¸€ä¸ª <code>CountDownLatch</code> å¯¹è±¡ <code>latch</code>ï¼Œå¹¶å°†å…¶åˆå§‹è®¡æ•°è®¾ç½®ä¸º 3ã€‚</li><li>ç„¶åï¼Œä½¿ç”¨ <code>for</code> å¾ªç¯åˆ›å»ºå¹¶å¯åŠ¨ 3 ä¸ªçº¿ç¨‹ã€‚æ¯ä¸ªçº¿ç¨‹ä¼šæ‰§è¡Œä¸€äº›å·¥ä½œï¼ˆè¿™é‡Œä½¿ç”¨ <code>Thread.sleep</code> æ¨¡æ‹Ÿï¼‰ï¼Œåœ¨å·¥ä½œå®Œæˆåï¼Œä¼šè°ƒç”¨ <code>latch.countDown()</code> æ–¹æ³•ï¼Œå°† <code>latch</code> çš„è®¡æ•°å‡ 1ã€‚</li><li>æœ€åï¼Œåˆ›å»ºç¬¬ 4 ä¸ªçº¿ç¨‹ã€‚è¿™ä¸ªçº¿ç¨‹åœ¨å¼€å§‹æ—¶è°ƒç”¨ <code>latch.await()</code> æ–¹æ³•ï¼Œå®ƒä¼šé˜»å¡ï¼Œç›´åˆ° <code>latch</code> çš„è®¡æ•°ä¸º 0ï¼Œå³å‰é¢ 3 ä¸ªçº¿ç¨‹éƒ½è°ƒç”¨äº† <code>countDown()</code> æ–¹æ³•ã€‚ä¸€æ—¦è®¡æ•°ä¸º 0ï¼Œè¯¥çº¿ç¨‹å°†ç»§ç»­æ‰§è¡Œåç»­ä»»åŠ¡ã€‚</li></ul><h2 id="3-å•ä¾‹æ¨¡å‹æ—¢ç„¶å·²ç»ç”¨äº†synchronizedï¼Œä¸ºä»€ä¹ˆè¿˜è¦åœ¨åŠ volatileï¼Ÿ"><a href="#3-å•ä¾‹æ¨¡å‹æ—¢ç„¶å·²ç»ç”¨äº†synchronizedï¼Œä¸ºä»€ä¹ˆè¿˜è¦åœ¨åŠ volatileï¼Ÿ" class="headerlink" title="3.å•ä¾‹æ¨¡å‹æ—¢ç„¶å·²ç»ç”¨äº†synchronizedï¼Œä¸ºä»€ä¹ˆè¿˜è¦åœ¨åŠ volatileï¼Ÿ"></a>3.å•ä¾‹æ¨¡å‹æ—¢ç„¶å·²ç»ç”¨äº†synchronizedï¼Œä¸ºä»€ä¹ˆè¿˜è¦åœ¨åŠ volatileï¼Ÿ</h2><p>ä½¿ç”¨ <code>synchronized</code> å’Œ <code>volatile</code> ä¸€èµ·ï¼Œå¯ä»¥åˆ›å»ºä¸€ä¸ªæ—¢çº¿ç¨‹å®‰å…¨åˆèƒ½æ­£ç¡®åˆå§‹åŒ–çš„å•ä¾‹æ¨¡å¼ï¼Œé¿å…äº†å¤šçº¿ç¨‹ç¯å¢ƒä¸‹çš„å„ç§æ½œåœ¨é—®é¢˜ã€‚è¿™æ˜¯ä¸€ç§æ¯”è¾ƒå®Œå–„çš„çº¿ç¨‹å®‰å…¨çš„å•ä¾‹æ¨¡å¼å®ç°æ–¹å¼ï¼Œå°¤å…¶é€‚ç”¨äºé«˜å¹¶å‘ç¯å¢ƒã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Singleton</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">volatile</span> Singleton instance;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">Singleton</span><span class="params">()</span> &#123;&#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> Singleton <span class="title function_">getInstance</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (instance == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (Singleton.class) &#123;</span><br><span class="line">                <span class="keyword">if</span> (instance == <span class="literal">null</span>) &#123;</span><br><span class="line">                    instance = <span class="keyword">new</span> <span class="title class_">Singleton</span>();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><code>synchronized</code> å…³é”®å­—çš„ä½œç”¨ç”¨äºç¡®ä¿åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œåªæœ‰ä¸€ä¸ªçº¿ç¨‹èƒ½å¤Ÿè¿›å…¥åŒæ­¥å—ï¼ˆè¿™é‡Œæ˜¯ <code>synchronized (Singleton.class)</code>ï¼‰ã€‚åœ¨åˆ›å»ºå•ä¾‹å¯¹è±¡æ—¶ï¼Œ<strong>é€šè¿‡ <code>synchronized</code> ä¿è¯äº†åˆ›å»ºè¿‡ç¨‹çš„çº¿ç¨‹å®‰å…¨æ€§ï¼Œé¿å…å¤šä¸ªçº¿ç¨‹åŒæ—¶åˆ›å»ºå¤šä¸ªå•ä¾‹å¯¹è±¡ã€‚</strong></p><p><code>volatile</code> ç¡®ä¿äº†å¯¹è±¡å¼•ç”¨çš„å¯è§æ€§å’Œåˆ›å»ºè¿‡ç¨‹çš„æœ‰åºæ€§ï¼Œé¿å…äº†ç”±äºæŒ‡ä»¤é‡æ’åºè€Œå¯¼è‡´çš„é”™è¯¯ã€‚</p><p><code>instance = new Singleton();</code> è¿™è¡Œä»£ç å¹¶ä¸æ˜¯ä¸€ä¸ªåŸå­æ“ä½œï¼Œå®ƒå®é™…ä¸Šå¯ä»¥åˆ†è§£ä¸ºä»¥ä¸‹å‡ ä¸ªæ­¥éª¤ï¼š</p><ul><li>åˆ†é…å†…å­˜ç©ºé—´ã€‚</li><li>å®ä¾‹åŒ–å¯¹è±¡ã€‚</li><li>å°†å¯¹è±¡å¼•ç”¨èµ‹å€¼ç»™ <code>instance</code>ã€‚</li></ul><p><strong>ç”±äº Java å†…å­˜æ¨¡å‹å…è®¸ç¼–è¯‘å™¨å’Œå¤„ç†å™¨å¯¹æŒ‡ä»¤è¿›è¡Œé‡æ’åº</strong>ï¼Œåœ¨æ²¡æœ‰ <code>volatile</code> çš„æƒ…å†µä¸‹ï¼Œå¯èƒ½ä¼šå‡ºç°é‡æ’åºï¼Œä¾‹å¦‚å…ˆå°†å¯¹è±¡å¼•ç”¨èµ‹å€¼ç»™ <code>instance</code>ï¼Œä½†å¯¹è±¡çš„å®ä¾‹åŒ–æ“ä½œå°šæœªå®Œæˆã€‚</p><p>è¿™æ ·ï¼Œå…¶ä»–çº¿ç¨‹åœ¨æ£€æŸ¥ <code>instance == null</code> æ—¶ï¼Œä¼šè®¤ä¸ºå•ä¾‹å·²ç»åˆ›å»ºï¼Œä»è€Œå¾—åˆ°ä¸€ä¸ªæœªå®Œå…¨åˆå§‹åŒ–çš„å¯¹è±¡ï¼Œå¯¼è‡´é”™è¯¯ã€‚</p><p><code>volatile</code> å¯ä»¥ä¿è¯å˜é‡çš„å¯è§æ€§å’Œç¦æ­¢æŒ‡ä»¤é‡æ’åºã€‚å®ƒç¡®ä¿å¯¹ <code>instance</code> çš„ä¿®æ”¹å¯¹æ‰€æœ‰çº¿ç¨‹éƒ½æ˜¯å¯è§çš„ï¼Œå¹¶ä¸”ä¿è¯äº†ä¸Šè¿°ä¸‰ä¸ªæ­¥éª¤æŒ‰é¡ºåºæ‰§è¡Œï¼Œé¿å…äº†åœ¨å•ä¾‹åˆ›å»ºè¿‡ç¨‹ä¸­å› æŒ‡ä»¤é‡æ’åºè€Œå¯¼è‡´çš„é—®é¢˜ã€‚</p><h2 id="4-å‡è®¾ä¸¤ä¸ªçº¿ç¨‹å¹¶å‘è¯»å†™åŒä¸€ä¸ªæ•´å‹å˜é‡ï¼Œåˆå§‹å€¼ä¸ºé›¶ï¼Œæ¯ä¸ªçº¿ç¨‹åŠ -50-æ¬¡ï¼Œç»“æœå¯èƒ½æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#4-å‡è®¾ä¸¤ä¸ªçº¿ç¨‹å¹¶å‘è¯»å†™åŒä¸€ä¸ªæ•´å‹å˜é‡ï¼Œåˆå§‹å€¼ä¸ºé›¶ï¼Œæ¯ä¸ªçº¿ç¨‹åŠ -50-æ¬¡ï¼Œç»“æœå¯èƒ½æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="4.å‡è®¾ä¸¤ä¸ªçº¿ç¨‹å¹¶å‘è¯»å†™åŒä¸€ä¸ªæ•´å‹å˜é‡ï¼Œåˆå§‹å€¼ä¸ºé›¶ï¼Œæ¯ä¸ªçº¿ç¨‹åŠ  50 æ¬¡ï¼Œç»“æœå¯èƒ½æ˜¯ä»€ä¹ˆï¼Ÿ"></a>4.å‡è®¾ä¸¤ä¸ªçº¿ç¨‹å¹¶å‘è¯»å†™åŒä¸€ä¸ªæ•´å‹å˜é‡ï¼Œåˆå§‹å€¼ä¸ºé›¶ï¼Œæ¯ä¸ªçº¿ç¨‹åŠ  50 æ¬¡ï¼Œç»“æœå¯èƒ½æ˜¯ä»€ä¹ˆï¼Ÿ</h2><p>åœ¨æ²¡æœ‰ä»»ä½•åŒæ­¥æœºåˆ¶çš„æƒ…å†µä¸‹ï¼Œä¸¤ä¸ªçº¿ç¨‹å¹¶å‘å¯¹åŒä¸€ä¸ªæ•´å‹å˜é‡è¿›è¡Œ 50 æ¬¡åŠ  1 æ“ä½œï¼Œ<strong>æœ€ç»ˆç»“æœå¯èƒ½æ˜¯ 100ï¼Œä¹Ÿå¯èƒ½å°äº 100ï¼Œæœ€åçš„ç»“æœæ˜¯ 50ï¼Œ</strong>ä¹Ÿå°±æ˜¯æœ€ç»ˆçš„ç»“æœå¯èƒ½æ˜¯åœ¨ [50, 100] ã€‚</p><p>å°äº 100 æƒ…å†µçš„åˆ†æï¼Œç”±äºå¯¹æ•´å‹å˜é‡çš„ <code>num++</code> æ“ä½œä¸æ˜¯åŸå­æ“ä½œï¼Œå®ƒå®é™…ä¸ŠåŒ…å«äº†ä¸‰ä¸ªæ­¥éª¤ï¼š<strong>è¯»å–å˜é‡çš„å€¼ã€å°†å€¼åŠ  1ã€å°†æ–°å€¼å†™å›å˜é‡ã€‚</strong>åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ï¼Œå¯èƒ½ä¼šå‡ºç°çº¿ç¨‹å®‰å…¨é—®é¢˜ã€‚ä¾‹å¦‚ï¼Œçº¿ç¨‹ 1 å’Œçº¿ç¨‹ 2 åŒæ—¶è¯»å–äº†å˜é‡çš„å½“å‰å€¼ï¼Œç„¶åå„è‡ªå°†å…¶åŠ  1ï¼Œ<strong>æœ€åéƒ½å°†ç›¸åŒçš„æ–°å€¼å†™å›å˜é‡ï¼Œè¿™å°±å¯¼è‡´äº†ä¸€æ¬¡åŠ  1 æ“ä½œçš„ä¸¢å¤±ã€‚</strong>è¿™ç§æƒ…å†µä¼šå¤šæ¬¡å‘ç”Ÿï¼Œæœ€ç»ˆç»“æœå°±ä¼šå°äº 100ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.concurrent.atomic.AtomicInteger;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AtomicIntegerAddition</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">AtomicInteger</span> <span class="variable">num</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AtomicInteger</span>(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">thread1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">50</span>; i++) &#123;</span><br><span class="line">                num.incrementAndGet();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="type">Thread</span> <span class="variable">thread2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">50</span>; i++) &#123;</span><br><span class="line">                num.incrementAndGet();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        thread1.start();</span><br><span class="line">        thread2.start();</span><br><span class="line"></span><br><span class="line">        thread1.join();</span><br><span class="line">        thread2.join();</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;æœ€ç»ˆç»“æœ: &quot;</span> + num.get());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¬¬äºŒç§æ–¹å¼ï¼šé€šè¿‡ <code>synchronized</code> å…³é”®å­—æˆ– <code>ReentrantLock</code> ç¡®ä¿æ“ä½œçš„äº’æ–¥æ€§ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SynchronizedAddition</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> <span class="variable">num</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="type">Object</span> <span class="variable">lock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Object</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException &#123;</span><br><span class="line">        <span class="type">Thread</span> <span class="variable">thread1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">50</span>; i++) &#123;</span><br><span class="line">                <span class="keyword">synchronized</span> (lock) &#123;</span><br><span class="line">                    num++;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="type">Thread</span> <span class="variable">thread2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">50</span>; i++) &#123;</span><br><span class="line">                <span class="keyword">synchronized</span> (lock) &#123;</span><br><span class="line">                    num++;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        thread1.start();</span><br><span class="line">        thread2.start();</span><br><span class="line"></span><br><span class="line">        thread1.join();</span><br><span class="line">        thread2.join();</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;æœ€ç»ˆç»“æœ: &quot;</span> + num);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content:encoded>
      
      
      <category domain="https://blog.tokenlen.top/categories/%E6%8A%80%E6%9C%AF%E6%A0%88/">æŠ€æœ¯æ ˆ</category>
      
      
      <category domain="https://blog.tokenlen.top/tags/java/">java</category>
      
      <category domain="https://blog.tokenlen.top/tags/%E9%9D%A2%E8%AF%95/">é¢è¯•</category>
      
      <category domain="https://blog.tokenlen.top/tags/juc/">juc</category>
      
      
      <comments>https://blog.tokenlen.top/2025/05/22/java-stack/juc2/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>Mysqlè¿›é˜¶æŠ€æœ¯æ ˆ</title>
      <link>https://blog.tokenlen.top/2025/05/21/mysql/mysqlstack/</link>
      <guid>https://blog.tokenlen.top/2025/05/21/mysql/mysqlstack/</guid>
      <pubDate>Tue, 20 May 2025 16:00:00 GMT</pubDate>
      
        
        
          
          
      <description>&lt;h1 id=&quot;ä¸»ä»åŒæ­¥&quot;&gt;&lt;a href=&quot;#ä¸»ä»åŒæ­¥&quot; class=&quot;headerlink&quot; title=&quot;ä¸»ä»åŒæ­¥&quot;&gt;&lt;/a&gt;ä¸»ä»åŒæ­¥&lt;/h1&gt;&lt;h2 id=&quot;1-MySQL-ä¸»ä»æ¶æ„æœ‰ä»€ä¹ˆä¼˜ç¼ºç‚¹ï¼Ÿ&quot;&gt;&lt;a href=&quot;#1-MySQL-ä¸»ä»æ¶æ„æœ‰ä»€ä¹ˆä¼˜ç¼ºç‚¹ï¼Ÿ&quot;</description>
          
        
      
      
      
      <content:encoded><![CDATA[<h1 id="ä¸»ä»åŒæ­¥"><a href="#ä¸»ä»åŒæ­¥" class="headerlink" title="ä¸»ä»åŒæ­¥"></a>ä¸»ä»åŒæ­¥</h1><h2 id="1-MySQL-ä¸»ä»æ¶æ„æœ‰ä»€ä¹ˆä¼˜ç¼ºç‚¹ï¼Ÿ"><a href="#1-MySQL-ä¸»ä»æ¶æ„æœ‰ä»€ä¹ˆä¼˜ç¼ºç‚¹ï¼Ÿ" class="headerlink" title="1.MySQL ä¸»ä»æ¶æ„æœ‰ä»€ä¹ˆä¼˜ç¼ºç‚¹ï¼Ÿ"></a>1.MySQL ä¸»ä»æ¶æ„æœ‰ä»€ä¹ˆä¼˜ç¼ºç‚¹ï¼Ÿ</h2><p>MySQL Replication æ˜¯ MySQL å®˜æ–¹æä¾›çš„ä¸»ä»åŒæ­¥æ–¹æ¡ˆï¼Œç”¨äºå°† MySQL ä¸»åº“çš„æ•°æ®åŒæ­¥åˆ°ä»åº“ä¸­ï¼Œä»åº“å¯ä»¥ä¾›åº”ç”¨ç¨‹åºè¯»å–æ•°æ®ã€‚</p><p>Replication æ˜¯ç›®å‰ MySQL ä½¿ç”¨æœ€å¤šçš„ç¾å¤‡æ–¹æ¡ˆï¼Œä¸»è¦æœ‰ 3 ä¸ªä½œç”¨ï¼š</p><ol><li><strong>è¯»å†™åˆ†ç¦»</strong>ï¼Œå†™ä¸»åº“è¯»ä»åº“ã€‚è¿™æ ·å¤§å¤§é™ä½ä¸»åº“çš„è´Ÿè½½ï¼Œå³ä½¿ä¸»åº“å‡ºç°ç±»ä¼¼é”è¡¨ä¹‹ç±»çš„æƒ…å†µï¼Œä¹Ÿä¸å½±å“åº”ç”¨è¯»å–æ•°æ®ã€‚</li><li><strong>å®ç°ç¾å¤‡</strong>ï¼Œå½“ä¸»åº“å‘ç”Ÿæ•…éšœæ—¶ï¼Œå¯ä»¥æ–¹ä¾¿åœ°æŠŠä»åº“åˆ‡æ¢æˆä¸»åº“ï¼Œå®ç°<strong>é«˜å¯ç”¨</strong>ï¼ˆHAï¼‰ã€‚</li><li><strong>æ°´å¹³æ‰©å±•</strong>ï¼Œå½“åº”ç”¨è®¿é—®é‡å¯¼è‡´æ•°æ®åº“ I/O é«˜æ—¶ï¼Œå¯ä»¥é€šè¿‡æ°´å¹³æ‰©å±•çš„æ–¹å¼å°†é™ä½å•æœºè´Ÿè½½ï¼Œé™ä½ç£ç›˜ I/Oã€‚</li></ol><p><strong>åŒæ­¥åŸç†ï¼š</strong></p><p>MySQL é€šè¿‡ binlog å®ç°åŒæ­¥è¿‡ç¨‹ä¸­ï¼Œä¼šç”¨åˆ° 3 ä¸ªçº¿ç¨‹ï¼š</p><ul><li><strong>IO thread</strong>: ä»åº“æ‰§è¡Œ START SLAVE è¯­å¥æ—¶ï¼Œä¼šåˆ›å»ºä¸€ä¸ª IO threadï¼Œè´Ÿè´£è¿æ¥ä¸»èŠ‚ç‚¹ï¼Œè¯·æ±‚æ›´æ–°çš„ <strong>binlog**</strong>ï¼Œæ¥æ”¶åˆ° binlog åå†™å…¥ relaylogï¼›**</li><li>dump threadï¼šä¸»åº“æ¥æ”¶åˆ°ä»åº“çš„ binlog è¯·æ±‚åï¼Œåˆ›å»ºä¸€ä¸ª <strong>dump thread</strong>ï¼ŒæŠŠ binlog åŒæ­¥ç»™ä»åº“ï¼›</li><li>sql threadï¼š<strong>è¯»å– relaylogï¼Œè§£æ relaylog çš„å‘½ä»¤å¹¶æ‰§è¡Œï¼Œå°†æ•°æ®è½åº“ã€‚</strong></li></ul><p><img src="https://mmbiz.qpic.cn/mmbiz_png/a1gicTYmvicd8A2qPg567sK8NyS4KJ7rn97XibbwjO9bs8gTv2ODQNRyT8W98jvmGzgYVyBibLELp2nkdp9eT5BPjg/640?wx_fmt=png&amp;from=appmsg&amp;tp=wxpic&amp;wxfrom=5&amp;wx_lazy=1" alt=""></p><p>åœ¨ä»åº“ä¸Šæ‰§è¡Œ <strong>change master å‘½ä»¤ï¼Œè®¾ç½®è¦è¿æ¥ä¸»åº“çš„ç”¨æˆ·åã€å¯†ç ã€ipã€ç«¯å£ä»¥åŠè¯·æ±‚åŒæ­¥çš„ binlog ä¸­çš„ä½ç½®ï¼Œè¿™ä¸ªä½ç½®åŒ…å«æ–‡ä»¶åå’Œbinlog offsetï¼›</strong></p><p>ä»åº“æ‰§è¡Œ <strong>start slave</strong> å‘½ä»¤ï¼Œè¿™æ—¶ä¼šå¯åŠ¨ä¸Šé¢çš„ <strong>IO thread å’Œ sql thread</strong>ï¼Œå…¶ä¸­ IO thread è´Ÿè´£è·Ÿä¸»åº“å»ºç«‹è¿æ¥ï¼›</p><p>ä¸»åº“æ”¶åˆ°ä»åº“çš„è¿æ¥è¯·æ±‚åï¼Œæ ¡éªŒç”¨æˆ·åå¯†ç ï¼›</p><p>ä¸»åº“æ ¡éªŒé€šè¿‡ååˆ›å»º <strong>dump threadï¼ŒæŒ‰ç…§ä»åº“è¯·æ±‚ binlog çš„ offset å°† binlog å‘ç»™ä»åº“ï¼›</strong></p><p>ä»åº“æ”¶åˆ°ä¸»åº“å‘é€çš„ binlog åï¼Œå°†æ—¥å¿—å†™å…¥ <strong>relaylogï¼›</strong></p><p>sql thread è¯»å– relaylogï¼Œè§£æå‡ºå‘½ä»¤åæ‰§è¡Œã€‚</p><p><strong>ç¼ºç‚¹ï¼š</strong></p><p><strong>æœ€å¤§çš„ç¼ºç‚¹å°±æ˜¯ä¸»ä»å»¶è¿Ÿ</strong>ã€‚</p><p>åŸå› ï¼šï¼šï¼šï¼šï¼š</p><p>ä»åº“æ‰€åœ¨æœºå™¨æ€§èƒ½å·®ï¼Œå‘½ä»¤æ‰§è¡Œæ…¢ï¼›</p><p>ä»åº“æŸ¥è¯¢å‹åŠ›å¤§ï¼Œæ¶ˆè€—äº†å¤§é‡ CPU èµ„æºï¼Œå½±å“äº† sql thread æ‰§è¡Œï¼›</p><p>ä¸»åº“æœ‰<strong>å¤§äº‹åŠ¡</strong>ï¼ˆæ¯”å¦‚å¤§è¡¨DDLï¼‰ï¼Œè¿™ä¸ªäº‹åŠ¡é‡Œé¢æ‰§è¡Œçš„ sql æ¯”è¾ƒå¤šï¼Œä¸€æ–¹é¢ä¸»åº“éœ€è¦ç­‰å¾…äº‹åŠ¡æ‰§è¡Œå®Œæˆæ‰èƒ½å†™å…¥ binlogï¼Œå¦ä¸€æ–¹é¢åŒæ­¥åˆ°ä»åº“å’Œåœ¨ä»åº“æ‰§è¡Œéƒ½éœ€è¦èŠ±è´¹å¾ˆå¤šæ—¶é—´ï¼Œå¯¼è‡´ä¸»ä»å»¶è¿Ÿï¼›</p><p>æ•°æ®åº“ç‰ˆæœ¬ä½ï¼Œ<strong>åœ¨ MySQL 5.6 ä¹‹å‰ï¼Œåªæ”¯æŒå•çº¿ç¨‹å¤åˆ¶ï¼Œæ•ˆç‡æ¯”è¾ƒä½ï¼›</strong></p><p>è¡¨ä¸Šæ— ä¸»é”®ï¼Œä¸»åº“åˆ©ç”¨ç´¢å¼•æ›´æ”¹æ•°æ®ï¼Œä»åº“åªèƒ½ç”¨å…¨è¡¨æ‰«æã€‚</p><p>è¦è§£å†³ä¸»å¤‡å»¶è¿Ÿçš„é—®é¢˜ï¼Œå¯ä»¥è€ƒè™‘ä¸‹é¢æ–¹æ³•ï¼š</p><ol><li>ä¼˜åŒ–ä¸šåŠ¡é€»è¾‘ï¼Œé¿å…ä½¿ç”¨å¤§äº‹åŠ¡ï¼Œæˆ–è€…å¤§äº‹åŠ¡åœºæ™¯å°½é‡æ”¾åœ¨ä¸šåŠ¡ä½å³°æœŸæ‰§è¡Œï¼›</li><li>æé«˜ä»åº“æ‰€åœ¨æœºå™¨çš„æ€§èƒ½ï¼›</li><li>ä¿éšœç½‘ç»œæ€§èƒ½ï¼Œé¿å…ç½‘ç»œå»¶è¿Ÿï¼›</li><li>å¼•å…¥ <strong>semi-sync åŠåŒæ­¥å¤åˆ¶</strong>ï¼Œé…åˆå¼‚æ­¥å¤åˆ¶ã€‚</li></ol><p><strong>ä¸»ä»åŒæ­¥çš„ç¬¬äºŒä¸ªç¼ºç‚¹å°±æ˜¯æ•°æ®ä¸¢å¤±</strong>ã€‚</p><blockquote><p>MySQL æœ‰ 3 ç§ä¸»ä»å¤åˆ¶æ–¹å¼ï¼š</p><ol><li><strong>å¼‚æ­¥å¤åˆ¶</strong>ï¼šä¸»<strong>åº“æ‰§è¡Œå®Œå®¢æˆ·ç«¯æäº¤çš„äº‹åŠ¡åç«‹å³å°†ç»“æœè¿”å›ç»™å®¢æˆ·ç«¯ï¼Œä¸å…³å¿ƒä»åº“æ˜¯å¦åŒæ­¥å®Œæˆ</strong>ã€‚è¿™ç§æ–¹å¼å¾ˆå®¹æ˜“å‘ç”Ÿæ•°æ®ä¸¢å¤±ï¼Œæ¯”å¦‚ä¸»åº“çš„æ—¥å¿—è¿˜æœªåŒæ­¥ç»™ä»åº“å°±å®•æœºäº†ï¼Œè¿™æ—¶éœ€è¦åœ¨ä»åº“ä¸­é€‰æ‹©ä¸€ä¸ªä½œä¸ºæ–°ä¸»åº“ï¼Œä¹‹å‰æœªåŒæ­¥å®Œæˆçš„æ•°æ®å°±ä¸¢å¤±äº†ï¼›</li><li>å…¨åŒæ­¥å¤åˆ¶ï¼š<strong>ä¸»åº“æ‰§è¡Œå®Œå®¢æˆ·ç«¯æäº¤çš„äº‹åŠ¡å¹¶ä¸”ç­‰å¾…ä»åº“ä¹Ÿæ‰§è¡Œå®Œæˆæ•°æ®åŒæ­¥åå†æŠŠç»“æœè¿”å›ç»™å®¢æˆ·ç«¯</strong>ã€‚è¿™ç§æ–¹å¼èƒ½å¤Ÿä¿è¯ä¸ä¸¢å¤±æ•°æ®ï¼Œä½†æ˜¯æ•°æ®åº“çš„æ€§èƒ½ä¼šå—åˆ°å½±å“ï¼›</li><li>åŠåŒæ­¥å¤åˆ¶ï¼šæ˜¯ä»‹äºå…¨åŒæ­¥å’Œå¼‚æ­¥å¤åˆ¶çš„ä¸€ç§æ–¹å¼ï¼Œ<strong>ä¸»åº“è‡³å°‘ç­‰å¾…ä¸€ä¸ªä»åº“æ¥æ”¶ binlog å¹¶æˆåŠŸå†™å…¥åˆ° relaylog åç»™å®¢æˆ·ç«¯è¿”å›ç»“æœ</strong>ã€‚ä¸»åº“ä¸éœ€è¦ç­‰å¾…æ‰€æœ‰ä»åº“è¿”å› ACKã€‚</li></ol></blockquote><p>MySQL ä¸­é»˜è®¤é‡‡ç”¨<strong>å¼‚æ­¥å¤åˆ¶</strong>ï¼Œè¿™æ ·å¾ˆå®¹æ˜“å¯¼è‡´æ•°æ®ä¸¢å¤±ã€‚ä¸€ä¸ªå¥½çš„æ–¹å¼å°±æ˜¯é‡‡ç”¨ <strong>semi-sync åŠåŒæ­¥å¤åˆ¶æ’ä»¶</strong>ã€‚ä¸è¿‡ semi-sync å­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼Œä¸»åº“å†™æ•°æ®åˆ° binlog åæ‰§è¡Œ commitï¼Œæ‰ä¼šç»™ä»åº“åŒæ­¥æ•°æ®ã€‚å¦‚æœä»åº“è¿˜æ²¡æœ‰è¿”å› ACKï¼Œä¸»åº“å‘ç”Ÿäº†å®•æœºï¼Œä»åº“è¿˜æ²¡æœ‰å†™å®Œ relaylog å°±è¢«é€‰æ‹©ä¸ºä¸»åº“ï¼Œä¹Ÿä¼šå‘ç”Ÿæ•°æ®ä¸¢å¤±ã€‚</p><p>MySQL 5.7 å¼•å…¥äº†å¢å¼ºç‰ˆ<strong>åŠåŒæ­¥å¤åˆ¶</strong>ã€‚ä¸»åº“å†™å…¥æ•°æ®åˆ° binlog åï¼Œå°±ç»™ä»åº“è¿›è¡ŒåŒæ­¥ï¼Œç›´åˆ°è‡³å°‘ä¸€ä¸ªä»åº“è¿”å›ç»™ä¸»åº“ ACKï¼Œä¸»åº“æ‰ä¼šè¿›è¡Œ commit æ“ä½œã€‚</p><h2 id="2-MySQLåŒä¸»æ¶æ„æœ‰ä»€ä¹ˆä¼˜ç¼ºç‚¹ï¼Ÿ"><a href="#2-MySQLåŒä¸»æ¶æ„æœ‰ä»€ä¹ˆä¼˜ç¼ºç‚¹ï¼Ÿ" class="headerlink" title="2.MySQLåŒä¸»æ¶æ„æœ‰ä»€ä¹ˆä¼˜ç¼ºç‚¹ï¼Ÿ"></a>2.<strong>MySQLåŒä¸»æ¶æ„æœ‰ä»€ä¹ˆä¼˜ç¼ºç‚¹ï¼Ÿ</strong></h2><p>åŒä¸»æ¶æ„æ˜¯ MySQL å¸¸è§çš„ä¸€ç§æ¶æ„æ¨¡å¼ï¼Œå®ƒçš„ç‰¹ç‚¹æ˜¯<strong>æœ‰ä¸¤ä¸ªä¸»èŠ‚ç‚¹å¯¹å¤–æä¾›æœåŠ¡ï¼Œå¹¶ä¸”è¿™ä¸¤ä¸ªä¸»èŠ‚ç‚¹äº’ä¸ºä¸»å¤‡</strong>ã€‚ä»Šå¤©æ¥å­¦ä¹ ä¸€ä¸‹åŒä¸»æ¶æ„ã€‚</p><h3 id="1-åŒä¸»å¤åˆ¶"><a href="#1-åŒä¸»å¤åˆ¶" class="headerlink" title="1.åŒä¸»å¤åˆ¶"></a>1.åŒä¸»å¤åˆ¶</h3><p>è¿™ç§æ¶æ„çš„ç‰¹ç‚¹é…ç½®ä¸¤ä¸ªä¸»åº“ï¼Œ<strong>æ¯ä¸ªä¸»åº“éƒ½æä¾›è¯»å†™æœåŠ¡ï¼Œå¹¶ä¸”è¿™ä¸¤ä¸ªä¸»åº“äº’ä¸ºä¸»å¤‡ã€‚</strong>å¦‚ä¸‹å›¾ï¼š</p><p><img src="https://mmbiz.qpic.cn/mmbiz_png/a1gicTYmvicd9JI16DxScxchEPaXKy2zRrpict4icZnFhokHazh1k4LyCP2J5YBkvTjA9WmzAJoLiabXOZaqfcG25jg/640?wx_fmt=png&amp;from=appmsg&amp;wxfrom=5&amp;wx_lazy=1&amp;tp=wxpic" alt=""></p><p>åœ¨ M1 å†™å…¥çš„æ•°æ®è¦åŒæ­¥åˆ° M2ï¼Œåœ¨ M2 å†™å…¥çš„æ•°æ®è¦åŒæ­¥åˆ° M1ã€‚è¿™ç§ä¸¤ä¸ªä¸»åº“åŒæ—¶æ”¯æŒå†™å…¥ï¼Œè¿™ç§æ¶æ„æ¨¡å¼ä¸€ä¸ªæ˜æ˜¾çš„ä¼˜åŠ¿å†™å…¥æ•ˆç‡é«˜ã€‚æ¯”å¦‚ä¸€ä¸ªåº”ç”¨åœ¨ä¸åŒçš„åŸå¸‚éƒ¨ç½²äº†ä¸¤ä¸ªä¸»èŠ‚ç‚¹ï¼Œè¯·æ±‚å¯ä»¥å°±è¿‘é€‰æ‹©å†™å…¥æ•°æ®åº“ã€‚</p><p>ä½†è¿™ç§æ¶æ„åœ¨æ•°æ®åŒæ­¥æ—¶å¾ˆå®¹æ˜“å‡ºé—®é¢˜ã€‚ </p><p>æ¡ˆä¾‹ä¸€ï¼š<strong>M1 å’Œ M2 åŒæ—¶æ”¶åˆ°ä¸€å¼ è¡¨çš„æ’å…¥è¯·æ±‚ï¼Œè¿™å¼ è¡¨æ˜¯è‡ªå¢ä¸»é”®ï¼Œä¸¤å¼ è¡¨æ’å…¥åä¸»é”®ç›¸åŒã€‚è¿™æ—¶å‘ç”Ÿæ•°æ®åŒæ­¥ï¼Œè¿™æ¡æ’å…¥è¯­å¥åœ¨ binlog é‡Œé¢è®°å½•çš„æ˜¯ row æ ¼å¼ï¼ŒåŒæ­¥æ—¶å‘ç”Ÿä¸»é”®å†²çªã€‚</strong></p><blockquote><p>MySQL binlog æœ‰ä¸‰ç§æ ¼å¼ï¼š</p><ul><li>STATEMENTï¼šè®°å½•çš„æ˜¯ SQL è¯­å¥æœ¬èº«ï¼›</li><li>ROWï¼šè®°å½•çš„æ˜¯æ•°æ®çš„å˜åŒ–ï¼›</li><li>MIXEDï¼šSTATEMENT å’Œ ROW æ ¼å¼çš„ç»“åˆï¼ŒMySQL ä¼šæ ¹æ® SQL è¯­å¥ç‰¹æ€§é€‰æ‹©ä½¿ç”¨ STATEMENT è¿˜æ˜¯ ROW æ ¼å¼ã€‚</li></ul></blockquote><p>è§£å†³æ–¹æ³•ï¼šï¼šï¼š</p><p>MySQL 5.0 åå¯ä»¥é€šè¿‡è®¾ç½® <strong>auto_increment_increment</strong> å’Œ <strong>auto_increment_offset</strong> è¿™ä¸¤ä¸ªé€‰é¡¹æ¥è§£å†³è¿™ä¸ªé—®é¢˜ã€‚</p><p>æ¡ˆä¾‹äºŒï¼šåœ¨ M1 ä¸Šæ‰§è¡Œäº†ä¸€æ¡è¯­å¥ï¼Œç”Ÿæˆ binlog åå‘ç»™ M2 è¿›è¡ŒåŒæ­¥ï¼ŒM2 æ‰§è¡Œå®Œæˆååˆç”Ÿæˆ binlog åŒæ­¥ç»™ Aï¼Œ<strong>å¯¼è‡´ä¸€æ¡è¯­å¥å¾ªç¯å¤åˆ¶</strong>ã€‚</p><p>è¿™ä¸ªé—®é¢˜çš„è§£å†³æ–¹æ³•æ˜¯è¦æ±‚ <strong>M1 å’Œ M2 çš„ server id</strong>ä¸ç›¸åŒï¼ŒM1 äº§ç”Ÿçš„ binlog è®°å½• server id æ˜¯ M1ï¼ŒM2 æ‰§è¡ŒåŒæ­¥æ—¶ç”Ÿæˆçš„ binlog ä¹Ÿè®°å½• server id ä¸º M1ã€‚è¿™æ ·åŒæ­¥ç»™ M1 æ˜¯ï¼ŒM1 åˆ¤æ–­åˆ° server id è·Ÿè‡ªå·±ç›¸åŒï¼Œå°±ä¸¢å¼ƒè¿™ä¸ªæ—¥å¿—ï¼Œä¸åšåŒæ­¥ã€‚</p><p>æ¡ˆä¾‹ä¸‰ï¼š<strong>åŒæ­¥è¿‡ç¨‹ä¸­ä¼šæœ‰æ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜</strong>ã€‚æ¯”å¦‚ç”¨æˆ· xiaoming çš„è´¦æˆ·ä½™é¢æ˜¯ 100ã€‚M1 æ‰§è¡Œäº† update æ“ä½œæŠŠè´¦æˆ·ä½™é¢æ›´æ–°æˆ 150ï¼ŒM2 æ‰§è¡Œäº† update æ“ä½œæ›´æ–°æˆ 130ã€‚</p><p>è§£å†³è¿™ç§æ•°æ®ä¸ä¸€è‡´é—®é¢˜çš„ä¸€ä¸ªæ€è·¯æ˜¯<strong>ä¸¥æ ¼åˆ’åˆ†æ•°æ®å’Œè®¾ç½®æƒé™</strong>ï¼Œæ¯”å¦‚æ¡ˆä¾‹ä¸­å°æ˜çš„æ‰€æœ‰æ•°æ®åªèƒ½åœ¨ M1 ä¸Šæ“ä½œã€‚</p><p>æ¡ˆä¾‹å››ï¼š<strong>å› ä¸ºèŠ‚ç‚¹å‘ç”Ÿæ•…éšœï¼ŒM1 ä¸èƒ½å¤åˆ¶äº†</strong>ï¼Œä½†æ˜¯åº”ç”¨å¯ä»¥å†™æ•°æ®åº“ï¼ŒM2 èƒ½æ­£å¸¸å†™å’Œå¤åˆ¶ï¼Œè¿™ä¸ªé—®é¢˜å°±å¾ˆéš¾è§£å†³äº†ã€‚</p><p>è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œ<strong>éœ€è¦ç»™ M1 å’Œ M2 é…ç½®ä»èŠ‚ç‚¹ï¼Œä¸»èŠ‚ç‚¹æ•…éšœååˆ‡æ¢åˆ°ä»èŠ‚ç‚¹è¿›è¡Œå·¥ä½œã€‚</strong></p><h3 id="2-ä¸»å¤‡å¤åˆ¶"><a href="#2-ä¸»å¤‡å¤åˆ¶" class="headerlink" title="2.ä¸»å¤‡å¤åˆ¶"></a>2.ä¸»å¤‡å¤åˆ¶</h3><p>è¿™ä¸ªæ¶æ„æ¨¡å¼çš„ç‰¹ç‚¹æ˜¯åŒä¸»èŠ‚ç‚¹ä¸­ï¼Œ<strong>åŒä¸€æ—¶åˆ»åªæœ‰ä¸€ä¸ªä¸»èŠ‚ç‚¹æä¾›å†™æœåŠ¡ï¼Œå¦ä¸€ä¸ªä¸»èŠ‚ç‚¹åªèƒ½æä¾›è¯»æœåŠ¡ã€‚</strong>å¦‚ä¸‹å›¾ï¼š</p><p><img src="https://mmbiz.qpic.cn/mmbiz_png/a1gicTYmvicd9JI16DxScxchEPaXKy2zRr1tqZkws2VGynmsyOtvbm3ia5VxnjCf6klRRyTChQo1dsXn5FsK1SJwA/640?wx_fmt=png&amp;from=appmsg&amp;wxfrom=5&amp;wx_lazy=1&amp;tp=wxpic" alt=""></p><p>è¿™ä¸ªæ¶æ„ç›¸å½“äºæ¯”å•ä¸»èŠ‚ç‚¹æ¶æ„å¤šäº†ä¸€ä¸ªçƒ­å¤‡ï¼Œæœ‰å¦‚ä¸‹ä¼˜åŠ¿ï¼š</p><ol><li>å› ä¸º M1 å’Œ M2 é…ç½®å¯¹ç§°ï¼Œåˆ‡æ¢ä¸»å¤‡æ¯”è¾ƒå®¹æ˜“ï¼›</li><li>æœ‰åŠ©äºæ•…éšœè½¬ç§»å’Œæ¢å¤ï¼›</li><li>å¯ä»¥åœ¨ä¸å½±å“åº”ç”¨çš„æƒ…å†µä¸‹è¿›è¡Œæ•°æ®åº“å‡çº§å’Œç»´æŠ¤ï¼›</li><li>ä¸ç”¨è€ƒè™‘å¾ªç¯å¤åˆ¶é—®é¢˜å’Œä¸»å¤‡ä¸ä¸€è‡´é—®é¢˜ã€‚</li></ol><p>å½“ç„¶ï¼Œä¸»å¤‡æ¶æ„ä¹Ÿæœ‰ç¼ºç‚¹ï¼Œ<strong>é‚£å°±æ˜¯å†™æ€§èƒ½ä¸èƒ½å¾—åˆ°æå‡ã€‚</strong></p><h3 id="3-ä¸»ä¸»æ¶æ„æ‹¥æœ‰å¤‡åº“"><a href="#3-ä¸»ä¸»æ¶æ„æ‹¥æœ‰å¤‡åº“" class="headerlink" title="3.ä¸»ä¸»æ¶æ„æ‹¥æœ‰å¤‡åº“"></a>3.ä¸»ä¸»æ¶æ„æ‹¥æœ‰å¤‡åº“</h3><p>ä¸»ä¸»æ¶æ„ä¸­æ¯ä¸ªä¸»åº“ä¹Ÿå¯ä»¥æ‹¥æœ‰å¤‡åº“ï¼Œå¦‚ä¸‹å›¾ï¼š</p><p><img src="https://mmbiz.qpic.cn/mmbiz_png/a1gicTYmvicd9JI16DxScxchEPaXKy2zRrpict4icZnFhokHazh1k4LyCP2J5YBkvTjA9WmzAJoLiabXOZaqfcG25jg/640?wx_fmt=png&amp;from=appmsg&amp;wxfrom=5&amp;wx_lazy=1&amp;tp=wxpic" alt=""></p><p>è¿™ç§é…ç½®ä¸ºæ¯ä¸ªä¸»åº“å¢åŠ äº†ä¸€ä¸ªå¤‡ä»½ï¼Œ<strong>å¯ä»¥é˜²æ­¢å•ç‚¹æ•…éšœï¼ŒåŒæ—¶å¤‡åº“ä¹Ÿå¯ä»¥å¤„ç†è¯»è¯·æ±‚ï¼Œæé«˜æ•°æ®åº“æ•´ä½“è¯»æ•ˆç‡ã€‚</strong></p><p>è¿™ä¸ªæ¶æ„çš„ç¼ºç‚¹æ˜¯å¢åŠ äº†æœºå™¨æˆæœ¬ã€‚</p><h3 id="4-ç¯å½¢å¤åˆ¶"><a href="#4-ç¯å½¢å¤åˆ¶" class="headerlink" title="4.ç¯å½¢å¤åˆ¶"></a>4.ç¯å½¢å¤åˆ¶</h3><p>ç¯å½¢å¤åˆ¶æ¶æ„æ˜¯ MySQL é›†ç¾¤ä¸­æ‹¥æœ‰å¤šä¸ªä¸»åº“ï¼Œä¸»åº“ä¹‹é—´å½¢æˆä¸€ä¸ªç¯å½¢ï¼Œ<strong>å‰é¢ä¸€ä¸ªèŠ‚ç‚¹æ˜¯å½“å‰èŠ‚ç‚¹çš„ä¸»åº“ï¼Œå½“å‰èŠ‚ç‚¹æ˜¯å‰é¢èŠ‚ç‚¹çš„å¤‡åº“ï¼Œä¹Ÿæ˜¯åé¢ä¸€ä¸ªèŠ‚ç‚¹çš„ä¸»åº“</strong>ã€‚å¦‚ä¸‹å›¾ï¼š</p><p><img src="https://mmbiz.qpic.cn/mmbiz_png/a1gicTYmvicd9JI16DxScxchEPaXKy2zRrZm1OfPH5HMCAyzHxCdicCmrh98dL9p1uWnLlIbAFhXH1ibAic8icxv8jyg/640?wx_fmt=png&amp;from=appmsg&amp;wxfrom=5&amp;wx_lazy=1&amp;tp=wxpic" alt=""></p><p>ç¯å½¢å¤åˆ¶è¿™ç§æ¶æ„å…¶å®å¹¶ä¸æ¨èï¼Œ<strong>å› ä¸ºå®ƒå¾ˆéš¾åšåˆ°æ•…éšœè½¬ç§»</strong>ï¼Œé«˜å¯ç”¨ç‰¹æ€§ä¾èµ–äºæ¯ä¸ªèŠ‚ç‚¹ä¸å‡ºæ•…éšœã€‚ä½†æ˜¯å¦‚æœä¸€ä¸ªèŠ‚ç‚¹å‡ºäº†æ•…éšœï¼Œå»æ‰è¿™ä¸ªèŠ‚ç‚¹ï¼Œ<strong>è¿™ä¸ªèŠ‚ç‚¹äº§ç”Ÿçš„ binlog å°†ä¸€ç›´å¾ªç¯å¤åˆ¶ä¸‹å»ï¼Œå› ä¸ºåªæœ‰é€šè¿‡è¿™ä¸ªèŠ‚ç‚¹çš„ server id æ‰èƒ½åšå‡ºåˆ¤æ–­åœæ­¢å¤åˆ¶ã€‚</strong></p><h1 id="ç´¢å¼•"><a href="#ç´¢å¼•" class="headerlink" title="ç´¢å¼•"></a>ç´¢å¼•</h1><h2 id="1-mysqlç´¢å¼•çš„ç±»å‹ï¼Œèšé›†ç´¢å¼•å’Œéèšé›†ç´¢å¼•æ˜¯ä»€ä¹ˆï¼Ÿéèšé›†ç´¢å¼•ä¸€å®šå›è¡¨æŸ¥è¯¢å—ï¼Ÿç´¢å¼•ä¸‹æ¨æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#1-mysqlç´¢å¼•çš„ç±»å‹ï¼Œèšé›†ç´¢å¼•å’Œéèšé›†ç´¢å¼•æ˜¯ä»€ä¹ˆï¼Ÿéèšé›†ç´¢å¼•ä¸€å®šå›è¡¨æŸ¥è¯¢å—ï¼Ÿç´¢å¼•ä¸‹æ¨æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="1.mysqlç´¢å¼•çš„ç±»å‹ï¼Œèšé›†ç´¢å¼•å’Œéèšé›†ç´¢å¼•æ˜¯ä»€ä¹ˆï¼Ÿéèšé›†ç´¢å¼•ä¸€å®šå›è¡¨æŸ¥è¯¢å—ï¼Ÿç´¢å¼•ä¸‹æ¨æ˜¯ä»€ä¹ˆï¼Ÿ"></a>1.mysqlç´¢å¼•çš„ç±»å‹ï¼Œèšé›†ç´¢å¼•å’Œéèšé›†ç´¢å¼•æ˜¯ä»€ä¹ˆï¼Ÿéèšé›†ç´¢å¼•ä¸€å®šå›è¡¨æŸ¥è¯¢å—ï¼Ÿç´¢å¼•ä¸‹æ¨æ˜¯ä»€ä¹ˆï¼Ÿ</h2>]]></content:encoded>
      
      
      <category domain="https://blog.tokenlen.top/categories/sql/">sql</category>
      
      
      <category domain="https://blog.tokenlen.top/tags/%E9%9D%A2%E8%AF%95/">é¢è¯•</category>
      
      <category domain="https://blog.tokenlen.top/tags/mysql/">mysql</category>
      
      
      <comments>https://blog.tokenlen.top/2025/05/21/mysql/mysqlstack/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>tcpfileä¸Šä¼ </title>
      <link>https://blog.tokenlen.top/2025/05/21/workmenu/tcpfile/</link>
      <guid>https://blog.tokenlen.top/2025/05/21/workmenu/tcpfile/</guid>
      <pubDate>Tue, 20 May 2025 16:00:00 GMT</pubDate>
      
        
        
          
          
      <description>&lt;p&gt;1ã€  è¯¾ç¨‹è®¾è®¡ç›®çš„&lt;/p&gt;
&lt;p&gt;æœ¬è¯¾ç¨‹è®¾è®¡æ—¨åœ¨å®ç°ä¸€ä¸ªåŸºäº &lt;strong&gt;TCP åè®®&lt;/strong&gt; çš„æ–‡ä»¶ä¼ è¾“ç³»ç»Ÿï¼Œæ¨¡æ‹Ÿå®é™…ç½‘ç»œä¼ è¾“è¿‡ç¨‹ï¼Œå¹¶ç»“åˆå¤šç§æ–‡ä»¶å­˜å‚¨æ–¹æ¡ˆï¼Œå®Œæˆæ–‡ä»¶æ¥æ”¶ä¸ä¿å­˜çš„åç«¯å¤„ç†ã€‚é€šè¿‡è¯¥ç³»ç»Ÿï¼Œå­¦ç”Ÿèƒ½æ·±å…¥ç†è§£ï¼š&lt;/p&gt;
&lt;p&gt;åŸºäº Socket çš„</description>
          
        
      
      
      
      <content:encoded><![CDATA[<p>1ã€  è¯¾ç¨‹è®¾è®¡ç›®çš„</p><p>æœ¬è¯¾ç¨‹è®¾è®¡æ—¨åœ¨å®ç°ä¸€ä¸ªåŸºäº <strong>TCP åè®®</strong> çš„æ–‡ä»¶ä¼ è¾“ç³»ç»Ÿï¼Œæ¨¡æ‹Ÿå®é™…ç½‘ç»œä¼ è¾“è¿‡ç¨‹ï¼Œå¹¶ç»“åˆå¤šç§æ–‡ä»¶å­˜å‚¨æ–¹æ¡ˆï¼Œå®Œæˆæ–‡ä»¶æ¥æ”¶ä¸ä¿å­˜çš„åç«¯å¤„ç†ã€‚é€šè¿‡è¯¥ç³»ç»Ÿï¼Œå­¦ç”Ÿèƒ½æ·±å…¥ç†è§£ï¼š</p><p>åŸºäº Socket çš„ TCP é€šä¿¡åŸç†ï¼›</p><p>æ–‡ä»¶ä¼ è¾“åè®®çš„è®¾è®¡ä¸å®ç°ï¼›</p><p>ç½‘ç»œç¼–ç¨‹ä¸­æ•°æ®æµçš„å¤„ç†æ–¹å¼ï¼›</p><p>ç»“åˆ Spring Boot å®ŒæˆæœåŠ¡æ¨¡å—å°è£…ï¼›</p><p>å°†ä¼ è¾“åçš„æ–‡ä»¶æŒ‰éœ€ä¿å­˜è‡³æœ¬åœ°æˆ–äº‘å­˜å‚¨ç³»ç»Ÿã€‚</p><p>ä½¿ç”¨gitè¿›è¡Œä»£ç çš„ç‰ˆæœ¬ç®¡ç†å’Œä»£ç æ‰˜ç®¡</p><p>é¡¹ç›®çš„githubåœ°å€ï¼š<strong><a href="https://github.com/mengnankkkk/tcp-file-transfer">https://github.com/mengnankkkk/tcp-file-transfer</a></strong></p><p>2ã€è¯¾ç¨‹è®¾è®¡è¦æ±‚</p><p>å®ç° TCP Serverï¼ŒæŒç»­ç›‘å¬å®¢æˆ·ç«¯è¿æ¥ï¼Œæ¥æ”¶æ–‡ä»¶æ•°æ®æµï¼›</p><p>è®¾è®¡ä¼ è¾“åè®®ï¼Œç¡®ä¿æ–‡ä»¶åã€å¤§å°ã€å†…å®¹ç­‰å®Œæ•´æ¥æ”¶ï¼›</p><p>å®ç°æœåŠ¡ç«¯æ–‡ä»¶ä¿å­˜åŠŸèƒ½ï¼Œæ”¯æŒå¤šç§å­˜å‚¨åç«¯ï¼ˆæœ¬åœ° / è…¾è®¯äº‘ / é˜¿é‡Œäº‘ / MinIOï¼‰ï¼›</p><p>æ–‡ä»¶ä¼ è¾“å®Œæˆåè®°å½•æ–‡ä»¶å…ƒä¿¡æ¯ï¼ˆæ–‡ä»¶åã€æ—¶é—´ï¼‰ï¼›</p><p>æä¾›æ–‡ä»¶åˆ—è¡¨æ¥å£ï¼ˆ/filesï¼‰ä¾›å‰ç«¯æŸ¥çœ‹å·²ä¸Šä¼ æ–‡ä»¶ï¼›</p><p>ä½¿ç”¨ Java + Spring Boot æ„å»ºåç«¯æœåŠ¡ï¼Œæ¨¡å—æ¸…æ™°ï¼Œä¾¿äºæ‰©å±•ï¼›</p><p>3ã€ç›¸å…³çŸ¥è¯†</p><p><strong>Socket</strong> <strong>ç¼–ç¨‹</strong>ï¼šJava ä¸­é€šè¿‡ ServerSocket / Socket å®ç° TCP é€šä¿¡ã€‚</p><p><strong>é˜»å¡å¼ I/O æµå¤„ç†</strong>ï¼šä½¿ç”¨ InputStream / OutputStream å¤„ç†æ–‡ä»¶å­—èŠ‚æµã€‚</p><p><strong>åè®®è®¾è®¡</strong>ï¼šå®¢æˆ·ç«¯æŒ‰é¡ºåºå‘é€æ–‡ä»¶åé•¿åº¦ã€æ–‡ä»¶åã€æ–‡ä»¶å¤§å°ã€æ–‡ä»¶å†…å®¹ï¼›æœåŠ¡ç«¯æŒ‰é¡ºåºè§£æã€‚</p><p><strong>çº¿ç¨‹å¹¶å‘</strong>ï¼šTCP Server é€šå¸¸ä½¿ç”¨çº¿ç¨‹æ± å¤„ç†å¤šä¸ªå®¢æˆ·ç«¯çš„è¿æ¥è¯·æ±‚ã€‚</p><p><strong>Spring Boot</strong> <strong>æ¡†æ¶</strong></p><p>ç»„ä»¶æ³¨å…¥ã€é…ç½®è‡ªåŠ¨åŒ–ï¼›</p><p>ä½¿ç”¨ @Serviceã€@Controller ç­‰æ³¨è§£æ¨¡å—åŒ–ä¸šåŠ¡é€»è¾‘ï¼›</p><p>æ¡ä»¶æ³¨å…¥ï¼ˆ@ConditionalOnPropertyï¼‰å®ç°å¤šå­˜å‚¨é€‚é…ï¼›</p><p><strong>æ–‡ä»¶å­˜å‚¨çŸ¥è¯†</strong></p><p>æœ¬åœ°æ–‡ä»¶ä¿å­˜ï¼šä½¿ç”¨ FileOutputStream å†™å…¥ç£ç›˜ï¼›</p><p>è…¾è®¯äº‘ COSã€é˜¿é‡Œäº‘ OSSã€MinIOï¼šé€šè¿‡å„è‡ª SDK ä¸Šä¼ å¯¹è±¡ï¼›</p><p>ç»Ÿä¸€å°è£…æ¥å£ FileStorageService æŠ½è±¡å­˜å‚¨ç»†èŠ‚ï¼Œæå‡ç³»ç»Ÿè§£è€¦èƒ½åŠ›ï¼›</p><p><strong>Git**</strong>çŸ¥è¯†**</p><p>Gitçš„ç‰ˆæœ¬ç®¡ç†ï¼Œgitçš„ä½¿ç”¨æ•™ç¨‹</p><p>4ã€è¯¾ç¨‹è®¾è®¡åˆ†æ</p><p>æµç¨‹ï¼š</p><p>TCP Client-&gt;TCP Server-&gt;FileStorageService-&gt;æ–‡ä»¶ä¿¡æ¯å†™å…¥åˆ—è¡¨</p><p>åŠŸèƒ½ï¼š</p><p><strong>TCP</strong> <strong>æœåŠ¡ç«¯ï¼ˆFileReceiveServerï¼‰</strong><br> å¯åŠ¨åç›‘å¬æŒ‡å®šç«¯å£ï¼Œæ¥å—æ¥è‡ªå®¢æˆ·ç«¯çš„æ–‡ä»¶ä¼ è¾“è¯·æ±‚ï¼Œå¹¶ä½¿ç”¨çº¿ç¨‹æ± å¤„ç†å¤šä¸ªè¿æ¥</p><p><strong>æ–‡ä»¶å­˜å‚¨æ¨¡å—ï¼ˆFileStorageServiceï¼‰</strong><br> æ ¹æ®é…ç½®è‡ªåŠ¨é€‰æ‹©ä¿å­˜æ–¹å¼ï¼Œæ”¯æŒæœ¬åœ°æˆ–å¯¹è±¡å­˜å‚¨ã€‚</p><p><strong>æ–‡ä»¶ä¿¡æ¯ç®¡ç†ï¼ˆFileListServiceï¼‰</strong><br> ç”¨äºå±•ç¤ºå†å²ä¸Šä¼ æ–‡ä»¶ï¼Œä¾›ç”¨æˆ·æŸ¥çœ‹ã€‚</p><p>5.ç¨‹åºæµ‹è¯•</p><p>springboot@valueæ³¨å…¥æ–‡ä»¶</p><p><img src="file:///C:/Users/ikeife/AppData/Local/Temp/msohtmlclip1/01/clip_image002.jpg" alt="img"></p><p>æ–‡ä»¶ä¸Šä¼ controller</p><p><img src="file:///C:/Users/ikeife/AppData/Local/Temp/msohtmlclip1/01/clip_image004.jpg" alt="img"></p><p>è¿è¡Œé¡¹ç›®ï¼Œreturnlogæ—¥å¿—</p><p><img src="file:///C:/Users/ikeife/AppData/Local/Temp/msohtmlclip1/01/clip_image006.jpg" alt="img"></p><p>Postmanè¿›è¡Œä¸Šä¼ æµ‹è¯•</p><p><img src="file:///C:/Users/ikeife/AppData/Local/Temp/msohtmlclip1/01/clip_image008.jpg" alt="img"></p><p>ä¸Šä¼ ä¸¤æ¬¡å›¾ç‰‡è¯•éªŒ</p><p><img src="file:///C:/Users/ikeife/AppData/Local/Temp/msohtmlclip1/01/clip_image010.jpg" alt="img"></p><p>Logæ—¥å¿—è¿”å›æç¤ºä¿¡æ¯</p><p><img src="file:///C:/Users/ikeife/AppData/Local/Temp/msohtmlclip1/01/clip_image012.jpg" alt="img"></p><p>é˜¿é‡Œäº‘æ¡¶ä¸­å‘ç°æ–‡ä»¶ä¸Šä¼ æˆåŠŸ</p><p><img src="file:///C:/Users/ikeife/AppData/Local/Temp/msohtmlclip1/01/clip_image014.jpg" alt="img"></p><p><img src="file:///C:/Users/ikeife/AppData/Local/Temp/msohtmlclip1/01/clip_image016.jpg" alt="img"></p><p>è…¾è®¯äº‘ä¸Šä¼ serviceåŠŸèƒ½</p><p><img src="file:///C:/Users/ikeife/AppData/Local/Temp/msohtmlclip1/01/clip_image018.jpg" alt="img"></p><p><img src="file:///C:/Users/ikeife/AppData/Local/Temp/msohtmlclip1/01/clip_image020.jpg" alt="img"></p><p><img src="file:///C:/Users/ikeife/AppData/Local/Temp/msohtmlclip1/01/clip_image022.jpg" alt="img"></p><p><img src="file:///C:/Users/ikeife/AppData/Local/Temp/msohtmlclip1/01/clip_image024.jpg" alt="img"></p><p>ä¸‹è½½åŠŸèƒ½</p><p><img src="file:///C:/Users/ikeife/AppData/Local/Temp/msohtmlclip1/01/clip_image026.jpg" alt="img"></p><p>ä¸‹è½½åŠŸèƒ½getåˆ°æ–‡ä»¶</p><p><img src="file:///C:/Users/ikeife/AppData/Local/Temp/msohtmlclip1/01/clip_image028.jpg" alt="img"></p><p>6ã€ç›¸å…³æ‰©å±•å’Œæœªæ¥å¼€å‘å±•æœ›</p><p>ï‚· <strong>æ–‡ä»¶å®Œæ•´æ€§æ ¡éªŒ</strong>ï¼šå®¢æˆ·ç«¯å‘é€æ–‡ä»¶ hash å€¼ï¼ŒæœåŠ¡ç«¯éªŒè¯ä¸€è‡´æ€§ï¼›</p><p>ï‚· <strong>æ–­ç‚¹ç»­ä¼ ä¸å¤šçº¿ç¨‹ä¸Šä¼ </strong>ï¼šä½¿ç”¨æ ‡å¿—ä½å’Œåˆ†ç‰‡æ–‡ä»¶å®ç°ï¼›</p><p>ï‚· <strong>æ–‡ä»¶å‹ç¼©ä¸è§£å‹ä¼ è¾“</strong>ï¼šèŠ‚çœå¸¦å®½ï¼Œæé«˜æ•ˆç‡ï¼›</p><p>ï‚· <strong>TCP + SSL</strong> <strong>åŠ å¯†ä¼ è¾“</strong>ï¼šä¿éšœæ–‡ä»¶å®‰å…¨ï¼›</p><p>ï‚· <strong>å‰ç«¯å¯è§†åŒ–é¡µé¢</strong>ï¼šå±•ç¤ºä¸Šä¼ è®°å½•ã€å®æ—¶ä¼ è¾“çŠ¶æ€ï¼›</p><p>ï‚· <strong>æœåŠ¡ç«¯ä¸Šä¼ è¿›åº¦å›è°ƒ</strong>ï¼šé€šè¿‡ WebSocket æ¨é€ä¸Šä¼ è¿›åº¦ï¼›</p><p>ï‚· <strong>å¤šå­˜å‚¨è”é‚¦æ¨¡å¼</strong>ï¼šæŒ‰æ–‡ä»¶ç±»å‹æˆ–å¤§å°è‡ªåŠ¨é€‰æ‹©ä¸åŒå­˜å‚¨åç«¯ï¼›</p><p>ï‚· <strong>Docker</strong> <strong>å®¹å™¨éƒ¨ç½² TCP æœåŠ¡ç«¯ä¸æ–‡ä»¶æœåŠ¡</strong>ï¼šä¾¿äºéƒ¨ç½²ä¸æµ‹è¯•ï¼›</p>]]></content:encoded>
      
      
      <category domain="https://blog.tokenlen.top/categories/java/">java</category>
      
      <category domain="https://blog.tokenlen.top/categories/java/%E9%A1%B9%E7%9B%AE/">é¡¹ç›®</category>
      
      
      <category domain="https://blog.tokenlen.top/tags/java/">java</category>
      
      <category domain="https://blog.tokenlen.top/tags/spring-boot/">spring boot</category>
      
      
      <comments>https://blog.tokenlen.top/2025/05/21/workmenu/tcpfile/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>javaseé¢è¯•é¢˜ç›®hot1åŸºç¡€</title>
      <link>https://blog.tokenlen.top/2025/05/19/javase/javase2/</link>
      <guid>https://blog.tokenlen.top/2025/05/19/javase/javase2/</guid>
      <pubDate>Sun, 18 May 2025 16:00:00 GMT</pubDate>
      
        
        
          
          
      <description>&lt;h1 id=&quot;åŸºç¡€é¢è¯•é¢˜ç›®&quot;&gt;&lt;a href=&quot;#åŸºç¡€é¢è¯•é¢˜ç›®&quot; class=&quot;headerlink&quot; title=&quot;åŸºç¡€é¢è¯•é¢˜ç›®&quot;&gt;&lt;/a&gt;åŸºç¡€é¢è¯•é¢˜ç›®&lt;/h1&gt;&lt;h2 id=&quot;æ¦‚å¿µ&quot;&gt;&lt;a href=&quot;#æ¦‚å¿µ&quot; class=&quot;headerlink&quot;</description>
          
        
      
      
      
      <content:encoded><![CDATA[<h1 id="åŸºç¡€é¢è¯•é¢˜ç›®"><a href="#åŸºç¡€é¢è¯•é¢˜ç›®" class="headerlink" title="åŸºç¡€é¢è¯•é¢˜ç›®"></a>åŸºç¡€é¢è¯•é¢˜ç›®</h1><h2 id="æ¦‚å¿µ"><a href="#æ¦‚å¿µ" class="headerlink" title="æ¦‚å¿µ"></a>æ¦‚å¿µ</h2><h3 id="1-è¯´ä¸€ä¸‹Javaçš„ç‰¹ç‚¹"><a href="#1-è¯´ä¸€ä¸‹Javaçš„ç‰¹ç‚¹" class="headerlink" title="1.è¯´ä¸€ä¸‹Javaçš„ç‰¹ç‚¹"></a>1.è¯´ä¸€ä¸‹Javaçš„ç‰¹ç‚¹</h3><p><strong>å¹³å°æ— å…³æ€§</strong>ï¼šJavaçš„ç¼–å†™ä¸€æ¬¡ï¼Œè¿æ— ä¸åœ¨â€å“²å­¦æ˜¯å…¶æœ€å¤§çš„ç‰¹ç‚¹ä¹‹ä¸€ã€‚Javaç¼–è¯‘å™¨å°†æºä»£ç ç¼–è¯‘æˆå­—èŠ‚ç ï¼ˆbytecodeï¼‰ï¼Œè¯¥å­—èŠ‚ç å¯ä»¥åœ¨ä»»ä½•å®‰è£…äº†Javaè™šæ‹Ÿæœºï¼ˆJVMï¼‰çš„ç³»ç»Ÿä¸Šè¿è¡Œã€‚<br><strong>é¢å‘å¯¹è±¡</strong>ï¼šJaVaæ˜¯ä¸€ä¸¥æ ¼çš„é¢å¯å¯¹è±¡ç¼–ç¨‹è¯­è¨€ï¼Œå‡ ä¹ä¸€åˆ‡éƒ½æ˜¯å¯¹è±¡ã€‚é¢å¯å¯¹è±¡ç¼–ç¨‹ï¼ˆOOPï¼‰ç‰¹æ€§ä½¿å¾—ä»£ç æ›´æ˜“äºç»´æŠ¤å’Œé‡ç”¨ï¼ŒåŒ…æ‹¬ç±»ï¼ˆclassï¼‰ã€å¯¹è±¡ï¼ˆobjectï¼‰ã€ç»§æ‰¿ï¼ˆinheritanceï¼‰ã€å¤šæ€ã€€(polymorphismï¼‰ã€æŠ½è±¡ï¼ˆabstractionï¼‰å’Œå°è£…ï¼ˆencapsulationï¼‰ã€‚<br><strong>å†…å­˜ç®¡ç†</strong>ï¼šJaVaæœ‰ç›®å·±çš„åƒåœ¾å›æ”¶æœºåˆ¶ï¼Œç›®åŠ¨ç®¡ç†å†…å­˜å’Œå›æ”¶ä¸å†ä½¿ç”¨çš„å¯¹è±¡ã€‚è¿™æ ·ï¼Œå¼€å‘è€…ä¸éœ€è¦æ‰‹åŠ¨ç®¡åŸ‹å†…å­˜ï¼Œä»è€Œå‡å°‘å†…å­˜æ³„æ¼å’Œå…¶ä»–å†…å­˜ç›¸å…³çš„é—®é¢˜ã€‚</p><h3 id="2-Java-çš„ä¼˜åŠ¿å’ŒåŠ£åŠ¿æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#2-Java-çš„ä¼˜åŠ¿å’ŒåŠ£åŠ¿æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="2.Java çš„ä¼˜åŠ¿å’ŒåŠ£åŠ¿æ˜¯ä»€ä¹ˆï¼Ÿ"></a>2.Java çš„ä¼˜åŠ¿å’ŒåŠ£åŠ¿æ˜¯ä»€ä¹ˆï¼Ÿ</h3><p>é¦–å…ˆï¼ŒJavaçš„ä¼˜åŠ¿ï¼Œæˆ‘è®°å¾—<strong>è·¨å¹³å°</strong>åº”è¯¥æ˜¯ä¸€ä¸ªå¤§ç‚¹ï¼Œå› ä¸º<strong>JVM</strong>çš„å­˜åœ¨ï¼Œä¸€æ¬¡ç¼–å†™åˆ°å¤„è¿è¡Œã€‚ç„¶å<strong>é¢å‘å¯¹è±¡</strong>ï¼Œè¿™ä¸ªå¯èƒ½ä¹Ÿæ˜¯ä¼˜åŠ¿ï¼Œä¸è¿‡ç°åœ¨å¾ˆå¤šè¯­è¨€éƒ½æ”¯æŒé¢å‘å¯¹è±¡ï¼Œä½†æ˜¯Javaçš„è®¾è®¡ä»ä¸€å¼€å§‹å°±æ˜¯OOPçš„ã€‚è¿˜æœ‰<strong>å¼ºå¤§çš„ç”Ÿæ€ç³»ç»Ÿ</strong>ï¼Œæ¯”å¦‚Springæ¡†æ¶ï¼ŒHibernateï¼Œå„ç§åº“å’Œå·¥å…·ï¼Œç¤¾åŒºæ”¯æŒå¤§ï¼Œä¼ä¸šåº”ç”¨å¹¿æ³›ã€‚å¦å¤–ï¼Œ<strong>å†…å­˜ç®¡ç†æ–¹é¢</strong>ï¼Œè‡ªåŠ¨åƒåœ¾å›æ”¶æœºåˆ¶ï¼Œå‡å°‘äº†å†…å­˜æ³„æ¼çš„é—®é¢˜ï¼Œå¯¹å¼€å‘è€…å‹å¥½ã€‚<strong>è¿˜æœ‰å¤šçº¿ç¨‹æ”¯æŒ</strong>ï¼Œå†…ç½®çš„çº¿ç¨‹æœºåˆ¶ï¼Œæ–¹ä¾¿å¹¶å‘ç¼–ç¨‹ã€‚å®‰å…¨æ€§æ–¹é¢ï¼Œ<strong>Javaæœ‰å®‰å…¨æ¨¡å‹</strong>ï¼Œæ¯”å¦‚æ²™ç®±æœºåˆ¶ï¼Œé€‚åˆç½‘ç»œç¯å¢ƒã€‚è¿˜æœ‰ç¨³å®šæ€§ï¼Œä¼ä¸šçº§åº”ç”¨é•¿æœŸä½¿ç”¨ï¼Œç‰ˆæœ¬æ›´æ–°ä¹Ÿæ¯”è¾ƒæ³¨é‡å‘åå…¼å®¹ã€‚</p><p>åŠ£åŠ¿çš„è¯ï¼Œ<strong>æ€§èƒ½</strong>å¯èƒ½æ˜¯ä¸€ä¸ªï¼Œè™½ç„¶JVMä¼˜åŒ–äº†å¾ˆå¤šï¼Œä½†ç›¸æ¯”C++æˆ–è€…Rustè¿™ç§åŸç”Ÿç¼–è¯‘è¯­è¨€ï¼Œè¿˜æ˜¯æœ‰ä¸€å®šå¼€é”€ã€‚<strong>ç‰¹åˆ«æ˜¯å¯åŠ¨æ—¶é—´</strong>ï¼Œæ¯”å¦‚å¾®æœåŠ¡åœºæ™¯ä¸‹ï¼Œå¯èƒ½ä¸å¦‚Goä¹‹ç±»çš„å¿«ã€‚è¯­æ³•ç¹çï¼Œæ¯”å¦‚æ ·æ¿ä»£ç å¤šï¼Œä¹‹å‰æ²¡æœ‰lambdaçš„æ—¶å€™æ›´éº»çƒ¦ï¼Œç°åœ¨æœ‰äº†ä½†æ¯”èµ·Pythonè¿˜æ˜¯<strong>ä¸å¤Ÿç®€æ´</strong>ã€‚å†…å­˜æ¶ˆè€—ï¼Œ<strong>JVMæœ¬èº«å å†…å­˜ï¼Œå¯¹äºèµ„æºæœ‰é™çš„ç¯å¢ƒå¯èƒ½ä¸å¤ªå‹å¥½</strong>ã€‚<strong>è¿˜æœ‰é¢å‘å¯¹è±¡è¿‡äºä¸¥æ ¼</strong>ï¼Œæœ‰æ—¶å€™å†™ç®€å•ç¨‹åºåè€Œéº»çƒ¦ï¼Œè™½ç„¶Java8å¼•å…¥äº†å‡½æ•°å¼ç¼–ç¨‹ï¼Œä½†ä¸å¦‚å…¶ä»–è¯­è¨€è‡ªç„¶ã€‚è¿˜æœ‰å¼€å‘æ•ˆç‡ï¼Œç›¸æ¯”åŠ¨æ€è¯­è¨€å¦‚Pythonï¼Œ<strong>Javaéœ€è¦æ›´å¤šä»£ç ï¼Œç¼–è¯‘è¿‡ç¨‹ä¹Ÿå¯èƒ½æ‹–æ…¢å¼€å‘èŠ‚å¥ã€‚</strong></p><h3 id="3-Javaä¸ºä»€ä¹ˆæ˜¯è·¨å¹³å°çš„ï¼Ÿ"><a href="#3-Javaä¸ºä»€ä¹ˆæ˜¯è·¨å¹³å°çš„ï¼Ÿ" class="headerlink" title="3.Javaä¸ºä»€ä¹ˆæ˜¯è·¨å¹³å°çš„ï¼Ÿ"></a>3.Javaä¸ºä»€ä¹ˆæ˜¯è·¨å¹³å°çš„ï¼Ÿ</h3><p> Java èƒ½æ”¯æŒè·¨å¹³å°ï¼Œä¸»è¦ä¾èµ–äº <strong>JVM</strong> å…³ç³»æ¯”è¾ƒå¤§ã€‚</p><p><strong>JVMä¹Ÿæ˜¯ä¸€ä¸ªè½¯ä»¶ï¼Œä¸åŒçš„å¹³å°æœ‰ä¸åŒçš„ç‰ˆæœ¬</strong>ã€‚æˆ‘ä»¬ç¼–å†™çš„Javaæºç ï¼Œç¼–è¯‘åä¼šç”Ÿæˆä¸€ç§ .class æ–‡ä»¶ï¼Œç§°ä¸ºå­—èŠ‚ç æ–‡ä»¶ã€‚<strong>Javaè™šæ‹Ÿæœºå°±æ˜¯è´Ÿè´£å°†å­—èŠ‚ç æ–‡ä»¶ç¿»è¯‘æˆç‰¹å®šå¹³å°ä¸‹çš„æœºå™¨ç ç„¶åè¿è¡Œã€‚</strong>ä¹Ÿå°±æ˜¯è¯´ï¼Œåªè¦åœ¨ä¸åŒå¹³å°ä¸Šå®‰è£…å¯¹åº”çš„JVMï¼Œå°±å¯ä»¥è¿è¡Œå­—èŠ‚ç æ–‡ä»¶ï¼Œè¿è¡Œæˆ‘ä»¬ç¼–å†™çš„Javaç¨‹åºã€‚</p><p>JVMæ˜¯ä¸€ä¸ªâ€æ¡¥æ¢â€œï¼Œæ˜¯ä¸€ä¸ªâ€ä¸­é—´ä»¶â€œï¼Œæ˜¯å®ç°è·¨å¹³å°çš„å…³é”®ï¼ŒJavaä»£ç é¦–å…ˆè¢«ç¼–è¯‘æˆå­—èŠ‚ç æ–‡ä»¶ï¼Œå†ç”±JVMå°†å­—èŠ‚ç æ–‡ä»¶ç¿»è¯‘æˆæœºå™¨è¯­è¨€ï¼Œä»è€Œè¾¾åˆ°è¿è¡ŒJavaç¨‹åºçš„ç›®çš„ã€‚</p><p>ç¼–è¯‘çš„ç»“æœä¸æ˜¯ç”Ÿæˆæœºå™¨ç ï¼Œè€Œæ˜¯ç”Ÿæˆå­—èŠ‚ç ï¼Œå­—èŠ‚ç ä¸èƒ½ç›´æ¥è¿è¡Œï¼Œå¿…é¡»é€šè¿‡JVMç¿»è¯‘æˆæœºå™¨ç æ‰èƒ½è¿è¡Œã€‚ä¸åŒå¹³å°ä¸‹ç¼–è¯‘ç”Ÿæˆçš„å­—èŠ‚ç æ˜¯ä¸€æ ·çš„ï¼Œä½†æ˜¯ç”±JVMç¿»è¯‘æˆçš„æœºå™¨ç å´ä¸ä¸€æ ·ã€‚</p><p>æ‰€ä»¥ï¼Œè¿è¡ŒJavaç¨‹åºå¿…é¡»æœ‰JVMçš„æ”¯æŒï¼Œå› ä¸ºç¼–è¯‘çš„ç»“æœä¸æ˜¯æœºå™¨ç ï¼Œå¿…é¡»è¦ç»è¿‡JVMçš„å†æ¬¡ç¿»è¯‘æ‰èƒ½æ‰§è¡Œã€‚å³ä½¿ä½ å°†Javaç¨‹åºæ‰“åŒ…æˆå¯æ‰§è¡Œæ–‡ä»¶ï¼ˆä¾‹å¦‚ .exeï¼‰ï¼Œä»ç„¶éœ€è¦JVMçš„æ”¯æŒã€‚</p><h3 id="4-JVMã€JDKã€JREä¸‰è€…å…³ç³»ï¼Ÿ"><a href="#4-JVMã€JDKã€JREä¸‰è€…å…³ç³»ï¼Ÿ" class="headerlink" title="4.JVMã€JDKã€JREä¸‰è€…å…³ç³»ï¼Ÿ"></a>4.JVMã€JDKã€JREä¸‰è€…å…³ç³»ï¼Ÿ</h3><ul><li><strong>JVM</strong>æ˜¯Javaè™šæ‹Ÿæœºï¼Œ<strong>æ˜¯Javaç¨‹åºè¿è¡Œçš„ç¯å¢ƒ</strong>ã€‚å®ƒè´Ÿè´£å°†Javaå­—èŠ‚ç ï¼ˆç”±Javaç¼–è¯‘å™¨ç”Ÿæˆï¼‰è§£é‡Šæˆ–ç¼–è¯‘æˆæœºå™¨ç ï¼Œå¹¶æ‰§è¡Œç¨‹åºã€‚JVMæä¾›äº†å†…å­˜ç®¡ç†ã€åƒåœ¾å›æ”¶ã€å®‰å…¨æ€§ç­‰åŠŸèƒ½ï¼Œä½¿å¾—Javaç¨‹åºå…·å¤‡è·¨å¹³å°æ€§ã€‚</li><li><strong>JDK</strong>æ˜¯Javaå¼€å‘å·¥å…·åŒ…ï¼Œ<strong>æ˜¯å¼€å‘Javaç¨‹åºæ‰€éœ€çš„å·¥å…·é›†åˆ</strong>ã€‚å®ƒåŒ…å«äº†JVMã€ç¼–è¯‘å™¨ï¼ˆjavacï¼‰ã€è°ƒè¯•å™¨ï¼ˆjdbï¼‰ç­‰å¼€å‘å·¥å…·ï¼Œä»¥åŠä¸€ç³»åˆ—çš„ç±»åº“ï¼ˆå¦‚Javaæ ‡å‡†åº“å’Œå¼€å‘å·¥å…·åº“ï¼‰ã€‚<strong>JDKæä¾›äº†å¼€å‘ã€ç¼–è¯‘ã€è°ƒè¯•å’Œè¿è¡ŒJavaç¨‹åºæ‰€éœ€çš„å…¨éƒ¨å·¥å…·å’Œç¯å¢ƒã€‚</strong></li><li><strong>JRE</strong>æ˜¯Javaè¿è¡Œæ—¶ç¯å¢ƒï¼Œ<strong>æ˜¯Javaç¨‹åºè¿è¡Œæ‰€éœ€çš„æœ€å°ç¯å¢ƒ</strong>ã€‚å®ƒåŒ…å«äº†JVMå’Œä¸€ç»„Javaç±»åº“ï¼Œç”¨äºæ”¯æŒJavaç¨‹åºçš„æ‰§è¡Œã€‚<strong>JREä¸åŒ…å«å¼€å‘å·¥å…·ï¼Œåªæä¾›Javaç¨‹åºè¿è¡Œæ‰€éœ€çš„è¿è¡Œç¯å¢ƒã€‚</strong></li></ul><h3 id="5-ä¸ºä»€ä¹ˆJavaè§£é‡Šå’Œç¼–è¯‘éƒ½æœ‰ï¼Ÿ"><a href="#5-ä¸ºä»€ä¹ˆJavaè§£é‡Šå’Œç¼–è¯‘éƒ½æœ‰ï¼Ÿ" class="headerlink" title="5.ä¸ºä»€ä¹ˆJavaè§£é‡Šå’Œç¼–è¯‘éƒ½æœ‰ï¼Ÿ"></a>5.ä¸ºä»€ä¹ˆJavaè§£é‡Šå’Œç¼–è¯‘éƒ½æœ‰ï¼Ÿ</h3><p>é¦–å…ˆåœ¨Javaç»è¿‡ç¼–è¯‘ä¹‹åç”Ÿæˆå­—èŠ‚ç æ–‡ä»¶ï¼Œæ¥ä¸‹æ¥è¿›å…¥JVMä¸­ï¼Œå°±æœ‰ä¸¤ä¸ªæ­¥éª¤ç¼–è¯‘å’Œè§£é‡Šã€‚ å¦‚ä¸‹å›¾ï¼š</p><p><img src="https://cdn.xiaolincoding.com//picgo/1715928000183-44fc6130-8abc-4f0b-8f6d-79de0ab09509.webp" alt=""></p><p><strong>ç¼–è¯‘æ€§</strong>ï¼š</p><ul><li>Javaæºä»£ç é¦–å…ˆè¢«ç¼–è¯‘æˆå­—èŠ‚ç ï¼ŒJIT ä¼šæŠŠç¼–è¯‘è¿‡çš„æœºå™¨ç ä¿å­˜èµ·æ¥,ä»¥å¤‡ä¸‹æ¬¡ä½¿ç”¨ã€‚</li></ul><p><strong>è§£é‡Šæ€§ï¼š</strong></p><ul><li>JVMä¸­ä¸€ä¸ª<strong>æ–¹æ³•è°ƒç”¨è®¡æ•°å™¨ï¼Œå½“ç´¯è®¡è®¡æ•°å¤§äºä¸€å®šå€¼çš„æ—¶å€™ï¼Œå°±ä½¿ç”¨JITè¿›è¡Œç¼–è¯‘ç”Ÿæˆæœºå™¨ç æ–‡ä»¶ã€‚</strong>å¦åˆ™å°±æ˜¯ç”¨è§£é‡Šå™¨è¿›è¡Œè§£é‡Šæ‰§è¡Œï¼Œç„¶åå­—èŠ‚ç ä¹Ÿæ˜¯ç»è¿‡è§£é‡Šå™¨è¿›è¡Œè§£é‡Šè¿è¡Œçš„ã€‚</li></ul><p>æ‰€ä»¥Javaæ—¢æ˜¯<strong>ç¼–è¯‘å‹ä¹Ÿæ˜¯è§£é‡Šæ€§è¯­è¨€</strong>ï¼Œé»˜è®¤é‡‡ç”¨çš„æ˜¯è§£é‡Šå™¨å’Œç¼–è¯‘å™¨æ··åˆçš„æ¨¡å¼ã€‚</p><h3 id="6-jvmæ˜¯ä»€ä¹ˆ"><a href="#6-jvmæ˜¯ä»€ä¹ˆ" class="headerlink" title="6.jvmæ˜¯ä»€ä¹ˆ"></a>6.jvmæ˜¯ä»€ä¹ˆ</h3><p>JVMæ˜¯ <strong>java è™šæ‹Ÿæœº</strong>ï¼Œä¸»è¦å·¥ä½œæ˜¯<strong>è§£é‡Šè‡ªå·±çš„æŒ‡ä»¤é›†ï¼ˆå³å­—èŠ‚ç ï¼‰å¹¶æ˜ å°„åˆ°æœ¬åœ°çš„CPUæŒ‡ä»¤é›†å’ŒOSçš„ç³»ç»Ÿè°ƒç”¨ã€‚</strong></p><p>JVMå±è”½äº†ä¸æ“ä½œç³»ç»Ÿå¹³å°ç›¸å…³çš„ä¿¡æ¯ï¼Œä½¿å¾—Javaç¨‹åºåªéœ€è¦ç”Ÿæˆåœ¨Javaè™šæ‹Ÿæœºä¸Šè¿è¡Œçš„ç›®æ ‡ä»£ç ï¼ˆå­—èŠ‚ç ï¼‰ï¼Œå°±å¯åœ¨å¤šç§å¹³å°ä¸Šä¸åŠ ä¿®æ”¹çš„è¿è¡Œï¼Œè¿™ä¹Ÿæ˜¯Javaèƒ½å¤Ÿâ€œ<strong>ä¸€æ¬¡ç¼–è¯‘ï¼Œåˆ°å¤„è¿è¡Œçš„</strong>â€åŸå› ã€‚</p><h3 id="7-ç¼–è¯‘å‹è¯­è¨€å’Œè§£é‡Šå‹è¯­è¨€çš„åŒºåˆ«ï¼Ÿ"><a href="#7-ç¼–è¯‘å‹è¯­è¨€å’Œè§£é‡Šå‹è¯­è¨€çš„åŒºåˆ«ï¼Ÿ" class="headerlink" title="7.ç¼–è¯‘å‹è¯­è¨€å’Œè§£é‡Šå‹è¯­è¨€çš„åŒºåˆ«ï¼Ÿ"></a>7.<strong>ç¼–è¯‘å‹è¯­è¨€å’Œè§£é‡Šå‹è¯­è¨€çš„åŒºåˆ«ï¼Ÿ</strong></h3><p>ç¼–è¯‘å‹è¯­è¨€å’Œè§£é‡Šå‹è¯­è¨€çš„åŒºåˆ«åœ¨äºï¼š</p><ul><li>ç¼–è¯‘å‹è¯­è¨€ï¼šåœ¨ç¨‹åºæ‰§è¡Œä¹‹å‰ï¼Œæ•´ä¸ªæºä»£ç ä¼šè¢«ç¼–è¯‘æˆæœºå™¨ç æˆ–è€…å­—èŠ‚ç ï¼Œç”Ÿæˆå¯æ‰§è¡Œæ–‡ä»¶ã€‚æ‰§è¡Œæ—¶ç›´æ¥<strong>è¿è¡Œç¼–è¯‘åçš„ä»£ç ï¼Œé€Ÿåº¦å¿«ï¼Œä½†è·¨å¹³å°æ€§è¾ƒå·®</strong>ã€‚</li><li>è§£é‡Šå‹è¯­è¨€ï¼šåœ¨ç¨‹åºæ‰§è¡Œæ—¶ï¼Œé€è¡Œè§£é‡Šæ‰§è¡Œæºä»£ç ï¼Œä¸ç”Ÿæˆç‹¬ç«‹çš„å¯æ‰§è¡Œæ–‡ä»¶ã€‚é€šå¸¸ç”±<strong>è§£é‡Šå™¨åŠ¨æ€è§£é‡Šå¹¶æ‰§è¡Œä»£ç ï¼Œè·¨å¹³å°æ€§å¥½ï¼Œä½†æ‰§è¡Œé€Ÿåº¦ç›¸å¯¹è¾ƒæ…¢ã€‚</strong></li><li>å…¸å‹çš„ç¼–è¯‘å‹è¯­è¨€å¦‚Cã€C++ï¼Œå…¸å‹çš„è§£é‡Šå‹è¯­è¨€å¦‚Pythonã€JavaScriptã€‚</li></ul><h2 id="æ•°æ®ç±»å‹"><a href="#æ•°æ®ç±»å‹" class="headerlink" title="æ•°æ®ç±»å‹"></a>æ•°æ®ç±»å‹</h2><h3 id="1-å…«ç§åŸºæœ¬çš„æ•°æ®ç±»å‹"><a href="#1-å…«ç§åŸºæœ¬çš„æ•°æ®ç±»å‹" class="headerlink" title="1.å…«ç§åŸºæœ¬çš„æ•°æ®ç±»å‹"></a>1.å…«ç§åŸºæœ¬çš„æ•°æ®ç±»å‹</h3><p>Javaæ”¯æŒæ•°æ®ç±»å‹åˆ†ä¸ºä¸¤ç±»ï¼š åŸºæœ¬æ•°æ®ç±»å‹å’Œå¼•ç”¨æ•°æ®ç±»å‹ã€‚</p><p>åŸºæœ¬æ•°æ®ç±»å‹å…±æœ‰8ç§ï¼Œå¯ä»¥åˆ†ä¸ºä¸‰ç±»ï¼š</p><ul><li>æ•°å€¼å‹ï¼šæ•´æ•°ç±»å‹ï¼ˆbyteã€shortã€intã€longï¼‰å’Œæµ®ç‚¹ç±»å‹ï¼ˆfloatã€doubleï¼‰</li><li>å­—ç¬¦å‹ï¼šchar</li><li>å¸ƒå°”å‹ï¼šboolean</li></ul><p>8ç§åŸºæœ¬æ•°æ®ç±»å‹çš„é»˜è®¤å€¼ã€ä½æ•°ã€å–å€¼èŒƒå›´ï¼Œå¦‚ä¸‹è¡¨æ‰€ç¤ºï¼š</p><div class="table-container"><table><thead><tr><th>æ•°æ®ç±»å‹</th><th>å ç”¨å¤§å°ï¼ˆå­—èŠ‚ï¼‰</th><th>ä½æ•°</th><th>å–å€¼èŒƒå›´</th><th>é»˜è®¤å€¼</th><th>æè¿°</th></tr></thead><tbody><tr><td><code>byte</code></td><td>1</td><td>8</td><td>-128ï¼ˆ-2^7ï¼‰ åˆ° 127ï¼ˆ2^7 - 1ï¼‰</td><td>0</td><td>æ˜¯æœ€å°çš„æ•´æ•°ç±»å‹ï¼Œé€‚åˆç”¨äºèŠ‚çœå†…å­˜ï¼Œä¾‹å¦‚åœ¨å¤„ç†æ–‡ä»¶æˆ–ç½‘ç»œæµæ—¶å­˜å‚¨å°èŒƒå›´æ•´æ•°æ•°æ®ã€‚</td></tr><tr><td><code>short</code></td><td>2</td><td>16</td><td>-32768ï¼ˆ-2^15ï¼‰ åˆ° 32767ï¼ˆ2^15 - 1ï¼‰</td><td>0</td><td>è¾ƒå°‘ä½¿ç”¨ï¼Œé€šå¸¸ç”¨äºåœ¨éœ€è¦èŠ‚çœå†…å­˜ä¸”æ•°å€¼èŒƒå›´åœ¨è¯¥åŒºé—´çš„åœºæ™¯ã€‚</td></tr><tr><td><code>int</code></td><td>4</td><td>32</td><td>-2147483648ï¼ˆ-2^31ï¼‰ åˆ° 2147483647ï¼ˆ2^31 - 1ï¼‰</td><td>0</td><td>æœ€å¸¸ç”¨çš„æ•´æ•°ç±»å‹ï¼Œå¯æ»¡è¶³å¤§å¤šæ•°æ—¥å¸¸ç¼–ç¨‹ä¸­æ•´æ•°è®¡ç®—çš„éœ€æ±‚ã€‚</td></tr><tr><td><code>long</code></td><td>8</td><td>64</td><td>-9223372036854775808ï¼ˆ-2^63ï¼‰ åˆ° 9223372036854775807ï¼ˆ2^63 - 1ï¼‰</td><td>0L</td><td>ç”¨äºè¡¨ç¤ºéå¸¸å¤§çš„æ•´æ•°ï¼Œå½“ <code>int</code> ç±»å‹æ— æ³•æ»¡è¶³éœ€æ±‚æ—¶ä½¿ç”¨ï¼Œå®šä¹‰æ—¶æ•°å€¼åéœ€åŠ  <code>L</code> æˆ– <code>l</code>ã€‚</td></tr><tr><td><code>float</code></td><td>4</td><td>32</td><td>1.4E - 45 åˆ° 3.4028235E38</td><td>0.0f</td><td>å•ç²¾åº¦æµ®ç‚¹æ•°ï¼Œç”¨äºè¡¨ç¤ºå°æ•°ï¼Œç²¾åº¦ç›¸å¯¹è¾ƒä½ï¼Œå®šä¹‰æ—¶æ•°å€¼åéœ€åŠ  <code>F</code> æˆ– <code>f</code>ã€‚</td></tr><tr><td><code>double</code></td><td>8</td><td>64</td><td>4.9E - 324 åˆ° 1.7976931348623157E308</td><td>0.0d</td><td>åŒç²¾åº¦æµ®ç‚¹æ•°ï¼Œç²¾åº¦æ¯” <code>float</code> é«˜ï¼Œæ˜¯ Java ä¸­è¡¨ç¤ºå°æ•°çš„é»˜è®¤ç±»å‹ã€‚</td></tr><tr><td><code>char</code></td><td>2</td><td>16</td><td>â€˜\u0000â€™ï¼ˆ0ï¼‰ åˆ° â€˜\uffffâ€™ï¼ˆ65535ï¼‰</td><td>â€˜\u0000â€™</td><td>ç”¨äºè¡¨ç¤ºå•ä¸ªå­—ç¬¦ï¼Œé‡‡ç”¨ Unicode ç¼–ç ï¼Œå¯è¡¨ç¤ºå„ç§è¯­è¨€çš„å­—ç¬¦ã€‚</td></tr><tr><td><code>boolean</code></td><td>æ— æ˜ç¡®å­—èŠ‚å¤§å°ï¼ˆç†è®ºä¸Š 1 ä½ï¼‰</td><td>æ— æ˜ç¡®ä½æ•°</td><td><code>true</code> æˆ– <code>false</code></td><td><code>false</code></td><td>ç”¨äºé€»è¾‘åˆ¤æ–­ï¼Œåªæœ‰ä¸¤ä¸ªå–å€¼ï¼Œå¸¸ç”¨äºæ¡ä»¶åˆ¤æ–­å’Œå¾ªç¯æ§åˆ¶ç­‰é€»è¾‘åœºæ™¯ã€‚</td></tr></tbody></table></div><ul><li>Javaå…«ç§åŸºæœ¬æ•°æ®ç±»å‹çš„å­—èŠ‚æ•°ï¼š1å­—èŠ‚(byteã€boolean)ã€ 2å­—èŠ‚(shortã€char)ã€4å­—èŠ‚(intã€float)ã€8å­—èŠ‚(longã€double)</li><li>æµ®ç‚¹æ•°çš„é»˜è®¤ç±»å‹ä¸ºdoubleï¼ˆå¦‚æœéœ€è¦å£°æ˜ä¸€ä¸ªå¸¸é‡ä¸ºfloatå‹ï¼Œåˆ™å¿…é¡»è¦åœ¨æœ«å°¾åŠ ä¸Šfæˆ–Fï¼‰</li><li>æ•´æ•°çš„é»˜è®¤ç±»å‹ä¸ºintï¼ˆå£°æ˜Longå‹åœ¨æœ«å°¾åŠ ä¸Šlæˆ–è€…Lï¼‰</li><li>å…«ç§åŸºæœ¬æ•°æ®ç±»å‹çš„åŒ…è£…ç±»ï¼šé™¤äº†charçš„æ˜¯Characterã€intç±»å‹çš„æ˜¯Integerï¼Œå…¶ä»–éƒ½æ˜¯é¦–å­—æ¯å¤§å†™</li><li>charç±»å‹æ˜¯æ— ç¬¦å·çš„ï¼Œä¸èƒ½ä¸ºè´Ÿï¼Œæ‰€ä»¥æ˜¯0å¼€å§‹çš„</li></ul><h3 id="2-intå’Œlongæ˜¯å¤šå°‘ä½ï¼Œå¤šå°‘å­—èŠ‚çš„ï¼Ÿ"><a href="#2-intå’Œlongæ˜¯å¤šå°‘ä½ï¼Œå¤šå°‘å­—èŠ‚çš„ï¼Ÿ" class="headerlink" title="2.intå’Œlongæ˜¯å¤šå°‘ä½ï¼Œå¤šå°‘å­—èŠ‚çš„ï¼Ÿ"></a>2.intå’Œlongæ˜¯å¤šå°‘ä½ï¼Œå¤šå°‘å­—èŠ‚çš„ï¼Ÿ</h3><ul><li><code>int</code>ç±»å‹æ˜¯ <strong>32 ä½ï¼ˆbitï¼‰ï¼Œå  4 ä¸ªå­—èŠ‚ï¼ˆbyteï¼‰</strong>ï¼Œint æ˜¯æœ‰ç¬¦å·æ•´æ•°ç±»å‹ï¼Œå…¶å–å€¼èŒƒå›´æ˜¯ä» <strong>-2^31 åˆ° 2^31-1</strong> ã€‚ä¾‹å¦‚ï¼Œåœ¨ä¸€ä¸ªç®€å•çš„è®¡æ•°å™¨ç¨‹åºä¸­ï¼Œå¦‚æœä½¿ç”¨<code>int</code>ç±»å‹æ¥å­˜å‚¨è®¡æ•°å€¼ï¼Œå®ƒå¯ä»¥è¡¨ç¤ºçš„æœ€å¤§æ­£æ•°æ˜¯ <strong>2,147,483,647</strong>ã€‚å¦‚æœè®¡æ•°å€¼è¶…è¿‡è¿™ä¸ªèŒƒå›´ï¼Œå°±ä¼šå‘ç”Ÿæº¢å‡ºï¼Œå¯¼è‡´ç»“æœä¸ç¬¦åˆé¢„æœŸã€‚</li><li><code>long</code>ç±»å‹æ˜¯ <strong>64 ä½ï¼Œå  8 ä¸ªå­—èŠ‚</strong>ï¼Œ<code>long</code>ç±»å‹ä¹Ÿæ˜¯æœ‰ç¬¦å·æ•´æ•°ç±»å‹ï¼Œå®ƒçš„å–å€¼èŒƒå›´æ˜¯ä» <strong>-2^63 åˆ° 2^63 -1</strong> ï¼Œåœ¨å¤„ç†è¾ƒå¤§çš„æ•´æ•°æ•°å€¼æ—¶ï¼Œæœ<code>int</code>ç±»å‹çš„å–å€¼èŒƒå›´ä¸å¤Ÿï¼Œå°±éœ€è¦ä½¿ç”¨<code>long</code>ç±»å‹ã€‚ä¾‹å¦‚ï¼Œåœ¨ä¸€ä¸ªæ–‡ä»¶ä¼ è¾“ç¨‹åºä¸­ï¼Œæ–‡ä»¶çš„å¤§å°å¯èƒ½ä¼šå¾ˆå¤§ï¼Œä½¿ç”¨<code>int</code>ç±»å‹å¯èƒ½æ— æ³•å‡†ç¡®è¡¨ç¤ºï¼Œè€Œ<code>long</code>ç±»å‹å°±å¯ä»¥å¾ˆå¥½åœ°å¤„ç†è¿™ç§æƒ…å†µã€‚</li></ul><h3 id="3-longå’Œintå¯ä»¥äº’è½¬å—-ï¼Ÿ"><a href="#3-longå’Œintå¯ä»¥äº’è½¬å—-ï¼Ÿ" class="headerlink" title="3.longå’Œintå¯ä»¥äº’è½¬å— ï¼Ÿ"></a>3.longå’Œintå¯ä»¥äº’è½¬å— ï¼Ÿ</h3><p>å¯ä»¥çš„ï¼ŒJavaä¸­çš„<code>long</code>å’Œ<code>int</code>å¯ä»¥ç›¸äº’è½¬æ¢ã€‚ç”±äº<code>long</code>ç±»å‹çš„èŒƒå›´æ¯”<code>int</code>ç±»å‹å¤§ï¼Œå› æ­¤å°†<code>int</code>è½¬æ¢ä¸º<code>long</code>æ˜¯å®‰å…¨çš„ï¼Œè€Œå°†<code>long</code>è½¬æ¢ä¸º<code>int</code>å¯èƒ½ä¼šå¯¼è‡´æ•°æ®ä¸¢å¤±æˆ–æº¢å‡ºã€‚</p><p>å°†<code>int</code>è½¬æ¢ä¸º<code>long</code>å¯ä»¥é€šè¿‡<strong>ç›´æ¥èµ‹å€¼æˆ–å¼ºåˆ¶ç±»å‹è½¬æ¢</strong>æ¥å®ç°ã€‚ä¾‹å¦‚ï¼š</p><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">int intValue = 10;</span><br><span class="line">long longValue = intValue; // è‡ªåŠ¨è½¬æ¢ï¼Œå®‰å…¨çš„</span><br></pre></td></tr></table></figure><p>å°†<code>long</code>è½¬æ¢ä¸º<code>int</code>éœ€è¦ä½¿ç”¨<strong>å¼ºåˆ¶ç±»å‹è½¬æ¢</strong>ï¼Œä½†éœ€è¦æ³¨æ„æ½œåœ¨çš„æ•°æ®ä¸¢å¤±æˆ–æº¢å‡ºé—®é¢˜ã€‚</p><p>åœ¨å°†<code>long</code>è½¬æ¢ä¸º<code>int</code>æ—¶ï¼Œå¦‚æœ<code>longValue</code>çš„å€¼è¶…å‡ºäº†<code>int</code>ç±»å‹çš„èŒƒå›´ï¼Œè½¬æ¢ç»“æœå°†æ˜¯æˆªæ–­åçš„ä½ä½éƒ¨åˆ†ã€‚å› æ­¤ï¼Œåœ¨è¿›è¡Œè½¬æ¢ä¹‹å‰ï¼Œå»ºè®®å…ˆæ£€æŸ¥<code>longValue</code>çš„å€¼æ˜¯å¦åœ¨<code>int</code>ç±»å‹çš„èŒƒå›´å†…ï¼Œä»¥é¿å…æ•°æ®ä¸¢å¤±æˆ–æº¢å‡ºçš„é—®é¢˜ã€‚</p><p><strong>ä½-&gt;é«˜ç›´æ¥è½¬</strong></p><h3 id="4-æ•°æ®ç±»å‹è½¬æ¢æ–¹å¼ä½ çŸ¥é“å“ªäº›ï¼Ÿ"><a href="#4-æ•°æ®ç±»å‹è½¬æ¢æ–¹å¼ä½ çŸ¥é“å“ªäº›ï¼Ÿ" class="headerlink" title="4.æ•°æ®ç±»å‹è½¬æ¢æ–¹å¼ä½ çŸ¥é“å“ªäº›ï¼Ÿ"></a>4.æ•°æ®ç±»å‹è½¬æ¢æ–¹å¼ä½ çŸ¥é“å“ªäº›ï¼Ÿ</h3><ul><li><strong>è‡ªåŠ¨ç±»å‹è½¬æ¢ï¼ˆéšå¼è½¬æ¢ï¼‰</strong>ï¼šå½“ç›®æ ‡ç±»å‹çš„èŒƒå›´å¤§äºæºç±»å‹æ—¶ï¼ŒJavaä¼šè‡ªåŠ¨å°†æºç±»å‹è½¬æ¢ä¸ºç›®æ ‡ç±»å‹ï¼Œä¸éœ€è¦æ˜¾å¼çš„ç±»å‹è½¬æ¢ã€‚ä¾‹å¦‚ï¼Œå°†<code>int</code>è½¬æ¢ä¸º<code>long</code>ã€å°†<code>float</code>è½¬æ¢ä¸º<code>double</code>ç­‰ã€‚</li><li><strong>å¼ºåˆ¶ç±»å‹è½¬æ¢ï¼ˆæ˜¾å¼è½¬æ¢ï¼‰</strong>ï¼šå½“ç›®æ ‡ç±»å‹çš„èŒƒå›´å°äºæºç±»å‹æ—¶ï¼Œéœ€è¦ä½¿ç”¨å¼ºåˆ¶ç±»å‹è½¬æ¢å°†æºç±»å‹è½¬æ¢ä¸ºç›®æ ‡ç±»å‹ã€‚è¿™å¯èƒ½å¯¼è‡´æ•°æ®ä¸¢å¤±æˆ–æº¢å‡ºã€‚ä¾‹å¦‚ï¼Œå°†<code>long</code>è½¬æ¢ä¸º<code>int</code>ã€å°†<code>double</code>è½¬æ¢ä¸º<code>int</code>ç­‰ã€‚è¯­æ³•ä¸ºï¼šç›®æ ‡ç±»å‹ å˜é‡å = (ç›®æ ‡ç±»å‹) æºç±»å‹ã€‚</li><li>å­—ç¬¦ä¸²è½¬æ¢ï¼š<strong>Javaæä¾›äº†å°†å­—ç¬¦ä¸²è¡¨ç¤ºçš„æ•°æ®è½¬æ¢ä¸ºå…¶ä»–ç±»å‹æ•°æ®çš„æ–¹æ³•</strong>ã€‚ä¾‹å¦‚ï¼Œå°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºæ•´å‹<code>int</code>ï¼Œå¯ä»¥ä½¿ç”¨<code>Integer.parseInt()</code>æ–¹æ³•ï¼›å°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºæµ®ç‚¹å‹<code>double</code>ï¼Œå¯ä»¥ä½¿ç”¨<code>Double.parseDouble()</code>æ–¹æ³•ç­‰ã€‚</li><li>æ•°å€¼ä¹‹é—´çš„è½¬æ¢ï¼š<strong>Javaæä¾›äº†ä¸€äº›æ•°å€¼ç±»å‹ä¹‹é—´çš„è½¬æ¢æ–¹æ³•ï¼Œå¦‚å°†æ•´å‹è½¬æ¢ä¸ºå­—ç¬¦å‹ã€å°†å­—ç¬¦å‹è½¬æ¢ä¸ºæ•´å‹ç­‰ã€‚</strong>è¿™äº›è½¬æ¢æ–¹å¼å¯ä»¥é€šè¿‡ç±»å‹çš„åŒ…è£…ç±»æ¥å®ç°ï¼Œä¾‹å¦‚<code>Character</code>ç±»ã€<code>Integer</code>ç±»ç­‰æä¾›äº†ç›¸åº”çš„è½¬æ¢æ–¹æ³•ã€‚</li></ul><h3 id="5-ç±»å‹äº’è½¬ä¼šå‡ºç°ä»€ä¹ˆé—®é¢˜å—ï¼Ÿ"><a href="#5-ç±»å‹äº’è½¬ä¼šå‡ºç°ä»€ä¹ˆé—®é¢˜å—ï¼Ÿ" class="headerlink" title="5.ç±»å‹äº’è½¬ä¼šå‡ºç°ä»€ä¹ˆé—®é¢˜å—ï¼Ÿ"></a>5.ç±»å‹äº’è½¬ä¼šå‡ºç°ä»€ä¹ˆé—®é¢˜å—ï¼Ÿ</h3><ul><li>æ•°æ®ä¸¢å¤±ï¼šå½“å°†<strong>ä¸€ä¸ªèŒƒå›´è¾ƒå¤§çš„æ•°æ®ç±»å‹è½¬æ¢ä¸ºä¸€ä¸ªèŒƒå›´è¾ƒå°çš„æ•°æ®ç±»å‹æ—¶</strong>ï¼Œå¯èƒ½ä¼šå‘ç”Ÿæ•°æ®ä¸¢å¤±ã€‚ä¾‹å¦‚ï¼Œå°†ä¸€ä¸ª<code>long</code>ç±»å‹çš„å€¼è½¬æ¢ä¸º<code>int</code>ç±»å‹æ—¶ï¼Œå¦‚æœ<code>long</code>å€¼è¶…å‡ºäº†<code>int</code>ç±»å‹çš„èŒƒå›´ï¼Œè½¬æ¢ç»“æœå°†æ˜¯æˆªæ–­åçš„ä½ä½éƒ¨åˆ†ï¼Œé«˜ä½éƒ¨åˆ†çš„æ•°æ®å°†ä¸¢å¤±ã€‚</li><li>æ•°æ®æº¢å‡ºï¼šä¸æ•°æ®ä¸¢å¤±ç›¸åï¼Œ<strong>å½“å°†ä¸€ä¸ªèŒƒå›´è¾ƒå°çš„æ•°æ®ç±»å‹è½¬æ¢ä¸ºä¸€ä¸ªèŒƒå›´è¾ƒå¤§çš„æ•°æ®ç±»å‹æ—¶ï¼Œå¯èƒ½ä¼šå‘ç”Ÿæ•°æ®æº¢å‡ºã€‚</strong>ä¾‹å¦‚ï¼Œå°†ä¸€ä¸ª<code>int</code>ç±»å‹çš„å€¼è½¬æ¢ä¸º<code>long</code>ç±»å‹æ—¶ï¼Œè½¬æ¢ç»“æœä¼šå¡«å……é¢å¤–çš„é«˜ä½ç©ºé—´ï¼Œä½†åŸå§‹æ•°æ®ä»ç„¶ä¿æŒä¸å˜ã€‚</li><li>ç²¾åº¦æŸå¤±ï¼š<strong>åœ¨è¿›è¡Œæµ®ç‚¹æ•°ç±»å‹çš„è½¬æ¢æ—¶ï¼Œå¯èƒ½ä¼šå‘ç”Ÿç²¾åº¦æŸå¤±ã€‚</strong>ç”±äºæµ®ç‚¹æ•°çš„è¡¨ç¤ºæ–¹å¼ä¸åŒï¼Œå°†ä¸€ä¸ªå•ç²¾åº¦æµ®ç‚¹æ•°(<code>float</code>)è½¬æ¢ä¸ºåŒç²¾åº¦æµ®ç‚¹æ•°(<code>double</code>)æ—¶ï¼Œç²¾åº¦å¯èƒ½ä¼šæŸå¤±ã€‚</li><li>ç±»å‹ä¸åŒ¹é…å¯¼è‡´çš„é”™è¯¯ï¼šåœ¨è¿›è¡Œç±»å‹è½¬æ¢æ—¶ï¼Œ<strong>éœ€è¦ç¡®ä¿æºç±»å‹å’Œç›®æ ‡ç±»å‹æ˜¯å…¼å®¹çš„ã€‚å¦‚æœä¸¤è€…ä¸å…¼å®¹ï¼Œä¼šå¯¼è‡´ç¼–è¯‘é”™è¯¯æˆ–è¿è¡Œæ—¶é”™è¯¯ã€‚</strong></li></ul><h3 id="6-ä¸ºä»€ä¹ˆç”¨bigDecimal-ä¸ç”¨double-ï¼Ÿ"><a href="#6-ä¸ºä»€ä¹ˆç”¨bigDecimal-ä¸ç”¨double-ï¼Ÿ" class="headerlink" title="6.ä¸ºä»€ä¹ˆç”¨bigDecimal ä¸ç”¨double ï¼Ÿ"></a>6.ä¸ºä»€ä¹ˆç”¨bigDecimal ä¸ç”¨double ï¼Ÿ</h3><p>doubleä¼šå‡ºç°ç²¾åº¦ä¸¢å¤±çš„é—®é¢˜ï¼Œdoubleæ‰§è¡Œçš„æ˜¯äºŒè¿›åˆ¶æµ®ç‚¹è¿ç®—ï¼ŒäºŒè¿›åˆ¶æœ‰äº›æƒ…å†µä¸‹ä¸èƒ½å‡†ç¡®çš„è¡¨ç¤ºä¸€ä¸ªå°æ•°ï¼Œå°±åƒåè¿›åˆ¶ä¸èƒ½å‡†ç¡®çš„è¡¨ç¤º1/3(1/3=0.3333â€¦)ï¼Œä¹Ÿå°±æ˜¯è¯´äºŒè¿›åˆ¶è¡¨ç¤ºå°æ•°çš„æ—¶å€™åªèƒ½å¤Ÿè¡¨ç¤ºèƒ½å¤Ÿç”¨1/(2^n)çš„å’Œçš„ä»»æ„ç»„åˆï¼Œä½†æ˜¯0.1ä¸èƒ½å¤Ÿç²¾ç¡®è¡¨ç¤ºï¼Œå› ä¸ºå®ƒä¸èƒ½å¤Ÿè¡¨ç¤ºæˆä¸º1/(2^n)çš„å’Œçš„å½¢å¼ã€‚</p><p>æ¯”å¦‚ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">System.out.println(<span class="number">0.05</span> + <span class="number">0.01</span>);</span><br><span class="line">System.out.println(<span class="number">1.0</span> - <span class="number">0.42</span>);</span><br><span class="line">System.out.println(<span class="number">4.015</span> * <span class="number">100</span>);</span><br><span class="line">System.out.println(<span class="number">123.3</span> / <span class="number">100</span>);</span><br><span class="line"></span><br><span class="line">è¾“å‡ºï¼š</span><br><span class="line"><span class="number">0.060000000000000005</span></span><br><span class="line"><span class="number">0.5800000000000001</span></span><br><span class="line"><span class="number">401.49999999999994</span></span><br><span class="line"><span class="number">1.2329999999999999</span></span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°åœ¨<strong>Javaä¸­è¿›è¡Œæµ®ç‚¹æ•°è¿ç®—çš„æ—¶å€™ï¼Œä¼šå‡ºç°ä¸¢å¤±ç²¾åº¦çš„é—®é¢˜ã€‚</strong>é‚£ä¹ˆæˆ‘ä»¬å¦‚æœåœ¨è¿›è¡Œå•†å“ä»·æ ¼è®¡ç®—çš„æ—¶å€™ï¼Œå°±ä¼šå‡ºç°é—®é¢˜ã€‚å¾ˆæœ‰å¯èƒ½é€ æˆæˆ‘ä»¬æ‰‹ä¸­æœ‰0.06å…ƒï¼Œå´æ— æ³•è´­ä¹°ä¸€ä¸ª0.05å…ƒå’Œä¸€ä¸ª0.01å…ƒçš„å•†å“ã€‚å› ä¸ºå¦‚ä¸Šæ‰€ç¤ºï¼Œä»–ä»¬ä¸¤ä¸ªçš„æ€»å’Œä¸º0.060000000000000005ã€‚è¿™æ— ç–‘æ˜¯ä¸€ä¸ªå¾ˆä¸¥é‡çš„é—®é¢˜ï¼Œå°¤å…¶æ˜¯å½“ç”µå•†ç½‘ç«™çš„å¹¶å‘é‡ä¸Šå»çš„æ—¶å€™ï¼Œå‡ºç°çš„é—®é¢˜å°†æ˜¯å·¨å¤§çš„ã€‚å¯èƒ½ä¼šå¯¼è‡´æ— æ³•ä¸‹å•ï¼Œæˆ–è€…å¯¹è´¦å‡ºç°é—®é¢˜ã€‚</p><p><strong>è€Œ Decimal æ˜¯ç²¾ç¡®è®¡ç®— , æ‰€ä»¥ä¸€èˆ¬ç‰µæ‰¯åˆ°é‡‘é’±çš„è®¡ç®— , éƒ½ä½¿ç”¨ Decimalã€‚</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.math.BigDecimal;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BigDecimalExample</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">BigDecimal</span> <span class="variable">num1</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BigDecimal</span>(<span class="string">&quot;0.1&quot;</span>);</span><br><span class="line">        <span class="type">BigDecimal</span> <span class="variable">num2</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BigDecimal</span>(<span class="string">&quot;0.2&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="type">BigDecimal</span> <span class="variable">sum</span> <span class="operator">=</span> num1.add(num2);</span><br><span class="line">        <span class="type">BigDecimal</span> <span class="variable">product</span> <span class="operator">=</span> num1.multiply(num2);</span><br><span class="line"></span><br><span class="line">        System.out.println(<span class="string">&quot;Sum: &quot;</span> + sum);</span><br><span class="line">        System.out.println(<span class="string">&quot;Product: &quot;</span> + product);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//è¾“å‡º</span></span><br><span class="line">Sum: <span class="number">0.3</span></span><br><span class="line">Product: <span class="number">0.02</span></span><br></pre></td></tr></table></figure><p>è¿™æ ·çš„ä½¿ç”¨<code>BigDecimal</code>å¯ä»¥ç¡®ä¿ç²¾ç¡®çš„åè¿›åˆ¶æ•°å€¼è®¡ç®—ï¼Œé¿å…äº†ä½¿ç”¨<code>double</code>å¯èƒ½å‡ºç°çš„èˆå…¥è¯¯å·®ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåœ¨åˆ›å»º<code>BigDecimal</code>å¯¹è±¡æ—¶ï¼Œåº”è¯¥ä½¿ç”¨<strong>å­—ç¬¦ä¸²ä½œä¸ºå‚æ•°</strong>ï¼Œè€Œä¸æ˜¯ç›´æ¥ä½¿ç”¨æµ®ç‚¹æ•°å€¼ï¼Œä»¥é¿å…æµ®ç‚¹æ•°ç²¾åº¦ä¸¢å¤±ã€‚</p><h3 id="7-è£…ç®±å’Œæ‹†ç®±æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#7-è£…ç®±å’Œæ‹†ç®±æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="7.è£…ç®±å’Œæ‹†ç®±æ˜¯ä»€ä¹ˆï¼Ÿ"></a>7.è£…ç®±å’Œæ‹†ç®±æ˜¯ä»€ä¹ˆï¼Ÿ</h3><p>è£…ç®±ï¼ˆBoxingï¼‰å’Œæ‹†ç®±ï¼ˆUnboxingï¼‰æ˜¯å°†åŸºæœ¬æ•°æ®ç±»å‹å’Œå¯¹åº”çš„åŒ…è£…ç±»ä¹‹é—´è¿›è¡Œè½¬æ¢çš„è¿‡ç¨‹ã€‚</p><p>è‡ªåŠ¨è£…ç®±ä¸»è¦å‘ç”Ÿåœ¨ä¸¤ç§æƒ…å†µï¼Œ<strong>ä¸€ç§æ˜¯èµ‹å€¼æ—¶ï¼Œå¦ä¸€ç§æ˜¯åœ¨æ–¹æ³•è°ƒç”¨çš„æ—¶å€™ã€‚</strong></p><blockquote><p>èµ‹å€¼æ—¶</p></blockquote><p>è¿™æ˜¯æœ€å¸¸è§çš„ä¸€ç§æƒ…å†µï¼Œåœ¨Java 1.5ä»¥å‰æˆ‘ä»¬éœ€è¦æ‰‹åŠ¨åœ°è¿›è¡Œè½¬æ¢æ‰è¡Œï¼Œè€Œç°åœ¨æ‰€æœ‰çš„è½¬æ¢éƒ½æ˜¯ç”±ç¼–è¯‘å™¨æ¥å®Œæˆã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//before autoboxing</span></span><br><span class="line"><span class="type">Integer</span> <span class="variable">iObject</span> <span class="operator">=</span> Integer.valueOf(<span class="number">3</span>);</span><br><span class="line"><span class="type">Int</span> <span class="variable">iPrimitive</span> <span class="operator">=</span> iObject.intValue()</span><br><span class="line"></span><br><span class="line"><span class="comment">//after java5</span></span><br><span class="line"><span class="type">Integer</span> <span class="variable">iObject</span> <span class="operator">=</span> <span class="number">3</span>; <span class="comment">//autobxing - primitive to wrapper conversion</span></span><br><span class="line"><span class="type">int</span> <span class="variable">iPrimitive</span> <span class="operator">=</span> iObject; <span class="comment">//unboxing - object to primitive conversion</span></span><br></pre></td></tr></table></figure><blockquote><p>æ–¹æ³•è°ƒç”¨æ—¶</p></blockquote><p>å½“æˆ‘ä»¬åœ¨æ–¹æ³•è°ƒç”¨æ—¶ï¼Œæˆ‘ä»¬å¯ä»¥ä¼ å…¥åŸå§‹æ•°æ®å€¼æˆ–è€…å¯¹è±¡ï¼ŒåŒæ ·ç¼–è¯‘å™¨ä¼šå¸®æˆ‘ä»¬è¿›è¡Œè½¬æ¢ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> Integer <span class="title function_">show</span><span class="params">(Integer iParam)</span>&#123;</span><br><span class="line">   System.out.println(<span class="string">&quot;autoboxing example - method invocation i: &quot;</span> + iParam);</span><br><span class="line">   <span class="keyword">return</span> iParam;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//autoboxing and unboxing in method invocation</span></span><br><span class="line">show(<span class="number">3</span>); <span class="comment">//autoboxing</span></span><br><span class="line"><span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> show(<span class="number">3</span>); <span class="comment">//unboxing because return type of method is Integer</span></span><br></pre></td></tr></table></figure><p>showæ–¹æ³•æ¥å—Integerå¯¹è±¡ä½œä¸ºå‚æ•°ï¼Œå½“è°ƒç”¨<code>show(3)</code>æ—¶ï¼Œä¼šå°†intå€¼è½¬æ¢æˆå¯¹åº”çš„Integerå¯¹è±¡ï¼Œè¿™å°±æ˜¯æ‰€è°“çš„è‡ªåŠ¨è£…ç®±ï¼Œshowæ–¹æ³•è¿”å›Integerå¯¹è±¡ï¼Œè€Œ<code>int result = show(3);</code>ä¸­resultä¸ºintç±»å‹ï¼Œæ‰€ä»¥è¿™æ—¶å€™å‘ç”Ÿè‡ªåŠ¨æ‹†ç®±æ“ä½œï¼Œå°†showæ–¹æ³•çš„è¿”å›çš„Integerå¯¹è±¡è½¬æ¢æˆintå€¼ã€‚</p><p>è‡ªåŠ¨è£…ç®±æœ‰ä¸€ä¸ªé—®é¢˜ï¼Œ<strong>é‚£å°±æ˜¯åœ¨ä¸€ä¸ªå¾ªç¯ä¸­è¿›è¡Œè‡ªåŠ¨è£…ç®±æ“ä½œçš„æƒ…å†µï¼Œå¦‚ä¸‹é¢çš„ä¾‹å­å°±ä¼šåˆ›å»ºå¤šä½™çš„å¯¹è±¡ï¼Œå½±å“ç¨‹åºçš„æ€§èƒ½ã€‚</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Integer</span> <span class="variable">sum</span> <span class="operator">=</span> <span class="number">0</span>; <span class="keyword">for</span>(<span class="type">int</span> i=<span class="number">1000</span>; i&lt;<span class="number">5000</span>; i++)&#123;   sum+=i; &#125; </span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„ä»£ç <code>sum+=i</code>å¯ä»¥çœ‹æˆ<code>sum = sum + i</code>ï¼Œä½†æ˜¯<code>+</code>è¿™ä¸ªæ“ä½œç¬¦ä¸é€‚ç”¨äºIntegerå¯¹è±¡ï¼Œé¦–å…ˆsumè¿›è¡Œè‡ªåŠ¨æ‹†ç®±æ“ä½œï¼Œè¿›è¡Œæ•°å€¼ç›¸åŠ æ“ä½œï¼Œæœ€åå‘ç”Ÿè‡ªåŠ¨è£…ç®±æ“ä½œè½¬æ¢æˆIntegerå¯¹è±¡ã€‚å…¶å†…éƒ¨å˜åŒ–å¦‚ä¸‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="variable">result</span> <span class="operator">=</span> sum.intValue() + i; <span class="type">Integer</span> <span class="variable">sum</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Integer</span>(result); </span><br></pre></td></tr></table></figure><p>ç”±äºæˆ‘ä»¬è¿™é‡Œå£°æ˜çš„sumä¸ºIntegerç±»å‹ï¼Œ<strong>åœ¨ä¸Šé¢çš„å¾ªç¯ä¸­ä¼šåˆ›å»ºå°†è¿‘4000ä¸ªæ— ç”¨çš„Integerå¯¹è±¡ï¼Œåœ¨è¿™æ ·åºå¤§çš„å¾ªç¯ä¸­ï¼Œä¼šé™ä½ç¨‹åºçš„æ€§èƒ½å¹¶ä¸”åŠ é‡äº†åƒåœ¾å›æ”¶çš„å·¥ä½œé‡ã€‚</strong>å› æ­¤åœ¨æˆ‘ä»¬ç¼–ç¨‹æ—¶ï¼Œéœ€è¦æ³¨æ„åˆ°è¿™ä¸€ç‚¹ï¼Œæ­£ç¡®åœ°å£°æ˜å˜é‡ç±»å‹ï¼Œé¿å…å› ä¸ºè‡ªåŠ¨è£…ç®±å¼•èµ·çš„æ€§èƒ½é—®é¢˜ã€‚</p><h3 id="8-Javaä¸ºä»€ä¹ˆè¦æœ‰Integerï¼Ÿ"><a href="#8-Javaä¸ºä»€ä¹ˆè¦æœ‰Integerï¼Ÿ" class="headerlink" title="8.Javaä¸ºä»€ä¹ˆè¦æœ‰Integerï¼Ÿ"></a>8.Javaä¸ºä»€ä¹ˆè¦æœ‰Integerï¼Ÿ</h3><p>Integerå¯¹åº”æ˜¯intç±»å‹çš„åŒ…è£…ç±»ï¼Œå°±æ˜¯æŠŠintç±»å‹åŒ…è£…æˆObjectå¯¹è±¡ï¼Œ<strong>å¯¹è±¡å°è£…æœ‰å¾ˆå¤šå¥½å¤„ï¼Œå¯ä»¥æŠŠå±æ€§ä¹Ÿå°±æ˜¯æ•°æ®è·Ÿå¤„ç†è¿™äº›æ•°æ®çš„æ–¹æ³•ç»“åˆåœ¨ä¸€èµ·</strong>ï¼Œæ¯”å¦‚Integerå°±æœ‰parseInt()ç­‰æ–¹æ³•æ¥ä¸“é—¨å¤„ç†intå‹ç›¸å…³çš„æ•°æ®ã€‚</p><p>å¦ä¸€ä¸ªéå¸¸é‡è¦çš„åŸå› å°±æ˜¯åœ¨<strong>Javaä¸­ç»å¤§éƒ¨åˆ†æ–¹æ³•æˆ–ç±»éƒ½æ˜¯ç”¨æ¥å¤„ç†ç±»ç±»å‹å¯¹è±¡çš„ï¼Œå¦‚ArrayListé›†åˆç±»å°±åªèƒ½ä»¥ç±»ä½œä¸ºä»–çš„å­˜å‚¨å¯¹è±¡ï¼Œè€Œè¿™æ—¶å¦‚æœæƒ³æŠŠä¸€ä¸ªintå‹çš„æ•°æ®å­˜å…¥listæ˜¯ä¸å¯èƒ½çš„ï¼Œå¿…é¡»æŠŠå®ƒåŒ…è£…æˆç±»ï¼Œ</strong>ä¹Ÿå°±æ˜¯Integeræ‰èƒ½è¢«Listæ‰€æ¥å—ã€‚æ‰€ä»¥Integerçš„å­˜åœ¨æ˜¯å¾ˆå¿…è¦çš„ã€‚</p><p>åœ¨Javaä¸­ï¼Œ<strong>æ³›å‹åªèƒ½ä½¿ç”¨å¼•ç”¨ç±»å‹</strong>ï¼Œè€Œä¸èƒ½ä½¿ç”¨åŸºæœ¬ç±»å‹ã€‚å› æ­¤ï¼Œå¦‚æœè¦åœ¨æ³›å‹ä¸­ä½¿ç”¨intç±»å‹ï¼Œå¿…é¡»ä½¿ç”¨IntegeråŒ…è£…ç±»ã€‚</p><p>åœ¨Javaä¸­ï¼Œ<strong>åŸºæœ¬ç±»å‹å’Œå¼•ç”¨ç±»å‹ä¸èƒ½ç›´æ¥è¿›è¡Œè½¬æ¢ï¼Œå¿…é¡»ä½¿ç”¨åŒ…è£…ç±»æ¥å®ç°ã€‚</strong>ä¾‹å¦‚ï¼Œå°†ä¸€ä¸ªintç±»å‹çš„å€¼è½¬æ¢ä¸ºStringç±»å‹ï¼Œå¿…é¡»é¦–å…ˆå°†å…¶è½¬æ¢ä¸ºIntegerç±»å‹ï¼Œç„¶åå†è½¬æ¢ä¸ºStringç±»å‹ã€‚</p><p>Java<strong>é›†åˆä¸­åªèƒ½å­˜å‚¨å¯¹è±¡ï¼Œè€Œä¸èƒ½å­˜å‚¨åŸºæœ¬æ•°æ®ç±»å‹ã€‚</strong>å› æ­¤ï¼Œå¦‚æœè¦å°†intç±»å‹çš„æ•°æ®å­˜å‚¨åœ¨é›†åˆä¸­ï¼Œå¿…é¡»ä½¿ç”¨IntegeråŒ…è£…ç±»ã€‚</p><h3 id="9-Integerç›¸æ¯”intæœ‰ä»€ä¹ˆä¼˜ç‚¹ï¼Ÿ"><a href="#9-Integerç›¸æ¯”intæœ‰ä»€ä¹ˆä¼˜ç‚¹ï¼Ÿ" class="headerlink" title="9.Integerç›¸æ¯”intæœ‰ä»€ä¹ˆä¼˜ç‚¹ï¼Ÿ"></a>9.Integerç›¸æ¯”intæœ‰ä»€ä¹ˆä¼˜ç‚¹ï¼Ÿ</h3><p>intæ˜¯Javaä¸­çš„åŸå§‹æ•°æ®ç±»å‹ï¼Œè€ŒIntegeræ˜¯intçš„åŒ…è£…ç±»ã€‚</p><p>Integerå’Œ int çš„åŒºåˆ«ï¼š</p><ul><li>åŸºæœ¬ç±»å‹å’Œå¼•ç”¨ç±»å‹ï¼šé¦–å…ˆï¼Œintæ˜¯ä¸€ç§åŸºæœ¬æ•°æ®ç±»å‹ï¼Œè€ŒIntegeræ˜¯ä¸€ç§å¼•ç”¨ç±»å‹ã€‚åŸºæœ¬æ•°æ®ç±»å‹æ˜¯Javaä¸­æœ€åŸºæœ¬çš„æ•°æ®ç±»å‹ï¼Œ<strong>å®ƒä»¬æ˜¯é¢„å®šä¹‰çš„ï¼Œä¸éœ€è¦å®ä¾‹åŒ–å°±å¯ä»¥ä½¿ç”¨ã€‚è€Œå¼•ç”¨ç±»å‹åˆ™éœ€è¦é€šè¿‡å®ä¾‹åŒ–å¯¹è±¡æ¥ä½¿ç”¨ã€‚</strong>è¿™æ„å‘³ç€ï¼Œä½¿ç”¨intæ¥å­˜å‚¨ä¸€ä¸ªæ•´æ•°æ—¶ï¼Œä¸éœ€è¦ä»»ä½•é¢å¤–çš„å†…å­˜åˆ†é…ï¼Œè€Œä½¿ç”¨Integeræ—¶ï¼Œå¿…é¡»ä¸ºå¯¹è±¡åˆ†é…å†…å­˜ã€‚åœ¨æ€§èƒ½æ–¹é¢ï¼Œ<strong>åŸºæœ¬æ•°æ®ç±»å‹çš„æ“ä½œé€šå¸¸æ¯”ç›¸åº”çš„å¼•ç”¨ç±»å‹å¿«ã€‚</strong></li><li>è‡ªåŠ¨è£…ç®±å’Œæ‹†ç®±ï¼šå…¶æ¬¡ï¼ŒIntegerä½œä¸ºintçš„åŒ…è£…ç±»ï¼Œ<strong>å®ƒå¯ä»¥å®ç°è‡ªåŠ¨è£…ç®±å’Œæ‹†ç®±ã€‚è‡ªåŠ¨è£…ç®±æ˜¯æŒ‡å°†åŸºæœ¬ç±»å‹è½¬åŒ–ä¸ºç›¸åº”çš„åŒ…è£…ç±»ç±»å‹ï¼Œè€Œè‡ªåŠ¨æ‹†ç®±åˆ™æ˜¯å°†åŒ…è£…ç±»ç±»å‹è½¬åŒ–ä¸ºç›¸åº”çš„åŸºæœ¬ç±»å‹ã€‚</strong>è¿™ä½¿å¾—Javaç¨‹åºå‘˜<strong>æ›´åŠ æ–¹ä¾¿åœ°è¿›è¡Œæ•°æ®ç±»å‹è½¬æ¢ã€‚</strong>ä¾‹å¦‚ï¼Œå½“æˆ‘ä»¬éœ€è¦å°†intç±»å‹çš„å€¼èµ‹ç»™Integerå˜é‡æ—¶ï¼ŒJavaå¯ä»¥è‡ªåŠ¨åœ°å°†intç±»å‹è½¬æ¢ä¸ºIntegerç±»å‹ã€‚åŒæ ·åœ°ï¼Œå½“æˆ‘ä»¬éœ€è¦å°†Integerç±»å‹çš„å€¼èµ‹ç»™intå˜é‡æ—¶ï¼ŒJavaå¯ä»¥è‡ªåŠ¨åœ°å°†Integerç±»å‹è½¬æ¢ä¸ºintç±»å‹ã€‚</li><li>ç©ºæŒ‡é’ˆå¼‚å¸¸ï¼šå¦å¤–ï¼Œ<strong>intå˜é‡å¯ä»¥ç›´æ¥èµ‹å€¼ä¸º0ï¼Œè€ŒIntegerå˜é‡å¿…é¡»é€šè¿‡å®ä¾‹åŒ–å¯¹è±¡æ¥èµ‹å€¼ã€‚</strong>å¦‚æœå¯¹ä¸€ä¸ªæœªç»åˆå§‹åŒ–çš„Integerå˜é‡è¿›è¡Œæ“ä½œï¼Œå°±ä¼šå‡ºç°ç©ºæŒ‡é’ˆå¼‚å¸¸ã€‚è¿™æ˜¯å› ä¸ºå®ƒè¢«èµ‹äºˆäº†<strong>nullå€¼</strong>ï¼Œè€Œnullå€¼æ˜¯æ— æ³•è¿›è¡Œè‡ªåŠ¨æ‹†ç®±çš„ã€‚</li></ul><h3 id="10-é‚£ä¸ºä»€ä¹ˆè¿˜è¦ä¿ç•™intç±»å‹ï¼Ÿ"><a href="#10-é‚£ä¸ºä»€ä¹ˆè¿˜è¦ä¿ç•™intç±»å‹ï¼Ÿ" class="headerlink" title="10.é‚£ä¸ºä»€ä¹ˆè¿˜è¦ä¿ç•™intç±»å‹ï¼Ÿ"></a>10.é‚£ä¸ºä»€ä¹ˆè¿˜è¦ä¿ç•™intç±»å‹ï¼Ÿ</h3><p>åŒ…è£…ç±»æ˜¯å¼•ç”¨ç±»å‹ï¼Œå¯¹è±¡çš„å¼•ç”¨å’Œå¯¹è±¡æœ¬èº«æ˜¯åˆ†å¼€å­˜å‚¨çš„ï¼Œ<strong>è€Œå¯¹äºåŸºæœ¬ç±»å‹æ•°æ®ï¼Œå˜é‡å¯¹åº”çš„å†…å­˜å—ç›´æ¥å­˜å‚¨æ•°æ®æœ¬èº«ã€‚</strong></p><p>å› æ­¤ï¼ŒåŸºæœ¬ç±»å‹æ•°æ®åœ¨<strong>è¯»å†™æ•ˆç‡æ–¹é¢ï¼Œè¦æ¯”åŒ…è£…ç±»é«˜æ•ˆ</strong>ã€‚é™¤æ­¤ä¹‹å¤–ï¼Œåœ¨64ä½JVMä¸Šï¼Œåœ¨å¼€å¯å¼•ç”¨å‹ç¼©çš„æƒ…å†µä¸‹ï¼Œä¸€ä¸ªIntegerå¯¹è±¡å ç”¨16ä¸ªå­—èŠ‚çš„å†…å­˜ç©ºé—´ï¼Œè€Œä¸€ä¸ªintç±»å‹æ•°æ®åªå ç”¨4å­—èŠ‚çš„å†…å­˜ç©ºé—´ï¼Œå‰è€…å¯¹ç©ºé—´çš„å ç”¨æ˜¯åè€…çš„4å€ã€‚</p><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œ<strong>ä¸ç®¡æ˜¯è¯»å†™æ•ˆç‡ï¼Œè¿˜æ˜¯å­˜å‚¨æ•ˆç‡ï¼ŒåŸºæœ¬ç±»å‹éƒ½æ¯”åŒ…è£…ç±»é«˜æ•ˆã€‚</strong></p><h3 id="11-è¯´ä¸€ä¸‹-integerçš„ç¼“å­˜"><a href="#11-è¯´ä¸€ä¸‹-integerçš„ç¼“å­˜" class="headerlink" title="11.è¯´ä¸€ä¸‹ integerçš„ç¼“å­˜"></a>11.è¯´ä¸€ä¸‹ integerçš„ç¼“å­˜</h3><p>Javaçš„Integerç±»å†…éƒ¨å®ç°äº†ä¸€ä¸ª<strong>é™æ€ç¼“å­˜æ± </strong>ï¼Œç”¨äºå­˜å‚¨ç‰¹å®šèŒƒå›´å†…çš„æ•´æ•°å€¼å¯¹åº”çš„Integerå¯¹è±¡ã€‚</p><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œ<strong>è¿™ä¸ªèŒƒå›´æ˜¯-128è‡³127ã€‚</strong>å½“é€šè¿‡<strong>Integer.valueOf(int)æ–¹æ³•åˆ›å»ºä¸€ä¸ªåœ¨è¿™ä¸ªèŒƒå›´å†…çš„æ•´æ•°å¯¹è±¡æ—¶ï¼Œå¹¶ä¸ä¼šæ¯æ¬¡éƒ½ç”Ÿæˆæ–°çš„å¯¹è±¡å®ä¾‹ï¼Œè€Œæ˜¯å¤ç”¨ç¼“å­˜ä¸­çš„ç°æœ‰å¯¹è±¡ï¼Œä¼šç›´æ¥ä»å†…å­˜ä¸­å–å‡ºï¼Œä¸éœ€è¦æ–°å»ºä¸€ä¸ªå¯¹è±¡ã€‚</strong></p><p>ä½†æ˜¯ä½ newçš„è¯å°±æ˜¯ä¸€ä¸ªæ–°çš„å¯¹è±¡äº†ã€‚</p><h1 id="é¢å‘å¯¹è±¡"><a href="#é¢å‘å¯¹è±¡" class="headerlink" title="é¢å‘å¯¹è±¡"></a>é¢å‘å¯¹è±¡</h1><h2 id="1-æ€ä¹ˆç†è§£é¢å‘å¯¹è±¡ï¼Ÿç®€å•è¯´è¯´å°è£…ç»§æ‰¿å¤šæ€"><a href="#1-æ€ä¹ˆç†è§£é¢å‘å¯¹è±¡ï¼Ÿç®€å•è¯´è¯´å°è£…ç»§æ‰¿å¤šæ€" class="headerlink" title="1.æ€ä¹ˆç†è§£é¢å‘å¯¹è±¡ï¼Ÿç®€å•è¯´è¯´å°è£…ç»§æ‰¿å¤šæ€"></a>1.æ€ä¹ˆç†è§£é¢å‘å¯¹è±¡ï¼Ÿç®€å•è¯´è¯´å°è£…ç»§æ‰¿å¤šæ€</h2><p>é¢å‘å¯¹è±¡æ˜¯ä¸€ç§ç¼–ç¨‹èŒƒå¼ï¼Œå®ƒ<strong>å°†ç°å®ä¸–ç•Œä¸­çš„äº‹ç‰©æŠ½è±¡ä¸ºå¯¹è±¡</strong>ï¼Œå¯¹è±¡å…·æœ‰å±æ€§ï¼ˆç§°ä¸ºå­—æ®µæˆ–å±æ€§ï¼‰å’Œè¡Œä¸ºï¼ˆç§°ä¸ºæ–¹æ³•ï¼‰ã€‚é¢å‘å¯¹è±¡ç¼–ç¨‹çš„è®¾è®¡æ€æƒ³æ˜¯ä»¥å¯¹è±¡ä¸ºä¸­å¿ƒï¼Œé€šè¿‡å¯¹è±¡ä¹‹é—´çš„äº¤äº’æ¥å®Œæˆç¨‹åºçš„åŠŸèƒ½ï¼Œå…·æœ‰çµæ´»æ€§å’Œå¯æ‰©å±•æ€§ï¼Œé€šè¿‡å°è£…å’Œç»§æ‰¿å¯ä»¥æ›´å¥½åœ°åº”å¯¹éœ€æ±‚å˜åŒ–ã€‚</p><p>Javaé¢å‘å¯¹è±¡çš„ä¸‰å¤§ç‰¹æ€§åŒ…æ‹¬ï¼š<strong>å°è£…ã€ç»§æ‰¿ã€å¤šæ€</strong>ï¼š</p><ul><li><strong>å°è£…</strong>ï¼šå°è£…æ˜¯æŒ‡å°†å¯¹è±¡çš„<strong>å±æ€§ï¼ˆæ•°æ®ï¼‰å’Œè¡Œä¸ºï¼ˆæ–¹æ³•ï¼‰ç»“åˆåœ¨ä¸€èµ·</strong>ï¼Œå¯¹å¤–éšè—å¯¹è±¡çš„å†…éƒ¨ç»†èŠ‚ï¼Œä»…é€šè¿‡å¯¹è±¡æä¾›çš„æ¥å£ä¸å¤–ç•Œäº¤äº’ã€‚<strong>å°è£…çš„ç›®çš„æ˜¯å¢å¼ºå®‰å…¨æ€§å’Œç®€åŒ–ç¼–ç¨‹ï¼Œä½¿å¾—å¯¹è±¡æ›´åŠ ç‹¬ç«‹ã€‚</strong></li><li><strong>ç»§æ‰¿</strong>ï¼šç»§æ‰¿æ˜¯ä¸€ç§å¯ä»¥ä½¿å¾—<strong>å­ç±»è‡ªåŠ¨å…±äº«çˆ¶ç±»æ•°æ®ç»“æ„å’Œæ–¹æ³•çš„æœºåˆ¶</strong>ã€‚å®ƒæ˜¯ä»£ç å¤ç”¨çš„é‡è¦æ‰‹æ®µï¼Œé€šè¿‡ç»§æ‰¿å¯ä»¥å»ºç«‹ç±»ä¸ç±»ä¹‹é—´çš„å±‚æ¬¡å…³ç³»ï¼Œä½¿å¾—ç»“æ„æ›´åŠ æ¸…æ™°ã€‚</li><li><strong>å¤šæ€</strong>ï¼šå¤šæ€æ˜¯æŒ‡å…è®¸ä¸åŒç±»çš„å¯¹è±¡å¯¹åŒä¸€æ¶ˆæ¯ä½œå‡ºå“åº”ã€‚å³åŒä¸€ä¸ªæ¥å£ï¼Œä½¿ç”¨ä¸åŒçš„å®ä¾‹è€Œæ‰§è¡Œä¸åŒæ“ä½œã€‚å¤šæ€æ€§å¯ä»¥åˆ†ä¸º<strong>ç¼–è¯‘æ—¶å¤šæ€ï¼ˆé‡è½½ï¼‰å’Œè¿è¡Œæ—¶å¤šæ€ï¼ˆé‡å†™ï¼‰</strong>ã€‚å®ƒä½¿å¾—ç¨‹åºå…·æœ‰è‰¯å¥½çš„çµæ´»æ€§å’Œæ‰©å±•æ€§ã€‚</li></ul><h2 id="2-å¤šæ€ä½“ç°åœ¨å“ªå‡ ä¸ªæ–¹é¢ï¼Ÿ"><a href="#2-å¤šæ€ä½“ç°åœ¨å“ªå‡ ä¸ªæ–¹é¢ï¼Ÿ" class="headerlink" title="2.å¤šæ€ä½“ç°åœ¨å“ªå‡ ä¸ªæ–¹é¢ï¼Ÿ"></a>2.å¤šæ€ä½“ç°åœ¨å“ªå‡ ä¸ªæ–¹é¢ï¼Ÿ</h2><p>å¤šæ€åœ¨é¢å‘å¯¹è±¡ç¼–ç¨‹ä¸­å¯ä»¥ä½“ç°åœ¨ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š</p><ul><li>æ–¹æ³•é‡è½½ï¼š<ul><li>æ–¹æ³•é‡è½½æ˜¯æŒ‡åŒä¸€ç±»ä¸­å¯ä»¥æœ‰<strong>å¤šä¸ªåŒåæ–¹æ³•ï¼Œå®ƒä»¬å…·æœ‰ä¸åŒçš„å‚æ•°åˆ—è¡¨</strong>ï¼ˆå‚æ•°ç±»å‹ã€æ•°é‡æˆ–é¡ºåºä¸åŒï¼‰ã€‚è™½ç„¶æ–¹æ³•åç›¸åŒï¼Œä½†æ ¹æ®ä¼ å…¥çš„å‚æ•°ä¸åŒï¼Œç¼–è¯‘å™¨ä¼šåœ¨ç¼–è¯‘æ—¶ç¡®å®šè°ƒç”¨å“ªä¸ªæ–¹æ³•ã€‚</li><li>ç¤ºä¾‹ï¼šå¯¹äºä¸€ä¸ª <code>add</code> æ–¹æ³•ï¼Œå¯ä»¥å®šä¹‰ä¸º <code>add(int a, int b)</code> å’Œ <code>add(double a, double b)</code>ã€‚</li></ul></li><li>æ–¹æ³•é‡å†™ï¼š<ul><li>æ–¹æ³•é‡å†™æ˜¯<strong>æŒ‡å­ç±»èƒ½å¤Ÿæä¾›å¯¹çˆ¶ç±»ä¸­åŒåæ–¹æ³•çš„å…·ä½“å®ç°</strong>ã€‚åœ¨è¿è¡Œæ—¶ï¼ŒJVMä¼šæ ¹æ®å¯¹è±¡çš„å®é™…ç±»å‹ç¡®å®šè°ƒç”¨å“ªä¸ªç‰ˆæœ¬çš„æ–¹æ³•ã€‚è¿™æ˜¯å®ç°å¤šæ€çš„ä¸»è¦æ–¹å¼ã€‚</li><li>ç¤ºä¾‹ï¼šåœ¨ä¸€ä¸ªåŠ¨ç‰©ç±»ä¸­ï¼Œå®šä¹‰ä¸€ä¸ª <code>sound</code> æ–¹æ³•ï¼Œå­ç±» <code>Dog</code> å¯ä»¥é‡å†™è¯¥æ–¹æ³•ä»¥å®ç° <code>bark</code>ï¼Œè€Œ <code>Cat</code> å¯ä»¥å®ç° <code>meow</code>ã€‚</li></ul></li><li>æ¥å£ä¸å®ç°ï¼š<ul><li>å¤šæ€ä¹Ÿä½“ç°åœ¨æ¥å£çš„ä½¿ç”¨ä¸Šï¼Œ<strong>å¤šä¸ªç±»å¯ä»¥å®ç°åŒä¸€ä¸ªæ¥å£ï¼Œå¹¶ä¸”ç”¨æ¥å£ç±»å‹çš„å¼•ç”¨æ¥è°ƒç”¨è¿™äº›ç±»çš„æ–¹æ³•ã€‚è¿™ä½¿å¾—ç¨‹åºåœ¨é¢å¯¹ä¸åŒå…·ä½“å®ç°æ—¶ä¿æŒä¸€è´¯çš„è°ƒç”¨æ–¹å¼ã€‚</strong></li><li>ç¤ºä¾‹ï¼šå¤šä¸ªç±»ï¼ˆå¦‚ <code>Dog</code>, <code>Cat</code>ï¼‰éƒ½å®ç°äº†ä¸€ä¸ª <code>Animal</code> æ¥å£ï¼Œå½“ç”¨ <code>Animal</code> ç±»å‹çš„å¼•ç”¨æ¥è°ƒç”¨ <code>makeSound</code> æ–¹æ³•æ—¶ï¼Œä¼šè§¦å‘å¯¹åº”çš„å®ç°ã€‚</li></ul></li><li>å‘ä¸Šè½¬å‹å’Œå‘ä¸‹è½¬å‹ï¼š<ul><li>åœ¨Javaä¸­ï¼Œ<strong>å¯ä»¥ä½¿ç”¨çˆ¶ç±»ç±»å‹çš„å¼•ç”¨æŒ‡å‘å­ç±»å¯¹è±¡ï¼Œè¿™æ˜¯å‘ä¸Šè½¬å‹ã€‚</strong>é€šè¿‡è¿™ç§æ–¹å¼ï¼Œå¯ä»¥åœ¨è¿è¡Œæ—¶æœŸé‡‡ç”¨ä¸åŒçš„å­ç±»å®ç°ã€‚</li><li>å‘ä¸‹è½¬å‹æ˜¯å°†<strong>çˆ¶ç±»å¼•ç”¨è½¬å›å…¶å­ç±»ç±»å‹</strong>ï¼Œä½†åœ¨æ‰§è¡Œå‰éœ€è¦ç¡®è®¤å¼•ç”¨å®é™…æŒ‡å‘çš„å¯¹è±¡ç±»å‹ä»¥é¿å… <code>ClassCastException</code>ã€‚</li></ul></li></ul><h2 id="3-å¤šæ€è§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿ"><a href="#3-å¤šæ€è§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿ" class="headerlink" title="3.å¤šæ€è§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿ"></a>3.å¤šæ€è§£å†³äº†ä»€ä¹ˆé—®é¢˜ï¼Ÿ</h2><p>å¤šæ€æ˜¯<strong>æŒ‡å­ç±»å¯ä»¥æ›¿æ¢çˆ¶ç±»ï¼Œ</strong>åœ¨å®é™…çš„ä»£ç è¿è¡Œè¿‡ç¨‹ä¸­ï¼Œè°ƒç”¨å­ç±»çš„æ–¹æ³•å®ç°ã€‚å¤šæ€è¿™ç§ç‰¹æ€§ä¹Ÿéœ€è¦ç¼–ç¨‹è¯­è¨€æä¾›ç‰¹æ®Šçš„è¯­æ³•æœºåˆ¶æ¥å®ç°ï¼Œ<strong>æ¯”å¦‚ç»§æ‰¿ã€æ¥å£ç±»</strong>ã€‚</p><p><strong>å¤šæ€å¯ä»¥æé«˜ä»£ç çš„æ‰©å±•æ€§å’Œå¤ç”¨æ€§ï¼Œæ˜¯å¾ˆå¤šè®¾è®¡æ¨¡å¼ã€è®¾è®¡åŸåˆ™ã€ç¼–ç¨‹æŠ€å·§çš„ä»£ç å®ç°åŸºç¡€ã€‚</strong>æ¯”å¦‚ç­–ç•¥æ¨¡å¼ã€åŸºäºæ¥å£è€Œéå®ç°ç¼–ç¨‹ã€ä¾èµ–å€’ç½®åŸåˆ™ã€é‡Œå¼æ›¿æ¢åŸåˆ™ã€åˆ©ç”¨å¤šæ€å»æ‰å†—é•¿çš„ if-else è¯­å¥ç­‰ç­‰</p><h2 id="4-é¢å‘å¯¹è±¡çš„è®¾è®¡åŸåˆ™ä½ çŸ¥é“æœ‰å“ªäº›å—"><a href="#4-é¢å‘å¯¹è±¡çš„è®¾è®¡åŸåˆ™ä½ çŸ¥é“æœ‰å“ªäº›å—" class="headerlink" title="4.é¢å‘å¯¹è±¡çš„è®¾è®¡åŸåˆ™ä½ çŸ¥é“æœ‰å“ªäº›å—"></a>4.é¢å‘å¯¹è±¡çš„è®¾è®¡åŸåˆ™ä½ çŸ¥é“æœ‰å“ªäº›å—</h2><p>é¢å‘å¯¹è±¡ç¼–ç¨‹ä¸­çš„å…­å¤§åŸåˆ™ï¼š</p><ul><li><strong>å•ä¸€èŒè´£åŸåˆ™ï¼ˆSRPï¼‰</strong>ï¼šä¸€ä¸ªç±»åº”è¯¥åªæœ‰ä¸€ä¸ªå¼•èµ·å®ƒå˜åŒ–çš„åŸå› ï¼Œå³ä¸€ä¸ªç±»åº”è¯¥åªè´Ÿè´£ä¸€é¡¹èŒè´£ã€‚ä¾‹å­ï¼šè€ƒè™‘ä¸€ä¸ªå‘˜å·¥ç±»ï¼Œå®ƒåº”è¯¥åªè´Ÿè´£ç®¡ç†å‘˜å·¥ä¿¡æ¯ï¼Œè€Œä¸åº”è´Ÿè´£å…¶ä»–æ— å…³å·¥ä½œã€‚</li><li><strong>å¼€æ”¾å°é—­åŸåˆ™ï¼ˆOCPï¼‰</strong>ï¼šè½¯ä»¶å®ä½“åº”è¯¥å¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å°é—­ã€‚ä¾‹å­ï¼šé€šè¿‡åˆ¶å®šæ¥å£æ¥å®ç°è¿™ä¸€åŸåˆ™ï¼Œæ¯”å¦‚å®šä¹‰ä¸€ä¸ªå›¾å½¢ç±»ï¼Œç„¶åè®©ä¸åŒç±»å‹çš„å›¾å½¢ç»§æ‰¿è¿™ä¸ªç±»ï¼Œè€Œä¸éœ€è¦ä¿®æ”¹å›¾å½¢ç±»æœ¬èº«ã€‚</li><li><strong>é‡Œæ°æ›¿æ¢åŸåˆ™ï¼ˆLSPï¼‰</strong>ï¼šå­ç±»å¯¹è±¡åº”è¯¥èƒ½å¤Ÿæ›¿æ¢æ‰æ‰€æœ‰çˆ¶ç±»å¯¹è±¡ã€‚ä¾‹å­ï¼šä¸€ä¸ªæ­£æ–¹å½¢æ˜¯ä¸€ä¸ªçŸ©å½¢ï¼Œä½†å¦‚æœä¿®æ”¹ä¸€ä¸ªçŸ©å½¢çš„é«˜åº¦å’Œå®½åº¦æ—¶ï¼Œæ­£æ–¹å½¢çš„è¡Œä¸ºåº”è¯¥å¦‚ä½•æ”¹å˜å°±æ˜¯ä¸€ä¸ªè¿åé‡Œæ°æ›¿æ¢åŸåˆ™çš„ä¾‹å­ã€‚</li><li><strong>æ¥å£éš”ç¦»åŸåˆ™ï¼ˆISPï¼‰</strong>ï¼šå®¢æˆ·ç«¯ä¸åº”è¯¥ä¾èµ–é‚£äº›å®ƒä¸éœ€è¦çš„æ¥å£ï¼Œå³æ¥å£åº”è¯¥å°è€Œä¸“ã€‚ä¾‹å­ï¼šé€šè¿‡æ¥å£æŠ½è±¡å±‚æ¥å®ç°åº•å±‚å’Œé«˜å±‚æ¨¡å—ä¹‹é—´çš„è§£è€¦ï¼Œæ¯”å¦‚ä½¿ç”¨ä¾èµ–æ³¨å…¥ã€‚</li><li><strong>ä¾èµ–å€’ç½®åŸåˆ™ï¼ˆDIPï¼‰</strong>ï¼šé«˜å±‚æ¨¡å—ä¸åº”è¯¥ä¾èµ–ä½å±‚æ¨¡å—ï¼ŒäºŒè€…éƒ½åº”è¯¥ä¾èµ–äºæŠ½è±¡ï¼›æŠ½è±¡ä¸åº”è¯¥ä¾èµ–äºç»†èŠ‚ï¼Œç»†èŠ‚åº”è¯¥ä¾èµ–äºæŠ½è±¡ã€‚ä¾‹å­ï¼šå¦‚æœä¸€ä¸ªå…¬å¸ç±»åŒ…å«éƒ¨é—¨ç±»ï¼Œåº”è¯¥è€ƒè™‘ä½¿ç”¨åˆæˆ/èšåˆå…³ç³»ï¼Œè€Œä¸æ˜¯å°†å…¬å¸ç±»ç»§æ‰¿è‡ªéƒ¨é—¨ç±»ã€‚</li><li><strong>æœ€å°‘çŸ¥è¯†åŸåˆ™ (Law of Demeter)</strong>ï¼šä¸€ä¸ªå¯¹è±¡åº”å½“å¯¹å…¶ä»–å¯¹è±¡æœ‰æœ€å°‘çš„äº†è§£ï¼Œåªä¸å…¶ç›´æ¥çš„æœ‹å‹äº¤äº’ã€‚</li></ul><h2 id="5-é‡è½½ä¸é‡å†™æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"><a href="#5-é‡è½½ä¸é‡å†™æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ" class="headerlink" title="5.é‡è½½ä¸é‡å†™æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"></a>5.é‡è½½ä¸é‡å†™æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</h2><ul><li>é‡è½½ï¼ˆOverloadingï¼‰æŒ‡çš„æ˜¯åœ¨<strong>åŒä¸€ä¸ªç±»ä¸­ï¼Œå¯ä»¥æœ‰å¤šä¸ªåŒåæ–¹æ³•ï¼Œå®ƒä»¬å…·æœ‰ä¸åŒçš„å‚æ•°åˆ—è¡¨</strong>ï¼ˆå‚æ•°ç±»å‹ã€å‚æ•°ä¸ªæ•°æˆ–å‚æ•°é¡ºåºä¸åŒï¼‰ï¼Œç¼–è¯‘å™¨æ ¹æ®è°ƒç”¨æ—¶çš„å‚æ•°ç±»å‹æ¥å†³å®šè°ƒç”¨å“ªä¸ªæ–¹æ³•ã€‚</li><li>é‡å†™ï¼ˆOverridingï¼‰æŒ‡çš„æ˜¯<strong>å­ç±»å¯ä»¥é‡æ–°å®šä¹‰çˆ¶ç±»ä¸­çš„æ–¹æ³•ï¼Œ</strong>æ–¹æ³•åã€å‚æ•°åˆ—è¡¨å’Œè¿”å›ç±»å‹å¿…é¡»ä¸çˆ¶ç±»ä¸­çš„æ–¹æ³•ä¸€è‡´ï¼Œé€šè¿‡<strong>@override</strong>æ³¨è§£æ¥æ˜ç¡®è¡¨ç¤ºè¿™æ˜¯å¯¹çˆ¶ç±»æ–¹æ³•çš„é‡å†™ã€‚</li></ul><p>é‡è½½æ˜¯æŒ‡åœ¨åŒä¸€ä¸ªç±»ä¸­å®šä¹‰å¤šä¸ªåŒåæ–¹æ³•ï¼Œè€Œé‡å†™æ˜¯æŒ‡å­ç±»é‡æ–°å®šä¹‰çˆ¶ç±»ä¸­çš„æ–¹æ³•ã€‚</p><h2 id="6-æŠ½è±¡ç±»å’Œæ™®é€šç±»åŒºåˆ«ï¼Ÿ"><a href="#6-æŠ½è±¡ç±»å’Œæ™®é€šç±»åŒºåˆ«ï¼Ÿ" class="headerlink" title="6.æŠ½è±¡ç±»å’Œæ™®é€šç±»åŒºåˆ«ï¼Ÿ"></a>6.æŠ½è±¡ç±»å’Œæ™®é€šç±»åŒºåˆ«ï¼Ÿ</h2><ul><li>å®ä¾‹åŒ–ï¼šæ™®é€šç±»å¯ä»¥ç›´æ¥å®ä¾‹åŒ–å¯¹è±¡ï¼Œè€ŒæŠ½è±¡ç±»ä¸èƒ½è¢«å®ä¾‹åŒ–ï¼Œåªèƒ½è¢«ç»§æ‰¿ã€‚</li><li>æ–¹æ³•å®ç°ï¼šæ™®é€šç±»ä¸­çš„æ–¹æ³•å¯ä»¥æœ‰å…·ä½“çš„å®ç°ï¼Œè€ŒæŠ½è±¡ç±»ä¸­çš„æ–¹æ³•å¯ä»¥æœ‰å®ç°ä¹Ÿå¯ä»¥æ²¡æœ‰å®ç°ã€‚</li><li>ç»§æ‰¿ï¼šä¸€ä¸ªç±»å¯ä»¥ç»§æ‰¿ä¸€ä¸ªæ™®é€šç±»ï¼Œè€Œä¸”å¯ä»¥ç»§æ‰¿å¤šä¸ªæ¥å£ï¼›è€Œä¸€ä¸ªç±»åªèƒ½ç»§æ‰¿ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œä½†å¯ä»¥åŒæ—¶å®ç°å¤šä¸ªæ¥å£ã€‚</li><li>å®ç°é™åˆ¶ï¼šæ™®é€šç±»å¯ä»¥è¢«å…¶ä»–ç±»ç»§æ‰¿å’Œä½¿ç”¨ï¼Œè€ŒæŠ½è±¡ç±»ä¸€èˆ¬ç”¨äºä½œä¸ºåŸºç±»ï¼Œè¢«å…¶ä»–ç±»ç»§æ‰¿å’Œæ‰©å±•ä½¿ç”¨ã€‚</li></ul><h2 id="7-JavaæŠ½è±¡ç±»å’Œæ¥å£çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#7-JavaæŠ½è±¡ç±»å’Œæ¥å£çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="7.JavaæŠ½è±¡ç±»å’Œæ¥å£çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ"></a>7.JavaæŠ½è±¡ç±»å’Œæ¥å£çš„åŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ</h2><p><strong>ä¸¤è€…çš„ç‰¹ç‚¹ï¼š</strong></p><ul><li>æŠ½è±¡ç±»ç”¨äº<strong>æè¿°ç±»çš„å…±åŒç‰¹æ€§å’Œè¡Œä¸ºï¼Œå¯ä»¥æœ‰æˆå‘˜å˜é‡ã€æ„é€ æ–¹æ³•å’Œå…·ä½“æ–¹æ³•ã€‚</strong>é€‚ç”¨äºæœ‰æ˜æ˜¾<strong>ç»§æ‰¿</strong>å…³ç³»çš„åœºæ™¯ã€‚</li><li>æ¥å£ç”¨äºå®šä¹‰è¡Œä¸ºè§„èŒƒï¼Œå¯ä»¥å¤šå®ç°ï¼Œ<strong>åªèƒ½æœ‰å¸¸é‡å’ŒæŠ½è±¡æ–¹æ³•ï¼ˆJava 8 ä»¥åå¯ä»¥æœ‰é»˜è®¤æ–¹æ³•å’Œé™æ€æ–¹æ³•ï¼‰ã€‚</strong>é€‚ç”¨äºå®šä¹‰ç±»çš„èƒ½åŠ›æˆ–åŠŸèƒ½ã€‚</li></ul><p><strong>ä¸¤è€…çš„åŒºåˆ«ï¼š</strong></p><ul><li>å®ç°æ–¹å¼ï¼šå®ç°æ¥å£çš„å…³é”®å­—ä¸º<strong>implements</strong>ï¼Œç»§æ‰¿æŠ½è±¡ç±»çš„å…³é”®å­—ä¸º<strong>extends</strong>ã€‚ä¸€ä¸ªç±»å¯ä»¥å®ç°å¤šä¸ªæ¥å£ï¼Œä½†ä¸€ä¸ªç±»åªèƒ½ç»§æ‰¿ä¸€ä¸ªæŠ½è±¡ç±»ã€‚æ‰€ä»¥ï¼Œä½¿ç”¨æ¥å£å¯ä»¥é—´æ¥åœ°å®ç°å¤šé‡ç»§æ‰¿ã€‚</li><li>æ–¹æ³•æ–¹å¼ï¼š<strong>æ¥å£åªæœ‰å®šä¹‰ï¼Œä¸èƒ½æœ‰æ–¹æ³•çš„å®ç°</strong>ï¼Œjava 1.8ä¸­å¯ä»¥å®šä¹‰defaultæ–¹æ³•ä½“ï¼Œè€ŒæŠ½<strong>è±¡ç±»å¯ä»¥æœ‰å®šä¹‰ä¸å®ç°ï¼Œæ–¹æ³•å¯åœ¨æŠ½è±¡ç±»ä¸­å®ç°ã€‚</strong></li><li>è®¿é—®ä¿®é¥°ç¬¦ï¼š<strong>æ¥å£æˆå‘˜å˜é‡é»˜è®¤ä¸ºpublic static final</strong>ï¼Œå¿…é¡»èµ‹åˆå€¼ï¼Œä¸èƒ½è¢«ä¿®æ”¹ï¼›å…¶æ‰€æœ‰çš„æˆå‘˜æ–¹æ³•éƒ½æ˜¯publicã€abstractçš„ã€‚<strong>æŠ½è±¡ç±»ä¸­æˆå‘˜å˜é‡é»˜è®¤default</strong>ï¼Œå¯åœ¨å­ç±»ä¸­è¢«é‡æ–°å®šä¹‰ï¼Œä¹Ÿå¯è¢«é‡æ–°èµ‹å€¼ï¼›æŠ½è±¡æ–¹æ³•è¢«abstractä¿®é¥°ï¼Œä¸èƒ½è¢«privateã€staticã€synchronizedå’Œnativeç­‰ä¿®é¥°ï¼Œå¿…é¡»ä»¥åˆ†å·ç»“å°¾ï¼Œä¸å¸¦èŠ±æ‹¬å·ã€‚</li><li>å˜é‡ï¼š<strong>æŠ½è±¡ç±»å¯ä»¥åŒ…å«å®ä¾‹å˜é‡å’Œé™æ€å˜é‡ï¼Œè€Œæ¥å£åªèƒ½åŒ…å«å¸¸é‡ï¼ˆ</strong>å³é™æ€å¸¸é‡ï¼‰ã€‚</li></ul><h2 id="8-æŠ½è±¡ç±»èƒ½åŠ finalä¿®é¥°å—ï¼Ÿ"><a href="#8-æŠ½è±¡ç±»èƒ½åŠ finalä¿®é¥°å—ï¼Ÿ" class="headerlink" title="8.æŠ½è±¡ç±»èƒ½åŠ finalä¿®é¥°å—ï¼Ÿ"></a>8.æŠ½è±¡ç±»èƒ½åŠ finalä¿®é¥°å—ï¼Ÿ</h2><p><strong>ä¸èƒ½</strong>ï¼ŒJavaä¸­çš„æŠ½è±¡ç±»æ˜¯ç”¨æ¥è¢«ç»§æ‰¿çš„ï¼Œè€Œfinalä¿®é¥°ç¬¦ç”¨äºç¦æ­¢ç±»è¢«ç»§æ‰¿æˆ–æ–¹æ³•è¢«é‡å†™ï¼Œå› æ­¤ï¼ŒæŠ½è±¡ç±»å’Œfinalä¿®é¥°ç¬¦æ˜¯äº’æ–¥çš„ï¼Œä¸èƒ½åŒæ—¶ä½¿ç”¨ã€‚</p><h2 id="9-æ¥å£é‡Œé¢å¯ä»¥å®šä¹‰å“ªäº›æ–¹æ³•ï¼Ÿ"><a href="#9-æ¥å£é‡Œé¢å¯ä»¥å®šä¹‰å“ªäº›æ–¹æ³•ï¼Ÿ" class="headerlink" title="9.æ¥å£é‡Œé¢å¯ä»¥å®šä¹‰å“ªäº›æ–¹æ³•ï¼Ÿ"></a>9.æ¥å£é‡Œé¢å¯ä»¥å®šä¹‰å“ªäº›æ–¹æ³•ï¼Ÿ</h2><ul><li><strong>æŠ½è±¡æ–¹æ³•</strong></li></ul><p>æŠ½è±¡æ–¹æ³•æ˜¯æ¥å£çš„æ ¸å¿ƒéƒ¨åˆ†ï¼Œæ‰€æœ‰å®ç°æ¥å£çš„ç±»éƒ½å¿…é¡»å®ç°è¿™äº›æ–¹æ³•ã€‚æŠ½è±¡æ–¹æ³•é»˜è®¤æ˜¯ public å’Œ abstractï¼Œè¿™äº›ä¿®é¥°ç¬¦å¯ä»¥çœç•¥ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Animal</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">makeSound</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><strong>é»˜è®¤æ–¹æ³•</strong></li></ul><p>é»˜è®¤æ–¹æ³•æ˜¯åœ¨ Java 8 ä¸­å¼•å…¥çš„ï¼Œå…è®¸æ¥å£æä¾›å…·ä½“å®ç°ã€‚å®ç°ç±»å¯ä»¥é€‰æ‹©é‡å†™é»˜è®¤æ–¹æ³•ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Animal</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">makeSound</span><span class="params">()</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">default</span> <span class="keyword">void</span> <span class="title function_">sleep</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Sleeping...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><strong>é™æ€æ–¹æ³•</strong></li></ul><p>é™æ€æ–¹æ³•ä¹Ÿæ˜¯åœ¨ Java 8 ä¸­å¼•å…¥çš„ï¼Œå®ƒä»¬å±äºæ¥å£æœ¬èº«ï¼Œå¯ä»¥é€šè¿‡æ¥å£åç›´æ¥è°ƒç”¨ï¼Œè€Œä¸éœ€è¦å®ç°ç±»çš„å¯¹è±¡ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Animal</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">makeSound</span><span class="params">()</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">staticMethod</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Static method in interface&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><strong>ç§æœ‰æ–¹æ³•</strong></li></ul><p>ç§æœ‰æ–¹æ³•æ˜¯åœ¨ Java 9 ä¸­å¼•å…¥çš„ï¼Œç”¨äºåœ¨æ¥å£ä¸­ä¸ºé»˜è®¤æ–¹æ³•æˆ–å…¶ä»–ç§æœ‰æ–¹æ³•æä¾›è¾…åŠ©åŠŸèƒ½ã€‚è¿™äº›æ–¹æ³•ä¸èƒ½è¢«å®ç°ç±»è®¿é—®ï¼Œåªèƒ½åœ¨æ¥å£å†…éƒ¨ä½¿ç”¨ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Animal</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">makeSound</span><span class="params">()</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">default</span> <span class="keyword">void</span> <span class="title function_">sleep</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Sleeping...&quot;</span>);</span><br><span class="line">        logSleep();</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">logSleep</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Logging sleep&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Animal</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">makeSound</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="10-æŠ½è±¡ç±»å¯ä»¥è¢«å®ä¾‹åŒ–å—ï¼Ÿ"><a href="#10-æŠ½è±¡ç±»å¯ä»¥è¢«å®ä¾‹åŒ–å—ï¼Ÿ" class="headerlink" title="10.æŠ½è±¡ç±»å¯ä»¥è¢«å®ä¾‹åŒ–å—ï¼Ÿ"></a>10.æŠ½è±¡ç±»å¯ä»¥è¢«å®ä¾‹åŒ–å—ï¼Ÿ</h2><p>åœ¨Javaä¸­ï¼ŒæŠ½è±¡ç±»æœ¬èº«ä¸èƒ½è¢«å®ä¾‹åŒ–ã€‚</p><p>è¿™æ„å‘³ç€ä¸èƒ½ä½¿ç”¨<code>new</code>å…³é”®å­—ç›´æ¥åˆ›å»ºä¸€ä¸ªæŠ½è±¡ç±»çš„å¯¹è±¡ã€‚æŠ½è±¡ç±»çš„å­˜åœ¨ä¸»è¦æ˜¯ä¸ºäº†è¢«ç»§æ‰¿ï¼Œå®ƒé€šå¸¸åŒ…å«ä¸€ä¸ªæˆ–å¤šä¸ªæŠ½è±¡æ–¹æ³•ï¼ˆç”±<code>abstract</code>å…³é”®å­—ä¿®é¥°ä¸”æ— æ–¹æ³•ä½“çš„æ–¹æ³•ï¼‰ï¼Œè¿™äº›æ–¹æ³•éœ€è¦åœ¨å­ç±»ä¸­è¢«å®ç°ã€‚</p><p><strong>æŠ½è±¡ç±»å¯ä»¥æœ‰æ„é€ å™¨ï¼Œä»–å¯ä»¥æœ‰æ„é€ æ–¹æ³•ï¼Œè¿™äº›æ„é€ å™¨åœ¨å­ç±»å®ä¾‹åŒ–æ—¶ä¼šè¢«è°ƒç”¨ï¼Œä»¥ä¾¿è¿›è¡Œå¿…è¦çš„åˆå§‹åŒ–å·¥ä½œã€‚</strong>ç„¶è€Œï¼Œè¿™ä¸ªè¿‡ç¨‹å¹¶ä¸æ˜¯ç›´æ¥å®ä¾‹åŒ–æŠ½è±¡ç±»ï¼Œ<strong>è€Œæ˜¯åˆ›å»ºäº†å­ç±»çš„å®ä¾‹ï¼Œé—´æ¥åœ°ä½¿ç”¨äº†æŠ½è±¡ç±»çš„æ„é€ å™¨ã€‚</strong></p><p>ç®€è€Œè¨€ä¹‹ï¼ŒæŠ½è±¡ç±»ä¸èƒ½ç›´æ¥å®ä¾‹åŒ–ï¼Œä½†é€šè¿‡ç»§æ‰¿æŠ½è±¡ç±»å¹¶å®ç°æ‰€æœ‰æŠ½è±¡æ–¹æ³•çš„å­ç±»æ˜¯å¯ä»¥è¢«å®ä¾‹åŒ–çš„ã€‚</p><h2 id="11-æ¥å£å¯ä»¥åŒ…å«æ„é€ å‡½æ•°å—ï¼Ÿ"><a href="#11-æ¥å£å¯ä»¥åŒ…å«æ„é€ å‡½æ•°å—ï¼Ÿ" class="headerlink" title="11.æ¥å£å¯ä»¥åŒ…å«æ„é€ å‡½æ•°å—ï¼Ÿ"></a>11.æ¥å£å¯ä»¥åŒ…å«æ„é€ å‡½æ•°å—ï¼Ÿ</h2><p><strong>åœ¨æ¥å£ä¸­ï¼Œä¸å¯ä»¥æœ‰æ„é€ æ–¹æ³•</strong>,åœ¨æ¥å£é‡Œå†™å…¥æ„é€ æ–¹æ³•æ—¶ï¼Œç¼–è¯‘å™¨æç¤ºï¼šInterfaces cannot have constructorsï¼Œå› ä¸ºæ¥å£ä¸ä¼šæœ‰è‡ªå·±çš„å®ä¾‹çš„ï¼Œæ‰€ä»¥ä¸éœ€è¦æœ‰æ„é€ å‡½æ•°ã€‚</p><p>ä¸ºä»€ä¹ˆå‘¢ï¼Ÿæ„é€ å‡½æ•°å°±æ˜¯åˆå§‹åŒ–classçš„å±æ€§æˆ–è€…æ–¹æ³•ï¼Œåœ¨newçš„ä¸€ç¬é—´è‡ªåŠ¨è°ƒç”¨ï¼Œé‚£ä¹ˆé—®é¢˜æ¥äº†Javaçš„æ¥å£ï¼Œéƒ½ä¸èƒ½new é‚£ä¹ˆè¦æ„é€ å‡½æ•°å¹²å˜›å‘¢ï¼Ÿæ ¹æœ¬å°±æ²¡æ³•è°ƒç”¨</p><h2 id="12-è§£é‡ŠJavaä¸­çš„é™æ€å˜é‡å’Œé™æ€æ–¹æ³•"><a href="#12-è§£é‡ŠJavaä¸­çš„é™æ€å˜é‡å’Œé™æ€æ–¹æ³•" class="headerlink" title="12.è§£é‡ŠJavaä¸­çš„é™æ€å˜é‡å’Œé™æ€æ–¹æ³•"></a>12.è§£é‡ŠJavaä¸­çš„é™æ€å˜é‡å’Œé™æ€æ–¹æ³•</h2><p>åœ¨Javaä¸­ï¼Œ<strong>é™æ€å˜é‡å’Œé™æ€æ–¹æ³•æ˜¯ä¸ç±»æœ¬èº«å…³è”çš„ï¼Œè€Œä¸æ˜¯ä¸ç±»çš„å®ä¾‹ï¼ˆå¯¹è±¡ï¼‰å…³è”ã€‚å®ƒä»¬åœ¨å†…å­˜ä¸­åªå­˜åœ¨ä¸€ä»½ï¼Œå¯ä»¥è¢«ç±»çš„æ‰€æœ‰å®ä¾‹å…±äº«ã€‚</strong></p><blockquote><p>é™æ€å˜é‡</p></blockquote><p>é™æ€å˜é‡ï¼ˆä¹Ÿç§°ä¸ºç±»å˜é‡ï¼‰æ˜¯åœ¨ç±»ä¸­ä½¿ç”¨<code>static</code>å…³é”®å­—å£°æ˜çš„å˜é‡ã€‚å®ƒä»¬å±äºç±»è€Œä¸æ˜¯ä»»ä½•å…·ä½“çš„å¯¹è±¡ã€‚ä¸»è¦çš„ç‰¹ç‚¹ï¼š</p><ul><li><strong>å…±äº«æ€§</strong>ï¼š<strong>æ‰€æœ‰è¯¥ç±»çš„å®ä¾‹å…±äº«åŒä¸€ä¸ªé™æ€å˜é‡</strong>ã€‚å¦‚æœä¸€ä¸ªå®ä¾‹ä¿®æ”¹äº†é™æ€å˜é‡çš„å€¼ï¼Œå…¶ä»–å®ä¾‹ä¹Ÿä¼šçœ‹åˆ°è¿™ä¸ªæ›´æ”¹ã€‚</li><li><strong>åˆå§‹åŒ–</strong>ï¼š<strong>é™æ€å˜é‡åœ¨ç±»è¢«åŠ è½½æ—¶åˆå§‹åŒ–ï¼Œåªä¼šå¯¹å…¶è¿›è¡Œä¸€æ¬¡åˆ†é…å†…å­˜ã€‚</strong></li><li><strong>è®¿é—®æ–¹å¼</strong>ï¼šé™æ€å˜é‡å¯ä»¥ç›´æ¥é€šè¿‡<strong>ç±»åè®¿é—®</strong>ï¼Œä¹Ÿå¯ä»¥é€šè¿‡å®ä¾‹è®¿é—®ï¼Œä½†æ¨èä½¿ç”¨ç±»åã€‚</li></ul><blockquote><p>é™æ€æ–¹æ³•</p></blockquote><p>é™æ€æ–¹æ³•æ˜¯åœ¨ç±»ä¸­ä½¿ç”¨<code>static</code>å…³é”®å­—å£°æ˜çš„æ–¹æ³•ã€‚ç±»ä¼¼äºé™æ€å˜é‡ï¼Œé™æ€æ–¹æ³•ä¹Ÿå±äºç±»ï¼Œè€Œä¸æ˜¯ä»»ä½•å…·ä½“çš„å¯¹è±¡ã€‚ä¸»è¦çš„ç‰¹ç‚¹ï¼š</p><ul><li><strong>æ— å®ä¾‹ä¾èµ–</strong>ï¼šé™æ€æ–¹æ³•å¯ä»¥åœ¨æ²¡æœ‰åˆ›å»ºç±»å®ä¾‹çš„æƒ…å†µä¸‹è°ƒç”¨ã€‚<strong>å¯¹äºé™æ€æ–¹æ³•æ¥è¯´ï¼Œä¸èƒ½ç›´æ¥è®¿é—®éé™æ€çš„æˆå‘˜å˜é‡æˆ–æ–¹æ³•</strong>ï¼Œå› ä¸ºé™æ€æ–¹æ³•æ²¡æœ‰ä¸Šä¸‹æ–‡çš„å®ä¾‹ã€‚</li><li><strong>è®¿é—®é™æ€æˆå‘˜</strong>ï¼šé™æ€æ–¹æ³•<strong>å¯ä»¥ç›´æ¥è°ƒç”¨å…¶ä»–é™æ€å˜é‡å’Œé™æ€æ–¹æ³•ï¼Œä½†ä¸èƒ½ç›´æ¥è®¿é—®éé™æ€æˆå‘˜ã€‚</strong></li><li><strong>å¤šæ€æ€§</strong>ï¼šé™æ€æ–¹æ³•ä¸æ”¯æŒé‡å†™ï¼ˆOverrideï¼‰ï¼Œä½†å¯ä»¥è¢«éšè—ï¼ˆHideï¼‰ã€‚</li></ul><h2 id="13-éé™æ€å†…éƒ¨ç±»å’Œé™æ€å†…éƒ¨ç±»çš„åŒºåˆ«ï¼Ÿ"><a href="#13-éé™æ€å†…éƒ¨ç±»å’Œé™æ€å†…éƒ¨ç±»çš„åŒºåˆ«ï¼Ÿ" class="headerlink" title="13.éé™æ€å†…éƒ¨ç±»å’Œé™æ€å†…éƒ¨ç±»çš„åŒºåˆ«ï¼Ÿ"></a>13.éé™æ€å†…éƒ¨ç±»å’Œé™æ€å†…éƒ¨ç±»çš„åŒºåˆ«ï¼Ÿ</h2><p>åŒºåˆ«åŒ…æ‹¬ï¼š</p><ul><li>éé™æ€å†…éƒ¨ç±»ä¾èµ–äºå¤–éƒ¨ç±»çš„å®ä¾‹ï¼Œè€Œé™æ€å†…éƒ¨ç±»ä¸ä¾èµ–äºå¤–éƒ¨ç±»çš„å®ä¾‹ã€‚</li><li>éé™æ€å†…éƒ¨ç±»å¯ä»¥è®¿é—®å¤–éƒ¨ç±»çš„å®ä¾‹å˜é‡å’Œæ–¹æ³•ï¼Œè€Œé™æ€å†…éƒ¨ç±»åªèƒ½è®¿é—®å¤–éƒ¨ç±»çš„é™æ€æˆå‘˜ã€‚</li><li>éé™æ€å†…éƒ¨ç±»ä¸èƒ½å®šä¹‰é™æ€æˆå‘˜ï¼Œè€Œé™æ€å†…éƒ¨ç±»å¯ä»¥å®šä¹‰é™æ€æˆå‘˜ã€‚</li><li>éé™æ€å†…éƒ¨ç±»åœ¨å¤–éƒ¨ç±»å®ä¾‹åŒ–åæ‰èƒ½å®ä¾‹åŒ–ï¼Œè€Œé™æ€å†…éƒ¨ç±»å¯ä»¥ç‹¬ç«‹å®ä¾‹åŒ–ã€‚</li><li>éé™æ€å†…éƒ¨ç±»å¯ä»¥è®¿é—®å¤–éƒ¨ç±»çš„ç§æœ‰æˆå‘˜ï¼Œè€Œé™æ€å†…éƒ¨ç±»ä¸èƒ½ç›´æ¥è®¿é—®å¤–éƒ¨ç±»çš„ç§æœ‰æˆå‘˜ï¼Œéœ€è¦é€šè¿‡å®ä¾‹åŒ–å¤–éƒ¨ç±»æ¥è®¿é—®ã€‚</li></ul><p>æ€»ç»“æ¥è¯´<strong>ä¸€å†…ä¸€å¤–</strong></p><h2 id="14-éé™æ€å†…éƒ¨ç±»å¯ä»¥ç›´æ¥è®¿é—®å¤–éƒ¨æ–¹æ³•ï¼Œç¼–è¯‘å™¨æ˜¯æ€ä¹ˆåšåˆ°çš„ï¼Ÿ"><a href="#14-éé™æ€å†…éƒ¨ç±»å¯ä»¥ç›´æ¥è®¿é—®å¤–éƒ¨æ–¹æ³•ï¼Œç¼–è¯‘å™¨æ˜¯æ€ä¹ˆåšåˆ°çš„ï¼Ÿ" class="headerlink" title="14.éé™æ€å†…éƒ¨ç±»å¯ä»¥ç›´æ¥è®¿é—®å¤–éƒ¨æ–¹æ³•ï¼Œç¼–è¯‘å™¨æ˜¯æ€ä¹ˆåšåˆ°çš„ï¼Ÿ"></a>14.éé™æ€å†…éƒ¨ç±»å¯ä»¥ç›´æ¥è®¿é—®å¤–éƒ¨æ–¹æ³•ï¼Œç¼–è¯‘å™¨æ˜¯æ€ä¹ˆåšåˆ°çš„ï¼Ÿ</h2><p>éé™æ€å†…éƒ¨ç±»å¯ä»¥ç›´æ¥è®¿é—®å¤–éƒ¨æ–¹æ³•æ˜¯å› ä¸º<strong>ç¼–è¯‘å™¨åœ¨ç”Ÿæˆå­—èŠ‚ç æ—¶ä¼šä¸ºéé™æ€å†…éƒ¨ç±»ç»´æŠ¤ä¸€ä¸ªæŒ‡å‘å¤–éƒ¨ç±»å®ä¾‹çš„å¼•ç”¨ã€‚</strong></p><p>è¿™ä¸ªå¼•ç”¨ä½¿å¾—éé™æ€å†…éƒ¨ç±»èƒ½å¤Ÿè®¿é—®å¤–éƒ¨ç±»çš„å®ä¾‹å˜é‡å’Œæ–¹æ³•ã€‚<strong>ç¼–è¯‘å™¨ä¼šåœ¨ç”Ÿæˆéé™æ€å†…éƒ¨ç±»çš„æ„é€ æ–¹æ³•æ—¶ï¼Œå°†å¤–éƒ¨ç±»å®ä¾‹ä½œä¸ºå‚æ•°ä¼ å…¥ï¼Œå¹¶åœ¨å†…éƒ¨ç±»çš„å®ä¾‹åŒ–è¿‡ç¨‹ä¸­å»ºç«‹å¤–éƒ¨ç±»å®ä¾‹ä¸å†…éƒ¨ç±»å®ä¾‹ä¹‹é—´çš„è”ç³»ï¼Œä»è€Œå®ç°ç›´æ¥è®¿é—®å¤–éƒ¨æ–¹æ³•çš„åŠŸèƒ½ã€‚</strong></p><h1 id="å…³é”®è¯-amp-æ³›å‹-amp-åå°„"><a href="#å…³é”®è¯-amp-æ³›å‹-amp-åå°„" class="headerlink" title="å…³é”®è¯&amp;æ³›å‹&amp;åå°„"></a>å…³é”®è¯&amp;æ³›å‹&amp;åå°„</h1><h2 id="1-Java-ä¸­-final-ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#1-Java-ä¸­-final-ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="1.Java ä¸­ final ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ"></a>1.Java ä¸­ final ä½œç”¨æ˜¯ä»€ä¹ˆï¼Ÿ</h2><p><code>final</code>å…³é”®å­—ä¸»è¦æœ‰ä»¥ä¸‹ä¸‰ä¸ªæ–¹é¢çš„ä½œç”¨ï¼šç”¨äºä¿®é¥°ç±»ã€æ–¹æ³•å’Œå˜é‡ã€‚</p><ul><li>ä¿®é¥°ç±»ï¼šå½“<code>final</code>ä¿®é¥°ä¸€ä¸ªç±»æ—¶ï¼Œ<strong>è¡¨ç¤ºè¿™ä¸ªç±»ä¸èƒ½è¢«ç»§æ‰¿</strong>ï¼Œæ˜¯ç±»ç»§æ‰¿ä½“ç³»ä¸­çš„æœ€ç»ˆå½¢æ€ã€‚ä¾‹å¦‚ï¼ŒJava ä¸­çš„<code>String</code>ç±»å°±æ˜¯ç”¨<code>final</code>ä¿®é¥°çš„ï¼Œè¿™ä¿è¯äº†<code>String</code>ç±»çš„ä¸å¯å˜æ€§å’Œå®‰å…¨æ€§ï¼Œé˜²æ­¢å…¶ä»–ç±»é€šè¿‡ç»§æ‰¿æ¥æ”¹å˜<code>String</code>ç±»çš„è¡Œä¸ºå’Œç‰¹æ€§ã€‚</li><li>ä¿®é¥°æ–¹æ³•ï¼š<strong>ç”¨<code>final</code>ä¿®é¥°çš„æ–¹æ³•ä¸èƒ½åœ¨å­ç±»ä¸­è¢«é‡å†™</strong>ã€‚æ¯”å¦‚ï¼Œ<code>java.lang.Object</code>ç±»ä¸­çš„<code>getClass</code>æ–¹æ³•å°±æ˜¯<code>final</code>çš„ï¼Œå› ä¸ºè¿™ä¸ªæ–¹æ³•çš„è¡Œä¸ºæ˜¯ç”± Java è™šæ‹Ÿæœºåº•å±‚å®ç°æ¥ä¿è¯çš„ï¼Œä¸åº”è¯¥è¢«å­ç±»ä¿®æ”¹ã€‚</li><li>ä¿®é¥°å˜é‡ï¼š<strong>å½“<code>final</code>ä¿®é¥°åŸºæœ¬æ•°æ®ç±»å‹çš„å˜é‡æ—¶ï¼Œè¯¥å˜é‡ä¸€æ—¦è¢«èµ‹å€¼å°±ä¸èƒ½å†æ”¹å˜ã€‚</strong>ä¾‹å¦‚ï¼Œ<code>final int num = 10;</code>ï¼Œè¿™é‡Œçš„<code>num</code>å°±æ˜¯ä¸€ä¸ªå¸¸é‡ï¼Œä¸èƒ½å†å¯¹å…¶è¿›è¡Œé‡æ–°èµ‹å€¼æ“ä½œï¼Œå¦åˆ™ä¼šå¯¼è‡´ç¼–è¯‘é”™è¯¯ã€‚<strong>å¯¹äºå¼•ç”¨æ•°æ®ç±»å‹ï¼Œ<code>final</code>ä¿®é¥°æ„å‘³ç€è¿™ä¸ªå¼•ç”¨å˜é‡ä¸èƒ½å†æŒ‡å‘å…¶ä»–å¯¹è±¡ï¼Œä½†å¯¹è±¡æœ¬èº«çš„å†…å®¹æ˜¯å¯ä»¥æ”¹å˜çš„ã€‚</strong>ä¾‹å¦‚ï¼Œ<code>final StringBuilder sb = new StringBuilder(&quot;Hello&quot;);</code>ï¼Œä¸èƒ½è®©<code>sb</code>å†æŒ‡å‘å…¶ä»–<code>StringBuilder</code>å¯¹è±¡ï¼Œä½†å¯ä»¥é€šè¿‡<code>sb.append(&quot; World&quot;);</code>æ¥ä¿®æ”¹å­—ç¬¦ä¸²çš„å†…å®¹ã€‚</li></ul><h2 id="2-ä»€ä¹ˆæ˜¯æ³›å‹ï¼Ÿ"><a href="#2-ä»€ä¹ˆæ˜¯æ³›å‹ï¼Ÿ" class="headerlink" title="2.ä»€ä¹ˆæ˜¯æ³›å‹ï¼Ÿ"></a>2.ä»€ä¹ˆæ˜¯æ³›å‹ï¼Ÿ</h2><p>æ³›å‹æ˜¯ Java ç¼–ç¨‹è¯­è¨€ä¸­çš„ä¸€ä¸ªé‡è¦ç‰¹æ€§ï¼Œ<strong>å®ƒå…è®¸ç±»ã€æ¥å£å’Œæ–¹æ³•åœ¨å®šä¹‰æ—¶ä½¿ç”¨ä¸€ä¸ªæˆ–å¤šä¸ªç±»å‹å‚æ•°ï¼Œè¿™äº›ç±»å‹å‚æ•°åœ¨ä½¿ç”¨æ—¶å¯ä»¥è¢«æŒ‡å®šä¸ºå…·ä½“çš„ç±»å‹ã€‚</strong></p><p>æ³›å‹çš„ä¸»è¦ç›®çš„æ˜¯<strong>åœ¨ç¼–è¯‘æ—¶æä¾›æ›´å¼ºçš„ç±»å‹æ£€æŸ¥ï¼Œå¹¶ä¸”åœ¨ç¼–è¯‘åèƒ½å¤Ÿä¿ç•™ç±»å‹ä¿¡æ¯ï¼Œ</strong>é¿å…äº†åœ¨è¿è¡Œæ—¶å‡ºç°ç±»å‹è½¬æ¢å¼‚å¸¸ã€‚</p><blockquote><p>ä¸ºä»€ä¹ˆéœ€è¦æ³›å‹ï¼Ÿ</p></blockquote><ul><li><strong>é€‚ç”¨äºå¤šç§æ•°æ®ç±»å‹æ‰§è¡Œç›¸åŒçš„ä»£ç </strong></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="type">int</span> <span class="title function_">add</span><span class="params">(<span class="type">int</span> a, <span class="type">int</span> b)</span> &#123;</span><br><span class="line">    System.out.println(a + <span class="string">&quot;+&quot;</span> + b + <span class="string">&quot;=&quot;</span> + (a + b));</span><br><span class="line">    <span class="keyword">return</span> a + b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="type">float</span> <span class="title function_">add</span><span class="params">(<span class="type">float</span> a, <span class="type">float</span> b)</span> &#123;</span><br><span class="line">    System.out.println(a + <span class="string">&quot;+&quot;</span> + b + <span class="string">&quot;=&quot;</span> + (a + b));</span><br><span class="line">    <span class="keyword">return</span> a + b;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> <span class="type">double</span> <span class="title function_">add</span><span class="params">(<span class="type">double</span> a, <span class="type">double</span> b)</span> &#123;</span><br><span class="line">    System.out.println(a + <span class="string">&quot;+&quot;</span> + b + <span class="string">&quot;=&quot;</span> + (a + b));</span><br><span class="line">    <span class="keyword">return</span> a + b;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœæ²¡æœ‰æ³›å‹ï¼Œè¦å®ç°ä¸åŒç±»å‹çš„åŠ æ³•ï¼Œæ¯ç§ç±»å‹éƒ½éœ€è¦é‡è½½ä¸€ä¸ªaddæ–¹æ³•ï¼›é€šè¿‡æ³›å‹ï¼Œæˆ‘ä»¬å¯ä»¥å¤ç”¨ä¸ºä¸€ä¸ªæ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="keyword">static</span> &lt;T <span class="keyword">extends</span> <span class="title class_">Number</span>&gt; <span class="type">double</span> <span class="title function_">add</span><span class="params">(T a, T b)</span> &#123;</span><br><span class="line">    System.out.println(a + <span class="string">&quot;+&quot;</span> + b + <span class="string">&quot;=&quot;</span> + (a.doubleValue() + b.doubleValue()));</span><br><span class="line">    <span class="keyword">return</span> a.doubleValue() + b.doubleValue();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><strong>æ³›å‹ä¸­çš„ç±»å‹åœ¨ä½¿ç”¨æ—¶æŒ‡å®šï¼Œä¸éœ€è¦å¼ºåˆ¶ç±»å‹è½¬æ¢</strong>ï¼ˆ<strong>ç±»å‹å®‰å…¨</strong>ï¼Œç¼–è¯‘å™¨ä¼š<strong>æ£€æŸ¥ç±»å‹</strong>ï¼‰</li></ul><p>çœ‹ä¸‹è¿™ä¸ªä¾‹å­ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">List</span> <span class="variable">list</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ArrayList</span>();</span><br><span class="line">list.add(<span class="string">&quot;xxString&quot;</span>);</span><br><span class="line">list.add(<span class="number">100d</span>);</span><br><span class="line">list.add(<span class="keyword">new</span> <span class="title class_">Person</span>());</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬åœ¨ä½¿ç”¨ä¸Šè¿°listä¸­ï¼Œlistä¸­çš„å…ƒç´ éƒ½æ˜¯Objectç±»å‹ï¼ˆæ— æ³•çº¦æŸå…¶ä¸­çš„ç±»å‹ï¼‰ï¼Œæ‰€ä»¥åœ¨å–å‡ºé›†åˆå…ƒç´ æ—¶éœ€è¦äººä¸ºçš„å¼ºåˆ¶ç±»å‹è½¬åŒ–åˆ°å…·ä½“çš„ç›®æ ‡ç±»å‹ï¼Œ<strong>ä¸”å¾ˆå®¹æ˜“å‡ºç°java.lang.ClassCastExceptionå¼‚å¸¸ã€‚</strong></p><p>å¼•å…¥æ³›å‹ï¼Œå®ƒå°†æä¾›ç±»å‹çš„çº¦æŸï¼Œ<strong>æä¾›ç¼–è¯‘å‰çš„æ£€æŸ¥ï¼š</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">List&lt;String&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;String&gt;();</span><br><span class="line"></span><br><span class="line"><span class="comment">// listä¸­åªèƒ½æ”¾String, ä¸èƒ½æ”¾å…¶å®ƒç±»å‹çš„å…ƒç´ </span></span><br></pre></td></tr></table></figure><p>å¥½å¤„ï¼š</p><p><strong>ç¼–è¯‘æœŸç±»å‹æ£€æŸ¥</strong>ï¼Œæå‡ä»£ç å®‰å…¨æ€§ï¼Œé˜²æ­¢è¿è¡Œæ—¶ç±»å‹è½¬æ¢å¼‚å¸¸ï¼ˆClassCastExceptionï¼‰ã€‚ç¼–è¯‘æ—¶ä¼šè‡ªåŠ¨è£…ç®±æ‹†ç®±æ¥é…åˆåŸºæœ¬ç±»å‹çš„åŒ…è£…ç±»ã€‚</p><p><strong>é¿å…å¼ºåˆ¶ç±»å‹è½¬æ¢</strong>ï¼Œä»£ç æ›´ç®€æ´æ¸…æ™°ã€‚</p><p><strong>æé«˜ä»£ç å¤ç”¨æ€§</strong>ï¼ŒåŒä¸€ä»½ä»£ç å¯ä»¥å¤„ç†ä¸åŒç±»å‹çš„æ•°æ®ã€‚</p><p>ä»–åªèƒ½ä½¿ç”¨åŒ…è£…ç±»ï¼Œä¸èƒ½ç”¨äºåŸºæœ¬çš„æ•°æ®ç±»å‹</p><p>Java æ³›å‹é‡‡ç”¨<strong>ç±»å‹æ“¦é™¤</strong>å®ç°ï¼Œæ³›å‹ä¿¡æ¯åœ¨ç¼–è¯‘åè¢«æ“¦é™¤ï¼Œæ³›å‹å˜é‡å˜ä¸ºåŸå§‹ç±»å‹ï¼ˆé€šå¸¸æ˜¯Objectæˆ–è¾¹ç•Œç±»å‹ï¼‰ã€‚</p><p>è¿è¡Œçš„æ—¶å€™æ˜¯ä¸èƒ½ä½¿ç”¨çš„ï¼Œæ¯”å¦‚ä¸èƒ½åˆ›å»ºæ³›å‹æ•°ç»„ï¼Œæ— æ³•è¿›è¡Œç±»å‹åˆ¤æ–­ç­‰</p><h2 id="3-ä»€ä¹ˆæ˜¯åå°„"><a href="#3-ä»€ä¹ˆæ˜¯åå°„" class="headerlink" title="3.ä»€ä¹ˆæ˜¯åå°„"></a>3.ä»€ä¹ˆæ˜¯åå°„</h2><p>Java åå°„æœºåˆ¶æ˜¯<strong>åœ¨è¿è¡ŒçŠ¶æ€ä¸­ï¼Œå¯¹äºä»»æ„ä¸€ä¸ªç±»ï¼Œéƒ½èƒ½å¤ŸçŸ¥é“è¿™ä¸ªç±»ä¸­çš„æ‰€æœ‰å±æ€§å’Œæ–¹æ³•ï¼Œå¯¹äºä»»æ„ä¸€ä¸ªå¯¹è±¡ï¼Œéƒ½èƒ½å¤Ÿè°ƒç”¨å®ƒçš„ä»»æ„ä¸€ä¸ªæ–¹æ³•å’Œå±æ€§ï¼›</strong>è¿™ç§<strong>åŠ¨æ€è·å–</strong>çš„ä¿¡æ¯ä»¥åŠåŠ¨æ€è°ƒç”¨å¯¹è±¡çš„æ–¹æ³•çš„åŠŸèƒ½ç§°ä¸º Java è¯­è¨€çš„åå°„æœºåˆ¶ã€‚</p><p>åå°„å…·æœ‰ä»¥ä¸‹ç‰¹æ€§ï¼š</p><ol><li><strong>è¿è¡Œæ—¶ç±»ä¿¡æ¯è®¿é—®</strong>ï¼šåå°„æœºåˆ¶å…è®¸ç¨‹åºåœ¨<strong>è¿è¡Œæ—¶è·å–ç±»çš„å®Œæ•´ç»“æ„ä¿¡æ¯</strong>ï¼ŒåŒ…æ‹¬ç±»åã€åŒ…åã€çˆ¶ç±»ã€å®ç°çš„æ¥å£ã€æ„é€ å‡½æ•°ã€æ–¹æ³•å’Œå­—æ®µç­‰ã€‚</li><li><strong>åŠ¨æ€å¯¹è±¡åˆ›å»º</strong>ï¼šå¯ä»¥ä½¿ç”¨<strong>åå°„APIåŠ¨æ€åœ°åˆ›å»ºå¯¹è±¡å®ä¾‹</strong>ï¼Œå³ä½¿åœ¨ç¼–è¯‘æ—¶ä¸çŸ¥é“å…·ä½“çš„ç±»åã€‚è¿™æ˜¯é€šè¿‡Classç±»çš„newInstance()æ–¹æ³•æˆ–Constructorå¯¹è±¡çš„newInstance()æ–¹æ³•å®ç°çš„ã€‚</li><li><strong>åŠ¨æ€æ–¹æ³•è°ƒç”¨</strong>ï¼šå¯ä»¥åœ¨<strong>è¿è¡Œæ—¶åŠ¨æ€åœ°è°ƒç”¨å¯¹è±¡çš„æ–¹æ³•</strong>ï¼ŒåŒ…æ‹¬ç§æœ‰æ–¹æ³•ã€‚è¿™é€šè¿‡Methodç±»çš„invoke()æ–¹æ³•å®ç°ï¼Œå…è®¸ä½ ä¼ å…¥å¯¹è±¡å®ä¾‹å’Œå‚æ•°å€¼æ¥æ‰§è¡Œæ–¹æ³•ã€‚</li><li><strong>è®¿é—®å’Œä¿®æ”¹å­—æ®µå€¼</strong>ï¼šåå°„è¿˜å…è®¸<strong>ç¨‹åºåœ¨è¿è¡Œæ—¶è®¿é—®å’Œä¿®æ”¹å¯¹è±¡çš„å­—æ®µå€¼</strong>ï¼Œå³ä½¿æ˜¯ç§æœ‰çš„ã€‚è¿™æ˜¯é€šè¿‡Fieldç±»çš„get()å’Œset()æ–¹æ³•å®Œæˆçš„ã€‚</li></ol><p>ä½¿ç”¨å®ä¾‹ï¼š</p><blockquote><p>åŠ è½½æ•°æ®åº“é©±åŠ¨</p></blockquote><p>æˆ‘ä»¬çš„é¡¹ç›®åº•å±‚æ•°æ®åº“æœ‰æ—¶æ˜¯ç”¨mysqlï¼Œæœ‰æ—¶ç”¨oracleï¼Œéœ€è¦åŠ¨æ€åœ°æ ¹æ®å®é™…æƒ…å†µåŠ è½½é©±åŠ¨ç±»ï¼Œè¿™ä¸ªæ—¶å€™åå°„å°±æœ‰ç”¨äº†ï¼Œå‡è®¾ com.mikechen.java.myqlConnectionï¼Œcom.mikechen.java.oracleConnectionè¿™ä¸¤ä¸ªç±»æˆ‘ä»¬è¦ç”¨ã€‚</p><p>è¿™æ—¶å€™æˆ‘ä»¬åœ¨ä½¿ç”¨ <strong>JDBC è¿æ¥æ•°æ®åº“æ—¶ä½¿ç”¨ Class.forName()é€šè¿‡åå°„åŠ è½½æ•°æ®åº“çš„é©±åŠ¨ç¨‹åºï¼Œ</strong>å¦‚æœæ˜¯mysqlåˆ™ä¼ å…¥mysqlçš„é©±åŠ¨ç±»ï¼Œè€Œå¦‚æœæ˜¯oracleåˆ™ä¼ å…¥çš„å‚æ•°å°±å˜æˆå¦ä¸€ä¸ªäº†ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//  DriverManager.registerDriver(new com.mysql.cj.jdbc.Driver());</span></span><br><span class="line">Class.forName(<span class="string">&quot;com.mysql.cj.jdbc.Driver&quot;</span>);</span><br></pre></td></tr></table></figure><blockquote><p>é…ç½®æ–‡ä»¶åŠ è½½</p></blockquote><p>Spring æ¡†æ¶çš„ IOCï¼ˆåŠ¨æ€åŠ è½½ç®¡ç† Beanï¼‰ï¼ŒSpringé€šè¿‡é…ç½®æ–‡ä»¶é…ç½®å„ç§å„æ ·çš„beanï¼Œä½ éœ€è¦ç”¨åˆ°å“ªäº›beanå°±é…å“ªäº›ï¼Œspringå®¹å™¨å°±ä¼šæ ¹æ®ä½ çš„éœ€æ±‚å»åŠ¨æ€åŠ è½½ï¼Œä½ çš„ç¨‹åºå°±èƒ½å¥å£®åœ°è¿è¡Œã€‚</p><p>Springé€šè¿‡XMLé…ç½®æ¨¡å¼è£…è½½Beançš„è¿‡ç¨‹ï¼š</p><ul><li>å°†ç¨‹åºä¸­æ‰€æœ‰XMLæˆ–propertiesé…ç½®æ–‡ä»¶åŠ è½½å…¥å†…å­˜</li><li>Javaç±»é‡Œé¢<strong>è§£æxmlæˆ–è€…propertiesé‡Œé¢çš„å†…å®¹ï¼Œå¾—åˆ°å¯¹åº”å®ä½“ç±»çš„å­—èŠ‚ç å­—ç¬¦ä¸²ä»¥åŠç›¸å…³çš„å±æ€§ä¿¡æ¯</strong></li><li>ä½¿ç”¨åå°„æœºåˆ¶ï¼Œæ ¹æ®è¿™ä¸ªå­—ç¬¦ä¸²è·å¾—<strong>æŸä¸ªç±»çš„Classå®ä¾‹</strong></li><li>åŠ¨æ€é…ç½®å®ä¾‹çš„å±æ€§</li></ul><p>é…ç½®æ–‡ä»¶</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">className=com.example.reflectdemo.TestInvoke</span><br><span class="line">methodName=printlnState</span><br></pre></td></tr></table></figure><p>å®ä½“ç±»</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">TestInvoke</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">printlnState</span><span class="params">()</span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;I am fine&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è§£æé…ç½®æ–‡ä»¶å†…å®¹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è§£æxmlæˆ–propertiesé‡Œé¢çš„å†…å®¹ï¼Œå¾—åˆ°å¯¹åº”å®ä½“ç±»çš„å­—èŠ‚ç å­—ç¬¦ä¸²ä»¥åŠå±æ€§ä¿¡æ¯</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title function_">getName</span><span class="params">(String key)</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">    <span class="type">Properties</span> <span class="variable">properties</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Properties</span>();</span><br><span class="line">    <span class="type">FileInputStream</span> <span class="variable">in</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;D:\IdeaProjects\AllDemos\language-specification\src\main\resources\application.properties&quot;</span>);</span><br><span class="line">    properties.load(in);</span><br><span class="line">    in.close();</span><br><span class="line">    <span class="keyword">return</span> properties.getProperty(key);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆ©ç”¨åå°„è·å–å®ä½“ç±»çš„Classå®ä¾‹ï¼Œåˆ›å»ºå®ä½“ç±»çš„å®ä¾‹å¯¹è±¡ï¼Œè°ƒç”¨æ–¹æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> NoSuchMethodException, InvocationTargetException, IllegalAccessException, IOException, ClassNotFoundException, InstantiationException &#123;</span><br><span class="line">    <span class="comment">// ä½¿ç”¨åå°„æœºåˆ¶ï¼Œæ ¹æ®è¿™ä¸ªå­—ç¬¦ä¸²è·å¾—Classå¯¹è±¡</span></span><br><span class="line">    Class&lt;?&gt; c = Class.forName(getName(<span class="string">&quot;className&quot;</span>));</span><br><span class="line">    System.out.println(c.getSimpleName());</span><br><span class="line">    <span class="comment">// è·å–æ–¹æ³•</span></span><br><span class="line">    <span class="type">Method</span> <span class="variable">method</span> <span class="operator">=</span> c.getDeclaredMethod(getName(<span class="string">&quot;methodName&quot;</span>));</span><br><span class="line">    <span class="comment">// ç»•è¿‡å®‰å…¨æ£€æŸ¥</span></span><br><span class="line">    method.setAccessible(<span class="literal">true</span>);</span><br><span class="line">    <span class="comment">// åˆ›å»ºå®ä¾‹å¯¹è±¡</span></span><br><span class="line">    <span class="type">TestInvoke</span> <span class="variable">testInvoke</span> <span class="operator">=</span> (TestInvoke)c.newInstance();</span><br><span class="line">    <span class="comment">// è°ƒç”¨æ–¹æ³•</span></span><br><span class="line">    method.invoke(testInvoke);</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><strong>åˆ¤æ–­å¯¹è±¡æ‰€å±ç±»</strong>ï¼š<code>obj.getClass()</code> è·å–å¯¹è±¡çš„ Class å¯¹è±¡ã€‚</li><li><strong>åŠ è½½ç±»</strong>ï¼š<code>Class.forName(&quot;å…¨ç±»å&quot;)</code> åŠ¨æ€åŠ è½½ç±»ã€‚</li><li><strong>è·å–æ„é€ å™¨å¹¶å®ä¾‹åŒ–å¯¹è±¡</strong>ï¼š<code>clazz.getConstructor(...)</code> + <code>constructor.newInstance(...)</code></li><li><strong>è®¿é—®ç±»çš„æˆå‘˜å˜é‡å’Œæ–¹æ³•</strong>ï¼š<code>clazz.getDeclaredFields()</code>, <code>clazz.getDeclaredMethods()</code></li><li><strong>è°ƒç”¨å¯¹è±¡æ–¹æ³•</strong>ï¼š<code>method.invoke(obj, args...)</code></li><li><strong>è®¿é—®ç§æœ‰æˆå‘˜</strong>ï¼šé€šè¿‡ <code>setAccessible(true)</code> å–æ¶ˆè®¿é—®æ£€æŸ¥ã€‚</li></ul><p>åå°„æœºåˆ¶<strong>å®é™…ä¸Šä¼šé™ä½ç¨‹åºçš„æ€§èƒ½</strong>,å› ä¸ºå®ƒéœ€è¦åœ¨è¿è¡Œæ—¶è¿›è¡Œç±»å‹æ£€æŸ¥å’Œè§£æã€‚åŒæ—¶,åå°„ä¹Ÿå¯èƒ½ç ´åå°è£…æ€§,å¸¦æ¥å®‰å…¨é£é™©,å› ä¸ºå®ƒå¯ä»¥è®¿é—®ç§æœ‰æˆå‘˜</p><div class="table-container"><table><thead><tr><th>ä¼˜ç‚¹</th><th>ç¼ºç‚¹</th></tr></thead><tbody><tr><td><strong>æé«˜ç¨‹åºçµæ´»æ€§å’Œæ‰©å±•æ€§</strong>ï¼Œæ”¯æŒåŠ¨æ€åŠ è½½ç±»å’Œè°ƒç”¨</td><td><strong>æ€§èƒ½è¾ƒæ…¢</strong>ï¼Œéœ€è¦ç»•è¿‡ JVM ä¼˜åŒ–ï¼Œå­˜åœ¨é¢å¤–å¼€é”€</td></tr><tr><td>æ”¯æŒæ¡†æ¶ã€å·¥å…·å®ç°é€šç”¨é€»è¾‘å’ŒåŠ¨æ€æ“ä½œ</td><td><strong>ç ´åå°è£…æ€§</strong>ï¼Œå¯è®¿é—®ç§æœ‰æˆå‘˜ï¼Œå¯èƒ½å¯¼è‡´å®‰å…¨é£é™©</td></tr><tr><td>æ”¯æŒåŠ¨æ€ä»£ç†ã€æ³¨è§£è§£æç­‰é«˜çº§åŠŸèƒ½</td><td><strong>ç¼–è¯‘æ—¶ç¼ºä¹ç±»å‹æ£€æŸ¥</strong>ï¼Œé”™è¯¯åªèƒ½è¿è¡Œæ—¶å‘ç°</td></tr></tbody></table></div><h1 id="æ·±æ‹·è´å’Œæµ…æ‹·è´"><a href="#æ·±æ‹·è´å’Œæµ…æ‹·è´" class="headerlink" title="æ·±æ‹·è´å’Œæµ…æ‹·è´"></a>æ·±æ‹·è´å’Œæµ…æ‹·è´</h1><h2 id="1-æ·±æ‹·è´å’Œæµ…æ‹·è´çš„åŒºåˆ«"><a href="#1-æ·±æ‹·è´å’Œæµ…æ‹·è´çš„åŒºåˆ«" class="headerlink" title="1.æ·±æ‹·è´å’Œæµ…æ‹·è´çš„åŒºåˆ«"></a>1.æ·±æ‹·è´å’Œæµ…æ‹·è´çš„åŒºåˆ«</h2><ul><li>æµ…æ‹·è´æ˜¯æŒ‡<strong>åªå¤åˆ¶å¯¹è±¡æœ¬èº«å’Œå…¶å†…éƒ¨çš„å€¼ç±»å‹å­—æ®µ</strong>ï¼Œä½†ä¸ä¼šå¤åˆ¶å¯¹è±¡å†…éƒ¨çš„å¼•ç”¨ç±»å‹å­—æ®µã€‚æ¢å¥è¯è¯´ï¼Œ<strong>æµ…æ‹·è´åªæ˜¯åˆ›å»ºä¸€ä¸ªæ–°çš„å¯¹è±¡ï¼Œç„¶åå°†åŸå¯¹è±¡çš„å­—æ®µå€¼å¤åˆ¶åˆ°æ–°å¯¹è±¡ä¸­</strong>ï¼Œä½†å¦‚æœåŸå¯¹è±¡å†…éƒ¨æœ‰å¼•ç”¨ç±»å‹çš„å­—æ®µï¼Œ<strong>åªæ˜¯å°†å¼•ç”¨å¤åˆ¶åˆ°æ–°å¯¹è±¡ä¸­</strong>ï¼Œ<strong>ä¸¤ä¸ªå¯¹è±¡æŒ‡å‘çš„æ˜¯åŒä¸€ä¸ªå¼•ç”¨å¯¹è±¡ã€‚</strong></li><li>æ·±æ‹·è´æ˜¯æŒ‡åœ¨å¤åˆ¶å¯¹è±¡çš„åŒæ—¶ï¼Œå°†å¯¹è±¡å†…éƒ¨çš„æ‰€æœ‰å¼•ç”¨ç±»å‹å­—æ®µçš„å†…å®¹ä¹Ÿå¤åˆ¶ä¸€ä»½ï¼Œè€Œä¸æ˜¯å…±äº«å¼•ç”¨ã€‚æ¢å¥è¯è¯´ï¼Œæ·±æ‹·è´ä¼šé€’å½’å¤åˆ¶å¯¹è±¡å†…éƒ¨æ‰€æœ‰å¼•ç”¨ç±»å‹çš„å­—æ®µï¼Œ<strong>ç”Ÿæˆä¸€ä¸ªå…¨æ–°çš„å¯¹è±¡ä»¥åŠå…¶å†…éƒ¨çš„æ‰€æœ‰å¯¹è±¡ã€‚</strong></li></ul><div class="table-container"><table><thead><tr><th>å¯¹æ¯”é¡¹</th><th>æµ…æ‹·è´ï¼ˆShallow Copyï¼‰</th><th>æ·±æ‹·è´ï¼ˆDeep Copyï¼‰</th></tr></thead><tbody><tr><td>æ‹·è´çº§åˆ«</td><td>æ‹·è´å¯¹è±¡æœ¬èº«+<strong>å¼•ç”¨åœ°å€</strong></td><td>æ‹·è´å¯¹è±¡æœ¬èº«+<strong>å¼•ç”¨å¯¹è±¡çš„å†…å®¹</strong></td></tr><tr><td>å¼•ç”¨å¯¹è±¡</td><td>åŸå¯¹è±¡ä¸å‰¯æœ¬<strong>å…±äº«å¼•ç”¨å¯¹è±¡</strong></td><td>å‰¯æœ¬æ‹¥æœ‰ç‹¬ç«‹çš„å¼•ç”¨å¯¹è±¡</td></tr><tr><td>é»˜è®¤å®ç°</td><td>Object.clone() é»˜è®¤æ˜¯æµ…æ‹·è´</td><td>éœ€æ‰‹åŠ¨å®ç°é€’å½’å¤åˆ¶</td></tr><tr><td>å½±å“</td><td>æ”¹å˜å‰¯æœ¬çš„å¼•ç”¨æˆå‘˜ï¼Œä¼šå½±å“åŸå¯¹è±¡</td><td>æ”¹å˜å‰¯æœ¬ä¸å½±å“åŸå¯¹è±¡</td></tr><tr><td>åº”ç”¨åœºæ™¯</td><td>è½»é‡å¯¹è±¡å¤åˆ¶ï¼Œæ€§èƒ½ä¼˜å…ˆ</td><td>è¦æ±‚å¯¹è±¡å®Œå…¨ç‹¬ç«‹ã€äº’ä¸å¹²æ‰°</td></tr></tbody></table></div><h2 id="2-å®ç°æ·±æ‹·è´çš„æ–¹å¼"><a href="#2-å®ç°æ·±æ‹·è´çš„æ–¹å¼" class="headerlink" title="2.å®ç°æ·±æ‹·è´çš„æ–¹å¼"></a>2.å®ç°æ·±æ‹·è´çš„æ–¹å¼</h2><blockquote><p>å®ç° Cloneable æ¥å£å¹¶é‡å†™ clone() æ–¹æ³•</p></blockquote><p>è¿™ç§æ–¹æ³•è¦æ±‚å¯¹è±¡åŠå…¶æ‰€æœ‰å¼•ç”¨ç±»å‹å­—æ®µéƒ½å®ç° Cloneable æ¥å£ï¼Œå¹¶ä¸”é‡å†™ clone() æ–¹æ³•ã€‚åœ¨ clone() æ–¹æ³•ä¸­ï¼Œé€šè¿‡é€’å½’å…‹éš†å¼•ç”¨ç±»å‹å­—æ®µæ¥å®ç°æ·±æ‹·è´ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyClass</span> <span class="keyword">implements</span> <span class="title class_">Cloneable</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String field1;</span><br><span class="line">    <span class="keyword">private</span> NestedClass nestedObject;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> Object <span class="title function_">clone</span><span class="params">()</span> <span class="keyword">throws</span> CloneNotSupportedException &#123;</span><br><span class="line">        <span class="type">MyClass</span> <span class="variable">cloned</span> <span class="operator">=</span> (MyClass) <span class="built_in">super</span>.clone();</span><br><span class="line">        cloned.nestedObject = (NestedClass) nestedObject.clone(); <span class="comment">// æ·±æ‹·è´å†…éƒ¨çš„å¼•ç”¨å¯¹è±¡</span></span><br><span class="line">        <span class="keyword">return</span> cloned;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">NestedClass</span> <span class="keyword">implements</span> <span class="title class_">Cloneable</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> nestedField;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">protected</span> Object <span class="title function_">clone</span><span class="params">()</span> <span class="keyword">throws</span> CloneNotSupportedException &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">super</span>.clone();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>ä½¿ç”¨åºåˆ—åŒ–å’Œååºåˆ—åŒ–</p></blockquote><p>é€šè¿‡å°†<strong>å¯¹è±¡åºåˆ—åŒ–ä¸ºå­—èŠ‚æµï¼Œå†ä»å­—èŠ‚æµååºåˆ—åŒ–ä¸ºå¯¹è±¡æ¥å®ç°æ·±æ‹·è´</strong>ã€‚è¦æ±‚å¯¹è±¡åŠå…¶æ‰€æœ‰å¼•ç”¨ç±»å‹å­—æ®µéƒ½å®ç° <strong>Serializable</strong> æ¥å£ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyClass</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String field1;</span><br><span class="line">    <span class="keyword">private</span> NestedClass nestedObject;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> MyClass <span class="title function_">deepCopy</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="type">ByteArrayOutputStream</span> <span class="variable">bos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayOutputStream</span>();</span><br><span class="line">            <span class="type">ObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(bos);</span><br><span class="line">            oos.writeObject(<span class="built_in">this</span>);</span><br><span class="line">            oos.flush();</span><br><span class="line">            oos.close();</span><br><span class="line"></span><br><span class="line">            <span class="type">ByteArrayInputStream</span> <span class="variable">bis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ByteArrayInputStream</span>(bos.toByteArray());</span><br><span class="line">            <span class="type">ObjectInputStream</span> <span class="variable">ois</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(bis);</span><br><span class="line">            <span class="keyword">return</span> (MyClass) ois.readObject();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException | ClassNotFoundException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">NestedClass</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> nestedField;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>æ‰‹åŠ¨é€’å½’å¤åˆ¶</p></blockquote><p>é’ˆå¯¹ç‰¹å®šå¯¹è±¡ç»“æ„ï¼Œ<strong>æ‰‹åŠ¨é€’å½’å¤åˆ¶å¯¹è±¡åŠå…¶å¼•ç”¨ç±»å‹å­—æ®µ</strong>ã€‚é€‚ç”¨äºå¯¹è±¡ç»“æ„å¤æ‚åº¦ä¸é«˜çš„æƒ…å†µã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyClass</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String field1;</span><br><span class="line">    <span class="keyword">private</span> NestedClass nestedObject;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> MyClass <span class="title function_">deepCopy</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">MyClass</span> <span class="variable">copy</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyClass</span>();</span><br><span class="line">        copy.setField1(<span class="built_in">this</span>.field1);</span><br><span class="line">        copy.setNestedObject(<span class="built_in">this</span>.nestedObject.deepCopy());</span><br><span class="line">        <span class="keyword">return</span> copy;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">NestedClass</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> nestedField;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> NestedClass <span class="title function_">deepCopy</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="type">NestedClass</span> <span class="variable">copy</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">NestedClass</span>();</span><br><span class="line">        copy.setNestedField(<span class="built_in">this</span>.nestedField);</span><br><span class="line">        <span class="keyword">return</span> copy;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="å¯¹è±¡"><a href="#å¯¹è±¡" class="headerlink" title="å¯¹è±¡"></a>å¯¹è±¡</h1><h2 id="1-åˆ›å»ºå¯¹è±¡çš„äº”ç§æ–¹å¼"><a href="#1-åˆ›å»ºå¯¹è±¡çš„äº”ç§æ–¹å¼" class="headerlink" title="1.åˆ›å»ºå¯¹è±¡çš„äº”ç§æ–¹å¼"></a>1.åˆ›å»ºå¯¹è±¡çš„äº”ç§æ–¹å¼</h2><p><strong>ä½¿ç”¨newå…³é”®å­—</strong>ï¼šé€šè¿‡newå…³é”®å­—ç›´æ¥è°ƒç”¨ç±»çš„æ„é€ æ–¹æ³•æ¥åˆ›å»ºå¯¹è±¡ã€‚</p><p><strong>ä½¿ç”¨Classç±»çš„newInstance()æ–¹æ³•</strong>ï¼šé€šè¿‡åå°„æœºåˆ¶ï¼Œå¯ä»¥ä½¿ç”¨Classç±»çš„newInstance()æ–¹æ³•åˆ›å»ºå¯¹è±¡ã€‚</p><p><strong>ä½¿ç”¨Constructorç±»çš„newInstance()æ–¹æ³•</strong>ï¼šåŒæ ·æ˜¯é€šè¿‡åå°„æœºåˆ¶ï¼Œå¯ä»¥ä½¿ç”¨Constructorç±»çš„newInstance()æ–¹æ³•åˆ›å»ºå¯¹è±¡ã€‚ä¸€èˆ¬è·Ÿåå°„ä¸€å—ç”¨å§ï¼Œè·å–ç±»çš„æ„é€ å™¨ä¹‹åæ–°å»ºå¯¹è±¡</p><p><strong>ä½¿ç”¨clone()æ–¹æ³•</strong>ï¼šå¦‚æœç±»å®ç°äº†<strong>Cloneable</strong>æ¥å£ï¼Œå¯ä»¥ä½¿ç”¨clone()æ–¹æ³•å¤åˆ¶å¯¹è±¡ã€‚</p><p>è¿™å°±æ˜¯<strong>æ‹·è´</strong></p><p><strong>ä½¿ç”¨ååºåˆ—åŒ–</strong>ï¼šé€šè¿‡å°†å¯¹è±¡åºåˆ—åŒ–åˆ°æ–‡ä»¶æˆ–æµä¸­ï¼Œç„¶åå†è¿›è¡Œååºåˆ—åŒ–æ¥åˆ›å»ºå¯¹è±¡ã€‚</p><h2 id="2-newå‡ºçš„å¯¹è±¡ä»€ä¹ˆæ—¶å€™å›æ”¶"><a href="#2-newå‡ºçš„å¯¹è±¡ä»€ä¹ˆæ—¶å€™å›æ”¶" class="headerlink" title="2.newå‡ºçš„å¯¹è±¡ä»€ä¹ˆæ—¶å€™å›æ”¶"></a>2.newå‡ºçš„å¯¹è±¡ä»€ä¹ˆæ—¶å€™å›æ”¶</h2><p>é€šè¿‡è¿‡å…³é”®å­—<code>new</code>åˆ›å»ºçš„å¯¹è±¡ï¼Œç”±<strong>Javaçš„åƒåœ¾å›æ”¶å™¨</strong>ï¼ˆGarbage Collectorï¼‰è´Ÿè´£å›æ”¶ã€‚åƒåœ¾å›æ”¶å™¨çš„å·¥ä½œæ˜¯åœ¨ç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­è‡ªåŠ¨è¿›è¡Œçš„ï¼Œå®ƒä¼šå‘¨æœŸæ€§åœ°æ£€æµ‹ä¸å†è¢«å¼•ç”¨çš„å¯¹è±¡ï¼Œå¹¶å°†å…¶å›æ”¶é‡Šæ”¾å†…å­˜ã€‚</p><p>å…·ä½“æ¥è¯´ï¼ŒJavaå¯¹è±¡çš„å›æ”¶æ—¶æœºæ˜¯ç”±åƒåœ¾å›æ”¶å™¨æ ¹æ®ä¸€äº›ç®—æ³•æ¥å†³å®šçš„ï¼Œä¸»è¦æœ‰ä»¥ä¸‹å‡ ç§æƒ…å†µï¼š</p><ol><li>å¼•ç”¨è®¡æ•°æ³•ï¼šæŸä¸ªå¯¹è±¡çš„å¼•ç”¨è®¡æ•°ä¸º0æ—¶ï¼Œè¡¨ç¤ºè¯¥å¯¹è±¡ä¸å†è¢«å¼•ç”¨ï¼Œå¯ä»¥è¢«å›æ”¶ã€‚</li><li><strong>å¯è¾¾æ€§åˆ†æç®—æ³•</strong>ï¼š<strong>ä»æ ¹å¯¹è±¡ï¼ˆå¦‚æ–¹æ³•åŒºä¸­çš„ç±»é™æ€å±æ€§ã€æ–¹æ³•ä¸­çš„å±€éƒ¨å˜é‡ç­‰ï¼‰å‡ºå‘ï¼Œé€šè¿‡å¯¹è±¡ä¹‹é—´çš„å¼•ç”¨é“¾è¿›è¡Œéå†ï¼Œ</strong>å¦‚æœå­˜åœ¨ä¸€æ¡å¼•ç”¨é“¾åˆ°è¾¾æŸä¸ªå¯¹è±¡ï¼Œåˆ™è¯´æ˜è¯¥å¯¹è±¡æ˜¯å¯è¾¾çš„ï¼Œåä¹‹ä¸å¯è¾¾ï¼Œä¸å¯è¾¾çš„å¯¹è±¡å°†è¢«å›æ”¶ã€‚</li><li><strong>ç»ˆç»“å™¨</strong>ï¼ˆFinalizerï¼‰ï¼šå¦‚æœå¯¹è±¡é‡å†™äº†<code>finalize()</code>æ–¹æ³•ï¼Œåƒåœ¾å›æ”¶å™¨ä¼šåœ¨å›æ”¶è¯¥å¯¹è±¡ä¹‹å‰è°ƒç”¨<code>finalize()</code>æ–¹æ³•ï¼Œå¯¹è±¡å¯ä»¥åœ¨<code>finalize()</code>æ–¹æ³•ä¸­è¿›è¡Œä¸€äº›æ¸…ç†æ“ä½œã€‚ç„¶è€Œï¼Œç»ˆç»“å™¨æœºåˆ¶çš„ä½¿ç”¨ä¸è¢«æ¨èï¼Œå› ä¸ºå®ƒçš„æ‰§è¡Œæ—¶é—´æ˜¯ä¸ç¡®å®šçš„ï¼Œå¯èƒ½ä¼šå¯¼è‡´ä¸å¯é¢„æµ‹çš„æ€§èƒ½é—®é¢˜ã€‚è¿™ä¸ªç±»ä¼¼äºtry-catch-finallyä¸­çš„finally</li></ol><h2 id="3-å¦‚ä½•è·å–ç§æœ‰å¯¹è±¡ï¼Ÿ"><a href="#3-å¦‚ä½•è·å–ç§æœ‰å¯¹è±¡ï¼Ÿ" class="headerlink" title="3.å¦‚ä½•è·å–ç§æœ‰å¯¹è±¡ï¼Ÿ"></a>3.å¦‚ä½•è·å–ç§æœ‰å¯¹è±¡ï¼Ÿ</h2><p>åœ¨ Java ä¸­ï¼Œç§æœ‰å¯¹è±¡é€šå¸¸æŒ‡çš„æ˜¯ç±»ä¸­è¢«å£°æ˜ä¸º <code>private</code> çš„æˆå‘˜å˜é‡æˆ–æ–¹æ³•ã€‚ç”±äº <code>private</code> è®¿é—®ä¿®é¥°ç¬¦çš„é™åˆ¶ï¼Œè¿™äº›æˆå‘˜åªèƒ½åœ¨å…¶æ‰€åœ¨çš„ç±»å†…éƒ¨è¢«è®¿é—®ã€‚</p><p>ä¸è¿‡ï¼Œå¯ä»¥é€šè¿‡ä¸‹é¢ä¸¤ç§æ–¹å¼æ¥é—´æ¥è·å–ç§æœ‰å¯¹è±¡ã€‚</p><ul><li><strong>ä½¿ç”¨å…¬å…±è®¿é—®å™¨æ–¹æ³•ï¼ˆgetter æ–¹æ³•ï¼‰</strong>ï¼šå¦‚æœç±»çš„è®¾è®¡è€…éµå¾ªè‰¯å¥½çš„ç¼–ç¨‹è§„èŒƒï¼Œé€šå¸¸ä¼šä¸ºç§æœ‰æˆå‘˜å˜é‡æä¾›å…¬å…±çš„è®¿é—®å™¨æ–¹æ³•ï¼ˆå³ <code>getter</code> æ–¹æ³•ï¼‰ï¼Œé€šè¿‡è°ƒç”¨è¿™äº›æ–¹æ³•å¯ä»¥å®‰å…¨åœ°è·å–ç§æœ‰å¯¹è±¡ã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">MyClass</span> &#123;</span><br><span class="line">    <span class="comment">// ç§æœ‰æˆå‘˜å˜é‡</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">String</span> <span class="variable">privateField</span> <span class="operator">=</span> <span class="string">&quot;ç§æœ‰å­—æ®µçš„å€¼&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å…¬å…±çš„ getter æ–¹æ³•</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getPrivateField</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> privateField;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">MyClass</span> <span class="variable">obj</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyClass</span>();</span><br><span class="line">        <span class="comment">// é€šè¿‡è°ƒç”¨ getter æ–¹æ³•è·å–ç§æœ‰å¯¹è±¡</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">value</span> <span class="operator">=</span> obj.getPrivateField();</span><br><span class="line">        System.out.println(value); </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>åå°„æœºåˆ¶ã€‚åå°„æœºåˆ¶å…è®¸åœ¨è¿è¡Œæ—¶æ£€æŸ¥å’Œä¿®æ”¹ç±»ã€æ–¹æ³•ã€å­—æ®µç­‰ä¿¡æ¯ï¼Œé€š<strong>è¿‡åå°„å¯ä»¥ç»•è¿‡ <code>private</code> è®¿é—®ä¿®é¥°ç¬¦çš„é™åˆ¶æ¥è·å–ç§æœ‰å¯¹è±¡ã€‚</strong>ä½†æ˜¯å´ä¼šç ´åå°è£…æ€§ï¼Œå®‰å…¨ä¸ä¼šå¾—åˆ°ä¿éšœ</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.lang.reflect.Field;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyClass</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">String</span> <span class="variable">privateField</span> <span class="operator">=</span> <span class="string">&quot;ç§æœ‰å­—æ®µçš„å€¼&quot;</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> NoSuchFieldException, IllegalAccessException &#123;</span><br><span class="line">        <span class="type">MyClass</span> <span class="variable">obj</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyClass</span>();</span><br><span class="line">        <span class="comment">// è·å– Class å¯¹è±¡</span></span><br><span class="line">        Class&lt;?&gt; clazz = obj.getClass();</span><br><span class="line">        <span class="comment">// è·å–ç§æœ‰å­—æ®µ</span></span><br><span class="line">        <span class="type">Field</span> <span class="variable">privateField</span> <span class="operator">=</span> clazz.getDeclaredField(<span class="string">&quot;privateField&quot;</span>);</span><br><span class="line">        <span class="comment">// è®¾ç½®å¯è®¿é—®æ€§</span></span><br><span class="line">        privateField.setAccessible(<span class="literal">true</span>);</span><br><span class="line">        <span class="comment">// è·å–ç§æœ‰å­—æ®µçš„å€¼</span></span><br><span class="line">        <span class="type">String</span> <span class="variable">value</span> <span class="operator">=</span> (String) privateField.get(obj);</span><br><span class="line">        System.out.println(value); </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="æ³¨è§£"><a href="#æ³¨è§£" class="headerlink" title="æ³¨è§£"></a>æ³¨è§£</h1><h2 id="1-èƒ½è®²ä¸€è®²Javaæ³¨è§£çš„åŸç†å—ï¼Ÿ"><a href="#1-èƒ½è®²ä¸€è®²Javaæ³¨è§£çš„åŸç†å—ï¼Ÿ" class="headerlink" title="1.èƒ½è®²ä¸€è®²Javaæ³¨è§£çš„åŸç†å—ï¼Ÿ"></a>1.èƒ½è®²ä¸€è®²Javaæ³¨è§£çš„åŸç†å—ï¼Ÿ</h2><p>æ³¨è§£æœ¬è´¨æ˜¯ä¸€ä¸ª<strong>ç»§æ‰¿äº†Annotationçš„ç‰¹æ®Šæ¥å£</strong>ï¼Œå…¶å…·ä½“å®ç°ç±»<strong>æ˜¯Javaè¿è¡Œæ—¶ç”Ÿæˆçš„åŠ¨æ€ä»£ç†ç±»ã€‚</strong></p><p>æˆ‘ä»¬é€šè¿‡åå°„è·å–æ³¨è§£æ—¶ï¼Œè¿”å›çš„æ˜¯Javaè¿è¡Œæ—¶ç”Ÿæˆçš„åŠ¨æ€ä»£ç†å¯¹è±¡ã€‚é€šè¿‡ä»£ç†å¯¹è±¡è°ƒç”¨è‡ªå®šä¹‰æ³¨è§£çš„æ–¹æ³•ï¼Œä¼šæœ€ç»ˆè°ƒç”¨AnnotationInvocationHandlerçš„<strong>invokeæ–¹æ³•ã€‚è¯¥æ–¹æ³•ä¼šä»memberValuesè¿™ä¸ªMapä¸­ç´¢å¼•å‡ºå¯¹åº”çš„å€¼ã€‚è€ŒmemberValuesçš„æ¥æºæ˜¯Javaå¸¸é‡æ± ã€‚</strong></p><h2 id="2-å¯¹æ³¨è§£è§£æçš„åº•å±‚å®ç°äº†è§£å—ï¼Ÿ"><a href="#2-å¯¹æ³¨è§£è§£æçš„åº•å±‚å®ç°äº†è§£å—ï¼Ÿ" class="headerlink" title="2.å¯¹æ³¨è§£è§£æçš„åº•å±‚å®ç°äº†è§£å—ï¼Ÿ"></a>2.å¯¹æ³¨è§£è§£æçš„åº•å±‚å®ç°äº†è§£å—ï¼Ÿ</h2><p>æ³¨è§£æœ¬è´¨ä¸Šæ˜¯ä¸€ç§<strong>ç‰¹æ®Šçš„æ¥å£</strong>ï¼Œå®ƒç»§æ‰¿è‡ª <code>java.lang.annotation.Annotation</code> æ¥å£ï¼Œ<strong>æ‰€ä»¥æ³¨è§£ä¹Ÿå«å£°æ˜å¼æ¥å£</strong>ï¼Œä¾‹å¦‚ï¼Œå®šä¹‰ä¸€ä¸ªç®€å•çš„æ³¨è§£ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> MyAnnotation &#123;</span><br><span class="line">    String <span class="title function_">value</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç¼–è¯‘åï¼ŒJava ç¼–è¯‘å™¨ä¼šå°†å…¶è½¬æ¢ä¸ºä¸€ä¸ªç»§æ‰¿è‡ª <code>Annotation</code> çš„æ¥å£ï¼Œå¹¶ç”Ÿæˆç›¸åº”çš„å­—èŠ‚ç æ–‡ä»¶ã€‚</p><p>æ ¹æ®æ³¨è§£çš„ä½œç”¨èŒƒå›´ï¼ŒJava æ³¨è§£å¯ä»¥åˆ†ä¸ºä»¥ä¸‹å‡ ç§ç±»å‹ï¼š</p><ul><li><strong>æºç çº§åˆ«æ³¨è§£</strong> ï¼š<strong>ä»…å­˜åœ¨äºæºç ä¸­</strong>ï¼Œç¼–è¯‘åä¸ä¼šä¿ç•™ï¼ˆ<code>@Retention(RetentionPolicy.SOURCE)</code>ï¼‰ã€‚</li><li><strong>ç±»æ–‡ä»¶çº§åˆ«æ³¨è§£</strong> ï¼š<strong>ä¿ç•™åœ¨ <code>.class</code> æ–‡ä»¶ä¸­ï¼Œä½†è¿è¡Œæ—¶ä¸å¯è§</strong>ï¼ˆ<code>@Retention(RetentionPolicy.CLASS)</code>ï¼‰ã€‚</li><li><strong>è¿è¡Œæ—¶æ³¨è§£</strong> ï¼šä¿ç•™åœ¨ <code>.class</code> æ–‡ä»¶ä¸­ï¼Œ<strong>å¹¶ä¸”å¯ä»¥é€šè¿‡åå°„åœ¨è¿è¡Œæ—¶è®¿é—®</strong>ï¼ˆ<code>@Retention(RetentionPolicy.RUNTIME)</code>ï¼‰ã€‚</li></ul><p>åªæœ‰è¿è¡Œæ—¶æ³¨è§£å¯ä»¥é€šè¿‡åå°„æœºåˆ¶è¿›è¡Œè§£æã€‚</p><p>å½“æ³¨è§£è¢«æ ‡è®°ä¸º <code>RUNTIME</code> æ—¶ï¼ŒJava ç¼–è¯‘å™¨ä¼šåœ¨ç”Ÿæˆçš„ <code>.class</code> æ–‡ä»¶ä¸­ä¿å­˜æ³¨è§£ä¿¡æ¯ã€‚è¿™äº›ä¿¡æ¯å­˜å‚¨åœ¨å­—èŠ‚ç çš„å±æ€§è¡¨ï¼ˆAttribute Tableï¼‰ä¸­ï¼Œå…·ä½“åŒ…æ‹¬ä»¥ä¸‹å†…å®¹ï¼š</p><ul><li><strong>RuntimeVisibleAnnotations</strong> ï¼šå­˜å‚¨è¿è¡Œæ—¶å¯è§çš„æ³¨è§£ä¿¡æ¯ã€‚</li><li><strong>RuntimeInvisibleAnnotations</strong> ï¼šå­˜å‚¨è¿è¡Œæ—¶ä¸å¯è§çš„æ³¨è§£ä¿¡æ¯ã€‚</li><li><strong>RuntimeVisibleParameterAnnotations</strong> å’Œ <strong>RuntimeInvisibleParameterAnnotations</strong> ï¼šå­˜å‚¨æ–¹æ³•å‚æ•°ä¸Šçš„æ³¨è§£ä¿¡æ¯ã€‚</li></ul><p>é€šè¿‡å·¥å…·ï¼ˆå¦‚ <code>javap -v</code>ï¼‰å¯ä»¥æŸ¥çœ‹ <code>.class</code> æ–‡ä»¶ä¸­çš„æ³¨è§£ä¿¡æ¯ã€‚</p><p>æ³¨è§£çš„è§£æä¸»è¦ä¾èµ–äº Java çš„åå°„æœºåˆ¶ã€‚ä»¥ä¸‹æ˜¯è§£ææ³¨è§£çš„åŸºæœ¬æµç¨‹ï¼š</p><p>1ã€è·å–æ³¨å†Œä¿¡æ¯ï¼šé€šè¿‡åå°„ API å¯ä»¥è·å–ç±»ã€æ–¹æ³•ã€å­—æ®µç­‰å…ƒç´ ä¸Šçš„æ³¨è§£ã€‚ä¾‹å¦‚ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Class&lt;?&gt; clazz = MyClass.class;</span><br><span class="line"><span class="type">MyAnnotation</span> <span class="variable">annotation</span> <span class="operator">=</span> clazz.getAnnotation(MyAnnotation.class);</span><br><span class="line"><span class="keyword">if</span> (annotation != <span class="literal">null</span>) &#123;</span><br><span class="line">    System.out.println(annotation.value());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>2ã€åº•å±‚åŸç†ï¼šåå°„æœºåˆ¶çš„æ ¸å¿ƒç±»æ˜¯ <code>java.lang.reflect.AnnotatedElement</code>ï¼Œå®ƒæ˜¯æ‰€æœ‰å¯ä»¥è¢«æ³¨è§£ä¿®é¥°çš„å…ƒç´ ï¼ˆå¦‚ <code>Class</code>ã€<code>Method</code>ã€<code>Field</code> ç­‰ï¼‰çš„çˆ¶æ¥å£ã€‚è¯¥æ¥å£æä¾›äº†ä»¥ä¸‹æ–¹æ³•ï¼š</p><ul><li><code>getAnnotation(Class&lt;T&gt; annotationClass)</code>ï¼šè·å–æŒ‡å®šç±»å‹çš„æ³¨è§£ã€‚</li><li><code>getAnnotations()</code>ï¼šè·å–æ‰€æœ‰æ³¨è§£ã€‚</li><li><code>isAnnotationPresent(Class&lt;? extends Annotation&gt; annotationClass)</code>ï¼šåˆ¤æ–­æ˜¯å¦åŒ…å«æŒ‡å®šæ³¨è§£ã€‚</li></ul><p>è¿™äº›æ–¹æ³•çš„åº•å±‚å®ç°ä¾èµ–äº JVM æä¾›çš„æœ¬åœ°æ–¹æ³•ï¼ˆNative Methodï¼‰ï¼Œä¾‹å¦‚ï¼š</p><ul><li><code>native Annotation[] getDeclaredAnnotations0(boolean publicOnly);</code></li><li><code>native &lt;A extends Annotation&gt; A getAnnotation(Class&lt;A&gt; annotationClass);</code></li></ul><p>JVM åœ¨åŠ è½½ç±»æ—¶ä¼šè§£æ <strong><code>.class</code> æ–‡ä»¶ä¸­çš„æ³¨è§£ä¿¡æ¯ï¼Œå¹¶å°†å…¶å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œä¾›åå°„æœºåˆ¶ä½¿ç”¨ã€‚</strong></p><p>å› æ­¤ï¼Œæ³¨è§£è§£æçš„åº•å±‚å®ç°ä¸»è¦<strong>ä¾èµ–äº Java çš„åå°„æœºåˆ¶å’Œå­—èŠ‚ç æ–‡ä»¶çš„å­˜å‚¨</strong>ã€‚é€šè¿‡ <code>@Retention</code> å…ƒæ³¨è§£å¯ä»¥æ§åˆ¶æ³¨è§£çš„ä¿ç•™ç­–ç•¥ï¼Œå½“ä½¿ç”¨ <code>RetentionPolicy.RUNTIME</code> æ—¶ï¼Œå¯ä»¥åœ¨è¿è¡Œæ—¶é€šè¿‡<strong>åå°„ API æ¥è§£ææ³¨è§£ä¿¡æ¯ã€‚åœ¨ JVM å±‚é¢ï¼Œä¼šä»å­—èŠ‚ç æ–‡ä»¶ä¸­è¯»å–æ³¨è§£ä¿¡æ¯ï¼Œå¹¶åˆ›å»ºæ³¨è§£çš„ä»£ç†å¯¹è±¡æ¥è·å–æ³¨è§£çš„å±æ€§å€¼ã€‚</strong></p><h2 id="3-Javaæ³¨è§£çš„ä½œç”¨åŸŸå‘¢ï¼Ÿ"><a href="#3-Javaæ³¨è§£çš„ä½œç”¨åŸŸå‘¢ï¼Ÿ" class="headerlink" title="3.Javaæ³¨è§£çš„ä½œç”¨åŸŸå‘¢ï¼Ÿ"></a>3.Javaæ³¨è§£çš„ä½œç”¨åŸŸå‘¢ï¼Ÿ</h2><p>æ³¨è§£çš„ä½œç”¨åŸŸï¼ˆScopeï¼‰æŒ‡çš„æ˜¯æ³¨è§£å¯ä»¥åº”ç”¨åœ¨å“ªäº›ç¨‹åºå…ƒç´ ä¸Šï¼Œä¾‹å¦‚ç±»ã€æ–¹æ³•ã€å­—æ®µç­‰ã€‚Javaæ³¨è§£çš„ä½œç”¨åŸŸå¯ä»¥åˆ†ä¸ºä¸‰ç§ï¼š</p><ol><li><strong>ç±»çº§åˆ«ä½œç”¨åŸŸ</strong>ï¼šç”¨äºæè¿°ç±»çš„æ³¨è§£ï¼Œé€šå¸¸æ”¾ç½®åœ¨ç±»å®šä¹‰çš„ä¸Šé¢ï¼Œå¯ä»¥ç”¨æ¥æŒ‡å®šç±»çš„ä¸€äº›å±æ€§ï¼Œ<strong>å¦‚ç±»çš„è®¿é—®çº§åˆ«ã€ç»§æ‰¿å…³ç³»ã€æ³¨é‡Šç­‰ã€‚</strong></li><li><strong>æ–¹æ³•çº§åˆ«ä½œç”¨åŸŸ</strong>ï¼šç”¨äºæè¿°æ–¹æ³•çš„æ³¨è§£ï¼Œé€šå¸¸æ”¾ç½®åœ¨æ–¹æ³•å®šä¹‰çš„ä¸Šé¢ï¼Œå¯ä»¥ç”¨æ¥æŒ‡å®šæ–¹æ³•çš„ä¸€äº›å±æ€§ï¼Œ<strong>å¦‚æ–¹æ³•çš„è®¿é—®çº§åˆ«ã€è¿”å›å€¼ç±»å‹ã€å¼‚å¸¸ç±»å‹ã€æ³¨é‡Šç­‰ã€‚</strong></li><li><strong>å­—æ®µçº§åˆ«ä½œç”¨åŸŸ</strong>ï¼šç”¨äºæè¿°å­—æ®µçš„æ³¨è§£ï¼Œé€šå¸¸æ”¾ç½®åœ¨å­—æ®µå®šä¹‰çš„ä¸Šé¢ï¼Œå¯ä»¥ç”¨æ¥æŒ‡å®šå­—æ®µçš„ä¸€äº›å±æ€§ï¼Œ<strong>å¦‚å­—æ®µçš„è®¿é—®çº§åˆ«ã€é»˜è®¤å€¼ã€æ³¨é‡Šç­‰ã€‚</strong></li></ol><p>é™¤äº†è¿™ä¸‰ç§ä½œç”¨åŸŸï¼ŒJavaè¿˜æä¾›äº†å…¶ä»–ä¸€äº›æ³¨è§£ä½œç”¨åŸŸï¼Œä¾‹å¦‚<strong>æ„é€ å‡½æ•°ä½œç”¨åŸŸå’Œå±€éƒ¨å˜é‡ä½œç”¨åŸŸ</strong>ã€‚è¿™äº›æ³¨è§£ä½œç”¨åŸŸå¯ä»¥ç”¨æ¥å¯¹æ„é€ å‡½æ•°å’Œå±€éƒ¨å˜é‡è¿›è¡Œæè¿°å’Œæ³¨é‡Šã€‚</p><h1 id="å¼‚å¸¸"><a href="#å¼‚å¸¸" class="headerlink" title="å¼‚å¸¸"></a>å¼‚å¸¸</h1><h2 id="1-ä»‹ç»ä¸€ä¸‹Javaå¼‚å¸¸"><a href="#1-ä»‹ç»ä¸€ä¸‹Javaå¼‚å¸¸" class="headerlink" title="1.ä»‹ç»ä¸€ä¸‹Javaå¼‚å¸¸"></a>1.ä»‹ç»ä¸€ä¸‹Javaå¼‚å¸¸</h2><p><img src="https://cdn.xiaolincoding.com//picgo/1720683900898-1d0ce69d-4b5d-41a6-a5df-022e42f8f4c5.webp" alt=""></p><p>Javaçš„å¼‚å¸¸ä½“ç³»ä¸»è¦åŸºäºä¸¤å¤§ç±»ï¼šThrowableç±»åŠå…¶å­ç±»ã€‚Throwableæœ‰ä¸¤ä¸ªé‡è¦çš„å­ç±»ï¼šErrorå’ŒExceptionï¼Œå®ƒä»¬åˆ†åˆ«ä»£è¡¨äº†ä¸åŒç±»å‹çš„å¼‚å¸¸æƒ…å†µã€‚</p><ol><li><strong>Errorï¼ˆé”™è¯¯ï¼‰</strong>ï¼šè¡¨ç¤ºè¿è¡Œæ—¶ç¯å¢ƒçš„é”™è¯¯ã€‚é”™è¯¯æ˜¯ç¨‹åºæ— æ³•å¤„ç†çš„ä¸¥é‡é—®é¢˜ï¼Œå¦‚ç³»ç»Ÿå´©æºƒã€è™šæ‹Ÿæœºé”™è¯¯ã€åŠ¨æ€é“¾æ¥å¤±è´¥ç­‰ã€‚é€šå¸¸ï¼Œ<strong>ç¨‹åºä¸åº”è¯¥å°è¯•æ•è·è¿™ç±»é”™è¯¯</strong>ã€‚ä¾‹å¦‚ï¼ŒOutOfMemoryErrorã€StackOverflowErrorç­‰ã€‚</li><li><strong>Exceptionï¼ˆå¼‚å¸¸ï¼‰</strong>ï¼šè¡¨ç¤ºç¨‹åºæœ¬èº«å¯ä»¥å¤„ç†çš„å¼‚å¸¸æ¡ä»¶ã€‚å¼‚å¸¸åˆ†ä¸ºä¸¤å¤§ç±»ï¼š<ul><li><strong>éè¿è¡Œæ—¶å¼‚å¸¸</strong>ï¼šè¿™ç±»å¼‚å¸¸<strong>åœ¨ç¼–è¯‘æ—¶æœŸå°±å¿…é¡»è¢«æ•è·æˆ–è€…å£°æ˜æŠ›å‡º</strong>ã€‚å®ƒä»¬é€šå¸¸æ˜¯å¤–éƒ¨é”™è¯¯ï¼Œå¦‚æ–‡ä»¶ä¸å­˜åœ¨ï¼ˆFileNotFoundExceptionï¼‰ã€ç±»æœªæ‰¾åˆ°ï¼ˆClassNotFoundExceptionï¼‰ç­‰ã€‚éè¿è¡Œæ—¶å¼‚å¸¸å¼ºåˆ¶ç¨‹åºå‘˜å¤„ç†è¿™äº›å¯èƒ½å‡ºç°çš„é—®é¢˜ï¼Œå¢å¼ºäº†ç¨‹åºçš„å¥å£®æ€§ã€‚</li><li><strong>è¿è¡Œæ—¶å¼‚å¸¸</strong>ï¼šè¿™ç±»å¼‚å¸¸åŒ…æ‹¬è¿è¡Œæ—¶å¼‚å¸¸ï¼ˆRuntimeExceptionï¼‰å’Œé”™è¯¯ï¼ˆErrorï¼‰ã€‚è¿è¡Œæ—¶å¼‚å¸¸ç”±ç¨‹åºé”™è¯¯å¯¼è‡´ï¼Œå¦‚ç©ºæŒ‡é’ˆè®¿é—®ï¼ˆNullPointerExceptionï¼‰ã€æ•°ç»„è¶Šç•Œï¼ˆArrayIndexOutOfBoundsExceptionï¼‰ç­‰ã€‚<strong>è¿è¡Œæ—¶å¼‚å¸¸æ˜¯ä¸éœ€è¦åœ¨ç¼–è¯‘æ—¶å¼ºåˆ¶æ•è·æˆ–å£°æ˜çš„ã€‚</strong></li></ul></li></ol><h2 id="2-Javaå¼‚å¸¸å¤„ç†æœ‰å“ªäº›ï¼Ÿ"><a href="#2-Javaå¼‚å¸¸å¤„ç†æœ‰å“ªäº›ï¼Ÿ" class="headerlink" title="2.Javaå¼‚å¸¸å¤„ç†æœ‰å“ªäº›ï¼Ÿ"></a>2.Javaå¼‚å¸¸å¤„ç†æœ‰å“ªäº›ï¼Ÿ</h2><p>å¼‚å¸¸å¤„ç†æ˜¯é€šè¿‡ä½¿ç”¨try-catchè¯­å¥å—æ¥æ•è·å’Œå¤„ç†å¼‚å¸¸ã€‚ä»¥ä¸‹æ˜¯Javaä¸­å¸¸ç”¨çš„å¼‚å¸¸å¤„ç†æ–¹å¼ï¼š</p><ul><li><strong>try-catchè¯­å¥å—</strong>ï¼šç”¨äºæ•è·å¹¶å¤„ç†å¯èƒ½æŠ›å‡ºçš„å¼‚å¸¸ã€‚tryå—ä¸­åŒ…å«å¯èƒ½æŠ›å‡ºå¼‚å¸¸çš„ä»£ç ï¼Œcatchå—ç”¨äºæ•è·å¹¶å¤„ç†ç‰¹å®šç±»å‹çš„å¼‚å¸¸ã€‚å¯ä»¥æœ‰å¤šä¸ªcatchå—æ¥å¤„ç†ä¸åŒç±»å‹çš„å¼‚å¸¸ã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">// å¯èƒ½æŠ›å‡ºå¼‚å¸¸çš„ä»£ç </span></span><br><span class="line">&#125; <span class="keyword">catch</span> (ExceptionType1 e1) &#123;</span><br><span class="line">    <span class="comment">// å¤„ç†å¼‚å¸¸ç±»å‹1çš„é€»è¾‘</span></span><br><span class="line">&#125; <span class="keyword">catch</span> (ExceptionType2 e2) &#123;</span><br><span class="line">    <span class="comment">// å¤„ç†å¼‚å¸¸ç±»å‹2çš„é€»è¾‘</span></span><br><span class="line">&#125; <span class="keyword">catch</span> (ExceptionType3 e3) &#123;</span><br><span class="line">    <span class="comment">// å¤„ç†å¼‚å¸¸ç±»å‹3çš„é€»è¾‘</span></span><br><span class="line">&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">    <span class="comment">// å¯é€‰çš„finallyå—ï¼Œç”¨äºå®šä¹‰æ— è®ºæ˜¯å¦å‘ç”Ÿå¼‚å¸¸éƒ½ä¼šæ‰§è¡Œçš„ä»£ç </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><strong>throwè¯­å¥</strong>ï¼šç”¨äºæ‰‹åŠ¨æŠ›å‡ºå¼‚å¸¸ã€‚å¯ä»¥æ ¹æ®éœ€è¦åœ¨ä»£ç ä¸­ä½¿ç”¨throwè¯­å¥ä¸»åŠ¨æŠ›å‡ºç‰¹å®šç±»å‹çš„å¼‚å¸¸ã€‚</li></ul><figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">throw new ExceptionType(&quot;Exception message&quot;);</span><br></pre></td></tr></table></figure><ul><li><strong>throwså…³é”®å­—</strong>ï¼šç”¨äºåœ¨æ–¹æ³•å£°æ˜ä¸­å£°æ˜å¯èƒ½æŠ›å‡ºçš„å¼‚å¸¸ç±»å‹ã€‚å¦‚æœä¸€ä¸ªæ–¹æ³•å¯èƒ½æŠ›å‡ºå¼‚å¸¸ï¼Œä½†ä¸æƒ³åœ¨æ–¹æ³•å†…éƒ¨è¿›è¡Œå¤„ç†ï¼Œå¯ä»¥ä½¿ç”¨throwså…³é”®å­—å°†å¼‚å¸¸ä¼ é€’ç»™è°ƒç”¨è€…æ¥å¤„ç†ã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">methodName</span><span class="params">()</span> <span class="keyword">throws</span> ExceptionType &#123;</span><br><span class="line">    <span class="comment">// æ–¹æ³•ä½“</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><strong>finallyå—</strong>ï¼šç”¨äºå®šä¹‰æ— è®ºæ˜¯å¦å‘ç”Ÿå¼‚å¸¸éƒ½ä¼šæ‰§è¡Œçš„ä»£ç å—ã€‚é€šå¸¸ç”¨äºé‡Šæ”¾èµ„æºï¼Œç¡®ä¿èµ„æºçš„æ­£ç¡®å…³é—­ã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">// å¯èƒ½æŠ›å‡ºå¼‚å¸¸çš„ä»£ç </span></span><br><span class="line">&#125; <span class="keyword">catch</span> (ExceptionType e) &#123;</span><br><span class="line">    <span class="comment">// å¤„ç†å¼‚å¸¸çš„é€»è¾‘</span></span><br><span class="line">&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">    <span class="comment">// æ— è®ºæ˜¯å¦å‘ç”Ÿå¼‚å¸¸ï¼Œéƒ½ä¼šæ‰§è¡Œçš„ä»£ç </span></span><br></pre></td></tr></table></figure><h2 id="3-æŠ›å‡ºå¼‚å¸¸ä¸ºä»€ä¹ˆä¸ç”¨throwsï¼Ÿ"><a href="#3-æŠ›å‡ºå¼‚å¸¸ä¸ºä»€ä¹ˆä¸ç”¨throwsï¼Ÿ" class="headerlink" title="3.æŠ›å‡ºå¼‚å¸¸ä¸ºä»€ä¹ˆä¸ç”¨throwsï¼Ÿ"></a>3.æŠ›å‡ºå¼‚å¸¸ä¸ºä»€ä¹ˆä¸ç”¨throwsï¼Ÿ</h2><p>å¦‚æœå¼‚å¸¸æ˜¯æœªæ£€æŸ¥å¼‚å¸¸æˆ–è€…åœ¨æ–¹æ³•å†…éƒ¨è¢«æ•è·å’Œå¤„ç†äº†ï¼Œé‚£ä¹ˆå°±ä¸éœ€è¦ä½¿ç”¨throwsã€‚</p><ul><li><strong>Unchecked Exceptions</strong>ï¼š<strong>æœªæ£€æŸ¥å¼‚å¸¸ï¼ˆunchecked exceptionsï¼‰æ˜¯ç»§æ‰¿è‡ªRuntimeExceptionç±»æˆ–Errorç±»çš„å¼‚å¸¸ï¼Œ</strong>ç¼–è¯‘å™¨ä¸å¼ºåˆ¶è¦æ±‚è¿›è¡Œå¼‚å¸¸å¤„ç†ã€‚å› æ­¤ï¼Œå¯¹äºè¿™äº›å¼‚å¸¸ï¼Œä¸éœ€è¦åœ¨æ–¹æ³•ç­¾åä¸­ä½¿ç”¨throwsæ¥å£°æ˜ã€‚ç¤ºä¾‹åŒ…æ‹¬NullPointerExceptionã€ArrayIndexOutOfBoundsExceptionç­‰ã€‚</li><li><strong>æ•è·å’Œå¤„ç†å¼‚å¸¸</strong>ï¼šå¦ä¸€ç§å¸¸è§æƒ…å†µæ˜¯ï¼Œ<strong>åœ¨æ–¹æ³•å†…éƒ¨æ•è·äº†å¯èƒ½æŠ›å‡ºçš„å¼‚å¸¸ï¼Œå¹¶åœ¨æ–¹æ³•å†…éƒ¨å¤„ç†å®ƒä»¬ï¼Œ</strong>è€Œä¸æ˜¯é€šè¿‡throwså­å¥å°†å®ƒä»¬ä¼ é€’åˆ°è°ƒç”¨è€…ã€‚è¿™ç§æƒ…å†µä¸‹ï¼Œæ–¹æ³•å¯ä»¥å¤„ç†å¼‚å¸¸è€Œæ— éœ€åœ¨æ–¹æ³•ç­¾åä¸­ä½¿ç”¨throwsã€‚</li></ul><h1 id="åºåˆ—åŒ–"><a href="#åºåˆ—åŒ–" class="headerlink" title="åºåˆ—åŒ–"></a>åºåˆ—åŒ–</h1><h2 id="1-æ€ä¹ˆæŠŠä¸€ä¸ªå¯¹è±¡ä»ä¸€ä¸ªjvmè½¬ç§»åˆ°å¦ä¸€ä¸ªjvm"><a href="#1-æ€ä¹ˆæŠŠä¸€ä¸ªå¯¹è±¡ä»ä¸€ä¸ªjvmè½¬ç§»åˆ°å¦ä¸€ä¸ªjvm" class="headerlink" title="1.æ€ä¹ˆæŠŠä¸€ä¸ªå¯¹è±¡ä»ä¸€ä¸ªjvmè½¬ç§»åˆ°å¦ä¸€ä¸ªjvm?"></a>1.æ€ä¹ˆæŠŠä¸€ä¸ªå¯¹è±¡ä»ä¸€ä¸ªjvmè½¬ç§»åˆ°å¦ä¸€ä¸ªjvm?</h2><ul><li><strong>ä½¿ç”¨åºåˆ—åŒ–å’Œååºåˆ—åŒ–</strong>ï¼šå°†å¯¹è±¡åºåˆ—åŒ–ä¸ºå­—èŠ‚æµï¼Œå¹¶å°†å…¶å‘é€åˆ°å¦ä¸€ä¸ª JVMï¼Œç„¶ååœ¨å¦ä¸€ä¸ª JVM ä¸­ååºåˆ—åŒ–å­—èŠ‚æµæ¢å¤å¯¹è±¡ã€‚è¿™å¯ä»¥é€šè¿‡ Java çš„ ObjectOutputStream å’Œ ObjectInputStream æ¥å®ç°ã€‚</li><li><strong>ä½¿ç”¨æ¶ˆæ¯ä¼ é€’æœºåˆ¶</strong>ï¼šåˆ©ç”¨æ¶ˆæ¯ä¼ é€’æœºåˆ¶ï¼Œæ¯”å¦‚ä½¿ç”¨æ¶ˆæ¯é˜Ÿåˆ—ï¼ˆå¦‚ RabbitMQã€Kafkaï¼‰æˆ–è€…é€šè¿‡ç½‘ç»œå¥—æ¥å­—è¿›è¡Œé€šä¿¡ï¼Œå°†å¯¹è±¡ä»ä¸€ä¸ª JVM å‘é€åˆ°å¦ä¸€ä¸ªã€‚è¿™éœ€è¦è‡ªå®šä¹‰åè®®æ¥åºåˆ—åŒ–å¯¹è±¡å¹¶åœ¨å¦ä¸€ä¸ª JVM ä¸­ååºåˆ—åŒ–ã€‚</li><li><strong>ä½¿ç”¨è¿œç¨‹æ–¹æ³•è°ƒç”¨ï¼ˆRPCï¼‰</strong>ï¼šå¯ä»¥ä½¿ç”¨è¿œç¨‹æ–¹æ³•è°ƒç”¨æ¡†æ¶ï¼Œå¦‚ gRPCï¼Œæ¥å®ç°å¯¹è±¡åœ¨ä¸åŒ JVM ä¹‹é—´çš„ä¼ è¾“ã€‚è¿œç¨‹æ–¹æ³•è°ƒç”¨å¯ä»¥è®©ä½ åœ¨åˆ†å¸ƒå¼ç³»ç»Ÿä¸­è°ƒç”¨è¿œç¨‹ JVM ä¸Šçš„å¯¹è±¡çš„æ–¹æ³•ã€‚</li><li><strong>ä½¿ç”¨å…±äº«æ•°æ®åº“æˆ–ç¼“å­˜</strong>ï¼šå°†å¯¹è±¡å­˜å‚¨åœ¨å…±äº«æ•°æ®åº“ï¼ˆå¦‚ MySQLã€PostgreSQLï¼‰æˆ–å…±äº«ç¼“å­˜ï¼ˆå¦‚ Redisï¼‰ä¸­ï¼Œè®©ä¸åŒçš„ JVM å¯ä»¥è®¿é—®è¿™äº›å…±äº«æ•°æ®ã€‚è¿™ç§æ–¹æ³•é€‚ç”¨äºéœ€è¦å…±äº«æ•°æ®ä½†ä¸éœ€è¦ç›´æ¥ä¼ è¾“å¯¹è±¡çš„åœºæ™¯ã€‚</li></ul><h2 id="2-åºåˆ—åŒ–å’Œååºåˆ—åŒ–è®©ä½ è‡ªå·±å®ç°ä½ ä¼šæ€ä¹ˆåš"><a href="#2-åºåˆ—åŒ–å’Œååºåˆ—åŒ–è®©ä½ è‡ªå·±å®ç°ä½ ä¼šæ€ä¹ˆåš" class="headerlink" title="2.åºåˆ—åŒ–å’Œååºåˆ—åŒ–è®©ä½ è‡ªå·±å®ç°ä½ ä¼šæ€ä¹ˆåš?"></a>2.åºåˆ—åŒ–å’Œååºåˆ—åŒ–è®©ä½ è‡ªå·±å®ç°ä½ ä¼šæ€ä¹ˆåš?</h2><p>Java é»˜è®¤çš„åºåˆ—åŒ–è™½ç„¶å®ç°æ–¹ä¾¿ï¼Œä½†å´å­˜åœ¨å®‰å…¨æ¼æ´ã€ä¸è·¨è¯­è¨€ä»¥åŠæ€§èƒ½å·®ç­‰ç¼ºé™·ã€‚</p><ul><li><strong>æ— æ³•è·¨è¯­è¨€</strong>ï¼š Java åºåˆ—åŒ–ç›®å‰åªé€‚ç”¨åŸºäº Java è¯­è¨€å®ç°çš„æ¡†æ¶ï¼Œå…¶å®ƒè¯­è¨€å¤§éƒ¨åˆ†éƒ½æ²¡æœ‰ä½¿ç”¨ Java çš„åºåˆ—åŒ–æ¡†æ¶ï¼Œä¹Ÿæ²¡æœ‰å®ç° Java åºåˆ—åŒ–è¿™å¥—åè®®ã€‚å› æ­¤ï¼Œå¦‚æœæ˜¯ä¸¤ä¸ªåŸºäºä¸åŒè¯­è¨€ç¼–å†™çš„åº”ç”¨ç¨‹åºç›¸äº’é€šä¿¡ï¼Œåˆ™æ— æ³•å®ç°ä¸¤ä¸ªåº”ç”¨æœåŠ¡ä¹‹é—´ä¼ è¾“å¯¹è±¡çš„åºåˆ—åŒ–ä¸ååºåˆ—åŒ–ã€‚</li><li><strong>å®¹æ˜“è¢«æ”»å‡»</strong>ï¼šJava åºåˆ—åŒ–æ˜¯ä¸å®‰å…¨çš„ï¼Œæˆ‘ä»¬çŸ¥é“å¯¹è±¡æ˜¯é€šè¿‡åœ¨ <strong>ObjectInputStream ä¸Šè°ƒç”¨ readObject() æ–¹æ³•è¿›è¡Œååºåˆ—åŒ–çš„ï¼Œ</strong>è¿™ä¸ªæ–¹æ³•å…¶å®æ˜¯ä¸€ä¸ªç¥å¥‡çš„æ„é€ å™¨ï¼Œå®ƒå¯ä»¥å°†ç±»è·¯å¾„ä¸Šå‡ ä¹æ‰€æœ‰å®ç°äº† Serializable æ¥å£çš„å¯¹è±¡éƒ½å®ä¾‹åŒ–ã€‚è¿™ä¹Ÿå°±æ„å‘³ç€ï¼Œåœ¨ååºåˆ—åŒ–å­—èŠ‚æµçš„è¿‡ç¨‹ä¸­ï¼Œ<strong>è¯¥æ–¹æ³•å¯ä»¥æ‰§è¡Œä»»æ„ç±»å‹çš„ä»£ç ï¼Œè¿™æ˜¯éå¸¸å±é™©çš„ã€‚</strong></li><li>åºåˆ—åŒ–åçš„æµå¤ªå¤§ï¼šåºåˆ—åŒ–åçš„äºŒè¿›åˆ¶æµå¤§å°èƒ½ä½“ç°åºåˆ—åŒ–çš„æ€§èƒ½ã€‚<strong>åºåˆ—åŒ–åçš„äºŒè¿›åˆ¶æ•°ç»„è¶Šå¤§ï¼Œå ç”¨çš„å­˜å‚¨ç©ºé—´å°±è¶Šå¤šï¼Œå­˜å‚¨ç¡¬ä»¶çš„æˆæœ¬å°±è¶Šé«˜ã€‚</strong>å¦‚æœæˆ‘ä»¬æ˜¯è¿›è¡Œç½‘ç»œä¼ è¾“ï¼Œåˆ™å ç”¨çš„å¸¦å®½å°±æ›´å¤šï¼Œè¿™æ—¶å°±ä¼šå½±å“åˆ°ç³»ç»Ÿçš„ååé‡ã€‚</li></ul><p>æˆ‘ä¼šè€ƒè™‘ç”¨ä¸»æµåºåˆ—åŒ–æ¡†æ¶ï¼Œæ¯”å¦‚FastJsonã€<strong>Protobuf</strong>æ¥æ›¿ä»£Java åºåˆ—åŒ–ã€‚</p><p>å¦‚æœè¿½æ±‚æ€§èƒ½çš„è¯ï¼ŒProtobuf åºåˆ—åŒ–æ¡†æ¶ä¼šæ¯”è¾ƒåˆé€‚ï¼Œ<strong>Protobuf çš„è¿™ç§æ•°æ®å­˜å‚¨æ ¼å¼ï¼Œä¸ä»…å‹ç¼©å­˜å‚¨æ•°æ®çš„æ•ˆæœå¥½ï¼Œ åœ¨ç¼–ç å’Œè§£ç çš„æ€§èƒ½æ–¹é¢ä¹Ÿå¾ˆé«˜æ•ˆã€‚Protobuf çš„ç¼–ç å’Œè§£ç è¿‡ç¨‹ç»“åˆ.proto æ–‡ä»¶æ ¼å¼ï¼ŒåŠ ä¸Š Protocol Buffer ç‹¬ç‰¹çš„ç¼–ç æ ¼å¼ï¼Œåªéœ€è¦ç®€å•çš„æ•°æ®è¿ç®—ä»¥åŠä½ç§»ç­‰æ“ä½œå°±å¯ä»¥å®Œæˆç¼–ç ä¸è§£ç ã€‚</strong>å¯ä»¥è¯´ Protobuf çš„æ•´ä½“æ€§èƒ½éå¸¸ä¼˜ç§€ã€‚</p><h2 id="3-å°†å¯¹è±¡è½¬ä¸ºäºŒè¿›åˆ¶å­—èŠ‚æµå…·ä½“æ€ä¹ˆå®ç°"><a href="#3-å°†å¯¹è±¡è½¬ä¸ºäºŒè¿›åˆ¶å­—èŠ‚æµå…·ä½“æ€ä¹ˆå®ç°" class="headerlink" title="3.å°†å¯¹è±¡è½¬ä¸ºäºŒè¿›åˆ¶å­—èŠ‚æµå…·ä½“æ€ä¹ˆå®ç°?"></a>3.å°†å¯¹è±¡è½¬ä¸ºäºŒè¿›åˆ¶å­—èŠ‚æµå…·ä½“æ€ä¹ˆå®ç°?</h2><p>åœ¨Javaä¸­é€šè¿‡åºåˆ—åŒ–å¯¹è±¡æµæ¥å®Œæˆåºåˆ—åŒ–å’Œååºåˆ—åŒ–ï¼š</p><ul><li>ObjectOutputStreamï¼šé€šè¿‡writeObject(ï¼‰æ–¹æ³•åšåºåˆ—åŒ–æ“ä½œã€‚</li><li>ObjectInputStreanï¼šé€šè¿‡readObject()æ–¹æ³•åšååºåˆ—åŒ–æ“ä½œã€‚</li></ul><p>åªæœ‰å®ç°äº†Serializableæˆ–Externalizableæ¥å£çš„ç±»çš„å¯¹è±¡æ‰èƒ½è¢«åºåˆ—åŒ–ï¼Œå¦åˆ™æŠ›å‡ºå¼‚å¸¸ï¼</p><p>å®ç°å¯¹è±¡åºåˆ—åŒ–ï¼š</p><ul><li>è®©ç±»å®ç°Serializableæ¥å£ï¼š</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.Serializable;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyClass</span> <span class="keyword">implements</span> <span class="title class_">Serializable</span> &#123;</span><br><span class="line">    <span class="comment">// class code</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>åˆ›å»ºè¾“å‡ºæµå¹¶å†™å…¥å¯¹è±¡ï¼š</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.FileOutputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.ObjectOutputStream;</span><br><span class="line"></span><br><span class="line"><span class="type">MyClass</span> <span class="variable">obj</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyClass</span>();</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="type">FileOutputStream</span> <span class="variable">fileOut</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;object.ser&quot;</span>);</span><br><span class="line">    <span class="type">ObjectOutputStream</span> <span class="variable">out</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(fileOut);</span><br><span class="line">    out.writeObject(obj);</span><br><span class="line">    out.close();</span><br><span class="line">    fileOut.close();</span><br><span class="line">&#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®ç°å¯¹è±¡ååºåˆ—åŒ–ï¼š</p><ul><li>åˆ›å»ºè¾“å…¥æµå¹¶è¯»å–å¯¹è±¡ï¼š</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.FileInputStream;</span><br><span class="line"><span class="keyword">import</span> java.io.ObjectInputStream;</span><br><span class="line"></span><br><span class="line"><span class="type">MyClass</span> <span class="variable">newObj</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="type">FileInputStream</span> <span class="variable">fileIn</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;object.ser&quot;</span>);</span><br><span class="line">    <span class="type">ObjectInputStream</span> <span class="variable">in</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(fileIn);</span><br><span class="line">    newObj = (MyClass) in.readObject();</span><br><span class="line">    in.close();</span><br><span class="line">    fileIn.close();</span><br><span class="line">&#125; <span class="keyword">catch</span> (IOException | ClassNotFoundException e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€šè¿‡ä»¥ä¸Šæ­¥éª¤ï¼Œå¯¹è±¡objä¼šè¢«åºåˆ—åŒ–å¹¶å†™å…¥åˆ°æ–‡ä»¶â€object.serâ€ä¸­ï¼Œç„¶åé€šè¿‡ååºåˆ—åŒ–æ“ä½œï¼Œä»æ–‡ä»¶ä¸­è¯»å–å­—èŠ‚æµå¹¶æ¢å¤ä¸ºå¯¹è±¡newObjã€‚è¿™ç§æ–¹å¼å¯ä»¥æ–¹ä¾¿åœ°å°†å¯¹è±¡è½¬æ¢ä¸ºå­—èŠ‚æµç”¨äºæŒä¹…åŒ–å­˜å‚¨ã€ç½‘ç»œä¼ è¾“ç­‰æ“ä½œã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè¦ç¡®ä¿ç±»å®ç°äº†Serializableæ¥å£ï¼Œå¹¶ä¸”æ‰€æœ‰æˆå‘˜å˜é‡éƒ½æ˜¯Serializableçš„æ‰èƒ½è¢«æ­£ç¡®åºåˆ—åŒ–ã€‚</p><p>æ€»ç»“ï¼š</p><p>åˆ›å»ºæ–‡ä»¶ä¼ è¾“æµï¼Œç„¶åè¿™è¾¹æ˜¯inputstreamæµæ”¾å…¥outputstream</p><p>ç„¶åå…³é—­</p><p>åˆ›å»ºæ–‡ä»¶inputstreamï¼Œåˆ›å»ºoutputstreamæµï¼ŒoutputæµreadObjectç„¶åå…³é—­æµ</p><h1 id="è®¾è®¡æ¨¡å¼"><a href="#è®¾è®¡æ¨¡å¼" class="headerlink" title="è®¾è®¡æ¨¡å¼"></a>è®¾è®¡æ¨¡å¼</h1><h2 id="å•ä¾‹"><a href="#å•ä¾‹" class="headerlink" title="å•ä¾‹"></a>å•ä¾‹</h2><h3 id="1-volatileå’Œsychronizedå¦‚ä½•å®ç°å•ä¾‹æ¨¡å¼"><a href="#1-volatileå’Œsychronizedå¦‚ä½•å®ç°å•ä¾‹æ¨¡å¼" class="headerlink" title="1.volatileå’Œsychronizedå¦‚ä½•å®ç°å•ä¾‹æ¨¡å¼"></a>1.volatileå’Œsychronizedå¦‚ä½•å®ç°å•ä¾‹æ¨¡å¼</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SingleTon</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// volatile å…³é”®å­—ä¿®é¥°å˜é‡ é˜²æ­¢æŒ‡ä»¤é‡æ’åº</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">volatile</span> <span class="type">SingleTon</span> <span class="variable">instance</span> <span class="operator">=</span> <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="title function_">SingleTon</span><span class="params">()</span>&#123;&#125;</span><br><span class="line">     </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span>  SingleTon <span class="title function_">getInstance</span><span class="params">()</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(instance == <span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="comment">//åŒæ­¥ä»£ç å— åªæœ‰åœ¨ç¬¬ä¸€æ¬¡è·å–å¯¹è±¡çš„æ—¶å€™ä¼šæ‰§è¡Œåˆ° ï¼Œç¬¬äºŒæ¬¡åŠä»¥åè®¿é—®æ—¶ instanceå˜é‡å‡énullæ•…ä¸ä¼šå¾€ä¸‹æ‰§è¡Œäº† ç›´æ¥è¿”å›å•¦</span></span><br><span class="line">            <span class="keyword">synchronized</span>(SingleTon.class)&#123;</span><br><span class="line">                <span class="keyword">if</span>(instance == <span class="literal">null</span>)&#123;</span><br><span class="line">                    instance = <span class="keyword">new</span> <span class="title class_">SingleTon</span>();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> instance;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ­£ç¡®çš„åŒé‡æ£€æŸ¥é”å®šæ¨¡å¼éœ€è¦éœ€è¦ä½¿ç”¨ volatileã€‚volatileä¸»è¦åŒ…å«ä¸¤ä¸ªåŠŸèƒ½ã€‚</p><ul><li>ä¿è¯å¯è§æ€§ã€‚ä½¿ç”¨ volatile å®šä¹‰çš„å˜é‡ï¼Œå°†ä¼šä¿è¯å¯¹æ‰€æœ‰çº¿ç¨‹çš„å¯è§æ€§ã€‚</li><li>ç¦æ­¢æŒ‡ä»¤é‡æ’åºä¼˜åŒ–ã€‚</li></ul><p>ç”±äº volatile ç¦æ­¢å¯¹è±¡åˆ›å»ºæ—¶æŒ‡ä»¤ä¹‹é—´é‡æ’åºï¼Œæ‰€ä»¥å…¶ä»–çº¿ç¨‹ä¸ä¼šè®¿é—®åˆ°ä¸€ä¸ªæœªåˆå§‹åŒ–çš„å¯¹è±¡ï¼Œä»è€Œä¿è¯å®‰å…¨æ€§ã€‚</p><h2 id="ä»£ç†æ¨¡å¼-amp-é€‚é…å™¨æ¨¡å¼"><a href="#ä»£ç†æ¨¡å¼-amp-é€‚é…å™¨æ¨¡å¼" class="headerlink" title="ä»£ç†æ¨¡å¼&amp;é€‚é…å™¨æ¨¡å¼"></a>ä»£ç†æ¨¡å¼&amp;é€‚é…å™¨æ¨¡å¼</h2><h3 id="1-ä»£ç†æ¨¡å¼å’Œé€‚é…å™¨æ¨¡å¼æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"><a href="#1-ä»£ç†æ¨¡å¼å’Œé€‚é…å™¨æ¨¡å¼æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ" class="headerlink" title="1.ä»£ç†æ¨¡å¼å’Œé€‚é…å™¨æ¨¡å¼æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"></a>1.ä»£ç†æ¨¡å¼å’Œé€‚é…å™¨æ¨¡å¼æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</h3><ul><li><strong>ç›®çš„ä¸åŒ</strong>ï¼šä»£ç†æ¨¡å¼ä¸»è¦å…³æ³¨<strong>æ§åˆ¶å¯¹å¯¹è±¡çš„è®¿é—®</strong>ï¼Œè€Œé€‚é…å™¨æ¨¡å¼åˆ™ç”¨äº<strong>æ¥å£è½¬æ¢</strong>ï¼Œä½¿ä¸å…¼å®¹çš„ç±»èƒ½å¤Ÿä¸€èµ·å·¥ä½œã€‚</li><li><strong>ç»“æ„ä¸åŒ</strong>ï¼šä»£ç†æ¨¡å¼ä¸€èˆ¬åŒ…å«<strong>æŠ½è±¡ä¸»é¢˜ã€çœŸå®ä¸»é¢˜å’Œä»£ç†</strong>ä¸‰ä¸ªè§’è‰²ï¼Œé€‚é…å™¨æ¨¡å¼åŒ…å«<strong>ç›®æ ‡æ¥å£ã€é€‚é…å™¨å’Œè¢«é€‚é…è€…</strong>ä¸‰ä¸ªè§’è‰²ã€‚</li><li><strong>åº”ç”¨åœºæ™¯ä¸åŒ</strong>ï¼šä»£ç†æ¨¡å¼å¸¸ç”¨äº<strong>æ·»åŠ é¢å¤–åŠŸèƒ½æˆ–æ§åˆ¶å¯¹å¯¹è±¡</strong>çš„è®¿é—®ï¼Œé€‚é…å™¨æ¨¡å¼<strong>å¸¸ç”¨äºè®©ä¸å…¼å®¹çš„æ¥å£ååŒå·¥ä½œã€‚</strong></li></ul><h1 id="IO"><a href="#IO" class="headerlink" title="IO"></a>IO</h1><h2 id="1-Javaæ€ä¹ˆå®ç°ç½‘ç»œIOé«˜å¹¶å‘ç¼–ç¨‹ï¼Ÿ"><a href="#1-Javaæ€ä¹ˆå®ç°ç½‘ç»œIOé«˜å¹¶å‘ç¼–ç¨‹ï¼Ÿ" class="headerlink" title="1.Javaæ€ä¹ˆå®ç°ç½‘ç»œIOé«˜å¹¶å‘ç¼–ç¨‹ï¼Ÿ"></a>1.<strong>Javaæ€ä¹ˆå®ç°ç½‘ç»œIOé«˜å¹¶å‘ç¼–ç¨‹ï¼Ÿ</strong></h2><p>å¯ä»¥ç”¨ Java NIO ï¼Œæ˜¯ä¸€ç§åŒæ­¥éé˜»å¡çš„I/Oæ¨¡å‹ï¼Œä¹Ÿæ˜¯I/Oå¤šè·¯å¤ç”¨çš„åŸºç¡€ã€‚</p><p>ä¼ ç»Ÿçš„BIOé‡Œé¢socket.read()ï¼Œ<strong>å¦‚æœTCP RecvBufferé‡Œæ²¡æœ‰æ•°æ®ï¼Œå‡½æ•°ä¼šä¸€ç›´é˜»å¡</strong>ï¼Œç›´åˆ°æ”¶åˆ°æ•°æ®ï¼Œè¿”å›è¯»åˆ°çš„æ•°æ®ï¼Œ <strong>å¦‚æœä½¿ç”¨BIOè¦æƒ³è¦å¹¶å‘å¤„ç†å¤šä¸ªå®¢æˆ·ç«¯çš„i/oï¼Œé‚£ä¹ˆä¼šä½¿ç”¨å¤šçº¿ç¨‹æ¨¡å¼</strong>ï¼Œä¸€ä¸ªçº¿ç¨‹ä¸“é—¨å¤„ç†ä¸€ä¸ªå®¢æˆ·ç«¯ ioï¼Œè¿™ç§æ¨¡å¼éšç€å®¢æˆ·ç«¯è¶Šæ¥è¶Šå¤šï¼Œæ‰€éœ€è¦åˆ›å»ºçš„çº¿ç¨‹ä¹Ÿè¶Šæ¥è¶Šå¤šï¼Œä¼šæ€¥å‰§æ¶ˆè€—ç³»ç»Ÿçš„æ€§èƒ½ã€‚</p><p>NIO æ˜¯<strong>åŸºäºI/Oå¤šè·¯å¤ç”¨å®ç°</strong>çš„ï¼Œå®ƒå¯ä»¥<strong>åªç”¨ä¸€ä¸ªçº¿ç¨‹å¤„ç†å¤šä¸ªå®¢æˆ·ç«¯I/O</strong>ï¼Œå¦‚æœä½ éœ€è¦åŒæ—¶ç®¡ç†æˆåƒä¸Šä¸‡çš„è¿æ¥ï¼Œä½†æ˜¯æ¯ä¸ªè¿æ¥åªå‘é€å°‘é‡æ•°æ®ï¼Œä¾‹å¦‚ä¸€ä¸ªèŠå¤©æœåŠ¡å™¨ï¼Œç”¨NIOå®ç°ä¼šæ›´å¥½ä¸€äº›ã€‚è¿™ä¸ªç±»ä¼¼redisä¸­çš„å•çº¿ç¨‹IOå¤šè·¯å¤ç”¨</p><h2 id="2-BIOã€NIOã€AIOåŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#2-BIOã€NIOã€AIOåŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="2.BIOã€NIOã€AIOåŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ"></a>2.BIOã€NIOã€AIOåŒºåˆ«æ˜¯ä»€ä¹ˆï¼Ÿ</h2><ul><li>BIOï¼ˆblocking IOï¼‰ï¼šå°±æ˜¯ä¼ ç»Ÿçš„ java.io åŒ…ï¼Œå®ƒæ˜¯<strong>åŸºäºæµæ¨¡å‹å®ç°</strong>çš„ï¼Œäº¤äº’çš„æ–¹å¼æ˜¯<strong>åŒæ­¥ã€é˜»å¡æ–¹å¼</strong>ï¼Œä¹Ÿå°±æ˜¯è¯´åœ¨è¯»å…¥è¾“å…¥æµæˆ–è€…è¾“å‡ºæµæ—¶ï¼Œåœ¨è¯»å†™åŠ¨ä½œå®Œæˆä¹‹å‰ï¼Œçº¿ç¨‹ä¼šä¸€ç›´é˜»å¡åœ¨é‚£é‡Œï¼Œå®ƒä»¬ä¹‹é—´çš„è°ƒç”¨æ˜¯å¯é çš„çº¿æ€§é¡ºåºã€‚ä¼˜ç‚¹æ˜¯ä»£ç æ¯”è¾ƒç®€å•ã€ç›´è§‚ï¼›ç¼ºç‚¹æ˜¯ IO çš„æ•ˆç‡å’Œæ‰©å±•æ€§å¾ˆä½ï¼Œå®¹æ˜“æˆä¸ºåº”ç”¨æ€§èƒ½ç“¶é¢ˆã€‚</li><li>NIOï¼ˆnon-blocking IOï¼‰ ï¼šJava 1.4 å¼•å…¥çš„ java.nio åŒ…ï¼Œ<strong>æä¾›äº† Channelã€Selectorã€Buffer ç­‰æ–°çš„æŠ½è±¡ï¼Œå¯ä»¥æ„å»ºå¤šè·¯å¤ç”¨çš„ã€åŒæ­¥éé˜»å¡ IO ç¨‹åº</strong>ï¼ŒåŒæ—¶æä¾›äº†æ›´æ¥è¿‘æ“ä½œç³»ç»Ÿåº•å±‚é«˜æ€§èƒ½çš„æ•°æ®æ“ä½œæ–¹å¼ã€‚</li><li>AIOï¼ˆAsynchronous IOï¼‰ ï¼šæ˜¯ Java 1.7 ä¹‹åå¼•å…¥çš„åŒ…ï¼Œ<strong>æ˜¯ NIO çš„å‡çº§ç‰ˆæœ¬ï¼Œæä¾›äº†å¼‚æ­¥éå µå¡çš„ IO æ“ä½œæ–¹å¼ï¼Œ</strong>æ‰€ä»¥äººä»¬å«å®ƒ AIOï¼ˆAsynchronous IOï¼‰ï¼Œå¼‚æ­¥ IO æ˜¯åŸºäºäº‹ä»¶å’Œå›è°ƒæœºåˆ¶å®ç°çš„ï¼Œä¹Ÿå°±æ˜¯åº”ç”¨æ“ä½œä¹‹åä¼šç›´æ¥è¿”å›ï¼Œä¸ä¼šå µå¡åœ¨é‚£é‡Œï¼Œå½“åå°å¤„ç†å®Œæˆï¼Œæ“ä½œç³»ç»Ÿä¼šé€šçŸ¥ç›¸åº”çš„çº¿ç¨‹è¿›è¡Œåç»­çš„æ“ä½œã€‚</li></ul><h2 id="3-NIOæ˜¯æ€ä¹ˆå®ç°çš„ï¼Ÿ"><a href="#3-NIOæ˜¯æ€ä¹ˆå®ç°çš„ï¼Ÿ" class="headerlink" title="3.NIOæ˜¯æ€ä¹ˆå®ç°çš„ï¼Ÿ"></a>3.NIOæ˜¯æ€ä¹ˆå®ç°çš„ï¼Ÿ</h2><p>NIOæ˜¯ä¸€ç§<strong>åŒæ­¥éé˜»å¡çš„IOæ¨¡å‹</strong>ï¼Œæ‰€ä»¥ä¹Ÿå¯ä»¥å«NON-BLOCKINGIOã€‚<strong>åŒæ­¥æ˜¯æŒ‡çº¿ç¨‹ä¸æ–­è½®è¯¢IOäº‹ä»¶æ˜¯å¦å°±ç»ªï¼Œéé˜»å¡æ˜¯æŒ‡çº¿ç¨‹åœ¨ç­‰å¾…IOçš„æ—¶å€™ï¼Œå¯ä»¥åŒæ—¶åšå…¶ä»–ä»»åŠ¡ã€‚</strong></p><p>åŒæ­¥çš„æ ¸å¿ƒå°±Selectorï¼ˆI/Oå¤šè·¯å¤ç”¨ï¼‰ï¼Œ<strong>Selectorä»£æ›¿äº†çº¿ç¨‹æœ¬èº«è½®è¯¢IOäº‹ä»¶ï¼Œé¿å…äº†é˜»å¡åŒæ—¶å‡å°‘äº†ä¸å¿…è¦çš„çº¿ç¨‹æ¶ˆè€—</strong>ï¼›éé˜»å¡çš„æ ¸å¿ƒå°±æ˜¯é€šé“å’Œç¼“å†²åŒºï¼Œ<strong>å½“IOäº‹ä»¶å°±ç»ªæ—¶ï¼Œå¯ä»¥é€šè¿‡å†™åˆ°ç¼“å†²åŒºï¼Œä¿è¯IOçš„æˆåŠŸï¼Œè€Œæ— éœ€çº¿ç¨‹é˜»å¡å¼åœ°ç­‰å¾…ã€‚</strong></p><p>NIOç”±<strong>ä¸€ä¸ªä¸“é—¨çš„çº¿ç¨‹å¤„ç†æ‰€æœ‰IOäº‹ä»¶ï¼Œå¹¶è´Ÿè´£åˆ†å‘ã€‚äº‹ä»¶é©±åŠ¨æœºåˆ¶</strong>ï¼Œäº‹ä»¶åˆ°æ¥çš„æ—¶å€™è§¦å‘æ“ä½œï¼Œä¸éœ€è¦é˜»å¡çš„ç›‘è§†äº‹ä»¶ã€‚çº¿ç¨‹ä¹‹é—´é€šè¿‡<strong>wait,notify</strong>é€šä¿¡ï¼Œå‡å°‘çº¿ç¨‹åˆ‡æ¢ã€‚</p><p>NIOä¸»è¦æœ‰ä¸‰å¤§æ ¸å¿ƒéƒ¨åˆ†ï¼š<strong>Channel(é€šé“)ï¼ŒBuffer(ç¼“å†²åŒº), Selectorã€‚</strong>ä¼ ç»ŸIOåŸºäºå­—èŠ‚æµå’Œå­—ç¬¦æµè¿›è¡Œæ“ä½œï¼Œ<strong>è€ŒNIOåŸºäºChannelå’ŒBuffer(ç¼“å†²åŒº)è¿›è¡Œæ“ä½œï¼Œæ•°æ®æ€»æ˜¯ä»é€šé“è¯»å–åˆ°ç¼“å†²åŒºä¸­ï¼Œæˆ–è€…ä»ç¼“å†²åŒºå†™å…¥åˆ°é€šé“ä¸­ã€‚</strong></p><p>Selector(é€‰æ‹©åŒº)ç”¨äº<strong>ç›‘å¬å¤šä¸ªé€šé“çš„äº‹ä»¶</strong>ï¼ˆæ¯”å¦‚ï¼šè¿æ¥æ‰“å¼€ï¼Œæ•°æ®åˆ°è¾¾ï¼‰ã€‚å› æ­¤ï¼Œ<strong>å•ä¸ªçº¿ç¨‹å¯ä»¥ç›‘å¬å¤šä¸ªæ•°æ®é€šé“ã€‚</strong></p><h1 id="æ–°ç‰ˆæœ¬"><a href="#æ–°ç‰ˆæœ¬" class="headerlink" title="æ–°ç‰ˆæœ¬"></a>æ–°ç‰ˆæœ¬</h1><h2 id="1-ä»‹ç»ä¸‹lambdaè¡¨è¾¾å¼ã€Streamæµ"><a href="#1-ä»‹ç»ä¸‹lambdaè¡¨è¾¾å¼ã€Streamæµ" class="headerlink" title="1.ä»‹ç»ä¸‹lambdaè¡¨è¾¾å¼ã€Streamæµ"></a>1.ä»‹ç»ä¸‹<strong>lambdaè¡¨è¾¾å¼ã€Streamæµ</strong></h2>]]></content:encoded>
      
      
      <category domain="https://blog.tokenlen.top/categories/javase/">javase</category>
      
      <category domain="https://blog.tokenlen.top/categories/javase/java/">java</category>
      
      
      <category domain="https://blog.tokenlen.top/tags/java/">java</category>
      
      <category domain="https://blog.tokenlen.top/tags/%E9%9D%A2%E8%AF%95/">é¢è¯•</category>
      
      
      <comments>https://blog.tokenlen.top/2025/05/19/javase/javase2/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>javaseçŸ¥è¯†æ€»ç»“</title>
      <link>https://blog.tokenlen.top/2025/05/19/javase/javase1/</link>
      <guid>https://blog.tokenlen.top/2025/05/19/javase/javase1/</guid>
      <pubDate>Sun, 18 May 2025 16:00:00 GMT</pubDate>
      
        
        
          
          
      <description>&lt;h1 id=&quot;åŸºç¡€è¯­æ³•&quot;&gt;&lt;a href=&quot;#åŸºç¡€è¯­æ³•&quot; class=&quot;headerlink&quot; title=&quot;åŸºç¡€è¯­æ³•&quot;&gt;&lt;/a&gt;åŸºç¡€è¯­æ³•&lt;/h1&gt;&lt;h2 id=&quot;æ•°æ®ç±»å‹&quot;&gt;&lt;a href=&quot;#æ•°æ®ç±»å‹&quot; class=&quot;headerlink&quot;</description>
          
        
      
      
      
      <content:encoded><![CDATA[<h1 id="åŸºç¡€è¯­æ³•"><a href="#åŸºç¡€è¯­æ³•" class="headerlink" title="åŸºç¡€è¯­æ³•"></a>åŸºç¡€è¯­æ³•</h1><h2 id="æ•°æ®ç±»å‹"><a href="#æ•°æ®ç±»å‹" class="headerlink" title="æ•°æ®ç±»å‹"></a>æ•°æ®ç±»å‹</h2><p>javaä¸­æœ‰8ç§åŸºæœ¬ç±»å‹ï¼š</p><p>byte, short, int, long, float, double, boolean, char</p><p>è¿˜æœ‰å¼•ç”¨ç±»å‹</p><p>ç±»ã€æ•°ç»„ã€æ¥å£ç­‰ã€‚</p><p>æ¯”å¦‚<strong>String</strong>å°±æ˜¯å¼•ç”¨ç±»å‹ã€‚å¼•ç”¨ç±»å‹çš„é»˜è®¤æ˜¯ <code>null</code></p><div class="table-container"><table><thead><tr><th>ç±»å‹</th><th>ä½æ•°</th><th>é»˜è®¤å€¼</th><th>åŒ…è£…ç±»</th></tr></thead><tbody><tr><td>byte</td><td>8</td><td>0</td><td>Byte</td></tr><tr><td>short</td><td>16</td><td>0</td><td>Short</td></tr><tr><td>int</td><td>32</td><td>0</td><td>Integer</td></tr><tr><td>long</td><td>64</td><td>0L</td><td>Long</td></tr><tr><td>float</td><td>32</td><td>0.0f</td><td>Float</td></tr><tr><td>double</td><td>64</td><td>0.0d</td><td>Double</td></tr><tr><td>char</td><td>16</td><td>â€˜\u0000â€™</td><td>Character</td></tr><tr><td>boolean</td><td>1</td><td>false</td><td>Boolean</td></tr></tbody></table></div><p>æµ®ç‚¹æ•°çš„é»˜è®¤ç±»å‹æ˜¯double èµ‹ç»™ <code>float</code> éœ€åŠ  <code>f</code> åç¼€ã€‚ç²¾åº¦å˜å°</p><p><strong>byteæ˜¯å¾ªç¯çš„ï¼Œæ»¡äº†128å°±ä»-128å¼€å§‹</strong></p><p>doubleå’Œlongéƒ½æ˜¯é»˜è®¤å 64ä½çš„å­˜å‚¨ç©ºé—´</p><p>longç”¨äºå­˜å‚¨æ•´æ•°å€¼ï¼ŒèŒƒå›´ä¸º-2^63^åˆ° 2^63^-1ï¼Œdoubleç”¨äºå­˜å‚¨æµ®ç‚¹æ•°ï¼Œéµå¾ªIEEE 754æ ‡å‡†ã€‚</p><p>åŸºæœ¬æ•°æ®ç±»å‹å’Œå¼•ç”¨ç±»å‹çš„ä¸»è¦åŒºåˆ«åœ¨äº:</p><ol><li><p>åŸºæœ¬ç±»å‹å˜é‡å­˜å‚¨çš„æ˜¯å®é™…çš„æ•°æ®å€¼</p></li><li><p>å¼•ç”¨ç±»å‹å˜é‡å­˜å‚¨çš„æ˜¯å¯¹è±¡çš„å¼•ç”¨(å†…å­˜åœ°å€)</p></li><li><p>åŸºæœ¬ç±»å‹åœ¨æ ˆä¸­åˆ†é…å†…å­˜,å¼•ç”¨ç±»å‹åœ¨å †ä¸­åˆ†é…å†…å­˜</p></li></ol><p>   åªæœ‰ <strong>Byteã€Shortã€Integerã€Long</strong> å®ç°äº†ç¼“å­˜æœºåˆ¶ï¼Œä¸”é»˜è®¤ç¼“å­˜ -128 åˆ° 127 èŒƒå›´å†…çš„å€¼ã€‚ç¼“å­˜æœºåˆ¶å¯ä»¥æå‡æ€§èƒ½ï¼Œå‡å°‘ä¸å¿…è¦çš„å¯¹è±¡åˆ›å»ºã€‚</p><h3 id="String"><a href="#String" class="headerlink" title="String"></a>String</h3><div class="table-container"><table><thead><tr><th>ç±»å</th><th>å¯å˜æ€§</th><th>çº¿ç¨‹å®‰å…¨</th><th>æ€§èƒ½</th></tr></thead><tbody><tr><td>String</td><td>ä¸å¯å˜</td><td>å®‰å…¨</td><td>æœ€ä½</td></tr><tr><td>StringBuilder</td><td>å¯å˜</td><td>ä¸å®‰å…¨</td><td><strong>æœ€å¿«</strong></td></tr><tr><td>StringBuffer</td><td>å¯å˜</td><td>å®‰å…¨</td><td>ä¸­ç­‰</td></tr></tbody></table></div><p>Stringç±»å‹åªè¦æ˜¯å­—ç¬¦ä¸²ä¸€æ ·ï¼Œ<strong>==ä¸equalséƒ½ä¸€æ ·</strong>ï¼Œå› ä¸ºéƒ½åœ¨<strong>å­—ç¬¦ä¸²å¸¸é‡æ± </strong>çš„ä¸€ä¸ªä½ç½®é‡Œã€‚ä¼šè°ƒç”¨åŸå…ˆæœ‰çš„ Stringæ˜¯éœ€è¦åˆå§‹åŒ–çš„ã€‚ä½†æ˜¯å¦‚æœæ˜¯newäº†ä¸€ä¸ªçš„è¯å°±ä¸ä¸€æ ·äº†</p><p>å•çº¯çš„å­—ç¬¦ä¸²æ˜¯ä¸€æ ·çš„ã€‚ä»–ä»¬æ˜¯çº¿ç¨‹å…±äº«çš„ã€‚ç„¶åStringæ˜¯finalï¼Œæ˜¯ä¸å¯ä»¥ä¿®æ”¹çš„ã€‚</p><p>å¦‚æœè¿æ¥å­—ç¬¦ä¸²çš„æ—¶å€™ï¼Œ<strong>é‡è§æ•°å­—ï¼Œç›´æ¥è¿æ¥</strong>ï¼Œæ²¡æœ‰é‡åˆ°å°±æŒ‰æ•°å­¦è®¡ç®—</p><p>StringBuilderæ˜¯éçº¿ç¨‹å®‰å…¨çš„,ä¸éœ€è¦ç»´æŠ¤çº¿ç¨‹åŒæ­¥,æ‰€ä»¥è¿è¡Œé€Ÿåº¦æœ€å¿«ã€‚ä»–<strong>æ˜¯å•çº¿ç¨‹æ“ä½œçš„</strong>ï¼Œé€‚ç”¨äºå•çº¿ç¨‹ç¯å¢ƒä¸­éœ€è¦å¤§é‡ä¿®æ”¹å­—ç¬¦ä¸²çš„åœºæ™¯ï¼Œå¦‚é«˜é¢‘æ‹¼æ¥æ“ä½œã€‚</p><p>StringBufferè¿è¡Œé€Ÿåº¦ç¡®å®æ¯”Stringå¿«ã€‚<strong>å› ä¸ºStringçš„ä¸å¯å˜æ€§</strong>,æ¯æ¬¡æ“ä½œéƒ½ä¼šäº§ç”Ÿæ–°å¯¹è±¡,è€Œ<strong>StringBufferæ˜¯å¯å˜çš„,åœ¨åŸå¯¹è±¡ä¸Šç›´æ¥ä¿®æ”¹ã€‚</strong>ä½†æ˜¯ä»–ä»¬éƒ½æ˜¯finalä¿®é¥°çš„</p><p>StringBufferçš„æ‰€æœ‰å…¬å…±æ–¹æ³•éƒ½æ˜¯<strong>synchronized</strong>ä¿®é¥°çš„,æ˜¯çº¿ç¨‹å®‰å…¨çš„,é€‚åˆåœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ä½¿ç”¨ã€‚</p><p>å¯ä»¥ç›´æ¥ä¿®æ”¹å­—ç¬¦ä¸²</p><p>åœ¨ Java 8 åŠä»¥åï¼Œç¼–è¯‘å™¨ä¼šå¯¹å­—ç¬¦ä¸²çš„å¸¸é‡æ‹¼æ¥åšä¼˜åŒ–ï¼Œ<strong>å°†å­—ç¬¦ä¸²æ‹¼æ¥è½¬æ¢ä¸º StringBuilder</strong> æ“ä½œï¼Œè¿™ç§ä¼˜åŒ–æé«˜äº†ä»£ç æ€§èƒ½ã€‚</p><p>- Stringé€‚ç”¨äº<strong>å°‘é‡çš„å­—ç¬¦ä¸²æ“ä½œçš„æƒ…å†µ</strong><br>- StringBuilderé€‚ç”¨<strong>äºå•çº¿ç¨‹</strong>ä¸‹åœ¨å­—ç¬¦ç¼“å†²åŒºè¿›è¡Œå¤§é‡æ“ä½œçš„æƒ…å†µ<br>- StringBufferé€‚ç”¨äº<strong>å¤šçº¿ç¨‹ä¸‹</strong>åœ¨å­—ç¬¦ç¼“å†²åŒºè¿›è¡Œå¤§é‡æ“ä½œçš„æƒ…å†µ</p><p>è¿™ä¸‰è€…æ€§èƒ½ä»é«˜åˆ°ä½æ’åºä¸º:StringBuilder &gt; StringBuffer &gt; String</p><p>ä½†æ˜¯<strong>intern</strong>æ–¹æ³•ä¼šåœ¨é¦–å…ˆåœ¨å¸¸é‡æ± ä¸­å¯»æ‰¾ï¼Œæœ‰çš„è¯å°±ç›´æ¥ç”¨</p><h3 id="è¿ç®—æ³•åˆ™"><a href="#è¿ç®—æ³•åˆ™" class="headerlink" title="è¿ç®—æ³•åˆ™"></a>è¿ç®—æ³•åˆ™</h3><p>boolean b = true ? false : true==true ? false : true</p><p>é¦–å…ˆè¦æ˜ç¡®<strong>ä¸‰å…ƒè¿ç®—ç¬¦</strong>çš„ç»“åˆæ€§æ˜¯ä»<strong>å³åˆ°å·¦</strong>çš„ï¼Œä½†æ­¤å¤„æœ‰ä¸€ä¸ªæ¡ä»¶è¡¨è¾¾å¼trueåœ¨æœ€å‰é¢</p><p>ä»–ç›´æ¥æ˜¯trueäº†ï¼Œæ‰€ä»¥ç›´æ¥è¿”å›false</p><p><strong>å¤åˆèµ‹å€¼è¿ç®—ç¬¦/=çš„ä¼˜å…ˆçº§ä½äº++è¿ç®—ç¬¦</strong></p><p>doubleç±»å‹é™¤ä»¥intç±»å‹ï¼Œç»“æœä¼šè‡ªåŠ¨è½¬æ¢ä¸ºdoubleç±»å‹</p><p>åœ¨è¿›è¡Œé™¤æ³•è¿ç®—çš„è¯ï¼Œ<strong>å¦‚æœéƒ½æ˜¯æ•´å½¢ï¼Œé‚£ä¹ˆä¼šå‘ä¸‹å–æ•´ï¼Œèˆå»å°æ•°éƒ¨åˆ†</strong></p><blockquote><blockquote><p>æ˜¯ç®—æœ¯å³ç§»è¿ç®—ç¬¦ï¼Œå®ƒä½¿æ‰€æœ‰çš„ä½å‘å³ç§»åŠ¨ï¼Œä½†ä¿æŒç¬¦å·ä½ä¸å˜ã€‚å¯¹äºè´Ÿæ•°ï¼Œå·¦è¾¹ä¼šè‡ªåŠ¨è¡¥1ï¼Œæ­£æ•°åˆ™è¡¥0ã€‚</p></blockquote></blockquote><p>>&gt;&gt; æ˜¯é€»è¾‘å³ç§»è¿ç®—ç¬¦ï¼ˆä¹Ÿç§°æ— ç¬¦å·å³ç§»ï¼‰ï¼Œå®ƒä½¿æ‰€æœ‰çš„ä½å‘å³ç§»åŠ¨ï¼Œå¹¶ä¸”å·¦è¾¹æ€»æ˜¯è¡¥0ï¼Œä¸ç®¡åŸæ¥çš„æ•°æ˜¯æ­£æ•°è¿˜æ˜¯è´Ÿæ•°ã€‚</p><p>ä»–ä¿©éƒ½æ˜¯ç›¸å½“äº/2ï¼Œä½†æ˜¯æ­£è´Ÿæ•°çš„æ—¶å€™ä¸åŒã€‚ç”±äºŒè¿›åˆ¶å¯çœ‹å‡ºæ¥</p><p>å…¶ä¸­æœ‰&lt;&lt;=</p><p>æ²¡æœ‰&lt;&lt;&lt;=</p><p>==æ˜¯æ¯”è¾ƒåœ¨å†…å­˜ä¸­çš„ä½ç½®ï¼Œequalsæ˜¯æ¯”è¾ƒvalueçš„å¤§å°</p><p>åœ¨javaä¸­å°äºintç²¾åº¦çš„è®¡ç®—éƒ½ä¼šè‡ªåŠ¨è½¬ä¸ºintè¿›è¡Œè®¡ç®—</p><h2 id="ç±»"><a href="#ç±»" class="headerlink" title="ç±»"></a>ç±»</h2><h3 id="final"><a href="#final" class="headerlink" title="final"></a>final</h3><p>final<strong>ä¸èƒ½ä¿®é¥°æ¥å£å’ŒæŠ½è±¡ç±»</strong>ã€‚finalè¡¨ç¤ºâ€æœ€ç»ˆçš„â€å«ä¹‰,è€Œæ¥å£å’ŒæŠ½è±¡ç±»æœ¬èº«å°±æ˜¯éœ€è¦è¢«å®ç°æˆ–ç»§æ‰¿çš„,ä¸finalçš„è¯­ä¹‰ç›¸çŸ›ç›¾ã€‚finalåªèƒ½ä¿®é¥°<strong>å…·ä½“çš„ç±»ã€æ–¹æ³•å’Œå˜é‡ã€‚</strong></p><p>finalä¿®é¥°çš„æ–¹æ³•ä¸èƒ½è¢«é‡å†™(Override),ä½†æ˜¯<strong>å¯ä»¥è¢«é‡è½½</strong>(Overload)ã€‚é‡å†™æ˜¯å­ç±»å¯¹çˆ¶ç±»æ–¹æ³•çš„è¦†ç›–,è€Œé‡è½½æ˜¯åŒä¸€ä¸ªç±»ä¸­æ–¹æ³•åç›¸åŒä½†å‚æ•°ä¸åŒã€‚</p><p>finalä¿®é¥°çš„å˜é‡æ˜¯å¸¸é‡,ä¸€æ—¦è¢«èµ‹å€¼å°±ä¸èƒ½å†æ¬¡ä¿®æ”¹ã€‚å¯¹äº<strong>åŸºæœ¬ç±»å‹,æ˜¯å€¼ä¸èƒ½æ”¹å˜;å¯¹äºå¼•ç”¨ç±»å‹,æ˜¯å¼•ç”¨ä¸èƒ½æ”¹å˜(ä½†å¯¹è±¡çš„å†…å®¹å¯ä»¥æ”¹å˜)ã€‚</strong></p><h3 id="static"><a href="#static" class="headerlink" title="static"></a>static</h3><p><code>static</code> è¡¨ç¤ºâ€œé™æ€â€çš„å«ä¹‰ï¼Œç”¨äºä¿®é¥°ç±»çš„æˆå‘˜ï¼ˆå˜é‡ã€æ–¹æ³•ã€ä»£ç å—ã€å†…éƒ¨ç±»ï¼‰ã€‚è¢« <code>static</code> ä¿®é¥°çš„æˆå‘˜<strong>å±äºç±»æœ¬èº«</strong>ï¼Œè€Œä¸æ˜¯æŸä¸ªå¯¹è±¡ã€‚</p><p>å› æ­¤ï¼Œ<strong>æ— éœ€åˆ›å»ºå¯¹è±¡å³å¯è®¿é—®é™æ€æˆå‘˜</strong>ï¼Œæ¨èé€šè¿‡â€œç±»å.æˆå‘˜â€çš„æ–¹å¼è°ƒç”¨ã€‚</p><p><strong>static ä¸èƒ½ä¿®é¥°æ„é€ æ–¹æ³•å’Œå±€éƒ¨å˜é‡</strong>ï¼Œå› ä¸ºæ„é€ æ–¹æ³•æ˜¯ç”¨æ¥åˆ›å»ºå¯¹è±¡çš„ï¼Œå±€éƒ¨å˜é‡åªåœ¨æ–¹æ³•æ‰§è¡Œæ—¶å­˜åœ¨ï¼ŒäºŒè€…ä¸ç±»æ— å…³ã€‚</p><h3 id="this"><a href="#this" class="headerlink" title="this"></a>this</h3><p><code>this</code> è¡¨ç¤º<strong>å½“å‰å¯¹è±¡çš„å¼•ç”¨</strong>ï¼Œå¸¸ç”¨äºåŒºåˆ†æˆå‘˜å˜é‡ä¸å±€éƒ¨å˜é‡ã€åœ¨æ„é€ æ–¹æ³•ä¸­è°ƒç”¨å…¶ä»–æ„é€ æ–¹æ³•ã€å°†å½“å‰å¯¹è±¡ä½œä¸ºå‚æ•°ä¼ é€’ç­‰ã€‚</p><p><code>this()</code> è°ƒç”¨æ„é€ å™¨å¿…é¡»æ”¾åœ¨æ„é€ æ–¹æ³•çš„ç¬¬ä¸€è¡Œã€‚</p><p>thiså’Œsuperä¸èƒ½åŒæ—¶ä½¿ç”¨åœ¨ä¸€ä¸ªæ„é€ å‡½æ•°é‡Œ</p><h3 id="super"><a href="#super" class="headerlink" title="super"></a>super</h3><p><code>super</code> è¡¨ç¤º<strong>çˆ¶ç±»å¯¹è±¡çš„å¼•ç”¨</strong>ï¼Œå¯ç”¨äºè®¿é—®çˆ¶ç±»çš„æˆå‘˜å˜é‡ã€æ–¹æ³•ã€æ„é€ æ–¹æ³•ã€‚</p><p>å› ä¸ºåœ¨å­ç±»æ„é€ æ–¹æ³•ä¸­è°ƒç”¨çˆ¶ç±»æ„é€ æ–¹æ³•<strong>super()</strong>å¿…é¡»ä½äº<strong>ç¬¬ä¸€è¡Œ</strong>,è¿™æ˜¯Javaè¯­è¨€è§„èŒƒçš„è¦æ±‚ã€‚è¿™æ ·è®¾è®¡çš„åŸå› æ˜¯ä¸ºäº†ç¡®ä¿åœ¨åˆå§‹åŒ–å­ç±»ä¹‹å‰,çˆ¶ç±»å·²ç»å®Œæˆåˆå§‹åŒ–ã€‚</p><p><strong>ä¸èƒ½åœ¨staticç¯å¢ƒ</strong>(åŒ…æ‹¬staticæ–¹æ³•å’Œstaticä»£ç å—)ä¸­ä½¿ç”¨ã€‚å› ä¸ºstaticæˆå‘˜å±äºç±»,è€Œä¸æ˜¯å®ä¾‹,è€Œthiså’Œsuperéƒ½æ˜¯å’Œå®ä¾‹ç›¸å…³çš„æ¦‚å¿µã€‚</p><p>superä¸ä»…å¯ä»¥åœ¨<strong>å­ç±»æ„é€ æ–¹æ³•</strong>ä¸­ä½¿ç”¨,è¿˜å¯ä»¥åœ¨<strong>å­ç±»çš„å®ä¾‹æ–¹æ³•</strong>ä¸­ä½¿ç”¨,<strong>ç”¨äºè°ƒç”¨çˆ¶ç±»è¢«è¦†ç›–çš„æ–¹æ³•æˆ–è®¿é—®çˆ¶ç±»çš„å±æ€§ã€‚</strong></p><h3 id="volatile"><a href="#volatile" class="headerlink" title="volatile"></a>volatile</h3><p><code>volatile</code> æ˜¯ <strong>è½»é‡çº§çš„åŒæ­¥æœºåˆ¶</strong>ï¼Œç”¨äºä¿®é¥°<strong>æˆå‘˜å˜é‡</strong>ï¼Œç¡®ä¿å¤šçº¿ç¨‹é—´å˜é‡çš„å¯è§æ€§ã€‚</p><p><strong>ä¸ä¿è¯åŸå­æ€§</strong>ï¼Œå¦‚ <code>count++</code> ä»éœ€é…åˆ <code>synchronized</code> æˆ– <code>AtomicInteger</code>ã€‚</p><p>ä¸é€‚ç”¨äºå¤åˆæ“ä½œï¼ˆè¯»-æ”¹-å†™ï¼‰ã€‚</p><p><strong>ä¿è¯å˜é‡çš„å¯è§æ€§</strong>ï¼šä¸€ä¸ªçº¿ç¨‹ä¿®æ”¹äº†å€¼ï¼Œå…¶ä»–çº¿ç¨‹èƒ½ç«‹å³çœ‹åˆ°ã€‚</p><p><strong>ç¦æ­¢æŒ‡ä»¤é‡æ’åº</strong>ï¼šç”¨äºä¿è¯ä¸€å®šçš„æ‰§è¡Œé¡ºåºï¼Œé€‚åˆæ ‡å¿—ç±»å˜é‡ã€‚</p><p>volatileçš„å®ç°ç¡®å®éµå¾ª<strong>happens-before</strong>åŸåˆ™ã€‚happens-beforeåŸåˆ™æ˜¯Javaå†…å­˜æ¨¡å‹ä¸­çš„é‡è¦æ¦‚å¿µï¼Œå®ƒä¿è¯äº†volatileå†™æ“ä½œä¸€å®šhappens-beforeäºåç»­å¯¹è¿™ä¸ªvolatileå˜é‡çš„è¯»æ“ä½œã€‚</p><p><strong>volatileå…³é”®å­—æ˜¯Javaä¸­ç”¨äºä¿è¯å˜é‡å¯è§æ€§å’Œæœ‰åºæ€§çš„é‡è¦æœºåˆ¶ã€‚</strong></p><p>volatileå˜é‡åœ¨æ¯æ¬¡è¢«çº¿ç¨‹è®¿é—®æ—¶ï¼Œ<strong>éƒ½å¼ºåˆ¶ä»ä¸»å†…å­˜ä¸­é‡æ–°è¯»å–æœ€æ–°å€¼ï¼Œè€Œä¸æ˜¯ä½¿ç”¨çº¿ç¨‹å·¥ä½œå†…å­˜ä¸­çš„å€¼ã€‚è¿™ç¡®ä¿äº†å˜é‡çš„å¯è§æ€§ã€‚</strong></p><p>volatileå…³é”®å­—é€šè¿‡<strong>å†…å­˜å±éšœ(Memory Barrier)æ¥é˜»æ­¢æŒ‡ä»¤é‡æ’åº</strong>ã€‚å®ƒèƒ½ç¡®ä¿volatileå˜é‡è¯»å†™æ“ä½œçš„é¡ºåºæ€§ï¼Œé˜²æ­¢ç¼–è¯‘å™¨å’Œå¤„ç†å™¨å¯¹è¿™äº›æ“ä½œè¿›è¡Œé‡æ’åºä¼˜åŒ–ã€‚</p><p>volatileä¸èƒ½ä¿è¯çº¿ç¨‹å®‰å…¨ã€‚å®ƒåªèƒ½ä¿è¯å˜é‡çš„å¯è§æ€§å’Œç¦æ­¢æŒ‡ä»¤é‡æ’åºï¼Œä½†ä¸èƒ½ä¿è¯åŸå­æ€§ã€‚</p><p>volatileåªèƒ½ä¿è¯<strong>å¯è§æ€§å’Œæœ‰åºæ€§</strong>,<strong>æ— æ³•ä¿è¯äº’æ–¥æ€§å’ŒåŸå­æ€§</strong>ã€‚ä¾‹å¦‚count++è¿™æ ·çš„æ“ä½œ,volatileæ— æ³•ä¿è¯å…¶åŸå­æ€§,å› ä¸ºè¿™ä¸ªæ“ä½œå®é™…åŒ…å«è¯»å–ã€é€’å¢ã€å†™å…¥ä¸‰ä¸ªæ­¥éª¤ã€‚æ‰€ä»¥ä¸èƒ½åŒ…è£…çº¿ç¨‹å®‰å…¨</p><p>volatileåªèƒ½ç”¨äº<strong>ä¿®é¥°å˜é‡</strong>,ä¸èƒ½ä¿®é¥°æ–¹æ³•å’Œç±»ã€‚ä½œç”¨æ˜¯å‘Šè¯‰ç¼–è¯‘å™¨å’Œè™šæ‹Ÿæœºï¼Œ<strong>è¯¥å˜é‡å¯èƒ½ä¼šè¢«å¤šä¸ªçº¿ç¨‹åŒæ—¶è®¿é—®</strong>ï¼Œå› æ­¤ä¸åº”è¯¥è¿›è¡Œç¼–è¯‘å™¨ä¼˜åŒ–æˆ–ç¼“å­˜</p><h3 id="æ¥å£-amp-æŠ½è±¡ç±»"><a href="#æ¥å£-amp-æŠ½è±¡ç±»" class="headerlink" title="æ¥å£&amp;æŠ½è±¡ç±»"></a>æ¥å£&amp;æŠ½è±¡ç±»</h3><h4 id="æŠ½è±¡ç±»"><a href="#æŠ½è±¡ç±»" class="headerlink" title="æŠ½è±¡ç±»"></a>æŠ½è±¡ç±»</h4><p>æŠ½è±¡ç±»æ˜¯ä¸€ç§ç‰¹æ®Šçš„ç±»,å…¶æœ€<strong>æ˜¾è‘—çš„ç‰¹å¾å°±æ˜¯ä¸èƒ½è¢«å®ä¾‹åŒ–ã€‚æŠ½è±¡ç±»ä¸»è¦ç”¨äºè¢«å…¶ä»–ç±»ç»§æ‰¿</strong>,ä¸ºå­ç±»æä¾›é€šç”¨çš„å±æ€§å’Œæ–¹æ³•å®ç°,åŒæ—¶ä¹Ÿå¯ä»¥<strong>å£°æ˜æŠ½è±¡æ–¹æ³•è¦æ±‚å­ç±»å¿…é¡»å®ç°ã€‚</strong>åªæœ‰<strong>å½“å­ç±»æ˜¯éæŠ½è±¡ç±»æ—¶æ‰å¿…é¡»å®ç°æ‰€æœ‰æŠ½è±¡æ–¹æ³•</strong>ï¼Œå¦‚æœå­ç±»ä¹Ÿæ˜¯æŠ½è±¡ç±»åˆ™å¯ä»¥ä¸å®ç°çˆ¶ç±»çš„æŠ½è±¡æ–¹æ³•ã€‚</p><p>æŠ½è±¡ç±»ä¸­å¯ä»¥åŒ…å«æ™®é€šæ–¹æ³•,ä¹Ÿå¯ä»¥åŒ…å«æŠ½è±¡æ–¹æ³•,å¹¶ä¸è¦æ±‚æ‰€æœ‰æ–¹æ³•éƒ½æ˜¯æŠ½è±¡æ–¹æ³•ã€‚æŠ½è±¡ç±»ä¸­çš„æ™®é€šæ–¹æ³•å¯ä»¥æœ‰å…·ä½“çš„å®ç°ä»£ç ã€‚</p><p>ä¸€ä¸ªç±»å¯ä»¥è¢«å£°æ˜ä¸ºæŠ½è±¡ç±»ï¼Œ<strong>å³ä½¿å®ƒä¸åŒ…å«ä»»ä½•æŠ½è±¡æ–¹æ³•ã€‚è¿™ç§è®¾è®¡å¯ä»¥ç”¨æ¥é˜»æ­¢ç±»çš„å®ä¾‹åŒ–</strong></p><p>æŠ½è±¡ç±»å¯ä»¥æœ‰æ„é€ æ–¹æ³•ã€‚å°½ç®¡æŠ½è±¡ç±»ä¸èƒ½è¢«å®ä¾‹åŒ–,ä½†å…¶æ„é€ æ–¹æ³•å¯ä»¥è¢«å­ç±»é€šè¿‡super()è°ƒç”¨,ç”¨äºåˆå§‹åŒ–ä»æŠ½è±¡ç±»ç»§æ‰¿çš„å±æ€§ã€‚</p><p>æŠ½è±¡ç±»çš„ä¸»è¦ä½œç”¨æ˜¯ä½œä¸º<strong>åŸºç±»</strong>ä½¿ç”¨,é€šè¿‡<strong>ç»§æ‰¿å’Œå¤šæ€æœºåˆ¶</strong>å®ç°ä»£ç çš„å¤ç”¨å’Œæ‰©å±•ã€‚å®ƒæ—¢å¯ä»¥åŒ…å«æŠ½è±¡æ–¹æ³•å¼ºåˆ¶å­ç±»å®ç°,åˆå¯ä»¥æä¾›é€šç”¨æ–¹æ³•çš„å…·ä½“å®ç°,æ˜¯é¢å‘å¯¹è±¡ç¼–ç¨‹ä¸­é‡è¦çš„è®¾è®¡å·¥å…·ã€‚</p><h4 id="æ¥å£"><a href="#æ¥å£" class="headerlink" title="æ¥å£"></a>æ¥å£</h4><p>æ¥å£æ˜¯ä¸€ç§ç‰¹æ®Šçš„æŠ½è±¡ç±»å‹,å…¶ä¸­å®šä¹‰çš„æ–¹æ³•é»˜è®¤éƒ½æ˜¯public abstractçš„ã€‚åœ¨Javaæ¥å£ä¸­,æ–¹æ³•çš„ä¿®é¥°ç¬¦å…·æœ‰ä¸¥æ ¼çš„é™åˆ¶ã€‚</p><p>é»˜è®¤è®¿é—®æƒé™æ˜¯defaultï¼ˆåŒ…è®¿é—®æƒé™ï¼‰</p><p>æ¥å£å†…çš„å˜é‡éƒ½å…·æœ‰é»˜è®¤çš„ä¿®é¥°ç¬¦ï¼Œ<strong>ç­‰ä»·äºpublic static finalã€‚</strong></p><p>âŒ ä¸èƒ½å®šä¹‰æ„é€ æ–¹æ³•ï¼Œå°±æ˜¯æ–¹æ³•ä»–ä¹Ÿä¸èƒ½å®ç°ï¼Œä¸èƒ½ä½¿ç”¨å¤§æ‹¬å· å¯ä»¥ä½¿ç”¨static default privateæ–¹æ³•(jdk9)</p><p>âœ… åªèƒ½æ˜¯ <code>public static final</code> å¸¸é‡</p><p>æ¥å£ä¸­çš„æ–¹æ³•é»˜è®¤å°±æ˜¯publicå’Œabstractçš„ã€‚è¿™æ˜¯Javaæ¥å£çš„ç‰¹æ€§ï¼Œå³ä½¿ä¸æ˜¾å¼å£°æ˜è¿™äº›ä¿®é¥°ç¬¦ï¼Œç¼–è¯‘å™¨ä¹Ÿä¼šè‡ªåŠ¨æ·»åŠ ã€‚è¿™æ ·å¯ä»¥ç¡®ä¿æ¥å£æ–¹æ³•çš„å¯è®¿é—®æ€§å’ŒæŠ½è±¡æ€§ã€‚</p><div class="table-container"><table><thead><tr><th>ç‰¹æ€§</th><th>æ¥å£ï¼ˆinterfaceï¼‰</th><th>æŠ½è±¡ç±»ï¼ˆabstract classï¼‰</th></tr></thead><tbody><tr><td><strong>æ˜¯å¦å¯ä»¥å®ä¾‹åŒ–</strong></td><td>å¦</td><td>å¦</td></tr><tr><td><strong>æ˜¯å¦æ”¯æŒæ„é€ æ–¹æ³•</strong></td><td>âŒ ä¸èƒ½å®šä¹‰æ„é€ æ–¹æ³•</td><td>âœ… å¯ä»¥æœ‰æ„é€ æ–¹æ³•ï¼ˆç”¨äºå­ç±»æ„é€ æ—¶è°ƒç”¨ï¼‰</td></tr><tr><td><strong>æ˜¯å¦å¯ä»¥åŒ…å«æˆå‘˜å˜é‡</strong></td><td>âœ… åªèƒ½æ˜¯ <code>public static final</code> å¸¸é‡</td><td>âœ… å¯ä»¥æœ‰æ™®é€šå­—æ®µã€é™æ€å­—æ®µã€å¸¸é‡ç­‰</td></tr><tr><td><strong>æ˜¯å¦å¯ä»¥åŒ…å«æ–¹æ³•å®ç°</strong></td><td>âœ… ä» Java 8 å¼€å§‹ï¼šâ€” <code>default</code> é»˜è®¤æ–¹æ³•â€” <code>static</code> é™æ€æ–¹æ³•â€” Java 9 èµ·å…è®¸ <code>private</code> æ–¹æ³•</td><td>âœ… å¯ä»¥åŒ…å«æŠ½è±¡æ–¹æ³•ã€éæŠ½è±¡æ–¹æ³•ï¼ˆå³æœ‰æ–¹æ³•ä½“çš„ï¼‰</td></tr><tr><td><strong>ç»§æ‰¿æœºåˆ¶</strong></td><td>åªèƒ½ç»§æ‰¿æ¥å£ï¼ˆå¤šç»§æ‰¿ï¼‰éšå¼ç»§æ‰¿ <code>Object</code> çš„æ–¹æ³•ç­¾åï¼ˆå¦‚ <code>toString()</code>ï¼‰ï¼Œä½†ä¸ç»§æ‰¿å…¶å®ç°</td><td>åªèƒ½ç»§æ‰¿ä¸€ä¸ªæŠ½è±¡ç±»ï¼ˆå•ç»§æ‰¿ï¼‰æ˜¾å¼æˆ–éšå¼ç»§æ‰¿ <code>Object</code></td></tr><tr><td><strong>è®¿é—®ä¿®é¥°ç¬¦é™åˆ¶</strong></td><td>æ–¹æ³•é»˜è®¤æ˜¯ <code>public</code>ï¼Œä¸èƒ½æ˜¯ <code>protected</code>ã€<code>private</code>ï¼ˆJava 9 èµ·å¯ä»¥å®šä¹‰ <code>private</code> æ–¹æ³•ï¼‰</td><td>æ–¹æ³•ã€å­—æ®µå¯ä»¥ç”¨ <code>private</code>ã€<code>protected</code>ã€<code>public</code></td></tr><tr><td><strong>å…³é”®å­—çº¦æŸ</strong></td><td>é»˜è®¤æ–¹æ³•ç”¨ <code>default</code> ä¿®é¥°ï¼›æ‰€æœ‰å˜é‡è‡ªåŠ¨æ˜¯ <code>public static final</code></td><td>æŠ½è±¡æ–¹æ³•å¿…é¡»ä½¿ç”¨ <code>abstract</code> ä¿®é¥°ï¼›ç±»å¿…é¡»ç”¨ <code>abstract</code> ä¿®é¥°</td></tr><tr><td><strong>å®ç°/ç»§æ‰¿æ–¹å¼</strong></td><td>ä½¿ç”¨ <code>implements</code> å®ç°ä¸€ä¸ªæˆ–å¤šä¸ªæ¥å£</td><td>ä½¿ç”¨ <code>extends</code> ç»§æ‰¿æŠ½è±¡ç±»ï¼ˆåªèƒ½å•ç»§æ‰¿ï¼‰</td></tr><tr><td><strong>é€‚åˆåœºæ™¯</strong></td><td>å…³æ³¨â€œè§„èŒƒâ€ï¼Œç”¨äºå®šä¹‰è¡Œä¸ºæ¥å£ï¼Œå¼ºè°ƒèƒ½åŠ›çš„å®ç°ï¼ˆlike èƒ½è¯´è¯ã€èƒ½é£ï¼‰</td><td>å…³æ³¨â€œå…±æ€§â€ï¼Œç”¨äºæŠ½è±¡å‡ºå…±äº«ä»£ç æˆ–çŠ¶æ€ï¼ˆlike åŠ¨ç‰©æœ‰åå­—ã€åƒé¥­ç­‰ï¼‰</td></tr></tbody></table></div><h3 id="åŒ¿åå¯¹è±¡ç±»"><a href="#åŒ¿åå¯¹è±¡ç±»" class="headerlink" title="åŒ¿åå¯¹è±¡ç±»"></a>åŒ¿åå¯¹è±¡ç±»</h3><p>åŒ¿åå†…éƒ¨ç±»å¯ä»¥<strong>ç»§æ‰¿ä¸€ä¸ªç±»æˆ–å®ç°ä¸€ä¸ªæ¥å£</strong>ï¼Œå¹¶ä¸”å¯ä»¥é‡å†™çˆ¶ç±»çš„æ–¹æ³•<br>æ–¹æ³•é‡å†™æ—¶ï¼Œ<strong>å­ç±»æ–¹æ³•è¿”å›å€¼ç±»å‹ã€æ–¹æ³•åå’Œå‚æ•°å¿…é¡»ä¸çˆ¶ç±»ç›¸åŒ</strong><br>é€šè¿‡å¯¹è±¡è°ƒç”¨æ–¹æ³•æ—¶ï¼Œä¼˜å…ˆ<strong>è°ƒç”¨å¯¹è±¡å®é™…ç±»å‹ä¸­çš„æ–¹æ³•</strong>ï¼ˆåŠ¨æ€ç»‘å®šï¼‰</p><h2 id="å¯¹è±¡"><a href="#å¯¹è±¡" class="headerlink" title="å¯¹è±¡"></a>å¯¹è±¡</h2><p>å¯¹è±¡çš„å››ç§åˆ›å»ºæ–¹å¼</p><p>è¿™å››ç§æ–¹å¼å„æœ‰ç‰¹ç‚¹å’Œé€‚ç”¨åœºæ™¯:<br>- newæ“ä½œç¬¦é€‚ç”¨äºæ™®é€šå¯¹è±¡åˆ›å»º<br>- åå°„æ–¹å¼é€‚ç”¨äºåŠ¨æ€åŠ è½½åœºæ™¯<br>- cloneæ–¹å¼é€‚ç”¨äºå¯¹è±¡å¤åˆ¶åœºæ™¯<br>- ååºåˆ—åŒ–æ–¹å¼é€‚ç”¨äºæ•°æ®ä¼ è¾“åœºæ™¯</p><p>å®ä¾‹åŒ–å¯¹è±¡çš„é¡ºåºï¼š</p><p>çˆ¶ç±»ï¼¢<strong>é™æ€</strong>ä»£ç å—-&gt;å­ç±»ï¼¡é™æ€ä»£ç å—-&gt;çˆ¶ç±»ï¼¢éé™æ€ä»£ç å—-&gt;çˆ¶ç±»ï¼¢æ„é€ å‡½æ•°-&gt;å­ç±»ï¼¡éé™æ€ä»£ç å—-&gt;å­ç±»ï¼¡æ„é€ å‡½æ•°</p><ul><li><strong>é™æ€ä»£ç å—</strong>åªæ‰§è¡Œä¸€æ¬¡ï¼Œéšç±»åŠ è½½è€Œæ‰§è¡Œï¼›</li><li><strong>å®ä¾‹åˆå§‹åŒ–å—</strong>æ¯æ¬¡ new æ—¶æ‰§è¡Œï¼Œä¼˜å…ˆäºæ„é€ æ–¹æ³•ï¼›</li><li>æ„é€ æ–¹æ³•æœ€åæ‰§è¡Œï¼Œç”¨äºåˆå§‹åŒ–å¯¹è±¡æœ¬èº«ã€‚</li></ul><p>å‡½æ•°è°ƒç”¨çš„ä¸¤ç§ä¸»è¦å‚æ•°ä¼ é€’æ–¹å¼:<strong>ä¼ å€¼è°ƒç”¨</strong>(call by value)å’Œ<strong>å¼•ç”¨è°ƒç”¨</strong>(call by reference)çš„ç‰¹ç‚¹ã€‚</p><p>ä¼ å€¼è°ƒç”¨ä¿æŠ¤äº†<strong>å®é™…å‚æ•°ä¸è¢«ä¿®æ”¹</strong>,è€Œå¼•ç”¨è°ƒç”¨åˆ™å…è®¸é€šè¿‡å¼•ç”¨ä¿®æ”¹å®é™…å‚æ•°çš„å†…å®¹,<strong>ä½†ä¸èƒ½æ”¹å˜å¼•ç”¨æœ¬èº«æŒ‡å‘çš„åœ°å€</strong>ã€‚</p><h3 id="åå°„"><a href="#åå°„" class="headerlink" title="åå°„"></a>åå°„</h3><p><strong>åå°„æœºåˆ¶å…è®¸åœ¨è¿è¡Œæ—¶åŠ è½½ç±»ã€è®¿é—®å±æ€§ã€è°ƒç”¨æ–¹æ³•ã€æ„é€ å¯¹è±¡</strong>ã€‚</p><ul><li>è¿è¡Œæ—¶åŠ¨æ€æ“ä½œå¯¹è±¡</li><li>è§£è€¦åˆï¼Œæé«˜çµæ´»æ€§</li></ul><p>ä½¿ç”¨åœºæ™¯ï¼š</p><ul><li><strong>åˆ¤æ–­å¯¹è±¡æ‰€å±ç±»</strong>ï¼š<code>obj.getClass()</code> è·å–å¯¹è±¡çš„ Class å¯¹è±¡ã€‚</li><li><strong>åŠ è½½ç±»</strong>ï¼š<code>Class.forName(&quot;å…¨ç±»å&quot;)</code> åŠ¨æ€åŠ è½½ç±»ã€‚</li><li><strong>è·å–æ„é€ å™¨å¹¶å®ä¾‹åŒ–å¯¹è±¡</strong>ï¼š<code>clazz.getConstructor(...)</code> + <code>constructor.newInstance(...)</code></li><li><strong>è®¿é—®ç±»çš„æˆå‘˜å˜é‡å’Œæ–¹æ³•</strong>ï¼š<code>clazz.getDeclaredFields()</code>, <code>clazz.getDeclaredMethods()</code></li><li><strong>è°ƒç”¨å¯¹è±¡æ–¹æ³•</strong>ï¼š<code>method.invoke(obj, args...)</code></li><li><strong>è®¿é—®ç§æœ‰æˆå‘˜</strong>ï¼šé€šè¿‡ <code>setAccessible(true)</code> å–æ¶ˆè®¿é—®æ£€æŸ¥ã€‚+</li></ul><p>åå°„æœºåˆ¶<strong>å®é™…ä¸Šä¼šé™ä½ç¨‹åºçš„æ€§èƒ½</strong>,å› ä¸ºå®ƒéœ€è¦åœ¨è¿è¡Œæ—¶è¿›è¡Œç±»å‹æ£€æŸ¥å’Œè§£æã€‚åŒæ—¶,åå°„ä¹Ÿå¯èƒ½ç ´åå°è£…æ€§,å¸¦æ¥å®‰å…¨é£é™©,å› ä¸ºå®ƒå¯ä»¥è®¿é—®ç§æœ‰æˆå‘˜ã€‚</p><p>åå°„æœºåˆ¶ä¸ä»…å¯ä»¥è®¿é—®publicæˆå‘˜,é€šè¿‡s<strong>etAccessible(true)æ–¹æ³•</strong>,å®ƒè¿˜å¯ä»¥è®¿é—®privateã€protectedç­‰å…¶ä»–è®¿é—®æ§åˆ¶çº§åˆ«çš„æˆå‘˜ã€‚è¿™ä¹Ÿæ˜¯åå°„å¼ºå¤§ä½†éœ€è¦è°¨æ…ä½¿ç”¨çš„åŸå› ä¹‹ä¸€ã€‚è¿åäº†å°è£…æ€§</p><p>JAVAåå°„æœºåˆ¶ä¸»è¦æä¾›ä»¥ä¸‹åŠŸèƒ½ï¼š</p><p>åœ¨è¿è¡Œæ—¶åˆ¤æ–­ä¸€ä¸ªå¯¹è±¡æ‰€å±çš„ç±»</p><p>åœ¨è¿è¡Œæ—¶æ„é€ ä¸€ä¸ªç±»çš„å¯¹è±¡</p><p>åœ¨è¿è¡Œæ—¶åˆ¤æ–­ä¸€ä¸ªç±»æ‰€å…·æœ‰çš„æˆå‘˜å˜é‡å’Œæ–¹æ³•</p><p>åœ¨è¿è¡Œæ—¶è°ƒç”¨ä¸€ä¸ªå¯¹è±¡çš„æ–¹æ³•</p><div class="table-container"><table><thead><tr><th>ä¼˜ç‚¹</th><th>ç¼ºç‚¹</th></tr></thead><tbody><tr><td><strong>æé«˜ç¨‹åºçµæ´»æ€§å’Œæ‰©å±•æ€§</strong>ï¼Œæ”¯æŒåŠ¨æ€åŠ è½½ç±»å’Œè°ƒç”¨</td><td><strong>æ€§èƒ½è¾ƒæ…¢</strong>ï¼Œéœ€è¦ç»•è¿‡ JVM ä¼˜åŒ–ï¼Œå­˜åœ¨é¢å¤–å¼€é”€</td></tr><tr><td>æ”¯æŒæ¡†æ¶ã€å·¥å…·å®ç°é€šç”¨é€»è¾‘å’ŒåŠ¨æ€æ“ä½œ</td><td><strong>ç ´åå°è£…æ€§</strong>ï¼Œå¯è®¿é—®ç§æœ‰æˆå‘˜ï¼Œå¯èƒ½å¯¼è‡´å®‰å…¨é£é™©</td></tr><tr><td>æ”¯æŒåŠ¨æ€ä»£ç†ã€æ³¨è§£è§£æç­‰é«˜çº§åŠŸèƒ½</td><td><strong>ç¼–è¯‘æ—¶ç¼ºä¹ç±»å‹æ£€æŸ¥</strong>ï¼Œé”™è¯¯åªèƒ½è¿è¡Œæ—¶å‘ç°</td></tr></tbody></table></div><p>åå°„æ€§èƒ½ä¼˜åŒ–å»ºè®®ï¼š</p><ul><li><strong>é¿å…é¢‘ç¹è°ƒç”¨</strong>åå°„æ“ä½œï¼Œå°¤å…¶æ˜¯åœ¨çƒ­ç‚¹ä»£ç ä¸­ã€‚</li><li><strong>ç¼“å­˜åå°„çš„ Classã€Methodã€Field å¯¹è±¡</strong>ï¼Œå‡å°‘é‡å¤è§£æã€‚</li><li>ä½¿ç”¨ Java 8+ çš„ <code>MethodHandle</code> æˆ– <code>LambdaMetafactory</code> æ›¿ä»£ä¼ ç»Ÿåå°„è°ƒç”¨ï¼Œæå‡æ€§èƒ½ã€‚</li><li>åªåœ¨åˆå§‹åŒ–æˆ–é…ç½®é˜¶æ®µä½¿ç”¨åå°„ï¼Œä¸šåŠ¡é€»è¾‘ä¸­å°½é‡é¿å…ã€‚</li></ul><h3 id="åºåˆ—åŒ–"><a href="#åºåˆ—åŒ–" class="headerlink" title="åºåˆ—åŒ–"></a>åºåˆ—åŒ–</h3><p>åºåˆ—åŒ–æ˜¯å°†<strong>Javaå¯¹è±¡çš„çŠ¶æ€è½¬æ¢æˆå­—èŠ‚æµ</strong>çš„è¿‡ç¨‹ï¼Œæ–¹ä¾¿å¯¹è±¡çš„å­˜å‚¨ï¼ˆå¦‚å†™å…¥æ–‡ä»¶ï¼‰æˆ–ç½‘ç»œä¼ è¾“ã€‚ååºåˆ—åŒ–æ˜¯ä»å­—èŠ‚æµé‡æ„Javaå¯¹è±¡çš„è¿‡ç¨‹ã€‚</p><p>å¯¹è±¡æ‰€å±çš„ç±»å¿…é¡»å®ç°<code>java.io.Serializable</code>æ¥å£ã€‚</p><ul><li><strong>Serializableæ˜¯ä¸€ä¸ªæ ‡è®°æ¥å£</strong>ï¼Œä¸åŒ…å«ä»»ä½•æ–¹æ³•ï¼Œåªè¡¨ç¤ºè¯¥ç±»çš„å¯¹è±¡å¯ä»¥è¢«åºåˆ—åŒ–ã€‚</li></ul><p><strong>é™æ€å˜é‡å’Œtransientä¿®é¥°çš„æˆå‘˜å˜é‡ä¸ä¼šè¢«åºåˆ—åŒ–ã€‚</strong></p><p>ä¸ JSON/BSON åºåˆ—åŒ–ä¸åŒï¼ŒJava åºåˆ—åŒ–æ ¼å¼æ˜¯ <strong>äºŒè¿›åˆ¶ä¸å¯è¯»</strong></p><p>transientå…³é”®å­—ï¼š</p><p>ç”¨äºå£°æ˜ä¸éœ€è¦è¢«åºåˆ—åŒ–çš„å­—æ®µã€‚</p><p>åºåˆ—åŒ–æ—¶ï¼Œè¿™äº›å­—æ®µçš„å€¼ä¸ä¼šè¢«ä¿å­˜ã€‚</p><p>ååºåˆ—åŒ–åï¼Œtransientå­—æ®µè¢«èµ‹äºˆè¯¥ç±»å‹çš„é»˜è®¤å€¼ï¼š</p><ul><li>åŸºæœ¬ç±»å‹ï¼š0, falseç­‰</li><li>å¼•ç”¨ç±»å‹ï¼šnull</li></ul><p>æ­£ç¡®çš„åºåˆ—åŒ–æ“ä½œæ­¥éª¤ï¼š</p><ol><li>ç±»å®ç°<code>Serializable</code>æ¥å£ã€‚</li><li>åˆ›å»º<code>ObjectOutputStream</code>ï¼Œå¹¶åŒ…è£…ä¸€ä¸ªå­—èŠ‚è¾“å‡ºæµï¼ˆå¦‚<code>FileOutputStream</code>ï¼‰ã€‚</li><li>è°ƒç”¨<code>writeObject()</code>æ–¹æ³•ï¼Œå°†å¯¹è±¡å†™å‡ºã€‚</li><li>ååºåˆ—åŒ–æ—¶ä½¿ç”¨<code>ObjectInputStream</code>è°ƒç”¨<code>readObject()</code>ã€‚</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åºåˆ—åŒ–</span></span><br><span class="line"><span class="type">FileOutputStream</span> <span class="variable">fos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileOutputStream</span>(<span class="string">&quot;object.dat&quot;</span>);</span><br><span class="line"><span class="type">ObjectOutputStream</span> <span class="variable">oos</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectOutputStream</span>(fos);</span><br><span class="line">oos.writeObject(obj);</span><br><span class="line">oos.close();</span><br><span class="line"></span><br><span class="line"><span class="comment">// ååºåˆ—åŒ–</span></span><br><span class="line"><span class="type">FileInputStream</span> <span class="variable">fis</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileInputStream</span>(<span class="string">&quot;object.dat&quot;</span>);</span><br><span class="line"><span class="type">ObjectInputStream</span> <span class="variable">ois</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ObjectInputStream</span>(fis);</span><br><span class="line"><span class="type">Object</span> <span class="variable">obj</span> <span class="operator">=</span> ois.readObject();</span><br><span class="line">ois.close();</span><br><span class="line"></span><br></pre></td></tr></table></figure><div class="table-container"><table><thead><tr><th>é€‰é¡¹</th><th>è¯´æ˜</th><th>æ­£ç¡®ä¸å¦</th></tr></thead><tbody><tr><td>A</td><td>FileOutputStreamåªèƒ½å†™å­—èŠ‚æ•°æ®ï¼Œä¸èƒ½ç›´æ¥åºåˆ—åŒ–å¯¹è±¡</td><td>é”™è¯¯</td></tr><tr><td>B</td><td>PrintWriterå†™å­—ç¬¦æ–‡æœ¬ï¼Œä¸èƒ½è¿›è¡Œå¯¹è±¡åºåˆ—åŒ–</td><td>é”™è¯¯</td></tr><tr><td>C</td><td>transientä¿®é¥°çš„å˜é‡ä¸ä¼šè¢«åºåˆ—åŒ–ï¼Œååºåˆ—åŒ–åä¸ºé»˜è®¤å€¼</td><td>æ­£ç¡®</td></tr><tr><td>D</td><td>ç±»å¿…é¡»å®ç°Serializableæ¥å£æ‰èƒ½è¢«åºåˆ—åŒ–</td><td>æ­£ç¡®</td></tr></tbody></table></div><p>FileOutputStreamæ˜¯å­—èŠ‚æµ,å®ƒåªèƒ½å¤„ç†åŸå§‹å­—èŠ‚æ•°æ®çš„å†™å…¥,ä¸èƒ½ç›´æ¥åºåˆ—åŒ–å¯¹è±¡ã€‚è¦åºåˆ—åŒ–å¯¹è±¡,éœ€è¦ä½¿ç”¨<strong>ObjectOutputStream</strong>åŒ…è£…FileOutputStreamã€‚</p><p>PrintWriteræ˜¯å¤„ç†å­—ç¬¦æ•°æ®çš„è¾“å‡ºæµ,ä¸»è¦ç”¨äºå†™å…¥æ–‡æœ¬æ•°æ®,ä¸èƒ½ç›´æ¥è¿›è¡Œå¯¹è±¡åºåˆ—åŒ–ã€‚è¦åºåˆ—åŒ–å¯¹è±¡å¿…é¡»ä½¿ç”¨<strong>ObjectOutputStream</strong>ã€‚</p><h3 id="æ·±æ‹·è´-amp-æµ…æ‹·è´"><a href="#æ·±æ‹·è´-amp-æµ…æ‹·è´" class="headerlink" title="æ·±æ‹·è´&amp;æµ…æ‹·è´"></a>æ·±æ‹·è´&amp;æµ…æ‹·è´</h3><div class="table-container"><table><thead><tr><th>å¯¹æ¯”é¡¹</th><th>æµ…æ‹·è´ï¼ˆShallow Copyï¼‰</th><th>æ·±æ‹·è´ï¼ˆDeep Copyï¼‰</th></tr></thead><tbody><tr><td>æ‹·è´çº§åˆ«</td><td>æ‹·è´å¯¹è±¡æœ¬èº«+<strong>å¼•ç”¨åœ°å€</strong></td><td>æ‹·è´å¯¹è±¡æœ¬èº«+<strong>å¼•ç”¨å¯¹è±¡çš„å†…å®¹</strong></td></tr><tr><td>å¼•ç”¨å¯¹è±¡</td><td>åŸå¯¹è±¡ä¸å‰¯æœ¬<strong>å…±äº«å¼•ç”¨å¯¹è±¡</strong></td><td>å‰¯æœ¬æ‹¥æœ‰ç‹¬ç«‹çš„å¼•ç”¨å¯¹è±¡</td></tr><tr><td>é»˜è®¤å®ç°</td><td>Object.clone() é»˜è®¤æ˜¯æµ…æ‹·è´</td><td>éœ€æ‰‹åŠ¨å®ç°é€’å½’å¤åˆ¶</td></tr><tr><td>å½±å“</td><td>æ”¹å˜å‰¯æœ¬çš„å¼•ç”¨æˆå‘˜ï¼Œä¼šå½±å“åŸå¯¹è±¡</td><td>æ”¹å˜å‰¯æœ¬ä¸å½±å“åŸå¯¹è±¡</td></tr><tr><td>åº”ç”¨åœºæ™¯</td><td>è½»é‡å¯¹è±¡å¤åˆ¶ï¼Œæ€§èƒ½ä¼˜å…ˆ</td><td>è¦æ±‚å¯¹è±¡å®Œå…¨ç‹¬ç«‹ã€äº’ä¸å¹²æ‰°</td></tr></tbody></table></div><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">class Person implements Cloneable &#123;</span><br><span class="line">    String name;</span><br><span class="line">    Address address;</span><br><span class="line"></span><br><span class="line">    public Person clone() throws CloneNotSupportedException &#123;</span><br><span class="line">        // æµ…æ‹·è´</span><br><span class="line">        return (Person) super.clone();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public Person deepClone() throws CloneNotSupportedException &#123;</span><br><span class="line">        Person p = (Person) super.clone();</span><br><span class="line">        p.address = new Address(this.address.city); // æ‰‹åŠ¨å¤åˆ¶å¼•ç”¨ç±»å‹</span><br><span class="line">        return p;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="æ³›å‹"><a href="#æ³›å‹" class="headerlink" title="æ³›å‹"></a>æ³›å‹</h2><p><strong>æ³›å‹æ˜¯ä¸€ç§å‚æ•°åŒ–ç±»å‹æœºåˆ¶</strong>ï¼Œå…è®¸ç±»ã€æ¥å£ã€æ–¹æ³•åœ¨å®šä¹‰æ—¶ä½¿ç”¨ç±»å‹å‚æ•°ã€‚</p><p>ç›®çš„æ˜¯è®©ä»£ç æ›´åŠ <strong>ç±»å‹å®‰å…¨</strong>ã€<strong>å¯é‡ç”¨</strong>ï¼Œé¿å…é¢‘ç¹çš„ç±»å‹è½¬æ¢ã€‚</p><p>å¥½å¤„ï¼š</p><p><strong>ç¼–è¯‘æœŸç±»å‹æ£€æŸ¥</strong>ï¼Œæå‡ä»£ç å®‰å…¨æ€§ï¼Œé˜²æ­¢è¿è¡Œæ—¶ç±»å‹è½¬æ¢å¼‚å¸¸ï¼ˆClassCastExceptionï¼‰ã€‚ç¼–è¯‘æ—¶ä¼šè‡ªåŠ¨è£…ç®±æ‹†ç®±æ¥é…åˆåŸºæœ¬ç±»å‹çš„åŒ…è£…ç±»ã€‚</p><p><strong>é¿å…å¼ºåˆ¶ç±»å‹è½¬æ¢</strong>ï¼Œä»£ç æ›´ç®€æ´æ¸…æ™°ã€‚</p><p><strong>æé«˜ä»£ç å¤ç”¨æ€§</strong>ï¼ŒåŒä¸€ä»½ä»£ç å¯ä»¥å¤„ç†ä¸åŒç±»å‹çš„æ•°æ®ã€‚</p><p>ä¸èƒ½ç”¨äºï¼š<strong>åŸºæœ¬æ•°æ®ç±»å‹ï¼ˆå¦‚intã€doubleç­‰ï¼‰</strong>ï¼Œåªèƒ½ä½¿ç”¨å¯¹åº”çš„åŒ…è£…ç±»ï¼ˆIntegerã€Doubleç­‰ï¼‰ã€‚</p><p>æ³›å‹å¯ä»¥ç”¨äºæ•°ç»„çš„å¼•ç”¨ç±»å‹å£°æ˜ï¼Œä½†<strong>ä¸èƒ½ç›´æ¥åˆ›å»ºæ³›å‹æ•°ç»„å®ä¾‹</strong>ï¼ˆå¦‚<code>new T[]</code>ä¸åˆæ³•ï¼‰ã€‚</p><p>ç±»å‹æ“¦é™¤æœºåˆ¶ï¼š</p><p>Java æ³›å‹é‡‡ç”¨<strong>ç±»å‹æ“¦é™¤</strong>å®ç°ï¼Œæ³›å‹ä¿¡æ¯åœ¨ç¼–è¯‘åè¢«æ“¦é™¤ï¼Œæ³›å‹å˜é‡å˜ä¸ºåŸå§‹ç±»å‹ï¼ˆé€šå¸¸æ˜¯Objectæˆ–è¾¹ç•Œç±»å‹ï¼‰ã€‚</p><p>ç±»å‹æ“¦é™¤æ„å‘³ç€æ³›å‹çš„ç±»å‹ä¿¡æ¯<strong>åœ¨è¿è¡Œæ—¶ä¸å¯ç”¨</strong>ï¼Œè¿™é™åˆ¶äº†æ³›å‹åœ¨æŸäº›åœºæ™¯çš„åº”ç”¨ï¼ˆå¦‚æ— æ³•åˆ›å»ºæ³›å‹æ•°ç»„ã€æ— æ³•è¿›è¡Œç±»å‹åˆ¤æ–­ç­‰ï¼‰ã€‚</p><p>ä¸èƒ½ç›´æ¥åˆ›å»ºæ³›å‹æ•°ç»„çš„åŸå› ï¼š</p><p>æ³›å‹ç±»å‹åœ¨è¿è¡Œæ—¶è¢«æ“¦é™¤ä¸ºåŸå§‹ç±»å‹ï¼Œå¯¼è‡´<strong>åˆ›å»ºå‚æ•°åŒ–ç±»å‹çš„æ•°ç»„ä¼šäº§ç”Ÿç±»å‹å®‰å…¨éšæ‚£</strong>ã€‚</p><p>å› æ­¤åªèƒ½åˆ›å»ºåŸå§‹ç±»å‹æ•°ç»„ï¼Œæˆ–è€…åˆ›å»ºObjectæ•°ç»„å†å¼ºåˆ¶è½¬æ¢ï¼ˆä¸å®‰å…¨ï¼‰ã€‚</p><p>ä½†æ˜¯ï¼Œå¯ä»¥å£°æ˜æ³›å‹æ•°ç»„çš„å¼•ç”¨å˜é‡ï¼Œå¦‚<code>List&lt;String&gt;[] array</code>æ˜¯å…è®¸çš„ã€‚</p><div class="table-container"><table><thead><tr><th>ç‰¹æ€§</th><th>è¯´æ˜</th></tr></thead><tbody><tr><td>ç±»å‹å‚æ•°</td><td>æ³›å‹åªèƒ½æ˜¯å¼•ç”¨ç±»å‹ï¼Œä¸æ”¯æŒåŸºæœ¬æ•°æ®ç±»å‹</td></tr><tr><td>ç±»å‹æ“¦é™¤</td><td>ç¼–è¯‘åæ³›å‹ç±»å‹è¢«æ“¦é™¤ä¸ºåŸå§‹ç±»å‹ï¼Œè¿è¡Œæ—¶æ³›å‹ä¿¡æ¯ä¸å¯ç”¨</td></tr><tr><td>é€‚ç”¨èŒƒå›´</td><td>ç±»ã€æ¥å£ã€æ–¹æ³•å‡æ”¯æŒæ³›å‹</td></tr><tr><td>æ³›å‹æ•°ç»„</td><td>ä¸èƒ½åˆ›å»ºæ³›å‹æ•°ç»„å®ä¾‹ï¼Œä½†å¯ä»¥å£°æ˜æ³›å‹æ•°ç»„ç±»å‹çš„å˜é‡</td></tr><tr><td>è£…ç®±ä¸æ‹†ç®±</td><td>åŸºæœ¬ç±»å‹é€šè¿‡åŒ…è£…ç±»å®ç°ä¸æ³›å‹å…¼å®¹</td></tr><tr><td>ç±»å‹é™åˆ¶</td><td>æ”¯æŒä¸Šé™ï¼ˆextendsï¼‰ã€ä¸‹é™ï¼ˆsuperï¼‰</td></tr><tr><td>ç¼–è¯‘æœŸæ£€æŸ¥</td><td>æ³›å‹æä¾›é™æ€ç±»å‹å®‰å…¨ä¿éšœï¼Œé¿å…è¿è¡Œæ—¶ç±»å‹é”™è¯¯</td></tr></tbody></table></div><h2 id="å¼‚å¸¸"><a href="#å¼‚å¸¸" class="headerlink" title="å¼‚å¸¸"></a>å¼‚å¸¸</h2><p>Javaä¸­æ‰€æœ‰å¼‚å¸¸å’Œé”™è¯¯çš„åŸºç±»æ˜¯java.lang.Throwableã€‚å…¶ä¸­ï¼š</p><p>- Errorå’ŒExceptionéƒ½ç»§æ‰¿è‡ªThrowable<br>- RuntimeExceptionæ˜¯Exceptionçš„å­ç±»</p><p>java.lang.Throwable<br> â”œâ”€â”€ Error ï¼ˆç³»ç»Ÿé”™è¯¯ï¼Œé€šå¸¸ä¸æ•è·ï¼‰<br> â””â”€â”€ Exception<br>      â”œâ”€â”€ RuntimeExceptionï¼ˆéå—æ£€å¼‚å¸¸ï¼Œä¸å¼ºåˆ¶æ•è·ï¼‰<br>      â”‚    â”œâ”€ NullPointerException<br>      â”‚    â”œâ”€ ClassCastException<br>      â”‚    â”œâ”€ ArrayIndexOutOfBoundsException<br>      â”‚    â””â”€ ArithmeticException<br>      â””â”€â”€ å—æ£€å¼‚å¸¸ï¼ˆå¿…é¡»æ•è·æˆ–å£°æ˜ï¼‰<br>           â”œâ”€ IOException<br>           â”‚    â””â”€ FileNotFoundException<br>           â””â”€ NoSuchMethodException</p><p>error:</p><p>ä»£è¡¨JVMçº§åˆ«çš„é”™è¯¯æˆ–èµ„æºè€—å°½ï¼Œå¦‚ï¼š</p><ul><li><code>StackOverflowError</code>ï¼ˆæ ˆæº¢å‡ºï¼‰</li><li><code>OutOfMemoryError</code>ï¼ˆå†…å­˜æº¢å‡ºï¼‰</li></ul><p>é€šå¸¸æ˜¯ä¸¥é‡é”™è¯¯ï¼Œç¨‹åºä¸åº”æ•è·ï¼Œæ— æ³•æ¢å¤ã€‚</p><p> Exception:</p><p>å—æ£€å¼‚å¸¸ï¼ˆChecked Exceptionï¼‰:</p><p>ç»§æ‰¿è‡ª<code>Exception</code>ï¼Œä½†<strong>ä¸ç»§æ‰¿</strong><code>RuntimeException</code>ã€‚</p><p>å¿…é¡»è¢«æ˜¾å¼å¤„ç†ï¼šç”¨<code>try-catch</code>æ•è·ï¼Œæˆ–åœ¨æ–¹æ³•ç­¾åä¸­ç”¨<code>throws</code>å£°æ˜ã€‚</p><p>é€šå¸¸è¡¨ç¤º<strong>ç¨‹åºå¤–éƒ¨é—®é¢˜</strong>ï¼Œå¦‚æ–‡ä»¶I/Oã€ç½‘ç»œé”™è¯¯ç­‰ã€‚</p><p>å…¸å‹ä¾‹å­ï¼š</p><ul><li><code>IOException</code></li><li><code>FileNotFoundException</code>ï¼ˆ<code>IOException</code>å­ç±»ï¼‰</li><li><code>NoSuchMethodException</code></li></ul><p>ç¼–è¯‘å™¨ä¼šæ£€æŸ¥è¿™äº›å¼‚å¸¸çš„å¤„ç†ï¼Œç¡®ä¿ç¨‹åºå¥å£®ã€‚</p><p>éå—æ£€å¼‚å¸¸ï¼ˆUnchecked Exceptionï¼‰:</p><ul><li><p>ç»§æ‰¿è‡ª<code>RuntimeException</code>ã€‚</p></li><li><p><strong>ä¸å¼ºåˆ¶å¤„ç†</strong>ï¼Œå¯é€‰æ‹©æ•è·ã€‚</p></li><li><p>ä»£è¡¨ç¨‹åºé”™è¯¯ï¼Œå¦‚é€»è¾‘æ¼æ´ã€ç¼–ç¨‹é”™è¯¯ã€‚</p></li><li><p>å¸¸è§å¼‚å¸¸ï¼š</p><ul><li><code>NullPointerException</code>ï¼šç©ºæŒ‡é’ˆè®¿é—®</li><li><code>ArrayIndexOutOfBoundsException</code>ï¼šæ•°ç»„è¶Šç•Œ</li><li><code>ClassCastException</code>ï¼šç±»å‹è½¬æ¢å¼‚å¸¸</li><li><code>ArithmeticException</code>ï¼šç®—æœ¯å¼‚å¸¸ï¼ˆå¦‚é™¤0ï¼‰</li></ul></li></ul><div class="table-container"><table><thead><tr><th>å¼‚å¸¸ç±»å‹</th><th>æ˜¯å¦å¿…é¡»å¤„ç†</th><th>å…¸å‹ç¤ºä¾‹</th><th>å¤„ç†æ–¹å¼</th></tr></thead><tbody><tr><td>Error</td><td>ä¸éœ€è¦ä¸”ä¸æ¨è</td><td>StackOverflowError, OutOfMemoryError</td><td>ä¸€èˆ¬ä¸æ•è·</td></tr><tr><td>å—æ£€å¼‚å¸¸</td><td>å¿…é¡»å¤„ç†</td><td>IOException, FileNotFoundException</td><td>try-catchæˆ–throwså£°æ˜</td></tr><tr><td>è¿è¡Œæ—¶å¼‚å¸¸</td><td>ä¸å¼ºåˆ¶å¿…é¡»å¤„ç†</td><td>NullPointerException, ArrayIndexOutOfBoundsException</td><td>å¯æ•è·ä¹Ÿå¯å¿½ç•¥ï¼Œåº”è¯¥é€šè¿‡ä»£ç é€»è¾‘é¿å…</td></tr></tbody></table></div><p><strong>å¼‚å¸¸å¤„ç†é¡ºåºåŸåˆ™:</strong></p><p>â€œå…ˆå…·ä½“åç¬¼ç»Ÿâ€</p><p>å¤šé‡catchè¯­å¥åº”éµå¾ª<strong>â€œå…ˆå…·ä½“å¼‚å¸¸åçˆ¶ç±»å¼‚å¸¸â€</strong>åŸåˆ™ã€‚</p><p>ä¾‹å¦‚ï¼Œå…ˆæ•è·<code>FileNotFoundException</code>ï¼Œå†æ•è·<code>IOException</code>ï¼Œæœ€åæ•è·<code>Exception</code>ã€‚</p><p>å¦åˆ™ï¼Œå­ç±»å¼‚å¸¸æ°¸è¿œä¸ä¼šè¢«æ•è·ï¼Œé€ æˆç¼–è¯‘é”™è¯¯ã€‚</p><div class="table-container"><table><thead><tr><th>è¯¯åŒºæè¿°</th><th>æ­£ç¡®è¯´æ˜</th></tr></thead><tbody><tr><td><code>Error</code>å¯ä»¥è¢«æ•è·ä¸”å»ºè®®å¤„ç†</td><td>è™½ç„¶å¯ä»¥æ•è·ï¼Œä½†é€šå¸¸ä¸å»ºè®®æ•è·ï¼Œé”™è¯¯å¤šä¸ºä¸å¯æ¢å¤çš„ä¸¥é‡é—®é¢˜ã€‚</td></tr><tr><td>è¿è¡Œæ—¶å¼‚å¸¸å¿…é¡»ç”¨try-catchæ•è·</td><td>ä¸å¿…é¡»ï¼Œè¿è¡Œæ—¶å¼‚å¸¸ä¸å¼ºåˆ¶æ•è·ï¼Œå»ºè®®é€šè¿‡ä»£ç é€»è¾‘é¿å…ã€‚</td></tr><tr><td>æ‰€æœ‰å¼‚å¸¸éƒ½ç»§æ‰¿è‡ªException</td><td>ä¸å¯¹ï¼ŒErrorå’ŒExceptionéƒ½ç»§æ‰¿è‡ªThrowableã€‚</td></tr><tr><td><code>FileNotFoundException</code>ä¸æ˜¯å—æ£€å¼‚å¸¸</td><td>é”™è¯¯ï¼Œå®ƒæ˜¯IOExceptionå­ç±»ï¼Œæ˜¯å—æ£€å¼‚å¸¸ã€‚</td></tr><tr><td>å¤šä¸ªcatchçš„é¡ºåºæ— å…³ç´§è¦</td><td>é”™è¯¯ï¼Œå¿…é¡»å…ˆæ•è·å­ç±»å¼‚å¸¸ï¼Œå†æ•è·çˆ¶ç±»å¼‚å¸¸ã€‚</td></tr></tbody></table></div><h1 id="é›†åˆ"><a href="#é›†åˆ" class="headerlink" title="é›†åˆ"></a>é›†åˆ</h1><p>é›†åˆä½“ç³»åˆ†ä¸ºä¸‰å¤§éƒ¨åˆ†ï¼š</p><ul><li><strong>Collection æ¥å£æ—</strong>ï¼šListã€Setã€Queue</li><li><strong>Map æ¥å£æ—</strong>ï¼šHashMapã€TreeMapã€ConcurrentHashMap</li><li><strong>å·¥å…·ç±»</strong>ï¼šCollectionsã€Arraysã€Objects</li></ul><h2 id="Collection"><a href="#Collection" class="headerlink" title="Collection"></a>Collection</h2><h3 id="list"><a href="#list" class="headerlink" title="list"></a>list</h3><p>æœ‰åºã€å¯é‡å¤ï¼Œæ”¯æŒæŒ‰ç´¢å¼•è®¿é—®ã€‚</p><p><strong>ArrayList</strong></p><ul><li><strong>åº•å±‚ç»“æ„</strong>ï¼šåŠ¨æ€æ•°ç»„ï¼ˆObject[]ï¼‰</li><li><strong>æ˜¯å¦çº¿ç¨‹å®‰å…¨</strong>ï¼šå¦ï¼ˆä½¿ç”¨ <code>Collections.synchronizedList</code> æˆ– <code>CopyOnWriteArrayList</code>ï¼‰</li><li><strong>è®¿é—®å¿«ï¼Œæ’å…¥åˆ é™¤æ…¢</strong></li><li><strong>é»˜è®¤åˆå§‹å®¹é‡</strong>ï¼š10ï¼Œæ‰©å®¹ä¸ºåŸå®¹é‡çš„ <strong>1.5 å€</strong></li></ul><p><strong>ä¸ºä»€ä¹ˆ ArrayList é»˜è®¤æ‰©å®¹æœºåˆ¶æ˜¯æ‰©å®¹ä¸ºåŸæ•°ç»„çš„ 1.5 å€ï¼Ÿ</strong></p><ul><li><p>ArrayList çš„æ‰©å®¹æœºåˆ¶æ˜¯ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">newCapacity = oldCapacity + (oldCapacity &gt;&gt; <span class="number">1</span>); <span class="comment">// å³1.5å€</span></span><br></pre></td></tr></table></figure></li><li><p><strong>å…¼é¡¾æ€§èƒ½ä¸å†…å­˜æµªè´¹çš„å¹³è¡¡</strong>ï¼š</p><ul><li>å°æ‰©å®¹é¢‘ç¹è¿ç§»ï¼Œæ•ˆç‡ä½</li><li>å¤§æ‰©å®¹æµªè´¹å†…å­˜</li><li><strong>1.5 å€æ˜¯ç»éªŒæƒè¡¡ç»“æœ</strong>ï¼Œæ¯” Hashtable çš„ 2 å€æ›´èŠ‚çœç©ºé—´</li></ul></li><li><p><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šè¯»å¤šå†™å°‘ã€é¢‘ç¹éšæœºè®¿é—®</p></li></ul><p><strong>å†™æ—¶å¤åˆ¶æœºåˆ¶ï¼ˆCopy-On-Writeï¼‰</strong>ï¼š</p><ul><li>æ¯æ¬¡å†™æ“ä½œï¼ˆå¦‚ addã€removeï¼‰ä¼šï¼š<ul><li>å¤åˆ¶å½“å‰æ•°ç»„</li><li>åœ¨æ–°æ•°ç»„ä¸Šä¿®æ”¹</li><li>æ›¿æ¢åŸæ•°ç»„å¼•ç”¨</li></ul></li></ul><p>ä¼˜ç‚¹ï¼š</p><ul><li>è¯»æ“ä½œæ— éœ€åŠ é”ï¼Œ<strong>è¯»å†™åˆ†ç¦»ï¼Œè¯»æ€§èƒ½é«˜</strong></li></ul><p>ç¼ºç‚¹ï¼š</p><ul><li>å†™æ“ä½œå¼€é”€å¤§ï¼Œä¸é€‚åˆå†™å¤šè¯»å°‘åœºæ™¯</li></ul><p><strong>LinkedList</strong></p><p>åŸºäº <strong>åŒå‘é“¾è¡¨</strong> å®ç°ã€‚åœ¨ä¸­é—´æ’å…¥æˆ–åˆ é™¤å…ƒç´ åªéœ€è¦æ”¹å˜ç›¸é‚»èŠ‚ç‚¹çš„å¼•ç”¨,<strong>æ“ä½œå¼€é”€æ˜¯å›ºå®šçš„ã€‚</strong></p><p>æ’å…¥å’Œåˆ é™¤æ“ä½œæ•ˆç‡é«˜ï¼Œ<strong>é€‚ç”¨äºé¢‘ç¹æ’å…¥/åˆ é™¤çš„åœºæ™¯</strong>ã€‚è¦è®¿é—®ä»»æ„ä½ç½®çš„å…ƒç´ <strong>å¿…é¡»ä»å¤´èŠ‚ç‚¹æˆ–å°¾èŠ‚ç‚¹éå†</strong>,ä¸èƒ½åƒæ•°ç»„é‚£æ ·ç›´æ¥é€šè¿‡ç´¢å¼•è®¿é—®,å› æ­¤ä¸æ”¯æŒé«˜æ•ˆçš„éšæœºè®¿é—®ã€‚</p><p><strong>æ”¯æŒ null å’Œé‡å¤å…ƒç´ </strong>ã€‚</p><p>æ’å…¥é¡ºåºå³éå†é¡ºåºã€‚</p><p><strong>è®¿é—®å…ƒç´ æ€§èƒ½ä¸å¦‚ ArrayList</strong>ï¼ˆéœ€è¦ä»å¤´/å°¾éå†ï¼‰ã€‚</p><p>å®ç°äº† <code>Deque</code> æ¥å£ï¼Œå¯ä½œä¸ºé˜Ÿåˆ—æˆ–æ ˆä½¿ç”¨ã€‚</p><p><strong>ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„</strong>ã€‚</p><p><strong>Vector</strong></p><p>åŸºäº <strong>æ•°ç»„å®ç°çš„åŠ¨æ€æ•°ç»„</strong>ã€‚</p><p><strong>çº¿ç¨‹å®‰å…¨</strong>ï¼Œæ‰€æœ‰æ–¹æ³•éƒ½ç”¨ <code>synchronized</code> ä¿®é¥°ã€‚</p><p>çº¿ç¨‹å®‰å…¨å¯¼è‡´æ€§èƒ½è¾ƒä½ï¼Œ<strong>ä¸æ¨èåœ¨æ–°é¡¹ç›®ä¸­ä½¿ç”¨</strong>ï¼Œæ¨èä½¿ç”¨ <code>ArrayList + æ˜¾å¼åŒæ­¥</code>ã€‚</p><p><strong>å…è®¸ null å’Œé‡å¤å…ƒç´ </strong>ã€‚</p><p><strong>æ˜¯stackçš„çˆ¶ç±»</strong></p><h3 id="Set"><a href="#Set" class="headerlink" title="Set"></a>Set</h3><p><strong>hashset</strong></p><p>å…ƒç´ å”¯ä¸€ï¼Œä¸å…è®¸é‡å¤ã€‚</p><p>ashSetæ˜¯åŸºäºHashMapå®ç°çš„æ— åºé›†åˆ,ä¸ä¿è¯å…ƒç´ çš„é¡ºåº</p><p><strong>ä¸å…è®¸é‡å¤å…ƒç´ </strong>ï¼ˆæ ¹æ® <code>equals()</code> å’Œ <code>hashCode()</code> åˆ¤æ–­ï¼‰ã€‚</p><p><strong>ä¸ä¿è¯å…ƒç´ é¡ºåº</strong>ã€‚</p><p><strong>å…è®¸ null å…ƒç´ </strong>ï¼Œæœ€å¤šä¸€ä¸ªã€‚</p><p><strong>çº¿ç¨‹ä¸å®‰å…¨</strong>ã€‚</p><p>HashSetä½œä¸ºJavaé›†åˆæ¡†æ¶ä¸­çš„ä¸€ä¸ªé‡è¦å®ç°ç±»,é€šè¿‡<strong>hashCode()å’Œequals()</strong>è¿™ä¸¤ä¸ªæ–¹æ³•çš„ç»„åˆæ¥ç¡®ä¿å…ƒç´ çš„å”¯ä¸€æ€§ã€‚è¿™æ˜¯å› ä¸ºHashSet<strong>å†…éƒ¨å®é™…ä½¿ç”¨HashMapæ¥å­˜å‚¨</strong>æ•°æ®,å…¶ä¸­<strong>å…ƒç´ çš„hashCodeå€¼ç”¨äºç¡®å®šå­˜å‚¨ä½ç½®,è€Œequalsæ–¹æ³•åˆ™ç”¨äºå¤„ç†hashå†²çªæ—¶çš„æ¯”è¾ƒã€‚</strong></p><p>å…·ä½“å·¥ä½œæµç¨‹æ˜¯:<br>\1. å½“æ·»åŠ å…ƒç´ æ—¶,å…ˆè°ƒç”¨hashCode()æ–¹æ³•è®¡ç®—å…ƒç´ çš„å“ˆå¸Œå€¼<br>\2. æ ¹æ®å“ˆå¸Œå€¼ç¡®å®šå…ƒç´ åœ¨HashSetä¸­çš„å­˜å‚¨ä½ç½®<br>\3. å¦‚æœå‘ç”Ÿhashå†²çª,åˆ™è°ƒç”¨equals()æ–¹æ³•åˆ¤æ–­å…ƒç´ æ˜¯å¦çœŸæ­£ç›¸ç­‰</p><p><strong>linkedHashSet</strong></p><p>LinkedHashSetåœ¨<strong>HashSetçš„åŸºç¡€ä¸Šå¢åŠ äº†ä¸€ä¸ªåŒå‘é“¾è¡¨</strong>æ¥ç»´æŠ¤å…ƒç´ çš„æ’å…¥é¡ºåº,å› æ­¤æ˜¯æœ‰åºçš„ã€‚</p><p><strong>æœ‰åºé›†åˆ</strong>ï¼Œè¿­ä»£é¡ºåºä¸ºæ’å…¥é¡ºåºã€‚</p><p>æ’å…¥ã€åˆ é™¤ã€æŸ¥æ‰¾æ“ä½œæ—¶é—´å¤æ‚åº¦ä»ä¸º <strong>O(1)</strong>ã€‚</p><p><strong>Treeset</strong></p><p>TreeMapåŸºäº<strong>çº¢é»‘æ ‘</strong>å®ç°,å¯ä»¥ä¿è¯é”®çš„è‡ªç„¶é¡ºåºæˆ–æŒ‡å®šé¡ºåº</p><p>ä¿è¯<strong>é”®çš„æœ‰åºæ€§</strong>ï¼š</p><ul><li>é»˜è®¤æŒ‰é”®çš„ <strong>è‡ªç„¶é¡ºåºï¼ˆComparableï¼‰</strong> æ’åºã€‚</li><li>æˆ–ä½¿ç”¨æ„é€ å‡½æ•°ä¼ å…¥çš„ <strong>Comparator</strong> è‡ªå®šä¹‰æ’åºã€‚</li></ul><p><strong>é”®å¿…é¡»å®ç° Comparable æ¥å£æˆ–æä¾› Comparator</strong>ã€‚</p><p>æŸ¥è¯¢ã€æ’å…¥ã€åˆ é™¤æ“ä½œæ—¶é—´å¤æ‚åº¦ä¸º <strong>O(log n)</strong>ã€‚</p><p><strong>ä¸å…è®¸ null é”®</strong>ï¼ˆä¼šæŠ› <code>NullPointerException</code>ï¼‰ï¼Œä½†å…è®¸ null å€¼ã€‚</p><p><strong>çº¿ç¨‹ä¸å®‰å…¨</strong>ã€‚</p><h2 id="Map"><a href="#Map" class="headerlink" title="Map"></a>Map</h2><p>é”®å€¼å¯¹å­˜å‚¨ï¼Œkey å”¯ä¸€ï¼Œvalue å¯é‡å¤ã€‚</p><p><strong>Hashmap</strong></p><p><strong>åº•å±‚ç»“æ„</strong>ï¼šæ•°ç»„ + é“¾è¡¨ï¼ˆJDK 1.7ï¼‰æˆ–æ•°ç»„ + é“¾è¡¨/çº¢é»‘æ ‘ï¼ˆJDK 1.8+ï¼‰</p><p><strong>é»˜è®¤åˆå§‹å®¹é‡</strong>ï¼š16ï¼Œè´Ÿè½½å› å­ 0.75ï¼Œæ‰©å®¹ä¸ºåŸå®¹é‡çš„ 2 å€</p><p><strong>çº¿ç¨‹ä¸å®‰å…¨</strong></p><p><strong>å…è®¸ä¸€ä¸ª null é”®ï¼Œå¤šä¸ª null å€¼</strong></p><p><strong>hash å†²çªå¤„ç†</strong>ï¼šé“¾åœ°å€æ³•ï¼Œé“¾è¡¨è¶…è¿‡ 8 è½¬çº¢é»‘æ ‘</p><p>HashMapçš„ä¸»è¦ç‰¹ç‚¹ï¼š<br>\1. <strong>å…è®¸nullé”®å’Œnullå€¼</strong><br>\2. <strong>ä¸ä¿è¯å…ƒç´ çš„é¡ºåº</strong><br>\3. éçº¿ç¨‹å®‰å…¨<br>\4. æŸ¥æ‰¾æ•ˆç‡é«˜,æ—¶é—´å¤æ‚åº¦æ¥è¿‘O(1)<br>\5. <strong>é”®å¿…é¡»æ˜¯å”¯ä¸€çš„,è€Œå€¼å¯ä»¥é‡å¤</strong></p><p>HashMapä¸­è§£å†³å“ˆå¸Œå†²çªé‡‡ç”¨çš„æ˜¯<strong>é“¾åœ°å€æ³•(æ‹‰é“¾æ³•)</strong>,è€Œä¸æ˜¯å¼€æ”¾åœ°å€æ³•</p><p>åœ¨HashMapçš„å®ç°ä¸­,å½“<strong>å¤šä¸ªkeyçš„å“ˆå¸Œå€¼æ˜ å°„åˆ°æ•°ç»„çš„åŒä¸€ä¸ªä½ç½®æ—¶</strong>,HashMapä¼šåœ¨<strong>è¯¥ä½ç½®æ„å»ºä¸€ä¸ªé“¾è¡¨</strong>(JDK1.8ä¹‹ååœ¨é“¾è¡¨é•¿åº¦è¶…è¿‡8æ—¶ä¼šè½¬æ¢ä¸ºçº¢é»‘æ ‘)<strong>æ¥å­˜å‚¨æ‰€æœ‰æ˜ å°„åˆ°è¯¥ä½ç½®çš„Entry</strong>ã€‚è¿™ç§æ–¹å¼å°±æ˜¯é“¾åœ°å€æ³•ã€‚</p><p>HashMapçš„åº•å±‚ç¡®å®ä½¿ç”¨<strong>Entryæ•°ç»„(åœ¨JDK1.8ä¸­æ”¹åä¸ºNodeä½†æœ¬è´¨ç›¸åŒ)</strong>å­˜å‚¨é”®å€¼å¯¹ã€‚æ¯ä¸ªEntryåŒ…å«keyã€valueã€nextæŒ‡é’ˆç­‰ä¿¡æ¯ã€‚</p><p><strong>HashMap çš„æ·»åŠ å…ƒç´ æµç¨‹</strong></p><ol><li>è®¡ç®— key çš„ hash å€¼ï¼Œå®šä½æ•°ç»„ç´¢å¼•</li><li>è‹¥è¯¥ç´¢å¼•ä¸ºç©ºï¼Œç›´æ¥æ’å…¥èŠ‚ç‚¹</li><li>è‹¥å­˜åœ¨å†²çªï¼ˆå“ˆå¸Œç¢°æ’ï¼‰ï¼š<ul><li>ä½¿ç”¨é“¾è¡¨æˆ–çº¢é»‘æ ‘è¿›è¡Œå­˜å‚¨</li></ul></li><li><p>æ·»åŠ å…ƒç´ åï¼Œåˆ¤æ–­æ˜¯å¦è¶…è¿‡é˜ˆå€¼ï¼ˆ<code>å®¹é‡ Ã— è´Ÿè½½å› å­</code>ï¼‰ï¼š</p><ul><li>è‹¥è¶…è¿‡ï¼Œ<strong>è§¦å‘æ‰©å®¹</strong></li></ul><p><strong>HashMap æ‰©å®¹åŠ è½½å› å­ä¸ºä»€ä¹ˆæ˜¯ 0.75ï¼Ÿ</strong></p></li></ol><p><strong>0.75 æ˜¯ç»éªŒå€¼</strong>ï¼Œåœ¨<strong>æ—¶é—´æ•ˆç‡ï¼ˆæŸ¥æ‰¾é€Ÿåº¦ï¼‰å’Œç©ºé—´åˆ©ç”¨ç‡ä¹‹é—´å–å¾—å¹³è¡¡</strong>ã€‚</p><p>å¤ªä½ä¼šæµªè´¹å†…å­˜ï¼Œå¤ªé«˜ä¼šå¢åŠ å“ˆå¸Œç¢°æ’ã€‚</p><p> <strong>HashMap æ‰©å®¹ä¸ºä»€ä¹ˆæ‰©å®¹ä¸ºæ•°ç»„é•¿åº¦çš„ 2 å€ï¼Ÿ</strong></p><p>æ—§é•¿åº¦ä¸º <code>n</code>ï¼Œæ–°é•¿åº¦ä¸º <code>2n</code>ï¼š</p><ul><li>åŸ hash å€¼ä¸æ–°å®¹é‡ <code>&amp;</code> è®¡ç®—æ—¶ï¼Œ<strong>å…ƒç´ ä½ç½®è¦ä¹ˆä¿æŒä¸å˜ï¼Œè¦ä¹ˆç§»åŠ¨åˆ° <code>index + n</code></strong>ã€‚</li></ul><p>è¿™æ ·å¯ä»¥<strong>é¿å…é‡æ–°è®¡ç®— hashï¼Œæé«˜æ‰©å®¹æ•ˆç‡</strong></p><p>hashmapå¹¶ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œ</p><p>å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ä½¿ç”¨ï¼š</p><ul><li><code>ConcurrentHashMap</code></li><li><code>Collections.synchronizedMap</code></li><li><p>è‡ªè¡ŒåŠ é”</p><p><strong>ConcurrentHashMap çš„å®ç°åŸç†</strong></p></li></ul><p>DK 1.7ï¼š</p><ul><li><strong>Segment åˆ†æ®µé”æœºåˆ¶</strong>ï¼ˆReentrantLockï¼‰</li></ul><p>JDK 1.8ï¼š</p><ul><li><strong>CAS + synchronized å®ç°å¹¶å‘æ§åˆ¶</strong></li><li>ä½¿ç”¨ <strong>é“¾è¡¨ + çº¢é»‘æ ‘</strong> è§£å†³å†²çª</li><li>æ ¸å¿ƒç»“æ„ï¼š<ul><li>Node[] æ•°ç»„ + æ¯ä¸ªæ¡¶å†…é“¾è¡¨æˆ–çº¢é»‘æ ‘</li><li>é«˜å¹¶å‘ä¸‹æ¯” Hashtable æ›´ä¼˜</li></ul></li></ul><p>å½“åœ¨éå†<strong>HashMap</strong>çš„åŒæ—¶å¯¹å…¶è¿›è¡Œç»“æ„æ€§ä¿®æ”¹(å¦‚åˆ é™¤å…ƒç´ )æ—¶,ä¼šæŠ›å‡º<strong>ConcurrentModificationException</strong>å¼‚å¸¸ã€‚ä»£ç ä¼šè¿è¡Œé”™è¯¯</p><p>æ¯”å¦‚ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span>` `<span class="keyword">static</span>` `<span class="keyword">void</span>` `main(String[] args) &#123;</span><br><span class="line">  ``Map&lt;Integer, String&gt; map = ``<span class="keyword">new</span>` `HashMap&lt;&gt;();</span><br><span class="line">  ``map.put(``<span class="number">1</span>``, ``<span class="string">&quot;A&quot;</span>``);</span><br><span class="line">  ``map.put(``<span class="number">2</span>``, ``<span class="string">&quot;B&quot;</span>``);</span><br><span class="line">  ``map.put(``<span class="number">3</span>``, ``<span class="string">&quot;C&quot;</span>``);</span><br><span class="line">  ``map.forEach((key, value) -&gt; &#123;</span><br><span class="line">    ``<span class="keyword">if</span>` `(key == ``<span class="number">2</span>``) &#123;</span><br><span class="line">      ``map.remove(key);</span><br><span class="line">    ``&#125;</span><br><span class="line">  ``&#125;);</span><br><span class="line">  ``System.out.println(map.size());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œè¿è¡Œé”™è¯¯</p><p>æ­£ç¡®åšæ³•æ˜¯ï¼š</p><p>æ­£ç¡®åšæ³•ä¹‹ä¸€æ˜¯ä½¿ç”¨ <code>Iterator</code> éå†å¹¶ä½¿ç”¨å…¶ <code>remove()</code> æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">Iterator&lt;Map.Entry&lt;Integer, String&gt;&gt; iterator = map.entrySet().iterator();</span><br><span class="line"><span class="keyword">while</span> (iterator.hasNext()) &#123;</span><br><span class="line">    Map.Entry&lt;Integer, String&gt; entry = iterator.next();</span><br><span class="line">    <span class="keyword">if</span> (entry.getKey() == <span class="number">2</span>) &#123;</span><br><span class="line">        iterator.remove(); <span class="comment">// å®‰å…¨åˆ é™¤</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>java.util.HashMapç±»æ˜¯Javaé›†åˆæ¡†æ¶ä¸­å®ç°é”®å€¼å¯¹å­˜å‚¨çš„ä¸»è¦ç±»,å®ƒå®ç°äº†Mapæ¥å£,å…è®¸æˆ‘ä»¬ä½¿ç”¨é”®å€¼å¯¹(key-value pair)çš„å½¢å¼æ¥å­˜å‚¨æ•°æ®ã€‚HashMapä½¿ç”¨<strong>å“ˆå¸Œè¡¨çš„æ•°æ®ç»“æ„</strong>,æ¯ä¸ªå…ƒç´ éƒ½åŒ…å«ä¸€ä¸ªé”®å’Œä¸ä¹‹å¯¹åº”çš„å€¼ã€‚</p><p><strong>LinkedHashMap</strong></p><p><strong>HashMap + åŒå‘é“¾è¡¨</strong></p><p><strong>ç»´æŠ¤æ’å…¥é¡ºåºæˆ–è®¿é—®é¡ºåº</strong></p><p><strong>å¸¸ç”¨äºå®ç° LRU ç¼“å­˜</strong></p><p><strong>TreeMap</strong></p><p><strong>åº•å±‚ç»“æ„</strong>ï¼šçº¢é»‘æ ‘</p><p><strong>é”®æ’åºï¼ˆè‡ªç„¶æˆ–è‡ªå®šä¹‰ï¼‰</strong></p><p><strong>ä¸å…è®¸ null é”®ï¼Œå…è®¸ null å€¼</strong></p><p><strong>çº¿ç¨‹ä¸å®‰å…¨</strong></p><p><strong>Hashtableï¼ˆè¿‡æ—¶ï¼‰</strong></p><p>è€ç‰ˆæœ¬çš„ Map å®ç°ï¼Œ<strong>çº¿ç¨‹å®‰å…¨</strong>ï¼Œæ‰€æœ‰æ–¹æ³•éƒ½è¢« <code>synchronized</code> ä¿®é¥°ã€‚</p><p>ä¸å…è®¸ <strong>null é”®æˆ– null å€¼</strong>ã€‚</p><p><strong>ä¸ä¿è¯é¡ºåº</strong>ã€‚</p><p>å·²è¢« <code>ConcurrentHashMap</code> æ›¿ä»£ï¼Œåœ¨ç°ä»£é¡¹ç›®ä¸­å·²å¾ˆå°‘ä½¿ç”¨ã€‚</p><p><strong>ConcurrentHashMap</strong></p><p><strong>çº¿ç¨‹å®‰å…¨ï¼Œæ›¿ä»£ Hashtable</strong></p><p>JDK 1.7ï¼šSegment åˆ†æ®µé”ï¼ˆReentrantLockï¼‰</p><p>JDK 1.8ï¼š<strong>CAS + synchronized + åˆ†æ®µæ•°ç»„</strong></p><p><strong>æ”¯æŒé«˜å¹¶å‘è¯»å†™æ“ä½œ</strong></p><p><strong>é€‚åˆå¤šçº¿ç¨‹ç¯å¢ƒ</strong></p><h2 id="Queue-æ¥å£"><a href="#Queue-æ¥å£" class="headerlink" title="Queue æ¥å£"></a>Queue æ¥å£</h2><p>å¸¸ç”¨äºå¹¶å‘</p><p>ä¸¤è€…å†…éƒ¨éƒ½ä½¿ç”¨ <strong><code>ReentrantLock</code></strong> å’Œ <strong><code>Condition</code></strong> æ§åˆ¶çº¿ç¨‹å®‰å…¨å’Œé˜»å¡æ“ä½œã€‚</p><p>å®ƒä»¬éƒ½å±äº <strong>é˜»å¡é˜Ÿåˆ—ï¼ˆBlocking Queueï¼‰çš„ä¸€ç§å®ç°</strong>ï¼Œé€‚ç”¨äºå¤šçº¿ç¨‹ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å‹ã€‚</p><p>ä¸¤è€…æ„é€ æ–¹æ³•ä¸­å¯ä»¥è®¾ç½®<strong>å®¹é‡ä¸Šé™</strong>ï¼ˆæœ‰ç•Œï¼‰ã€‚</p><ul><li><code>new LinkedBlockingQueue&lt;&gt;(1000)</code> é™å®šæœ€å¤§å®¹é‡ä¸º 1000ã€‚</li></ul><p>å¦‚æœä½¿ç”¨æ— å‚æ„é€ ï¼Œé»˜è®¤å®¹é‡æ˜¯ï¼š<code>Integer.MAX_VALUE</code>ï¼Œ<strong>ç†è®ºä¸Šæ— ç•Œ</strong>ã€‚</p><p>æ‰€ä»¥ <strong>ä»é»˜è®¤è¡Œä¸ºçœ‹æ˜¯æ— ç•Œçš„</strong>ï¼Œä½†å®é™…ä¸Š <strong>å¯ä»¥è®¾ç½®ä¸ºæœ‰ç•Œé˜Ÿåˆ—</strong>ã€‚</p><p><strong>LinkedBlockingQueue</strong></p><ul><li><strong>é˜»å¡é˜Ÿåˆ—ï¼Œçº¿ç¨‹å®‰å…¨</strong></li><li><strong>åŸºäºé“¾è¡¨ç»“æ„</strong></li><li><strong>æ”¯æŒ FIFOï¼ˆå…ˆè¿›å…ˆå‡ºï¼‰æ“ä½œ</strong></li><li>æ’å…¥æ»¡äº†ä¼šé˜»å¡ï¼Œç§»é™¤ç©ºäº†ä¹Ÿä¼šé˜»å¡</li><li><strong>å¸¸ç”¨äºç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å‹</strong></li><li>æ”¯æŒä¸€ä¸ªæ–¹å‘çš„æ’å…¥å’Œç§»é™¤ï¼ˆå¤´å‡ºå°¾è¿›ï¼‰ã€‚</li></ul><p>ä½¿ç”¨ <strong><code>ReentrantLock</code></strong> å®ç°çº¿ç¨‹å®‰å…¨</p><p>ä½¿ç”¨ä¸¤ä¸ªé”ï¼š<strong>takeLockã€putLock</strong>ï¼Œé¿å…å…¥é˜Ÿå’Œå‡ºé˜Ÿç›¸äº’é˜»å¡</p><p><strong>LinkedBlockingDeque</strong></p><p><strong>çº¿ç¨‹å®‰å…¨</strong></p><p><strong>åŸºäºé“¾è¡¨ç»“æ„</strong></p><p><strong>åŒç«¯é˜»å¡é˜Ÿåˆ—</strong>ï¼ˆæ”¯æŒä¸¤ç«¯æ“ä½œï¼‰</p><p>æ—¢å¯ä»¥ä½œä¸º <strong>é˜Ÿåˆ—ï¼ˆFIFOï¼‰</strong>ï¼Œä¹Ÿå¯ä»¥ä½œä¸º <strong>æ ˆï¼ˆLIFOï¼‰</strong> ä½¿ç”¨</p><p>èƒ½å®ç° <strong>é˜Ÿåˆ—æ¨¡å‹</strong>ï¼ˆtail addï¼Œhead removeï¼‰</p><p>ä¹Ÿèƒ½å®ç° <strong>æ ˆæ¨¡å‹</strong>ï¼ˆhead addï¼Œhead removeï¼‰</p><div class="table-container"><table><thead><tr><th>é›†åˆç±»å‹</th><th>çº¿ç¨‹å®‰å…¨æ–¹å¼</th></tr></thead><tbody><tr><td><code>Vector</code></td><td>synchronized</td></tr><tr><td><code>Hashtable</code></td><td>synchronized</td></tr><tr><td><code>Collections.synchronizedXXX</code></td><td>æ˜¾å¼åŒæ­¥åŒ…è£…</td></tr><tr><td><code>CopyOnWriteArrayList</code></td><td>å†™æ—¶å¤åˆ¶æœºåˆ¶</td></tr><tr><td><code>ConcurrentHashMap</code></td><td>CAS + synchronized</td></tr></tbody></table></div><h1 id="Io"><a href="#Io" class="headerlink" title="Io"></a>Io</h1><ul><li>InputæŒ‡ä»å¤–éƒ¨è¯»å…¥æ•°æ®åˆ°å†…å­˜ï¼Œä¾‹å¦‚ï¼ŒæŠŠæ–‡ä»¶ä»ç£ç›˜è¯»å–åˆ°å†…å­˜ï¼Œä»ç½‘ç»œè¯»å–æ•°æ®åˆ°å†…å­˜ç­‰ç­‰ã€‚</li><li>OutputæŒ‡æŠŠæ•°æ®ä»å†…å­˜è¾“å‡ºåˆ°å¤–éƒ¨ï¼Œä¾‹å¦‚ï¼ŒæŠŠæ•°æ®ä»å†…å­˜å†™å…¥åˆ°æ–‡ä»¶ï¼ŒæŠŠæ•°æ®ä»å†…å­˜è¾“å‡ºåˆ°ç½‘ç»œç­‰ç­‰ã€‚</li></ul><p>IOæµä»¥<code>byte</code>ï¼ˆå­—èŠ‚ï¼‰ä¸ºæœ€å°å•ä½ï¼Œå› æ­¤ä¹Ÿç§°ä¸º<strong><em>å­—èŠ‚æµ</em></strong>ã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬è¦ä»ç£ç›˜è¯»å…¥ä¸€ä¸ªæ–‡ä»¶ï¼ŒåŒ…å«6ä¸ªå­—èŠ‚ï¼Œå°±ç›¸å½“äºè¯»å…¥äº†6ä¸ªå­—èŠ‚çš„æ•°æ®ï¼š</p><p>å¦‚æœæˆ‘ä»¬éœ€è¦è¯»å†™çš„æ˜¯å­—ç¬¦ï¼Œå¹¶ä¸”å­—ç¬¦ä¸å…¨æ˜¯å•å­—èŠ‚è¡¨ç¤ºçš„ASCIIå­—ç¬¦ï¼Œé‚£ä¹ˆï¼ŒæŒ‰ç…§<code>char</code>æ¥è¯»å†™æ˜¾ç„¶æ›´æ–¹ä¾¿ï¼Œè¿™ç§æµç§°ä¸º<strong><em>å­—ç¬¦æµ</em></strong>ã€‚</p><p>Javaæä¾›äº†<code>Reader</code>å’Œ<code>Writer</code>è¡¨ç¤ºå­—ç¬¦æµï¼Œå­—ç¬¦æµä¼ è¾“çš„æœ€å°æ•°æ®å•ä½æ˜¯<code>char</code>ã€‚</p><p>åŒæ­¥IOæ˜¯æŒ‡ï¼Œ<strong>è¯»å†™IOæ—¶ä»£ç å¿…é¡»ç­‰å¾…æ•°æ®è¿”å›åæ‰ç»§ç»­æ‰§è¡Œåç»­ä»£ç </strong>ï¼Œå®ƒçš„ä¼˜ç‚¹æ˜¯ä»£ç ç¼–å†™ç®€å•ï¼Œç¼ºç‚¹æ˜¯CPUæ‰§è¡Œæ•ˆç‡ä½ã€‚</p><p>è€Œå¼‚æ­¥IOæ˜¯æŒ‡ï¼Œ<strong>è¯»å†™IOæ—¶ä»…å‘å‡ºè¯·æ±‚ï¼Œç„¶åç«‹åˆ»æ‰§è¡Œåç»­ä»£ç </strong>ï¼Œå®ƒçš„ä¼˜ç‚¹æ˜¯CPUæ‰§è¡Œæ•ˆç‡é«˜ï¼Œç¼ºç‚¹æ˜¯ä»£ç ç¼–å†™å¤æ‚ã€‚</p><h2 id="File"><a href="#File" class="headerlink" title="File"></a>File</h2><p>è¦æ„é€ ä¸€ä¸ª<code>File</code>å¯¹è±¡ï¼Œéœ€è¦ä¼ å…¥æ–‡ä»¶è·¯å¾„ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">File</span> <span class="variable">f</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">File</span>(<span class="string">&quot;C:\\Windows\\notepad.exe&quot;</span>);</span><br><span class="line">        System.out.println(f);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ„é€ Fileå¯¹è±¡æ—¶ï¼Œæ—¢å¯ä»¥ä¼ å…¥ç»å¯¹è·¯å¾„ï¼Œä¹Ÿå¯ä»¥ä¼ å…¥ç›¸å¯¹è·¯å¾„ã€‚</p><p>æœ‰ç›˜ç¬¦çš„æ˜¯ç»å¯¹è·¯å¾„ï¼Œæ²¡ç›˜ç¬¦çš„æ˜¯ç›¸å¯¹è·¯å¾„</p><p>Fileå¯¹è±¡æœ‰3ç§å½¢å¼è¡¨ç¤ºçš„è·¯å¾„ï¼Œä¸€ç§æ˜¯<code>getPath()</code>ï¼Œè¿”å›æ„é€ æ–¹æ³•ä¼ å…¥çš„è·¯å¾„ï¼Œä¸€ç§æ˜¯<code>getAbsolutePath()</code>ï¼Œè¿”å›ç»å¯¹è·¯å¾„ï¼Œä¸€ç§æ˜¯<code>getCanonicalPath</code>ï¼Œå®ƒå’Œç»å¯¹è·¯å¾„ç±»ä¼¼ï¼Œä½†æ˜¯è¿”å›çš„æ˜¯è§„èŒƒè·¯å¾„ã€‚</p><p>ç»å¯¹è·¯å¾„å¯ä»¥è¡¨ç¤ºæˆ<code>C:\Windows\System32\..\notepad.exe</code>ï¼Œè€Œè§„èŒƒè·¯å¾„å°±æ˜¯æŠŠ<code>.</code>å’Œ<code>..</code>è½¬æ¢æˆæ ‡å‡†çš„ç»å¯¹è·¯å¾„åçš„è·¯å¾„ï¼š<code>C:\Windows\notepad.exe</code>ã€‚</p><p>å½“Fileå¯¹è±¡è¡¨ç¤ºä¸€ä¸ªæ–‡ä»¶æ—¶ï¼Œå¯ä»¥é€šè¿‡<code>createNewFile()</code>åˆ›å»ºä¸€ä¸ªæ–°æ–‡ä»¶ï¼Œç”¨<code>delete()</code>åˆ é™¤è¯¥æ–‡ä»¶ï¼š</p><p>æœ‰äº›æ—¶å€™ï¼Œç¨‹åºéœ€è¦è¯»å†™ä¸€äº›ä¸´æ—¶æ–‡ä»¶ï¼ŒFileå¯¹è±¡æä¾›äº†<code>createTempFile()</code>æ¥åˆ›å»ºä¸€ä¸ªä¸´æ—¶æ–‡ä»¶ï¼Œä»¥åŠ<code>deleteOnExit()</code>åœ¨JVMé€€å‡ºæ—¶è‡ªåŠ¨åˆ é™¤è¯¥æ–‡ä»¶ã€‚</p><p>å½“Fileå¯¹è±¡è¡¨ç¤ºä¸€ä¸ªç›®å½•æ—¶ï¼Œå¯ä»¥ä½¿ç”¨<code>list()</code>å’Œ<code>listFiles()</code>åˆ—å‡ºç›®å½•ä¸‹çš„æ–‡ä»¶å’Œå­ç›®å½•åã€‚<code>listFiles()</code>æä¾›äº†ä¸€ç³»åˆ—é‡è½½æ–¹æ³•ï¼Œå¯ä»¥è¿‡æ»¤ä¸æƒ³è¦çš„æ–‡ä»¶å’Œç›®å½•ï¼š</p><h2 id="InputStream"><a href="#InputStream" class="headerlink" title="InputStream"></a>InputStream</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">InputStream`å¹¶ä¸æ˜¯ä¸€ä¸ªæ¥å£ï¼Œè€Œæ˜¯ä¸€ä¸ªæŠ½è±¡ç±»ï¼Œå®ƒæ˜¯æ‰€æœ‰è¾“å…¥æµçš„è¶…ç±»ã€‚è¿™ä¸ªæŠ½è±¡ç±»å®šä¹‰çš„ä¸€ä¸ªæœ€é‡è¦çš„æ–¹æ³•å°±æ˜¯`int read()</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªæ–¹æ³•ä¼šè¯»å–è¾“å…¥æµçš„ä¸‹ä¸€ä¸ªå­—èŠ‚ï¼Œå¹¶è¿”å›å­—èŠ‚è¡¨ç¤ºçš„<code>int</code>å€¼ï¼ˆ0~255ï¼‰ã€‚å¦‚æœå·²è¯»åˆ°æœ«å°¾ï¼Œè¿”å›<code>-1</code>è¡¨ç¤ºä¸èƒ½ç»§ç»­è¯»å–äº†ã€‚</p><p><code>InputStream</code>å’Œ<code>OutputStream</code>éƒ½æ˜¯é€šè¿‡<code>close()</code>æ–¹æ³•æ¥å…³é—­æµã€‚å…³é—­æµå°±ä¼šé‡Šæ”¾å¯¹åº”çš„åº•å±‚èµ„æºã€‚</p><p>æ³¨æ„åœ¨æ–¹æ³•å®Œæˆåä¸€å®šè¦å…³é—­æµ</p><h2 id="OutputStream"><a href="#OutputStream" class="headerlink" title="OutputStream"></a>OutputStream</h2><p>å’Œ<code>InputStream</code>ç±»ä¼¼ï¼Œ<code>OutputStream</code>ä¹Ÿæ˜¯æŠ½è±¡ç±»ï¼Œå®ƒæ˜¯æ‰€æœ‰è¾“å‡ºæµçš„è¶…ç±»ã€‚è¿™ä¸ªæŠ½è±¡ç±»å®šä¹‰çš„ä¸€ä¸ªæœ€é‡è¦çš„æ–¹æ³•å°±æ˜¯<code>void write(int b)</code></p><p><code>OutputStream</code>è¿˜æä¾›äº†ä¸€ä¸ª<code>flush()</code>æ–¹æ³•ï¼Œå®ƒçš„ç›®çš„æ˜¯å°†ç¼“å†²åŒºçš„å†…å®¹çœŸæ­£è¾“å‡ºåˆ°ç›®çš„åœ°ã€‚èƒ½å¼ºåˆ¶æŠŠç¼“å†²åŒºå†…å®¹è¾“å‡ºã€‚</p><h2 id="è¯»å–é…ç½®"><a href="#è¯»å–é…ç½®" class="headerlink" title="è¯»å–é…ç½®"></a>è¯»å–é…ç½®</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span> (<span class="type">InputStream</span> <span class="variable">input</span> <span class="operator">=</span> getClass().getResourceAsStream(<span class="string">&quot;/default.properties&quot;</span>)) &#123;</span><br><span class="line">    <span class="keyword">if</span> (input != <span class="literal">null</span>) &#123;</span><br><span class="line">        <span class="comment">// <span class="doctag">TODO:</span></span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Properties</span> <span class="variable">props</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Properties</span>();</span><br><span class="line">props.load(inputStreamFromClassPath(<span class="string">&quot;/default.properties&quot;</span>));</span><br><span class="line">props.load(inputStreamFromFile(<span class="string">&quot;./conf.properties&quot;</span>));</span><br></pre></td></tr></table></figure><p>è¯»å–é…ç½®æ–‡ä»¶ï¼Œä½†æ˜¯è¿™ä¸ªä¹‹åå°±è¢«Springå–ä»£äº†å§å“ˆå“ˆ</p><h2 id="Reader"><a href="#Reader" class="headerlink" title="Reader"></a>Reader</h2><p><code>Reader</code>æ˜¯Javaçš„IOåº“æä¾›çš„å¦ä¸€ä¸ªè¾“å…¥æµæ¥å£ã€‚å’Œ<code>InputStream</code>çš„åŒºåˆ«æ˜¯ï¼Œ<code>InputStream</code>æ˜¯ä¸€ä¸ªå­—èŠ‚æµï¼Œå³ä»¥<code>byte</code>ä¸ºå•ä½è¯»å–ï¼Œè€Œ<code>Reader</code>æ˜¯ä¸€ä¸ªå­—ç¬¦æµï¼Œå³ä»¥<code>char</code>ä¸ºå•ä½è¯»å–ï¼š</p><p>è¦é¿å…ä¹±ç é—®é¢˜ï¼Œæˆ‘ä»¬éœ€è¦åœ¨åˆ›å»º<code>FileReader</code>æ—¶æŒ‡å®šç¼–ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Reader</span> <span class="variable">reader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">FileReader</span>(<span class="string">&quot;src/readme.txt&quot;</span>, StandardCharsets.UTF_8);</span><br></pre></td></tr></table></figure><p>é™¤äº†ç‰¹æ®Šçš„<strong><code>CharArrayReader</code>å’Œ<code>StringReader</code></strong>ï¼Œæ™®é€šçš„<code>Reader</code>å®é™…ä¸Šæ˜¯åŸºäº<code>InputStream</code>æ„é€ çš„ï¼Œå› ä¸º<code>Reader</code>éœ€è¦ä»<code>InputStream</code>ä¸­è¯»å…¥å­—èŠ‚æµï¼ˆ<code>byte</code>ï¼‰ï¼Œç„¶åï¼Œæ ¹æ®ç¼–ç è®¾ç½®ï¼Œå†è½¬æ¢ä¸º<code>char</code>å°±å¯ä»¥å®ç°å­—ç¬¦æµã€‚å¦‚æœæˆ‘ä»¬æŸ¥çœ‹<code>FileReader</code>çš„æºç ï¼Œå®ƒåœ¨å†…éƒ¨å®é™…ä¸ŠæŒæœ‰ä¸€ä¸ª<code>FileInputStream</code>ã€‚</p><p>æ—¢ç„¶<code>Reader</code>æœ¬è´¨ä¸Šæ˜¯ä¸€ä¸ªåŸºäº<code>InputStream</code>çš„<code>byte</code>åˆ°<code>char</code>çš„è½¬æ¢å™¨ï¼Œé‚£ä¹ˆï¼Œå¦‚æœæˆ‘ä»¬å·²ç»æœ‰ä¸€ä¸ª<code>InputStream</code>ï¼Œæƒ³æŠŠå®ƒè½¬æ¢ä¸º<code>Reader</code>ï¼Œæ˜¯å®Œå…¨å¯è¡Œçš„ã€‚<code>InputStreamReader</code>å°±æ˜¯è¿™æ ·ä¸€ä¸ªè½¬æ¢å™¨ï¼Œå®ƒå¯ä»¥æŠŠä»»ä½•<code>InputStream</code>è½¬æ¢ä¸º<code>Reader</code>ã€‚</p><h2 id="Writer"><a href="#Writer" class="headerlink" title="Writer"></a>Writer</h2><p><code>Writer</code>æ˜¯åŸºäº<code>OutputStream</code>æ„é€ çš„ï¼Œå¯ä»¥é€šè¿‡<code>OutputStreamWriter</code>å°†<code>OutputStream</code>è½¬æ¢ä¸º<code>Writer</code>ï¼Œè½¬æ¢æ—¶éœ€è¦æŒ‡å®šç¼–ç ã€‚</p><h2 id="printstream"><a href="#printstream" class="headerlink" title="printstream"></a>printstream</h2><p><code>PrintStream</code>æ˜¯ä¸€ç§<code>FilterOutputStream</code>ï¼Œå®ƒåœ¨<code>OutputStream</code>çš„æ¥å£ä¸Šï¼Œé¢å¤–æä¾›äº†ä¸€äº›å†™å…¥å„ç§æ•°æ®ç±»å‹çš„æ–¹æ³•ï¼š</p><ul><li>å†™å…¥<code>int</code>ï¼š<code>print(int)</code></li><li>å†™å…¥<code>boolean</code>ï¼š<code>print(boolean)</code></li><li>å†™å…¥<code>String</code>ï¼š<code>print(String)</code></li><li>å†™å…¥<code>Object</code>ï¼š<code>print(Object)</code>ï¼Œå®é™…ä¸Šç›¸å½“äº<code>print(object.toString())</code></li></ul>]]></content:encoded>
      
      
      <category domain="https://blog.tokenlen.top/categories/javase/">javase</category>
      
      <category domain="https://blog.tokenlen.top/categories/javase/java/">java</category>
      
      
      <category domain="https://blog.tokenlen.top/tags/java/">java</category>
      
      
      <comments>https://blog.tokenlen.top/2025/05/19/javase/javase1/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>redisé¢è¯•hot</title>
      <link>https://blog.tokenlen.top/2025/05/15/java-stack/redis2/</link>
      <guid>https://blog.tokenlen.top/2025/05/15/java-stack/redis2/</guid>
      <pubDate>Wed, 14 May 2025 16:00:00 GMT</pubDate>
      
        
        
          
          
      <description>&lt;h1 id=&quot;åŸºç¡€&quot;&gt;&lt;a href=&quot;#åŸºç¡€&quot; class=&quot;headerlink&quot; title=&quot;åŸºç¡€&quot;&gt;&lt;/a&gt;åŸºç¡€&lt;/h1&gt;&lt;h2 id=&quot;1-è¯¦ç»†çš„è¯´è¯´Redisçš„æ•°æ®ç±»å‹&quot;&gt;&lt;a href=&quot;#1-è¯¦ç»†çš„è¯´è¯´Redisçš„æ•°æ®ç±»å‹&quot;</description>
          
        
      
      
      
      <content:encoded><![CDATA[<h1 id="åŸºç¡€"><a href="#åŸºç¡€" class="headerlink" title="åŸºç¡€"></a>åŸºç¡€</h1><h2 id="1-è¯¦ç»†çš„è¯´è¯´Redisçš„æ•°æ®ç±»å‹"><a href="#1-è¯¦ç»†çš„è¯´è¯´Redisçš„æ•°æ®ç±»å‹" class="headerlink" title="1.è¯¦ç»†çš„è¯´è¯´Redisçš„æ•°æ®ç±»å‹"></a>1.è¯¦ç»†çš„è¯´è¯´Redisçš„æ•°æ®ç±»å‹</h2><p>redisä¸­å¸¸ç”¨çš„äº”ç§æ•°æ®ç»“æ„ï¼š<strong>stringã€listã€setã€zsetã€hash</strong>ã€‚</p><p>Stringç»“æ„åº•å±‚æ˜¯<strong>ä¸€ä¸ªç®€å•åŠ¨æ€å­—ç¬¦ä¸²</strong>ï¼Œæ”¯æŒæ‰©å®¹ï¼Œå­˜å‚¨å­—ç¬¦ä¸²ã€‚æ‰€ä»¥å¯åº”ç”¨äºå¾®ä¿¡æ–‡ç« çš„é˜…è¯»æ•°æˆ–ç‚¹èµï¼Œç¼“å­˜å¯¹è±¡ã€å¸¸è§„è®¡æ•°ã€åˆ†å¸ƒå¼é”ã€å…±äº« session ä¿¡æ¯ç­‰ã€‚</p><p>listå­˜å‚¨<strong>çº¿æ€§æœ‰åºä¸”å¯é‡å¤çš„å…ƒç´ </strong>ï¼Œåº•å±‚æ•°æ®ç»“æ„å¯ä»¥æ˜¯åŒå‘é“¾è¡¨/å‹ç¼©åˆ—è¡¨ã€‚å¾®è–„çš„ç²‰ä¸åˆ—è¡¨æˆ–å¥½å‹åˆ—è¡¨ï¼Œæ¶ˆæ¯é˜Ÿåˆ—ï¼ˆä½†æ˜¯æœ‰ä¸¤ä¸ªé—®é¢˜ï¼š1. ç”Ÿäº§è€…éœ€è¦è‡ªè¡Œå®ç°å…¨å±€å”¯ä¸€ IDï¼›2. ä¸èƒ½ä»¥æ¶ˆè´¹ç»„å½¢å¼æ¶ˆè´¹æ•°æ®ï¼‰ç­‰ã€‚</p><p>setå­˜<strong>å‚¨ä¸å¯é‡å¤çš„å…ƒç´ </strong>ï¼Œä¸€èˆ¬ç”¨äºæ±‚äº¤é›†ã€å·®é›†ç­‰ï¼Œåº•å±‚æ•°æ®ç»“æ„å¯ä»¥æ˜¯hashå’Œæ•´æ•°æ•°ç»„ï¼Œæ‰€ä»¥å¯åº”ç”¨äºæŠ½å¥–ï¼Œé€šè¿‡saddæ·»åŠ ä¸åŒçš„ç”¨æˆ·ï¼Œsrandom key numberé€‰å‡ºä¸­å°†ç”¨æˆ·ã€‚è¿˜æœ‰é›†åˆçš„è¿ç®—ï¼šsdiffã€sinternä¸sunioå°±æ˜¯é›†åˆçš„å·®äº¤å¹¶è¿ç®—ï¼Œæ‰€ä»¥å¯åº”ç”¨äºQQçš„å…±åŒå¥½å‹ èšåˆè®¡ç®—ï¼ˆå¹¶é›†ã€äº¤é›†ã€å·®é›†ï¼‰åœºæ™¯ï¼Œæ¯”å¦‚ç‚¹èµã€å…±åŒå…³æ³¨ã€æŠ½å¥–æ´»åŠ¨ç­‰ã€‚</p><p>zsetå­˜å‚¨çš„<strong>æ˜¯æœ‰åºä¸å¯é‡å¤çš„å…ƒç´ </strong>ï¼Œzsetä¸ºæ¯ä¸ªå…ƒç´ æ·»åŠ äº†ä¸€ä¸ªscoreå±æ€§ä½œä¸ºæ’åºä¾æ®ï¼Œåº•å±‚æ•°æ®ç»“æ„å¯ä»¥æ˜¯ziplistå’Œè·³è¡¨ï¼Œæ‰€ä»¥å¯åº”ç”¨äºæ’è¡Œæ¦œï¼Œç±»ä¼¼äºå¾®åšçƒ­æœ æ’åºåœºæ™¯ï¼Œæ¯”å¦‚æ’è¡Œæ¦œã€ç”µè¯å’Œå§“åæ’åº</p><p>hashç±»å‹å­˜å‚¨çš„<strong>æ˜¯é”®å€¼å¯¹</strong>ï¼Œåº•å±‚æ•°æ®ç»“æ„æ˜¯ziplistå’Œhashã€‚redisä¼šåœ¨æ€§èƒ½ä»¥åŠèŠ‚çœå†…å­˜é—´è€ƒè™‘ï¼Œé€‰æ‹©æœ€é€‚åˆå½“å‰çŠ¶æ€çš„åº•å±‚æ•°æ®ç»“æ„å®ç°  å¯ç”¨äºå­˜å‚¨ç”¨æˆ·æ•°æ®ï¼Œä¸€ä¸ªkeyä»£è¡¨ä¸€ä¸ªç”¨æˆ·ï¼Œfeildè¡¨ç¤ºç”¨æˆ·çš„å„ä¸ªå±æ€§ï¼Œç„¶åå¯¹åº”çš„valueå°±æ˜¯å±æ€§å¯¹åº”çš„å€¼ ç¼“å­˜å¯¹è±¡ã€è´­ç‰©è½¦ç­‰ã€‚ï¼Œä¸€èˆ¬æ¥è¯´keyå¯ä»¥ä½œä¸ºidï¼Œç„¶åvalueç”¨jsonæ•°æ®æ¥å­˜å‚¨æ›´å¤šçš„æ•°æ®ï¼Œæ¯”å¦‚å£å‘³ï¼Œä»·æ ¼ç­‰ç­‰ã€‚</p><p>list(æœ‰åºå¯é‡å¤) åº•å±‚æ•°æ®ç»“æ„æ˜¯åŒå‘é“¾è¡¨/å‹ç¼©é“¾è¡¨</p><p>set(ä¸å¯é‡å¤) = hash + æ•´æ•°æ•°ç»„</p><p>zset(æœ‰åºä¸å¯é‡å¤)ziplist+hashtable</p><p>hash(é”®å€¼å¯¹) = ziplist+hash</p><p>è¿˜æœ‰å››ç§ç‰¹æ®Šçš„æ•°æ®ç±»å‹</p><p>bitmapsï¼šé€šè¿‡ä½æ“ä½œï¼ˆ0/1ï¼‰é«˜æ•ˆå­˜å‚¨å¸ƒå°”å‹æ•°æ®ï¼ŒåŸºäº String å®ç° </p><p>ä¸æ˜¯é‡å¤çš„ï¼Œæœ‰åºï¼ŒæŒ‰ç…§é¡ºåºæ’åˆ—</p><ul><li>ç”¨æˆ·ç­¾åˆ°ï¼ˆè®°å½•æ¯å¤©æ˜¯å¦ç­¾åˆ°ï¼‰</li><li>æ´»è·ƒç”¨æˆ·ç»Ÿè®¡ï¼ˆæ˜¯å¦æ´»è·ƒä¸º 1ï¼Œä¸æ´»è·ƒä¸º 0ï¼‰</li><li>å•†å“æµè§ˆè®°å½•ç­‰å¸ƒå°”å‹çŠ¶æ€åœºæ™¯</li><li>äºŒå€¼çŠ¶æ€ç»Ÿè®¡çš„åœºæ™¯ï¼Œæ¯”å¦‚ç­¾åˆ°ã€åˆ¤æ–­ç”¨æˆ·ç™»é™†çŠ¶æ€ã€è¿ç»­ç­¾åˆ°ç”¨æˆ·æ€»æ•°ç­‰</li></ul><p>hyperloglogï¼šåŸºäºæ¦‚ç‡ç®—æ³•ï¼Œ<strong>ç”¨äºä¼°ç®—å”¯ä¸€å…ƒç´ çš„æ•°é‡</strong>ï¼Œå†…å­˜å ç”¨æå°ï¼ˆä»… 12KB å³å¯å¤„ç†ç™¾ä¸‡çº§æ•°æ®ï¼‰ã€‚è¯¯å·®æå°ã€‚åŸºäº HyperLogLog ç®—æ³•ï¼ˆç¨€ç–å’Œç¨ å¯†è¡¨ç¤ºï¼‰æ˜¯è‡ªåŠ¨å»é‡çš„æ— åºçš„æ•°æ®</p><ul><li>ç½‘ç«™ UVï¼ˆç‹¬ç«‹è®¿å®¢ç»Ÿè®¡</li><li>ç»Ÿè®¡æŸæ´»åŠ¨ä¸­å¤šå°‘äººå‚ä¸ï¼ˆå»é‡è®¡æ•°ï¼‰</li><li>åˆ†å¸ƒå¼å”¯ä¸€ç”¨æˆ·è¯†åˆ«</li></ul><p>geospatialï¼šå­˜å‚¨ç»çº¬åº¦ä¿¡æ¯ï¼Œæ”¯æŒè·ç¦»è®¡ç®—ã€èŒƒå›´æŸ¥è¯¢ã€‚åŸºäº <strong>zsetï¼ˆè·³è¡¨ + å“ˆå¸Œï¼‰</strong> å®ç° ä¸æ˜¯é‡å¤çš„ï¼ŒæŒ‰ç…§åœ°ç†ä½ç½®çš„scoreæ’åº</p><ul><li>é™„è¿‘å•†å®¶/é—¨åº—æœç´¢ï¼ˆé™„è¿‘ 1 å…¬é‡Œå†…ï¼‰</li><li>åœ°å›¾æ‰“è½¦æœåŠ¡ï¼ˆè·ç¦»è®¡ç®—ï¼‰</li><li>åœ°ç†å›´æ åŠŸèƒ½</li><li>å­˜å‚¨åœ°ç†ä½ç½®ä¿¡æ¯çš„åœºæ™¯ï¼Œæ¯”å¦‚æ»´æ»´å«è½¦</li></ul><p>streamï¼šRedis çš„æ¶ˆæ¯é˜Ÿåˆ—ç³»ç»Ÿï¼Œ<strong>æ”¯æŒå¤šæ¶ˆè´¹è€…ç»„ã€æ¶ˆè´¹ç¡®è®¤ã€æ¶ˆæ¯æŒä¹…åŒ–ç­‰ç‰¹æ€§</strong>ï¼ŒåŠŸèƒ½ç±»ä¼¼ Kafkaã€‚åº•å±‚ç±»ä¼¼æ—¥å¿—ç»“æ„ï¼ˆè¿½åŠ å†™ï¼‰ï¼Œå†…éƒ¨ç”± radix tree + linked list ç»„ç»‡ æ¶ˆæ¯idå”¯ä¸€ï¼Œä½†å†…å®¹å¯é‡å¤ã€‚æŒ‰ç…§æ¶ˆæ¯idæ’åº</p><ul><li>äº‹ä»¶é©±åŠ¨æ¶æ„ï¼ˆEvent Sourcingï¼‰</li><li>ç”¨æˆ·è¡Œä¸ºæ—¥å¿—æ”¶é›†</li><li>å¼‚æ­¥ä»»åŠ¡é˜Ÿåˆ—ï¼ˆå¦‚å‘é€é€šçŸ¥ã€æ¶ˆæ¯æ¨é€ï¼‰</li></ul><div class="table-container"><table><thead><tr><th>ç±»å‹</th><th>åº•å±‚ç»“æ„</th><th>æ˜¯å¦æœ‰åº</th><th>æ˜¯å¦å…è®¸é‡å¤</th><th>å…¸å‹åº”ç”¨</th></tr></thead><tbody><tr><td>String</td><td>ç®€å•åŠ¨æ€å­—ç¬¦ä¸²</td><td>æ— </td><td>æ˜¯</td><td>ç‚¹èµæ•°ã€tokenã€é…ç½®ç¼“å­˜ç­‰</td></tr><tr><td>List</td><td>åŒå‘é“¾è¡¨ / å‹ç¼©åˆ—è¡¨</td><td>æœ‰</td><td>æ˜¯</td><td>æ¶ˆæ¯åˆ—è¡¨ã€ä»»åŠ¡é˜Ÿåˆ—ã€è¯„è®º</td></tr><tr><td>Set</td><td>å“ˆå¸Œè¡¨ / æ•´æ•°æ•°ç»„</td><td>æ— </td><td>å¦</td><td>æŠ½å¥–ã€æ ‡ç­¾ã€å…±åŒå¥½å‹</td></tr><tr><td>ZSet</td><td>è·³è¡¨ / ziplist</td><td>æœ‰ï¼ˆscore æ’åºï¼‰</td><td>å¦</td><td>æ’è¡Œæ¦œã€çƒ­æœæ¦œ</td></tr><tr><td>Hash</td><td>ziplist / å“ˆå¸Œè¡¨</td><td>æ— </td><td>key ä¸é‡å¤</td><td>ç”¨æˆ·ä¿¡æ¯ã€é…ç½®è¡¨</td></tr><tr><td><strong>Bitmaps</strong></td><td>String + ä½è¿ç®—</td><td>æœ‰ï¼ˆæŒ‰ä½ï¼‰</td><td>å¦</td><td>ç­¾åˆ°ã€æ´»è·ƒçŠ¶æ€ã€å¼€å…³ä½æ ‡å¿—</td></tr><tr><td><strong>HyperLogLog</strong></td><td>æ¦‚ç‡ç»“æ„ï¼ˆå“ˆå¸Œæ¡¶ï¼‰</td><td>æ— </td><td>è‡ªåŠ¨å»é‡</td><td>UV å»é‡ã€å”¯ä¸€å€¼ä¼°ç®—</td></tr><tr><td><strong>Geo</strong></td><td>åŸºäº ZSet + GeoHash</td><td>æœ‰ï¼ˆæŒ‰ä½ç½®ç¼–ç ï¼‰</td><td>å¦</td><td>é™„è¿‘ä½ç½®æŸ¥æ‰¾ã€LBSã€å¯¼èˆªå®šä½</td></tr><tr><td><strong>Stream</strong></td><td>æ—¥å¿—ç»“æ„ + radix tree</td><td>æœ‰ï¼ˆæ¶ˆæ¯ IDï¼‰</td><td>å†…å®¹å¯é‡å¤</td><td>æ¶ˆæ¯é˜Ÿåˆ—ã€æ—¥å¿—æ”¶é›†ã€äº‹ä»¶é€šçŸ¥</td></tr></tbody></table></div><h2 id="2-è¯´è¯´Redisçš„å•çº¿ç¨‹æ¶æ„ã€‚"><a href="#2-è¯´è¯´Redisçš„å•çº¿ç¨‹æ¶æ„ã€‚" class="headerlink" title="2.è¯´è¯´Redisçš„å•çº¿ç¨‹æ¶æ„ã€‚"></a>2.è¯´è¯´Redisçš„å•çº¿ç¨‹æ¶æ„ã€‚</h2><p>redisé‡‡ç”¨çš„æ˜¯<strong>å•çº¿ç¨‹+IOå¤šè·¯å¤ç”¨æŠ€æœ¯</strong>ã€‚è¿™é‡Œå•çº¿ç¨‹æŒ‡çš„æ˜¯<strong>redisä¸­è¯»å†™æ“ä½œå’Œç½‘ç»œIOä½¿ç”¨çš„æ˜¯æ˜¯æœ‰ä¸€ä¸ªçº¿ç¨‹æ¥å®Œæˆ</strong>ï¼Œä½†æ˜¯å…¶ä»–æ“ä½œæ˜¯æœ‰å…¶ä»–çº¿ç¨‹å®Œæˆï¼Œä¾‹å¦‚æŒä¹…åŒ–æ“ä½œã€‚å•çº¿ç¨‹æ—¢<strong>å¯ä»¥ç®€åŒ–æ•°æ®ç»“æ„å’Œç®—æ³•çš„å®ç°ï¼ŒåŒæ—¶ä¹Ÿæ¶ˆé™¤äº†çº¿ç¨‹åˆ‡æ¢å’Œé”ç«äº‰æ‰€å¸¦æ¥çš„æ¶ˆè€—</strong>ã€‚redisä¸­é‡‡ç”¨çš„IOå¤šè·¯å¤ç”¨æŠ€æœ¯å®ç°äº†<strong>å•çº¿ç¨‹ä¸‹åŒæ—¶å¤„ç†å¤šä¸ªIOè¯·æ±‚</strong>ã€‚</p><p>redisä¸ºä»€ä¹ˆè¿™ä¹ˆå¿«ï¼š</p><p>1.å•çº¿ç¨‹è¿›è¡Œè¯»å†™æ“ä½œï¼Œé¿å…çº¿ç¨‹åˆ‡æ¢å’Œé”ç«äº‰å¸¦æ¥çš„æ¶ˆè€—ã€‚</p><p>2ï¼šredisæ“ä½œæ˜¯åœ¨å†…å­˜ä¸­è¿›è¡Œçš„ã€‚</p><p>3.æœ€é‡è¦çš„å°±æ˜¯ï¼šé‡‡ç”¨äº†IOå¤šè·¯å¤ç”¨æŠ€æœ¯ï¼Œå®ç°äº†åœ¨ç½‘ç»œIOä¸­èƒ½å¤Ÿå¤„ç†å¤§é‡å¹¶å‘è¯·æ±‚ï¼Œå®ç°é«˜ååç‡ã€‚</p><h2 id="3-è¯´è¯´Redisçš„æŒä¹…åŒ–ç­–ç•¥ã€‚"><a href="#3-è¯´è¯´Redisçš„æŒä¹…åŒ–ç­–ç•¥ã€‚" class="headerlink" title="3.è¯´è¯´Redisçš„æŒä¹…åŒ–ç­–ç•¥ã€‚"></a>3.è¯´è¯´Redisçš„æŒä¹…åŒ–ç­–ç•¥ã€‚</h2><p>redisçš„æŒä¹…åŒ–ç­–ç•¥æœ‰ä¸‰ç§ï¼š</p><p>1.RDBæŒä¹…åŒ–ï¼šå°†å½“å‰è¿›ç¨‹ä¸­çš„æ•°æ®å·²ç”Ÿæˆ<strong>å¿«ç…§</strong>çš„æ–¹å¼ä¿å­˜åˆ°ç¡¬ç›˜ä¸­ï¼Œæ˜¯redisé»˜è®¤çš„æŒä¹…åŒ–æœºåˆ¶ã€‚ä¼˜ç‚¹ï¼šæŒä¹…åŒ–æ—¶ç”Ÿæˆçš„æ–‡ä»¶ä½“ç§¯å°ï¼Œæ¢å¤æ•°æ®å¿«ï¼Œç¼ºç‚¹ï¼šæ¯æ¬¡è¿è¡Œéƒ½éœ€è¦æ‰§è¡Œforkæ“ä½œï¼ŒRDBæŒä¹…åŒ–ç­–ç•¥ï¼Œ<strong>æ²¡æœ‰åšåˆ°å®æ—¶çš„æŒä¹…åŒ–</strong>ï¼Œæœ‰æ—¶å¯èƒ½ä¼šä¸¢å¤±æœ€åä¸€æ­¥çš„æ•°æ®ã€‚</p><p>2.AOFæŒä¹…åŒ–ï¼šä»¥<strong>ç‹¬ç«‹æ—¥å¿—çš„æ–¹å¼è®°å½•æ¯æ¬¡å†™å…¥çš„å‘½ä»¤</strong>ï¼Œé‡å¯æ—¶æ‰§è¡ŒAOFä¸­çš„å‘½ä»¤å³å¯æ¢å¤æ•°æ®ã€‚ä¼˜ç‚¹ï¼šAOFæŒä¹…åŒ–çš„å®‰å…¨æ€§æ›´é«˜ï¼Œä¿è¯äº†æ•°æ®æŒä¹…åŒ–çš„<strong>å®æ—¶æ€§</strong>ã€‚ç¼ºç‚¹ï¼šæ–‡ä»¶è¦å¤§å¾ˆå¤šï¼Œæ¢å¤é€Ÿåº¦æ…¢ã€‚</p><p>3.RDB-AOFæŒä¹…åŒ–ï¼šè¿™ç§æ–¹å¼æ˜¯åŸºäºAOFæŒä¹…åŒ–æ–¹å¼æ„å»ºå‡ºæ¥çš„ã€‚å…¼å…·RDBå’ŒAOFçš„ä¼˜åŠ¿ã€‚</p><h2 id="4-è¯´è¯´Redisçš„ç¼“å­˜æ·˜æ±°ç­–ç•¥ã€‚"><a href="#4-è¯´è¯´Redisçš„ç¼“å­˜æ·˜æ±°ç­–ç•¥ã€‚" class="headerlink" title="4.è¯´è¯´Redisçš„ç¼“å­˜æ·˜æ±°ç­–ç•¥ã€‚"></a>4.è¯´è¯´Redisçš„ç¼“å­˜æ·˜æ±°ç­–ç•¥ã€‚</h2><p>æƒ°æ€§åˆ é™¤ã€å®šæœŸåˆ é™¤ã€maxmemory-policyï¼›</p><p><strong>æƒ°æ€§åˆ é™¤</strong>ï¼šå®¢æˆ·ç«¯è®¿é—®ä¸€ä¸ªkeyçš„æ—¶å€™ï¼ŒRedisä¼šå…ˆæ£€æŸ¥å®ƒçš„è¿‡æœŸæ—¶é—´ï¼Œå¦‚æœå‘ç°è¿‡æœŸå°±ç«‹åˆ»åˆ é™¤è¿™ä¸ªkeyã€‚</p><p>å®šæœŸåˆ é™¤ï¼šredisä¼šå°†è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„keyæ”¾åˆ°ä¸€ä¸ª<strong>ç‹¬ç«‹çš„å­—å…¸ä¸­</strong>ï¼Œå¹¶å¯¹è¯¥å­—å…¸è¿›è¡Œ<strong>æ¯ç§’10æ¬¡çš„è¿‡æœŸæ‰«æ</strong>ï¼Œè¿‡æœŸæ‰«æä¸ä¼šéå†å­—å…¸ä¸­æ‰€æœ‰çš„keyï¼Œè€Œæ˜¯é‡‡ç”¨äº†ä¸€ç§ç®€å•çš„<strong>è´ªå¿ƒç­–ç•¥</strong>ï¼Œè¯¥ç­–ç•¥å¦‚ä¸‹ï¼š1ã€<strong>ä»è¿‡æœŸå­—å…¸çº¢éšæœºé€‰æ‹©20ä¸ªkey,2ã€åˆ é™¤è¿™20ä¸ªkeyä¸­å·²è¿‡æœŸçš„keyï¼Œ3ã€å¦‚æœå·²è¿‡æœŸkeyçš„æ¯”ä¾‹è¶…è¿‡25%ï¼Œåˆ™é‡å¤æ­¥éª¤1ï¼›</strong></p><p>å½“å†™å…¥æ•°æ®å°†è¶…å‡ºmaxmemoryé™åˆ¶æ—¶ï¼ŒRedisä¼šé‡‡ç”¨maxmemory-policyæ‰€åˆ¶å®šçš„ç­–ç•¥è¿›è¡Œæ•°æ®æ·˜æ±° å³ <strong>LRU</strong> ï¼ˆæœ€è¿‘æœ€å°‘ä½¿ç”¨åŸåˆ™ï¼‰LRUç®—æ³•çš„ä¸è¶³ä¹‹å¤„åœ¨äº,è‹¥ä¸€ä¸ªkeyå¾ˆå°‘è¢«è®¿é—®,åªæ˜¯åˆšåˆšå¶å°”è¢«è®¿é—®äº†ä¸€æ¬¡,åˆ™å®ƒå°±è¢«è®¤ä¸ºæ˜¯çƒ­ç‚¹æ•°æ®,çŸ­æ—¶é—´å†…ä¸ä¼šè¢«æ·˜æ±°ã€‚</p><p>LFUç®—æ³•æ­£å¼ç”¨äºè§£å†³ä¸Šè¿°é—®é¢˜,<strong>LFU</strong>ï¼ˆLeast Frequently Usedï¼‰æ˜¯Redis4æ–°å¢çš„æ·˜æ±°ç­–ç•¥,<strong>å®ƒæ ¹æ®keyçš„æœ€è¿‘è®¿é—®é¢‘ç‡è¿›è¡Œæ·˜æ±°</strong>ã€‚LFUåœ¨LRUçš„åŸºç¡€ä¸Š,ä¸ºæ¯ä¸ªæ•°æ®å¢åŠ äº†ä¸€ä¸ª<strong>è®¡æ•°å™¨</strong>,æ¥ç»Ÿè®¡è¿™ä¸ªæ•°æ®çš„è®¿é—®æ¬¡æ•°ã€‚å½“ä½¿ç”¨LFUç­–ç•¥æ·˜æ±°æ•°æ®æ—¶,é¦–å…ˆä¼šæ ¹æ®æ•°æ®çš„è®¿é—®æ¬¡æ•°è¿›è¡Œç­›é€‰,æŠŠ<strong>è®¿é—®æ¬¡æ•°æœ€ä½</strong>çš„æ•°æ®æ·˜æ±°å‡ºå†…å­˜ã€‚å¦‚æœä¸¤ä¸ªæ•°æ®çš„è®¿é—®æ¬¡æ•°ç›¸åŒ,LFUå†æ¯”è¾ƒè¿™ä¸¤ä¸ªæ•°æ®çš„è®¿é—®æ—¶é—´,æŠŠ<strong>è®¿é—®æ—¶é—´æ›´æ—©</strong>çš„æ•°æ®æ·˜æ±°å‡ºå†…å­˜</p><h2 id="5-å¦‚ä½•å®ç°Redisé«˜å¯ç”¨"><a href="#5-å¦‚ä½•å®ç°Redisé«˜å¯ç”¨" class="headerlink" title="5.å¦‚ä½•å®ç°Redisé«˜å¯ç”¨?"></a>5.å¦‚ä½•å®ç°Redisé«˜å¯ç”¨?</h2><p>é«˜å¯ç”¨å³éœ€è¦æœ‰<strong>å¤šä¸ªå‰¯æœ¬è€Œä¸æ˜¯å•ä½“æ”¯æ’‘</strong>ï¼Œä¸»èŠ‚ç‚¹ä¸å¯ç”¨å¯ä»¥æ›¿æ¢æˆå‰¯èŠ‚ç‚¹ï¼Œé‚£ä¹ˆå¤šä¸ªå‰¯æœ¬éœ€è¦<strong>åˆç†åŒæ­¥æœºåˆ¶</strong>ï¼Œåšåˆ°è¿™ä¸¤ç‚¹å³å¯å®ç°é«˜å¯ç”¨ï¼Œredisé€šè¿‡<strong>å“¨å…µæ¨¡å¼</strong>ï¼Œ<strong>é›†ç¾¤æ¨¡å¼</strong>æ¥æ‰©å±•å•èŠ‚ç‚¹æ”¯æ’‘ã€‚åŒæ—¶åšå¥½æ•°æ®åŒæ­¥å³å®ç°äº†é«˜å¯ç”¨ â€¦ </p><p>ä¸»è¦æœ‰å“¨å…µæ¨¡å¼å’Œé›†ç¾¤æ¨¡å¼è¿™ä¸¤ç§æ–¹å¼ã€‚ </p><p>å“¨å…µæ¨¡å¼ï¼šå“¨å…µæ¨¡å¼æ˜¯ä¸€ä¸ªåˆ†å¸ƒå¼æ¶æ„ï¼Œå®ƒåŒ…å«è‹¥å¹²ä¸ªå“¨å…µèŠ‚ç‚¹å’Œæ•°æ®èŠ‚ç‚¹ï¼Œæ¯ä¸€ä¸ªå“¨å…µèŠ‚ç‚¹éƒ½ç›‘æ§ç€å…¶ä»–çš„æ•°æ®èŠ‚ç‚¹å’Œå“¨å…µèŠ‚ç‚¹ï¼Œ<strong>å½“å‘ç°èŠ‚ç‚¹ä¸å¯è¾¾æ—¶ï¼Œä¼šå¯¹èŠ‚ç‚¹åšä¸‹çº¿æ ‡è¯†</strong>ã€‚å¦‚æœè¢«æ ‡è¯†çš„æ˜¯ä¸»èŠ‚ç‚¹ï¼Œå®ƒå°±ä¼šä¸å…¶ä»–å“¨å…µèŠ‚ç‚¹åå•†ï¼Œå¯ä»¥é¿å…è¯¯åˆ¤ï¼Œ<strong>å½“å¤§å¤šæ•°å“¨å…µèŠ‚ç‚¹éƒ½è®¤ä¸ºä¸»èŠ‚ç‚¹ä¸å¯è¾¾æ—¶</strong>ï¼Œå®ƒä»¬ä¾¿ä¼šé€‰æ‹©å‡ºä¸€ä¸ªå“¨å…µèŠ‚ç‚¹æ¥åš<strong>è‡ªåŠ¨æ•…éšœè½¬ç§»å·¥ä½œï¼Œå¯ä»¥å°†ä»èŠ‚ç‚¹æ™‹å‡ä¸ºä¸»èŠ‚ç‚¹</strong>ï¼ŒåŒæ—¶è¿˜ä¼šå®æ—¶çš„<strong>é€šçŸ¥åˆ°åº”ç”¨æ–¹</strong>ï¼Œæ•´ä¸ªè¿‡ç¨‹è‡ªåŠ¨çš„ï¼Œå®ç°é«˜å¯ç”¨ã€‚ </p><p>é›†ç¾¤æ¨¡å¼ï¼šRedisé›†ç¾¤é‡‡ç”¨<strong>è™šæ‹Ÿæ§½åˆ†åŒº</strong>æ¥å®ç°æ•°æ®åˆ†ç‰‡ï¼Œ<strong>å®ƒæŠŠæ‰€æœ‰çš„é”®æ ¹æ®å“ˆå¸Œå‡½æ•°æ˜ å°„åˆ°0-16383æ•´æ•°æ§½å†…</strong>ï¼Œè®¡ç®—å…¬å¼ä¸ºslot=CRC16(key)&amp;16383ï¼Œæ¯ä¸€ä¸ªèŠ‚ç‚¹è´Ÿè´£ç»´æŠ¤ä¸€éƒ¨åˆ†æ§½ä»¥åŠæ§½æ‰€æ˜ å°„çš„é”®å€¼æ•°æ®ã€‚</p><p><strong>ä¸»ä»æ¨¡å¼</strong>ï¼šä¸€ä¸ªmasterä¸»æœºä¸å¤šä¸ªslaveä»æœºï¼Œä¸»èŠ‚ç‚¹è´Ÿè´£å†™æ“ä½œï¼Œä»èŠ‚ç‚¹è´Ÿè´£è¯»æ“ä½œã€‚<br> ä¼˜ç‚¹ï¼š<strong>è¯»å†™åˆ†ç¦»ï¼Œä¸»èŠ‚ç‚¹çš„æ•°æ®ä¼šè‡ªåŠ¨å¤åˆ¶ç»™ä»èŠ‚ç‚¹ï¼Œåˆ†æ‹…ä¸»èŠ‚ç‚¹çš„å‹åŠ›</strong><br> ç¼ºç‚¹ï¼šä¸€æ—¦ä¸»èŠ‚ç‚¹å®•æœºï¼Œä¼šå¯¼è‡´éƒ¨åˆ†æ•°æ®æœªå®ç°åŒæ­¥ï¼›ä¸»èŠ‚ç‚¹å®•æœºä¸ä»èŠ‚ç‚¹éƒ½éœ€è¦è¿›è¡Œé‡å¯ï¼› </p><h2 id="6-Redisæ€ä¹ˆå®ç°å»¶æ—¶æ¶ˆæ¯ï¼Ÿ"><a href="#6-Redisæ€ä¹ˆå®ç°å»¶æ—¶æ¶ˆæ¯ï¼Ÿ" class="headerlink" title="6.Redisæ€ä¹ˆå®ç°å»¶æ—¶æ¶ˆæ¯ï¼Ÿ"></a>6.Redisæ€ä¹ˆå®ç°å»¶æ—¶æ¶ˆæ¯ï¼Ÿ</h2><p>redisé€šè¿‡<strong>zset</strong>æœ‰åºé›†åˆæ¥å®ç°å»¶æ—¶æ¶ˆæ¯åŠŸèƒ½ã€‚å¯ä»¥å°†å‘é€çš„æ—¶é—´ä½œä¸º<strong>score</strong>å‘é€çš„å†…å®¹ä½œä¸ºvalueå­˜å‚¨åœ¨zsetä¸­ï¼Œ<strong>è½®è¯¢zsetæ£€æŸ¥å½“å‰æ—¶é—´æ˜¯å¦è¾¾æˆæ¶ˆæ¯çš„å‘é€æ—¶é—´ï¼Œæ¥å®ç°å»¶æ—¶æ¶ˆæ¯çš„æŠ•é€’ã€‚</strong>   </p><h2 id="7-Redisä¸­çš„Stringæ€ä¹ˆå®ç°çš„"><a href="#7-Redisä¸­çš„Stringæ€ä¹ˆå®ç°çš„" class="headerlink" title="7.Redisä¸­çš„Stringæ€ä¹ˆå®ç°çš„?"></a>7.Redisä¸­çš„Stringæ€ä¹ˆå®ç°çš„?</h2><p>Stringç»“æ„åº•å±‚æ˜¯<strong>ä¸€ä¸ªç®€å•åŠ¨æ€å­—ç¬¦ä¸²ï¼ˆsdsï¼‰</strong>ï¼Œæ”¯æŒæ‰©å®¹ï¼Œå­˜å‚¨å­—ç¬¦ä¸²ã€‚æ‰€ä»¥å¯åº”ç”¨äºå¾®ä¿¡æ–‡ç« çš„é˜…è¯»æ•°æˆ–ç‚¹èµ</p><p>Redisçš„Stringç±»å‹é‡‡ç”¨SDS(ç®€å•åŠ¨æ€å­—ç¬¦ä¸²)å®ç°ï¼Œç»“æ„åŒ…å«<strong>é•¿åº¦ã€ç©ºé—²ç©ºé—´å’Œå­—ç¬¦æ•°ç»„</strong>ã€‚æ”¯æŒ<strong>äºŒè¿›åˆ¶</strong>å®‰å…¨æ•°æ®å­˜å‚¨ï¼Œ<strong>è‡ªåŠ¨é¢„åˆ†é…ç©ºé—´å‡å°‘å†…å­˜é‡åˆ†é…æ¬¡æ•°</strong>ï¼Œé€šè¿‡lenå­—æ®µå®ç°O(1)æ—¶é—´å¤æ‚åº¦è·å–é•¿åº¦ï¼Œé‡‡ç”¨<strong>æƒ°æ€§ç©ºé—´é‡Šæ”¾ç­–ç•¥ä¼˜åŒ–æ€§èƒ½ã€‚</strong></p><h2 id="8-Redisä¸­çš„Zsetæ€ä¹ˆå®ç°çš„"><a href="#8-Redisä¸­çš„Zsetæ€ä¹ˆå®ç°çš„" class="headerlink" title="8.Redisä¸­çš„Zsetæ€ä¹ˆå®ç°çš„?"></a>8.Redisä¸­çš„Zsetæ€ä¹ˆå®ç°çš„?</h2><p>Redis çš„ ZSet ç±»å‹ç”± <strong>è·³è¡¨ï¼ˆSkipListï¼‰å’Œå“ˆå¸Œè¡¨ï¼ˆHashTableï¼‰å…±åŒå®ç°</strong>ï¼Œè·³è¡¨ç”¨äºæŒ‰ score æ’åºä»¥<strong>æ”¯æŒèŒƒå›´æŸ¥è¯¢å’Œæœ‰åºè®¿é—®</strong>ï¼Œå“ˆå¸Œè¡¨ç”¨äºå¿«é€Ÿæ ¹æ®æˆå‘˜ï¼ˆmemberï¼‰å®šä½å…¶åˆ†æ•°ã€‚<strong>æ’å…¥ã€åˆ é™¤ã€æŸ¥æ‰¾æ“ä½œå¹³å‡å¤æ‚åº¦ä¸º O(log N)</strong>ï¼Œæ”¯æŒé«˜æ•ˆçš„æ’åã€åˆ†æ•°èŒƒå›´æ£€ç´¢ã€æ’è¡Œæ¦œç­‰åŠŸèƒ½ã€‚ZSet ç»“æ„ç»“åˆäº†<strong>å“ˆå¸Œçš„å¿«é€Ÿå®šä½ä¸è·³è¡¨çš„æœ‰åºè®¿é—®ç‰¹æ€§</strong>ï¼Œæ˜¯ Redis ä¸­å®ç°æ’è¡Œæ¦œã€å»¶è¿Ÿé˜Ÿåˆ—ç­‰å…¸å‹åœºæ™¯çš„æ ¸å¿ƒæ•°æ®ç»“æ„ã€‚</p><h2 id="9-ä½¿ç”¨-Redis-å®ç°ä¸€ä¸ªæ’è¡Œæ¦œæ€ä¹ˆåšï¼Ÿ"><a href="#9-ä½¿ç”¨-Redis-å®ç°ä¸€ä¸ªæ’è¡Œæ¦œæ€ä¹ˆåšï¼Ÿ" class="headerlink" title="9.ä½¿ç”¨ Redis å®ç°ä¸€ä¸ªæ’è¡Œæ¦œæ€ä¹ˆåšï¼Ÿ"></a>9.ä½¿ç”¨ Redis å®ç°ä¸€ä¸ªæ’è¡Œæ¦œæ€ä¹ˆåšï¼Ÿ</h2><p>Redis æ’è¡Œæ¦œåŸºäº <strong>ZSetï¼ˆæœ‰åºé›†åˆï¼‰</strong> å®ç°ï¼Œæˆå‘˜ä¸ºç”¨æˆ·æ ‡è¯†ï¼Œscore è¡¨ç¤ºæ’åä¾æ®ï¼ˆå¦‚ç§¯åˆ†ã€åˆ†æ•°ç­‰ï¼‰ã€‚é€šè¿‡ <code>ZADD</code> æ·»åŠ æˆ–æ›´æ–°åˆ†æ•°ï¼Œ<code>ZREVRANGE</code> è·å–ä»é«˜åˆ°ä½çš„å‰ N åï¼Œ<code>ZREVRANK</code> æŸ¥è¯¢æŸä¸ªæˆå‘˜çš„å…·ä½“æ’åï¼Œ<code>ZINCRBY</code> å®ç°ç§¯åˆ†ç´¯åŠ ã€‚ZSet åº•å±‚ç”±è·³è¡¨å’Œå“ˆå¸Œè¡¨ç»„æˆï¼Œæ”¯æŒé«˜æ•ˆçš„æ’åæ›´æ–°å’ŒåŒºé—´æŸ¥è¯¢ï¼Œæ˜¯å®ç°ç§¯åˆ†æ¦œã€çƒ­åº¦æ¦œã€æ´»è·ƒæ¦œç­‰åœºæ™¯çš„å¸¸ç”¨ç»“æ„ã€‚</p><h2 id="10-å¦‚ä½•ç”¨rediså®ç°æ³¨å†Œä¸­å¿ƒï¼Ÿ"><a href="#10-å¦‚ä½•ç”¨rediså®ç°æ³¨å†Œä¸­å¿ƒï¼Ÿ" class="headerlink" title="10.å¦‚ä½•ç”¨rediså®ç°æ³¨å†Œä¸­å¿ƒï¼Ÿ"></a>10.å¦‚ä½•ç”¨rediså®ç°æ³¨å†Œä¸­å¿ƒï¼Ÿ</h2><p>Redis å®ç°æ³¨å†Œä¸­å¿ƒå¯åˆ©ç”¨ <strong>Hash + Set + TTL æœºåˆ¶</strong>ã€‚æœåŠ¡æ³¨å†Œæ—¶ä½¿ç”¨ <code>HSET</code> å°†æœåŠ¡ä¿¡æ¯ï¼ˆå¦‚ IPã€ç«¯å£ã€å…ƒæ•°æ®ï¼‰å­˜å…¥ <code>service:æœåŠ¡å:å®ä¾‹ID</code>ï¼Œå¹¶é€šè¿‡ <code>EXPIRE</code> è®¾ç½® TTLï¼ŒæœåŠ¡éœ€å®šæ—¶ç»­çº¦ã€‚å¯é€šè¿‡ <code>SCAN</code> æˆ–ç»´æŠ¤ä¸€ä¸ª <code>Set</code> å­˜å‚¨æ‰€æœ‰å®ä¾‹ IDã€‚æœåŠ¡å‘ç°æ—¶è¯»å– Hash ä¿¡æ¯ï¼Œè¿‡æ»¤è¿‡æœŸå®ä¾‹ï¼Œå®ç°ç®€æ˜“çš„æœåŠ¡æ³¨å†Œä¸å‘ç°æœºåˆ¶ã€‚é€‚åˆå¯¹ä¸€è‡´æ€§è¦æ±‚ä¸é«˜çš„å¾®æœåŠ¡åœºæ™¯ï¼Œå¦‚ç°åº¦å‘å¸ƒã€æœ¬åœ°å¼€å‘æ¨¡æ‹Ÿã€‚ç”Ÿäº§æ¨èä½¿ç”¨ä¸“ä¸šæ³¨å†Œä¸­å¿ƒå¦‚ Nacosã€Eurekaã€Consulã€‚</p><h2 id="11-ä»‹ç»ä¸€ä¸‹Redisçš„çº¿ç¨‹æ¨¡å‹ã€‚"><a href="#11-ä»‹ç»ä¸€ä¸‹Redisçš„çº¿ç¨‹æ¨¡å‹ã€‚" class="headerlink" title="11.ä»‹ç»ä¸€ä¸‹Redisçš„çº¿ç¨‹æ¨¡å‹ã€‚"></a>11.ä»‹ç»ä¸€ä¸‹Redisçš„çº¿ç¨‹æ¨¡å‹ã€‚</h2><p>Redis ä½¿ç”¨ <strong>å•çº¿ç¨‹å¤„ç†ç½‘ç»œè¯·æ±‚ + epoll I/O å¤šè·¯å¤ç”¨æœºåˆ¶</strong>ï¼Œé€šè¿‡ä¸€ä¸ªçº¿ç¨‹å®Œæˆæ‰€æœ‰å‘½ä»¤è§£æã€æ‰§è¡Œã€å“åº”è¿”å›ï¼Œé¿å…äº†å¤šçº¿ç¨‹çš„ä¸Šä¸‹æ–‡åˆ‡æ¢å¼€é”€ä¸é”ç«äº‰ã€‚é‡‡ç”¨ <strong>Reactor æ¨¡å¼</strong>ï¼ŒåŸºäº <code>epoll</code> ç›‘å¬å¤šä¸ªå®¢æˆ·ç«¯è¿æ¥çš„è¯»å†™äº‹ä»¶ï¼Œä½¿ç”¨ <strong>äº‹ä»¶é©±åŠ¨æœºåˆ¶</strong> å®ç°é«˜å¹¶å‘å¤„ç†ã€‚å†…éƒ¨é€šè¿‡é˜Ÿåˆ—å¤„ç†å®šæ—¶ä»»åŠ¡ï¼ˆå¦‚è¿‡æœŸé”®åˆ é™¤ï¼‰ã€å¼‚æ­¥ä»»åŠ¡ï¼ˆå¦‚ AOF é‡å†™ï¼‰ã€‚è™½ä¸ºå•çº¿ç¨‹ï¼Œä½†åœ¨è®¡ç®—å¯†é›†å’Œ I/O åœºæ™¯ä¸‹æ€§èƒ½éå¸¸ä¼˜å¼‚ã€‚Redis 6.0 èµ·å¼•å…¥ <strong>I/O çº¿ç¨‹</strong>ï¼Œç”¨äºè¯»å†™åˆ†ç¦»è¿›ä¸€æ­¥ä¼˜åŒ–æ€§èƒ½ï¼ˆå¼€å¯éœ€é…ç½® <code>io-threads</code>ï¼‰ã€‚</p><h2 id="12-ä»‹ç»ä¸€ä¸‹Redisçš„äº‹åŠ¡ã€‚"><a href="#12-ä»‹ç»ä¸€ä¸‹Redisçš„äº‹åŠ¡ã€‚" class="headerlink" title="12.ä»‹ç»ä¸€ä¸‹Redisçš„äº‹åŠ¡ã€‚"></a>12.ä»‹ç»ä¸€ä¸‹Redisçš„äº‹åŠ¡ã€‚</h2><p>Redis äº‹åŠ¡é€šè¿‡ <code>MULTI</code> å¼€å§‹ï¼Œ<code>EXEC</code> æ‰§è¡Œï¼Œä¸­é—´çš„å‘½ä»¤ä¼šè¢«é¡ºåºå…¥é˜Ÿï¼Œå½¢æˆä¸€ä¸ªäº‹åŠ¡é˜Ÿåˆ—ã€‚äº‹åŠ¡æœŸé—´æ‰§è¡Œå‘½ä»¤ä¸ä¼šç«‹å³ç”Ÿæ•ˆï¼Œè€Œæ˜¯ç­‰ <code>EXEC</code> ç»Ÿä¸€æ‰§è¡Œï¼Œå…·å¤‡<strong>åŸå­æ€§ï¼ˆè¦ä¹ˆå…¨éƒ¨æ‰§è¡Œï¼Œè¦ä¹ˆå…¨éƒ¨ä¸æ‰§è¡Œï¼‰</strong>ã€‚ä½†<strong>ä¸æ”¯æŒå›æ»š</strong>ï¼Œä¸­é€”æŸæ¡å‘½ä»¤å‡ºé”™ä¸ä¼šå½±å“å…¶ä»–å‘½ä»¤æ‰§è¡Œï¼ˆé™¤éæ˜¯è¯­æ³•é”™è¯¯ï¼‰ã€‚å¯ä»¥ä½¿ç”¨ <code>WATCH</code> ç›‘æ§ä¸€ä¸ªæˆ–å¤šä¸ª keyï¼Œåœ¨äº‹åŠ¡æ‰§è¡Œå‰è‹¥æœ‰æ”¹åŠ¨ï¼Œ<code>EXEC</code> ä¼šå¤±è´¥ï¼Œå®ç°<strong>ä¹è§‚é”æœºåˆ¶</strong>ã€‚<code>DISCARD</code> å¯ç”¨äºå–æ¶ˆäº‹åŠ¡ã€‚</p><p>ä¼˜ç‚¹ï¼šç®€æ´é«˜æ•ˆï¼Œé€‚ç”¨äºæ— éœ€å›æ»šçš„å°å‹æ‰¹é‡æ“ä½œã€‚<br> ç¼ºç‚¹ï¼šä¸æ”¯æŒéƒ¨åˆ†å¤±è´¥å›æ»šã€ä¸å…·å¤‡éš”ç¦»æ€§ï¼ˆéä¸²è¡Œæ‰§è¡Œï¼Œè¯»å†™ä¸éš”ç¦»ï¼‰ã€‚</p><h2 id="13-ä»‹ç»ä¸€ä¸‹Redis-IOå¤šè·¯å¤ç”¨æ¨¡å‹ã€‚"><a href="#13-ä»‹ç»ä¸€ä¸‹Redis-IOå¤šè·¯å¤ç”¨æ¨¡å‹ã€‚" class="headerlink" title="13.ä»‹ç»ä¸€ä¸‹Redis IOå¤šè·¯å¤ç”¨æ¨¡å‹ã€‚"></a>13.ä»‹ç»ä¸€ä¸‹Redis IOå¤šè·¯å¤ç”¨æ¨¡å‹ã€‚</h2><p>Redis çš„ IO å¤šè·¯å¤ç”¨æ¨¡å‹é‡‡ç”¨å•çº¿ç¨‹ç»“åˆæ“ä½œç³»ç»Ÿæä¾›çš„ <code>epoll</code>ï¼ˆLinuxï¼‰æˆ– <code>select/kqueue</code>ï¼ˆUnix ç³»ç»Ÿï¼‰å®ç°é«˜å¹¶å‘å¤„ç†ã€‚å®ƒé€šè¿‡äº‹ä»¶é©±åŠ¨çš„ <strong>Reactor æ¨¡å¼</strong>ï¼Œåœ¨ä¸€ä¸ªä¸»çº¿ç¨‹ä¸­å¾ªç¯ç›‘å¬å¤šä¸ªå®¢æˆ·ç«¯è¿æ¥çš„è¯»å†™äº‹ä»¶ï¼Œç»Ÿä¸€ç”±äº‹ä»¶åˆ†å‘å™¨ç®¡ç†ï¼Œä¸ä¾èµ–å¤šçº¿ç¨‹/å¤šè¿›ç¨‹ï¼Œé¿å…äº†ä¸Šä¸‹æ–‡åˆ‡æ¢å’Œçº¿ç¨‹é”å¼€é”€ã€‚æ‰€æœ‰å®¢æˆ·ç«¯è¯·æ±‚è¢«æ³¨å†Œä¸ºäº‹ä»¶ï¼Œæ”¾å…¥äº‹ä»¶é˜Ÿåˆ—ï¼Œå½“äº‹ä»¶è§¦å‘ï¼ˆå¦‚å¯è¯»ã€å¯å†™ï¼‰æ—¶ï¼ŒRedis ä¼šå°†å¯¹åº”çš„æ–‡ä»¶æè¿°ç¬¦åŠ å…¥å°±ç»ªé˜Ÿåˆ—ï¼Œä¸»çº¿ç¨‹ä»å°±ç»ªé˜Ÿåˆ—ä¸­å–å‡ºäº‹ä»¶ä¾æ¬¡å¤„ç†ã€‚Redis ä½¿ç”¨è¿™ä¸ªæ¨¡å‹èƒ½é«˜æ•ˆå¤„ç†æˆåƒä¸Šä¸‡ä¸ªè¿æ¥ï¼Œé€‚åˆçŸ­è¿æ¥ã€é«˜é¢‘ IO çš„åœºæ™¯ï¼Œæ ¸å¿ƒä¼˜åŠ¿æ˜¯ç»“æ„ç®€å•ã€å“åº”è¿…é€Ÿï¼Œä½†ç”±äºæ˜¯å•çº¿ç¨‹å¤„ç†å‘½ä»¤ï¼Œæ…¢æŸ¥è¯¢æˆ–é˜»å¡æ“ä½œä»éœ€è°¨æ…ä½¿ç”¨ã€‚</p><h2 id="14-è¯´è¯´Redisçš„å¤§keyï¼Œä¸ºä»€ä¹ˆä¼šäº§ç”Ÿå¤§keyï¼Ÿ"><a href="#14-è¯´è¯´Redisçš„å¤§keyï¼Œä¸ºä»€ä¹ˆä¼šäº§ç”Ÿå¤§keyï¼Ÿ" class="headerlink" title="14.è¯´è¯´Redisçš„å¤§keyï¼Œä¸ºä»€ä¹ˆä¼šäº§ç”Ÿå¤§keyï¼Ÿ"></a>14.è¯´è¯´Redisçš„å¤§keyï¼Œä¸ºä»€ä¹ˆä¼šäº§ç”Ÿå¤§keyï¼Ÿ</h2><p><strong>Redis å¤§ key</strong> æ˜¯æŒ‡ <strong>å•ä¸ª key å¯¹åº”çš„ value è¿‡å¤§</strong>ï¼Œæ¯”å¦‚å­—ç¬¦ä¸²å†…å®¹éå¸¸é•¿ã€é›†åˆå…ƒç´ ç‰¹åˆ«å¤šï¼Œæˆ–å“ˆå¸Œå­—æ®µæ•°é‡å·¨å¤§ç­‰ã€‚è¿™ç±» key ä¼šå ç”¨è¾ƒå¤šå†…å­˜ï¼Œå¹¶å¯èƒ½å¯¼è‡´é˜»å¡ã€å»¶è¿Ÿã€ç½‘ç»œå‹åŠ›ç­‰é—®é¢˜ã€‚</p><p><strong>å¤§ key çš„åŸå› </strong></p><ul><li><strong>æ•°æ®ç»“æ„è®¾è®¡ä¸åˆç†</strong>ï¼šæœªæ‹†åˆ†æˆ–å‹å…¥è¿‡å¤šå…ƒç´ ã€‚</li><li><strong>ç¼ºä¹è¿‡æœŸç­–ç•¥æˆ–æ¸…ç†æœºåˆ¶</strong>ï¼šæ•°æ®é•¿æœŸå †ç§¯ã€‚</li><li><strong>æ²¡æœ‰ç›‘æ§</strong>ï¼šå¤§ key æ— æ³•è¢«åŠæ—¶å‘ç°å¤„ç†ã€‚</li></ul><p><strong>å¤§ key çš„å±å®³</strong></p><ul><li><strong>é˜»å¡ Redis å•çº¿ç¨‹ï¼Œå½±å“æ•´ä½“æ€§èƒ½ã€‚</strong></li><li><strong>ç½‘ç»œä¼ è¾“è€—æ—¶ï¼Œå®¢æˆ·ç«¯è¶…æ—¶æˆ–æ‹’ç»æœåŠ¡ã€‚</strong></li><li><strong>é›†ç¾¤è¿ç§»/å¤‡ä»½å¼‚å¸¸ï¼Œå½±å“å¯ç”¨æ€§ã€‚</strong></li><li><strong>å†…å­˜å ç”¨å¼‚å¸¸ï¼Œè§¦å‘é¢‘ç¹æ·˜æ±°æˆ– OOMã€‚</strong></li></ul><p><strong>ä¼˜åŒ–å»ºè®®</strong></p><ul><li><strong>é™åˆ¶å…ƒç´ æ•°é‡ï¼Œé¿å…ä¸€æ¬¡æ€§å‹å…¥è¿‡å¤šæ•°æ®ã€‚</strong></li><li><strong>å°†å¤§ç»“æ„æ‹†æˆå¤šä¸ªå° keyï¼ˆå¦‚åˆ†é¡µã€åˆ†æ¡¶ï¼‰ã€‚</strong></li><li><strong>è®¾ç½® TTLï¼Œå®šæœŸæ¸…ç†å†å²æ•°æ®ã€‚</strong></li><li><strong>ä½¿ç”¨ MEMORY USAGEã€SCAN ç­‰å‘½ä»¤ç›‘æ§å¤§ keyã€‚</strong></li></ul><h2 id="15-ä»‹ç»ä¸€ä¸‹Redisçš„é›†ç¾¤æ¨¡å¼ã€‚"><a href="#15-ä»‹ç»ä¸€ä¸‹Redisçš„é›†ç¾¤æ¨¡å¼ã€‚" class="headerlink" title="15.ä»‹ç»ä¸€ä¸‹Redisçš„é›†ç¾¤æ¨¡å¼ã€‚"></a>15.ä»‹ç»ä¸€ä¸‹Redisçš„é›†ç¾¤æ¨¡å¼ã€‚</h2><p>Redisé›†ç¾¤æ¨¡å¼é€šè¿‡å°†æ•´ä¸ªæ•°æ®ç©ºé—´åˆ’åˆ†ä¸º16384ä¸ªå“ˆå¸Œæ§½ï¼ˆhash slotsï¼‰ï¼Œå¹¶å°†è¿™äº›æ§½åˆ†é…ç»™å¤šä¸ªèŠ‚ç‚¹ï¼Œå®ç°æ•°æ®çš„è‡ªåŠ¨åˆ†ç‰‡å’Œè´Ÿè½½å‡è¡¡ã€‚æ¯ä¸ªèŠ‚ç‚¹è´Ÿè´£ä¸€å®šèŒƒå›´çš„æ§½ï¼Œå®¢æˆ·ç«¯æ ¹æ®keyçš„å“ˆå¸Œå€¼è·¯ç”±åˆ°å¯¹åº”èŠ‚ç‚¹ã€‚é›†ç¾¤æ”¯æŒä¸»ä»å¤åˆ¶ï¼Œä¸»èŠ‚ç‚¹è´Ÿè´£è¯»å†™ï¼Œä»èŠ‚ç‚¹åšå¤‡ä»½ï¼Œä¸»èŠ‚ç‚¹æ•…éšœæ—¶ä»èŠ‚ç‚¹è‡ªåŠ¨æ¥ç®¡ï¼Œä¿è¯é«˜å¯ç”¨ã€‚èŠ‚ç‚¹é—´é€šè¿‡Gossipåè®®è¿›è¡ŒçŠ¶æ€é€šä¿¡å’Œæ•…éšœæ£€æµ‹ã€‚Redisé›†ç¾¤ä¼˜ç‚¹æ˜¯æ‰©å±•æ€§å¼ºã€è‡ªåŠ¨æ•…éšœæ¢å¤å’Œå®¢æˆ·ç«¯æ™ºèƒ½è·¯ç”±ï¼Œä½†ç®¡ç†å¤æ‚ä¸”è·¨æ§½æ“ä½œæœ‰é™åˆ¶ï¼Œç½‘ç»œåˆ†åŒºæ—¶å¯èƒ½å‡ºç°â€œåˆ†è£‚è„‘â€é—®é¢˜ã€‚æ€»ä½“è€Œè¨€ï¼ŒRedisé›†ç¾¤æ˜¯Rediså®ç°æ°´å¹³æ‰©å±•å’Œé«˜å¯ç”¨çš„å…³é”®æ–¹æ¡ˆã€‚</p><h2 id="16-å¦‚ä½•åˆ©ç”¨Rediså®ç°ä¸€ä¸ªåˆ†å¸ƒå¼é”ï¼Ÿ"><a href="#16-å¦‚ä½•åˆ©ç”¨Rediså®ç°ä¸€ä¸ªåˆ†å¸ƒå¼é”ï¼Ÿ" class="headerlink" title="16.å¦‚ä½•åˆ©ç”¨Rediså®ç°ä¸€ä¸ªåˆ†å¸ƒå¼é”ï¼Ÿ"></a>16.å¦‚ä½•åˆ©ç”¨Rediså®ç°ä¸€ä¸ªåˆ†å¸ƒå¼é”ï¼Ÿ</h2><p><strong>æ–¹æ¡ˆä¸€</strong>ï¼šSETNX + EXPIRE</p><p><strong>æ–¹æ¡ˆäºŒ</strong>ï¼šSETNX + valueå€¼æ˜¯ï¼ˆç³»ç»Ÿæ—¶é—´ + è¿‡æœŸæ—¶é—´ï¼‰</p><p><strong>æ–¹æ¡ˆä¸‰</strong>ï¼šä½¿ç”¨Luaè„šæœ¬ï¼ˆåŒ…å«SETNX + EXPIREä¸¤æ¡æŒ‡ä»¤ï¼‰</p><p><strong>æ–¹æ¡ˆå››</strong>ï¼šSETçš„æ‰©å±•å‘½ä»¤ï¼ˆSET EX PX NXï¼‰</p><p><strong>æ–¹æ¡ˆäº”</strong>ï¼šSET EX PX NX + æ ¡éªŒå”¯ä¸€éšæœºå€¼ï¼Œå†é‡Šæ”¾é”</p><p><strong>æ–¹æ¡ˆå…­</strong>ï¼šå¼€æºæ¡†æ¶ï¼šRedisson</p><p><strong>æ–¹æ¡ˆä¸ƒ</strong>ï¼šå¤šæœºå®ç°çš„åˆ†å¸ƒå¼é”Redlock</p><h2 id=""><a href="#" class="headerlink" title=" "></a> </h2><h1 id="æ•°æ®ç»“æ„"><a href="#æ•°æ®ç»“æ„" class="headerlink" title="æ•°æ®ç»“æ„"></a>æ•°æ®ç»“æ„</h1><h2 id="1-ZSetç”¨è¿‡å—"><a href="#1-ZSetç”¨è¿‡å—" class="headerlink" title="1.ZSetç”¨è¿‡å—"></a>1.ZSetç”¨è¿‡å—</h2><p>ç”¨è¿‡ zset å®ç°æ’è¡Œæ¦œçš„åŠŸèƒ½ã€‚</p><p>ä»¥åšæ–‡ç‚¹èµæ’åä¸ºä¾‹ï¼Œå°æ—å‘è¡¨äº†äº”ç¯‡åšæ–‡ï¼Œåˆ†åˆ«è·å¾—èµä¸º 200ã€40ã€100ã€50ã€150ã€‚</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">arcticle:1 æ–‡ç« è·å¾—äº†200ä¸ªèµ</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">ZADD user:xiaolin:ranking 200 arcticle:1</span></span><br><span class="line">(integer) 1</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">arcticle:2 æ–‡ç« è·å¾—äº†40ä¸ªèµ</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">ZADD user:xiaolin:ranking 40 arcticle:2</span></span><br><span class="line">(integer) 1</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">arcticle:3 æ–‡ç« è·å¾—äº†100ä¸ªèµ</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">ZADD user:xiaolin:ranking 100 arcticle:3</span></span><br><span class="line">(integer) 1</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">arcticle:4 æ–‡ç« è·å¾—äº†50ä¸ªèµ</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">ZADD user:xiaolin:ranking 50 arcticle:4</span></span><br><span class="line">(integer) 1</span><br><span class="line"><span class="meta prompt_"># </span><span class="language-bash">arcticle:5 æ–‡ç« è·å¾—äº†150ä¸ªèµ</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">ZADD user:xiaolin:ranking 150 arcticle:5</span></span><br><span class="line">(integer) 1</span><br></pre></td></tr></table></figure><p>æ–‡ç«  arcticle:4 æ–°å¢ä¸€ä¸ªèµï¼Œå¯ä»¥<strong>ä½¿ç”¨ ZINCRBY å‘½ä»¤</strong>ï¼ˆä¸ºæœ‰åºé›†åˆkeyä¸­å…ƒç´ memberçš„åˆ†å€¼åŠ ä¸Šincrementï¼‰ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">ZINCRBY user:xiaolin:ranking 1 arcticle:4</span></span><br><span class="line">&quot;51&quot;</span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹æŸç¯‡æ–‡ç« çš„èµæ•°ï¼Œå¯ä»¥ä½¿ç”¨ ZSCORE å‘½ä»¤ï¼ˆè¿”å›æœ‰åºé›†åˆkeyä¸­å…ƒç´ ä¸ªæ•°ï¼‰ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">ZSCORE user:xiaolin:ranking arcticle:4</span></span><br><span class="line">&quot;50&quot;</span><br></pre></td></tr></table></figure><p>è·å–å°æ—æ–‡ç« èµæ•°æœ€å¤šçš„ 3 ç¯‡æ–‡ç« ï¼Œå¯ä»¥ä½¿ç”¨ ZREVRANGE å‘½ä»¤ï¼ˆå€’åºè·å–æœ‰åºé›†åˆ key ä»startä¸‹æ ‡åˆ°stopä¸‹æ ‡çš„å…ƒç´ ï¼‰ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_"># </span><span class="language-bash">WITHSCORES è¡¨ç¤ºæŠŠ score ä¹Ÿæ˜¾ç¤ºå‡ºæ¥</span></span><br><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">ZREVRANGE user:xiaolin:ranking 0 2 WITHSCORES</span></span><br><span class="line">1) &quot;arcticle:1&quot;</span><br><span class="line">2) &quot;200&quot;</span><br><span class="line">3) &quot;arcticle:5&quot;</span><br><span class="line">4) &quot;150&quot;</span><br><span class="line">5) &quot;arcticle:3&quot;</span><br><span class="line">6) &quot;100&quot;</span><br></pre></td></tr></table></figure><p>è·å–å°æ— 100 èµåˆ° 200 èµçš„æ–‡ç« ï¼Œå¯ä»¥ä½¿ç”¨ ZRANGEBYSCORE å‘½ä»¤ï¼ˆè¿”å›æœ‰åºé›†åˆä¸­æŒ‡å®šåˆ†æ•°åŒºé—´å†…çš„æˆå‘˜ï¼Œåˆ†æ•°ç”±ä½åˆ°é«˜æ’åºï¼‰ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta prompt_">&gt; </span><span class="language-bash">ZRANGEBYSCORE user:xiaolin:ranking 100 200 WITHSCORES</span></span><br><span class="line">1) &quot;arcticle:3&quot;</span><br><span class="line">2) &quot;100&quot;</span><br><span class="line">3) &quot;arcticle:5&quot;</span><br><span class="line">4) &quot;150&quot;</span><br><span class="line">5) &quot;arcticle:1&quot;</span><br><span class="line">6) &quot;200&quot;</span><br></pre></td></tr></table></figure><h2 id="2-Zset-åº•å±‚æ˜¯æ€ä¹ˆå®ç°çš„ï¼Ÿ"><a href="#2-Zset-åº•å±‚æ˜¯æ€ä¹ˆå®ç°çš„ï¼Ÿ" class="headerlink" title="2.Zset åº•å±‚æ˜¯æ€ä¹ˆå®ç°çš„ï¼Ÿ"></a>2.Zset åº•å±‚æ˜¯æ€ä¹ˆå®ç°çš„ï¼Ÿ</h2><p>Zset ç±»å‹çš„åº•å±‚æ•°æ®ç»“æ„æ˜¯ç”±<strong>å‹ç¼©åˆ—è¡¨æˆ–è·³è¡¨</strong>å®ç°çš„ï¼š</p><ul><li>å¦‚æœæœ‰åºé›†åˆçš„å…ƒç´ ä¸ªæ•°å°äº 128 ä¸ªï¼Œå¹¶ä¸”æ¯ä¸ªå…ƒç´ çš„å€¼å°äº 64 å­—èŠ‚æ—¶ï¼ŒRedis ä¼šä½¿ç”¨<strong>å‹ç¼©åˆ—è¡¨</strong>ä½œä¸º Zset ç±»å‹çš„åº•å±‚æ•°æ®ç»“æ„ï¼›</li><li>å¦‚æœæœ‰åºé›†åˆçš„å…ƒç´ ä¸æ»¡è¶³ä¸Šé¢çš„æ¡ä»¶ï¼ŒRedis ä¼šä½¿ç”¨<strong>è·³è¡¨</strong>ä½œä¸º Zset ç±»å‹çš„åº•å±‚æ•°æ®ç»“æ„ï¼›</li></ul><p><strong>åœ¨ Redis 7.0 ä¸­ï¼Œå‹ç¼©åˆ—è¡¨æ•°æ®ç»“æ„å·²ç»åºŸå¼ƒäº†ï¼Œäº¤ç”± listpack æ•°æ®ç»“æ„æ¥å®ç°äº†ã€‚</strong></p><p>åº•å±‚å…¶å®ä¹Ÿæ˜¯ï¼šè·³è¡¨ï¼ˆskiplistï¼‰+ å“ˆå¸Œè¡¨ï¼ˆhashtableï¼‰è¿™æ˜¯æ•°æ®æ¯”è¾ƒå¤šçš„æ—¶å€™ æŸ¥æ‰¾ï¼Œæ·»åŠ å¤§é‡æ•°æ®ã€‚</p><p>å°‘çš„æ—¶å€™ä½¿ç”¨listpack/ziplist,å ç”¨å†…å­˜ä½ï¼Œä½†æ˜¯æŸ¥æ‰¾æ…¢ã€‚</p><h2 id="3-è·³è¡¨æ˜¯æ€ä¹ˆå®ç°çš„ï¼Ÿ"><a href="#3-è·³è¡¨æ˜¯æ€ä¹ˆå®ç°çš„ï¼Ÿ" class="headerlink" title="3.è·³è¡¨æ˜¯æ€ä¹ˆå®ç°çš„ï¼Ÿ"></a>3.è·³è¡¨æ˜¯æ€ä¹ˆå®ç°çš„ï¼Ÿ</h2><p>é“¾è¡¨åœ¨æŸ¥æ‰¾å…ƒç´ çš„æ—¶å€™ï¼Œå› ä¸ºéœ€è¦é€ä¸€æŸ¥æ‰¾ï¼Œæ‰€ä»¥æŸ¥è¯¢æ•ˆç‡éå¸¸ä½ï¼Œæ—¶é—´å¤æ‚åº¦æ˜¯O(N)ï¼Œäºæ˜¯å°±å‡ºç°äº†è·³è¡¨ã€‚<strong>è·³è¡¨æ˜¯åœ¨é“¾è¡¨åŸºç¡€ä¸Šæ”¹è¿›è¿‡æ¥çš„ï¼Œå®ç°äº†ä¸€ç§ã€Œå¤šå±‚ã€çš„æœ‰åºé“¾è¡¨</strong>ï¼Œè¿™æ ·çš„å¥½å¤„æ˜¯èƒ½å¿«è¯»å®šä½æ•°æ®ã€‚</p><p>é‚£è·³è¡¨é•¿ä»€ä¹ˆæ ·å‘¢ï¼Ÿæˆ‘è¿™é‡Œä¸¾ä¸ªä¾‹å­ï¼Œä¸‹å›¾å±•ç¤ºäº†ä¸€ä¸ªå±‚çº§ä¸º 3 çš„è·³è¡¨ã€‚</p><p><img src="https://cdn.xiaolincoding.com//picgo/1719804939236-89f12a47-b851-4d06-a5f3-399e1119db57.png" alt="img"></p><p>å›¾ä¸­å¤´èŠ‚ç‚¹æœ‰ L0~L2 ä¸‰ä¸ªå¤´æŒ‡é’ˆï¼Œåˆ†åˆ«æŒ‡å‘äº†ä¸åŒå±‚çº§çš„èŠ‚ç‚¹ï¼Œç„¶åæ¯ä¸ªå±‚çº§çš„èŠ‚ç‚¹éƒ½é€šè¿‡æŒ‡é’ˆè¿æ¥èµ·æ¥ï¼š</p><ul><li>L0 å±‚çº§å…±æœ‰ 5 ä¸ªèŠ‚ç‚¹ï¼Œåˆ†åˆ«æ˜¯èŠ‚ç‚¹1ã€2ã€3ã€4ã€5ï¼›</li><li>L1 å±‚çº§å…±æœ‰ 3 ä¸ªèŠ‚ç‚¹ï¼Œåˆ†åˆ«æ˜¯èŠ‚ç‚¹ 2ã€3ã€5ï¼›</li><li>L2 å±‚çº§åªæœ‰ 1 ä¸ªèŠ‚ç‚¹ï¼Œä¹Ÿå°±æ˜¯èŠ‚ç‚¹ 3 ã€‚</li></ul><p>å¦‚æœæˆ‘ä»¬è¦åœ¨é“¾è¡¨ä¸­æŸ¥æ‰¾èŠ‚ç‚¹ 4 è¿™ä¸ªå…ƒç´ ï¼Œåªèƒ½ä»å¤´å¼€å§‹éå†é“¾è¡¨ï¼Œéœ€è¦æŸ¥æ‰¾ 4 æ¬¡ï¼Œè€Œä½¿ç”¨äº†è·³è¡¨åï¼Œåªéœ€è¦æŸ¥æ‰¾ 2 æ¬¡å°±èƒ½å®šä½åˆ°èŠ‚ç‚¹ 4<strong>ï¼Œå› ä¸ºå¯ä»¥åœ¨å¤´èŠ‚ç‚¹ç›´æ¥ä» L2 å±‚çº§è·³åˆ°èŠ‚ç‚¹ 3ï¼Œç„¶åå†å¾€å‰éå†æ‰¾åˆ°èŠ‚ç‚¹ 4ã€‚</strong></p><p>å¯ä»¥çœ‹åˆ°ï¼Œ<strong>è¿™ä¸ªæŸ¥æ‰¾è¿‡ç¨‹å°±æ˜¯åœ¨å¤šä¸ªå±‚çº§ä¸Šè·³æ¥è·³å»ï¼Œæœ€åå®šä½åˆ°å…ƒç´ ã€‚å½“æ•°æ®é‡å¾ˆå¤§æ—¶ï¼Œè·³è¡¨çš„æŸ¥æ‰¾å¤æ‚åº¦å°±æ˜¯ O(logN)ã€‚</strong></p><p>é‚£è·³è¡¨èŠ‚ç‚¹æ˜¯æ€ä¹ˆå®ç°å¤šå±‚çº§çš„å‘¢ï¼Ÿè¿™å°±éœ€è¦çœ‹ã€Œè·³è¡¨èŠ‚ç‚¹ã€çš„æ•°æ®ç»“æ„äº†ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">typedef</span> <span class="class"><span class="keyword">struct</span> <span class="title">zskiplistNode</span> &#123;</span></span><br><span class="line">    <span class="comment">//Zset å¯¹è±¡çš„å…ƒç´ å€¼</span></span><br><span class="line">    sds ele;</span><br><span class="line">    <span class="comment">//å…ƒç´ æƒé‡å€¼</span></span><br><span class="line">    <span class="type">double</span> score;</span><br><span class="line">    <span class="comment">//åå‘æŒ‡é’ˆ</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">zskiplistNode</span> *<span class="title">backward</span>;</span></span><br><span class="line">  </span><br><span class="line">    <span class="comment">//èŠ‚ç‚¹çš„levelæ•°ç»„ï¼Œä¿å­˜æ¯å±‚ä¸Šçš„å‰å‘æŒ‡é’ˆå’Œè·¨åº¦</span></span><br><span class="line">    <span class="class"><span class="keyword">struct</span> <span class="title">zskiplistLevel</span> &#123;</span></span><br><span class="line">        <span class="class"><span class="keyword">struct</span> <span class="title">zskiplistNode</span> *<span class="title">forward</span>;</span></span><br><span class="line">        <span class="type">unsigned</span> <span class="type">long</span> span;</span><br><span class="line">    &#125; level[];</span><br><span class="line">&#125; zskiplistNode;</span><br></pre></td></tr></table></figure><p><strong>Zset å¯¹è±¡è¦åŒæ—¶ä¿å­˜ã€Œå…ƒç´ ã€å’Œã€Œå…ƒç´ çš„æƒé‡ã€</strong>ï¼Œå¯¹åº”åˆ°è·³è¡¨èŠ‚ç‚¹ç»“æ„é‡Œå°±æ˜¯ <strong>sds ç±»å‹çš„ ele å˜é‡å’Œ double ç±»å‹çš„ score å˜é‡ã€‚</strong>æ¯ä¸ªè·³è¡¨èŠ‚ç‚¹éƒ½æœ‰ä¸€ä¸ª<strong>åå‘æŒ‡é’ˆï¼ˆstruct zskiplistNode *backwardï¼‰ï¼ŒæŒ‡å‘å‰ä¸€ä¸ªèŠ‚ç‚¹ï¼Œç›®çš„æ˜¯ä¸ºäº†æ–¹ä¾¿ä»è·³è¡¨çš„å°¾èŠ‚ç‚¹å¼€å§‹è®¿é—®èŠ‚ç‚¹ï¼Œè¿™æ ·å€’åºæŸ¥æ‰¾æ—¶å¾ˆæ–¹ä¾¿ã€‚</strong></p><p>è·³è¡¨æ˜¯ä¸€ä¸ª<strong>å¸¦æœ‰å±‚çº§å…³ç³»</strong>çš„é“¾è¡¨ï¼Œè€Œä¸”æ¯ä¸€å±‚çº§å¯ä»¥åŒ…å«å¤šä¸ªèŠ‚ç‚¹ï¼Œæ¯ä¸€ä¸ªèŠ‚ç‚¹é€šè¿‡æŒ‡é’ˆè¿æ¥èµ·æ¥ï¼Œå®ç°è¿™ä¸€ç‰¹æ€§å°±æ˜¯é è·³è¡¨èŠ‚ç‚¹ç»“æ„ä½“ä¸­çš„<strong>zskiplistLevel ç»“æ„ä½“ç±»å‹çš„ level æ•°ç»„</strong>ã€‚</p><p>level æ•°ç»„ä¸­çš„æ¯ä¸€ä¸ªå…ƒç´ ä»£è¡¨è·³è¡¨çš„ä¸€å±‚ï¼Œä¹Ÿå°±æ˜¯ç”± zskiplistLevel ç»“æ„ä½“è¡¨ç¤ºï¼Œæ¯”å¦‚ leve[0] å°±è¡¨ç¤ºç¬¬ä¸€å±‚ï¼Œleve[1] å°±è¡¨ç¤ºç¬¬äºŒå±‚ã€‚zskiplistLevel ç»“æ„ä½“é‡Œå®šä¹‰äº†ã€ŒæŒ‡å‘ä¸‹ä¸€ä¸ªè·³è¡¨èŠ‚ç‚¹çš„æŒ‡é’ˆã€å’Œã€Œè·¨åº¦ã€ï¼Œè·¨åº¦æ—¶ç”¨æ¥è®°å½•ä¸¤ä¸ªèŠ‚ç‚¹ä¹‹é—´çš„è·ç¦»ã€‚</p><p>æ¯”å¦‚ï¼Œä¸‹é¢è¿™å¼ å›¾ï¼Œå±•ç¤ºäº†å„ä¸ªèŠ‚ç‚¹çš„è·¨åº¦ã€‚</p><p><img src="https://cdn.xiaolincoding.com//picgo/1719804939577-56390d43-28b7-4d20-accf-55c79a53142e.png" alt="img"></p><p>ç¬¬ä¸€çœ¼çœ‹åˆ°è·¨åº¦çš„æ—¶å€™ï¼Œä»¥ä¸ºæ˜¯éå†æ“ä½œæœ‰å…³ï¼Œå®é™…ä¸Šå¹¶æ²¡æœ‰ä»»ä½•å…³ç³»ï¼Œéå†æ“ä½œåªéœ€è¦ç”¨å‰å‘æŒ‡é’ˆï¼ˆstruct zskiplistNode *forwardï¼‰å°±å¯ä»¥å®Œæˆäº†ã€‚</p><p>Redis <strong>è·³è¡¨åœ¨åˆ›å»ºèŠ‚ç‚¹çš„æ—¶å€™ï¼Œéšæœºç”Ÿæˆæ¯ä¸ªèŠ‚ç‚¹çš„å±‚æ•°</strong>ï¼Œå¹¶æ²¡æœ‰ä¸¥æ ¼ç»´æŒç›¸é‚»ä¸¤å±‚çš„èŠ‚ç‚¹æ•°é‡æ¯”ä¾‹ä¸º 2 : 1 çš„æƒ…å†µã€‚</p><p>å…·ä½“çš„åšæ³•æ˜¯ï¼Œ<strong>è·³è¡¨åœ¨åˆ›å»ºèŠ‚ç‚¹æ—¶å€™ï¼Œä¼šç”ŸæˆèŒƒå›´ä¸º[0-1]çš„ä¸€ä¸ªéšæœºæ•°ï¼Œå¦‚æœè¿™ä¸ªéšæœºæ•°å°äº 0.25ï¼ˆç›¸å½“äºæ¦‚ç‡ 25%ï¼‰ï¼Œé‚£ä¹ˆå±‚æ•°å°±å¢åŠ  1 å±‚ï¼Œç„¶åç»§ç»­ç”Ÿæˆä¸‹ä¸€ä¸ªéšæœºæ•°ï¼Œç›´åˆ°éšæœºæ•°çš„ç»“æœå¤§äº 0.25 ç»“æŸï¼Œæœ€ç»ˆç¡®å®šè¯¥èŠ‚ç‚¹çš„å±‚æ•°</strong>ã€‚</p><p>è¿™æ ·çš„åšæ³•ï¼Œç›¸å½“äºæ¯å¢åŠ ä¸€å±‚çš„æ¦‚ç‡ä¸è¶…è¿‡ 25%ï¼Œå±‚æ•°è¶Šé«˜ï¼Œæ¦‚ç‡è¶Šä½ï¼Œå±‚é«˜æœ€å¤§é™åˆ¶æ˜¯ 64ã€‚</p><p>è™½ç„¶æˆ‘å‰é¢è®²è§£è·³è¡¨çš„æ—¶å€™ï¼Œå›¾ä¸­çš„è·³è¡¨çš„ã€Œå¤´èŠ‚ç‚¹ã€éƒ½æ˜¯ 3 å±‚é«˜ï¼Œä½†æ˜¯å…¶å®<strong>å¦‚æœå±‚é«˜æœ€å¤§é™åˆ¶æ˜¯ 64ï¼Œé‚£ä¹ˆåœ¨åˆ›å»ºè·³è¡¨ã€Œå¤´èŠ‚ç‚¹ã€çš„æ—¶å€™ï¼Œå°±ä¼šç›´æ¥åˆ›å»º 64 å±‚é«˜çš„å¤´èŠ‚ç‚¹</strong>ã€‚</p><h2 id="4-è·³è¡¨æ˜¯æ€ä¹ˆè®¾ç½®å±‚é«˜çš„ï¼Ÿ"><a href="#4-è·³è¡¨æ˜¯æ€ä¹ˆè®¾ç½®å±‚é«˜çš„ï¼Ÿ" class="headerlink" title="4.è·³è¡¨æ˜¯æ€ä¹ˆè®¾ç½®å±‚é«˜çš„ï¼Ÿ"></a>4.è·³è¡¨æ˜¯æ€ä¹ˆè®¾ç½®å±‚é«˜çš„ï¼Ÿ</h2><p>è·³è¡¨åœ¨åˆ›å»ºèŠ‚ç‚¹æ—¶å€™ï¼Œä¼šç”ŸæˆèŒƒå›´ä¸º[0-1]çš„ä¸€ä¸ªéšæœºæ•°ï¼Œå¦‚æœè¿™ä¸ªéšæœºæ•°å°äº 0.25ï¼ˆç›¸å½“äºæ¦‚ç‡ 25%ï¼‰ï¼Œé‚£ä¹ˆå±‚æ•°å°±å¢åŠ  1 å±‚ï¼Œç„¶åç»§ç»­ç”Ÿæˆä¸‹ä¸€ä¸ªéšæœºæ•°ï¼Œ<strong>ç›´åˆ°éšæœºæ•°çš„ç»“æœå¤§äº 0.25 ç»“æŸï¼Œæœ€ç»ˆç¡®å®šè¯¥èŠ‚ç‚¹çš„å±‚æ•°ã€‚</strong></p><h2 id="5-Redisä¸ºä»€ä¹ˆä½¿ç”¨è·³è¡¨è€Œä¸æ˜¯ç”¨B-æ ‘"><a href="#5-Redisä¸ºä»€ä¹ˆä½¿ç”¨è·³è¡¨è€Œä¸æ˜¯ç”¨B-æ ‘" class="headerlink" title="5.Redisä¸ºä»€ä¹ˆä½¿ç”¨è·³è¡¨è€Œä¸æ˜¯ç”¨B+æ ‘?"></a>5.Redisä¸ºä»€ä¹ˆä½¿ç”¨è·³è¡¨è€Œä¸æ˜¯ç”¨B+æ ‘?</h2><p>Redis æ˜¯å†…å­˜æ•°æ®åº“ï¼Œ<strong>è·³è¡¨åœ¨å®ç°ç®€å•æ€§ã€å†™å…¥æ€§èƒ½ã€å†…å­˜è®¿é—®æ¨¡å¼ç­‰æ–¹é¢çš„ç»¼åˆä¼˜åŠ¿</strong>ï¼Œä½¿å…¶æˆä¸ºæ›´åˆé€‚çš„é€‰æ‹©ã€‚</p><div class="table-container"><table><thead><tr><th style="text-align:left">ç»´åº¦</th><th style="text-align:left">è·³è¡¨ä¼˜åŠ¿</th><th style="text-align:left">B+ æ ‘åŠ£åŠ¿</th></tr></thead><tbody><tr><td style="text-align:left"><strong>å†…å­˜è®¿é—®</strong></td><td style="text-align:left">ç¬¦åˆCPUç¼“å­˜å±€éƒ¨æ€§ï¼ŒæŒ‡é’ˆè·³è½¬æ›´é«˜æ•ˆ</td><td style="text-align:left">èŠ‚ç‚¹ç»“æ„å¤æ‚ï¼Œç¼“å­˜ä¸å‹å¥½</td></tr><tr><td style="text-align:left"><strong>å®ç°å¤æ‚åº¦</strong></td><td style="text-align:left">ä»£ç ç®€æ´ï¼Œæ— å¤æ‚å¹³è¡¡æ“ä½œ</td><td style="text-align:left">èŠ‚ç‚¹åˆ†è£‚/åˆå¹¶é€»è¾‘å¤æ‚ï¼Œä»£ç é‡å¤§</td></tr><tr><td style="text-align:left"><strong>å†™å…¥æ€§èƒ½</strong></td><td style="text-align:left">æ’å…¥/åˆ é™¤ä»…éœ€è°ƒæ•´å±€éƒ¨æŒ‡é’ˆ</td><td style="text-align:left">æ’å…¥å¯èƒ½è§¦å‘é€’å½’èŠ‚ç‚¹åˆ†è£‚ï¼Œæˆæœ¬é«˜</td></tr><tr><td style="text-align:left"><strong>å†…å­˜å ç”¨</strong></td><td style="text-align:left">ç»“æ„ç´§å‡‘ï¼Œæ— å†…éƒ¨ç¢ç‰‡</td><td style="text-align:left">èŠ‚ç‚¹é¢„åˆ†é…å¯èƒ½æµªè´¹å†…å­˜</td></tr></tbody></table></div><p>Redis é€‰æ‹©ä½¿ç”¨è·³è¡¨ï¼ˆSkip Listï¼‰è€Œä¸æ˜¯ B+ æ ‘æ¥å®ç°æœ‰åºé›†åˆï¼ˆSorted Setï¼‰ç­‰æ•°æ®ç»“æ„ï¼Œæ˜¯ç»è¿‡å¤šæ–¹é¢æƒè¡¡åçš„ç»“æœã€‚ä»¥ä¸‹æ˜¯è¯¦ç»†çš„åŸå› åˆ†æï¼š</p><blockquote><p>1ã€å†…å­˜ç»“æ„ä¸è®¿é—®æ¨¡å¼çš„å·®å¼‚</p></blockquote><p><strong>B+ æ ‘çš„ç‰¹æ€§</strong></p><ul><li><strong>ç£ç›˜å‹å¥½</strong>ï¼šB+ æ ‘çš„è®¾è®¡ç›®æ ‡æ˜¯<strong>ä¼˜åŒ–ç£ç›˜I/O</strong>ï¼Œé€šè¿‡<strong>å‡å°‘æ ‘çš„é«˜åº¦æ¥é™ä½ç£ç›˜å¯»é“æ¬¡æ•°</strong>ï¼ˆä¾‹å¦‚ï¼Œä¸€ä¸ª3å±‚çš„B+æ ‘å¯ä»¥ç®¡ç†æ•°ç™¾ä¸‡æ•°æ®ï¼‰ã€‚</li><li><strong>èŠ‚ç‚¹å¡«å……ç‡é«˜</strong>ï¼šæ¯ä¸ªèŠ‚ç‚¹å­˜å‚¨å¤šä¸ªé”®å€¼ï¼ˆPage/Blockï¼‰ï¼Œé€‚åˆæ‰¹é‡è¯»å†™ã€‚</li><li><strong>èŒƒå›´æŸ¥è¯¢é«˜æ•ˆ</strong>ï¼šå¶å­èŠ‚ç‚¹å½¢æˆæœ‰åºé“¾è¡¨ï¼ŒèŒƒå›´æŸ¥è¯¢ï¼ˆå¦‚ <code>ZRANGE</code>ï¼‰æ€§èƒ½æä½³ã€‚</li></ul><p><strong>è·³è¡¨çš„ç‰¹æ€§</strong></p><ul><li><strong>å†…å­˜å‹å¥½</strong>ï¼šè·³è¡¨åŸºäºé“¾è¡¨ï¼Œé€šè¿‡å¤šçº§ç´¢å¼•åŠ é€ŸæŸ¥è¯¢ï¼Œ<strong>å†…å­˜è®¿é—®æ¨¡å¼æ›´ç¬¦åˆCPUç¼“å­˜å±€éƒ¨æ€§</strong>ï¼ˆæŒ‡é’ˆè·³è·ƒæ›´å°‘ï¼‰ã€‚</li><li><strong>ç®€å•çµæ´»</strong>ï¼šæ’å…¥/åˆ é™¤æ—¶ä»…éœ€è°ƒæ•´å±€éƒ¨æŒ‡é’ˆï¼Œæ— éœ€å¤æ‚çš„èŠ‚ç‚¹åˆ†è£‚ä¸åˆå¹¶ã€‚</li><li><strong>æ¦‚ç‡å¹³è¡¡</strong>ï¼šé€šè¿‡éšæœºå±‚é«˜å®ç°è¿‘ä¼¼å¹³è¡¡ï¼Œé¿å…äº†ä¸¥æ ¼çš„å¹³è¡¡çº¦æŸï¼ˆå¦‚çº¢é»‘æ ‘çš„æ—‹è½¬ï¼‰ã€‚</li></ul><p><strong>Redis æ˜¯å†…å­˜æ•°æ®åº“</strong>ï¼Œæ•°æ®å®Œå…¨å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œä¸éœ€è¦ä¼˜åŒ–ç£ç›˜I/Oï¼Œå› æ­¤ B+ æ ‘çš„ç£ç›˜å‹å¥½ç‰¹æ€§å¯¹ Redis æ„ä¹‰ä¸å¤§ã€‚è€Œè·³è¡¨çš„å†…å­˜è®¿é—®æ¨¡å¼æ›´ä¼˜ï¼Œæ›´é€‚åˆé«˜é¢‘çš„å†…å­˜æ“ä½œã€‚</p><blockquote><p>2ã€å®ç°å¤æ‚åº¦çš„å¯¹æ¯”</p></blockquote><p><strong>B+ æ ‘çš„å®ç°å¤æ‚åº¦</strong>ï¼š</p><ul><li><strong>èŠ‚ç‚¹åˆ†è£‚ä¸åˆå¹¶</strong>ï¼šæ’å…¥/åˆ é™¤æ—¶å¯èƒ½è§¦å‘èŠ‚ç‚¹åˆ†è£‚æˆ–åˆå¹¶ï¼Œéœ€è¦å¤æ‚çš„å†å¹³è¡¡é€»è¾‘ã€‚</li><li><strong>é”ç«äº‰</strong>ï¼šåœ¨å¹¶å‘ç¯å¢ƒä¸‹ï¼ŒB<strong>+ æ ‘çš„é”ç²’åº¦è¾ƒç²—ï¼ˆå¦‚é¡µé”ï¼‰ï¼Œå®¹æ˜“æˆä¸ºæ€§èƒ½ç“¶é¢ˆã€‚</strong></li><li><strong>ä»£ç å¤æ‚åº¦</strong>ï¼šB+ æ ‘çš„å®ç°éœ€è¦å¤„ç†å¤§é‡è¾¹ç•Œæ¡ä»¶ï¼ˆå¦‚æœ€å°å¡«å……å› å­ã€å…„å¼ŸèŠ‚ç‚¹å€Ÿç”¨ç­‰ï¼‰ã€‚</li></ul><p><strong>è·³è¡¨çš„å®ç°å¤æ‚åº¦</strong>ï¼š</p><ul><li><strong>æ— å†å¹³è¡¡æ“ä½œ</strong>ï¼šæ’å…¥æ—¶åªéœ€éšæœºç”Ÿæˆå±‚é«˜ï¼Œåˆ é™¤æ—¶ç›´æ¥<strong>ç§»é™¤èŠ‚ç‚¹å¹¶è°ƒæ•´æŒ‡é’ˆ</strong>ã€‚</li><li><strong>ç»†ç²’åº¦é”æˆ–æ— é”</strong>ï¼šè·³è¡¨å¯ä»¥é€šè¿‡åˆ†æ®µé”æˆ–æ— é”ç»“æ„ï¼ˆå¦‚ CASï¼‰å®ç°é«˜æ•ˆå¹¶å‘ã€‚</li><li><strong>ä»£ç ç®€æ´</strong>ï¼šRedis çš„è·³è¡¨æ ¸å¿ƒä»£ç ä»…éœ€çº¦ 200 è¡Œï¼ˆB+ æ ‘å®ç°é€šå¸¸éœ€è¦æ•°åƒè¡Œï¼‰ã€‚</li></ul><p><strong>å¯¹äº Redis è¿™ç§è¿½æ±‚é«˜æ€§èƒ½å’Œä»£ç ç®€æ´æ€§çš„é¡¹ç›®</strong>ï¼Œè·³è¡¨çš„ä½å®ç°å¤æ‚åº¦æ›´å…·å¸å¼•åŠ›ï¼ŒRedisä½œè€…Antirezæ›¾è¡¨ç¤ºï¼Œè·³è¡¨çš„å®ç°å¤æ‚åº¦è¿œä½äºå¹³è¡¡æ ‘ï¼Œä¸”æ€§èƒ½ç›¸è¿‘ï¼Œæ˜¯æ›´ä¼˜é€‰æ‹©ã€‚</p><blockquote><p>3ã€æ€§èƒ½å¯¹æ¯”</p></blockquote><p><strong>æŸ¥è¯¢æ€§èƒ½</strong></p><ul><li><strong>å•ç‚¹æŸ¥è¯¢</strong>ï¼šè·³è¡¨å’Œ B+ æ ‘çš„æ—¶é—´<strong>å¤æ‚åº¦å‡ä¸º <code>O(log N)</code>ï¼Œ</strong>ä½†è·³è¡¨çš„å®é™…å¸¸æ•°æ›´å°ï¼ˆå†…å­˜ä¸­æŒ‡é’ˆè·³è½¬æ¯”ç£ç›˜å—è®¿é—®å¿«å¾—å¤šï¼‰ã€‚</li><li><strong>èŒƒå›´æŸ¥è¯¢</strong>ï¼šB+ æ ‘çš„å¶å­é“¾è¡¨åœ¨èŒƒå›´æŸ¥è¯¢æ—¶å ä¼˜ï¼Œä½†è·³è¡¨é€šè¿‡åŒå‘é“¾è¡¨ä¹Ÿèƒ½é«˜æ•ˆæ”¯æŒ <code>ZRANGE</code> æ“ä½œã€‚</li></ul><p><strong>å†™å…¥æ€§èƒ½</strong></p><ul><li><strong>B+ æ ‘</strong>ï¼šæ’å…¥å¯èƒ½è§¦å‘èŠ‚ç‚¹åˆ†è£‚ï¼Œæ¶‰åŠçˆ¶èŠ‚ç‚¹é€’å½’æ›´æ–°ï¼Œæˆæœ¬è¾ƒé«˜ã€‚</li><li><strong>è·³è¡¨</strong>ï¼šæ’å…¥ä»…éœ€ä¿®æ”¹ç›¸é‚»èŠ‚ç‚¹çš„æŒ‡é’ˆï¼Œå†™å…¥æ€§èƒ½æ›´ä¼˜ï¼ˆRedis çš„ <code>ZADD</code> æ“ä½œæ—¶é—´å¤æ‚åº¦ä¸º <code>O(log N)</code>ï¼‰ã€‚</li></ul><p><strong>å®æµ‹æ•°æ®</strong>ï¼šåœ¨å†…å­˜ä¸­ï¼Œè·³è¡¨çš„æ’å…¥é€Ÿåº¦æ¯” B+ æ ‘å¿« 2-3 å€ï¼ŒæŸ¥è¯¢é€Ÿåº¦ç›¸å½“ã€‚</p><blockquote><p>4ã€å†…å­˜å ç”¨</p></blockquote><ul><li><strong>B+ æ ‘</strong>ï¼šæ¯ä¸ªèŠ‚ç‚¹éœ€è¦å­˜å‚¨å¤šä¸ªé”®å€¼å’Œå­èŠ‚ç‚¹æŒ‡é’ˆï¼Œå­˜åœ¨å†…éƒ¨ç¢ç‰‡ï¼ˆèŠ‚ç‚¹æœªå¡«æ»¡æ—¶ï¼‰ã€‚</li><li><strong>è·³è¡¨</strong>ï¼šæ¯ä¸ªèŠ‚ç‚¹åªéœ€å­˜å‚¨é”®å€¼ã€å±‚é«˜å’Œå¤šä¸ªå‰å‘æŒ‡é’ˆï¼Œå†…å­˜å ç”¨æ›´ç´§å‡‘ã€‚</li></ul><h2 id="6-å‹ç¼©åˆ—è¡¨æ˜¯æ€ä¹ˆå®ç°çš„ï¼Ÿ"><a href="#6-å‹ç¼©åˆ—è¡¨æ˜¯æ€ä¹ˆå®ç°çš„ï¼Ÿ" class="headerlink" title="6.å‹ç¼©åˆ—è¡¨æ˜¯æ€ä¹ˆå®ç°çš„ï¼Ÿ"></a>6.å‹ç¼©åˆ—è¡¨æ˜¯æ€ä¹ˆå®ç°çš„ï¼Ÿ</h2><p>å‹ç¼©åˆ—è¡¨æ˜¯ Redis ä¸ºäº†èŠ‚çº¦å†…å­˜è€Œå¼€å‘çš„ï¼Œå®ƒæ˜¯<strong>ç”±è¿ç»­å†…å­˜å—ç»„æˆçš„é¡ºåºå‹æ•°æ®ç»“æ„</strong>ï¼Œæœ‰ç‚¹ç±»ä¼¼äºæ•°ç»„ã€‚</p><p><img src="https://cdn.xiaolincoding.com//picgo/1720432496274-b95e1802-1ecd-4210-a987-733265534c64.png" alt="img"></p><p>å‹ç¼©åˆ—è¡¨åœ¨è¡¨å¤´æœ‰ä¸‰ä¸ªå­—æ®µï¼š</p><ul><li><strong><em>zlbytes\</em></strong>ï¼Œè®°å½•æ•´ä¸ªå‹ç¼©åˆ—è¡¨å ç”¨å¯¹å†…å­˜å­—èŠ‚æ•°ï¼›</li><li><strong><em>zltail\</em></strong>ï¼Œè®°å½•å‹ç¼©åˆ—è¡¨ã€Œå°¾éƒ¨ã€èŠ‚ç‚¹è·ç¦»èµ·å§‹åœ°å€ç”±å¤šå°‘å­—èŠ‚ï¼Œä¹Ÿå°±æ˜¯<strong>åˆ—è¡¨å°¾çš„åç§»é‡</strong>ï¼›</li><li><strong><em>zllen\</em></strong>ï¼Œè®°å½•å‹ç¼©åˆ—è¡¨åŒ…å«çš„èŠ‚ç‚¹æ•°é‡ï¼›</li><li><strong><em>zlend\</em></strong>ï¼Œæ ‡è®°å‹ç¼©åˆ—è¡¨çš„ç»“æŸç‚¹ï¼Œå›ºå®šå€¼ 0xFFï¼ˆåè¿›åˆ¶255ï¼‰ã€‚</li></ul><p>åœ¨å‹ç¼©åˆ—è¡¨ä¸­ï¼Œå¦‚æœæˆ‘ä»¬è¦æŸ¥æ‰¾å®šä½<strong>ç¬¬ä¸€ä¸ªå…ƒç´ å’Œæœ€åä¸€ä¸ªå…ƒç´ </strong>ï¼Œå¯ä»¥é€šè¿‡<strong>è¡¨å¤´ä¸‰ä¸ªå­—æ®µ</strong>ï¼ˆzllenï¼‰çš„é•¿åº¦ç›´æ¥å®šä½ï¼Œå¤æ‚åº¦æ˜¯ O(1)ã€‚è€Œ<strong>æŸ¥æ‰¾å…¶ä»–å…ƒç´ æ—¶ï¼Œå°±æ²¡æœ‰è¿™ä¹ˆé«˜æ•ˆäº†ï¼Œåªèƒ½é€ä¸ªæŸ¥æ‰¾ï¼Œæ­¤æ—¶çš„å¤æ‚åº¦å°±æ˜¯ O(N) äº†ï¼Œå› æ­¤å‹ç¼©åˆ—è¡¨ä¸é€‚åˆä¿å­˜è¿‡å¤šçš„å…ƒç´ </strong>ã€‚</p><p>å¦å¤–ï¼Œå‹ç¼©åˆ—è¡¨èŠ‚ç‚¹ï¼ˆentryï¼‰çš„æ„æˆå¦‚ä¸‹ï¼š</p><p><img src="https://cdn.xiaolincoding.com//picgo/1720432496229-46da5ac0-0e89-45cd-b1f8-151f7c6d4660.png" alt="img"></p><p>å‹ç¼©åˆ—è¡¨èŠ‚ç‚¹åŒ…å«ä¸‰éƒ¨åˆ†å†…å®¹ï¼š</p><ul><li><strong>prevlen</strong>ï¼Œè®°å½•äº†ã€Œå‰ä¸€ä¸ªèŠ‚ç‚¹ã€çš„é•¿åº¦ï¼Œ<strong>ç›®çš„æ˜¯ä¸ºäº†å®ç°ä»åå‘å‰éå†</strong>ï¼›</li><li><strong>encoding</strong>ï¼Œè®°å½•äº†å½“å‰èŠ‚ç‚¹å®é™…æ•°æ®çš„ã€Œ<strong>ç±»å‹å’Œé•¿åº¦ã€ï¼Œç±»å‹ä¸»è¦æœ‰ä¸¤ç§ï¼šå­—ç¬¦ä¸²å’Œæ•´æ•°ã€‚</strong></li><li><strong>data</strong>ï¼Œè®°å½•äº†å½“å‰èŠ‚ç‚¹çš„å®é™…æ•°æ®ï¼Œç±»å‹å’Œé•¿åº¦éƒ½ç”± encoding å†³å®šï¼›</li></ul><p>å½“æˆ‘ä»¬å¾€å‹ç¼©åˆ—è¡¨ä¸­æ’å…¥æ•°æ®æ—¶ï¼Œå‹ç¼©åˆ—è¡¨å°±ä¼šæ ¹æ®æ•°æ®ç±»å‹æ˜¯å­—ç¬¦ä¸²è¿˜æ˜¯æ•´æ•°ï¼Œä»¥åŠæ•°æ®çš„å¤§å°ï¼Œä¼šä½¿ç”¨ä¸åŒç©ºé—´å¤§å°çš„ prevlen å’Œ encoding è¿™ä¸¤ä¸ªå…ƒç´ é‡Œä¿å­˜çš„ä¿¡æ¯ï¼Œ<strong>è¿™ç§æ ¹æ®æ•°æ®å¤§å°å’Œç±»å‹è¿›è¡Œä¸åŒçš„ç©ºé—´å¤§å°åˆ†é…çš„è®¾è®¡æ€æƒ³ï¼Œæ­£æ˜¯ Redis ä¸ºäº†èŠ‚çœå†…å­˜è€Œé‡‡ç”¨çš„</strong>ã€‚</p><p>å‹ç¼©åˆ—è¡¨çš„ç¼ºç‚¹æ˜¯ä¼šå‘ç”Ÿ<strong>è¿é”æ›´æ–°</strong>çš„é—®é¢˜ï¼Œå› æ­¤<strong>è¿é”æ›´æ–°ä¸€æ—¦å‘ç”Ÿï¼Œå°±ä¼šå¯¼è‡´å‹ç¼©åˆ—è¡¨å ç”¨çš„å†…å­˜ç©ºé—´è¦å¤šæ¬¡é‡æ–°åˆ†é…ï¼Œè¿™å°±ä¼šç›´æ¥å½±å“åˆ°å‹ç¼©åˆ—è¡¨çš„è®¿é—®æ€§èƒ½</strong>ã€‚</p><p>æ‰€ä»¥è¯´ï¼Œ<strong>è™½ç„¶å‹ç¼©åˆ—è¡¨ç´§å‡‘å‹çš„å†…å­˜å¸ƒå±€èƒ½èŠ‚çœå†…å­˜å¼€é”€ï¼Œä½†æ˜¯å¦‚æœä¿å­˜çš„å…ƒç´ æ•°é‡å¢åŠ äº†ï¼Œæˆ–æ˜¯å…ƒç´ å˜å¤§äº†ï¼Œä¼šå¯¼è‡´å†…å­˜é‡æ–°åˆ†é…ï¼Œæœ€ç³Ÿç³•çš„æ˜¯ä¼šæœ‰ã€Œè¿é”æ›´æ–°ã€çš„é—®é¢˜</strong>ã€‚</p><p>å› æ­¤ï¼Œ<strong>å‹ç¼©åˆ—è¡¨åªä¼šç”¨äºä¿å­˜çš„èŠ‚ç‚¹æ•°é‡ä¸å¤šçš„åœºæ™¯</strong>ï¼Œåªè¦èŠ‚ç‚¹æ•°é‡è¶³å¤Ÿå°ï¼Œå³ä½¿å‘ç”Ÿè¿é”æ›´æ–°ï¼Œä¹Ÿæ˜¯èƒ½æ¥å—çš„ã€‚</p><p>è™½è¯´å¦‚æ­¤ï¼ŒRedis é’ˆå¯¹å‹ç¼©åˆ—è¡¨åœ¨è®¾è®¡ä¸Šçš„ä¸è¶³ï¼Œåœ¨åæ¥çš„ç‰ˆæœ¬ä¸­ï¼Œæ–°å¢è®¾è®¡äº†ä¸¤ç§æ•°æ®ç»“æ„ï¼š<strong>quicklistï¼ˆRedis 3.2 å¼•å…¥ï¼‰ å’Œ listpackï¼ˆRedis 5.0 å¼•å…¥ï¼‰</strong>ã€‚è¿™ä¸¤ç§æ•°æ®ç»“æ„çš„è®¾è®¡ç›®æ ‡ï¼Œå°±æ˜¯å°½å¯èƒ½åœ°ä¿æŒå‹ç¼©åˆ—è¡¨èŠ‚çœå†…å­˜çš„ä¼˜åŠ¿ï¼ŒåŒæ—¶è§£å†³å‹ç¼©åˆ—è¡¨çš„ã€Œè¿é”æ›´æ–°ã€çš„é—®é¢˜ã€‚</p><h2 id="7-ä»€ä¹ˆæ˜¯è¿é”æ›´æ–°"><a href="#7-ä»€ä¹ˆæ˜¯è¿é”æ›´æ–°" class="headerlink" title="7.ä»€ä¹ˆæ˜¯è¿é”æ›´æ–°"></a>7.ä»€ä¹ˆæ˜¯è¿é”æ›´æ–°</h2><p><strong>â€œè¿é”æ›´æ–°â€</strong> æ˜¯å‹ç¼©åˆ—è¡¨ï¼ˆ<code>ziplist</code>ï¼‰åœ¨æ‰§è¡Œæ’å…¥æˆ–ä¿®æ”¹æ“ä½œæ—¶å¯èƒ½å¼•å‘çš„ä¸€ç§<strong>æ€§èƒ½é—®é¢˜</strong>ã€‚å®ƒçš„æ ¸å¿ƒåŸå› æ˜¯ï¼š<strong>èŠ‚ç‚¹å¤´éƒ¨çš„ <code>prevlen</code> å­—æ®µé•¿åº¦æ˜¯å˜é•¿çš„</strong>ï¼Œå½“æ’å…¥æˆ–ä¿®æ”¹ä¸€ä¸ªèŠ‚ç‚¹å¯¼è‡´æŸä¸ª <code>prevlen</code> å­—æ®µçš„å­—èŠ‚é•¿åº¦å‘ç”Ÿå˜åŒ–æ—¶ï¼Œä¼š<strong>å½±å“åç»­æ‰€æœ‰èŠ‚ç‚¹çš„ä½ç½®ï¼Œä»è€Œå¼•å‘çº§è”çš„å†…å­˜æ›´æ–°</strong>ã€‚</p><p>å¦‚æœå‰ä¸€ä¸ªèŠ‚ç‚¹çš„é•¿åº¦ â‰¥ 254 å­—èŠ‚ï¼Œåˆ™éœ€è¦ <strong>5 ä¸ªå­—èŠ‚</strong>ï¼ˆ1 + 4ï¼‰æ¥å­˜å‚¨ï¼Œæ‰€ä»¥æ’å…¥äº†ä¸€ä¸ªå¾ˆå¤§çš„èŠ‚ç‚¹çš„è¯ï¼Œä¸‹ä¸€ä¸ªèŠ‚ç‚¹çš„prelenå°±è¦å˜æˆ5ä¸ªå­—èŠ‚ï¼Œç„¶åæ•´ä¸ªé“¾æ¡éƒ½è¦è¿›è¡Œç§»åŠ¨æ›´æ–°ã€‚</p><p>æ‰€ä»¥å¼•å…¥äº†quicklistå’Œlistpackã€‚ä½¿ç”¨quicklistä»£æ›¿listçš„ziplist,listpackä»£æ›¿hash/zsetçš„ziplistã€‚</p><h2 id="8-ä»‹ç»ä¸€ä¸‹-Redis-ä¸­çš„-listpack"><a href="#8-ä»‹ç»ä¸€ä¸‹-Redis-ä¸­çš„-listpack" class="headerlink" title="8.ä»‹ç»ä¸€ä¸‹ Redis ä¸­çš„ listpack"></a>8.ä»‹ç»ä¸€ä¸‹ Redis ä¸­çš„ listpack</h2><p>quicklist è™½ç„¶é€šè¿‡æ§åˆ¶ <strong>quicklistNode ç»“æ„é‡Œçš„å‹ç¼©åˆ—è¡¨çš„å¤§å°æˆ–è€…å…ƒç´ ä¸ªæ•°ï¼Œæ¥å‡å°‘è¿é”æ›´æ–°å¸¦æ¥çš„æ€§èƒ½å½±å“ï¼Œä½†æ˜¯å¹¶æ²¡æœ‰å®Œå…¨è§£å†³è¿é”æ›´æ–°çš„é—®é¢˜ã€‚</strong></p><p>å› ä¸º quicklistNode è¿˜æ˜¯ç”¨äº†å‹ç¼©åˆ—è¡¨æ¥ä¿å­˜å…ƒç´ ï¼Œå‹ç¼©åˆ—è¡¨è¿é”æ›´æ–°çš„é—®é¢˜ï¼Œæ¥æºäºå®ƒçš„ç»“æ„è®¾è®¡ï¼Œæ‰€ä»¥è¦æƒ³å½»åº•è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œéœ€è¦è®¾è®¡ä¸€ä¸ªæ–°çš„æ•°æ®ç»“æ„ã€‚</p><p>äºæ˜¯ï¼ŒRedis åœ¨ 5.0 æ–°è®¾è®¡ä¸€ä¸ªæ•°æ®ç»“æ„å« <strong>listpack</strong>ï¼Œç›®çš„æ˜¯æ›¿ä»£å‹ç¼©åˆ—è¡¨ï¼Œ<strong>å®ƒæœ€å¤§ç‰¹ç‚¹æ˜¯ listpack ä¸­æ¯ä¸ªèŠ‚ç‚¹ä¸å†åŒ…å«å‰ä¸€ä¸ªèŠ‚ç‚¹çš„é•¿åº¦äº†</strong>ï¼Œå‹ç¼©åˆ—è¡¨æ¯ä¸ªèŠ‚ç‚¹æ­£å› ä¸ºéœ€è¦ä¿å­˜å‰ä¸€ä¸ªèŠ‚ç‚¹çš„é•¿åº¦å­—æ®µï¼Œå°±ä¼šæœ‰è¿é”æ›´æ–°çš„éšæ‚£ã€‚</p><p>listpack é‡‡ç”¨äº†å‹ç¼©åˆ—è¡¨çš„å¾ˆå¤šä¼˜ç§€çš„è®¾è®¡ï¼Œæ¯”å¦‚<strong>è¿˜æ˜¯ç”¨ä¸€å—è¿ç»­çš„å†…å­˜ç©ºé—´æ¥ç´§å‡‘åœ°ä¿å­˜æ•°æ®</strong>ï¼Œå¹¶ä¸”ä¸ºäº†èŠ‚çœå†…å­˜çš„å¼€é”€ï¼Œlistpack èŠ‚ç‚¹ä¼šé‡‡ç”¨ä¸åŒçš„ç¼–ç æ–¹å¼ä¿å­˜ä¸åŒå¤§å°çš„æ•°æ®ã€‚</p><p>æˆ‘ä»¬å…ˆçœ‹çœ‹ listpack ç»“æ„ï¼š</p><p><img src="https://cdn.xiaolincoding.com//picgo/1719035634188-584809ba-ea0b-48ff-a547-9ee4d1b4d365.png" alt="img"></p><p>listpack å¤´åŒ…å«ä¸¤ä¸ªå±æ€§ï¼Œåˆ†åˆ«è®°å½•äº† <strong>listpack æ€»å­—èŠ‚æ•°å’Œå…ƒç´ æ•°é‡</strong>ï¼Œç„¶å listpack æœ«å°¾ä¹Ÿæœ‰ä¸ª<strong>ç»“å°¾æ ‡è¯†</strong>ã€‚å›¾ä¸­çš„ listpack entry å°±æ˜¯ listpack çš„èŠ‚ç‚¹äº†ã€‚</p><p>æ¯ä¸ª listpack èŠ‚ç‚¹ç»“æ„å¦‚ä¸‹ï¼š</p><p><img src="https://cdn.xiaolincoding.com//picgo/1719035634415-c436d60e-58a7-4dfc-9e69-db8e2f96d19c.png" alt="img"></p><p>ä¸»è¦åŒ…å«ä¸‰ä¸ªæ–¹é¢å†…å®¹ï¼š</p><ul><li>encodingï¼Œå®šä¹‰è¯¥å…ƒç´ çš„ç¼–ç ç±»å‹ï¼Œä¼šå¯¹ä¸åŒé•¿åº¦çš„æ•´æ•°å’Œå­—ç¬¦ä¸²è¿›è¡Œç¼–ç ï¼›</li><li>dataï¼Œå®é™…å­˜æ”¾çš„æ•°æ®ï¼›</li><li>lenï¼Œ<strong>encoding+dataçš„æ€»é•¿åº¦ï¼›</strong></li></ul><p>å¯ä»¥çœ‹åˆ°ï¼Œ<strong>listpack æ²¡æœ‰å‹ç¼©åˆ—è¡¨ä¸­è®°å½•å‰ä¸€ä¸ªèŠ‚ç‚¹é•¿åº¦çš„å­—æ®µäº†ï¼Œlistpack åªè®°å½•å½“å‰èŠ‚ç‚¹çš„é•¿åº¦ï¼Œå½“æˆ‘ä»¬å‘ listpack åŠ å…¥ä¸€ä¸ªæ–°å…ƒç´ çš„æ—¶å€™ï¼Œä¸ä¼šå½±å“å…¶ä»–èŠ‚ç‚¹çš„é•¿åº¦å­—æ®µçš„å˜åŒ–ï¼Œä»è€Œé¿å…äº†å‹ç¼©åˆ—è¡¨çš„è¿é”æ›´æ–°é—®é¢˜</strong>ã€‚</p><h2 id="9-å“ˆå¸Œè¡¨æ˜¯æ€ä¹ˆæ‰©å®¹çš„ï¼Ÿ"><a href="#9-å“ˆå¸Œè¡¨æ˜¯æ€ä¹ˆæ‰©å®¹çš„ï¼Ÿ" class="headerlink" title="9.å“ˆå¸Œè¡¨æ˜¯æ€ä¹ˆæ‰©å®¹çš„ï¼Ÿ"></a>9.å“ˆå¸Œè¡¨æ˜¯æ€ä¹ˆæ‰©å®¹çš„ï¼Ÿ</h2><p>è¿›è¡Œ rehash çš„æ—¶å€™ï¼Œéœ€è¦ç”¨ä¸Š 2 ä¸ªå“ˆå¸Œè¡¨äº†ã€‚</p><p><img src="https://cdn.xiaolincoding.com//picgo/image-20240725232515019.png" alt="image-20240725232515019"></p><p>åœ¨<strong>æ­£å¸¸æœåŠ¡è¯·æ±‚é˜¶æ®µï¼Œæ’å…¥çš„æ•°æ®ï¼Œéƒ½ä¼šå†™å…¥åˆ°ã€Œå“ˆå¸Œè¡¨ 1ã€</strong>ï¼Œæ­¤æ—¶çš„ã€Œå“ˆå¸Œè¡¨ 2 ã€ å¹¶æ²¡æœ‰è¢«åˆ†é…ç©ºé—´ã€‚</p><p>éšç€<strong>æ•°æ®é€æ­¥å¢å¤š</strong>ï¼Œè§¦å‘äº† rehash æ“ä½œï¼Œè¿™ä¸ªè¿‡ç¨‹åˆ†ä¸ºä¸‰æ­¥ï¼š</p><ul><li>ç»™ã€Œå“ˆå¸Œè¡¨ 2ã€ åˆ†é…ç©ºé—´ï¼Œ<strong>ä¸€èˆ¬ä¼šæ¯”ã€Œå“ˆå¸Œè¡¨ 1ã€ å¤§ 2 å€ï¼›</strong></li><li>å°†ã€Œå“ˆå¸Œè¡¨ 1 ã€çš„æ•°æ®è¿ç§»åˆ°ã€Œå“ˆå¸Œè¡¨ 2ã€ ä¸­ï¼›</li><li>è¿ç§»å®Œæˆåï¼Œã€Œå“ˆå¸Œè¡¨ 1 ã€çš„ç©ºé—´ä¼šè¢«é‡Šæ”¾ï¼Œå¹¶æŠŠã€Œå“ˆå¸Œè¡¨ 2ã€ è®¾ç½®ä¸ºã€Œå“ˆå¸Œè¡¨ 1ã€ï¼Œç„¶ååœ¨ã€Œå“ˆå¸Œè¡¨ 2ã€ <strong>æ–°åˆ›å»ºä¸€ä¸ªç©ºç™½çš„å“ˆå¸Œè¡¨ï¼Œä¸ºä¸‹æ¬¡ rehash åšå‡†å¤‡ã€‚</strong></li><li>è¿™ä¸ªè·Ÿarraylistçš„å¤åˆ¶å·®ä¸å¤šï¼Œåªä¸è¿‡æ‰©å®¹çš„é•¿åº¦ä¸ç›¸åŒã€‚ä½†æ˜¯è·Ÿhashmapçš„æ‰©å®¹ä¸€æ ·</li></ul><p>ä¸ºäº†æ–¹ä¾¿ä½ ç†è§£ï¼Œæˆ‘æŠŠ rehash è¿™ä¸‰ä¸ªè¿‡ç¨‹ç”»åœ¨äº†ä¸‹é¢è¿™å¼ å›¾ï¼š</p><p><img src="https://cdn.xiaolincoding.com//picgo/image-20240725232528097.png" alt="image-20240725232528097"></p><p>è¿™ä¸ªè¿‡ç¨‹çœ‹èµ·æ¥ç®€å•ï¼Œä½†æ˜¯å…¶å®ç¬¬äºŒæ­¥å¾ˆæœ‰é—®é¢˜ï¼Œ<strong>å¦‚æœã€Œå“ˆå¸Œè¡¨ 1 ã€çš„æ•°æ®é‡éå¸¸å¤§ï¼Œé‚£ä¹ˆåœ¨è¿ç§»è‡³ã€Œå“ˆå¸Œè¡¨ 2 ã€çš„æ—¶å€™ï¼Œå› ä¸ºä¼šæ¶‰åŠå¤§é‡çš„æ•°æ®æ‹·è´ï¼Œæ­¤æ—¶å¯èƒ½ä¼šå¯¹ Redis é€ æˆé˜»å¡ï¼Œæ— æ³•æœåŠ¡å…¶ä»–è¯·æ±‚</strong>ã€‚</p><p>ä¸ºäº†é¿å… rehash åœ¨æ•°æ®è¿ç§»è¿‡ç¨‹ä¸­ï¼Œå› æ‹·è´æ•°æ®çš„è€—æ—¶ï¼Œå½±å“ Redis æ€§èƒ½çš„æƒ…å†µï¼Œæ‰€ä»¥ Redis é‡‡ç”¨äº†<strong>æ¸è¿›å¼ rehash</strong>ï¼Œä¹Ÿå°±æ˜¯å°†æ•°æ®çš„è¿ç§»çš„å·¥ä½œä¸å†æ˜¯ä¸€æ¬¡æ€§è¿ç§»å®Œæˆï¼Œè€Œæ˜¯åˆ†å¤šæ¬¡è¿ç§»ã€‚</p><p>æ¸è¿›å¼ rehash æ­¥éª¤å¦‚ä¸‹ï¼š</p><ul><li>ç»™ã€Œå“ˆå¸Œè¡¨ 2ã€ åˆ†é…ç©ºé—´ï¼›</li><li><strong>åœ¨ rehash è¿›è¡ŒæœŸé—´ï¼Œæ¯æ¬¡å“ˆå¸Œè¡¨å…ƒç´ è¿›è¡Œæ–°å¢ã€åˆ é™¤ã€æŸ¥æ‰¾æˆ–è€…æ›´æ–°æ“ä½œæ—¶ï¼ŒRedis é™¤äº†ä¼šæ‰§è¡Œå¯¹åº”çš„æ“ä½œä¹‹å¤–ï¼Œè¿˜ä¼šé¡ºåºå°†ã€Œå“ˆå¸Œè¡¨ 1 ã€ä¸­ç´¢å¼•ä½ç½®ä¸Šçš„æ‰€æœ‰ key-value è¿ç§»åˆ°ã€Œå“ˆå¸Œè¡¨ 2ã€ ä¸Š</strong>ï¼›</li><li>éšç€<strong>å¤„ç†å®¢æˆ·ç«¯å‘èµ·çš„å“ˆå¸Œè¡¨æ“ä½œè¯·æ±‚æ•°é‡è¶Šå¤šï¼Œæœ€ç»ˆåœ¨æŸä¸ªæ—¶é—´ç‚¹ä¼šæŠŠã€Œå“ˆå¸Œè¡¨ 1 ã€çš„æ‰€æœ‰ key-value è¿ç§»åˆ°ã€Œå“ˆå¸Œè¡¨ 2ã€ï¼Œä»è€Œå®Œæˆ rehash æ“ä½œã€‚</strong></li></ul><p>è¿™æ ·å°±å·§å¦™åœ°æŠŠä¸€æ¬¡æ€§å¤§é‡æ•°æ®è¿ç§»å·¥ä½œçš„å¼€é”€<strong>ï¼Œåˆ†æ‘Šåˆ°äº†å¤šæ¬¡å¤„ç†è¯·æ±‚çš„è¿‡ç¨‹ä¸­</strong>ï¼Œé¿å…äº†ä¸€æ¬¡æ€§ rehash çš„è€—æ—¶æ“ä½œã€‚</p><p>åœ¨è¿›è¡Œæ¸è¿›å¼ rehash çš„è¿‡ç¨‹ä¸­ï¼Œä¼šæœ‰ä¸¤ä¸ªå“ˆå¸Œè¡¨ï¼Œæ‰€ä»¥åœ¨æ¸è¿›å¼ rehash è¿›è¡ŒæœŸé—´ï¼Œ<strong>å“ˆå¸Œè¡¨å…ƒç´ çš„åˆ é™¤ã€æŸ¥æ‰¾ã€æ›´æ–°ç­‰æ“ä½œéƒ½ä¼šåœ¨è¿™ä¸¤ä¸ªå“ˆå¸Œè¡¨è¿›è¡Œã€‚</strong>æ¯”å¦‚ï¼ŒæŸ¥æ‰¾ä¸€ä¸ª key çš„å€¼çš„è¯ï¼Œå…ˆä¼šåœ¨ã€Œå“ˆå¸Œè¡¨ 1ã€ é‡Œé¢è¿›è¡ŒæŸ¥æ‰¾ï¼Œå¦‚æœæ²¡æ‰¾åˆ°ï¼Œå°±ä¼šç»§ç»­åˆ°å“ˆå¸Œè¡¨ 2 é‡Œé¢è¿›è¡Œæ‰¾åˆ°ã€‚</p><p>å¦å¤–ï¼Œ<strong>åœ¨æ¸è¿›å¼ rehash è¿›è¡ŒæœŸé—´ï¼Œæ–°å¢ä¸€ä¸ª key-value æ—¶ï¼Œä¼šè¢«ä¿å­˜åˆ°ã€Œå“ˆå¸Œè¡¨ 2 ã€é‡Œé¢ï¼Œè€Œã€Œå“ˆå¸Œè¡¨ 1ã€ åˆ™ä¸å†è¿›è¡Œä»»ä½•æ·»åŠ æ“ä½œï¼Œè¿™æ ·ä¿è¯äº†ã€Œå“ˆå¸Œè¡¨ 1 ã€çš„ key-value æ•°é‡åªä¼šå‡å°‘ï¼Œéšç€ rehash æ“ä½œçš„å®Œæˆï¼Œæœ€ç»ˆã€Œå“ˆå¸Œè¡¨ 1 ã€å°±ä¼šå˜æˆç©ºè¡¨ã€‚</strong></p><p>å°±åƒä¸€ä¸ªæ…¢æ€§ä¸€ä¸ªæ€¥æ€§çš„é—®é¢˜ä¸€æ ·ã€‚</p><h2 id="10-å“ˆå¸Œè¡¨æ‰©å®¹çš„æ—¶å€™ï¼Œæœ‰è¯»è¯·æ±‚æ€ä¹ˆæŸ¥ï¼Ÿ"><a href="#10-å“ˆå¸Œè¡¨æ‰©å®¹çš„æ—¶å€™ï¼Œæœ‰è¯»è¯·æ±‚æ€ä¹ˆæŸ¥ï¼Ÿ" class="headerlink" title="10.å“ˆå¸Œè¡¨æ‰©å®¹çš„æ—¶å€™ï¼Œæœ‰è¯»è¯·æ±‚æ€ä¹ˆæŸ¥ï¼Ÿ"></a>10.å“ˆå¸Œè¡¨æ‰©å®¹çš„æ—¶å€™ï¼Œæœ‰è¯»è¯·æ±‚æ€ä¹ˆæŸ¥ï¼Ÿ</h2><p>æŸ¥æ‰¾ä¸€ä¸ª key çš„å€¼çš„è¯ï¼Œå…ˆä¼šåœ¨ã€Œå“ˆå¸Œè¡¨ 1ã€ é‡Œé¢è¿›è¡ŒæŸ¥æ‰¾ï¼Œå¦‚æœæ²¡æ‰¾åˆ°ï¼Œå°±ä¼šç»§ç»­åˆ°å“ˆå¸Œè¡¨ 2 é‡Œé¢è¿›è¡Œæ‰¾åˆ°ã€‚</p><h2 id="11-String-æ˜¯ä½¿ç”¨ä»€ä¹ˆå­˜å‚¨çš„-ä¸ºä»€ä¹ˆä¸ç”¨-c-è¯­è¨€ä¸­çš„å­—ç¬¦ä¸²"><a href="#11-String-æ˜¯ä½¿ç”¨ä»€ä¹ˆå­˜å‚¨çš„-ä¸ºä»€ä¹ˆä¸ç”¨-c-è¯­è¨€ä¸­çš„å­—ç¬¦ä¸²" class="headerlink" title="11.String æ˜¯ä½¿ç”¨ä»€ä¹ˆå­˜å‚¨çš„?ä¸ºä»€ä¹ˆä¸ç”¨ c è¯­è¨€ä¸­çš„å­—ç¬¦ä¸²?"></a>11.<strong>String æ˜¯ä½¿ç”¨ä»€ä¹ˆå­˜å‚¨çš„?ä¸ºä»€ä¹ˆä¸ç”¨ c è¯­è¨€ä¸­çš„å­—ç¬¦ä¸²?</strong></h2><p>Redis çš„ String å­—ç¬¦ä¸²æ˜¯ç”¨ <strong>SDS æ•°æ®ç»“æ„</strong>å­˜å‚¨çš„ã€‚</p><p>ä¸‹å›¾å°±æ˜¯ Redis 5.0 çš„ SDS çš„æ•°æ®ç»“æ„ï¼š</p><p><img src="https://cdn.xiaolincoding.com//picgo/image-20240725232549832.png" alt="image-20240725232549832"></p><p>ç»“æ„ä¸­çš„æ¯ä¸ªæˆå‘˜å˜é‡åˆ†åˆ«ä»‹ç»ä¸‹ï¼š</p><ul><li><strong>lenï¼Œè®°å½•äº†å­—ç¬¦ä¸²é•¿åº¦</strong>ã€‚è¿™æ ·è·å–å­—ç¬¦ä¸²é•¿åº¦çš„æ—¶å€™ï¼Œåªéœ€è¦è¿”å›è¿™ä¸ªæˆå‘˜å˜é‡å€¼å°±è¡Œï¼Œæ—¶é—´å¤æ‚åº¦åªéœ€è¦ Oï¼ˆ1ï¼‰ã€‚</li><li><strong>allocï¼Œåˆ†é…ç»™å­—ç¬¦æ•°ç»„çš„ç©ºé—´é•¿åº¦</strong>ã€‚è¿™æ ·åœ¨ä¿®æ”¹å­—ç¬¦ä¸²çš„æ—¶å€™ï¼Œ<strong>å¯ä»¥é€šè¿‡ <code>alloc - len</code> è®¡ç®—å‡ºå‰©ä½™çš„ç©ºé—´å¤§å°ï¼Œå¯ä»¥ç”¨æ¥åˆ¤æ–­ç©ºé—´æ˜¯å¦æ»¡è¶³ä¿®æ”¹éœ€æ±‚ï¼Œå¦‚æœä¸æ»¡è¶³çš„è¯ï¼Œå°±ä¼šè‡ªåŠ¨å°† SDS çš„ç©ºé—´æ‰©å±•è‡³æ‰§è¡Œä¿®æ”¹æ‰€éœ€çš„å¤§å°ï¼Œç„¶åæ‰æ‰§è¡Œå®é™…çš„ä¿®æ”¹æ“ä½œï¼Œ</strong>æ‰€ä»¥ä½¿ç”¨ SDS æ—¢ä¸éœ€è¦æ‰‹åŠ¨ä¿®æ”¹ SDS çš„ç©ºé—´å¤§å°ï¼Œä¹Ÿä¸ä¼šå‡ºç°å‰é¢æ‰€è¯´çš„ç¼“å†²åŒºæº¢å‡ºçš„é—®é¢˜ã€‚</li><li><strong>flagsï¼Œç”¨æ¥è¡¨ç¤ºä¸åŒç±»å‹çš„ SDS</strong>ã€‚ä¸€å…±è®¾è®¡äº† 5 ç§ç±»å‹ï¼Œåˆ†åˆ«æ˜¯ <strong>sdshdr5ã€sdshdr8ã€sdshdr16ã€sdshdr32 å’Œ sdshdr64</strong>ï¼Œåé¢åœ¨è¯´æ˜åŒºåˆ«ä¹‹å¤„ã€‚</li><li><strong>buf[]ï¼Œå­—ç¬¦æ•°ç»„ï¼Œç”¨æ¥ä¿å­˜å®é™…æ•°æ®</strong>ã€‚ä¸ä»…å¯ä»¥ä¿å­˜å­—ç¬¦ä¸²ï¼Œä¹Ÿå¯ä»¥ä¿å­˜äºŒè¿›åˆ¶æ•°æ®ã€‚</li></ul><p>æ€»çš„æ¥è¯´ï¼ŒRedis çš„ SDS ç»“æ„åœ¨åŸæœ¬å­—ç¬¦æ•°ç»„ä¹‹ä¸Šï¼Œå¢åŠ äº†ä¸‰ä¸ªå…ƒæ•°æ®ï¼šlenã€allocã€flagsï¼Œç”¨æ¥è§£å†³ C è¯­è¨€å­—ç¬¦ä¸²çš„ç¼ºé™·ã€‚</p><blockquote><p>Oï¼ˆ1ï¼‰å¤æ‚åº¦è·å–å­—ç¬¦ä¸²é•¿åº¦</p></blockquote><p>C è¯­è¨€çš„å­—ç¬¦ä¸²é•¿åº¦è·å– strlen å‡½æ•°ï¼Œéœ€è¦é€šè¿‡éå†çš„æ–¹å¼æ¥ç»Ÿè®¡å­—ç¬¦ä¸²é•¿åº¦ï¼Œæ—¶é—´å¤æ‚åº¦æ˜¯ Oï¼ˆNï¼‰ã€‚</p><p>è€Œ Redis çš„ SDS ç»“æ„å› ä¸ºåŠ å…¥äº† len æˆå‘˜å˜é‡ï¼Œé‚£ä¹ˆ<strong>è·å–å­—ç¬¦ä¸²é•¿åº¦çš„æ—¶å€™ï¼Œç›´æ¥è¿”å›è¿™ä¸ªæˆå‘˜å˜é‡çš„å€¼å°±è¡Œï¼Œæ‰€ä»¥å¤æ‚åº¦åªæœ‰ Oï¼ˆ1ï¼‰</strong>ã€‚</p><blockquote><p>äºŒè¿›åˆ¶å®‰å…¨</p></blockquote><p>å› ä¸º SDS ä¸éœ€è¦ç”¨ â€œ\0â€ å­—ç¬¦æ¥æ ‡è¯†å­—ç¬¦ä¸²ç»“å°¾äº†ï¼Œè€Œæ˜¯<strong>æœ‰ä¸ªä¸“é—¨çš„ len æˆå‘˜å˜é‡æ¥è®°å½•é•¿åº¦ï¼Œæ‰€ä»¥å¯å­˜å‚¨åŒ…å« â€œ\0â€ çš„æ•°æ®</strong>ã€‚ä½†æ˜¯ SDS ä¸ºäº†å…¼å®¹éƒ¨åˆ† C è¯­è¨€æ ‡å‡†åº“çš„å‡½æ•°ï¼Œ SDS å­—ç¬¦ä¸²ç»“å°¾è¿˜æ˜¯ä¼šåŠ ä¸Š â€œ\0â€ å­—ç¬¦ã€‚</p><p>å› æ­¤ï¼Œ SDS çš„ API éƒ½æ˜¯ä»¥å¤„ç†äºŒè¿›åˆ¶çš„æ–¹å¼æ¥å¤„ç† <strong>SDS å­˜æ”¾åœ¨ buf[] é‡Œçš„æ•°æ®ï¼Œç¨‹åºä¸ä¼šå¯¹å…¶ä¸­çš„æ•°æ®åšä»»ä½•é™åˆ¶ï¼Œæ•°æ®å†™å…¥çš„æ—¶å€™æ—¶ä»€ä¹ˆæ ·çš„ï¼Œå®ƒè¢«è¯»å–æ—¶å°±æ˜¯ä»€ä¹ˆæ ·çš„ã€‚</strong></p><p>é€šè¿‡ä½¿ç”¨äºŒè¿›åˆ¶å®‰å…¨çš„ SDSï¼Œè€Œä¸æ˜¯ C å­—ç¬¦ä¸²ï¼Œä½¿å¾— Redis ä¸ä»…å¯ä»¥ä¿å­˜æ–‡æœ¬æ•°æ®ï¼Œä¹Ÿå¯ä»¥ä¿å­˜ä»»æ„æ ¼å¼çš„äºŒè¿›åˆ¶æ•°æ®ã€‚</p><blockquote><p>ä¸ä¼šå‘ç”Ÿç¼“å†²åŒºæº¢å‡º</p></blockquote><p>C è¯­è¨€çš„å­—ç¬¦ä¸²æ ‡å‡†åº“æä¾›çš„å­—ç¬¦ä¸²æ“ä½œå‡½æ•°ï¼Œå¤§å¤šæ•°ï¼ˆæ¯”å¦‚ strcat è¿½åŠ å­—ç¬¦ä¸²å‡½æ•°ï¼‰éƒ½æ˜¯ä¸å®‰å…¨çš„ï¼Œå› ä¸ºè¿™äº›å‡½æ•°æŠŠç¼“å†²åŒºå¤§å°æ˜¯å¦æ»¡è¶³æ“ä½œéœ€æ±‚çš„å·¥ä½œäº¤ç”±å¼€å‘è€…æ¥ä¿è¯ï¼Œç¨‹åºå†…éƒ¨å¹¶ä¸ä¼šåˆ¤æ–­ç¼“å†²åŒºå¤§å°æ˜¯å¦è¶³å¤Ÿç”¨ï¼Œå½“å‘ç”Ÿäº†ç¼“å†²åŒºæº¢å‡ºå°±æœ‰å¯èƒ½é€ æˆç¨‹åºå¼‚å¸¸ç»“æŸã€‚</p><p>æ‰€ä»¥ï¼ŒRedis çš„ SDS ç»“æ„é‡Œå¼•å…¥äº† alloc å’Œ len æˆå‘˜å˜é‡ï¼Œè¿™æ · SDS API é€šè¿‡ <code>**alloc - len</code> è®¡ç®—**ï¼Œå¯ä»¥ç®—å‡ºå‰©ä½™å¯ç”¨çš„ç©ºé—´å¤§å°ï¼Œè¿™æ ·åœ¨å¯¹å­—ç¬¦ä¸²åšä¿®æ”¹æ“ä½œçš„æ—¶å€™ï¼Œå°±å¯ä»¥ç”±ç¨‹åºå†…éƒ¨åˆ¤æ–­ç¼“å†²åŒºå¤§å°æ˜¯å¦è¶³å¤Ÿç”¨ã€‚</p><p>è€Œä¸”ï¼Œ<strong>å½“åˆ¤æ–­å‡ºç¼“å†²åŒºå¤§å°ä¸å¤Ÿç”¨æ—¶ï¼ŒRedis ä¼šè‡ªåŠ¨å°†æ‰©å¤§ SDS çš„ç©ºé—´å¤§å°</strong>ï¼Œä»¥æ»¡è¶³ä¿®æ”¹æ‰€éœ€çš„å¤§å°ã€‚</p><p>è·³è¡¨èŠ‚ç‚¹çš„åº•å±‚ä¹Ÿæ˜¯ç”±sdsä½œä¸ºæ•°æ®ç»“æ„çš„æ¥å­˜å‚¨èŠ‚ç‚¹çš„ã€‚</p><h2 id="12-Quicklist-æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#12-Quicklist-æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="12.Quicklist æ˜¯ä»€ä¹ˆï¼Ÿ"></a>12.Quicklist æ˜¯ä»€ä¹ˆï¼Ÿ</h2><p><strong>Quicklist æ˜¯ç”±å¤šä¸ª ziplist æˆ– listpack ç»„æˆçš„åŒå‘é“¾è¡¨ï¼Œæ¯ä¸ªèŠ‚ç‚¹ç§°ä¸º quicklist nodeï¼Œå­˜å‚¨çš„æ˜¯ä¸€ä¸ªå‹ç¼©åˆ—è¡¨ï¼ˆziplist æˆ– listpackï¼‰</strong>ã€‚</p><p>æ—¢èŠ‚çœå†…å­˜ï¼ˆä½¿ç”¨å‹ç¼©ç»“æ„ï¼‰åˆæ”¯æŒé«˜æ•ˆæ’å…¥/åˆ é™¤ï¼ˆé“¾è¡¨ç»“æ„ï¼‰</p><div class="table-container"><table><thead><tr><th>ç‰¹æ€§</th><th>ziplist</th><th>listpack</th><th>quicklist</th></tr></thead><tbody><tr><td>ç±»å‹</td><td>è¿ç»­å†…å­˜ç»“æ„</td><td>è¿ç»­å†…å­˜ç»“æ„ï¼ˆziplist æ›¿ä»£å“ï¼‰</td><td><strong>åŒå‘é“¾è¡¨ï¼ŒèŠ‚ç‚¹å†…æ˜¯ ziplist/listpack</strong></td></tr><tr><td>å¼•å…¥ç‰ˆæœ¬</td><td>å¾ˆæ—©</td><td>Redis 5.0</td><td>Redis 3.2</td></tr><tr><td>ä¼˜ç‚¹</td><td>ç´§å‡‘èŠ‚çœå†…å­˜</td><td>æ›´å¿«ã€æ›´çœç©ºé—´</td><td>é«˜æ•ˆæ’å…¥/åˆ é™¤ + å†…å­˜èŠ‚çœ</td></tr><tr><td>ç¼ºç‚¹</td><td>æ’å…¥/åˆ é™¤ä»£ä»·é«˜ï¼Œè¿é”æ›´æ–°</td><td>å¤æ‚æ€§é«˜</td><td>ç®¡ç†å¤šä¸ªèŠ‚ç‚¹éœ€è¦é¢å¤–é€»è¾‘</td></tr><tr><td>ç”¨äº List</td><td>âŒï¼ˆæ—©æœŸç”¨ï¼‰</td><td>âœ…ï¼ˆRedis 5.0 èµ·ï¼‰</td><td>âœ…ï¼ˆå®˜æ–¹é»˜è®¤ List å®ç°ï¼‰</td></tr><tr><td>å…³ç³»</td><td>è¢« listpack æ›¿ä»£</td><td>æ›¿ä»£ ziplist</td><td><strong>å°è£… ziplist/listpack çš„åŒå‘é“¾è¡¨</strong></td></tr></tbody></table></div><h1 id="çº¿ç¨‹"><a href="#çº¿ç¨‹" class="headerlink" title="çº¿ç¨‹"></a>çº¿ç¨‹</h1><h2 id="1-Redisä¸ºä»€ä¹ˆå¿«ï¼Ÿ"><a href="#1-Redisä¸ºä»€ä¹ˆå¿«ï¼Ÿ" class="headerlink" title="1.Redisä¸ºä»€ä¹ˆå¿«ï¼Ÿ"></a>1.Redisä¸ºä»€ä¹ˆå¿«ï¼Ÿ</h2><p>å®˜æ–¹ä½¿ç”¨åŸºå‡†æµ‹è¯•çš„ç»“æœæ˜¯ï¼Œ<strong>å•çº¿ç¨‹çš„ Redis ååé‡å¯ä»¥è¾¾åˆ° 10W/æ¯ç§’</strong>ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="https://cdn.xiaolincoding.com//picgo/1718937885119-ff470de4-b583-407c-b7e1-000fb9926539.webp" alt="img"></p><p>ä¹‹æ‰€ä»¥ Redis é‡‡ç”¨å•çº¿ç¨‹ï¼ˆç½‘ç»œ I/O å’Œæ‰§è¡Œå‘½ä»¤ï¼‰é‚£ä¹ˆå¿«ï¼Œæœ‰å¦‚ä¸‹å‡ ä¸ªåŸå› ï¼š</p><ul><li>Redis çš„å¤§éƒ¨åˆ†æ“ä½œ<strong>éƒ½åœ¨å†…å­˜ä¸­å®Œæˆ</strong>ï¼Œå¹¶ä¸”<strong>é‡‡ç”¨äº†é«˜æ•ˆçš„æ•°æ®ç»“æ„</strong>ï¼Œå› æ­¤ Redis ç“¶é¢ˆå¯èƒ½æ˜¯æœºå™¨çš„å†…å­˜æˆ–è€…ç½‘ç»œå¸¦å®½ï¼Œè€Œå¹¶é CPUï¼Œæ—¢ç„¶ CPU ä¸æ˜¯ç“¶é¢ˆï¼Œé‚£ä¹ˆè‡ªç„¶å°±é‡‡ç”¨å•çº¿ç¨‹çš„è§£å†³æ–¹æ¡ˆäº†ï¼›</li><li>Redis é‡‡ç”¨å•çº¿ç¨‹æ¨¡å‹å¯ä»¥<strong>é¿å…äº†å¤šçº¿ç¨‹ä¹‹é—´çš„ç«äº‰</strong>ï¼Œçœå»äº†å¤šçº¿ç¨‹åˆ‡æ¢å¸¦æ¥çš„æ—¶é—´å’Œæ€§èƒ½ä¸Šçš„å¼€é”€ï¼Œè€Œä¸”ä¹Ÿä¸ä¼šå¯¼è‡´æ­»é”é—®é¢˜ã€‚</li><li>Redis é‡‡ç”¨äº† <strong>I/O å¤šè·¯å¤ç”¨æœºåˆ¶</strong>å¤„ç†å¤§é‡çš„å®¢æˆ·ç«¯ Socket è¯·æ±‚ï¼ŒIO å¤šè·¯å¤ç”¨æœºåˆ¶æ˜¯æŒ‡<strong>ä¸€ä¸ªçº¿ç¨‹å¤„ç†å¤šä¸ª IO æµ</strong>ï¼Œå°±æ˜¯æˆ‘ä»¬ç»å¸¸å¬åˆ°çš„ <strong>select/epoll æœºåˆ¶</strong>ã€‚ç®€å•æ¥è¯´ï¼Œåœ¨ Redis åªè¿è¡Œå•çº¿ç¨‹çš„æƒ…å†µä¸‹ï¼Œè¯¥æœºåˆ¶å…è®¸å†…æ ¸ä¸­ï¼ŒåŒæ—¶å­˜åœ¨å¤šä¸ªç›‘å¬ Socket å’Œå·²è¿æ¥ Socketã€‚<strong>å†…æ ¸ä¼šä¸€ç›´ç›‘å¬è¿™äº› Socket ä¸Šçš„è¿æ¥è¯·æ±‚æˆ–æ•°æ®è¯·æ±‚ã€‚ä¸€æ—¦æœ‰è¯·æ±‚åˆ°è¾¾ï¼Œå°±ä¼šäº¤ç»™ Redis çº¿ç¨‹å¤„ç†ï¼Œ</strong>è¿™å°±å®ç°äº†ä¸€ä¸ª Redis çº¿ç¨‹å¤„ç†å¤šä¸ª IO æµçš„æ•ˆæœã€‚</li></ul><h2 id="2-Rediså“ªäº›åœ°æ–¹ä½¿ç”¨äº†å¤šçº¿ç¨‹"><a href="#2-Rediså“ªäº›åœ°æ–¹ä½¿ç”¨äº†å¤šçº¿ç¨‹" class="headerlink" title="2.Rediså“ªäº›åœ°æ–¹ä½¿ç”¨äº†å¤šçº¿ç¨‹?"></a>2.Rediså“ªäº›åœ°æ–¹ä½¿ç”¨äº†å¤šçº¿ç¨‹?</h2><p><strong>Redis å•çº¿ç¨‹æŒ‡çš„æ˜¯ã€Œæ¥æ”¶å®¢æˆ·ç«¯è¯·æ±‚-&gt;è§£æè¯·æ±‚ -&gt;è¿›è¡Œæ•°æ®è¯»å†™ç­‰æ“ä½œ-&gt;å‘é€æ•°æ®ç»™å®¢æˆ·ç«¯ã€è¿™ä¸ªè¿‡ç¨‹æ˜¯ç”±ä¸€ä¸ªçº¿ç¨‹ï¼ˆä¸»çº¿ç¨‹ï¼‰æ¥å®Œæˆçš„</strong>ï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ä»¬å¸¸è¯´ Redis æ˜¯å•çº¿ç¨‹çš„åŸå› ã€‚</p><p>ä½†æ˜¯ï¼Œ<strong>Redis ç¨‹åºå¹¶ä¸æ˜¯å•çº¿ç¨‹çš„</strong>ï¼ŒRedis åœ¨å¯åŠ¨çš„æ—¶å€™ï¼Œæ˜¯ä¼š<strong>å¯åŠ¨åå°çº¿ç¨‹</strong>ï¼ˆBIOï¼‰çš„ï¼š</p><ul><li><strong>Redis åœ¨ 2.6 ç‰ˆæœ¬</strong>ï¼Œä¼šå¯åŠ¨ 2 ä¸ªåå°çº¿ç¨‹ï¼Œ<strong>åˆ†åˆ«å¤„ç†å…³é—­æ–‡ä»¶ã€AOF åˆ·ç›˜è¿™ä¸¤ä¸ªä»»åŠ¡ï¼›</strong></li><li><strong>Redis åœ¨ 4.0 ç‰ˆæœ¬ä¹‹å</strong>ï¼Œæ–°å¢äº†ä¸€ä¸ªæ–°çš„åå°çº¿ç¨‹ï¼Œç”¨æ¥<strong>å¼‚æ­¥é‡Šæ”¾ Redis å†…å­˜ï¼Œä¹Ÿå°±æ˜¯ lazyfree çº¿ç¨‹</strong>ã€‚ä¾‹å¦‚æ‰§è¡Œ unlink key / flushdb async / flushall async ç­‰å‘½ä»¤ï¼Œä¼šæŠŠè¿™äº›åˆ é™¤æ“ä½œäº¤ç»™åå°çº¿ç¨‹æ¥æ‰§è¡Œï¼Œ<strong>å¥½å¤„æ˜¯ä¸ä¼šå¯¼è‡´ Redis ä¸»çº¿ç¨‹å¡é¡¿ã€‚å› æ­¤ï¼Œå½“æˆ‘ä»¬è¦åˆ é™¤ä¸€ä¸ªå¤§ key çš„æ—¶å€™ï¼Œä¸è¦ä½¿ç”¨ del å‘½ä»¤åˆ é™¤ï¼Œå› ä¸º del æ˜¯åœ¨ä¸»çº¿ç¨‹å¤„ç†çš„ï¼Œè¿™æ ·ä¼šå¯¼è‡´ Redis ä¸»çº¿ç¨‹å¡é¡¿ï¼Œå› æ­¤æˆ‘ä»¬åº”è¯¥ä½¿ç”¨ unlink å‘½ä»¤æ¥å¼‚æ­¥åˆ é™¤å¤§keyã€‚</strong></li></ul><p>ä¹‹æ‰€ä»¥ Redis ä¸ºã€Œå…³é—­æ–‡ä»¶ã€AOF åˆ·ç›˜ã€é‡Šæ”¾å†…å­˜ã€è¿™äº›ä»»åŠ¡åˆ›å»ºå•ç‹¬çš„çº¿ç¨‹æ¥å¤„ç†ï¼Œæ˜¯å› ä¸ºè¿™äº›ä»»åŠ¡çš„æ“ä½œéƒ½æ˜¯å¾ˆè€—æ—¶çš„ï¼Œå¦‚æœæŠŠè¿™äº›ä»»åŠ¡éƒ½æ”¾åœ¨ä¸»çº¿ç¨‹æ¥å¤„ç†ï¼Œé‚£ä¹ˆ Redis ä¸»çº¿ç¨‹å°±å¾ˆå®¹æ˜“å‘ç”Ÿé˜»å¡ï¼Œè¿™æ ·å°±æ— æ³•å¤„ç†åç»­çš„è¯·æ±‚äº†ã€‚</p><p>åå°çº¿ç¨‹ç›¸å½“äºä¸€ä¸ªæ¶ˆè´¹è€…ï¼Œç”Ÿäº§è€…æŠŠ<strong>è€—æ—¶ä»»åŠ¡</strong>ä¸¢åˆ°ä»»åŠ¡é˜Ÿåˆ—ä¸­ï¼Œæ¶ˆè´¹è€…ï¼ˆBIOï¼‰ä¸åœè½®è¯¢è¿™ä¸ªé˜Ÿåˆ—ï¼Œæ‹¿å‡ºä»»åŠ¡å°±å»æ‰§è¡Œå¯¹åº”çš„æ–¹æ³•å³å¯ã€‚</p><p><img src="https://cdn.xiaolincoding.com//picgo/1721630818566-ee627936-3a35-4457-a9c7-2b58a88a7da5.png" alt="img"></p><p>è™½ç„¶ Redis çš„ä¸»è¦å·¥ä½œï¼ˆç½‘ç»œ I/O å’Œæ‰§è¡Œå‘½ä»¤ï¼‰ä¸€ç›´æ˜¯å•çº¿ç¨‹æ¨¡å‹ï¼Œä½†æ˜¯<strong>åœ¨ Redis 6.0 ç‰ˆæœ¬ä¹‹åï¼Œä¹Ÿé‡‡ç”¨äº†å¤šä¸ª I/O çº¿ç¨‹æ¥å¤„ç†ç½‘ç»œè¯·æ±‚</strong>ï¼Œ<strong>è¿™æ˜¯å› ä¸ºéšç€ç½‘ç»œç¡¬ä»¶çš„æ€§èƒ½æå‡ï¼ŒRedis çš„æ€§èƒ½ç“¶é¢ˆæœ‰æ—¶ä¼šå‡ºç°åœ¨ç½‘ç»œ I/O çš„å¤„ç†ä¸Š</strong>ã€‚</p><p>æ‰€ä»¥ä¸ºäº†æé«˜ç½‘ç»œ I/O çš„å¹¶è¡Œåº¦ï¼ŒRedis 6.0 å¯¹äºç½‘ç»œ I/O é‡‡ç”¨å¤šçº¿ç¨‹æ¥å¤„ç†ã€‚<strong>ä½†æ˜¯å¯¹äºå‘½ä»¤çš„æ‰§è¡Œï¼ŒRedis ä»ç„¶ä½¿ç”¨å•çº¿ç¨‹æ¥å¤„ç†ï¼Œæ‰€ä»¥å¤§å®¶ä¸è¦è¯¯è§£Redis æœ‰å¤šçº¿ç¨‹åŒæ—¶æ‰§è¡Œå‘½ä»¤</strong>ã€‚</p><p>Redis å®˜æ–¹è¡¨ç¤ºï¼Œ<strong>Redis 6.0 ç‰ˆæœ¬å¼•å…¥çš„å¤šçº¿ç¨‹ I/O ç‰¹æ€§å¯¹æ€§èƒ½æå‡è‡³å°‘æ˜¯ä¸€å€ä»¥ä¸Š</strong>ã€‚</p><p>Redis 6.0 ç‰ˆæœ¬æ”¯æŒçš„ I/O å¤šçº¿ç¨‹ç‰¹æ€§ï¼Œé»˜è®¤æƒ…å†µä¸‹ I/O å¤šçº¿ç¨‹åªé’ˆå¯¹å‘é€å“åº”æ•°æ®ï¼ˆwrite client socketï¼‰ï¼Œå¹¶ä¸ä¼šä»¥å¤šçº¿ç¨‹çš„æ–¹å¼å¤„ç†è¯»è¯·æ±‚ï¼ˆread client socketï¼‰ã€‚è¦æƒ³<strong>å¼€å¯å¤šçº¿ç¨‹å¤„ç†å®¢æˆ·ç«¯è¯»è¯·æ±‚ï¼Œå°±éœ€è¦æŠŠ Redis.conf é…ç½®æ–‡ä»¶ä¸­çš„ io-threads-do-reads é…ç½®é¡¹è®¾ä¸º yesã€‚</strong></p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//è¯»è¯·æ±‚ä¹Ÿä½¿ç”¨ioå¤šçº¿ç¨‹</span></span><br><span class="line">io-threads-<span class="keyword">do</span>-reads yes</span><br></pre></td></tr></table></figure><p>åŒæ—¶ï¼Œ Redis.conf é…ç½®æ–‡ä»¶ä¸­æä¾›äº† IO å¤šçº¿ç¨‹ä¸ªæ•°çš„é…ç½®é¡¹ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// io-threads Nï¼Œè¡¨ç¤ºå¯ç”¨ N-1 ä¸ª I/O å¤šçº¿ç¨‹ï¼ˆä¸»çº¿ç¨‹ä¹Ÿç®—ä¸€ä¸ª I/O çº¿ç¨‹ï¼‰</span></span><br><span class="line">io-threads <span class="number">4</span></span><br></pre></td></tr></table></figure><p>å…³äºçº¿ç¨‹æ•°çš„è®¾ç½®ï¼Œå®˜æ–¹çš„å»ºè®®æ˜¯å¦‚æœä¸º 4 æ ¸çš„ CPUï¼Œå»ºè®®çº¿ç¨‹æ•°è®¾ç½®ä¸º 2 æˆ– 3ï¼Œå¦‚æœä¸º 8 æ ¸ CPU å»ºè®®çº¿ç¨‹æ•°è®¾ç½®ä¸º 6ï¼Œçº¿ç¨‹æ•°ä¸€å®šè¦å°äºæœºå™¨æ ¸æ•°ï¼Œçº¿ç¨‹æ•°å¹¶ä¸æ˜¯è¶Šå¤§è¶Šå¥½ã€‚</p><p>å› æ­¤ï¼Œ Redis 6.0 ç‰ˆæœ¬ä¹‹åï¼ŒRedis åœ¨å¯åŠ¨çš„æ—¶å€™ï¼Œé»˜è®¤æƒ…å†µä¸‹ä¼š<strong>é¢å¤–åˆ›å»º 6 ä¸ªçº¿ç¨‹</strong>ï¼ˆ<em>è¿™é‡Œçš„çº¿ç¨‹æ•°ä¸åŒ…æ‹¬ä¸»çº¿ç¨‹</em>ï¼‰ï¼š</p><ul><li>Redis-server ï¼š Redisçš„ä¸»çº¿ç¨‹ï¼Œä¸»è¦è´Ÿè´£æ‰§è¡Œå‘½ä»¤ï¼›</li><li>bio_close_fileã€bio_aof_fsyncã€bio_lazy_freeï¼šä¸‰ä¸ªåå°çº¿ç¨‹ï¼Œåˆ†åˆ«å¼‚æ­¥å¤„ç†å…³é—­æ–‡ä»¶ä»»åŠ¡ã€AOFåˆ·ç›˜ä»»åŠ¡ã€é‡Šæ”¾å†…å­˜ä»»åŠ¡ï¼›</li><li>io_thd_1ã€io_thd_2ã€io_thd_3ï¼šä¸‰ä¸ª I/O çº¿ç¨‹ï¼Œ<strong>io-threads é»˜è®¤æ˜¯ 4</strong> ï¼Œæ‰€ä»¥ä¼šå¯åŠ¨ 3ï¼ˆ4-1ï¼‰ä¸ª I/O å¤šçº¿ç¨‹ï¼Œç”¨æ¥åˆ†æ‹… Redis ç½‘ç»œ I/O çš„å‹åŠ›ã€‚</li></ul><h2 id="3-Redisæ€ä¹ˆå®ç°çš„ioå¤šè·¯å¤ç”¨ï¼Ÿ"><a href="#3-Redisæ€ä¹ˆå®ç°çš„ioå¤šè·¯å¤ç”¨ï¼Ÿ" class="headerlink" title="3.Redisæ€ä¹ˆå®ç°çš„ioå¤šè·¯å¤ç”¨ï¼Ÿ"></a>3.Redisæ€ä¹ˆå®ç°çš„ioå¤šè·¯å¤ç”¨ï¼Ÿ</h2><p>ä¸ºä»€ä¹ˆ Redis ä¸­è¦ä½¿ç”¨ I/O å¤šè·¯å¤ç”¨è¿™ç§æŠ€æœ¯å‘¢ï¼Ÿ</p><p>å› ä¸º Redis æ˜¯è·‘åœ¨ã€Œå•çº¿ç¨‹ã€ä¸­çš„ï¼Œæ‰€æœ‰çš„æ“ä½œéƒ½æ˜¯æŒ‰ç…§é¡ºåºçº¿æ€§æ‰§è¡Œçš„ï¼Œä½†æ˜¯ç”±äºè¯»å†™æ“ä½œç­‰å¾…ç”¨æˆ·è¾“å…¥ æˆ– è¾“å‡ºéƒ½æ˜¯é˜»å¡çš„ï¼Œæ‰€ä»¥ I/O æ“ä½œåœ¨ä¸€èˆ¬æƒ…å†µä¸‹å¾€å¾€ä¸èƒ½ç›´æ¥è¿”å›ï¼Œè¿™ä¼šå¯¼è‡´æŸä¸€æ–‡ä»¶çš„ I/O é˜»å¡å¯¼ï¼Œè‡´æ•´ä¸ªè¿›ç¨‹æ— æ³•å¯¹å…¶å®ƒå®¢æˆ·æä¾›æœåŠ¡ã€‚è€Œ I/O å¤šè·¯å¤ç”¨å°±æ˜¯ä¸ºäº†è§£å†³è¿™ä¸ªé—®é¢˜è€Œå‡ºç°çš„ã€‚<strong>ä¸ºäº†è®©å•çº¿ç¨‹(è¿›ç¨‹)çš„æœåŠ¡ç«¯åº”ç”¨åŒæ—¶å¤„ç†å¤šä¸ªå®¢æˆ·ç«¯çš„äº‹ä»¶ï¼Œ</strong>Redis é‡‡ç”¨äº† IO å¤šè·¯å¤ç”¨æœºåˆ¶ã€‚</p><p>è¿™é‡Œâ€œå¤šè·¯â€æŒ‡çš„æ˜¯å¤šä¸ªç½‘ç»œè¿æ¥å®¢æˆ·ç«¯ï¼Œâ€œå¤ç”¨â€æŒ‡çš„æ˜¯å¤ç”¨åŒä¸€ä¸ªçº¿ç¨‹(å•è¿›ç¨‹)ã€‚I/O å¤šè·¯å¤ç”¨å…¶å®æ˜¯ä½¿ç”¨ä¸€ä¸ªçº¿ç¨‹æ¥æ£€æŸ¥å¤šä¸ª Socket çš„å°±ç»ªçŠ¶æ€ï¼Œåœ¨å•ä¸ªçº¿ç¨‹ä¸­é€šè¿‡è®°å½•è·Ÿè¸ªæ¯ä¸€ä¸ª socketï¼ˆI/Oæµï¼‰çš„çŠ¶æ€æ¥ç®¡ç†å¤„ç†å¤šä¸ª I/O æµã€‚å¦‚ä¸‹å›¾æ˜¯ Redis çš„ I/O å¤šè·¯å¤ç”¨æ¨¡å‹ï¼š</p><p><img src="https://cdn.xiaolincoding.com//picgo/1720433058791-94f03cb5-e89c-45ed-ba34-88a0dac99d98.png" alt="img"></p><p>å¦‚ä¸Šå›¾å¯¹ Redis çš„ I/O å¤šè·¯å¤ç”¨æ¨¡å‹è¿›è¡Œä¸€ä¸‹æè¿°è¯´æ˜ï¼š</p><ul><li>ä¸€ä¸ª socket å®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯è¿æ¥æ—¶ï¼Œä¼šç”Ÿæˆ<strong>å¯¹åº”ä¸€ä¸ªå¥—æ¥å­—æè¿°ç¬¦</strong>(å¥—æ¥å­—æè¿°ç¬¦æ˜¯æ–‡ä»¶æè¿°ç¬¦çš„ä¸€ç§)ï¼Œæ¯ä¸€ä¸ª socket ç½‘ç»œè¿æ¥å…¶å®éƒ½å¯¹åº”ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ã€‚</li><li>å¤šä¸ªå®¢æˆ·ç«¯ä¸æœåŠ¡ç«¯è¿æ¥æ—¶ï¼ŒRedis ä½¿ç”¨ I/O å¤šè·¯å¤ç”¨ç¨‹åº <strong>å°†å®¢æˆ·ç«¯ socket å¯¹åº”çš„ FD æ³¨å†Œåˆ°ç›‘å¬åˆ—è¡¨(ä¸€ä¸ªé˜Ÿåˆ—)ä¸­ã€‚</strong>å½“å®¢æœç«¯æ‰§è¡Œ readã€write ç­‰æ“ä½œå‘½ä»¤æ—¶ï¼Œ<strong>I/O å¤šè·¯å¤ç”¨ç¨‹åºä¼šå°†å‘½ä»¤å°è£…æˆä¸€ä¸ªäº‹ä»¶ï¼Œå¹¶ç»‘å®šåˆ°å¯¹åº”çš„ FD ä¸Šã€‚</strong></li><li>æ–‡ä»¶äº‹ä»¶å¤„ç†å™¨ä½¿ç”¨ I/O å¤šè·¯å¤ç”¨æ¨¡å—åŒæ—¶ç›‘æ§å¤šä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼ˆfdï¼‰çš„è¯»å†™æƒ…å†µï¼Œå½“ acceptã€readã€write å’Œ close æ–‡ä»¶äº‹ä»¶äº§ç”Ÿæ—¶ï¼Œ<strong>æ–‡ä»¶äº‹ä»¶å¤„ç†å™¨å°±ä¼šå›è°ƒ FD ç»‘å®šçš„äº‹ä»¶å¤„ç†å™¨è¿›è¡Œå¤„ç†ç›¸å…³å‘½ä»¤æ“ä½œã€‚</strong></li></ul><p>ä¾‹å¦‚ï¼šä»¥ Redis çš„ I/O å¤šè·¯å¤ç”¨ç¨‹åº epoll å‡½æ•°ä¸ºä¾‹ã€‚å¤šä¸ªå®¢æˆ·ç«¯è¿æ¥æœåŠ¡ç«¯æ—¶ï¼ŒRedis ä¼šå°†<strong>å®¢æˆ·ç«¯ socket å¯¹åº”çš„ fd æ³¨å†Œè¿› epollï¼Œç„¶å epoll åŒæ—¶ç›‘å¬å¤šä¸ªæ–‡ä»¶æè¿°ç¬¦(FD)æ˜¯å¦æœ‰æ•°æ®åˆ°æ¥ï¼Œå¦‚æœæœ‰æ•°æ®æ¥äº†å°±é€šçŸ¥äº‹ä»¶å¤„ç†å™¨èµ¶ç´§å¤„ç†ï¼Œè¿™æ ·å°±ä¸ä¼šå­˜åœ¨æœåŠ¡ç«¯ä¸€ç›´ç­‰å¾…æŸä¸ªå®¢æˆ·ç«¯ç»™æ•°æ®çš„æƒ…å½¢ã€‚</strong></p><p>æ•´ä¸ªæ–‡ä»¶äº‹ä»¶å¤„ç†å™¨æ˜¯åœ¨å•çº¿ç¨‹ä¸Šè¿è¡Œçš„ï¼Œä½†æ˜¯é€šè¿‡ I/O å¤šè·¯å¤ç”¨æ¨¡å—çš„å¼•å…¥ï¼Œå®ç°äº†åŒæ—¶å¯¹å¤šä¸ª FD è¯»å†™çš„ç›‘æ§ï¼Œå½“å…¶ä¸­ä¸€ä¸ª client ç«¯è¾¾åˆ°å†™æˆ–è¯»çš„çŠ¶æ€ï¼Œæ–‡ä»¶äº‹ä»¶å¤„ç†å™¨å°±é©¬ä¸Šæ‰§è¡Œï¼Œä»è€Œå°±ä¸ä¼šå‡ºç° I/O å µå¡çš„é—®é¢˜ï¼Œæé«˜äº†ç½‘ç»œé€šä¿¡çš„æ€§èƒ½ã€‚</p><p>Redis çš„ I/O å¤šè·¯å¤ç”¨æ¨¡å¼ä½¿ç”¨çš„æ˜¯ <strong>Reactor è®¾ç½®æ¨¡å¼</strong>çš„æ–¹å¼æ¥å®ç°ã€‚</p><h2 id="4-Redisçš„ç½‘ç»œæ¨¡å‹æ˜¯æ€æ ·çš„ï¼Ÿ"><a href="#4-Redisçš„ç½‘ç»œæ¨¡å‹æ˜¯æ€æ ·çš„ï¼Ÿ" class="headerlink" title="4.Redisçš„ç½‘ç»œæ¨¡å‹æ˜¯æ€æ ·çš„ï¼Ÿ"></a>4.Redisçš„ç½‘ç»œæ¨¡å‹æ˜¯æ€æ ·çš„ï¼Ÿ</h2><p>Redis 6.0 ç‰ˆæœ¬ä¹‹å‰ï¼Œæ˜¯ç”¨çš„æ˜¯å•Reactorå•çº¿ç¨‹çš„æ¨¡å¼</p><p><img src="https://cdn.xiaolincoding.com//picgo/1721630566038-d16ec13e-e7e6-4e0b-a48c-e7affdbf312e.png" alt="img"></p><p>å• <strong>Reactor å•è¿›ç¨‹</strong>çš„æ–¹æ¡ˆå› ä¸ºå…¨éƒ¨å·¥ä½œéƒ½åœ¨åŒä¸€ä¸ªè¿›ç¨‹å†…å®Œæˆï¼Œæ‰€ä»¥å®ç°èµ·æ¥æ¯”è¾ƒç®€å•ï¼Œä¸éœ€è¦è€ƒè™‘è¿›ç¨‹é—´é€šä¿¡ï¼Œä¹Ÿä¸ç”¨æ‹…å¿ƒå¤šè¿›ç¨‹ç«äº‰ã€‚</p><p>ä½†æ˜¯ï¼Œè¿™ç§æ–¹æ¡ˆå­˜åœ¨ 2 ä¸ªç¼ºç‚¹ï¼š</p><ul><li>ç¬¬ä¸€ä¸ªç¼ºç‚¹ï¼Œå› ä¸ºåªæœ‰ä¸€ä¸ªè¿›ç¨‹ï¼Œ<strong>æ— æ³•å……åˆ†åˆ©ç”¨ å¤šæ ¸ CPU çš„æ€§èƒ½</strong>ï¼›</li><li>ç¬¬äºŒä¸ªç¼ºç‚¹ï¼ŒHandler å¯¹è±¡åœ¨ä¸šåŠ¡å¤„ç†æ—¶ï¼Œæ•´ä¸ªè¿›ç¨‹æ˜¯æ— æ³•å¤„ç†å…¶ä»–è¿æ¥çš„äº‹ä»¶çš„ï¼Œ<strong>å¦‚æœä¸šåŠ¡å¤„ç†è€—æ—¶æ¯”è¾ƒé•¿ï¼Œé‚£ä¹ˆå°±é€ æˆå“åº”çš„å»¶è¿Ÿ</strong>ï¼›</li></ul><p>æ‰€ä»¥ï¼Œå• Reactor å•è¿›ç¨‹çš„æ–¹æ¡ˆ<strong>ä¸é€‚ç”¨è®¡ç®—æœºå¯†é›†å‹çš„åœºæ™¯ï¼Œåªé€‚ç”¨äºä¸šåŠ¡å¤„ç†éå¸¸å¿«é€Ÿçš„åœºæ™¯</strong>ã€‚</p><p>Redis æ˜¯ç”± C è¯­è¨€å®ç°çš„ï¼Œåœ¨ Redis 6.0 ç‰ˆæœ¬ä¹‹å‰é‡‡ç”¨çš„æ­£æ˜¯ã€Œå• Reactor å•è¿›ç¨‹ã€çš„æ–¹æ¡ˆï¼Œå› ä¸º Redis ä¸šåŠ¡å¤„ç†ä¸»è¦æ˜¯åœ¨å†…å­˜ä¸­å®Œæˆï¼Œæ“ä½œçš„é€Ÿåº¦æ˜¯å¾ˆå¿«çš„ï¼Œæ€§èƒ½ç“¶é¢ˆä¸åœ¨ CPU ä¸Šï¼Œæ‰€ä»¥ Redis å¯¹äºå‘½ä»¤çš„å¤„ç†æ˜¯å•è¿›ç¨‹çš„æ–¹æ¡ˆã€‚</p><p><strong>åˆ° Redis 6.0 ä¹‹åï¼Œå°±å°†ç½‘ç»œIOçš„å¤„ç†æ”¹æˆå¤šçº¿ç¨‹çš„æ–¹å¼äº†</strong>ï¼Œç›®çš„æ˜¯ä¸ºäº†<strong>è¿™æ˜¯å› ä¸ºéšç€ç½‘ç»œç¡¬ä»¶çš„æ€§èƒ½æå‡ï¼ŒRedis çš„æ€§èƒ½ç“¶é¢ˆæœ‰æ—¶ä¼šå‡ºç°åœ¨ç½‘ç»œ I/O çš„å¤„ç†ä¸Š</strong>ã€‚</p><p>æ‰€ä»¥ä¸ºäº†æé«˜ç½‘ç»œ I/O çš„å¹¶è¡Œåº¦ï¼ŒRedis 6.0 å¯¹äºç½‘ç»œ I/O é‡‡ç”¨å¤šçº¿ç¨‹æ¥å¤„ç†ã€‚<strong>ä½†æ˜¯å¯¹äºå‘½ä»¤çš„æ‰§è¡Œï¼ŒRedis ä»ç„¶ä½¿ç”¨å•çº¿ç¨‹æ¥å¤„ç†ï¼Œæ‰€ä»¥å¤§å®¶ä¸è¦è¯¯è§£</strong> Redis æœ‰å¤šçº¿ç¨‹åŒæ—¶æ‰§è¡Œå‘½ä»¤ã€‚</p><h1 id="äº‹åŠ¡"><a href="#äº‹åŠ¡" class="headerlink" title="äº‹åŠ¡"></a>äº‹åŠ¡</h1><h2 id="1-redisçš„äº‹åŠ¡å’Œmysqläº‹åŠ¡æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"><a href="#1-redisçš„äº‹åŠ¡å’Œmysqläº‹åŠ¡æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ" class="headerlink" title="1.redisçš„äº‹åŠ¡å’Œmysqläº‹åŠ¡æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"></a>1.redisçš„äº‹åŠ¡å’Œmysqläº‹åŠ¡æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</h2><p>Redis äº‹åŠ¡å’Œ MySQL äº‹åŠ¡åœ¨æ¦‚å¿µå’Œå®ç°æœºåˆ¶ä¸Šæœ‰æ˜¾è‘—åŒºåˆ«ã€‚</p><p>Redis äº‹åŠ¡æ˜¯é€šè¿‡ <code>MULTI</code> å’Œ <code>EXEC</code> å‘½ä»¤å°†ä¸€ç»„ Redis å‘½ä»¤æ‰“åŒ…ï¼Œ<strong>æŒ‰é¡ºåºã€ä¸€æ¬¡æ€§æ‰§è¡Œ</strong>ï¼Œä½†å®ƒå¹¶ä¸æ”¯æŒä¼ ç»Ÿæ„ä¹‰ä¸Šçš„å›æ»šæœºåˆ¶ã€‚Redis äº‹åŠ¡ä¿è¯çš„æ˜¯å‘½ä»¤çš„<strong>æœ‰åºæ€§</strong>å’Œ<strong>å•çº¿ç¨‹æ‰§è¡Œçš„éš”ç¦»æ€§</strong>ï¼Œ<strong>ä¸å…·å¤‡çœŸæ­£çš„åŸå­æ€§</strong>å’Œé”™è¯¯å›æ»šèƒ½åŠ›ï¼šå³ä½¿å…¶ä¸­æŸæ¡å‘½ä»¤å‡ºé”™ï¼ˆå¦‚ç±»å‹é”™è¯¯ï¼‰ï¼Œå…¶ä»–å‘½ä»¤ä»ä¼šç»§ç»­æ‰§è¡Œã€‚å› æ­¤ï¼ŒRedis äº‹åŠ¡æ›´åƒæ˜¯ä¸€ä¸ª<strong>å‘½ä»¤é˜Ÿåˆ—çš„æ‰¹å¤„ç†æœºåˆ¶</strong>ã€‚</p><p>ç›¸æ¯”ä¹‹ä¸‹ï¼ŒMySQL äº‹åŠ¡æ˜¯å›´ç»• <strong>ACID å››å¤§ç‰¹æ€§ï¼ˆåŸå­æ€§ã€ä¸€è‡´æ€§ã€éš”ç¦»æ€§ã€æŒä¹…æ€§ï¼‰</strong> å®ç°çš„å®Œæ•´äº‹åŠ¡æœºåˆ¶ã€‚å®ƒå¯ä»¥<strong>ç¡®ä¿å¤šæ¡ SQL æ“ä½œè¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å¤±è´¥ï¼Œ</strong>å¹¶é€šè¿‡æ—¥å¿—ï¼ˆå¦‚ redo/undo logï¼‰å’Œé”æœºåˆ¶ï¼ˆå¦‚è¡Œé”ã€è¡¨é”ï¼‰æ¥ä¿éšœæ•°æ®çš„ä¸€è‡´æ€§å’Œéš”ç¦»æ€§ã€‚å¦‚æœåœ¨äº‹åŠ¡ä¸­å‘ç”Ÿå¼‚å¸¸ï¼Œå¯ä»¥é€šè¿‡ <code>ROLLBACK</code> å®Œæ•´æ’¤é”€å·²æ‰§è¡Œçš„æ“ä½œï¼Œå…·æœ‰<strong>çœŸæ­£çš„å›æ»šèƒ½åŠ›</strong>ã€‚</p><p>æ€»ç»“æ¥è¯´ï¼ŒRedis çš„äº‹åŠ¡åå‘â€œæ‰¹å¤„ç†è¯­ä¹‰â€ï¼Œé€‚ç”¨äºå‘½ä»¤é¡ºåºæ€§è¦æ±‚è¾ƒé«˜ä½†å¯¹ä¸€è‡´æ€§è¦æ±‚ä¸é«˜çš„åœºæ™¯ï¼›è€Œ MySQL äº‹åŠ¡é€‚ç”¨äºå¼ºä¸€è‡´æ€§ã€å¤æ‚é€»è¾‘ã€æ•°æ®å›æ»šéœ€æ±‚çš„ä¸šåŠ¡å¤„ç†åœºæ™¯ã€‚ä¸¤è€…é€‚ç”¨åœºæ™¯å’Œä¿éšœèƒ½åŠ›æœ‰æœ¬è´¨å·®å¼‚ã€‚</p><h2 id="2-å¦‚ä½•å®ç°redis-åŸå­æ€§ï¼Ÿ"><a href="#2-å¦‚ä½•å®ç°redis-åŸå­æ€§ï¼Ÿ" class="headerlink" title="2.å¦‚ä½•å®ç°redis åŸå­æ€§ï¼Ÿ"></a>2.å¦‚ä½•å®ç°redis åŸå­æ€§ï¼Ÿ</h2><p>redis æ‰§è¡Œä¸€æ¡å‘½ä»¤çš„æ—¶å€™æ˜¯å…·å¤‡åŸå­æ€§çš„ï¼Œå› ä¸º redis æ‰§è¡Œå‘½ä»¤çš„æ—¶å€™æ˜¯å•çº¿ç¨‹æ¥å¤„ç†çš„ï¼Œä¸å­˜åœ¨å¤šçº¿ç¨‹å®‰å…¨çš„é—®é¢˜ã€‚</p><p>å¦‚æœè¦ä¿è¯ 2 æ¡å‘½ä»¤çš„åŸå­æ€§çš„è¯ï¼Œå¯ä»¥è€ƒè™‘ç”¨ <strong>lua è„šæœ¬</strong>ï¼Œå°†å¤šä¸ªæ“ä½œå†™åˆ°ä¸€ä¸ª Lua è„šæœ¬ä¸­ï¼ŒRedis <strong>ä¼šæŠŠæ•´ä¸ª Lua è„šæœ¬ä½œä¸ºä¸€ä¸ªæ•´ä½“æ‰§è¡Œï¼Œåœ¨æ‰§è¡Œçš„è¿‡ç¨‹ä¸­ä¸ä¼šè¢«å…¶ä»–å‘½ä»¤æ‰“æ–­ï¼Œä»è€Œä¿è¯äº† Lua è„šæœ¬ä¸­æ“ä½œçš„åŸå­æ€§ã€‚</strong></p><p>æ¯”å¦‚è¯´ï¼Œåœ¨ç”¨ redis å®ç°åˆ†å¸ƒå¼é”çš„åœºæ™¯ä¸‹ï¼Œè§£é”æœŸé—´æ¶‰åŠ 2 ä¸ªæ“ä½œï¼Œ<strong>åˆ†åˆ«æ˜¯å…ˆåˆ¤æ–­é”æ˜¯ä¸æ˜¯è‡ªå·±çš„ï¼Œæ˜¯è‡ªå·±çš„æ‰èƒ½åˆ é™¤é”ï¼Œ</strong>ä¸ºäº†ä¿è¯è¿™ 2 ä¸ªæ“ä½œçš„åŸå­æ€§ï¼Œä¼šé€šè¿‡ lua è„šæœ¬æ¥ä¿è¯åŸå­æ€§ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é‡Šæ”¾é”æ—¶ï¼Œå…ˆæ¯”è¾ƒ unique_value æ˜¯å¦ç›¸ç­‰ï¼Œé¿å…é”çš„è¯¯é‡Šæ”¾</span></span><br><span class="line"><span class="keyword">if</span> redis.call(<span class="string">&quot;get&quot;</span>,KEYS[<span class="number">1</span>]) == ARGV[<span class="number">1</span>] then</span><br><span class="line">    <span class="keyword">return</span> redis.call(<span class="string">&quot;del&quot;</span>,KEYS[<span class="number">1</span>])</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">end</span><br></pre></td></tr></table></figure><h2 id="3-é™¤äº†luaæœ‰æ²¡æœ‰ä»€ä¹ˆä¹Ÿèƒ½ä¿è¯redisçš„åŸå­æ€§ï¼Ÿ"><a href="#3-é™¤äº†luaæœ‰æ²¡æœ‰ä»€ä¹ˆä¹Ÿèƒ½ä¿è¯redisçš„åŸå­æ€§ï¼Ÿ" class="headerlink" title="3.é™¤äº†luaæœ‰æ²¡æœ‰ä»€ä¹ˆä¹Ÿèƒ½ä¿è¯redisçš„åŸå­æ€§ï¼Ÿ"></a>3.é™¤äº†luaæœ‰æ²¡æœ‰ä»€ä¹ˆä¹Ÿèƒ½ä¿è¯redisçš„åŸå­æ€§ï¼Ÿ</h2><p>redis äº‹åŠ¡ä¹Ÿå¯ä»¥ä¿è¯å¤šä¸ªæ“ä½œçš„åŸå­æ€§ã€‚</p><p>å¦‚æœ redis äº‹åŠ¡æ­£å¸¸æ‰§è¡Œï¼Œæ²¡æœ‰å‘ç”Ÿä»»ä½•é”™è¯¯ï¼Œé‚£ä¹ˆ<strong>ä½¿ç”¨ MULTI å’Œ EXEC é…åˆä½¿ç”¨ï¼Œå°±å¯ä»¥ä¿è¯å¤šä¸ªæ“ä½œéƒ½å®Œæˆã€‚</strong></p><p>ä½†æ˜¯ï¼Œå¦‚æœäº‹åŠ¡æ‰§è¡Œå‘ç”Ÿé”™è¯¯äº†ï¼Œå°±æ²¡åŠæ³•ä¿è¯åŸå­æ€§äº†ã€‚æ¯”å¦‚è¯´ 2 ä¸ªæ“ä½œï¼Œç¬¬ä¸€ä¸ªæ“ä½œæ‰§è¡Œæˆæœäº†ï¼Œä½†æ˜¯ç¬¬äºŒä¸ªæ“ä½œæ‰§è¡Œçš„æ—¶å€™ï¼Œå‘½ä»¤å‡ºé”™äº†ï¼Œ<strong>é‚£äº‹åŠ¡å¹¶ä¸ä¼šå›æ»šï¼Œå› ä¸ºRedis ä¸­å¹¶æ²¡æœ‰æä¾›å›æ»šæœºåˆ¶ã€‚</strong></p><p>ä¸¾ä¸ªå°ä¾‹å­ã€‚äº‹åŠ¡ä¸­çš„ LPOP å‘½ä»¤å¯¹ String ç±»å‹æ•°æ®è¿›è¡Œæ“ä½œï¼Œå…¥é˜Ÿæ—¶æ²¡æœ‰æŠ¥é”™ï¼Œä½†æ˜¯ï¼Œåœ¨ EXEC æ‰§è¡Œæ—¶æŠ¥é”™äº†ã€‚LPOP å‘½ä»¤æœ¬èº«æ²¡æœ‰æ‰§è¡ŒæˆåŠŸï¼Œä½†æ˜¯äº‹åŠ¡ä¸­çš„ DECR å‘½ä»¤å´æˆåŠŸæ‰§è¡Œäº†ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">#å¼€å¯äº‹åŠ¡</span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; MULTI</span><br><span class="line">OK</span><br><span class="line">#å‘é€äº‹åŠ¡ä¸­çš„ç¬¬ä¸€ä¸ªæ“ä½œï¼ŒLPOPå‘½ä»¤æ“ä½œçš„æ•°æ®ç±»å‹ä¸åŒ¹é…ï¼Œæ­¤æ—¶å¹¶ä¸æŠ¥é”™</span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; LPOP a:stock</span><br><span class="line">QUEUED</span><br><span class="line">#å‘é€äº‹åŠ¡ä¸­çš„ç¬¬äºŒä¸ªæ“ä½œ</span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; DECR b:stock</span><br><span class="line">QUEUED</span><br><span class="line">#å®é™…æ‰§è¡Œäº‹åŠ¡ï¼Œäº‹åŠ¡ç¬¬ä¸€ä¸ªæ“ä½œæ‰§è¡ŒæŠ¥é”™</span><br><span class="line"><span class="number">127.0</span><span class="number">.0</span><span class="number">.1</span>:<span class="number">6379</span>&gt; EXEC</span><br><span class="line"><span class="number">1</span>) (error) WRONGTYPE Operation against a key holding the wrong kind of value</span><br><span class="line"><span class="number">2</span>) (integer) <span class="number">8</span></span><br></pre></td></tr></table></figure><p>å› æ­¤ï¼ŒRedis å¯¹äº‹åŠ¡åŸå­æ€§å±æ€§çš„ä¿è¯æƒ…å†µï¼š</p><ul><li><strong>Redis äº‹åŠ¡æ­£å¸¸æ‰§è¡Œï¼Œå¯ä»¥ä¿è¯åŸå­æ€§ï¼›</strong></li><li>Redis äº‹åŠ¡æ‰§è¡Œä¸­æŸä¸€ä¸ªæ“ä½œæ‰§è¡Œå¤±è´¥ï¼Œä¸ä¿è¯åŸå­æ€§ï¼›</li></ul><h1 id="ç¼“å­˜"><a href="#ç¼“å­˜" class="headerlink" title="ç¼“å­˜"></a>ç¼“å­˜</h1><h2 id="1-ç¼“å­˜ä¸‰å¤§é—®é¢˜å…„å¼Ÿ"><a href="#1-ç¼“å­˜ä¸‰å¤§é—®é¢˜å…„å¼Ÿ" class="headerlink" title="1.ç¼“å­˜ä¸‰å¤§é—®é¢˜å…„å¼Ÿ"></a>1.ç¼“å­˜ä¸‰å¤§é—®é¢˜å…„å¼Ÿ</h2><p>ç¼“å­˜é›ªå´©ï¼š</p><p>å¤§é‡ key è®¾ç½®äº†ç›¸åŒçš„ TTLï¼Œåˆ°æœŸåä¸€èµ·å¤±æ•ˆã€‚</p><p>è§£å†³ï¼š</p><p>è®¾ç½®è¿‡æœŸæ—¶é—´<strong>åŠ ä¸Šéšæœºå€¼ï¼Œé¿å…é›†ä¸­è¿‡æœŸ</strong></p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">expire(&quot;key&quot;, baseTime + random(0, 60));</span><br></pre></td></tr></table></figure><p>æ„å»ºå¤šçº§ç¼“å­˜ï¼ˆå¦‚æœ¬åœ° Caffeine + Redisï¼‰</p><p>å¯¹å…³é”®æ•°æ®ä½¿ç”¨æŒä¹…ç¼“å­˜ï¼ˆä¸è¿‡æœŸï¼‰</p><p>æœ¬åœ°é™çº§ç­‰ç­‰ã€‚</p><p>ç¼“å­˜ç©¿é€ï¼š</p><p>æŸ¥è¯¢çš„ key æœ¬èº«æ˜¯æ— æ•ˆçš„ï¼Œæ•°æ®åº“ä¹Ÿæ²¡æœ‰ï¼Œå¯¼è‡´ç¼“å­˜æ°¸è¿œä¸ä¼šå‘½ä¸­ã€‚</p><p>å¯¹â€œæŸ¥ä¸åˆ°â€çš„ key ç¼“å­˜ç©ºå€¼ï¼ˆå¦‚ç©ºå­—ç¬¦ä¸²ã€ç‰¹æ®Šæ ‡è®°ï¼‰</p><p>ä½¿ç”¨<strong>å¸ƒéš†è¿‡æ»¤å™¨</strong>æå‰æ‹¦æˆªéæ³• keyï¼ˆé«˜æ•ˆè¿‡æ»¤ä¸å­˜åœ¨çš„ keyï¼‰</p><p>åšæ¥å£å±‚é˜²æŠ¤ï¼ˆé»‘åå•ã€é˜²åˆ·ç­–ç•¥ï¼‰</p><p>ç¼“å­˜å‡»ç©¿ï¼š</p><p>ä¸€ä¸ªè®¿é—®é‡æé«˜çš„çƒ­ç‚¹ key åœ¨æŸä¸ªæ—¶åˆ»åˆšå¥½è¿‡æœŸäº†ï¼Œæ­¤æ—¶å¤§é‡è¯·æ±‚å¹¶å‘è®¿</p><p>åŠ äº’æ–¥é”ï¼ˆä¿è¯ä¸€ä¸ªçº¿ç¨‹é‡å»ºç¼“å­˜ï¼‰</p><p>æå‰é¢„çƒ­ï¼Œè®¾ç½®ä¸è¿‡æœŸ key</p><p>ä½¿ç”¨é€»è¾‘è¿‡æœŸ + å¼‚æ­¥æ›´æ–°æœºåˆ¶ï¼ˆå¦‚å¼‚æ­¥åˆ·æ–°çº¿ç¨‹ï¼‰</p><p>åˆ†å¸ƒå¼é”ã€é€»è¾‘è¿‡æœŸ + å»¶è¿ŸåŒå†™</p><h2 id="2-Redisæ€ä¹ˆåšå†…å­˜ä¼˜åŒ–"><a href="#2-Redisæ€ä¹ˆåšå†…å­˜ä¼˜åŒ–" class="headerlink" title="2.Redisæ€ä¹ˆåšå†…å­˜ä¼˜åŒ–"></a>2.<strong>Redisæ€ä¹ˆåšå†…å­˜ä¼˜åŒ–</strong></h2><ol><li><strong>é€‰æ‹©åˆé€‚çš„æ•°æ®ç»“æ„</strong></li></ol><ul><li>åˆç†ä½¿ç”¨æ•°æ®ç»“æ„å¯ä»¥æ˜¾è‘—èŠ‚çœå†…å­˜ï¼š<ul><li>ä½¿ç”¨ <code>Hash</code> å­˜å‚¨å¤šä¸ªå­—æ®µæ•°æ®ï¼Œå­—æ®µè¾ƒå°æ—¶å…±äº«å†…éƒ¨ç»“æ„ï¼ˆèŠ‚çœå…ƒæ•°æ®å¼€é”€ï¼‰</li><li>ä½¿ç”¨ <code>ListPack</code> ä»£æ›¿ <code>Ziplist</code>ï¼Œæ”¯æŒå‹ç¼©</li><li>åˆç†ä½¿ç”¨ <code>Set</code>ã€<code>ZSet</code>ã€<code>Bitmap</code>ã€<code>HyperLogLog</code> ç­‰ä»¥æœ€å°å†…å­˜å®ç°ç›®æ ‡</li></ul></li></ul><ol><li><strong>åˆç†é…ç½®å°å¯¹è±¡èšåˆï¼ˆå¦‚ hash-max-ziplist-entriesï¼‰</strong></li></ol><ul><li><p>å½“ <code>Hash</code> çš„å­—æ®µæ•°é‡ä¸å¤šæ—¶ï¼ŒRedis ä¼šä½¿ç”¨<strong>å‹ç¼©ç»“æ„ï¼ˆlistpackï¼‰</strong>æ¥èŠ‚çœå†…å­˜ã€‚</p></li><li><p>é»˜è®¤é˜ˆå€¼å¯é€šè¿‡ä»¥ä¸‹å‚æ•°è°ƒæ•´ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">hash-max-ziplist-entries 512</span><br><span class="line">hash-max-ziplist-value 64</span><br></pre></td></tr></table></figure></li></ul><ol><li><strong>å¼€å¯å†…å­˜å‹ç¼©æ¨¡å—ï¼ˆRedis 7 å¼•å…¥ï¼‰</strong></li></ol><ul><li>Redis 7 æ”¯æŒæ•°æ®çš„å†…å­˜å‹ç¼©æ¨¡å— <code>RedisMemoryCompressModule</code></li><li>å¯¹äº<strong>å†·æ•°æ®ä½¿ç”¨å‹ç¼©ç®—æ³•</strong>ï¼ˆå¦‚ LZ4ï¼‰å‡å°‘ç©ºé—´</li></ul><ol><li><strong>ä½¿ç”¨åˆç†çš„æ•°æ®ç¼–ç </strong></li></ol><ul><li>Redis é’ˆå¯¹ä¸åŒæ•°æ®é‡å’Œå†…å®¹ï¼Œè‡ªåŠ¨é‡‡ç”¨æœ€ä¼˜ç¼–ç ï¼ˆå¦‚æ•´æ•°ä¼˜åŒ–ã€å°å¯¹è±¡å‹ç¼©ï¼‰</li><li>ä½¿ç”¨ <code>OBJECT encoding key</code> æŸ¥çœ‹é”®çš„å®é™…ç¼–ç æ–¹å¼</li></ul><ol><li><strong>è®¾ç½®è¿‡æœŸæ—¶é—´ï¼ˆTTLï¼‰</strong></li></ol><ul><li>å¯¹éæ°¸ä¹…æ•°æ®è®¾ç½® <code>EXPIRE</code>ï¼ŒåŠæ—¶é‡Šæ”¾æ— ç”¨æ•°æ®</li><li>é™ä½å†…å­˜å ç”¨ï¼Œé˜²æ­¢å†…å­˜æ³„æ¼</li></ul><ol><li><strong>å¯ç”¨ maxmemory ç­–ç•¥</strong></li></ol><ul><li><p>é™åˆ¶æœ€å¤§å†…å­˜ï¼Œå¹¶è®¾å®šæ·˜æ±°ç­–ç•¥ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">maxmemory 1gb</span><br><span class="line">maxmemory-policy allkeys-lru</span><br></pre></td></tr></table></figure></li><li><p>å¸¸è§æ·˜æ±°ç­–ç•¥ï¼š</p><ul><li><code>volatile-lru</code>ï¼šåªå¯¹è®¾ç½®äº† TTL çš„ key ä½¿ç”¨ LRU</li><li><code>allkeys-lru</code>ï¼šæ‰€æœ‰ key éƒ½å‚ä¸æ·˜æ±°</li><li><code>volatile-ttl</code>ï¼šæ ¹æ® TTL å‰©ä½™æ—¶é—´æ·˜æ±°</li><li><code>allkeys-random</code>ï¼šéšæœºæ·˜æ±°ä»»æ„ key</li></ul></li></ul><ol><li><strong>é¿å…å¤§ Keyã€å¤§ Value</strong></li></ol><ul><li>æ‹†åˆ†å¤§ Keyï¼ˆå¦‚å¤§å‹ Hashï¼‰ä¸ºå¤šä¸ªå° Key</li><li>å‡å°‘å†…å­˜ç¢ç‰‡å’Œé˜»å¡é£é™©ï¼ˆç‰¹åˆ«æ˜¯åœ¨æŒä¹…åŒ–å’Œå¤åˆ¶æ—¶ï¼‰</li></ul><ol><li><strong>ä½¿ç”¨å‹ç¼©æ•°æ®æ ¼å¼å­˜å‚¨ä¸šåŠ¡æ•°æ®</strong></li></ol><ul><li>ä¸šåŠ¡ä¸Šå¯å°† JSON å‹ç¼©ä¸º <strong>MsgPackã€Protobufã€Snappy</strong> ç­‰æ ¼å¼åå†å­˜å…¥ Redis</li></ul><h2 id="3-è¿‡æœŸåˆ é™¤ç­–ç•¥å’Œå†…å­˜æ·˜æ±°ç­–ç•¥æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"><a href="#3-è¿‡æœŸåˆ é™¤ç­–ç•¥å’Œå†…å­˜æ·˜æ±°ç­–ç•¥æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ" class="headerlink" title="3.è¿‡æœŸåˆ é™¤ç­–ç•¥å’Œå†…å­˜æ·˜æ±°ç­–ç•¥æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ"></a>3.è¿‡æœŸåˆ é™¤ç­–ç•¥å’Œå†…å­˜æ·˜æ±°ç­–ç•¥æœ‰ä»€ä¹ˆåŒºåˆ«ï¼Ÿ</h2><p>åŒºåˆ«ï¼š</p><ul><li>å†…å­˜æ·˜æ±°ç­–ç•¥æ˜¯åœ¨å†…å­˜æ»¡äº†çš„æ—¶å€™ï¼Œredis ä¼šè§¦å‘<strong>å†…å­˜æ·˜æ±°ç­–ç•¥</strong>ï¼Œæ¥æ·˜æ±°ä¸€äº›ä¸å¿…è¦çš„å†…å­˜èµ„æºï¼Œä»¥è…¾å‡ºç©ºé—´ï¼Œæ¥ä¿å­˜æ–°çš„å†…å®¹</li><li>è¿‡æœŸé”®åˆ é™¤ç­–ç•¥æ˜¯å°†<strong>å·²è¿‡æœŸçš„é”®å€¼å¯¹è¿›è¡Œåˆ é™¤</strong>ï¼ŒRedis é‡‡ç”¨çš„åˆ é™¤ç­–ç•¥æ˜¯æƒ°æ€§åˆ é™¤+å®šæœŸåˆ é™¤ã€‚</li></ul><h2 id="4-ä»‹ç»ä¸€ä¸‹Redis-å†…å­˜æ·˜æ±°ç­–ç•¥"><a href="#4-ä»‹ç»ä¸€ä¸‹Redis-å†…å­˜æ·˜æ±°ç­–ç•¥" class="headerlink" title="4.ä»‹ç»ä¸€ä¸‹Redis å†…å­˜æ·˜æ±°ç­–ç•¥"></a>4.ä»‹ç»ä¸€ä¸‹Redis å†…å­˜æ·˜æ±°ç­–ç•¥</h2><p>åœ¨ 32 ä½æ“ä½œç³»ç»Ÿä¸­ï¼Œ<strong>maxmemory çš„é»˜è®¤å€¼æ˜¯ 3G</strong>ï¼Œå› ä¸º 32 ä½çš„æœºå™¨æœ€å¤§åªæ”¯æŒ 4GB çš„å†…å­˜ï¼Œè€Œç³»ç»Ÿæœ¬èº«å°±éœ€è¦ä¸€å®šçš„å†…å­˜èµ„æºæ¥æ”¯æŒè¿è¡Œï¼Œæ‰€ä»¥ 32 ä½æ“ä½œç³»ç»Ÿé™åˆ¶æœ€å¤§ 3 GB çš„å¯ç”¨å†…å­˜æ˜¯éå¸¸åˆç†çš„ï¼Œè¿™æ ·å¯ä»¥é¿å…å› ä¸ºå†…å­˜ä¸è¶³è€Œå¯¼è‡´ Redis å®ä¾‹å´©æºƒã€‚</p><p>Redis å†…å­˜æ·˜æ±°ç­–ç•¥å…±æœ‰å…«ç§ï¼Œè¿™å…«ç§ç­–ç•¥å¤§ä½“åˆ†ä¸ºã€Œä¸è¿›è¡Œæ•°æ®æ·˜æ±°ã€å’Œã€Œè¿›è¡Œæ•°æ®æ·˜æ±°ã€ä¸¤ç±»ç­–ç•¥ã€‚</p><p><img src="https://cdn.xiaolincoding.com//picgo/1717480443917-64e65a05-b9f9-4a6e-a969-8f18f72f2133.png" alt="img"></p><p><em>1ã€ä¸è¿›è¡Œæ•°æ®æ·˜æ±°çš„ç­–ç•¥ï¼š</em></p><ul><li><strong>noeviction</strong>ï¼ˆRedis3.0ä¹‹åï¼Œé»˜è®¤çš„å†…å­˜æ·˜æ±°ç­–ç•¥ï¼‰ ï¼šå®ƒè¡¨ç¤ºå½“<strong>è¿è¡Œå†…å­˜è¶…è¿‡æœ€å¤§è®¾ç½®å†…å­˜æ—¶ï¼Œä¸æ·˜æ±°ä»»ä½•æ•°æ®ï¼Œè¿™æ—¶å¦‚æœæœ‰æ–°çš„æ•°æ®å†™å…¥ï¼Œä¼šæŠ¥é”™é€šçŸ¥ç¦æ­¢å†™å…¥ï¼Œä¸æ·˜æ±°ä»»ä½•æ•°æ®</strong>ï¼Œä½†æ˜¯å¦‚æœæ²¡ç”¨æ•°æ®å†™å…¥çš„è¯ï¼Œåªæ˜¯å•çº¯çš„æŸ¥è¯¢æˆ–è€…åˆ é™¤æ“ä½œçš„è¯ï¼Œè¿˜æ˜¯å¯ä»¥æ­£å¸¸å·¥ä½œã€‚</li></ul><p><em>2ã€è¿›è¡Œæ•°æ®æ·˜æ±°çš„ç­–ç•¥ï¼š</em></p><p>é’ˆå¯¹ã€Œè¿›è¡Œæ•°æ®æ·˜æ±°ã€è¿™ä¸€ç±»ç­–ç•¥ï¼Œåˆå¯ä»¥ç»†åˆ†ä¸ºã€Œåœ¨è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„æ•°æ®ä¸­è¿›è¡Œæ·˜æ±°ã€å’Œã€Œåœ¨æ‰€æœ‰æ•°æ®èŒƒå›´å†…è¿›è¡Œæ·˜æ±°ã€è¿™ä¸¤ç±»ç­–ç•¥ã€‚</p><ul><li>åœ¨è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„æ•°æ®ä¸­è¿›è¡Œæ·˜æ±°ï¼š</li><li><strong>volatile-random</strong>ï¼šéšæœºæ·˜æ±°è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„ä»»æ„é”®å€¼ï¼›</li><li><strong>volatile-ttl</strong>ï¼šä¼˜å…ˆæ·˜æ±°æ›´æ—©è¿‡æœŸçš„é”®å€¼ã€‚</li><li><strong>volatile-lru</strong>ï¼ˆRedis3.0 ä¹‹å‰ï¼Œé»˜è®¤çš„å†…å­˜æ·˜æ±°ç­–ç•¥ï¼‰ï¼š<strong>æ·˜æ±°æ‰€æœ‰è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„é”®å€¼ä¸­ï¼Œæœ€ä¹…æœªä½¿ç”¨çš„é”®å€¼ï¼›</strong></li><li><strong>volatile-lfu</strong>ï¼ˆRedis 4.0 åæ–°å¢çš„å†…å­˜æ·˜æ±°ç­–ç•¥ï¼‰ï¼šæ·˜æ±°æ‰€æœ‰è®¾ç½®äº†è¿‡æœŸæ—¶é—´çš„é”®å€¼ä¸­ï¼Œæœ€å°‘ä½¿ç”¨çš„é”®å€¼ï¼›</li><li>åœ¨æ‰€æœ‰æ•°æ®èŒƒå›´å†…è¿›è¡Œæ·˜æ±°ï¼š</li><li><strong>allkeys-random</strong>ï¼šéšæœºæ·˜æ±°ä»»æ„é”®å€¼;</li><li><strong>allkeys-lru</strong>ï¼šæ·˜æ±°æ•´ä¸ªé”®å€¼ä¸­æœ€ä¹…æœªä½¿ç”¨çš„é”®å€¼ï¼›</li><li><strong>allkeys-lfu</strong>ï¼ˆRedis 4.0 åæ–°å¢çš„å†…å­˜æ·˜æ±°ç­–ç•¥ï¼‰ï¼šæ·˜æ±°æ•´ä¸ªé”®å€¼ä¸­æœ€å°‘ä½¿ç”¨çš„é”®å€¼ã€‚</li></ul><h2 id="5-ä»‹ç»ä¸€ä¸‹Redisè¿‡æœŸåˆ é™¤ç­–ç•¥"><a href="#5-ä»‹ç»ä¸€ä¸‹Redisè¿‡æœŸåˆ é™¤ç­–ç•¥" class="headerlink" title="5.ä»‹ç»ä¸€ä¸‹Redisè¿‡æœŸåˆ é™¤ç­–ç•¥"></a>5.ä»‹ç»ä¸€ä¸‹Redisè¿‡æœŸåˆ é™¤ç­–ç•¥</h2><p><strong>Redis é€‰æ‹©ã€Œæƒ°æ€§åˆ é™¤+å®šæœŸåˆ é™¤ã€è¿™ä¸¤ç§ç­–ç•¥é…å’Œä½¿ç”¨</strong>ï¼Œä»¥æ±‚åœ¨åˆç†ä½¿ç”¨ CPU æ—¶é—´å’Œé¿å…å†…å­˜æµªè´¹ä¹‹é—´å–å¾—å¹³è¡¡ã€‚</p><p>Redis çš„<strong>æƒ°æ€§åˆ é™¤ç­–ç•¥</strong>ç”± <strong>db.c æ–‡ä»¶ä¸­çš„ expireIfNeeded</strong> å‡½æ•°å®ç°ï¼Œä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">int expireIfNeeded(redisDb *db, robj *key) &#123;</span><br><span class="line">    // åˆ¤æ–­ key æ˜¯å¦è¿‡æœŸ</span><br><span class="line">    if (!keyIsExpired(db,key)) return 0;</span><br><span class="line">    ....</span><br><span class="line">    /* åˆ é™¤è¿‡æœŸé”® */</span><br><span class="line">    ....</span><br><span class="line">    // å¦‚æœ server.lazyfree_lazy_expire ä¸º 1 è¡¨ç¤ºå¼‚æ­¥åˆ é™¤ï¼Œåä¹‹åŒæ­¥åˆ é™¤ï¼›</span><br><span class="line">    return server.lazyfree_lazy_expire ? dbAsyncDelete(db,key) :</span><br><span class="line">                                         dbSyncDelete(db,key);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Redis åœ¨è®¿é—®æˆ–è€…ä¿®æ”¹ key ä¹‹å‰ï¼Œéƒ½ä¼šè°ƒç”¨ expireIfNeeded å‡½æ•°å¯¹å…¶è¿›è¡Œæ£€æŸ¥ï¼Œæ£€æŸ¥ key æ˜¯å¦è¿‡æœŸï¼š</p><ul><li>å¦‚æœè¿‡æœŸï¼Œåˆ™åˆ é™¤è¯¥ keyï¼Œè‡³äºé€‰æ‹©å¼‚æ­¥åˆ é™¤ï¼Œè¿˜æ˜¯é€‰æ‹©åŒæ­¥åˆ é™¤ï¼Œæ ¹æ® lazyfree_lazy_expire å‚æ•°é…ç½®å†³å®šï¼ˆRedis 4.0ç‰ˆæœ¬å¼€å§‹æä¾›å‚æ•°ï¼‰ï¼Œç„¶åè¿”å› null å®¢æˆ·ç«¯ï¼›</li><li>å¦‚æœæ²¡æœ‰è¿‡æœŸï¼Œä¸åšä»»ä½•å¤„ç†ï¼Œç„¶åè¿”å›æ­£å¸¸çš„é”®å€¼å¯¹ç»™å®¢æˆ·ç«¯ï¼›</li></ul><p>æƒ°æ€§åˆ é™¤çš„æµç¨‹å›¾å¦‚ä¸‹ï¼š</p><p><img src="https://cdn.xiaolincoding.com//picgo/1717480558040-db8f2883-fb68-43fa-bcf8-42f5ac736c09.webp" alt="img"></p><p><strong>Redis çš„å®šæœŸåˆ é™¤æ˜¯æ¯éš”ä¸€æ®µæ—¶é—´ã€Œéšæœºã€ä»æ•°æ®åº“ä¸­å–å‡ºä¸€å®šæ•°é‡çš„ key è¿›è¡Œæ£€æŸ¥ï¼Œå¹¶åˆ é™¤å…¶ä¸­çš„è¿‡æœŸkeyã€‚</strong></p><p><em>1ã€è¿™ä¸ªé—´éš”æ£€æŸ¥çš„æ—¶é—´æ˜¯å¤šé•¿å‘¢ï¼Ÿ</em></p><p>åœ¨ Redis ä¸­ï¼Œ<strong>é»˜è®¤æ¯ç§’è¿›è¡Œ 10 æ¬¡è¿‡æœŸæ£€æŸ¥ä¸€æ¬¡æ•°æ®åº“ï¼Œæ­¤é…ç½®å¯é€šè¿‡ Redis çš„é…ç½®æ–‡ä»¶ redis.conf è¿›è¡Œé…ç½®ï¼Œé…ç½®é”®ä¸º hz å®ƒçš„é»˜è®¤å€¼æ˜¯ hz 10ã€‚</strong>ç‰¹åˆ«å¼ºè°ƒä¸‹ï¼Œæ¯æ¬¡æ£€æŸ¥æ•°æ®åº“å¹¶ä¸æ˜¯éå†è¿‡æœŸå­—å…¸ä¸­çš„æ‰€æœ‰ keyï¼Œè€Œæ˜¯ä»æ•°æ®åº“ä¸­éšæœºæŠ½å–ä¸€å®šæ•°é‡çš„ key è¿›è¡Œè¿‡æœŸæ£€æŸ¥ã€‚</p><p><em>2ã€éšæœºæŠ½æŸ¥çš„æ•°é‡æ˜¯å¤šå°‘å‘¢ï¼Ÿ</em></p><p>æˆ‘æŸ¥äº†ä¸‹æºç ï¼Œå®šæœŸåˆ é™¤çš„å®ç°åœ¨ expire.c æ–‡ä»¶ä¸‹çš„ activeExpireCycle å‡½æ•°ä¸­ï¼Œå…¶ä¸­éšæœºæŠ½æŸ¥çš„æ•°é‡ç”± ACTIVE_EXPIRE_CYCLE_LOOKUPS_PER_LOOP å®šä¹‰çš„ï¼Œå®ƒæ˜¯å†™æ­»åœ¨ä»£ç ä¸­çš„ï¼Œæ•°å€¼æ˜¯ 20ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œæ•°æ®åº“æ¯è½®æŠ½æŸ¥æ—¶ï¼Œä¼šéšæœºé€‰æ‹© 20 ä¸ª key åˆ¤æ–­æ˜¯å¦è¿‡æœŸã€‚æ¥ä¸‹æ¥ï¼Œè¯¦ç»†è¯´è¯´ Redis çš„å®šæœŸåˆ é™¤çš„æµç¨‹ï¼š</p><ol><li>ä»è¿‡æœŸå­—å…¸ä¸­éšæœºæŠ½å– 20 ä¸ª keyï¼›</li><li>æ£€æŸ¥è¿™ 20 ä¸ª key æ˜¯å¦è¿‡æœŸï¼Œå¹¶åˆ é™¤å·²è¿‡æœŸçš„ keyï¼›</li><li>å¦‚æœæœ¬è½®æ£€æŸ¥çš„å·²è¿‡æœŸ key çš„æ•°é‡ï¼Œè¶…è¿‡ 5 ä¸ªï¼ˆ20/4ï¼‰ï¼Œä¹Ÿå°±æ˜¯ã€Œå·²è¿‡æœŸ key çš„æ•°é‡ã€å æ¯”ã€ŒéšæœºæŠ½å– key çš„æ•°é‡ã€å¤§äº 25%ï¼Œåˆ™ç»§ç»­é‡å¤æ­¥éª¤ 1ï¼›å¦‚æœå·²è¿‡æœŸçš„ key æ¯”ä¾‹å°äº 25%ï¼Œåˆ™åœæ­¢ç»§ç»­åˆ é™¤è¿‡æœŸ keyï¼Œç„¶åç­‰å¾…ä¸‹ä¸€è½®å†æ£€æŸ¥ã€‚</li></ol><p>å¯ä»¥çœ‹åˆ°ï¼Œå®šæœŸåˆ é™¤æ˜¯ä¸€ä¸ªå¾ªç¯çš„æµç¨‹ã€‚é‚£ Redis ä¸ºäº†ä¿è¯å®šæœŸåˆ é™¤ä¸ä¼šå‡ºç°å¾ªç¯è¿‡åº¦ï¼Œå¯¼è‡´çº¿ç¨‹å¡æ­»ç°è±¡ï¼Œä¸ºæ­¤å¢åŠ äº†å®šæœŸåˆ é™¤å¾ªç¯æµç¨‹çš„æ—¶é—´ä¸Šé™ï¼Œé»˜è®¤ä¸ä¼šè¶…è¿‡ 25msã€‚é’ˆå¯¹å®šæœŸåˆ é™¤çš„æµç¨‹ï¼Œæˆ‘å†™äº†ä¸ªä¼ªä»£ç ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">do</span> &#123;</span><br><span class="line">    <span class="comment">//å·²è¿‡æœŸçš„æ•°é‡</span></span><br><span class="line">    expired = <span class="number">0</span>ï¼›</span><br><span class="line">    <span class="comment">//éšæœºæŠ½å–çš„æ•°é‡</span></span><br><span class="line">    num = <span class="number">20</span>;</span><br><span class="line">    <span class="keyword">while</span> (num--) &#123;</span><br><span class="line">        <span class="comment">//1. ä»è¿‡æœŸå­—å…¸ä¸­éšæœºæŠ½å– 1 ä¸ª key</span></span><br><span class="line">        <span class="comment">//2. åˆ¤æ–­è¯¥ key æ˜¯å¦è¿‡æœŸï¼Œå¦‚æœå·²è¿‡æœŸåˆ™è¿›è¡Œåˆ é™¤ï¼ŒåŒæ—¶å¯¹ expired++</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è¶…è¿‡æ—¶é—´é™åˆ¶åˆ™é€€å‡º</span></span><br><span class="line">    <span class="keyword">if</span> (timelimit_exit) <span class="keyword">return</span>;</span><br><span class="line"></span><br><span class="line">  <span class="comment">/* å¦‚æœæœ¬è½®æ£€æŸ¥çš„å·²è¿‡æœŸ key çš„æ•°é‡ï¼Œè¶…è¿‡ 25%ï¼Œåˆ™ç»§ç»­éšæœºæŠ½æŸ¥ï¼Œå¦åˆ™é€€å‡ºæœ¬è½®æ£€æŸ¥ */</span></span><br><span class="line">&#125; <span class="keyword">while</span> (expired &gt; <span class="number">20</span>/<span class="number">4</span>);</span><br></pre></td></tr></table></figure><p>å®šæœŸåˆ é™¤çš„æµç¨‹å¦‚ä¸‹ï¼š<img src="https://cdn.xiaolincoding.com//picgo/1717480609871-26ec98a9-5407-43cf-af2f-dd0cfe826541.webp" alt="img"></p><h2 id="6-Redisçš„ç¼“å­˜å¤±æ•ˆä¼šä¸ä¼šç«‹å³åˆ é™¤ï¼Ÿ"><a href="#6-Redisçš„ç¼“å­˜å¤±æ•ˆä¼šä¸ä¼šç«‹å³åˆ é™¤ï¼Ÿ" class="headerlink" title="6.Redisçš„ç¼“å­˜å¤±æ•ˆä¼šä¸ä¼šç«‹å³åˆ é™¤ï¼Ÿ"></a>6.Redisçš„ç¼“å­˜å¤±æ•ˆä¼šä¸ä¼šç«‹å³åˆ é™¤ï¼Ÿ</h2><p>ä¸ä¼šï¼ŒRedis çš„è¿‡æœŸåˆ é™¤ç­–ç•¥æ˜¯é€‰æ‹©ã€Œ<strong>æƒ°æ€§åˆ é™¤+å®šæœŸåˆ é™¤</strong>ã€è¿™ä¸¤ç§ç­–ç•¥é…å’Œä½¿ç”¨ã€‚</p><ul><li>æƒ°æ€§åˆ é™¤ç­–ç•¥çš„åšæ³•æ˜¯ï¼Œ<strong>ä¸ä¸»åŠ¨åˆ é™¤è¿‡æœŸé”®ï¼Œæ¯æ¬¡ä»æ•°æ®åº“è®¿é—® key æ—¶ï¼Œéƒ½æ£€æµ‹ key æ˜¯å¦è¿‡æœŸï¼Œå¦‚æœè¿‡æœŸåˆ™åˆ é™¤è¯¥ keyã€‚</strong></li><li>å®šæœŸåˆ é™¤ç­–ç•¥çš„åšæ³•æ˜¯ï¼Œ<strong>æ¯éš”ä¸€æ®µæ—¶é—´ã€Œéšæœºã€ä»æ•°æ®åº“ä¸­å–å‡ºä¸€å®šæ•°é‡çš„ key è¿›è¡Œæ£€æŸ¥ï¼Œå¹¶åˆ é™¤å…¶ä¸­çš„è¿‡æœŸkeyã€‚</strong></li></ul><p>é‚£ä¹ˆä¸ºä»€ä¹ˆä¸è¿‡æœŸå°±åˆ é™¤</p><p>åœ¨è¿‡æœŸ key æ¯”è¾ƒå¤šçš„æƒ…å†µä¸‹ï¼Œ<strong>åˆ é™¤è¿‡æœŸ key å¯èƒ½ä¼šå ç”¨ç›¸å½“ä¸€éƒ¨åˆ† CPU æ—¶é—´</strong>ï¼Œåœ¨å†…å­˜ä¸ç´§å¼ ä½† CPU æ—¶é—´ç´§å¼ çš„æƒ…å†µä¸‹ï¼Œå°† CPU æ—¶é—´ç”¨äºåˆ é™¤å’Œå½“å‰ä»»åŠ¡æ— å…³çš„è¿‡æœŸé”®ä¸Šï¼Œæ— ç–‘ä¼šå¯¹æœåŠ¡å™¨çš„å“åº”æ—¶é—´å’Œååé‡é€ æˆå½±å“ã€‚æ‰€ä»¥ï¼Œå®šæ—¶åˆ é™¤ç­–ç•¥å¯¹ CPU ä¸å‹å¥½ã€‚</p><h2 id="7-ä¸ºä»€ä¹ˆå…ˆå†™-MySQL-å†åˆ é™¤-Redisï¼Ÿ"><a href="#7-ä¸ºä»€ä¹ˆå…ˆå†™-MySQL-å†åˆ é™¤-Redisï¼Ÿ" class="headerlink" title="7.ä¸ºä»€ä¹ˆå…ˆå†™ MySQL å†åˆ é™¤ Redisï¼Ÿ"></a>7.ä¸ºä»€ä¹ˆå…ˆå†™ MySQL å†åˆ é™¤ Redisï¼Ÿ</h2><p>åœ¨ç¼“å­˜æ›´æ–°ç­–ç•¥ä¸­ï¼Œ<strong>å…ˆå†™ MySQL å†åˆ é™¤ Redis</strong> æ˜¯ä¸€ç§å¸¸è§åšæ³•ï¼Œç”¨äº<strong>é¿å…å¹¶å‘ä¸‹çš„æ•°æ®ä¸ä¸€è‡´é—®é¢˜ã€‚</strong>å…·ä½“æµç¨‹æ˜¯ï¼šå…ˆå°†<strong>æ–°æ•°æ®å†™å…¥ MySQLï¼Œç¡®ä¿æ•°æ®æŒä¹…åŒ–æˆåŠŸåï¼Œå†åˆ é™¤ Redis ç¼“å­˜ï¼Œè®©ç¼“å­˜å¤±æ•ˆï¼Œä¸‹ä¸€æ¬¡è¯·æ±‚å°±ä¼šä»æ•°æ®åº“ä¸­è¯»å–æœ€æ–°æ•°æ®å¹¶å›å¡«åˆ° Redisã€‚</strong>å¦‚æœåè¿‡æ¥æ“ä½œï¼Œå…ˆåˆ é™¤ Redis å†å†™ MySQLï¼Œå¯èƒ½åœ¨é«˜å¹¶å‘åœºæ™¯ä¸‹å¯¼è‡´<strong>æ—§æ•°æ®è¢«å›å†™ Redis</strong>ï¼Œé€ æˆ<strong>ç¼“å­˜è„æ•°æ®</strong>ã€‚ä¾‹å¦‚ï¼Œè¯·æ±‚ A åˆ é™¤äº†ç¼“å­˜ä½†å°šæœªå®Œæˆæ•°æ®åº“å†™å…¥æ—¶ï¼Œè¯·æ±‚ B æ°å¥½è¯»åˆ°æ—§æ•°æ®å¹¶å†™å…¥ Redisï¼Œæœ€ç»ˆç¼“å­˜ä¸­å­˜å‚¨çš„æ˜¯é”™è¯¯å€¼ã€‚å› æ­¤ï¼Œæ¨èé¡ºåºæ˜¯å…ˆæ›´æ–°æ•°æ®åº“ï¼Œå†åˆ é™¤ç¼“å­˜ï¼Œä»¥å‡å°‘æ•°æ®ä¸ä¸€è‡´é£é™©ã€‚åœ¨é«˜å¹¶å‘æˆ–å¼ºä¸€è‡´æ€§è¦æ±‚åœºæ™¯ä¸‹ï¼Œè¿˜å¯ä»¥ç»“åˆ<strong>å»¶è¿ŸåŒåˆ ã€åˆ†å¸ƒå¼é”ã€æ¶ˆæ¯é˜Ÿåˆ—</strong>ç­‰æœºåˆ¶è¿›ä¸€æ­¥å¢å¼ºæ•°æ®ä¸€è‡´æ€§ä¿éšœã€‚</p><h1 id="é›†ç¾¤"><a href="#é›†ç¾¤" class="headerlink" title="é›†ç¾¤"></a>é›†ç¾¤</h1><h2 id="1-redisåˆ†å¸ƒå¼é”çš„åŸç†"><a href="#1-redisåˆ†å¸ƒå¼é”çš„åŸç†" class="headerlink" title="1.redisåˆ†å¸ƒå¼é”çš„åŸç†"></a>1.redisåˆ†å¸ƒå¼é”çš„åŸç†</h2><p><strong>åœ¨ Redis ä¸­è®¾ç½®ä¸€ä¸ªé”®ä»£è¡¨â€œåŠ é”â€ï¼Œåˆ é™¤è¯¥é”®ä»£è¡¨â€œé‡Šæ”¾é”â€</strong>ã€‚</p><div class="table-container"><table><thead><tr><th>é—®é¢˜</th><th>æè¿°</th></tr></thead><tbody><tr><td>åŸå­æ€§</td><td>å¦‚æœç”¨ <code>SETNX</code> å’Œ <code>EXPIRE</code> åˆ†å¼€å†™ï¼Œä¸å…·å¤‡åŸå­æ€§ï¼Œå¯èƒ½å¯¼è‡´æ­»é”</td></tr><tr><td>é”ç»­æœŸ</td><td>å¦‚æœä¸šåŠ¡æ‰§è¡Œè¶…è¿‡é”çš„ TTLï¼Œé”å¯èƒ½è‡ªåŠ¨è¿‡æœŸï¼Œå¯¼è‡´å¤šä¸ªçº¿ç¨‹å¹¶å‘è¿›å…¥</td></tr><tr><td>é”é‡Šæ”¾</td><td>ç”¨ <code>DEL</code> åˆ é™¤é”å¯èƒ½è¯¯åˆ å…¶ä»–çº¿ç¨‹çš„é”ï¼ˆé”è¢«æå‰é‡Šæ”¾æˆ–è¢«å…¶ä»–çº¿ç¨‹è·å–ï¼‰</td></tr></tbody></table></div><h2 id="2-å“¨å…µé›†ç¾¤é‡Œçš„è„‘è£‚é—®é¢˜"><a href="#2-å“¨å…µé›†ç¾¤é‡Œçš„è„‘è£‚é—®é¢˜" class="headerlink" title="2.å“¨å…µé›†ç¾¤é‡Œçš„è„‘è£‚é—®é¢˜"></a>2.å“¨å…µé›†ç¾¤é‡Œçš„è„‘è£‚é—®é¢˜</h2><p><strong>ç”±äºç½‘ç»œåˆ†åŒºã€å“¨å…µé€šä¿¡å¼‚å¸¸æˆ–ä¸»ä»çŠ¶æ€ä¸åŒæ­¥ï¼Œå¤šä¸ªèŠ‚ç‚¹é”™è¯¯åœ°è®¤ä¸ºè‡ªå·±æ˜¯ä¸»èŠ‚ç‚¹ï¼Œå‡ºç°â€œå¤šä¸ªä¸»â€</strong>ã€‚</p><p>æƒ…å†µï¼š</p><p>ä¸»èŠ‚ç‚¹ä¸éƒ¨åˆ†å“¨å…µæ–­ç½‘ï¼Œä½†ä¸ä»èŠ‚ç‚¹ä»è¿æ¥ï¼›</p><p>å‰©ä½™å“¨å…µå½¢æˆå¤šæ•°æ´¾ï¼Œé‡æ–°é€‰å‡ºæ–°ä¸»ï¼›</p><p>åŸä¸»æœªè¢«å¼ºåˆ¶ä¸‹çº¿ï¼Œç»§ç»­å¯¹å¤–æä¾›å†™æœåŠ¡ï¼›</p><p>æœ€ç»ˆå‡ºç°ä¸¤ä¸ªä¸»èŠ‚ç‚¹ï¼Œæ•°æ®å¯èƒ½ä¸ä¸€è‡´ï¼Œä¸¥é‡æ—¶ä¸¢å¤±ã€‚</p><div class="table-container"><table><thead><tr><th>å±å®³</th><th>æè¿°</th></tr></thead><tbody><tr><td>å†™ä¸¢å¤±</td><td>åŸä¸»çš„å†™æ“ä½œæœªåŒæ­¥åˆ°æ–°ä¸»ï¼Œæœ€ç»ˆè¢«è¦†ç›–æˆ–ä¸¢å¼ƒ</td></tr><tr><td>æ•°æ®ä¸ä¸€è‡´</td><td>å®¢æˆ·ç«¯è¿æ¥äº†ä¸åŒä¸»èŠ‚ç‚¹ï¼Œå†™å…¥æ•°æ®ä¸åŒæ­¥</td></tr><tr><td>ç³»ç»Ÿä¸å¯é¢„æµ‹</td><td>å‡ºç°å¹¶å‘å†™é”™ä¹±ã€æ•°æ®é”™ä¹±ç­‰ä¸¥é‡é—®é¢˜</td></tr></tbody></table></div><div class="table-container"><table><thead><tr><th>æœºåˆ¶</th><th>ä½œç”¨</th></tr></thead><tbody><tr><td><strong>æŠ•ç¥¨é€‰ä¸»</strong></td><td>åªæœ‰å“¨å…µå¤šæ•°æ´¾ï¼ˆè¿‡åŠï¼‰æ‰å¯ä»¥å‘èµ·ä¸»ä»åˆ‡æ¢</td></tr><tr><td><strong>ä¸»ä»è‡ªåŠ¨åˆ‡æ¢</strong></td><td>æ–°ä¸»é€‰å‡ºåé€šçŸ¥å…¶ä»–å“¨å…µã€å®¢æˆ·ç«¯æ›´æ–°è¿æ¥</td></tr><tr><td><strong>slave-priority=0</strong></td><td>è®¾ç½®æŸäº›èŠ‚ç‚¹æ°¸ä¸å½“ä¸»ï¼ˆé¿å…å¼‚å¸¸èŠ‚ç‚¹è¢«é€‰ä¸­ï¼‰</td></tr><tr><td><strong>protected-mode</strong></td><td>Redis å¯åŠ¨é»˜è®¤å¼€å¯ä¿æŠ¤æ¨¡å¼ï¼Œé˜²æ­¢æ„å¤–æš´éœ²ç«¯å£</td></tr><tr><td><strong>config epochï¼ˆç‰ˆæœ¬å·ï¼‰</strong></td><td>æ¯æ¬¡é€‰ä¸»æœ‰ç‰ˆæœ¬ï¼Œæ—§ä¸»æ”¶åˆ°æ–°é…ç½®åä¼šè‡ªåŠ¨å˜ä¸ºä»èŠ‚ç‚¹</td></tr></tbody></table></div><p>åªèƒ½<strong>å°½é‡é™ä½å‘ç”Ÿæ¦‚ç‡</strong>ã€‚åœ¨ç”Ÿäº§ç¯å¢ƒä¸­ï¼Œé€šå¸¸å»ºè®®ä½¿ç”¨æ›´å¥å£®çš„é›†ç¾¤æ¨¡å¼ï¼ˆå¦‚ Redis Clusterã€ZooKeeperã€Raft ç­‰ï¼‰æ¥ä»£æ›¿å“¨å…µã€‚</p><h2 id="4-Redisä¸»ä»åŒæ­¥ä¸­çš„å¢é‡å’Œå®Œå…¨åŒæ­¥æ€ä¹ˆå®ç°ï¼Ÿ"><a href="#4-Redisä¸»ä»åŒæ­¥ä¸­çš„å¢é‡å’Œå®Œå…¨åŒæ­¥æ€ä¹ˆå®ç°ï¼Ÿ" class="headerlink" title="4.Redisä¸»ä»åŒæ­¥ä¸­çš„å¢é‡å’Œå®Œå…¨åŒæ­¥æ€ä¹ˆå®ç°ï¼Ÿ"></a>4.Redisä¸»ä»åŒæ­¥ä¸­çš„å¢é‡å’Œå®Œå…¨åŒæ­¥æ€ä¹ˆå®ç°ï¼Ÿ</h2><blockquote><p>å®Œå…¨åŒæ­¥</p></blockquote><p>å®Œå…¨åŒæ­¥å‘ç”Ÿåœ¨ä»¥ä¸‹å‡ ç§æƒ…å†µï¼š</p><ul><li><strong>åˆæ¬¡åŒæ­¥</strong>ï¼šå½“ä¸€ä¸ªä»æœåŠ¡å™¨ï¼ˆslaveï¼‰é¦–æ¬¡è¿æ¥åˆ°ä¸»æœåŠ¡å™¨ï¼ˆmasterï¼‰æ—¶ï¼Œä¼šè¿›è¡Œä¸€æ¬¡å®Œå…¨åŒæ­¥ã€‚</li><li><strong>ä»æœåŠ¡å™¨æ•°æ®ä¸¢å¤±</strong>ï¼šå¦‚æœä»æœåŠ¡å™¨æ•°æ®ç”±äºæŸç§åŸå› ï¼ˆå¦‚æ–­ç”µï¼‰ä¸¢å¤±ï¼Œå®ƒä¼šè¯·æ±‚è¿›è¡Œå®Œå…¨åŒæ­¥ã€‚</li><li><strong>ä¸»æœåŠ¡å™¨æ•°æ®å‘ç”Ÿå˜åŒ–</strong>ï¼šå¦‚æœä»æœåŠ¡å™¨é•¿æ—¶é—´æœªä¸ä¸»æœåŠ¡å™¨åŒæ­¥ï¼Œå¯¼è‡´æ•°æ®å·®å¼‚å¤ªå¤§ï¼Œä¹Ÿå¯èƒ½è§¦å‘å®Œå…¨åŒæ­¥ã€‚</li></ul><p>ä¸»ä»æœåŠ¡å™¨é—´çš„ç¬¬ä¸€æ¬¡åŒæ­¥çš„è¿‡ç¨‹å¯åˆ†ä¸ºä¸‰ä¸ªé˜¶æ®µï¼š</p><ul><li>ç¬¬ä¸€é˜¶æ®µæ˜¯å»ºç«‹é“¾æ¥ã€åå•†åŒæ­¥ï¼›</li><li>ç¬¬äºŒé˜¶æ®µæ˜¯ä¸»æœåŠ¡å™¨åŒæ­¥æ•°æ®ç»™ä»æœåŠ¡å™¨ï¼›</li><li>ç¬¬ä¸‰é˜¶æ®µæ˜¯ä¸»æœåŠ¡å™¨å‘é€æ–°å†™æ“ä½œå‘½ä»¤ç»™ä»æœåŠ¡å™¨ã€‚</li></ul><p><img src="https://cdn.xiaolincoding.com//picgo/1720157699223-d4aa2235-35e2-42ec-84a8-522600f531c2.png" alt="img"></p><p><strong>å®ç°è¿‡ç¨‹</strong>ï¼š</p><ol><li><strong>ä»æœåŠ¡å™¨å‘é€SYNCå‘½ä»¤</strong>ï¼šä»æœåŠ¡å™¨å‘ä¸»æœåŠ¡å™¨å‘é€<code>SYNC</code>å‘½ä»¤ï¼Œè¯·æ±‚å¼€å§‹åŒæ­¥ã€‚</li><li><strong>ä¸»æœåŠ¡å™¨ç”ŸæˆRDBå¿«ç…§</strong>ï¼šæ¥æ”¶åˆ°<code>SYNC</code>å‘½ä»¤åï¼Œä¸»æœåŠ¡å™¨ä¼šä¿å­˜<strong>å½“å‰æ•°æ®é›†çš„çŠ¶æ€åˆ°ä¸€ä¸ªä¸´æ—¶æ–‡ä»¶ï¼Œè¿™ä¸ªè¿‡ç¨‹ç§°ä¸ºRDBï¼ˆRedis Databaseï¼‰å¿«ç…§ã€‚</strong></li><li><strong>ä¼ è¾“RDBæ–‡ä»¶</strong>ï¼šä¸»æœåŠ¡å™¨å°†<strong>ç”Ÿæˆçš„RDBæ–‡ä»¶</strong>å‘é€ç»™ä»æœåŠ¡å™¨ã€‚</li><li><strong>ä»æœåŠ¡å™¨æ¥æ”¶å¹¶åº”ç”¨RDBæ–‡ä»¶</strong>ï¼šä»æœåŠ¡å™¨æ¥æ”¶RDBæ–‡ä»¶åï¼Œä¼šæ¸…ç©ºå½“å‰çš„æ•°æ®é›†ï¼Œå¹¶è½½å…¥RDBæ–‡ä»¶ä¸­çš„æ•°æ®ã€‚</li><li><strong>ä¸»æœåŠ¡å™¨è®°å½•å†™å‘½ä»¤</strong>ï¼šåœ¨RDBæ–‡ä»¶ç”Ÿæˆå’Œä¼ è¾“æœŸé—´ï¼Œä¸»æœåŠ¡å™¨ä¼š<strong>è®°å½•æ‰€æœ‰æ¥æ”¶åˆ°çš„å†™å‘½ä»¤åˆ°<code>replication backlog buffer</code>ã€‚</strong></li><li><strong>ä¼ è¾“å†™å‘½ä»¤</strong>ï¼šä¸€æ—¦RDBæ–‡ä»¶ä¼ è¾“å®Œæˆï¼Œä¸»æœåŠ¡å™¨ä¼šå°†<code>replication backlog buffer</code>ä¸­çš„å‘½ä»¤å‘é€ç»™ä»æœåŠ¡å™¨ï¼Œä»æœåŠ¡å™¨ä¼šæ‰§è¡Œè¿™äº›å‘½ä»¤ï¼Œä»¥ä¿è¯æ•°æ®çš„ä¸€è‡´æ€§ã€‚</li></ol><blockquote><p>å¢é‡åŒæ­¥</p></blockquote><p>å¢é‡åŒæ­¥å…è®¸ä»æœåŠ¡å™¨ä»æ–­ç‚¹å¤„ç»§ç»­åŒæ­¥ï¼Œè€Œä¸æ˜¯æ¯æ¬¡éƒ½è¿›è¡Œå®Œå…¨åŒæ­¥ã€‚å®ƒåŸºäº<code>PSYNC</code>å‘½ä»¤ï¼Œä½¿ç”¨äº†<strong>è¿è¡ŒIDï¼ˆrun IDï¼‰å’Œå¤åˆ¶åç§»é‡ï¼ˆoffsetï¼‰çš„æ¦‚å¿µã€‚</strong></p><p><img src="https://cdn.xiaolincoding.com//picgo/1720157758362-f61b89b5-5194-4d63-8cbd-f00ca524a417.png" alt="img"></p><p>ä¸»è¦æœ‰ä¸‰ä¸ªæ­¥éª¤ï¼š</p><ul><li>ä»æœåŠ¡å™¨åœ¨æ¢å¤ç½‘ç»œåï¼Œä¼šå‘é€ psync å‘½ä»¤ç»™ä¸»æœåŠ¡å™¨ï¼Œ<strong>æ­¤æ—¶çš„ psync å‘½ä»¤é‡Œçš„ offset å‚æ•°ä¸æ˜¯ -1ï¼›</strong></li><li>ä¸»æœåŠ¡å™¨æ”¶åˆ°è¯¥å‘½ä»¤åï¼Œç„¶åç”¨ <strong>CONTINUE å“åº”</strong>å‘½ä»¤å‘Šè¯‰ä»æœåŠ¡å™¨æ¥ä¸‹æ¥é‡‡ç”¨å¢é‡å¤åˆ¶çš„æ–¹å¼åŒæ­¥æ•°æ®ï¼›</li><li>ç„¶åä¸»æœåŠ¡å°†ä¸»ä»æœåŠ¡å™¨æ–­çº¿æœŸé—´ï¼Œæ‰€æ‰§è¡Œçš„å†™å‘½ä»¤å‘é€ç»™ä»æœåŠ¡å™¨ï¼Œç„¶åä»æœåŠ¡å™¨æ‰§è¡Œè¿™äº›å‘½ä»¤ã€‚</li></ul><p>é‚£ä¹ˆå…³é”®çš„é—®é¢˜æ¥äº†ï¼Œ<strong>ä¸»æœåŠ¡å™¨æ€ä¹ˆçŸ¥é“è¦å°†å“ªäº›å¢é‡æ•°æ®å‘é€ç»™ä»æœåŠ¡å™¨å‘¢ï¼Ÿ</strong></p><p>ç­”æ¡ˆè—åœ¨è¿™ä¸¤ä¸ªä¸œè¥¿é‡Œï¼š</p><ul><li><strong>repl_backlog_buffer</strong>ï¼Œæ˜¯ä¸€ä¸ªã€Œ<strong>ç¯å½¢</strong>ã€ç¼“å†²åŒºï¼Œç”¨äºä¸»ä»æœåŠ¡å™¨æ–­è¿åï¼Œä»ä¸­æ‰¾åˆ°å·®å¼‚çš„æ•°æ®ï¼›</li><li><strong>replication offset</strong>ï¼Œæ ‡è®°ä¸Šé¢é‚£ä¸ªç¼“å†²åŒºçš„åŒæ­¥è¿›åº¦ï¼Œä¸»ä»æœåŠ¡å™¨éƒ½æœ‰å„è‡ªçš„åç§»é‡ï¼Œä¸»æœåŠ¡å™¨ä½¿ç”¨ <strong>master_repl_offset æ¥è®°å½•è‡ªå·±ã€Œ<em>å†™</em>ã€åˆ°çš„ä½ç½®ï¼Œä»æœåŠ¡å™¨ä½¿ç”¨ slave_repl_offset æ¥è®°å½•è‡ªå·±ã€Œ<em>è¯»</em>ã€åˆ°çš„ä½ç½®ã€‚</strong></li></ul><p>é‚£ repl_backlog_buffer ç¼“å†²åŒºæ˜¯ä»€ä¹ˆæ—¶å€™å†™å…¥çš„å‘¢ï¼Ÿ</p><p>åœ¨ä¸»æœåŠ¡å™¨è¿›è¡Œå‘½ä»¤ä¼ æ’­æ—¶ï¼Œ<strong>ä¸ä»…ä¼šå°†å†™å‘½ä»¤å‘é€ç»™ä»æœåŠ¡å™¨ï¼Œè¿˜ä¼šå°†å†™å‘½ä»¤å†™å…¥åˆ° repl_backlog_buffer ç¼“å†²åŒºé‡Œ</strong>ï¼Œå› æ­¤ è¿™ä¸ªç¼“å†²åŒºé‡Œä¼šä¿å­˜ç€æœ€è¿‘ä¼ æ’­çš„å†™å‘½ä»¤ã€‚</p><p>ç½‘ç»œæ–­å¼€åï¼Œå½“ä»æœåŠ¡å™¨é‡æ–°è¿ä¸Šä¸»æœåŠ¡å™¨æ—¶ï¼Œä»æœåŠ¡å™¨ä¼šé€šè¿‡ <strong>psync å‘½ä»¤å°†è‡ªå·±çš„å¤åˆ¶åç§»é‡ slave_repl_offset å‘é€ç»™ä¸»æœåŠ¡å™¨ï¼Œä¸»æœåŠ¡å™¨æ ¹æ®è‡ªå·±çš„ master_repl_offset å’Œ slave_repl_offset ä¹‹é—´çš„å·®è·ï¼Œç„¶åæ¥å†³å®šå¯¹ä»æœåŠ¡å™¨æ‰§è¡Œå“ªç§åŒæ­¥æ“ä½œï¼š</strong></p><ul><li>å¦‚æœåˆ¤æ–­å‡ºä»æœåŠ¡å™¨è¦è¯»å–çš„æ•°æ®è¿˜åœ¨ repl_backlog_buffer ç¼“å†²åŒºé‡Œï¼Œé‚£ä¹ˆä¸»æœåŠ¡å™¨å°†é‡‡ç”¨<strong>å¢é‡åŒæ­¥</strong>çš„æ–¹å¼ï¼›</li><li>ç›¸åï¼Œå¦‚æœåˆ¤æ–­å‡ºä»æœåŠ¡å™¨è¦è¯»å–çš„æ•°æ®å·²ç»ä¸å­˜åœ¨ repl_backlog_buffer ç¼“å†²åŒºé‡Œï¼Œé‚£ä¹ˆä¸»æœåŠ¡å™¨å°†é‡‡ç”¨<strong>å…¨é‡åŒæ­¥</strong>çš„æ–¹å¼ã€‚</li></ul><p>å½“ä¸»æœåŠ¡å™¨åœ¨ repl_backlog_buffer ä¸­æ‰¾åˆ°ä¸»ä»æœåŠ¡å™¨å·®å¼‚ï¼ˆå¢é‡ï¼‰çš„æ•°æ®åï¼Œå°±ä¼šå°†å¢é‡çš„æ•°æ®å†™å…¥åˆ° replication buffer ç¼“å†²åŒºï¼Œè¿™ä¸ªç¼“å†²åŒºæˆ‘ä»¬å‰é¢ä¹Ÿæåˆ°è¿‡ï¼Œå®ƒæ˜¯ç¼“å­˜å°†è¦ä¼ æ’­ç»™ä»æœåŠ¡å™¨çš„å‘½ä»¤ã€‚</p><p><img src="https://cdn.xiaolincoding.com//picgo/1720157935326-a9eb173d-e938-4144-8b9e-c5120ebc39fe.png" alt="img"></p><p><strong>repl_backlog_buffer ç¼“è¡Œç¼“å†²åŒºçš„é»˜è®¤å¤§å°æ˜¯ 1M</strong>ï¼Œå¹¶ä¸”ç”±äºå®ƒæ˜¯ä¸€ä¸ªç¯å½¢ç¼“å†²åŒºï¼Œæ‰€ä»¥å½“ç¼“å†²åŒºå†™æ»¡åï¼Œä¸»æœåŠ¡å™¨ç»§ç»­å†™å…¥çš„è¯ï¼Œå°±ä¼šè¦†ç›–ä¹‹å‰çš„æ•°æ®ã€‚å› æ­¤ï¼Œå½“ä¸»æœåŠ¡å™¨çš„å†™å…¥é€Ÿåº¦è¿œè¶…äºä»æœåŠ¡å™¨çš„è¯»å–é€Ÿåº¦ï¼Œç¼“å†²åŒºçš„æ•°æ®ä¸€ä¸‹å°±ä¼šè¢«è¦†ç›–ã€‚</p><p>é‚£ä¹ˆåœ¨ç½‘ç»œæ¢å¤æ—¶ï¼Œå¦‚æœä»æœåŠ¡å™¨æƒ³è¯»çš„æ•°æ®å·²ç»è¢«è¦†ç›–äº†ï¼Œä¸»æœåŠ¡å™¨å°±ä¼šé‡‡ç”¨å…¨é‡åŒæ­¥ï¼Œè¿™ä¸ªæ–¹å¼æ¯”å¢é‡åŒæ­¥çš„æ€§èƒ½æŸè€—è¦å¤§å¾ˆå¤šã€‚</p><p>å› æ­¤ï¼Œ<strong>ä¸ºäº†é¿å…åœ¨ç½‘ç»œæ¢å¤æ—¶ï¼Œä¸»æœåŠ¡å™¨é¢‘ç¹åœ°ä½¿ç”¨å…¨é‡åŒæ­¥çš„æ–¹å¼ï¼Œæˆ‘ä»¬åº”è¯¥è°ƒæ•´ä¸‹ repl_backlog_buffer ç¼“å†²åŒºå¤§å°ï¼Œå°½å¯èƒ½çš„å¤§ä¸€äº›</strong>ï¼Œå‡å°‘å‡ºç°ä»æœåŠ¡å™¨è¦è¯»å–çš„æ•°æ®è¢«è¦†ç›–çš„æ¦‚ç‡ï¼Œä»è€Œä½¿å¾—ä¸»æœåŠ¡å™¨é‡‡ç”¨å¢é‡åŒæ­¥çš„æ–¹å¼ã€‚</p><h2 id="4-redisä¸»ä»å’Œé›†ç¾¤å¯ä»¥ä¿è¯æ•°æ®ä¸€è‡´æ€§å—-ï¼Ÿ"><a href="#4-redisä¸»ä»å’Œé›†ç¾¤å¯ä»¥ä¿è¯æ•°æ®ä¸€è‡´æ€§å—-ï¼Ÿ" class="headerlink" title="4.redisä¸»ä»å’Œé›†ç¾¤å¯ä»¥ä¿è¯æ•°æ®ä¸€è‡´æ€§å— ï¼Ÿ"></a>4.redisä¸»ä»å’Œé›†ç¾¤å¯ä»¥ä¿è¯æ•°æ®ä¸€è‡´æ€§å— ï¼Ÿ</h2><p>redis ä¸»ä»å’Œé›†ç¾¤åœ¨CAPç†è®ºéƒ½å±äºAPæ¨¡å‹ï¼Œå³åœ¨é¢ä¸´ç½‘ç»œåˆ†åŒºæ—¶é€‰æ‹©ä¿è¯å¯ç”¨æ€§å’Œåˆ†åŒºå®¹å¿æ€§ï¼Œè€Œç‰ºç‰²äº†å¼ºä¸€è‡´æ€§ã€‚è¿™æ„å‘³ç€åœ¨ç½‘ç»œåˆ†åŒºçš„æƒ…å†µä¸‹ï¼Œ<strong>Redisä¸»ä»å¤åˆ¶å’Œé›†ç¾¤å¯ä»¥ç»§ç»­æä¾›æœåŠ¡å¹¶ä¿æŒå¯ç”¨ï¼Œä½†å¯èƒ½ä¼šå‡ºç°éƒ¨åˆ†èŠ‚ç‚¹ä¹‹é—´çš„æ•°æ®ä¸ä¸€è‡´ã€‚</strong></p><h2 id="5-å“¨å…µæœºåˆ¶åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#5-å“¨å…µæœºåˆ¶åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="5.å“¨å…µæœºåˆ¶åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ"></a>5.å“¨å…µæœºåˆ¶åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ</h2><p>åœ¨ Redis çš„ä¸»ä»æ¶æ„ä¸­ï¼Œç”±äºä¸»ä»æ¨¡å¼æ˜¯è¯»å†™åˆ†ç¦»çš„ï¼Œå¦‚æœä¸»èŠ‚ç‚¹ï¼ˆmasterï¼‰æŒ‚äº†ï¼Œé‚£ä¹ˆå°†æ²¡æœ‰ä¸»èŠ‚ç‚¹æ¥æœåŠ¡å®¢æˆ·ç«¯çš„å†™æ“ä½œè¯·æ±‚ï¼Œä¹Ÿæ²¡æœ‰ä¸»èŠ‚ç‚¹ç»™ä»èŠ‚ç‚¹ï¼ˆslaveï¼‰è¿›è¡Œæ•°æ®åŒæ­¥äº†ã€‚</p><p><img src="https://cdn.xiaolincoding.com//picgo/1720094217984-6192d46c-16ba-47d2-a58d-ee8ddb1d49de.png" alt="img"></p><p>è¿™æ—¶å¦‚æœè¦æ¢å¤æœåŠ¡çš„è¯ï¼Œéœ€è¦äººå·¥ä»‹å…¥ï¼Œé€‰æ‹©ä¸€ä¸ªã€Œä»èŠ‚ç‚¹ã€åˆ‡æ¢ä¸ºã€Œä¸»èŠ‚ç‚¹ã€ï¼Œç„¶åè®©å…¶ä»–ä»èŠ‚ç‚¹æŒ‡å‘æ–°çš„ä¸»èŠ‚ç‚¹ï¼ŒåŒæ—¶è¿˜éœ€è¦é€šçŸ¥ä¸Šæ¸¸é‚£äº›è¿æ¥ Redis ä¸»èŠ‚ç‚¹çš„å®¢æˆ·ç«¯ï¼Œå°†å…¶é…ç½®ä¸­çš„ä¸»èŠ‚ç‚¹ IP åœ°å€æ›´æ–°ä¸ºã€Œæ–°ä¸»èŠ‚ç‚¹ã€çš„ IP åœ°å€ã€‚</p><p>è¿™æ ·ä¹Ÿä¸å¤ªâ€œæ™ºèƒ½â€äº†ï¼Œè¦æ˜¯æœ‰ä¸€ä¸ªèŠ‚ç‚¹èƒ½ç›‘æ§ã€Œä¸»èŠ‚ç‚¹ã€çš„çŠ¶æ€ï¼Œå½“å‘ç°ä¸»èŠ‚ç‚¹æŒ‚äº†ï¼Œå®ƒè‡ªåŠ¨å°†ä¸€ä¸ªã€Œä»èŠ‚ç‚¹ã€åˆ‡æ¢ä¸ºã€Œä¸»èŠ‚ç‚¹ã€çš„è¯ï¼Œé‚£ä¹ˆå¯ä»¥èŠ‚çœæˆ‘ä»¬å¾ˆå¤šäº‹æƒ…å•Šï¼</p><p>Redis åœ¨ 2.8 ç‰ˆæœ¬ä»¥åæä¾›çš„<strong>å“¨å…µï¼ˆ\</strong>*<em>\</em>Sentinel**<em>*<em>ï¼‰æœºåˆ¶<strong>ï¼Œå®ƒçš„ä½œç”¨æ˜¯å®ç°</strong>ä¸»ä»èŠ‚ç‚¹æ•…éšœè½¬ç§»<strong>ã€‚å®ƒä¼š</strong>ç›‘æµ‹ä¸»èŠ‚ç‚¹æ˜¯å¦å­˜æ´»</em></em>ï¼Œå¦‚æœå‘ç°ä¸»èŠ‚ç‚¹æŒ‚äº†ï¼Œå®ƒå°±ä¼šé€‰ä¸¾ä¸€ä¸ªä»èŠ‚ç‚¹åˆ‡æ¢ä¸ºä¸»èŠ‚ç‚¹ï¼Œå¹¶ä¸”æŠŠæ–°ä¸»èŠ‚ç‚¹çš„ç›¸å…³ä¿¡æ¯é€šçŸ¥ç»™ä»èŠ‚ç‚¹å’Œå®¢æˆ·ç«¯ã€‚</p><p>å“¨å…µå…¶å®æ˜¯ä¸€ä¸ªè¿è¡Œåœ¨ç‰¹æ®Šæ¨¡å¼ä¸‹çš„ Redis è¿›ç¨‹ï¼Œ<strong>æ‰€ä»¥å®ƒä¹Ÿæ˜¯ä¸€ä¸ªèŠ‚ç‚¹ã€‚ä»â€œå“¨å…µâ€è¿™ä¸ªåå­—ä¹Ÿå¯ä»¥çœ‹å¾—å‡ºæ¥ï¼Œå®ƒç›¸å½“äºæ˜¯â€œè§‚å¯Ÿè€…èŠ‚ç‚¹â€ï¼Œè§‚å¯Ÿçš„å¯¹è±¡æ˜¯ä¸»ä»èŠ‚ç‚¹ã€‚</strong></p><p>å½“ç„¶ï¼Œå®ƒä¸ä»…ä»…æ˜¯è§‚å¯Ÿé‚£ä¹ˆç®€å•ï¼Œåœ¨å®ƒè§‚å¯Ÿåˆ°æœ‰å¼‚å¸¸çš„çŠ¶å†µä¸‹ï¼Œä¼šåšå‡ºä¸€äº›â€œåŠ¨ä½œâ€ï¼Œæ¥ä¿®å¤å¼‚å¸¸çŠ¶æ€ã€‚</p><p>å“¨å…µèŠ‚ç‚¹ä¸»è¦è´Ÿè´£ä¸‰ä»¶äº‹æƒ…ï¼š<strong>ç›‘æ§ã€é€‰ä¸»ã€é€šçŸ¥</strong>ã€‚</p><p><img src="https://cdn.xiaolincoding.com//picgo/1720094217511-32046190-a2ec-4e4a-8ee4-9c51db2731e0.png" alt="img"></p><h2 id="7-å“¨å…µæœºåˆ¶çš„é€‰ä¸»èŠ‚ç‚¹çš„ç®—æ³•ä»‹ç»ä¸€ä¸‹"><a href="#7-å“¨å…µæœºåˆ¶çš„é€‰ä¸»èŠ‚ç‚¹çš„ç®—æ³•ä»‹ç»ä¸€ä¸‹" class="headerlink" title="7.å“¨å…µæœºåˆ¶çš„é€‰ä¸»èŠ‚ç‚¹çš„ç®—æ³•ä»‹ç»ä¸€ä¸‹"></a>7.å“¨å…µæœºåˆ¶çš„é€‰ä¸»èŠ‚ç‚¹çš„ç®—æ³•ä»‹ç»ä¸€ä¸‹</h2><p>å½“redisé›†ç¾¤çš„ä¸»èŠ‚ç‚¹æ•…éšœæ—¶ï¼ŒSentinelé›†ç¾¤å°†ä»å‰©ä½™çš„ä»èŠ‚ç‚¹ä¸­é€‰ä¸¾ä¸€ä¸ªæ–°çš„ä¸»èŠ‚ç‚¹ï¼Œæœ‰ä»¥ä¸‹æ­¥éª¤ï¼š</p><ol><li>æ•…éšœèŠ‚ç‚¹ä¸»è§‚ä¸‹çº¿</li><li>æ•…éšœèŠ‚ç‚¹å®¢è§‚ä¸‹çº¿</li><li>Sentinelé›†ç¾¤é€‰ä¸¾Leader</li><li>Sentinel Leaderå†³å®šæ–°ä¸»èŠ‚ç‚¹</li></ol><blockquote><ol><li>æ•…éšœèŠ‚ç‚¹ä¸»è§‚ä¸‹çº¿</li></ol></blockquote><p>Sentinelé›†ç¾¤çš„æ¯ä¸€ä¸ªSentinelèŠ‚ç‚¹ä¼šå®šæ—¶å¯¹redisé›†ç¾¤çš„æ‰€æœ‰èŠ‚ç‚¹å‘å¿ƒè·³åŒ…æ£€æµ‹èŠ‚ç‚¹æ˜¯å¦æ­£å¸¸ã€‚<strong>å¦‚æœä¸€ä¸ªèŠ‚ç‚¹åœ¨down-after-millisecondsæ—¶é—´å†…æ²¡æœ‰å›å¤SentinelèŠ‚ç‚¹çš„å¿ƒè·³åŒ…ï¼Œåˆ™è¯¥redisèŠ‚ç‚¹è¢«è¯¥SentinelèŠ‚ç‚¹ä¸»è§‚ä¸‹çº¿ã€‚</strong></p><p><img src="https://cdn.xiaolincoding.com//picgo/1720159516741-7b080ad9-a776-48b5-b8e4-73c5b532aae9.png" alt="img"></p><blockquote><ol><li>æ•…éšœèŠ‚ç‚¹å®¢è§‚ä¸‹çº¿</li></ol></blockquote><p>å½“èŠ‚ç‚¹è¢«ä¸€ä¸ªSentinelèŠ‚ç‚¹è®°ä¸ºä¸»è§‚ä¸‹çº¿æ—¶ï¼Œå¹¶ä¸æ„å‘³ç€è¯¥èŠ‚ç‚¹è‚¯å®šæ•…éšœäº†ï¼Œ<strong>è¿˜éœ€è¦Sentinelé›†ç¾¤çš„å…¶ä»–SentinelèŠ‚ç‚¹å…±åŒåˆ¤æ–­ä¸ºä¸»è§‚ä¸‹çº¿æ‰è¡Œã€‚</strong></p><p>è¯¥SentinelèŠ‚ç‚¹ä¼šè¯¢é—®å…¶ä»–SentinelèŠ‚ç‚¹ï¼Œå¦‚æœSentinelé›†ç¾¤ä¸­<strong>è¶…è¿‡quorum</strong>æ•°é‡çš„SentinelèŠ‚ç‚¹è®¤ä¸ºè¯¥redisèŠ‚ç‚¹ä¸»è§‚ä¸‹çº¿ï¼Œåˆ™è¯¥redis<strong>å®¢è§‚ä¸‹çº¿</strong>ã€‚</p><p><img src="https://cdn.xiaolincoding.com//picgo/1720159526929-d21d0b01-4ed9-4af7-8278-9d7fbdc4db3b.png" alt="img"></p><p>å¦‚æœå®¢è§‚ä¸‹çº¿çš„redisèŠ‚ç‚¹æ˜¯ä»èŠ‚ç‚¹æˆ–è€…æ˜¯SentinelèŠ‚ç‚¹ï¼Œåˆ™æ“ä½œåˆ°æ­¤ä¸ºæ­¢ï¼Œæ²¡æœ‰åç»­çš„æ“ä½œäº†ï¼›å¦‚æœå®¢è§‚ä¸‹çº¿çš„redisèŠ‚ç‚¹ä¸ºä¸»èŠ‚ç‚¹ï¼Œåˆ™å¼€å§‹æ•…éšœè½¬ç§»ï¼Œä»ä»èŠ‚ç‚¹ä¸­é€‰ä¸¾ä¸€ä¸ªèŠ‚ç‚¹å‡çº§ä¸ºä¸»èŠ‚ç‚¹ã€‚</p><blockquote><ol><li>Sentinelé›†ç¾¤é€‰ä¸¾Leader</li></ol></blockquote><p>å¦‚æœéœ€è¦ä»redisé›†ç¾¤é€‰ä¸¾ä¸€ä¸ªèŠ‚ç‚¹ä¸ºä¸»èŠ‚ç‚¹ï¼Œé¦–å…ˆéœ€è¦ä»Sentinelé›†ç¾¤ä¸­é€‰ä¸¾<strong>ä¸€ä¸ªSentinelèŠ‚ç‚¹ä½œä¸ºLeaderã€‚</strong></p><p><img src="https://cdn.xiaolincoding.com//picgo/1720159546681-cd1809f4-6bbf-44e7-8486-480732e2f5d1.png" alt="img"></p><p>æ¯ä¸€ä¸ªSentinelèŠ‚ç‚¹éƒ½å¯ä»¥æˆä¸ºLeaderï¼Œ<strong>å½“ä¸€ä¸ªSentinelèŠ‚ç‚¹ç¡®è®¤redisé›†ç¾¤çš„ä¸»èŠ‚ç‚¹ä¸»è§‚ä¸‹çº¿åï¼Œä¼šè¯·æ±‚å…¶ä»–SentinelèŠ‚ç‚¹è¦æ±‚å°†è‡ªå·±é€‰ä¸¾ä¸ºLeaderã€‚</strong>è¢«è¯·æ±‚çš„SentinelèŠ‚ç‚¹å¦‚æœæ²¡æœ‰åŒæ„è¿‡å…¶ä»–SentinelèŠ‚ç‚¹çš„é€‰ä¸¾è¯·æ±‚ï¼Œåˆ™åŒæ„è¯¥è¯·æ±‚(é€‰ä¸¾ç¥¨æ•°+1)ï¼Œå¦åˆ™ä¸åŒæ„ã€‚</p><p>å¦‚æœä¸€ä¸ªSentinelèŠ‚ç‚¹è·å¾—çš„é€‰ä¸¾ç¥¨æ•°è¾¾åˆ°<strong>Leaderæœ€ä½ç¥¨æ•°(quorumå’ŒSentinelèŠ‚ç‚¹æ•°/2+1çš„æœ€å¤§å€¼)</strong>ï¼Œåˆ™è¯¥SentinelèŠ‚ç‚¹é€‰ä¸¾ä¸ºLeaderï¼›å¦åˆ™é‡æ–°è¿›è¡Œé€‰ä¸¾ã€‚</p><p><img src="https://cdn.xiaolincoding.com//picgo/1720159392994-8e2afcb1-d84c-499d-9737-b4ddeeab50c1.png" alt="img"></p><p>ä¸¾ä¸ªä¾‹å­ï¼Œå‡è®¾å“¨å…µèŠ‚ç‚¹æœ‰ 3 ä¸ªï¼Œquorum è®¾ç½®ä¸º 2ï¼Œé‚£ä¹ˆä»»ä½•ä¸€ä¸ªæƒ³æˆä¸º Leader çš„å“¨å…µåªè¦æ‹¿åˆ° 2 å¼ èµæˆç¥¨ï¼Œå°±å¯ä»¥é€‰ä¸¾æˆåŠŸäº†ã€‚å¦‚æœæ²¡æœ‰æ»¡è¶³æ¡ä»¶ï¼Œå°±éœ€è¦é‡æ–°è¿›è¡Œé€‰ä¸¾ã€‚</p><blockquote><ol><li>Sentinel Leaderå†³å®šæ–°ä¸»èŠ‚ç‚¹</li></ol></blockquote><p>å½“Sentinelé›†ç¾¤é€‰ä¸¾å‡ºSentinel Leaderåï¼Œç”±<strong>Sentinel Leaderä»redisä»èŠ‚ç‚¹ä¸­é€‰æ‹©ä¸€ä¸ªredisèŠ‚ç‚¹ä½œä¸ºä¸»èŠ‚ç‚¹ï¼š</strong></p><ol><li>è¿‡æ»¤æ•…éšœçš„èŠ‚ç‚¹</li><li>é€‰æ‹©<strong>ä¼˜å…ˆçº§slave-priorityæœ€å¤§çš„ä»èŠ‚ç‚¹</strong>ä½œä¸ºä¸»èŠ‚ç‚¹ï¼Œå¦‚ä¸å­˜åœ¨åˆ™ç»§ç»­</li><li>é€‰æ‹©<strong>å¤åˆ¶åç§»é‡</strong>ï¼ˆæ•°æ®å†™å…¥é‡çš„å­—èŠ‚ï¼Œè®°å½•å†™äº†å¤šå°‘æ•°æ®ã€‚ä¸»æœåŠ¡å™¨ä¼šæŠŠåç§»é‡åŒæ­¥ç»™ä»æœåŠ¡å™¨ï¼Œå½“ä¸»ä»çš„åç§»é‡ä¸€è‡´ï¼Œåˆ™æ•°æ®æ˜¯å®Œå…¨åŒæ­¥ï¼‰<strong>æœ€å¤§çš„ä»èŠ‚ç‚¹ä½œä¸ºä¸»èŠ‚ç‚¹</strong>ï¼Œå¦‚ä¸å­˜åœ¨åˆ™ç»§ç»­</li><li>é€‰æ‹©<strong>runidï¼ˆredisæ¯æ¬¡å¯åŠ¨çš„æ—¶å€™ç”Ÿæˆéšæœºçš„runidä½œä¸ºredisçš„æ ‡è¯†ï¼‰æœ€å°çš„ä»èŠ‚ç‚¹ä½œä¸ºä¸»èŠ‚ç‚¹</strong></li></ol><p><img src="https://cdn.xiaolincoding.com//picgo/1720159431029-d93622d5-1c95-4999-b775-6c14b5d41849.png" alt="img"></p><h2 id="8-Redisé›†ç¾¤çš„æ¨¡å¼äº†è§£å—-ä¼˜ç¼ºç‚¹äº†è§£å—"><a href="#8-Redisé›†ç¾¤çš„æ¨¡å¼äº†è§£å—-ä¼˜ç¼ºç‚¹äº†è§£å—" class="headerlink" title="8.Redisé›†ç¾¤çš„æ¨¡å¼äº†è§£å— ä¼˜ç¼ºç‚¹äº†è§£å—"></a>8.Redisé›†ç¾¤çš„æ¨¡å¼äº†è§£å— ä¼˜ç¼ºç‚¹äº†è§£å—</h2><p>å½“ Redis ç¼“å­˜æ•°æ®é‡å¤§åˆ°ä¸€å°æœåŠ¡å™¨æ— æ³•ç¼“å­˜æ—¶ï¼Œå°±éœ€è¦ä½¿ç”¨ <strong>Redis åˆ‡ç‰‡é›†ç¾¤</strong>ï¼ˆRedis Cluster ï¼‰æ–¹æ¡ˆï¼Œå®ƒå°†æ•°æ®åˆ†å¸ƒåœ¨ä¸åŒçš„æœåŠ¡å™¨ä¸Šï¼Œä»¥æ­¤æ¥é™ä½ç³»ç»Ÿå¯¹å•ä¸»èŠ‚ç‚¹çš„ä¾èµ–ï¼Œä»è€Œæé«˜ Redis æœåŠ¡çš„è¯»å†™æ€§èƒ½ã€‚</p><p>Redis Cluster æ–¹æ¡ˆé‡‡ç”¨<strong>å“ˆå¸Œæ§½</strong>ï¼ˆHash Slotï¼‰ï¼Œæ¥å¤„ç†æ•°æ®å’ŒèŠ‚ç‚¹ä¹‹é—´çš„æ˜ å°„å…³ç³»ã€‚åœ¨ Redis Cluster æ–¹æ¡ˆä¸­ï¼Œ<strong>ä¸€ä¸ªåˆ‡ç‰‡é›†ç¾¤å…±æœ‰ 16384 ä¸ªå“ˆå¸Œæ§½</strong>ï¼Œè¿™äº›å“ˆå¸Œæ§½ç±»ä¼¼äºæ•°æ®åˆ†åŒºï¼Œæ¯ä¸ªé”®å€¼å¯¹éƒ½ä¼šæ ¹æ®å®ƒçš„ keyï¼Œè¢«æ˜ å°„åˆ°ä¸€ä¸ªå“ˆå¸Œæ§½ä¸­ï¼Œå…·ä½“æ‰§è¡Œè¿‡ç¨‹åˆ†ä¸ºä¸¤å¤§æ­¥ï¼š</p><ul><li>æ ¹æ®é”®å€¼å¯¹çš„ keyï¼ŒæŒ‰ç…§ <strong>CRC16 ç®—æ³•è®¡ç®—ä¸€ä¸ª 16 bit</strong> çš„å€¼ã€‚</li><li>å†ç”¨ <strong>16bit å€¼å¯¹ 16384 å–æ¨¡</strong>ï¼Œå¾—åˆ° 0~16383 èŒƒå›´å†…çš„æ¨¡æ•°ï¼Œæ¯ä¸ªæ¨¡æ•°ä»£è¡¨ä¸€ä¸ªç›¸åº”ç¼–å·çš„å“ˆå¸Œæ§½ã€‚</li></ul><p>æ¥ä¸‹æ¥çš„é—®é¢˜å°±æ˜¯ï¼Œè¿™äº›å“ˆå¸Œæ§½æ€ä¹ˆè¢«æ˜ å°„åˆ°å…·ä½“çš„ Redis èŠ‚ç‚¹ä¸Šçš„å‘¢ï¼Ÿæœ‰ä¸¤ç§æ–¹æ¡ˆï¼š</p><ul><li><strong>å¹³å‡åˆ†é…ï¼š</strong> åœ¨ä½¿ç”¨ cluster create å‘½ä»¤åˆ›å»º Redis é›†ç¾¤æ—¶ï¼Œ<strong>Redis ä¼šè‡ªåŠ¨æŠŠæ‰€æœ‰å“ˆå¸Œæ§½å¹³å‡åˆ†å¸ƒåˆ°é›†ç¾¤èŠ‚ç‚¹ä¸Šã€‚</strong>æ¯”å¦‚é›†ç¾¤ä¸­æœ‰ 9 ä¸ªèŠ‚ç‚¹ï¼Œåˆ™æ¯ä¸ªèŠ‚ç‚¹ä¸Šæ§½çš„ä¸ªæ•°ä¸º 16384/9 ä¸ªã€‚</li><li><strong>æ‰‹åŠ¨åˆ†é…ï¼š</strong> å¯ä»¥ä½¿ç”¨ cluster meet å‘½ä»¤æ‰‹åŠ¨å»ºç«‹èŠ‚ç‚¹é—´çš„è¿æ¥ï¼Œç»„æˆé›†ç¾¤ï¼Œå†ä½¿ç”¨ cluster addslots å‘½ä»¤ï¼ŒæŒ‡å®šæ¯ä¸ªèŠ‚ç‚¹ä¸Šçš„å“ˆå¸Œæ§½ä¸ªæ•°ã€‚</li></ul><p>ä¸ºäº†æ–¹ä¾¿ä½ çš„ç†è§£ï¼Œæˆ‘é€šè¿‡ä¸€å¼ å›¾æ¥è§£é‡Šæ•°æ®ã€å“ˆå¸Œæ§½ï¼Œä»¥åŠèŠ‚ç‚¹ä¸‰è€…çš„æ˜ å°„åˆ†å¸ƒå…³ç³»ã€‚</p><p><img src="https://cdn.xiaolincoding.com//picgo/1719903649434-ba6ceaf6-adaf-4245-80de-b5e05ea44804.png" alt="img"></p><p>ä¸Šå›¾ä¸­çš„åˆ‡ç‰‡é›†ç¾¤ä¸€å…±æœ‰ 2 ä¸ªèŠ‚ç‚¹ï¼Œå‡è®¾æœ‰ 4 ä¸ªå“ˆå¸Œæ§½ï¼ˆSlot 0ï½Slot 3ï¼‰æ—¶ï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡å‘½ä»¤æ‰‹åŠ¨åˆ†é…å“ˆå¸Œæ§½ï¼Œæ¯”å¦‚<strong>èŠ‚ç‚¹ 1 ä¿å­˜å“ˆå¸Œæ§½ 0 å’Œ 1ï¼Œ</strong>èŠ‚ç‚¹ 2 ä¿å­˜å“ˆå¸Œæ§½ 2 å’Œ 3ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">redis-cli -h <span class="number">192.168</span><span class="number">.1</span><span class="number">.10</span> â€“p <span class="number">6379</span> cluster addslots <span class="number">0</span>,<span class="number">1</span></span><br><span class="line">redis-cli -h <span class="number">192.168</span><span class="number">.1</span><span class="number">.11</span> â€“p <span class="number">6379</span> cluster addslots <span class="number">2</span>,<span class="number">3</span></span><br></pre></td></tr></table></figure><p>ç„¶ååœ¨é›†ç¾¤è¿è¡Œçš„è¿‡ç¨‹ä¸­ï¼Œkey1 å’Œ key2 è®¡ç®—å®Œ CRC16 å€¼åï¼Œå¯¹å“ˆå¸Œæ§½æ€»ä¸ªæ•° 4 è¿›è¡Œå–æ¨¡ï¼Œå†æ ¹æ®å„è‡ªçš„æ¨¡æ•°ç»“æœï¼Œå°±å¯ä»¥è¢«æ˜ å°„åˆ°å“ˆå¸Œæ§½ 1ï¼ˆå¯¹åº”èŠ‚ç‚¹1ï¼‰ å’Œ å“ˆå¸Œæ§½ 2ï¼ˆå¯¹åº”èŠ‚ç‚¹2ï¼‰ã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ<strong>åœ¨æ‰‹åŠ¨åˆ†é…å“ˆå¸Œæ§½æ—¶ï¼Œéœ€è¦æŠŠ 16384 ä¸ªæ§½éƒ½åˆ†é…å®Œï¼Œå¦åˆ™ Redis é›†ç¾¤æ— æ³•æ­£å¸¸å·¥ä½œã€‚</strong></p><blockquote><p>Redisé›†ç¾¤æ¨¡å¼ä¼˜ç‚¹/ç¼ºç‚¹</p></blockquote><p>ä¼˜ç‚¹ï¼š</p><ul><li><strong>é«˜å¯ç”¨æ€§</strong>ï¼šRedisé›†ç¾¤æœ€ä¸»è¦çš„ä¼˜ç‚¹æ˜¯æä¾›äº†é«˜å¯ç”¨æ€§ï¼ŒèŠ‚ç‚¹ä¹‹é—´é‡‡ç”¨ä¸»ä»å¤åˆ¶æœºåˆ¶ï¼Œå¯ä»¥ä¿è¯æ•°æ®çš„æŒä¹…æ€§å’Œå®¹é”™èƒ½åŠ›ï¼Œå“ªæ€•å…¶ä¸­ä¸€ä¸ªèŠ‚ç‚¹æŒ‚æ‰ï¼Œæ•´ä¸ªé›†ç¾¤è¿˜å¯ä»¥ç»§ç»­å·¥ä½œã€‚</li><li><strong>é«˜æ€§èƒ½ï¼š</strong>Redisé›†ç¾¤é‡‡ç”¨<strong>åˆ†ç‰‡æŠ€æœ¯</strong>ï¼Œå°†æ•°æ®åˆ†æ•£åˆ°å¤šä¸ªèŠ‚ç‚¹ï¼Œä»è€Œæé«˜è¯»å†™æ€§èƒ½ã€‚å½“ä¸šåŠ¡è®¿é—®é‡å¤§åˆ°å•æœºRedisæ— æ³•æ»¡è¶³æ—¶ï¼Œå¯ä»¥é€šè¿‡æ·»åŠ èŠ‚ç‚¹æ¥å¢åŠ é›†ç¾¤çš„ååé‡ã€‚</li><li><strong>æ‰©å±•æ€§å¥½ï¼š</strong>Redisé›†ç¾¤çš„æ‰©å±•æ€§éå¸¸å¥½ï¼Œå¯ä»¥<strong>æ ¹æ®å®é™…éœ€æ±‚åŠ¨æ€å¢åŠ æˆ–å‡å°‘èŠ‚ç‚¹ï¼Œä»è€Œå®ç°å¯æ‰©å±•æ€§ã€‚</strong>é›†ç¾¤æ¨¡å¼ä¸­çš„æŸäº›èŠ‚ç‚¹è¿˜å¯ä»¥ä½œä¸ºä»£ç†èŠ‚ç‚¹ï¼Œè‡ªåŠ¨è½¬å‘è¯·æ±‚ï¼Œå¢åŠ æ•°æ®æ¨¡å¼çš„çµæ´»åº¦å’Œå¯å®šåˆ¶æ€§ã€‚</li></ul><p>ç¼ºç‚¹ï¼š</p><ul><li><strong>éƒ¨ç½²å’Œç»´æŠ¤è¾ƒå¤æ‚ï¼š</strong>Redisé›†ç¾¤çš„éƒ¨ç½²å’Œç»´æŠ¤éœ€è¦è€ƒè™‘åˆ°åˆ†ç‰‡è§„åˆ™ã€èŠ‚ç‚¹çš„å¸ƒç½®ã€ä¸»ä»é…ç½®ä»¥åŠæ•…éšœå¤„ç†ç­‰å¤šä¸ªæ–¹é¢ï¼Œéœ€è¦è¾ƒå¼ºçš„æŠ€æœ¯æ”¯æŒï¼Œå¢åŠ äº†èŠ‚ç‚¹å¼‚å¸¸å¤„ç†çš„å¤æ‚æ€§å’Œæˆæœ¬ã€‚</li><li><strong>é›†ç¾¤åŒæ­¥é—®é¢˜ï¼š</strong>å½“æŸäº›èŠ‚ç‚¹å¤±è´¥æˆ–è€…ç½‘ç»œå‡ºæ•…éšœï¼Œé›†ç¾¤ä¸­æ•°æ®åŒæ­¥çš„é—®é¢˜ä¹Ÿä¼šå‡ºç°ã€‚æ•°æ®åŒæ­¥çš„å¤æ‚åº¦å’Œå·¥ä½œé‡éšç€èŠ‚ç‚¹çš„å¢åŠ è€Œå¢åŠ ï¼ŒåŒæ­¥æ—¶é—´ä¹Ÿè¾ƒé•¿ï¼Œå¯¼è‡´ä¸€å®šçš„è¯»å†™å»¶è¿Ÿã€‚</li><li><strong>æ•°æ®åˆ†ç‰‡é™åˆ¶ï¼š</strong>Redisé›†ç¾¤çš„æ•°æ®åˆ†ç‰‡ä¹Ÿé™åˆ¶äº†ä¸€äº›åŠŸèƒ½çš„å®ç°ï¼Œ<strong>å¦‚åœ¨ä¸€ä¸ªkeyä¸Šä¿®æ”¹å¤šæ¬¡ï¼Œå¯èƒ½ä¼šå› ä¸ºè¯¥keyæ‰€åœ¨çš„èŠ‚ç‚¹ä½ç½®å˜åŒ–è€Œå¤±è´¥ã€‚</strong>æ­¤å¤–ï¼Œç”±äºå°†æ•°æ®åˆ†æ•£å­˜å‚¨åˆ°å„ä¸ªèŠ‚ç‚¹ï¼ŒæŸäº›æ“ä½œä¸èƒ½è·¨èŠ‚ç‚¹å®ç°ï¼Œä¸åŒèŠ‚ç‚¹ä¹‹é—´çš„ä¸€äº›æ“ä½œéœ€è¦é¢å¤–æ³¨æ„ã€‚</li></ul><h2 id="9-ä¸ºä»€ä¹ˆç”¨redissonä»£æ›¿setnxï¼Œredissonå¦‚ä½•è§£å†³è¶…æ—¶é‡Šæ”¾é—®é¢˜çš„ï¼Ÿ"><a href="#9-ä¸ºä»€ä¹ˆç”¨redissonä»£æ›¿setnxï¼Œredissonå¦‚ä½•è§£å†³è¶…æ—¶é‡Šæ”¾é—®é¢˜çš„ï¼Ÿ" class="headerlink" title="9.ä¸ºä»€ä¹ˆç”¨redissonä»£æ›¿setnxï¼Œredissonå¦‚ä½•è§£å†³è¶…æ—¶é‡Šæ”¾é—®é¢˜çš„ï¼Ÿ"></a>9.ä¸ºä»€ä¹ˆç”¨redissonä»£æ›¿setnxï¼Œredissonå¦‚ä½•è§£å†³è¶…æ—¶é‡Šæ”¾é—®é¢˜çš„ï¼Ÿ</h2><p>æ™®é€šçš„setnx+expire:</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Boolean</span> <span class="variable">lockSuccess</span> <span class="operator">=</span> redis.setnx(<span class="string">&quot;lock:key&quot;</span>, <span class="string">&quot;UUID&quot;</span>); <span class="comment">// è®¾ç½®é”</span></span><br><span class="line"><span class="keyword">if</span> (lockSuccess) &#123;</span><br><span class="line">    redis.expire(<span class="string">&quot;lock:key&quot;</span>, <span class="number">10</span>); <span class="comment">// è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œé˜²æ­¢æ­»é”</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å¹¶ä¸æ˜¯åŸå­æ€§çš„ï¼Œé‡Šæ”¾é”ä¸å®‰å…¨ï¼Œä¸šåŠ¡å¤„ç†æ—¶é•¿æ¯”é”æ—¶é—´é•¿çš„è¯ï¼Œé”ä¼šè‡ªåŠ¨é‡Šæ”¾</p><p>redissonï¼š</p><p>åŸå­æ“ä½œï¼š</p><p>Redisson ä½¿ç”¨ Lua è„šæœ¬å®ç°åŠ é”é€»è¾‘ï¼Œä½¿å¾— <strong>åŠ é”+è®¾ç½®è¿‡æœŸæ—¶é—´æ˜¯åŸå­æ“ä½œ</strong>ï¼Œå®Œå…¨é¿å…äº† <code>setnx+expire</code> ä¹‹é—´çš„éåŸå­é—®é¢˜ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> redis.call(<span class="string">&#x27;setnx&#x27;</span>, KEYS[<span class="number">1</span>], ARGV[<span class="number">1</span>]) == <span class="number">1</span> then</span><br><span class="line">  redis.call(<span class="string">&#x27;pexpire&#x27;</span>, KEYS[<span class="number">1</span>], ARGV[<span class="number">2</span>])</span><br><span class="line">  <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">end</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>è‡ªåŠ¨ç»­æœŸæœºåˆ¶ï¼ˆWatchDogï¼‰ï¼š</p><p>é»˜è®¤é”çš„è¿‡æœŸæ—¶é—´æ˜¯ 30 ç§’ï¼ŒåŒæ—¶æœ‰ä¸€ä¸ªâ€œçœ‹é—¨ç‹— WatchDog æœºåˆ¶â€ï¼š</p><ul><li>å¦‚æœä¸šåŠ¡æœªå®Œæˆï¼ŒRedisson ä¼šæ¯éš” 10 ç§’è‡ªåŠ¨ç»™é”ç»­æœŸï¼ˆåªé’ˆå¯¹ Redisson é»˜è®¤é”ï¼‰ã€‚</li><li>é˜²æ­¢ä¸šåŠ¡æ‰§è¡Œè¶…æ—¶é”è¢«é‡Šæ”¾çš„æƒ…å†µã€‚</li></ul><blockquote><p>æ³¨æ„ï¼šåªæœ‰åœ¨ä½ æ²¡æœ‰æ‰‹åŠ¨æŒ‡å®šé”çš„ leaseTime æ—¶ï¼Œæ‰ä¼šå¯ç”¨çœ‹é—¨ç‹—</p></blockquote><p>å®‰å…¨é‡Šæ”¾é”ï¼š</p><p>Redisson é‡Šæ”¾é”ä¹Ÿä½¿ç”¨ Lua è„šæœ¬åˆ¤æ–­<strong>æ˜¯å¦æ˜¯è‡ªå·±åŠ çš„é”å†é‡Šæ”¾</strong>ï¼Œé˜²æ­¢è¯¯åˆ åˆ«äººçš„é”ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> redis.call(<span class="string">&#x27;get&#x27;</span>, KEYS[<span class="number">1</span>]) == ARGV[<span class="number">1</span>] then</span><br><span class="line">    <span class="keyword">return</span> redis.call(<span class="string">&#x27;del&#x27;</span>, KEYS[<span class="number">1</span>])</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">end</span><br><span class="line"></span><br></pre></td></tr></table></figure><h1 id="åœºæ™¯"><a href="#åœºæ™¯" class="headerlink" title="åœºæ™¯"></a>åœºæ™¯</h1><h2 id="1-ä½ ç”¨zsetæ¥å®ç°ç‚¹èµæ’è¡Œæ¦œï¼Œç°åœ¨æœ‰ä¸¤ä¸ªç”¨æˆ·éƒ½æ˜¯100ä¸ªèµï¼Œæ€ä¹ˆå®ç°è®©å…ˆåˆ°100ä¸ªèµçš„ç”¨æˆ·æ’åœ¨å‰é¢ï¼Ÿ"><a href="#1-ä½ ç”¨zsetæ¥å®ç°ç‚¹èµæ’è¡Œæ¦œï¼Œç°åœ¨æœ‰ä¸¤ä¸ªç”¨æˆ·éƒ½æ˜¯100ä¸ªèµï¼Œæ€ä¹ˆå®ç°è®©å…ˆåˆ°100ä¸ªèµçš„ç”¨æˆ·æ’åœ¨å‰é¢ï¼Ÿ" class="headerlink" title="1.ä½ ç”¨zsetæ¥å®ç°ç‚¹èµæ’è¡Œæ¦œï¼Œç°åœ¨æœ‰ä¸¤ä¸ªç”¨æˆ·éƒ½æ˜¯100ä¸ªèµï¼Œæ€ä¹ˆå®ç°è®©å…ˆåˆ°100ä¸ªèµçš„ç”¨æˆ·æ’åœ¨å‰é¢ï¼Ÿ"></a>1.ä½ ç”¨zsetæ¥å®ç°ç‚¹èµæ’è¡Œæ¦œï¼Œç°åœ¨æœ‰ä¸¤ä¸ªç”¨æˆ·éƒ½æ˜¯100ä¸ªèµï¼Œæ€ä¹ˆå®ç°è®©å…ˆåˆ°100ä¸ªèµçš„ç”¨æˆ·æ’åœ¨å‰é¢ï¼Ÿ</h2><p>åœ¨ Redis çš„ <code>ZSet</code>ï¼ˆæœ‰åºé›†åˆï¼‰ä¸­ï¼Œ<strong>åˆ†æ•°ï¼ˆscoreï¼‰ç›¸åŒçš„æˆå‘˜æ’åºæ˜¯ä¸ç¨³å®šçš„</strong>ï¼Œå› ä¸º Redis å¹¶ä¸ä¼šä¿è¯ score ç›¸åŒçš„å…ƒç´ æŒ‰æ’å…¥é¡ºåºæ’åºã€‚</p><p>ä½¿ç”¨å¤åˆ scoreï¼Œæˆ–è€…æ‰“åŒ…æŠ€å·§æ¥è§£å†³</p><p>1.å¤åˆåˆ†æ•°ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">å¤åˆ score = ç‚¹èµæ•° * 1_000_000_000 - æ—¶é—´æˆ³</span><br></pre></td></tr></table></figure><p>ç‚¹èµæ•°è¶Šé«˜ï¼Œscore è¶Šå¤§</p><p>æ—¶é—´æˆ³è¶Šæ—©ï¼Œå‡å¾—è¶Šå¤šï¼Œscore è¶Šå¤§ â†’ æ’å‰é¢</p><p>æ—¶é—´æˆ³å¿…é¡»æ˜¯æ¯«ç§’çº§æˆ–ç§’çº§æ—¶é—´æˆ³</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å½“å‰æ—¶é—´ï¼ˆç§’çº§æˆ–æ¯«ç§’çº§ï¼‰</span></span><br><span class="line"><span class="type">long</span> <span class="variable">now</span> <span class="operator">=</span> System.currentTimeMillis(); <span class="comment">// æ¯«ç§’</span></span><br><span class="line"><span class="type">int</span> <span class="variable">likes</span> <span class="operator">=</span> <span class="number">100</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ„é€ å¤åˆåˆ†æ•°</span></span><br><span class="line"><span class="type">double</span> <span class="variable">score</span> <span class="operator">=</span> likes * <span class="number">1_000_000_000L</span> - now;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åŠ å…¥ ZSet æ’è¡Œæ¦œ</span></span><br><span class="line">redisTemplate.opsForZSet().add(<span class="string">&quot;like:rank&quot;</span>, userId, score);</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æ’åºä¾ç„¶æ˜¯ <code>ZREVRANGE</code>ï¼ˆä»å¤§åˆ°å°ï¼‰</p><p>ä»¥ç‚¹èµæ•°ä¸ºä¸»ï¼Œæ—¶é—´æˆ³å€’åºä¸ºè¾…ï¼Œæ„é€ å”¯ä¸€ã€ç¨³å®šæ’åºçš„åˆ†å€¼ã€‚è¿™ç§æ–¹å¼åœ¨æ’è¡Œæ¦œã€ç­¾åˆ°ã€çƒ­åº¦æ¦œç­‰åœºæ™¯éå¸¸å¸¸è§ã€‚</p><h2 id="2-ä¸ºä»€ä¹ˆä½¿ç”¨redisï¼Ÿ"><a href="#2-ä¸ºä»€ä¹ˆä½¿ç”¨redisï¼Ÿ" class="headerlink" title="2.ä¸ºä»€ä¹ˆä½¿ç”¨redisï¼Ÿ"></a>2.ä¸ºä»€ä¹ˆä½¿ç”¨redisï¼Ÿ</h2><p>ä¸»è¦æ˜¯å› ä¸º <strong>Redis å…·å¤‡ã€Œé«˜æ€§èƒ½ã€å’Œã€Œé«˜å¹¶å‘ã€ä¸¤ç§ç‰¹æ€§</strong>ã€‚</p><blockquote><p>1ã€Redis å…·å¤‡é«˜æ€§èƒ½</p></blockquote><p>å‡å¦‚ç”¨æˆ·ç¬¬ä¸€æ¬¡è®¿é—® MySQL ä¸­çš„æŸäº›æ•°æ®ã€‚è¿™ä¸ªè¿‡ç¨‹ä¼šæ¯”è¾ƒæ…¢ï¼Œå› ä¸ºæ˜¯ä»ç¡¬ç›˜ä¸Šè¯»å–çš„ã€‚<strong>å°†è¯¥ç”¨æˆ·è®¿é—®çš„æ•°æ®ç¼“å­˜åœ¨ Redis ä¸­ï¼Œè¿™æ ·ä¸‹ä¸€æ¬¡å†è®¿é—®è¿™äº›æ•°æ®çš„æ—¶å€™å°±å¯ä»¥ç›´æ¥ä»ç¼“å­˜ä¸­è·å–äº†ï¼Œ</strong>æ“ä½œ Redis ç¼“å­˜å°±æ˜¯ç›´æ¥æ“ä½œå†…å­˜ï¼Œæ‰€ä»¥é€Ÿåº¦ç›¸å½“å¿«ã€‚</p><p><img src="https://cdn.xiaolincoding.com//picgo/1719295874540-61b4d9a2-df45-4992-958c-c8d5571de76b-20240725232737123.png" alt="img"></p><p>å¦‚æœ MySQL ä¸­çš„å¯¹åº”æ•°æ®æ”¹å˜çš„ä¹‹åï¼ŒåŒæ­¥æ”¹å˜ Redis ç¼“å­˜ä¸­ç›¸åº”çš„æ•°æ®å³å¯ï¼Œä¸è¿‡è¿™é‡Œä¼šæœ‰ Redis å’Œ MySQL åŒå†™ä¸€è‡´æ€§çš„é—®é¢˜ã€‚</p><blockquote><p>2ã€ Redis å…·å¤‡é«˜å¹¶å‘</p></blockquote><p>å•å°è®¾å¤‡çš„ Redis çš„ QPSï¼ˆQuery Per Secondï¼Œæ¯ç§’é’Ÿå¤„ç†å®Œè¯·æ±‚çš„æ¬¡æ•°ï¼‰ æ˜¯ MySQL çš„ 10 å€ï¼ŒRedis å•æœºçš„ QPS èƒ½è½»æ¾ç ´ 10wï¼Œè€Œ MySQL å•æœºçš„ QPS å¾ˆéš¾ç ´ 1wã€‚</p><p>æ‰€ä»¥ï¼Œç›´æ¥è®¿é—® Redis èƒ½å¤Ÿæ‰¿å—çš„è¯·æ±‚æ˜¯è¿œè¿œå¤§äºç›´æ¥è®¿é—® MySQL çš„ï¼Œ<strong>æ‰€ä»¥æˆ‘ä»¬å¯ä»¥è€ƒè™‘æŠŠæ•°æ®åº“ä¸­çš„éƒ¨åˆ†æ•°æ®è½¬ç§»åˆ°ç¼“å­˜ä¸­å»ï¼Œè¿™æ ·ç”¨æˆ·çš„ä¸€éƒ¨åˆ†è¯·æ±‚ä¼šç›´æ¥åˆ°ç¼“å­˜è¿™é‡Œè€Œä¸ç”¨ç»è¿‡æ•°æ®åº“ã€‚</strong></p><h2 id="3-ä¸ºä»€ä¹ˆredisæ¯”mysqlè¦å¿«ï¼Ÿ"><a href="#3-ä¸ºä»€ä¹ˆredisæ¯”mysqlè¦å¿«ï¼Ÿ" class="headerlink" title="3.ä¸ºä»€ä¹ˆredisæ¯”mysqlè¦å¿«ï¼Ÿ"></a>3.ä¸ºä»€ä¹ˆredisæ¯”mysqlè¦å¿«ï¼Ÿ</h2><ul><li><strong>å†…å­˜å­˜å‚¨</strong>ï¼šRedis æ˜¯åŸºäºå†…å­˜å­˜å‚¨çš„ NoSQL æ•°æ®åº“ï¼Œè€Œ MySQL æ˜¯åŸºäºç£ç›˜å­˜å‚¨çš„å…³ç³»å‹æ•°æ®åº“ã€‚ç”±äºå†…å­˜å­˜å‚¨é€Ÿåº¦å¿«ï¼ŒRedis èƒ½å¤Ÿæ›´å¿«åœ°è¯»å–å’Œå†™å…¥æ•°æ®ï¼Œè€Œæ— éœ€åƒ MySQL é‚£æ ·é¢‘ç¹è¿›è¡Œç£ç›˜ I/O æ“ä½œã€‚</li><li><strong>ç®€å•æ•°æ®ç»“æ„</strong>ï¼šRedis æ˜¯åŸºäº<strong>é”®å€¼å¯¹</strong>å­˜å‚¨æ•°æ®çš„ï¼Œæ”¯æŒç®€å•çš„æ•°æ®ç»“æ„ï¼ˆå­—ç¬¦ä¸²ã€å“ˆå¸Œã€åˆ—è¡¨ã€é›†åˆã€æœ‰åºé›†åˆï¼‰ã€‚ç›¸æ¯”ä¹‹ä¸‹ï¼ŒMySQL éœ€è¦å®šä¹‰è¡¨ç»“æ„ã€ç´¢å¼•ç­‰å¤æ‚çš„å…³ç³»å‹æ•°æ®ç»“æ„ï¼Œå› æ­¤åœ¨æŸäº›åœºæ™¯ä¸‹ Redis çš„æ•°æ®æ“ä½œæ›´ä¸ºç®€å•é«˜æ•ˆï¼Œæ¯”å¦‚ Redis ç”¨å“ˆå¸Œè¡¨æŸ¥è¯¢ï¼Œ åªéœ€è¦O1 æ—¶é—´å¤æ‚åº¦ï¼Œè€ŒMySQLå¼•æ“çš„åº•å±‚å®ç°æ˜¯B+Treeï¼Œæ—¶é—´å¤æ‚åº¦æ˜¯O(logn)</li><li><strong>çº¿ç¨‹æ¨¡å‹</strong>ï¼šRedis é‡‡ç”¨å•çº¿ç¨‹æ¨¡å‹å¯ä»¥é¿å…äº†å¤šçº¿ç¨‹ä¹‹é—´çš„ç«äº‰ï¼Œçœå»äº†å¤šçº¿ç¨‹åˆ‡æ¢å¸¦æ¥çš„æ—¶é—´å’Œæ€§èƒ½ä¸Šçš„å¼€é”€ï¼Œè€Œä¸”ä¹Ÿä¸ä¼šå¯¼è‡´æ­»é”é—®é¢˜ã€‚</li></ul><h2 id="4-æœ¬åœ°ç¼“å­˜å’ŒRedisç¼“å­˜çš„åŒºåˆ«"><a href="#4-æœ¬åœ°ç¼“å­˜å’ŒRedisç¼“å­˜çš„åŒºåˆ«" class="headerlink" title="4.æœ¬åœ°ç¼“å­˜å’ŒRedisç¼“å­˜çš„åŒºåˆ«?"></a>4.æœ¬åœ°ç¼“å­˜å’ŒRedisç¼“å­˜çš„åŒºåˆ«?</h2><p><strong>æœ¬åœ°ç¼“å­˜</strong>æ˜¯æŒ‡å°†æ•°æ®å­˜å‚¨åœ¨æœ¬åœ°åº”ç”¨ç¨‹åºæˆ–æœåŠ¡å™¨ä¸Šï¼Œé€šå¸¸ç”¨äºåŠ é€Ÿæ•°æ®è®¿é—®å’Œæé«˜å“åº”é€Ÿåº¦ã€‚<strong>æœ¬åœ°ç¼“å­˜</strong>é€šå¸¸ä½¿ç”¨å†…å­˜ä½œä¸ºå­˜å‚¨ä»‹è´¨ï¼Œåˆ©ç”¨<strong>å†…å­˜çš„é«˜é€Ÿè¯»å†™ç‰¹æ€§</strong>æ¥æé«˜æ•°æ®è®¿é—®é€Ÿåº¦ã€‚</p><p>æœ¬åœ°ç¼“å­˜çš„ä¼˜åŠ¿ï¼š</p><ul><li>è®¿é—®é€Ÿåº¦å¿«ï¼šç”±äºæœ¬åœ°ç¼“å­˜å­˜å‚¨åœ¨æœ¬åœ°å†…å­˜ä¸­ï¼Œå› æ­¤è®¿é—®é€Ÿåº¦éå¸¸å¿«ï¼Œèƒ½å¤Ÿæ»¡è¶³é¢‘ç¹è®¿é—®å’Œå³æ—¶å“åº”çš„éœ€æ±‚ã€‚</li><li>å‡è½»ç½‘ç»œå‹åŠ›ï¼šæœ¬åœ°ç¼“å­˜èƒ½å¤Ÿé™ä½å¯¹è¿œç¨‹æœåŠ¡å™¨çš„è®¿é—®æ¬¡æ•°ï¼Œä»è€Œå‡è½»ç½‘ç»œå‹åŠ›ï¼Œæé«˜ç³»ç»Ÿçš„å¯ç”¨æ€§å’Œç¨³å®šæ€§ã€‚</li><li>ä½å»¶è¿Ÿï¼šç”±äºæœ¬åœ°ç¼“å­˜ä½äºæœ¬åœ°è®¾å¤‡ä¸Šï¼Œå› æ­¤èƒ½å¤Ÿæä¾›ä½å»¶è¿Ÿçš„è®¿é—®é€Ÿåº¦ï¼Œé€‚ç”¨äºå¯¹å®æ—¶æ€§è¦æ±‚è¾ƒé«˜çš„åº”ç”¨åœºæ™¯ã€‚</li></ul><p>æœ¬åœ°ç¼“å­˜çš„ä¸è¶³ï¼š</p><ul><li>å¯æ‰©å±•æ€§æœ‰é™ï¼šæœ¬åœ°ç¼“å­˜çš„å¯æ‰©å±•æ€§å—åˆ°ç¡¬ä»¶èµ„æºçš„é™åˆ¶ï¼Œæ— æ³•æ”¯æŒå¤§è§„æ¨¡çš„æ•°æ®å­˜å‚¨å’Œè®¿é—®ã€‚</li></ul><p><strong>åˆ†å¸ƒå¼ç¼“å­˜ï¼ˆ</strong>Redis<strong>ï¼‰</strong>æ˜¯æŒ‡å°†æ•°æ®<strong>å­˜å‚¨åœ¨å¤šä¸ªåˆ†å¸ƒå¼èŠ‚ç‚¹ä¸Šï¼Œé€šè¿‡ååŒå·¥ä½œæ¥æä¾›é«˜æ€§èƒ½çš„æ•°æ®è®¿é—®æœåŠ¡ã€‚åˆ†å¸ƒå¼ç¼“å­˜é€šå¸¸ä½¿ç”¨é›†ç¾¤æ–¹å¼è¿›è¡Œéƒ¨ç½²</strong>ï¼Œåˆ©ç”¨å¤šå°æœåŠ¡å™¨æ¥åˆ†æ‹…æ•°æ®å­˜å‚¨å’Œè®¿é—®çš„å‹åŠ›ã€‚</p><p>åˆ†å¸ƒå¼ç¼“å­˜çš„ä¼˜åŠ¿ï¼š</p><ul><li>å¯æ‰©å±•æ€§å¼ºï¼šåˆ†å¸ƒå¼ç¼“å­˜çš„èŠ‚ç‚¹å¯ä»¥åŠ¨æ€æ‰©å±•ï¼Œèƒ½å¤Ÿæ”¯æŒå¤§è§„æ¨¡çš„æ•°æ®å­˜å‚¨å’Œè®¿é—®éœ€æ±‚ã€‚</li><li>æ•°æ®ä¸€è‡´æ€§é«˜ï¼šé€šè¿‡åˆ†å¸ƒå¼ä¸€è‡´æ€§åè®®ï¼Œåˆ†å¸ƒå¼ç¼“å­˜èƒ½å¤Ÿä¿è¯æ•°æ®åœ¨å¤šä¸ªèŠ‚ç‚¹ä¹‹é—´çš„ä¸€è‡´æ€§ï¼Œå‡å°‘æ•°æ®ä¸ä¸€è‡´çš„é—®é¢˜ã€‚</li><li>æ˜“äºç»´æŠ¤ï¼šåˆ†å¸ƒå¼ç¼“å­˜é€šå¸¸é‡‡ç”¨è‡ªåŠ¨åŒ–ç®¡ç†æ–¹å¼ï¼Œèƒ½å¤Ÿé™ä½ç»´æŠ¤æˆæœ¬å’Œç®¡ç†çš„å¤æ‚æ€§ã€‚</li></ul><p>åˆ†å¸ƒå¼ç¼“å­˜çš„ä¸è¶³ï¼š</p><ul><li>è®¿é—®é€Ÿåº¦ç›¸å¯¹è¾ƒæ…¢ï¼šç›¸å¯¹äºæœ¬åœ°ç¼“å­˜ï¼Œåˆ†å¸ƒå¼ç¼“å­˜çš„è®¿é—®é€Ÿåº¦ç›¸å¯¹è¾ƒæ…¢ï¼Œå› ä¸ºæ•°æ®éœ€è¦ä»å¤šä¸ªèŠ‚ç‚¹è¿›è¡Œè®¿é—®å’ŒååŒã€‚</li><li>ç½‘ç»œå¼€é”€å¤§ï¼šç”±äºåˆ†å¸ƒå¼ç¼“å­˜éœ€è¦é€šè¿‡ç½‘ç»œè¿›è¡Œæ•°æ®ä¼ è¾“å’ŒååŒæ“ä½œï¼Œå› æ­¤ç›¸å¯¹äºæœ¬åœ°ç¼“å­˜æ¥è¯´ï¼Œç½‘ç»œå¼€é”€è¾ƒå¤§ã€‚</li></ul><p>åœ¨é€‰æ‹©ä½¿ç”¨æœ¬åœ°ç¼“å­˜è¿˜æ˜¯åˆ†å¸ƒå¼ç¼“å­˜æ—¶ï¼Œæˆ‘ä»¬éœ€è¦æ ¹æ®å…·ä½“çš„åº”ç”¨åœºæ™¯å’Œéœ€æ±‚è¿›è¡Œæƒè¡¡ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›è€ƒè™‘å› ç´ ï¼š</p><ul><li>æ•°æ®å¤§å°ï¼šå¦‚æœæ•°æ®é‡è¾ƒå°ï¼Œä¸”å¯¹å®æ—¶æ€§è¦æ±‚è¾ƒé«˜ï¼Œæœ¬åœ°ç¼“å­˜æ›´é€‚åˆï¼›å¦‚æœæ•°æ®é‡è¾ƒå¤§ï¼Œä¸”éœ€è¦æ”¯æŒå¤§è§„æ¨¡çš„å¹¶å‘è®¿é—®ï¼Œåˆ†å¸ƒå¼ç¼“å­˜æ›´å…·ä¼˜åŠ¿ã€‚</li><li>ç½‘ç»œçŠ¶å†µï¼šå¦‚æœç½‘ç»œçŠ¶å†µè‰¯å¥½ä¸”ç¨³å®šï¼Œåˆ†å¸ƒå¼ç¼“å­˜èƒ½å¤Ÿæ›´å¥½åœ°å‘æŒ¥å…¶ä¼˜åŠ¿ï¼›å¦‚æœç½‘ç»œçŠ¶å†µè¾ƒå·®æˆ–ä¸ç¨³å®šï¼Œæœ¬åœ°ç¼“å­˜çš„è®¿é—®é€Ÿåº¦å’Œç¨³å®šæ€§å¯èƒ½æ›´æœ‰ä¼˜åŠ¿ã€‚</li><li>ä¸šåŠ¡ç‰¹ç‚¹ï¼šå¯¹äºå®æ—¶æ€§è¦æ±‚è¾ƒ</li></ul><h2 id="5-é«˜å¹¶å‘åœºæ™¯ï¼ŒRediså•èŠ‚ç‚¹-MySQLå•èŠ‚ç‚¹èƒ½æœ‰å¤šå¤§çš„å¹¶å‘é‡ï¼Ÿ"><a href="#5-é«˜å¹¶å‘åœºæ™¯ï¼ŒRediså•èŠ‚ç‚¹-MySQLå•èŠ‚ç‚¹èƒ½æœ‰å¤šå¤§çš„å¹¶å‘é‡ï¼Ÿ" class="headerlink" title="5.é«˜å¹¶å‘åœºæ™¯ï¼ŒRediså•èŠ‚ç‚¹+MySQLå•èŠ‚ç‚¹èƒ½æœ‰å¤šå¤§çš„å¹¶å‘é‡ï¼Ÿ"></a>5.é«˜å¹¶å‘åœºæ™¯ï¼ŒRediså•èŠ‚ç‚¹+MySQLå•èŠ‚ç‚¹èƒ½æœ‰å¤šå¤§çš„å¹¶å‘é‡ï¼Ÿ</h2><ul><li>å¦‚æœç¼“å­˜å‘½ä¸­çš„è¯ï¼Œ4 æ ¸å¿ƒ 8g å†…å­˜çš„é…ç½®ï¼Œredis å¯ä»¥æ”¯æ’‘ 10w çš„ qps</li><li>å¦‚æœç¼“å­˜æ²¡æœ‰å‘½ä¸­çš„è¯ï¼Œ4 æ ¸å¿ƒ 8g å†…å­˜çš„é…ç½®ï¼Œmysql åªèƒ½æ”¯æŒ 5000 å·¦å³çš„ qps</li></ul><p>æ‰€ä»¥è¦é˜²æ­¢ç¼“å­˜ç©¿é€ï¼Œä½¿ç”¨æ¥å£æ¥é˜²æŠ¤ï¼Œæˆ–è€…ä½¿ç”¨å¸ƒéš†è¿‡æ»¤å™¨</p><h2 id="6-redisåº”ç”¨åœºæ™¯æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#6-redisåº”ç”¨åœºæ™¯æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="6.redisåº”ç”¨åœºæ™¯æ˜¯ä»€ä¹ˆï¼Ÿ"></a>6.redisåº”ç”¨åœºæ™¯æ˜¯ä»€ä¹ˆï¼Ÿ</h2><p>Redis æ˜¯ä¸€ç§åŸºäºå†…å­˜çš„æ•°æ®åº“ï¼Œå¯¹æ•°æ®çš„è¯»å†™æ“ä½œéƒ½æ˜¯åœ¨å†…å­˜ä¸­å®Œæˆï¼Œå› æ­¤<strong>è¯»å†™é€Ÿåº¦éå¸¸å¿«</strong>ï¼Œå¸¸ç”¨äº<strong>ç¼“å­˜ï¼Œæ¶ˆæ¯é˜Ÿåˆ—ã€åˆ†å¸ƒå¼é”ç­‰åœºæ™¯</strong>ã€‚</p><ul><li><strong>ç¼“å­˜</strong>: Redisæœ€å¸¸è§çš„ç”¨é€”å°±æ˜¯ä½œä¸ºç¼“å­˜ç³»ç»Ÿã€‚é€šè¿‡å°†çƒ­é—¨æ•°æ®å­˜å‚¨åœ¨å†…å­˜ä¸­ï¼Œå¯ä»¥æå¤§åœ°æé«˜è®¿é—®é€Ÿåº¦ï¼Œå‡è½»æ•°æ®åº“è´Ÿè½½ï¼Œè¿™å¯¹äºéœ€è¦å¿«é€Ÿå“åº”æ—¶é—´çš„åº”ç”¨ç¨‹åºéå¸¸é‡è¦ã€‚</li><li><strong>æ’è¡Œæ¦œ</strong>: Redisçš„æœ‰åºé›†åˆç»“æ„éå¸¸é€‚åˆç”¨äºå®ç°æ’è¡Œæ¦œå’Œæ’åç³»ç»Ÿï¼Œå¯ä»¥æ–¹ä¾¿åœ°è¿›è¡Œæ•°æ®æ’åºå’Œæ’åã€‚</li><li><strong>åˆ†å¸ƒå¼é”</strong>: Redisçš„ç‰¹æ€§å¯ä»¥ç”¨æ¥å®ç°åˆ†å¸ƒå¼é”ï¼Œç¡®ä¿å¤šä¸ªè¿›ç¨‹æˆ–æœåŠ¡ä¹‹é—´çš„æ•°æ®æ“ä½œçš„åŸå­æ€§å’Œä¸€è‡´æ€§ã€‚</li><li><strong>è®¡æ•°å™¨</strong> ç”±äºRedisçš„åŸå­æ“ä½œå’Œé«˜æ€§èƒ½ï¼Œå®ƒéå¸¸é€‚åˆç”¨äºå®ç°è®¡æ•°å™¨å’Œç»Ÿè®¡æ•°æ®çš„å­˜å‚¨ï¼Œå¦‚ç½‘ç«™è®¿é—®é‡ç»Ÿè®¡ã€ç‚¹èµæ•°ç»Ÿè®¡ç­‰ã€‚</li><li><strong>æ¶ˆæ¯é˜Ÿåˆ—</strong>: Redisçš„å‘å¸ƒè®¢é˜…åŠŸèƒ½ä½¿å…¶æˆä¸ºä¸€ä¸ªè½»é‡çº§çš„æ¶ˆæ¯é˜Ÿåˆ—ï¼Œå®ƒå¯ä»¥ç”¨æ¥å®ç°å‘å¸ƒå’Œè®¢é˜…æ¨¡å¼ï¼Œä»¥ä¾¿å®æ—¶å¤„ç†æ¶ˆæ¯ã€‚</li></ul><h2 id="7-Redisé™¤äº†ç¼“å­˜ï¼Œè¿˜æœ‰å“ªäº›åº”ç”¨"><a href="#7-Redisé™¤äº†ç¼“å­˜ï¼Œè¿˜æœ‰å“ªäº›åº”ç”¨" class="headerlink" title="7.Redisé™¤äº†ç¼“å­˜ï¼Œè¿˜æœ‰å“ªäº›åº”ç”¨?"></a>7.Redisé™¤äº†ç¼“å­˜ï¼Œè¿˜æœ‰å“ªäº›åº”ç”¨?</h2><p><strong>Rediså®ç°æ¶ˆæ¯é˜Ÿåˆ—</strong></p><ul><li><strong>ä½¿ç”¨Pub/Subæ¨¡å¼ï¼š</strong>Redisçš„Pub/Subæ˜¯ä¸€ç§åŸºäºå‘å¸ƒ/è®¢é˜…çš„æ¶ˆæ¯æ¨¡å¼ï¼Œä»»ä½•å®¢æˆ·ç«¯éƒ½å¯ä»¥è®¢é˜…ä¸€ä¸ªæˆ–å¤šä¸ªé¢‘é“ï¼Œå‘å¸ƒè€…å¯ä»¥å‘ç‰¹å®šé¢‘é“å‘é€æ¶ˆæ¯ï¼Œæ‰€æœ‰è®¢é˜…è¯¥é¢‘é“çš„å®¢æˆ·ç«¯éƒ½ä¼šæ”¶åˆ°æ­¤æ¶ˆæ¯ã€‚è¯¥æ–¹å¼å®ç°èµ·æ¥æ¯”è¾ƒç®€å•ï¼Œå‘å¸ƒè€…å’Œè®¢é˜…è€…å®Œå…¨è§£è€¦ï¼Œæ”¯æŒæ¨¡å¼åŒ¹é…è®¢é˜…ã€‚ä½†æ˜¯è¿™ç§æ–¹å¼ä¸æ”¯æŒæ¶ˆæ¯æŒä¹…åŒ–ï¼Œæ¶ˆæ¯å‘å¸ƒåè‹¥æ— è®¢é˜…è€…åœ¨çº¿åˆ™ä¼šè¢«ä¸¢å¼ƒï¼›ä¸ä¿è¯æ¶ˆæ¯çš„é¡ºåºå’Œå¯é æ€§ä¼ è¾“ã€‚</li><li><strong>ä½¿ç”¨Listç»“æ„</strong>ï¼šä½¿ç”¨Listçš„æ–¹å¼é€šå¸¸æ˜¯ä½¿ç”¨<code>LPUSH</code>å‘½ä»¤å°†æ¶ˆæ¯æ¨å…¥ä¸€ä¸ªåˆ—è¡¨ï¼Œæ¶ˆè´¹è€…ä½¿ç”¨<code>BLPOP</code>æˆ–<code>BRPOP</code>é˜»å¡åœ°ä»åˆ—è¡¨ä¸­å–å‡ºæ¶ˆæ¯ï¼ˆå…ˆè¿›å…ˆå‡ºFIFOï¼‰ã€‚è¿™ç§æ–¹å¼å¯ä»¥å®ç°ç®€å•çš„ä»»åŠ¡é˜Ÿåˆ—ã€‚è¿™ç§æ–¹å¼å¯ä»¥ç»“åˆRedisçš„è¿‡æœŸæ—¶é—´ç‰¹æ€§å®ç°æ¶ˆæ¯çš„TTLï¼›é€šè¿‡Redisäº‹åŠ¡å¯ä»¥ä¿è¯æ“ä½œçš„åŸå­æ€§ã€‚ä½†æ˜¯éœ€è¦å®¢æˆ·ç«¯è‡ªå·±å®ç°æ¶ˆæ¯ç¡®è®¤ã€é‡è¯•ç­‰æœºåˆ¶ï¼Œç›¸æ¯”ä¸“é—¨çš„æ¶ˆæ¯é˜Ÿåˆ—ç³»ç»ŸåŠŸèƒ½è¾ƒå¼±ã€‚</li></ul><p><strong>Rediså®ç°åˆ†å¸ƒå¼é”</strong></p><ul><li><strong>set nxæ–¹å¼</strong>ï¼šRedisæä¾›äº†å‡ ç§æ–¹å¼æ¥å®ç°åˆ†å¸ƒå¼é”ï¼Œæœ€å¸¸ç”¨çš„æ˜¯<strong>åŸºäº<code>SET</code>å‘½ä»¤çš„äº‰æŠ¢é”æœº</strong>åˆ¶ã€‚å®¢æˆ·ç«¯å¯ä»¥ä½¿ç”¨<code>SET resource_name lock_value NX PX milliseconds</code>å‘½ä»¤è®¾ç½®é”ï¼Œå…¶ä¸­<strong><code>NX</code>è¡¨ç¤ºåªæœ‰å½“é”®ä¸å­˜åœ¨æ—¶æ‰è®¾ç½®ï¼Œ<code>PX</code>æŒ‡å®šé”çš„æœ‰æ•ˆæ—¶é—´ï¼ˆæ¯«ç§’ï¼‰</strong>ã€‚å¦‚æœè®¾ç½®æˆåŠŸï¼Œåˆ™è®¤ä¸ºå®¢æˆ·ç«¯è·å¾—é”ã€‚å®¢æˆ·ç«¯å®Œæˆæ“ä½œåï¼Œ<strong>è§£é”çš„è¿˜éœ€è¦å…ˆåˆ¤æ–­é”æ˜¯ä¸æ˜¯è‡ªå·±ï¼Œå†è¿›è¡Œåˆ é™¤ï¼Œè¿™é‡Œæ¶‰åŠåˆ° 2 ä¸ªæ“ä½œï¼Œä¸ºäº†ä¿è¯è¿™ä¸¤ä¸ªæ“ä½œçš„åŸå­æ€§ï¼Œå¯ä»¥ç”¨ lua è„šæœ¬æ¥å®ç°ã€‚</strong></li></ul><ul><li><strong>RedLockç®—æ³•ï¼š</strong>ä¸ºäº†æé«˜åˆ†å¸ƒå¼é”çš„å¯é æ€§ï¼ŒRedisä½œè€…Antirezæå‡ºäº†RedLockç®—æ³•ï¼Œå®ƒåŸºäº<strong>å¤šä¸ªç‹¬ç«‹çš„Rediså®ä¾‹æ¥å®ç°ä¸€ä¸ªæ›´å®‰å…¨çš„åˆ†å¸ƒå¼é”</strong>ã€‚å®ƒçš„åŸºæœ¬åŸç†æ˜¯å®¢æˆ·ç«¯å°è¯•åœ¨å¤šæ•°ï¼ˆå¤§äºåŠæ•°ï¼‰Rediså®ä¾‹ä¸ŠåŒæ—¶åŠ é”ï¼Œ<strong>åªæœ‰å½“åœ¨å¤§å¤šæ•°å®ä¾‹ä¸ŠåŠ é”æˆåŠŸæ—¶æ‰è®¤ä¸ºè·å–é”æˆåŠŸã€‚é”çš„è¶…æ—¶æ—¶é—´åº”è¯¥è¿œå°äºå•ä¸ªå®ä¾‹çš„è¶…æ—¶æ—¶é—´ï¼Œä»¥é¿å…æ­»é”ã€‚è¯¥æ–¹å¼å¯ä»¥é€šè¿‡è·¨å¤šä¸ªèŠ‚ç‚¹å‡å°‘å•ç‚¹æ•…éšœçš„å½±å“ï¼Œæé«˜äº†é”çš„å¯ç”¨æ€§å’Œå®‰å…¨æ€§ã€‚</strong></li></ul><h2 id="8-Redisæ”¯æŒå¹¶å‘æ“ä½œå—ï¼Ÿ"><a href="#8-Redisæ”¯æŒå¹¶å‘æ“ä½œå—ï¼Ÿ" class="headerlink" title="8.Redisæ”¯æŒå¹¶å‘æ“ä½œå—ï¼Ÿ"></a>8.Redisæ”¯æŒå¹¶å‘æ“ä½œå—ï¼Ÿ</h2><ul><li><strong>å•ä¸ª Redis å‘½ä»¤çš„åŸå­æ€§</strong>ï¼šRedis çš„å•ä¸ªå‘½ä»¤æ˜¯åŸå­æ€§çš„ï¼Œè¿™æ„å‘³ç€ä¸€ä¸ªå‘½ä»¤è¦ä¹ˆå®Œå…¨æ‰§è¡ŒæˆåŠŸï¼Œè¦ä¹ˆå®Œå…¨ä¸æ‰§è¡Œï¼Œç¡®ä¿æ“ä½œçš„ä¸€è‡´æ€§ã€‚è¿™å¯¹äºå¹¶å‘æ“ä½œéå¸¸é‡è¦ã€‚</li><li><strong>å¤šä¸ªæ“ä½œçš„äº‹åŠ¡</strong>ï¼šRedis æ”¯æŒäº‹åŠ¡ï¼Œå¯ä»¥å°†ä¸€ç³»åˆ—çš„æ“ä½œæ”¾åœ¨ä¸€ä¸ªäº‹åŠ¡ä¸­æ‰§è¡Œï¼Œä½¿ç”¨ MULTIã€EXECã€DISCARD å’Œ WATCH ç­‰å‘½ä»¤æ¥ç®¡ç†äº‹åŠ¡ã€‚è¿™æ ·å¯ä»¥ç¡®ä¿ä¸€ç³»åˆ—æ“ä½œçš„åŸå­æ€§ã€‚</li></ul><h2 id="9-Redisåˆ†å¸ƒå¼é”çš„å®ç°åŸç†ï¼Ÿä»€ä¹ˆåœºæ™¯ä¸‹ç”¨åˆ°åˆ†å¸ƒå¼é”ï¼Ÿ"><a href="#9-Redisåˆ†å¸ƒå¼é”çš„å®ç°åŸç†ï¼Ÿä»€ä¹ˆåœºæ™¯ä¸‹ç”¨åˆ°åˆ†å¸ƒå¼é”ï¼Ÿ" class="headerlink" title="9.Redisåˆ†å¸ƒå¼é”çš„å®ç°åŸç†ï¼Ÿä»€ä¹ˆåœºæ™¯ä¸‹ç”¨åˆ°åˆ†å¸ƒå¼é”ï¼Ÿ"></a>9.Redisåˆ†å¸ƒå¼é”çš„å®ç°åŸç†ï¼Ÿä»€ä¹ˆåœºæ™¯ä¸‹ç”¨åˆ°åˆ†å¸ƒå¼é”ï¼Ÿ</h2><p><strong>åˆ†å¸ƒå¼é”æ˜¯ç”¨äºåˆ†å¸ƒå¼ç¯å¢ƒä¸‹å¹¶å‘æ§åˆ¶çš„ä¸€ç§æœºåˆ¶ï¼Œç”¨äºæ§åˆ¶æŸä¸ªèµ„æºåœ¨åŒä¸€æ—¶åˆ»åªèƒ½è¢«ä¸€ä¸ªåº”ç”¨æ‰€ä½¿ç”¨</strong>ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š<img src="https://cdn.xiaolincoding.com//picgo/1719108636409-6ff3328a-f0fb-4028-82ee-059b4f548a8a.webp" alt="img">Redis æœ¬èº«å¯ä»¥è¢«å¤šä¸ªå®¢æˆ·ç«¯å…±äº«è®¿é—®ï¼Œæ­£å¥½å°±æ˜¯ä¸€ä¸ªå…±äº«å­˜å‚¨ç³»ç»Ÿï¼Œå¯ä»¥ç”¨æ¥ä¿å­˜åˆ†å¸ƒå¼é”ï¼Œè€Œä¸” Redis çš„è¯»å†™æ€§èƒ½é«˜ï¼Œå¯ä»¥åº”å¯¹é«˜å¹¶å‘çš„é”æ“ä½œåœºæ™¯ã€‚<strong>Redis çš„ SET</strong> å‘½ä»¤æœ‰ä¸ª <strong>NX</strong> å‚æ•°å¯ä»¥å®ç°ã€Œkeyä¸å­˜åœ¨æ‰æ’å…¥ã€ï¼Œæ‰€ä»¥å¯ä»¥ç”¨å®ƒæ¥å®ç°åˆ†å¸ƒå¼é”ï¼š</p><ul><li>å¦‚æœ key ä¸å­˜åœ¨ï¼Œåˆ™æ˜¾ç¤ºæ’å…¥æˆåŠŸï¼Œå¯ä»¥ç”¨æ¥è¡¨ç¤ºåŠ é”æˆåŠŸï¼›</li><li>å¦‚æœ key å­˜åœ¨ï¼Œåˆ™ä¼šæ˜¾ç¤ºæ’å…¥å¤±è´¥ï¼Œå¯ä»¥ç”¨æ¥è¡¨ç¤ºåŠ é”å¤±è´¥ã€‚</li></ul><p>åŸºäº Redis èŠ‚ç‚¹å®ç°åˆ†å¸ƒå¼é”æ—¶ï¼Œå¯¹äºåŠ é”æ“ä½œï¼Œæˆ‘ä»¬éœ€è¦æ»¡è¶³ä¸‰ä¸ªæ¡ä»¶ã€‚</p><ul><li>åŠ é”åŒ…æ‹¬äº†<strong>è¯»å–é”å˜é‡ã€æ£€æŸ¥é”å˜é‡å€¼å’Œè®¾ç½®é”å˜é‡å€¼</strong>ä¸‰ä¸ªæ“ä½œï¼Œä½†éœ€è¦ä»¥åŸå­æ“ä½œçš„æ–¹å¼å®Œæˆï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬ä½¿ç”¨ SET å‘½ä»¤å¸¦ä¸Š NX é€‰é¡¹æ¥å®ç°åŠ é”ï¼›</li><li>é”å˜é‡éœ€è¦è®¾ç½®è¿‡æœŸæ—¶é—´ï¼Œä»¥å…å®¢æˆ·ç«¯æ‹¿åˆ°é”åå‘ç”Ÿå¼‚å¸¸ï¼Œå¯¼è‡´é”ä¸€ç›´æ— æ³•é‡Šæ”¾ï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬åœ¨ SET å‘½ä»¤æ‰§è¡Œæ—¶åŠ ä¸Š <strong>EX/PX</strong> é€‰é¡¹ï¼Œè®¾ç½®å…¶è¿‡æœŸæ—¶é—´ï¼›</li><li>é”å˜é‡çš„å€¼éœ€è¦èƒ½åŒºåˆ†æ¥è‡ªä¸åŒå®¢æˆ·ç«¯çš„åŠ é”æ“ä½œï¼Œä»¥å…åœ¨é‡Šæ”¾é”æ—¶ï¼Œå‡ºç°è¯¯é‡Šæ”¾æ“ä½œï¼Œæ‰€ä»¥ï¼Œæˆ‘ä»¬ä½¿ç”¨ SET å‘½ä»¤è®¾ç½®é”å˜é‡å€¼æ—¶ï¼Œ<strong>æ¯ä¸ªå®¢æˆ·ç«¯è®¾ç½®çš„å€¼æ˜¯ä¸€ä¸ªå”¯ä¸€å€¼ï¼Œç”¨äºæ ‡è¯†å®¢æˆ·ç«¯ï¼›</strong></li></ul><p>æ»¡è¶³è¿™ä¸‰ä¸ªæ¡ä»¶çš„åˆ†å¸ƒå¼å‘½ä»¤å¦‚ä¸‹ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SET lock_key unique_value NX PX 10000</span><br></pre></td></tr></table></figure><ul><li>lock_key å°±æ˜¯ key é”®ï¼›</li><li>unique_value æ˜¯å®¢æˆ·ç«¯ç”Ÿæˆçš„å”¯ä¸€çš„æ ‡è¯†ï¼ŒåŒºåˆ†æ¥è‡ªä¸åŒå®¢æˆ·ç«¯çš„é”æ“ä½œï¼›</li><li>NX ä»£è¡¨åªåœ¨ lock_key ä¸å­˜åœ¨æ—¶ï¼Œæ‰å¯¹ lock_key è¿›è¡Œè®¾ç½®æ“ä½œï¼›</li><li>PX 10000 è¡¨ç¤ºè®¾ç½® lock_key çš„è¿‡æœŸæ—¶é—´ä¸º 10sï¼Œè¿™æ˜¯ä¸ºäº†é¿å…å®¢æˆ·ç«¯å‘ç”Ÿå¼‚å¸¸è€Œæ— æ³•é‡Šæ”¾é”ã€‚</li></ul><p>è€Œè§£é”çš„è¿‡ç¨‹å°±æ˜¯å°† lock_key é”®åˆ é™¤ï¼ˆdel lock_keyï¼‰ï¼Œä½†ä¸èƒ½ä¹±åˆ ï¼Œè¦ä¿è¯æ‰§è¡Œæ“ä½œçš„å®¢æˆ·ç«¯å°±æ˜¯åŠ é”çš„å®¢æˆ·ç«¯ã€‚æ‰€ä»¥ï¼Œ<strong>è§£é”çš„æ—¶å€™ï¼Œæˆ‘ä»¬è¦å…ˆåˆ¤æ–­é”çš„ unique_value æ˜¯å¦ä¸ºåŠ é”å®¢æˆ·ç«¯ï¼Œæ˜¯çš„è¯ï¼Œæ‰å°† lock_key é”®åˆ é™¤ã€‚</strong></p><p>å¯ä»¥çœ‹åˆ°ï¼Œè§£é”æ˜¯æœ‰ä¸¤ä¸ªæ“ä½œï¼Œè¿™æ—¶å°±éœ€è¦ <strong>Lua è„šæœ¬</strong>æ¥ä¿è¯è§£é”çš„åŸå­æ€§ï¼Œå› ä¸º Redis åœ¨æ‰§è¡Œ Lua è„šæœ¬æ—¶ï¼Œå¯ä»¥ä»¥åŸå­æ€§çš„æ–¹å¼æ‰§è¡Œï¼Œä¿è¯äº†é”é‡Šæ”¾æ“ä½œçš„åŸå­æ€§ã€‚</p><figure class="highlight lua"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">// é‡Šæ”¾é”æ—¶ï¼Œå…ˆæ¯”è¾ƒ unique_value æ˜¯å¦ç›¸ç­‰ï¼Œé¿å…é”çš„è¯¯é‡Šæ”¾</span><br><span class="line"><span class="keyword">if</span> redis.call(<span class="string">&quot;get&quot;</span>,KEYS[<span class="number">1</span>]) == ARGV[<span class="number">1</span>] <span class="keyword">then</span></span><br><span class="line">  <span class="keyword">return</span> redis.call(<span class="string">&quot;del&quot;</span>,KEYS[<span class="number">1</span>])</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line"><span class="keyword">end</span></span><br></pre></td></tr></table></figure><p>è¿™æ ·ä¸€æ¥ï¼Œå°±é€šè¿‡ä½¿ç”¨ SET å‘½ä»¤å’Œ Lua è„šæœ¬åœ¨ Redis å•èŠ‚ç‚¹ä¸Šå®Œæˆäº†åˆ†å¸ƒå¼é”çš„åŠ é”å’Œè§£é”ã€‚</p><h2 id="10-Redisçš„å¤§Keyé—®é¢˜æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#10-Redisçš„å¤§Keyé—®é¢˜æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="10.Redisçš„å¤§Keyé—®é¢˜æ˜¯ä»€ä¹ˆï¼Ÿ"></a>10.Redisçš„å¤§Keyé—®é¢˜æ˜¯ä»€ä¹ˆï¼Ÿ</h2><p>ediså¤§keyé—®é¢˜æŒ‡çš„æ˜¯æŸä¸ªkeyå¯¹åº”çš„valueå€¼æ‰€å çš„å†…å­˜ç©ºé—´æ¯”è¾ƒå¤§ï¼Œå¯¼è‡´Redisçš„æ€§èƒ½ä¸‹é™ã€å†…å­˜ä¸è¶³ã€æ•°æ®ä¸å‡è¡¡ä»¥åŠä¸»ä»åŒæ­¥å»¶è¿Ÿç­‰é—®é¢˜ã€‚</p><p>åˆ°åº•å¤šå¤§çš„æ•°æ®é‡æ‰ç®—æ˜¯å¤§keyï¼Ÿ</p><p>æ²¡æœ‰å›ºå®šçš„åˆ¤åˆ«æ ‡å‡†ï¼Œé€šå¸¸è®¤ä¸º<strong>å­—ç¬¦ä¸²ç±»å‹çš„keyå¯¹åº”çš„valueå€¼å ç”¨ç©ºé—´å¤§äº1Mï¼Œæˆ–è€…é›†åˆç±»å‹çš„kå…ƒç´ æ•°é‡è¶…è¿‡1ä¸‡ä¸ªï¼Œå°±ç®—æ˜¯å¤§keyã€‚</strong></p><p>Rediså¤§keyé—®é¢˜çš„å®šä¹‰åŠè¯„åˆ¤å‡†åˆ™å¹¶éä¸€æˆä¸å˜ï¼Œè€Œåº”æ ¹æ®Redisçš„å®é™…è¿ç”¨ä»¥åŠä¸šåŠ¡éœ€æ±‚æ¥ç»¼åˆè¯„ä¼°ã€‚</p><p>ä¾‹å¦‚ï¼Œåœ¨é«˜å¹¶å‘ä¸”ä½å»¶è¿Ÿçš„åœºæ™¯ä¸­ï¼Œä»…10kbå¯èƒ½å°±å·²æ„æˆå¤§keyï¼›ç„¶è€Œåœ¨ä½å¹¶å‘ã€é«˜å®¹é‡çš„ç¯å¢ƒä¸‹ï¼Œå¤§keyçš„ç•Œé™å¯èƒ½åœ¨100kbã€‚å› æ­¤ï¼Œåœ¨è®¾è®¡ä¸è¿ç”¨Redisæ—¶ï¼Œè¦ä¾æ®ä¸šåŠ¡éœ€æ±‚ä¸æ€§èƒ½æŒ‡æ ‡æ¥ç¡®ç«‹åˆç†çš„å¤§keyé˜ˆå€¼ã€‚</p><h2 id="11-å¤§Keyé—®é¢˜çš„ç¼ºç‚¹ï¼Ÿ"><a href="#11-å¤§Keyé—®é¢˜çš„ç¼ºç‚¹ï¼Ÿ" class="headerlink" title="11.å¤§Keyé—®é¢˜çš„ç¼ºç‚¹ï¼Ÿ"></a>11.å¤§Keyé—®é¢˜çš„ç¼ºç‚¹ï¼Ÿ</h2><ul><li>å†…å­˜å ç”¨è¿‡é«˜ã€‚å¤§Keyå ç”¨è¿‡å¤šçš„å†…å­˜ç©ºé—´ï¼Œå¯èƒ½å¯¼è‡´å¯ç”¨å†…å­˜ä¸è¶³ï¼Œä»è€Œè§¦å‘å†…å­˜æ·˜æ±°ç­–ç•¥ã€‚åœ¨æç«¯æƒ…å†µä¸‹ï¼Œå¯èƒ½å¯¼è‡´å†…å­˜è€—å°½ï¼ŒRediså®ä¾‹å´©æºƒï¼Œå½±å“ç³»ç»Ÿçš„ç¨³å®šæ€§ã€‚</li><li>æ€§èƒ½ä¸‹é™ã€‚å¤§Keyä¼šå ç”¨å¤§é‡å†…å­˜ç©ºé—´ï¼Œå¯¼è‡´å†…å­˜ç¢ç‰‡å¢åŠ ï¼Œè¿›è€Œå½±å“Redisçš„æ€§èƒ½ã€‚å¯¹äºå¤§Keyçš„æ“ä½œï¼Œå¦‚è¯»å–ã€å†™å…¥ã€åˆ é™¤ç­‰ï¼Œéƒ½ä¼šæ¶ˆè€—æ›´å¤šçš„CPUæ—¶é—´å’Œå†…å­˜èµ„æºï¼Œè¿›ä¸€æ­¥é™ä½ç³»ç»Ÿæ€§èƒ½ã€‚</li><li>é˜»å¡å…¶ä»–æ“ä½œã€‚æŸäº›å¯¹å¤§Keyçš„æ“ä½œå¯èƒ½ä¼šå¯¼è‡´Rediså®ä¾‹é˜»å¡ã€‚ä¾‹å¦‚ï¼Œä½¿ç”¨DELå‘½ä»¤åˆ é™¤ä¸€ä¸ªå¤§Keyæ—¶ï¼Œå¯èƒ½ä¼šå¯¼è‡´Rediså®ä¾‹åœ¨ä¸€æ®µæ—¶é—´å†…æ— æ³•å“åº”å…¶ä»–å®¢æˆ·ç«¯è¯·æ±‚ï¼Œä»è€Œå½±å“ç³»ç»Ÿçš„å“åº”æ—¶é—´å’Œååé‡ã€‚</li><li>ç½‘ç»œæ‹¥å¡ã€‚æ¯æ¬¡è·å–å¤§keyäº§ç”Ÿçš„ç½‘ç»œæµé‡è¾ƒå¤§ï¼Œå¯èƒ½é€ æˆæœºå™¨æˆ–å±€åŸŸç½‘çš„å¸¦å®½è¢«æ‰“æ»¡ï¼ŒåŒæ—¶æ³¢åŠå…¶ä»–æœåŠ¡ã€‚ä¾‹å¦‚ï¼šä¸€ä¸ªå¤§keyå ç”¨ç©ºé—´æ˜¯1MBï¼Œæ¯ç§’è®¿é—®1000æ¬¡ï¼Œå°±æœ‰1000MBçš„æµé‡ã€‚</li><li>ä¸»ä»åŒæ­¥å»¶è¿Ÿã€‚å½“Rediså®ä¾‹é…ç½®äº†ä¸»ä»åŒæ­¥æ—¶ï¼Œå¤§Keyå¯èƒ½å¯¼è‡´ä¸»ä»åŒæ­¥å»¶è¿Ÿã€‚ç”±äºå¤§Keyå ç”¨è¾ƒå¤šå†…å­˜ï¼ŒåŒæ­¥è¿‡ç¨‹ä¸­éœ€è¦ä¼ è¾“å¤§é‡æ•°æ®ï¼Œè¿™ä¼šå¯¼è‡´ä¸»ä»ä¹‹é—´çš„ç½‘ç»œä¼ è¾“å»¶è¿Ÿå¢åŠ ï¼Œè¿›è€Œå½±å“æ•°æ®ä¸€è‡´æ€§ã€‚</li><li>æ•°æ®å€¾æ–œã€‚åœ¨Redisé›†ç¾¤æ¨¡å¼ä¸­ï¼Œ<strong>æŸä¸ªæ•°æ®åˆ†ç‰‡çš„å†…å­˜ä½¿ç”¨ç‡è¿œè¶…å…¶ä»–æ•°æ®åˆ†ç‰‡ï¼Œæ— æ³•ä½¿æ•°æ®åˆ†ç‰‡çš„å†…å­˜èµ„æºè¾¾åˆ°å‡è¡¡</strong>ã€‚å¦å¤–ä¹Ÿå¯èƒ½é€ æˆRediså†…å­˜è¾¾åˆ°maxmemoryå‚æ•°å®šä¹‰çš„ä¸Šé™å¯¼è‡´é‡è¦çš„keyè¢«é€å‡ºï¼Œç”šè‡³å¼•å‘å†…å­˜æº¢å‡ºã€‚</li></ul><h2 id="12-Rediså¤§keyå¦‚ä½•è§£å†³ï¼Ÿ"><a href="#12-Rediså¤§keyå¦‚ä½•è§£å†³ï¼Ÿ" class="headerlink" title="12.Rediså¤§keyå¦‚ä½•è§£å†³ï¼Ÿ"></a>12.Rediså¤§keyå¦‚ä½•è§£å†³ï¼Ÿ</h2><ul><li>å¯¹å¤§Keyè¿›è¡Œæ‹†åˆ†ã€‚ä¾‹å¦‚å°†å«æœ‰æ•°ä¸‡æˆå‘˜çš„ä¸€ä¸ªHASH Keyæ‹†åˆ†ä¸ºå¤šä¸ªHASH Keyï¼Œå¹¶ç¡®ä¿æ¯ä¸ªKeyçš„æˆå‘˜æ•°é‡åœ¨åˆç†èŒƒå›´ã€‚<strong>åœ¨Redisé›†ç¾¤æ¶æ„ä¸­ï¼Œæ‹†åˆ†å¤§Keyèƒ½å¯¹æ•°æ®åˆ†ç‰‡é—´çš„å†…å­˜å¹³è¡¡èµ·åˆ°æ˜¾è‘—ä½œç”¨ã€‚</strong></li><li>å¯¹å¤§Keyè¿›è¡Œæ¸…ç†ã€‚å°†<strong>ä¸é€‚ç”¨Redisèƒ½åŠ›çš„æ•°æ®å­˜è‡³å…¶å®ƒå­˜å‚¨</strong>ï¼Œå¹¶åœ¨Redisä¸­åˆ é™¤æ­¤ç±»æ•°æ®ã€‚æ³¨æ„ï¼Œè¦ä½¿ç”¨<strong>å¼‚æ­¥åˆ é™¤</strong>ã€‚åœ¨åå°çº¿ç¨‹è¿›è¡Œåˆ é™¤</li><li>ç›‘æ§Redisçš„å†…å­˜æ°´ä½ã€‚å¯ä»¥é€šè¿‡ç›‘æ§ç³»ç»Ÿè®¾ç½®<strong>åˆç†çš„Rediså†…å­˜æŠ¥è­¦é˜ˆå€¼</strong>è¿›è¡Œæé†’ï¼Œä¾‹å¦‚Rediså†…å­˜ä½¿ç”¨ç‡è¶…è¿‡70%ã€Redisçš„å†…å­˜åœ¨1å°æ—¶å†…å¢é•¿ç‡è¶…è¿‡20%ç­‰ã€‚</li><li>å¯¹è¿‡æœŸæ•°æ®è¿›<strong>è¡Œå®šæœŸæ¸…</strong>ã€‚å †ç§¯å¤§é‡è¿‡æœŸæ•°æ®ä¼šé€ æˆå¤§Keyçš„äº§ç”Ÿï¼Œä¾‹å¦‚åœ¨HASHæ•°æ®ç±»å‹ä¸­ä»¥å¢é‡çš„å½¢å¼ä¸æ–­å†™å…¥å¤§é‡æ•°æ®è€Œå¿½ç•¥äº†æ•°æ®çš„æ—¶æ•ˆæ€§ã€‚å¯ä»¥é€šè¿‡å®šæ—¶ä»»åŠ¡çš„æ–¹å¼å¯¹å¤±æ•ˆæ•°æ®è¿›è¡Œæ¸…ç†ã€‚</li></ul><h2 id="13-ä»€ä¹ˆæ˜¯çƒ­keyï¼Ÿ"><a href="#13-ä»€ä¹ˆæ˜¯çƒ­keyï¼Ÿ" class="headerlink" title="13.ä»€ä¹ˆæ˜¯çƒ­keyï¼Ÿ"></a>13.ä»€ä¹ˆæ˜¯çƒ­keyï¼Ÿ</h2><p>é€šå¸¸ä»¥å…¶æ¥æ”¶åˆ°çš„Keyè¢«è¯·æ±‚é¢‘ç‡æ¥åˆ¤å®šï¼Œä¾‹å¦‚ï¼š</p><ul><li><strong>QPSé›†ä¸­åœ¨ç‰¹å®šçš„Key</strong>ï¼šRediså®ä¾‹çš„æ€»QPSï¼ˆæ¯ç§’æŸ¥è¯¢ç‡ï¼‰ä¸º10,000ï¼Œè€Œå…¶ä¸­ä¸€ä¸ªKeyçš„æ¯ç§’è®¿é—®é‡è¾¾åˆ°äº†7,000ã€‚</li><li>å¸¦å®½ä½¿ç”¨ç‡é›†ä¸­åœ¨ç‰¹å®šçš„Keyï¼šå¯¹ä¸€ä¸ªæ‹¥æœ‰ä¸Šåƒä¸ªæˆå‘˜ä¸”æ€»å¤§å°ä¸º1 MBçš„HASH Keyæ¯ç§’å‘é€å¤§é‡çš„<strong>HGETALL</strong>æ“ä½œè¯·æ±‚ã€‚</li><li>CPUä½¿ç”¨æ—¶é—´å æ¯”é›†ä¸­åœ¨ç‰¹å®šçš„Keyï¼šå¯¹ä¸€ä¸ªæ‹¥æœ‰æ•°ä¸‡ä¸ªæˆå‘˜çš„Keyï¼ˆZSETç±»å‹ï¼‰æ¯ç§’å‘é€å¤§é‡çš„<strong>ZRANGE</strong>æ“ä½œè¯·æ±‚ã€‚</li></ul><h2 id="14-å¦‚ä½•è§£å†³çƒ­keyé—®é¢˜ï¼Ÿ"><a href="#14-å¦‚ä½•è§£å†³çƒ­keyé—®é¢˜ï¼Ÿ" class="headerlink" title="14.å¦‚ä½•è§£å†³çƒ­keyé—®é¢˜ï¼Ÿ"></a>14.å¦‚ä½•è§£å†³çƒ­keyé—®é¢˜ï¼Ÿ</h2><ul><li>åœ¨Redisé›†ç¾¤æ¶æ„ä¸­å¯¹<strong>çƒ­Keyè¿›è¡Œå¤åˆ¶</strong>ã€‚åœ¨Redisé›†ç¾¤æ¶æ„ä¸­ï¼Œç”±äºçƒ­Keyçš„è¿ç§»ç²’åº¦é—®é¢˜ï¼Œæ— æ³•å°†è¯·æ±‚åˆ†æ•£è‡³å…¶ä»–æ•°æ®åˆ†ç‰‡ï¼Œå¯¼è‡´å•ä¸ªæ•°æ®åˆ†ç‰‡çš„å‹åŠ›æ— æ³•ä¸‹é™ã€‚æ­¤æ—¶ï¼Œ<strong>å¯ä»¥å°†å¯¹åº”çƒ­Keyè¿›è¡Œå¤åˆ¶å¹¶è¿ç§»è‡³å…¶ä»–æ•°æ®åˆ†ç‰‡</strong>ï¼Œä¾‹å¦‚å°†çƒ­Key fooå¤åˆ¶å‡º3ä¸ªå†…å®¹å®Œå…¨ä¸€æ ·çš„Keyå¹¶åä¸ºfoo2ã€foo3ã€foo4ï¼Œå°†è¿™ä¸‰ä¸ªKeyè¿ç§»åˆ°å…¶ä»–æ•°æ®åˆ†ç‰‡æ¥è§£å†³å•ä¸ªæ•°æ®åˆ†ç‰‡çš„çƒ­Keyå‹åŠ›ã€‚</li><li>ä½¿ç”¨<strong>è¯»å†™åˆ†ç¦»æ¶æ„</strong>ã€‚å¦‚æœçƒ­Keyçš„äº§ç”Ÿæ¥è‡ªäºè¯»è¯·æ±‚ï¼Œæ‚¨å¯ä»¥å°†å®ä¾‹æ”¹é€ æˆè¯»å†™åˆ†ç¦»æ¶æ„æ¥é™ä½æ¯ä¸ªæ•°æ®åˆ†ç‰‡çš„è¯»è¯·æ±‚å‹åŠ›ï¼Œç”šè‡³å¯ä»¥ä¸æ–­åœ°å¢åŠ ä»èŠ‚ç‚¹ã€‚ä½†æ˜¯è¯»å†™åˆ†ç¦»æ¶æ„åœ¨å¢åŠ ä¸šåŠ¡ä»£ç å¤æ‚åº¦çš„åŒæ—¶ï¼Œä¹Ÿä¼šå¢åŠ Redisé›†ç¾¤æ¶æ„å¤æ‚åº¦ã€‚ä¸ä»…è¦ä¸ºå¤šä¸ªä»èŠ‚ç‚¹æä¾›è½¬å‘å±‚ï¼ˆå¦‚Proxyï¼ŒLVSç­‰ï¼‰æ¥å®ç°è´Ÿè½½å‡è¡¡ï¼Œè¿˜è¦è€ƒè™‘ä»èŠ‚ç‚¹æ•°é‡æ˜¾è‘—å¢åŠ åå¸¦æ¥æ•…éšœç‡å¢åŠ çš„é—®é¢˜ã€‚Redisé›†ç¾¤æ¶æ„å˜æ›´ä¼šä¸ºç›‘æ§ã€è¿ç»´ã€æ•…éšœå¤„ç†å¸¦æ¥äº†æ›´å¤§çš„æŒ‘æˆ˜ã€‚</li></ul><h2 id="15-å¦‚ä½•ä¿è¯-redis-å’Œ-mysql-æ•°æ®ç¼“å­˜ä¸€è‡´æ€§é—®é¢˜ï¼Ÿ"><a href="#15-å¦‚ä½•ä¿è¯-redis-å’Œ-mysql-æ•°æ®ç¼“å­˜ä¸€è‡´æ€§é—®é¢˜ï¼Ÿ" class="headerlink" title="15.å¦‚ä½•ä¿è¯ redis å’Œ mysql æ•°æ®ç¼“å­˜ä¸€è‡´æ€§é—®é¢˜ï¼Ÿ"></a>15.å¦‚ä½•ä¿è¯ redis å’Œ mysql æ•°æ®ç¼“å­˜ä¸€è‡´æ€§é—®é¢˜ï¼Ÿ</h2><p>å¯¹äºè¯»æ•°æ®ï¼Œæˆ‘ä¼šé€‰æ‹©<strong>æ—è·¯ç¼“å­˜ç­–ç•¥</strong>ï¼Œ<strong>å¦‚æœ cache ä¸å‘½ä¸­ï¼Œä¼šä» db åŠ è½½æ•°æ®åˆ° cacheã€‚å¯¹äºå†™æ•°æ®ï¼Œæˆ‘ä¼šé€‰æ‹©æ›´æ–° db åï¼Œå†åˆ é™¤ç¼“å­˜ã€‚</strong></p><p><img src="https://cdn.xiaolincoding.com//picgo/1720197145123-7e06f9a4-fcc7-42cc-a3d2-c44af4a73214.webp" alt="img"></p><p>ç¼“å­˜æ˜¯é€šè¿‡<strong>ç‰ºç‰²å¼ºä¸€è‡´æ€§</strong>æ¥æé«˜æ€§èƒ½çš„ã€‚è¿™æ˜¯ç”±<strong>CAPç†è®º</strong>å†³å®šçš„ã€‚ç¼“å­˜ç³»ç»Ÿé€‚ç”¨çš„åœºæ™¯å°±æ˜¯éå¼ºä¸€è‡´æ€§çš„åœºæ™¯ï¼Œå®ƒå±äºCAPä¸­çš„APã€‚æ‰€ä»¥ï¼Œå¦‚æœéœ€è¦æ•°æ®åº“å’Œç¼“å­˜æ•°æ®ä¿æŒå¼ºä¸€è‡´ï¼Œå°±ä¸é€‚åˆä½¿ç”¨ç¼“å­˜ã€‚</p><p>æ‰€ä»¥ä½¿ç”¨ç¼“å­˜æå‡æ€§èƒ½ï¼Œå°±æ˜¯ä¼šæœ‰æ•°æ®æ›´æ–°çš„å»¶è¿Ÿã€‚è¿™éœ€è¦æˆ‘ä»¬åœ¨è®¾è®¡æ—¶ç»“åˆä¸šåŠ¡ä»”ç»†æ€è€ƒæ˜¯å¦é€‚åˆç”¨ç¼“å­˜ã€‚ç„¶å<strong>ç¼“å­˜ä¸€å®šè¦è®¾ç½®è¿‡æœŸæ—¶é—´</strong>ï¼Œè¿™ä¸ªæ—¶é—´å¤ªçŸ­ã€æˆ–è€…å¤ªé•¿éƒ½ä¸å¥½ï¼š</p><ul><li>å¤ªçŸ­çš„è¯è¯·æ±‚å¯èƒ½ä¼šæ¯”è¾ƒå¤šçš„è½åˆ°æ•°æ®åº“ä¸Šï¼Œè¿™ä¹Ÿæ„å‘³ç€å¤±å»äº†ç¼“å­˜çš„ä¼˜åŠ¿ã€‚</li><li>å¤ªé•¿çš„è¯ç¼“å­˜ä¸­çš„è„æ•°æ®ä¼šä½¿ç³»ç»Ÿé•¿æ—¶é—´å¤„äºä¸€ä¸ªå»¶è¿Ÿçš„çŠ¶æ€ï¼Œè€Œä¸”ç³»ç»Ÿä¸­é•¿æ—¶é—´æ²¡æœ‰äººè®¿é—®çš„æ•°æ®ä¸€ç›´å­˜åœ¨å†…å­˜ä¸­ä¸è¿‡æœŸï¼Œæµªè´¹å†…å­˜ã€‚</li></ul><p>ä½†æ˜¯ï¼Œé€šè¿‡ä¸€äº›æ–¹æ¡ˆä¼˜åŒ–å¤„ç†ï¼Œæ˜¯å¯ä»¥<strong>æœ€ç»ˆä¸€è‡´æ€§</strong>çš„ã€‚</p><p>é’ˆå¯¹åˆ é™¤ç¼“å­˜å¼‚å¸¸çš„æƒ…å†µï¼Œå¯ä»¥ä½¿ç”¨ 2 ä¸ªæ–¹æ¡ˆé¿å…ï¼š</p><ul><li>åˆ é™¤ç¼“å­˜é‡è¯•ç­–ç•¥ï¼ˆæ¶ˆæ¯é˜Ÿåˆ—ï¼‰</li><li>è®¢é˜… binlogï¼Œå†åˆ é™¤ç¼“å­˜ï¼ˆCanal+æ¶ˆæ¯é˜Ÿåˆ—ï¼‰</li></ul><blockquote><p>æ¶ˆæ¯é˜Ÿåˆ—æ–¹æ¡ˆ</p></blockquote><p>æˆ‘ä»¬å¯ä»¥å¼•å…¥<strong>æ¶ˆæ¯é˜Ÿåˆ—</strong>ï¼Œå°†<strong>ç¬¬äºŒä¸ªæ“ä½œï¼ˆåˆ é™¤ç¼“å­˜ï¼‰è¦æ“ä½œçš„æ•°æ®åŠ å…¥åˆ°æ¶ˆæ¯é˜Ÿåˆ—ï¼Œç”±æ¶ˆè´¹è€…æ¥æ“ä½œæ•°æ®ã€‚</strong></p><ul><li>å¦‚æœåº”ç”¨<strong>åˆ é™¤ç¼“å­˜å¤±è´¥</strong>ï¼Œå¯ä»¥ä»æ¶ˆæ¯é˜Ÿåˆ—ä¸­é‡æ–°è¯»å–æ•°æ®ï¼Œç„¶åå†æ¬¡åˆ é™¤ç¼“å­˜ï¼Œè¿™ä¸ªå°±æ˜¯<strong>é‡è¯•æœºåˆ¶</strong>ã€‚å½“ç„¶ï¼Œå¦‚æœé‡è¯•è¶…è¿‡çš„ä¸€å®šæ¬¡æ•°ï¼Œè¿˜æ˜¯æ²¡æœ‰æˆåŠŸï¼Œæˆ‘ä»¬å°±éœ€è¦å‘ä¸šåŠ¡å±‚å‘é€æŠ¥é”™ä¿¡æ¯äº†ã€‚</li><li>å¦‚æœ<strong>åˆ é™¤ç¼“å­˜æˆåŠŸ</strong>ï¼Œå°±è¦æŠŠæ•°æ®ä»æ¶ˆæ¯é˜Ÿåˆ—ä¸­ç§»é™¤ï¼Œé¿å…é‡å¤æ“ä½œï¼Œå¦åˆ™å°±ç»§ç»­é‡è¯•ã€‚</li></ul><p>ä¸¾ä¸ªä¾‹å­ï¼Œæ¥è¯´æ˜é‡è¯•æœºåˆ¶çš„è¿‡ç¨‹ã€‚</p><p><img src="https://cdn.xiaolincoding.com//picgo/1720223533280-96461154-bd99-418c-bc90-52a90bc70cac.webp" alt="img"></p><p>é‡è¯•åˆ é™¤ç¼“å­˜æœºåˆ¶è¿˜å¯ä»¥ï¼Œå°±æ˜¯ä¼š<strong>é€ æˆå¥½å¤šä¸šåŠ¡ä»£ç å…¥ä¾µ</strong>ã€‚</p><blockquote><p>è®¢é˜… MySQL binlogï¼Œå†æ“ä½œç¼“å­˜</p></blockquote><p>ã€Œ<strong>å…ˆæ›´æ–°æ•°æ®åº“ï¼Œå†åˆ ç¼“å­˜</strong>ã€çš„ç­–ç•¥çš„ç¬¬ä¸€æ­¥æ˜¯æ›´æ–°æ•°æ®åº“ï¼Œé‚£ä¹ˆæ›´æ–°æ•°æ®åº“æˆåŠŸï¼Œå°±ä¼šäº§ç”Ÿä¸€æ¡å˜æ›´æ—¥å¿—ï¼Œè®°å½•åœ¨ binlog é‡Œã€‚</p><p>äºæ˜¯æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡<strong>è®¢é˜… binlog æ—¥å¿—ï¼Œæ‹¿åˆ°å…·ä½“è¦æ“ä½œçš„æ•°æ®ï¼Œç„¶åå†æ‰§è¡Œç¼“å­˜åˆ é™¤</strong>ï¼Œé˜¿é‡Œå·´å·´å¼€æºçš„ Canal ä¸­é—´ä»¶å°±æ˜¯åŸºäºè¿™ä¸ªå®ç°çš„ã€‚</p><p>Canal æ¨¡æ‹Ÿ MySQL ä¸»ä»å¤åˆ¶çš„äº¤äº’åè®®ï¼ŒæŠŠè‡ªå·±ä¼ªè£…æˆä¸€ä¸ª MySQL çš„ä»èŠ‚ç‚¹ï¼Œå‘ MySQL ä¸»èŠ‚ç‚¹å‘é€ dump è¯·æ±‚ï¼ŒMySQL æ”¶åˆ°è¯·æ±‚åï¼Œå°±ä¼šå¼€å§‹æ¨é€ Binlog ç»™ Canalï¼ŒCanal è§£æ Binlog å­—èŠ‚æµä¹‹åï¼Œè½¬æ¢ä¸ºä¾¿äºè¯»å–çš„ç»“æ„åŒ–æ•°æ®ï¼Œä¾›ä¸‹æ¸¸ç¨‹åºè®¢é˜…ä½¿ç”¨ã€‚</p><p>ä¸‹å›¾æ˜¯ Canal çš„å·¥ä½œåŸç†ï¼š</p><p><img src="https://cdn.xiaolincoding.com//picgo/1720223533277-56afc647-23ee-436c-a99a-ed4a338d07fc.webp" alt="img"></p><p><strong>å°†binlogæ—¥å¿—é‡‡é›†å‘é€åˆ°MQé˜Ÿåˆ—é‡Œé¢ï¼Œç„¶åç¼–å†™ä¸€ä¸ªç®€å•çš„ç¼“å­˜åˆ é™¤æ¶ˆæ¯è€…è®¢é˜…binlogæ—¥å¿—ï¼Œæ ¹æ®æ›´æ–°logåˆ é™¤ç¼“å­˜ï¼Œå¹¶ä¸”é€šè¿‡ACKæœºåˆ¶ç¡®è®¤å¤„ç†è¿™æ¡æ›´æ–°logï¼Œä¿è¯æ•°æ®ç¼“å­˜ä¸€è‡´æ€§</strong></p><h2 id="16-å¸ƒéš†è¿‡æ»¤å™¨åŸç†ä»‹ç»ä¸€ä¸‹"><a href="#16-å¸ƒéš†è¿‡æ»¤å™¨åŸç†ä»‹ç»ä¸€ä¸‹" class="headerlink" title="16.å¸ƒéš†è¿‡æ»¤å™¨åŸç†ä»‹ç»ä¸€ä¸‹"></a>16.å¸ƒéš†è¿‡æ»¤å™¨åŸç†ä»‹ç»ä¸€ä¸‹</h2><p>å¸ƒéš†è¿‡æ»¤å™¨ç”±<strong>ã€Œåˆå§‹å€¼éƒ½ä¸º 0 çš„ä½å›¾æ•°ç»„ã€å’Œã€Œ N ä¸ªå“ˆå¸Œå‡½æ•°ã€</strong>ä¸¤éƒ¨åˆ†ç»„æˆã€‚å½“æˆ‘ä»¬åœ¨å†™å…¥æ•°æ®åº“æ•°æ®æ—¶ï¼Œåœ¨å¸ƒéš†è¿‡æ»¤å™¨é‡Œåšä¸ªæ ‡è®°ï¼Œè¿™æ ·ä¸‹æ¬¡æŸ¥è¯¢æ•°æ®æ˜¯å¦åœ¨æ•°æ®åº“æ—¶ï¼Œåªéœ€è¦æŸ¥è¯¢å¸ƒéš†è¿‡æ»¤å™¨ï¼Œå¦‚æœæŸ¥è¯¢åˆ°æ•°æ®æ²¡æœ‰è¢«æ ‡è®°ï¼Œè¯´æ˜ä¸åœ¨æ•°æ®åº“ä¸­ã€‚</p><p>å¸ƒéš†è¿‡æ»¤å™¨ä¼šé€šè¿‡ 3 ä¸ªæ“ä½œå®Œæˆæ ‡è®°ï¼š</p><ul><li>ç¬¬ä¸€æ­¥ï¼Œä½¿ç”¨ N ä¸ªå“ˆå¸Œå‡½æ•°åˆ†åˆ«å¯¹æ•°æ®åšå“ˆå¸Œè®¡ç®—ï¼Œå¾—åˆ° N ä¸ªå“ˆå¸Œå€¼ï¼›</li><li>ç¬¬äºŒæ­¥ï¼Œå°†ç¬¬ä¸€æ­¥å¾—åˆ°çš„ N ä¸ªå“ˆå¸Œå€¼å¯¹ä½å›¾æ•°ç»„çš„é•¿åº¦å–æ¨¡ï¼Œå¾—åˆ°<strong>æ¯ä¸ªå“ˆå¸Œå€¼åœ¨ä½å›¾æ•°ç»„çš„å¯¹åº”ä½ç½®ã€‚</strong></li><li>ç¬¬ä¸‰æ­¥ï¼Œå°†æ¯ä¸ªå“ˆå¸Œå€¼åœ¨ä½å›¾æ•°ç»„çš„å¯¹åº”ä½ç½®çš„å€¼è®¾ç½®ä¸º 1ï¼›</li></ul><p>ä¸¾ä¸ªä¾‹å­ï¼Œå‡è®¾æœ‰ä¸€ä¸ªä½å›¾æ•°ç»„é•¿åº¦ä¸º 8ï¼Œå“ˆå¸Œå‡½æ•° 3 ä¸ªçš„å¸ƒéš†è¿‡æ»¤å™¨ã€‚</p><p><img src="https://cdn.xiaolincoding.com//picgo/1719903580960-2490c9c0-616b-4b11-a290-4891c2d7511a.png" alt="img"></p><p>åœ¨æ•°æ®åº“å†™å…¥æ•°æ® x åï¼ŒæŠŠæ•°æ® x æ ‡è®°åœ¨å¸ƒéš†è¿‡æ»¤å™¨æ—¶ï¼Œæ•°æ® x ä¼šè¢« 3 ä¸ªå“ˆå¸Œå‡½æ•°åˆ†åˆ«è®¡ç®—å‡º 3 ä¸ªå“ˆå¸Œå€¼ï¼Œç„¶ååœ¨å¯¹è¿™ 3 ä¸ªå“ˆå¸Œå€¼å¯¹ 8 å–æ¨¡ï¼Œå‡è®¾å–æ¨¡çš„ç»“æœä¸º 1ã€4ã€6ï¼Œç„¶åæŠŠä½å›¾æ•°ç»„çš„ç¬¬ 1ã€4ã€6 ä½ç½®çš„å€¼è®¾ç½®ä¸º 1ã€‚<strong>å½“åº”ç”¨è¦æŸ¥è¯¢æ•°æ® x æ˜¯å¦æ•°æ®åº“æ—¶ï¼Œé€šè¿‡å¸ƒéš†è¿‡æ»¤å™¨åªè¦æŸ¥åˆ°ä½å›¾æ•°ç»„çš„ç¬¬ 1ã€4ã€6 ä½ç½®çš„å€¼æ˜¯å¦å…¨ä¸º 1ï¼Œåªè¦æœ‰ä¸€ä¸ªä¸º 0ï¼Œå°±è®¤ä¸ºæ•°æ® x ä¸åœ¨æ•°æ®åº“ä¸­</strong>ã€‚</p><p>å¸ƒéš†è¿‡æ»¤å™¨ç”±äºæ˜¯åŸºäºå“ˆå¸Œå‡½æ•°å®ç°æŸ¥æ‰¾çš„ï¼Œé«˜æ•ˆæŸ¥æ‰¾çš„åŒæ—¶<strong>å­˜åœ¨å“ˆå¸Œå†²çªçš„å¯èƒ½æ€§</strong>ï¼Œæ¯”å¦‚æ•°æ® x å’Œæ•°æ® y å¯èƒ½éƒ½è½åœ¨ç¬¬ 1ã€4ã€6 ä½ç½®ï¼Œè€Œäº‹å®ä¸Šï¼Œå¯èƒ½æ•°æ®åº“ä¸­å¹¶ä¸å­˜åœ¨æ•°æ® yï¼Œå­˜åœ¨è¯¯åˆ¤çš„æƒ…å†µã€‚</p><p>æ‰€ä»¥ï¼Œ<strong>æŸ¥è¯¢å¸ƒéš†è¿‡æ»¤å™¨è¯´æ•°æ®å­˜åœ¨ï¼Œå¹¶ä¸ä¸€å®šè¯æ˜æ•°æ®åº“ä¸­å­˜åœ¨è¿™ä¸ªæ•°æ®ï¼Œä½†æ˜¯æŸ¥è¯¢åˆ°æ•°æ®ä¸å­˜åœ¨ï¼Œæ•°æ®åº“ä¸­ä¸€å®šå°±ä¸å­˜åœ¨è¿™ä¸ªæ•°æ®</strong>ã€‚</p>]]></content:encoded>
      
      
      <category domain="https://blog.tokenlen.top/categories/%E6%8A%80%E6%9C%AF%E6%A0%88/">æŠ€æœ¯æ ˆ</category>
      
      
      <category domain="https://blog.tokenlen.top/tags/%E9%9D%A2%E8%AF%95/">é¢è¯•</category>
      
      <category domain="https://blog.tokenlen.top/tags/redis/">redis</category>
      
      
      <comments>https://blog.tokenlen.top/2025/05/15/java-stack/redis2/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>LeetcodeåŒæŒ‡é’ˆ</title>
      <link>https://blog.tokenlen.top/2025/05/12/leetcode/leetcode3/</link>
      <guid>https://blog.tokenlen.top/2025/05/12/leetcode/leetcode3/</guid>
      <pubDate>Sun, 11 May 2025 16:00:00 GMT</pubDate>
      
        
        
          
          
      <description>&lt;h1 id=&quot;ç›¸å‘åŒæŒ‡é’ˆ&quot;&gt;&lt;a href=&quot;#ç›¸å‘åŒæŒ‡é’ˆ&quot; class=&quot;headerlink&quot; title=&quot;ç›¸å‘åŒæŒ‡é’ˆ&quot;&gt;&lt;/a&gt;ç›¸å‘åŒæŒ‡é’ˆ&lt;/h1&gt;&lt;p&gt;ä¸¤ä¸ªæŒ‡é’ˆ &lt;em&gt;left&lt;/em&gt;=0,</description>
          
        
      
      
      
      <content:encoded><![CDATA[<h1 id="ç›¸å‘åŒæŒ‡é’ˆ"><a href="#ç›¸å‘åŒæŒ‡é’ˆ" class="headerlink" title="ç›¸å‘åŒæŒ‡é’ˆ"></a>ç›¸å‘åŒæŒ‡é’ˆ</h1><p>ä¸¤ä¸ªæŒ‡é’ˆ <em>left</em>=0, <em>right</em>=<em>n</em>âˆ’1ï¼Œä»æ•°ç»„çš„ä¸¤ç«¯å¼€å§‹ï¼Œå‘ä¸­é—´ç§»åŠ¨ï¼Œè¿™å«<strong>ç›¸å‘åŒæŒ‡é’ˆ</strong>ã€‚ä¸Šé¢çš„æ»‘åŠ¨çª—å£ç›¸å½“äº<strong>åŒå‘åŒæŒ‡é’ˆ</strong>ã€‚</p><h2 id="344-åè½¬å­—ç¬¦ä¸²"><a href="#344-åè½¬å­—ç¬¦ä¸²" class="headerlink" title="344. åè½¬å­—ç¬¦ä¸²"></a><a href="https://leetcode.cn/problems/reverse-string/">344. åè½¬å­—ç¬¦ä¸²</a></h2><p>ç¼–å†™ä¸€ä¸ªå‡½æ•°ï¼Œå…¶ä½œç”¨æ˜¯å°†è¾“å…¥çš„å­—ç¬¦ä¸²åè½¬è¿‡æ¥ã€‚è¾“å…¥å­—ç¬¦ä¸²ä»¥å­—ç¬¦æ•°ç»„ <code>s</code> çš„å½¢å¼ç»™å‡ºã€‚</p><p>ä¸è¦ç»™å¦å¤–çš„æ•°ç»„åˆ†é…é¢å¤–çš„ç©ºé—´ï¼Œä½ å¿…é¡»<strong><a href="https://baike.baidu.com/item/åŸåœ°ç®—æ³•">åŸåœ°</a>ä¿®æ”¹è¾“å…¥æ•°ç»„</strong>ã€ä½¿ç”¨ O(1) çš„é¢å¤–ç©ºé—´è§£å†³è¿™ä¸€é—®é¢˜ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution344</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">reverseString</span><span class="params">(<span class="type">char</span>[] s)</span>&#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> s.length;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> left=<span class="number">0</span>,right=n-<span class="number">1</span>;left&lt;right;left++,right--)&#123;</span><br><span class="line">            <span class="type">char</span> <span class="variable">tmp</span> <span class="operator">=</span> s[left];</span><br><span class="line">            s[left] = s[right];</span><br><span class="line">            s[right] = tmp;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ç®€å•çš„åŒæŒ‡é’ˆè§£å†³</p><p>å°±æ˜¯è®©å¤´å’Œå°¾äº’æ¢å€¼å°±okäº†</p><h2 id="125-éªŒè¯å›æ–‡ä¸²"><a href="#125-éªŒè¯å›æ–‡ä¸²" class="headerlink" title="125. éªŒè¯å›æ–‡ä¸²"></a><a href="https://leetcode.cn/problems/valid-palindrome/">125. éªŒè¯å›æ–‡ä¸²</a></h2><p>å¦‚æœåœ¨å°†æ‰€æœ‰å¤§å†™å­—ç¬¦è½¬æ¢ä¸ºå°å†™å­—ç¬¦ã€å¹¶ç§»é™¤æ‰€æœ‰éå­—æ¯æ•°å­—å­—ç¬¦ä¹‹åï¼ŒçŸ­è¯­æ­£ç€è¯»å’Œåç€è¯»éƒ½ä¸€æ ·ã€‚åˆ™å¯ä»¥è®¤ä¸ºè¯¥çŸ­è¯­æ˜¯ä¸€ä¸ª <strong>å›æ–‡ä¸²</strong> ã€‚</p><p>å­—æ¯å’Œæ•°å­—éƒ½å±äºå­—æ¯æ•°å­—å­—ç¬¦ã€‚</p><p>ç»™ä½ ä¸€ä¸ªå­—ç¬¦ä¸² <code>s</code>ï¼Œå¦‚æœå®ƒæ˜¯ <strong>å›æ–‡ä¸²</strong> ï¼Œè¿”å› <code>true</code> ï¼›å¦åˆ™ï¼Œè¿”å› <code>false</code> ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution125</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isPalindrome</span><span class="params">(String s)</span>&#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> s.length();</span><br><span class="line">        <span class="type">int</span> <span class="variable">left</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">right</span> <span class="operator">=</span> n-<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span> (left&lt;right)&#123;</span><br><span class="line">            <span class="keyword">if</span> (!Character.isLetterOrDigit(s.charAt(left)))&#123;</span><br><span class="line">                left++;</span><br><span class="line">            &#125;<span class="keyword">else</span> <span class="keyword">if</span> (!Character.isLetterOrDigit(s.charAt(right)))&#123;</span><br><span class="line">                right--;</span><br><span class="line">            &#125;<span class="keyword">else</span> <span class="keyword">if</span> (Character.toLowerCase(s.charAt(left))==Character.toLowerCase(s.charAt(right)))&#123;</span><br><span class="line">                left++;</span><br><span class="line">                right--;</span><br><span class="line">            &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é‡åˆ°æ•°å­—å•¥çš„å°±è·³è¿‡</p><p>å¦‚æœleftä¸rightè½¬æˆå°å†™ç›¸ç­‰çš„è¯ï¼Œå°±ç»§ç»­å¾€å‰ï¼Œè¿™æ ·å°±å¯ä»¥è½¬æˆå›æ–‡</p><p>ç„¶åæ²¡æœ‰çš„è¯ï¼Œå°±ä¸ºfalse</p><h2 id="1750-åˆ é™¤å­—ç¬¦ä¸²ä¸¤ç«¯ç›¸åŒå­—ç¬¦åçš„æœ€çŸ­é•¿åº¦"><a href="#1750-åˆ é™¤å­—ç¬¦ä¸²ä¸¤ç«¯ç›¸åŒå­—ç¬¦åçš„æœ€çŸ­é•¿åº¦" class="headerlink" title="1750. åˆ é™¤å­—ç¬¦ä¸²ä¸¤ç«¯ç›¸åŒå­—ç¬¦åçš„æœ€çŸ­é•¿åº¦"></a><a href="https://leetcode.cn/problems/minimum-length-of-string-after-deleting-similar-ends/">1750. åˆ é™¤å­—ç¬¦ä¸²ä¸¤ç«¯ç›¸åŒå­—ç¬¦åçš„æœ€çŸ­é•¿åº¦</a></h2><p>ç»™ä½ ä¸€ä¸ªåªåŒ…å«å­—ç¬¦ <code>&#39;a&#39;</code>ï¼Œ<code>&#39;b&#39;</code> å’Œ <code>&#39;c&#39;</code> çš„å­—ç¬¦ä¸² <code>s</code> ï¼Œä½ å¯ä»¥æ‰§è¡Œä¸‹é¢è¿™ä¸ªæ“ä½œï¼ˆ5 ä¸ªæ­¥éª¤ï¼‰ä»»æ„æ¬¡ï¼š</p><ol><li>é€‰æ‹©å­—ç¬¦ä¸² <code>s</code> ä¸€ä¸ª <strong>éç©º</strong> çš„å‰ç¼€ï¼Œè¿™ä¸ªå‰ç¼€çš„æ‰€æœ‰å­—ç¬¦éƒ½ç›¸åŒã€‚</li><li>é€‰æ‹©å­—ç¬¦ä¸² <code>s</code> ä¸€ä¸ª <strong>éç©º</strong> çš„åç¼€ï¼Œè¿™ä¸ªåç¼€çš„æ‰€æœ‰å­—ç¬¦éƒ½ç›¸åŒã€‚</li><li>å‰ç¼€å’Œåç¼€åœ¨å­—ç¬¦ä¸²ä¸­ä»»æ„ä½ç½®éƒ½ä¸èƒ½æœ‰äº¤é›†ã€‚</li><li>å‰ç¼€å’Œåç¼€åŒ…å«çš„æ‰€æœ‰å­—ç¬¦éƒ½è¦ç›¸åŒã€‚</li><li>åŒæ—¶åˆ é™¤å‰ç¼€å’Œåç¼€ã€‚</li></ol><p>è¯·ä½ è¿”å›å¯¹å­—ç¬¦ä¸² <code>s</code> æ‰§è¡Œä¸Šé¢æ“ä½œä»»æ„æ¬¡ä»¥åï¼ˆå¯èƒ½ 0 æ¬¡ï¼‰ï¼Œèƒ½å¾—åˆ°çš„ <strong>æœ€çŸ­é•¿åº¦</strong> ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution1750</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">minimumLength</span><span class="params">(String S)</span>&#123;</span><br><span class="line">        <span class="type">char</span>[] s = S.toCharArray();</span><br><span class="line">        <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> s.length;</span><br><span class="line">        <span class="type">int</span> <span class="variable">left</span> <span class="operator">=</span> <span class="number">0</span>,right = n-<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span> (left&lt;right&amp;&amp;s[left]==s[right])&#123;</span><br><span class="line">            <span class="type">char</span> <span class="variable">c</span> <span class="operator">=</span> s[left];</span><br><span class="line">            <span class="keyword">while</span> (left&lt;=right&amp;&amp;s[left]==c) left++;</span><br><span class="line">            <span class="keyword">while</span> (left&lt;=right&amp;&amp;s[right]==c) right--;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> right-left+<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç®€å•çš„åŒæŒ‡é’ˆé—®é¢˜ï¼Œæœ€åå‰©ä¸‹çš„çª—å£çš„é•¿åº¦å°±æ˜¯æœ€åçš„</p><p>ä»£ç </p><p>æµ‹è¯•ç”¨ä¾‹</p><p>æµ‹è¯•ç»“æœ</p><p>æµ‹è¯•ç»“æœ</p><h2 id="2105-ç»™æ¤ç‰©æµ‡æ°´-II"><a href="#2105-ç»™æ¤ç‰©æµ‡æ°´-II" class="headerlink" title="2105. ç»™æ¤ç‰©æµ‡æ°´ II"></a><a href="https://leetcode.cn/problems/watering-plants-ii/">2105. ç»™æ¤ç‰©æµ‡æ°´ II</a></h2><p>Alice å’Œ Bob æ‰“ç®—ç»™èŠ±å›­é‡Œçš„ <code>n</code> æ ªæ¤ç‰©æµ‡æ°´ã€‚æ¤ç‰©æ’æˆä¸€è¡Œï¼Œä»å·¦åˆ°å³è¿›è¡Œæ ‡è®°ï¼Œç¼–å·ä» <code>0</code> åˆ° <code>n - 1</code> ã€‚å…¶ä¸­ï¼Œç¬¬ <code>i</code> æ ªæ¤ç‰©çš„ä½ç½®æ˜¯ <code>x = i</code> ã€‚</p><p>æ¯ä¸€æ ªæ¤ç‰©éƒ½éœ€è¦æµ‡ç‰¹å®šé‡çš„æ°´ã€‚Alice å’Œ Bob æ¯äººæœ‰ä¸€ä¸ªæ°´ç½ï¼Œ<strong>æœ€åˆæ˜¯æ»¡çš„</strong> ã€‚ä»–ä»¬æŒ‰ä¸‹é¢æè¿°çš„æ–¹å¼å®Œæˆæµ‡æ°´ï¼š</p><ul><li>Alice æŒ‰ <strong>ä»å·¦åˆ°å³</strong> çš„é¡ºåºç»™æ¤ç‰©æµ‡æ°´ï¼Œä»æ¤ç‰© <code>0</code> å¼€å§‹ã€‚Bob æŒ‰ <strong>ä»å³åˆ°å·¦</strong> çš„é¡ºåºç»™æ¤ç‰©æµ‡æ°´ï¼Œä»æ¤ç‰© <code>n - 1</code> å¼€å§‹ã€‚ä»–ä»¬ <strong>åŒæ—¶</strong> ç»™æ¤ç‰©æµ‡æ°´ã€‚</li><li>æ— è®ºéœ€è¦å¤šå°‘æ°´ï¼Œä¸ºæ¯æ ªæ¤ç‰©æµ‡æ°´æ‰€éœ€çš„æ—¶é—´éƒ½æ˜¯ç›¸åŒçš„ã€‚</li><li>å¦‚æœ Alice/Bob æ°´ç½ä¸­çš„æ°´è¶³ä»¥ <strong>å®Œå…¨</strong> çŒæº‰æ¤ç‰©ï¼Œä»–ä»¬ <strong>å¿…é¡»</strong> ç»™æ¤ç‰©æµ‡æ°´ã€‚å¦åˆ™ï¼Œä»–ä»¬ <strong>é¦–å…ˆ</strong>ï¼ˆç«‹å³ï¼‰é‡æ–°è£…æ»¡ç½å­ï¼Œç„¶åç»™æ¤ç‰©æµ‡æ°´ã€‚</li><li>å¦‚æœ Alice å’Œ Bob åˆ°è¾¾åŒä¸€æ ªæ¤ç‰©ï¼Œé‚£ä¹ˆå½“å‰æ°´ç½ä¸­æ°´ <strong>æ›´å¤š</strong> çš„äººä¼šç»™è¿™æ ªæ¤ç‰©æµ‡æ°´ã€‚å¦‚æœä»–ä¿©æ°´é‡ç›¸åŒï¼Œé‚£ä¹ˆ Alice ä¼šç»™è¿™æ ªæ¤ç‰©æµ‡æ°´ã€‚</li></ul><p>ç»™ä½ ä¸€ä¸ªä¸‹æ ‡ä» <strong>0</strong> å¼€å§‹çš„æ•´æ•°æ•°ç»„ <code>plants</code> ï¼Œæ•°ç»„ç”± <code>n</code> ä¸ªæ•´æ•°ç»„æˆã€‚å…¶ä¸­ï¼Œ<code>plants[i]</code> ä¸ºç¬¬ <code>i</code> æ ªæ¤ç‰©éœ€è¦çš„æ°´é‡ã€‚å¦æœ‰ä¸¤ä¸ªæ•´æ•° <code>capacityA</code> å’Œ <code>capacityB</code> åˆ†åˆ«è¡¨ç¤º Alice å’Œ Bob æ°´ç½çš„å®¹é‡ã€‚è¿”å›ä¸¤äººæµ‡çŒæ‰€æœ‰æ¤ç‰©è¿‡ç¨‹ä¸­é‡æ–°çŒæ»¡æ°´ç½çš„ <strong>æ¬¡æ•°</strong> ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution2105</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">minimumRefill</span><span class="params">(<span class="type">int</span>[] plants, <span class="type">int</span> capacityA, <span class="type">int</span> capacityB)</span>&#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">ans</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">a</span> <span class="operator">=</span> capacityA;</span><br><span class="line">        <span class="type">int</span> <span class="variable">b</span> <span class="operator">=</span> capacityB;</span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span><span class="number">0</span>,j = plants.length-<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span> (i&lt;j)&#123;</span><br><span class="line">            <span class="keyword">if</span> (a&lt;plants[i])&#123;</span><br><span class="line">                ans++;</span><br><span class="line">                a = capacityA;</span><br><span class="line">            &#125;</span><br><span class="line">            a -=plants[i++];</span><br><span class="line">            <span class="keyword">if</span> (b&lt;plants[j])&#123;</span><br><span class="line">                ans++;</span><br><span class="line">                b  = capacityB;</span><br><span class="line">            &#125;</span><br><span class="line">            b -=plants[j--];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (i==j&amp;&amp;Math.max(a,b)&lt;plants[i])&#123;</span><br><span class="line">            ans++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸€çœ‹ä»–ä»¬ä¸€ä¸ªä»å·¦å¼€å§‹ä¸€ä¸ªä»å³å¼€å§‹</p><p>ä¸€çœ‹å°±æ˜¯ç›¸å‘åŒæŒ‡é’ˆ</p><p>å¦‚æœæ°´ä¸å¤Ÿï¼Œå°±å†è£…ä¸€ç“¶</p><p>å¤Ÿçš„è¯ï¼Œå°±ç›´æ¥äº¤å°±è¡Œ</p><p>ç„¶åç›¸é‡çš„æ—¶å€™i=jäº†ï¼Œç›´æ¥æ¯”å¤§å°å°±è¡Œ</p><h2 id="977-æœ‰åºæ•°ç»„çš„å¹³æ–¹"><a href="#977-æœ‰åºæ•°ç»„çš„å¹³æ–¹" class="headerlink" title="977. æœ‰åºæ•°ç»„çš„å¹³æ–¹"></a><a href="https://leetcode.cn/problems/squares-of-a-sorted-array/">977. æœ‰åºæ•°ç»„çš„å¹³æ–¹</a></h2><p>ç»™ä½ ä¸€ä¸ªæŒ‰ <strong>éé€’å‡é¡ºåº</strong> æ’åºçš„æ•´æ•°æ•°ç»„ <code>nums</code>ï¼Œè¿”å› <strong>æ¯ä¸ªæ•°å­—çš„å¹³æ–¹</strong> ç»„æˆçš„æ–°æ•°ç»„ï¼Œè¦æ±‚ä¹ŸæŒ‰ <strong>éé€’å‡é¡ºåº</strong> æ’åºã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution977</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span>[] sortedSquares(<span class="type">int</span>[] nums)&#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> nums.length;</span><br><span class="line">        <span class="type">int</span>[] ans = <span class="keyword">new</span> <span class="title class_">int</span>[n];</span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span><span class="number">0</span>,j=n-<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">p</span> <span class="operator">=</span>n-<span class="number">1</span>;p&gt;=<span class="number">0</span>;p--)&#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">x</span> <span class="operator">=</span> nums[i]* nums[i];</span><br><span class="line">            <span class="type">int</span> <span class="variable">y</span> <span class="operator">=</span> nums[j]*nums[j];</span><br><span class="line">            <span class="keyword">if</span> (x&gt;y)&#123;</span><br><span class="line">                ans[p] = x;</span><br><span class="line">                i++;</span><br><span class="line">            &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                ans[p] = y;</span><br><span class="line">                j--;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç®€å•çš„åŒæŒ‡é’ˆï¼Œä»åé¢å¼€å§‹éå†ï¼Œå¤§çš„å°±ç•™ä¸‹ï¼Œç„¶åæŒ‡é’ˆç§»åŠ¨</p><p>æœ€åè¿”å›ansæ•°ç»„</p><h2 id="658-æ‰¾åˆ°-K-ä¸ªæœ€æ¥è¿‘çš„å…ƒç´ "><a href="#658-æ‰¾åˆ°-K-ä¸ªæœ€æ¥è¿‘çš„å…ƒç´ " class="headerlink" title="658. æ‰¾åˆ° K ä¸ªæœ€æ¥è¿‘çš„å…ƒç´ "></a><a href="https://leetcode.cn/problems/find-k-closest-elements/">658. æ‰¾åˆ° K ä¸ªæœ€æ¥è¿‘çš„å…ƒç´ </a></h2><p>ç»™å®šä¸€ä¸ª <strong>æ’åºå¥½</strong> çš„æ•°ç»„ <code>arr</code> ï¼Œä¸¤ä¸ªæ•´æ•° <code>k</code> å’Œ <code>x</code> ï¼Œä»æ•°ç»„ä¸­æ‰¾åˆ°æœ€é è¿‘ <code>x</code>ï¼ˆä¸¤æ•°ä¹‹å·®æœ€å°ï¼‰çš„ <code>k</code> ä¸ªæ•°ã€‚è¿”å›çš„ç»“æœå¿…é¡»è¦æ˜¯æŒ‰å‡åºæ’å¥½çš„ã€‚</p><p>æ•´æ•° <code>a</code> æ¯”æ•´æ•° <code>b</code> æ›´æ¥è¿‘ <code>x</code> éœ€è¦æ»¡è¶³ï¼š</p><ul><li><code>|a - x| &lt; |b - x|</code> æˆ–è€…</li><li><code>|a - x| == |b - x|</code> ä¸” <code>a &lt; b</code></li></ul><p>äºŒåˆ†å†™æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution658B</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> List&lt;Integer&gt; <span class="title function_">findClosestElements</span><span class="params">(<span class="type">int</span>[] arr, <span class="type">int</span> k, <span class="type">int</span> x)</span>&#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> arr.length;</span><br><span class="line">        List&lt;Integer&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="type">int</span> <span class="variable">left</span> <span class="operator">=</span> <span class="number">0</span>,right = n-k;</span><br><span class="line">        <span class="keyword">while</span> (left&lt;=right)&#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">mid</span> <span class="operator">=</span> (left+right)&gt;&gt;&gt;<span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span> (mid+k&lt;n&amp;&amp;x-arr[mid]&gt;arr[mid+k]-x)&#123;</span><br><span class="line">                left = mid+<span class="number">1</span>;</span><br><span class="line">            &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                right = mid-<span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span>left;i&lt;left+k;i++)&#123;</span><br><span class="line">            list.add(arr[i]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> list;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åŒæŒ‡é’ˆå†™æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution658B</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> List&lt;Integer&gt; <span class="title function_">findClosestElementsA</span><span class="params">(<span class="type">int</span>[] arr, <span class="type">int</span> k, <span class="type">int</span> x)</span>&#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> arr.length;</span><br><span class="line">        List&lt;Integer&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="type">int</span> <span class="variable">left</span> <span class="operator">=</span> <span class="number">0</span>,right = n-k;</span><br><span class="line">        <span class="keyword">while</span> (left&lt;=right)&#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">mid</span> <span class="operator">=</span> (left+right)&gt;&gt;&gt;<span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span> (mid+k&lt;n&amp;&amp;x-arr[mid]&gt;arr[mid+k]-x)&#123;</span><br><span class="line">                left = mid+<span class="number">1</span>;</span><br><span class="line">            &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                right = mid-<span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span>left;i&lt;left+k;i++)&#123;</span><br><span class="line">            list.add(arr[i]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> list;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> List&lt;Integer&gt; <span class="title function_">findClosestElements</span><span class="params">(<span class="type">int</span>[] arr, <span class="type">int</span> k, <span class="type">int</span> x)</span>&#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> arr.length;</span><br><span class="line">        List&lt;Integer&gt; list = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="type">int</span> <span class="variable">left</span> <span class="operator">=</span> <span class="number">0</span>,right = n-<span class="number">1</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">del</span>  <span class="operator">=</span> n-k;</span><br><span class="line">        <span class="keyword">while</span> (del&gt;<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span> (x-arr[left]&gt;arr[right]-x)&#123;</span><br><span class="line">                left++;</span><br><span class="line">            &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                right--;</span><br><span class="line">            &#125;</span><br><span class="line">            del--;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span>left;i&lt;left+k;i++)&#123;</span><br><span class="line">            list.add(arr[i]);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> list;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…¶å®å¤§åŒå°å¼‚å“ˆå•Š</p><h2 id="1471-æ•°ç»„ä¸­çš„-k-ä¸ªæœ€å¼ºå€¼"><a href="#1471-æ•°ç»„ä¸­çš„-k-ä¸ªæœ€å¼ºå€¼" class="headerlink" title="1471. æ•°ç»„ä¸­çš„ k ä¸ªæœ€å¼ºå€¼"></a><a href="https://leetcode.cn/problems/the-k-strongest-values-in-an-array/">1471. æ•°ç»„ä¸­çš„ k ä¸ªæœ€å¼ºå€¼</a></h2><p>ç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„ <code>arr</code> å’Œä¸€ä¸ªæ•´æ•° <code>k</code> ã€‚</p><p>è®¾ <code>m</code> ä¸ºæ•°ç»„çš„ä¸­ä½æ•°ï¼Œåªè¦æ»¡è¶³ä¸‹è¿°ä¸¤ä¸ªå‰æä¹‹ä¸€ï¼Œå°±å¯ä»¥åˆ¤å®š <code>arr[i]</code> çš„å€¼æ¯” <code>arr[j]</code> çš„å€¼æ›´å¼ºï¼š</p><ul><li><code>|arr[i] - m| &gt; |arr[j] - m|</code></li><li><code>|arr[i] - m| == |arr[j] - m|</code>ï¼Œä¸” <code>arr[i] &gt; arr[j]</code></li></ul><p>è¯·è¿”å›ç”±æ•°ç»„ä¸­æœ€å¼ºçš„ <code>k</code> ä¸ªå€¼ç»„æˆçš„åˆ—è¡¨ã€‚ç­”æ¡ˆå¯ä»¥ä»¥ <strong>ä»»æ„é¡ºåº</strong> è¿”å›ã€‚</p><p><strong>ä¸­ä½æ•°</strong> æ˜¯ä¸€ä¸ªæœ‰åºæ•´æ•°åˆ—è¡¨ä¸­å¤„äºä¸­é—´ä½ç½®çš„å€¼ã€‚å½¢å¼ä¸Šï¼Œå¦‚æœåˆ—è¡¨çš„é•¿åº¦ä¸º <code>n</code> ï¼Œé‚£ä¹ˆä¸­ä½æ•°å°±æ˜¯è¯¥æœ‰åºåˆ—è¡¨ï¼ˆä¸‹æ ‡ä» 0 å¼€å§‹ï¼‰ä¸­ä½äº <code>((n - 1) / 2)</code> çš„å…ƒç´ ã€‚</p><ul><li>ä¾‹å¦‚ <code>arr = [6, -3, 7, 2, 11]</code>ï¼Œ<code>n = 5</code>ï¼šæ•°ç»„æ’åºåå¾—åˆ° <code>arr = [-3, 2, 6, 7, 11]</code> ï¼Œæ•°ç»„çš„ä¸­é—´ä½ç½®ä¸º <code>m = ((5 - 1) / 2) = 2</code> ï¼Œä¸­ä½æ•° <code>arr[m]</code> çš„å€¼ä¸º <code>6</code> ã€‚</li><li>ä¾‹å¦‚ <code>arr = [-7, 22, 17,â€‰3]</code>ï¼Œ<code>n = 4</code>ï¼šæ•°ç»„æ’åºåå¾—åˆ° <code>arr = [-7, 3, 17, 22]</code> ï¼Œæ•°ç»„çš„ä¸­é—´ä½ç½®ä¸º <code>m = ((4 - 1) / 2) = 1</code> ï¼Œä¸­ä½æ•° <code>arr[m]</code> çš„å€¼ä¸º <code>3</code> ã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution1471</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span>[] getStrongest(<span class="type">int</span>[] arr, <span class="type">int</span> k)&#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">n</span>  <span class="operator">=</span> arr.length;</span><br><span class="line">        Arrays.sort(arr);</span><br><span class="line">       <span class="type">int</span> <span class="variable">m</span> <span class="operator">=</span> arr[(n-<span class="number">1</span>)/<span class="number">2</span>];</span><br><span class="line">       <span class="type">int</span> <span class="variable">left</span> <span class="operator">=</span> <span class="number">0</span>,right = n-<span class="number">1</span>;</span><br><span class="line">       <span class="type">int</span>[] ans = <span class="keyword">new</span> <span class="title class_">int</span>[k];</span><br><span class="line">      <span class="keyword">while</span> (k--&gt;<span class="number">0</span>)&#123;</span><br><span class="line">           <span class="keyword">if</span> (m-arr[left]&gt;=arr[right]-m)&#123;</span><br><span class="line">               ans[k] = arr[left++];</span><br><span class="line">           &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">               ans[k] = arr[right--];</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨åŒæŒ‡é’ˆ</p><p>å¦‚æœæ¯”è¾ƒä»–ä»¬è°æ›´å¼ºåŠ›ï¼Œå°±åŠ å…¥åˆ°æ•°ç»„ä¹‹ä¸­ã€‚ç„¶åæŒ‡é’ˆç§»åŠ¨</p><h2 id="167-ä¸¤æ•°ä¹‹å’Œ-II-è¾“å…¥æœ‰åºæ•°ç»„"><a href="#167-ä¸¤æ•°ä¹‹å’Œ-II-è¾“å…¥æœ‰åºæ•°ç»„" class="headerlink" title="167. ä¸¤æ•°ä¹‹å’Œ II - è¾“å…¥æœ‰åºæ•°ç»„"></a><a href="https://leetcode.cn/problems/two-sum-ii-input-array-is-sorted/">167. ä¸¤æ•°ä¹‹å’Œ II - è¾“å…¥æœ‰åºæ•°ç»„</a></h2><p>ç»™ä½ ä¸€ä¸ªä¸‹æ ‡ä» <strong>1</strong> å¼€å§‹çš„æ•´æ•°æ•°ç»„ <code>numbers</code> ï¼Œè¯¥æ•°ç»„å·²æŒ‰ <strong>éé€’å‡é¡ºåºæ’åˆ—</strong> ï¼Œè¯·ä½ ä»æ•°ç»„ä¸­æ‰¾å‡ºæ»¡è¶³ç›¸åŠ ä¹‹å’Œç­‰äºç›®æ ‡æ•° <code>target</code> çš„ä¸¤ä¸ªæ•°ã€‚å¦‚æœè®¾è¿™ä¸¤ä¸ªæ•°åˆ†åˆ«æ˜¯ <code>numbers[index1]</code> å’Œ <code>numbers[index2]</code> ï¼Œåˆ™ <code>1 &lt;= index1 &lt; index2 &lt;= numbers.length</code> ã€‚</p><p>ä»¥é•¿åº¦ä¸º 2 çš„æ•´æ•°æ•°ç»„ <code>[index1, index2]</code> çš„å½¢å¼è¿”å›è¿™ä¸¤ä¸ªæ•´æ•°çš„ä¸‹æ ‡ <code>index1</code> å’Œ <code>index2</code>ã€‚</p><p>ä½ å¯ä»¥å‡è®¾æ¯ä¸ªè¾“å…¥ <strong>åªå¯¹åº”å”¯ä¸€çš„ç­”æ¡ˆ</strong> ï¼Œè€Œä¸”ä½  <strong>ä¸å¯ä»¥</strong> é‡å¤ä½¿ç”¨ç›¸åŒçš„å…ƒç´ ã€‚</p><p>ä½ æ‰€è®¾è®¡çš„è§£å†³æ–¹æ¡ˆå¿…é¡»åªä½¿ç”¨å¸¸é‡çº§çš„é¢å¤–ç©ºé—´ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution167</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span>[] twoSum(<span class="type">int</span>[] numbers, <span class="type">int</span> target)&#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">left</span> <span class="operator">=</span> <span class="number">0</span>,right = numbers.length-<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span> (<span class="literal">true</span>)&#123;</span><br><span class="line">            <span class="type">int</span> s= numbers[left]+numbers[right];</span><br><span class="line">            <span class="keyword">if</span> (s==target)&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">int</span>[]&#123;left+<span class="number">1</span>,right+<span class="number">1</span>&#125;;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (s&gt;target)&#123;</span><br><span class="line">                right--;</span><br><span class="line">            &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                left++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç®€å•çš„åŒæŒ‡é’ˆæŸ¥æ‰¾ï¼Œä½†æ˜¯æ³¨æ„ä¸€ä¸ªä¸‹æ ‡ä» <strong>1</strong> å¼€å§‹çš„æ•´æ•°æ•°ç»„ <code>numbers</code></p><p>æ‰€ä»¥è¿”å›çš„æ—¶å€™è¿”å›çš„å¼{left+1,right+1}</p><h2 id="2824-ç»Ÿè®¡å’Œå°äºç›®æ ‡çš„ä¸‹æ ‡å¯¹æ•°ç›®"><a href="#2824-ç»Ÿè®¡å’Œå°äºç›®æ ‡çš„ä¸‹æ ‡å¯¹æ•°ç›®" class="headerlink" title="2824. ç»Ÿè®¡å’Œå°äºç›®æ ‡çš„ä¸‹æ ‡å¯¹æ•°ç›®"></a><a href="https://leetcode.cn/problems/count-pairs-whose-sum-is-less-than-target/">2824. ç»Ÿè®¡å’Œå°äºç›®æ ‡çš„ä¸‹æ ‡å¯¹æ•°ç›®</a></h2><p>ç»™ä½ ä¸€ä¸ªä¸‹æ ‡ä» <strong>0</strong> å¼€å§‹é•¿åº¦ä¸º <code>n</code> çš„æ•´æ•°æ•°ç»„ <code>nums</code> å’Œä¸€ä¸ªæ•´æ•° <code>target</code> ï¼Œè¯·ä½ è¿”å›æ»¡è¶³ <code>0 &lt;= i &lt; j &lt; n</code> ä¸” <code>nums[i] + nums[j] &lt; target</code> çš„ä¸‹æ ‡å¯¹ <code>(i, j)</code> çš„æ•°ç›®ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution2824</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">countPairs</span><span class="params">(List&lt;Integer&gt; nums, <span class="type">int</span> target)</span>&#123;</span><br><span class="line">        Collections.sort(nums);</span><br><span class="line">        <span class="type">int</span> <span class="variable">ans</span> <span class="operator">=</span> <span class="number">0</span>,left = <span class="number">0</span>,right = nums.size()-<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span> (left&lt;right)&#123;</span><br><span class="line">            <span class="keyword">if</span> (nums.get(left)+nums.get(right)&lt;target)&#123;</span><br><span class="line">                ans +=right-left;</span><br><span class="line">                left++;</span><br><span class="line">            &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                right--;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å› ä¸ºå¼çœ‹åˆ°ä¸¤ä¸ªijå°±æƒ³åˆ°äº†åŒæŒ‡é’ˆï¼Œç„¶ååˆ¤æ–­æ˜¯ä¸æ˜¯å’Œå°äºtargetå°±è¡Œäº†</p><p>ç»Ÿè®¡å°äºçš„æ•°ç›®ï¼Œå› ä¸ºæ˜¯(i,j)çš„æ•°ç›®ï¼Œå°±æ˜¯right-left</p><p>ç„¶åå­˜å‚¨åˆ°ansä¸­ï¼Œå¦‚æœå¤§äº†å°±rightâ€”;</p><h2 id="LCP-28-é‡‡è´­æ–¹æ¡ˆ"><a href="#LCP-28-é‡‡è´­æ–¹æ¡ˆ" class="headerlink" title="LCP 28. é‡‡è´­æ–¹æ¡ˆ"></a><a href="https://leetcode.cn/problems/4xy4Wx/">LCP 28. é‡‡è´­æ–¹æ¡ˆ</a></h2><p>å°åŠ›å°† N ä¸ªé›¶ä»¶çš„æŠ¥ä»·å­˜äºæ•°ç»„ <code>nums</code>ã€‚å°åŠ›é¢„ç®—ä¸º <code>target</code>ï¼Œå‡å®šå°åŠ›ä»…è´­ä¹°ä¸¤ä¸ªé›¶ä»¶ï¼Œè¦æ±‚è´­ä¹°é›¶ä»¶çš„èŠ±è´¹ä¸è¶…è¿‡é¢„ç®—ï¼Œè¯·é—®ä»–æœ‰å¤šå°‘ç§é‡‡è´­æ–¹æ¡ˆã€‚</p><p>æ³¨æ„ï¼šç­”æ¡ˆéœ€è¦ä»¥ <code>1e9 + 7 (1000000007)</code> ä¸ºåº•å–æ¨¡ï¼Œå¦‚ï¼šè®¡ç®—åˆå§‹ç»“æœä¸ºï¼š<code>1000000008</code>ï¼Œè¯·è¿”å› <code>1</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solutionlcp28</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">purchasePlans</span><span class="params">(<span class="type">int</span>[] nums, <span class="type">int</span> target)</span>&#123;</span><br><span class="line">        Arrays.sort(nums);</span><br><span class="line">        <span class="type">int</span> <span class="variable">ans</span> <span class="operator">=</span> <span class="number">0</span>,left = <span class="number">0</span>,right = nums.length-<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span> (left&lt;right)&#123;</span><br><span class="line">            <span class="keyword">if</span> (nums[left]+nums[right]&lt;target)&#123;</span><br><span class="line">                ans +=right-left;</span><br><span class="line">                left++;</span><br><span class="line">            &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                right--;</span><br><span class="line">            &#125;</span><br><span class="line">            ans %=<span class="number">1_000_000_007</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åŒä¸Šï¼Œåªä¸è¿‡è¦å…ˆmodä¹‹åå†åŠ å…¥ansæ€»çš„ï¼Œè¦ä¸ç„¶æ•°å¤ªå¤§ä¼šæŠ¥é”™</p><h2 id="1616-åˆ†å‰²ä¸¤ä¸ªå­—ç¬¦ä¸²å¾—åˆ°å›æ–‡ä¸²"><a href="#1616-åˆ†å‰²ä¸¤ä¸ªå­—ç¬¦ä¸²å¾—åˆ°å›æ–‡ä¸²" class="headerlink" title="1616. åˆ†å‰²ä¸¤ä¸ªå­—ç¬¦ä¸²å¾—åˆ°å›æ–‡ä¸²"></a><a href="https://leetcode.cn/problems/split-two-strings-to-make-palindrome/">1616. åˆ†å‰²ä¸¤ä¸ªå­—ç¬¦ä¸²å¾—åˆ°å›æ–‡ä¸²</a></h2><p>ç»™ä½ ä¸¤ä¸ªå­—ç¬¦ä¸² <code>a</code> å’Œ <code>b</code> ï¼Œå®ƒä»¬é•¿åº¦ç›¸åŒã€‚è¯·ä½ é€‰æ‹©ä¸€ä¸ªä¸‹æ ‡ï¼Œå°†ä¸¤ä¸ªå­—ç¬¦ä¸²éƒ½åœ¨ <strong>ç›¸åŒçš„ä¸‹æ ‡</strong> åˆ†å‰²å¼€ã€‚ç”± <code>a</code> å¯ä»¥å¾—åˆ°ä¸¤ä¸ªå­—ç¬¦ä¸²ï¼š <code>aprefix</code> å’Œ <code>asuffix</code> ï¼Œæ»¡è¶³ <code>a = aprefix + asuffix</code> ï¼ŒåŒç†ï¼Œç”± <code>b</code> å¯ä»¥å¾—åˆ°ä¸¤ä¸ªå­—ç¬¦ä¸² <code>bprefix</code> å’Œ <code>bsuffix</code> ï¼Œæ»¡è¶³ <code>b = bprefix + bsuffix</code> ã€‚è¯·ä½ åˆ¤æ–­ <code>aprefix + bsuffix</code> æˆ–è€… <code>bprefix + asuffix</code> èƒ½å¦æ„æˆå›æ–‡ä¸²ã€‚</p><p>å½“ä½ å°†ä¸€ä¸ªå­—ç¬¦ä¸² <code>s</code> åˆ†å‰²æˆ <code>sprefix</code> å’Œ <code>ssuffix</code> æ—¶ï¼Œ <code>ssuffix</code> æˆ–è€… <code>sprefix</code> å¯ä»¥ä¸ºç©ºã€‚æ¯”æ–¹è¯´ï¼Œ <code>s = &quot;abc&quot;</code> é‚£ä¹ˆ <code>&quot;&quot; + &quot;abc&quot;</code> ï¼Œ <code>&quot;a&quot; + &quot;bc&quot;</code>ï¼Œ <code>&quot;ab&quot; + &quot;c&quot;</code> å’Œ <code>&quot;abc&quot; + &quot;&quot;</code> éƒ½æ˜¯åˆæ³•åˆ†å‰²ã€‚</p><p>å¦‚æœ <strong>èƒ½æ„æˆå›æ–‡å­—ç¬¦ä¸²</strong> ï¼Œé‚£ä¹ˆè¯·è¿”å› <code>true</code>ï¼Œå¦åˆ™è¿”å› <code>false</code> ã€‚</p><p><strong>æ³¨æ„</strong>ï¼Œ <code>x + y</code> è¡¨ç¤ºè¿æ¥å­—ç¬¦ä¸² <code>x</code> å’Œ <code>y</code> ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution1616</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">isPalindrome</span><span class="params">(String s, <span class="type">int</span> i, <span class="type">int</span> j)</span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (i&lt;j&amp;&amp;s.charAt(i)==s.charAt(j))&#123;</span><br><span class="line">            ++i;</span><br><span class="line">            --j;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> i&gt;=j;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">check</span><span class="params">(String a, String b)</span>&#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span><span class="number">0</span>,j=a.length()-<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span> (i&lt;j&amp;&amp;a.charAt(i)==b.charAt(j))&#123;</span><br><span class="line">            ++i;</span><br><span class="line">            --j;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> isPalindrome(a,i,j)||isPalindrome(b,i,j);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">checkPalindromeFormation</span><span class="params">(String a, String b)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> check(a,b)||check(b,a);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆ¤æ–­æ˜¯ä¸æ˜¯å›æ–‡çš„æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">isPalindrome</span><span class="params">(String s, <span class="type">int</span> i, <span class="type">int</span> j)</span>&#123;</span><br><span class="line">    <span class="keyword">while</span> (i &lt; j &amp;&amp; s.charAt(i) == s.charAt(j))&#123;</span><br><span class="line">        ++i;</span><br><span class="line">        --j;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> i &gt;= j;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å¦‚æœ <code>i &gt;= j</code>ï¼Œè¯´æ˜æ˜¯å›æ–‡ã€‚</p><p>ç„¶ååˆ¤æ–­a,bæ˜¯å¦èƒ½è¿æˆä¸€ä¸ªå›æ–‡</p><p>ä¸€æ—¦ä¸ç›¸ç­‰ï¼Œå°±è¯´æ˜è¿›å…¥ä¸­é—´çš„éƒ¨åˆ†äº†ï¼Œå°è¯•æ£€æŸ¥å‰©ä½™éƒ¨åˆ†æ˜¯å¦æ˜¯å›æ–‡ï¼ˆå³ <code>a[i..j]</code> æˆ– <code>b[i..j]</code>ï¼‰ï¼›</p><p>ä¸ºå¯ä»¥é€‰æ‹© <code>a+b</code> æˆ– <code>b+a</code> ä¸¤ç§æ‹¼æ¥æ–¹å¼ï¼Œå› æ­¤ä¸»å‡½æ•°é‡Œåˆ¤æ–­äº† <code>check(a, b)</code> å’Œ <code>check(b, a)</code> ä¸¤ç§æƒ…å†µã€‚</p><h2 id="905-æŒ‰å¥‡å¶æ’åºæ•°ç»„"><a href="#905-æŒ‰å¥‡å¶æ’åºæ•°ç»„" class="headerlink" title="905. æŒ‰å¥‡å¶æ’åºæ•°ç»„"></a><a href="https://leetcode.cn/problems/sort-array-by-parity/">905. æŒ‰å¥‡å¶æ’åºæ•°ç»„</a></h2><p>ç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„ <code>nums</code>ï¼Œå°† <code>nums</code> ä¸­çš„çš„æ‰€æœ‰å¶æ•°å…ƒç´ ç§»åŠ¨åˆ°æ•°ç»„çš„å‰é¢ï¼Œåè·Ÿæ‰€æœ‰å¥‡æ•°å…ƒç´ ã€‚</p><p>è¿”å›æ»¡è¶³æ­¤æ¡ä»¶çš„ <strong>ä»»ä¸€æ•°ç»„</strong> ä½œä¸ºç­”æ¡ˆã€‚</p><p>ä½¿ç”¨åŒæŒ‡é’ˆï¼Œäº¤æ¢æœ€å·¦è¾¹çš„å¥‡æ•°å’Œæœ€å³è¾¹çš„å¶æ•°</p><p>ç„¶åé‡å¤è¿™ä¸ªè¿‡ç¨‹</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution905</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span>[] sortArrayByParity(<span class="type">int</span>[] nums)&#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span><span class="number">0</span>,j=nums.length-<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span> (i&lt;j)&#123;</span><br><span class="line">            <span class="keyword">if</span> (nums[i]%<span class="number">2</span>==<span class="number">0</span>)&#123;</span><br><span class="line">                i++;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (nums[j]%<span class="number">2</span>==<span class="number">1</span>)&#123;</span><br><span class="line">                j--;</span><br><span class="line">            &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="type">int</span> <span class="variable">tmp</span> <span class="operator">=</span> nums[i];</span><br><span class="line">                nums[i] = nums[j];</span><br><span class="line">                nums[j] = tmp;</span><br><span class="line">                i++;</span><br><span class="line">                j--;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> nums;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><a href="https://leetcode.cn/problems/sort-array-by-parity-ii/">922. æŒ‰å¥‡å¶æ’åºæ•°ç»„ II</a></p><p>ç»™å®šä¸€ä¸ªéè´Ÿæ•´æ•°æ•°ç»„ <code>nums</code>ï¼Œ <code>nums</code> ä¸­ä¸€åŠæ•´æ•°æ˜¯ <strong>å¥‡æ•°</strong> ï¼Œä¸€åŠæ•´æ•°æ˜¯ <strong>å¶æ•°</strong> ã€‚</p><p>å¯¹æ•°ç»„è¿›è¡Œæ’åºï¼Œä»¥ä¾¿å½“ <code>nums[i]</code> ä¸ºå¥‡æ•°æ—¶ï¼Œ<code>i</code> ä¹Ÿæ˜¯ <strong>å¥‡æ•°</strong> ï¼›å½“ <code>nums[i]</code> ä¸ºå¶æ•°æ—¶ï¼Œ <code>i</code> ä¹Ÿæ˜¯ <strong>å¶æ•°</strong> ã€‚</p><p>ä½ å¯ä»¥è¿”å› <em>ä»»ä½•æ»¡è¶³ä¸Šè¿°æ¡ä»¶çš„æ•°ç»„ä½œä¸ºç­”æ¡ˆ</em> ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution922</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span>[] sortArrayByParityII(<span class="type">int</span>[] nums)&#123;</span><br><span class="line">        <span class="type">int</span> i=<span class="number">0</span>;<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span><span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span> (i&lt;nums.length)&#123;</span><br><span class="line">            <span class="keyword">if</span> (nums[i]%<span class="number">2</span>==<span class="number">0</span>)&#123;</span><br><span class="line">                i +=<span class="number">2</span>;</span><br><span class="line">            &#125;<span class="keyword">else</span> <span class="keyword">if</span> (nums[j]%<span class="number">2</span>==<span class="number">1</span>)&#123;</span><br><span class="line">                j +=<span class="number">2</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="type">int</span> <span class="variable">tmp</span> <span class="operator">=</span> nums[i];</span><br><span class="line">                nums[i] = nums[j];</span><br><span class="line">                nums[j] = tmp;</span><br><span class="line">                i +=<span class="number">2</span>;</span><br><span class="line">                j+=<span class="number">2</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> nums;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è·Ÿä¸Šé¢ç›¸åŒï¼Œåªä¸è¿‡æ˜¯è·³ç€æ¥çš„</p><h1 id="åŒå‘åŒæŒ‡é’ˆ"><a href="#åŒå‘åŒæŒ‡é’ˆ" class="headerlink" title="åŒå‘åŒæŒ‡é’ˆ"></a>åŒå‘åŒæŒ‡é’ˆ</h1><p>ä¸¤ä¸ªæŒ‡é’ˆçš„ç§»åŠ¨æ–¹å‘ç›¸åŒï¼ˆéƒ½å‘å³ï¼Œæˆ–è€…éƒ½å‘å·¦ï¼‰ã€‚</p><h2 id="611-æœ‰æ•ˆä¸‰è§’å½¢çš„ä¸ªæ•°"><a href="#611-æœ‰æ•ˆä¸‰è§’å½¢çš„ä¸ªæ•°" class="headerlink" title="611. æœ‰æ•ˆä¸‰è§’å½¢çš„ä¸ªæ•°"></a><a href="https://leetcode.cn/problems/valid-triangle-number/">611. æœ‰æ•ˆä¸‰è§’å½¢çš„ä¸ªæ•°</a></h2><p>ç»™å®šä¸€ä¸ªåŒ…å«éè´Ÿæ•´æ•°çš„æ•°ç»„ <code>nums</code> ï¼Œè¿”å›å…¶ä¸­å¯ä»¥ç»„æˆä¸‰è§’å½¢ä¸‰æ¡è¾¹çš„ä¸‰å…ƒç»„ä¸ªæ•°ã€‚</p><p>è¿™é‡Œæ˜¯éå†ï¼Œåº”ç”¨çš„è§„åˆ™æ˜¯ä¸¤è¾¹ä¹‹å’Œå¤§äºç¬¬ä¸‰è¾¹</p><p>a+b&gt;c</p><p>ä¹Ÿå°±æ˜¯è¯´c-a&lt;b</p><p>ç„¶åcæ˜¯å¤§çš„ï¼Œaæ˜¯å°çš„ï¼Œçš„è¯</p><p>a=num[i]çš„è¯ï¼Œc=i+2,b=i+1</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution611</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">triangleNumber</span><span class="params">(<span class="type">int</span>[] nums)</span>&#123;</span><br><span class="line">        Arrays.sort(nums);</span><br><span class="line">        <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> nums.length;</span><br><span class="line">        <span class="type">int</span> ans=  <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span><span class="number">0</span>;i&lt;n;i++)&#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">a</span> <span class="operator">=</span> nums[i];</span><br><span class="line">            <span class="keyword">if</span> (a==<span class="number">0</span>)&#123;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> i+<span class="number">1</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> k=i+<span class="number">2</span>;k&lt;n;k++)&#123;</span><br><span class="line">                <span class="keyword">while</span> (nums[k]-nums[j]&gt;=a)&#123;</span><br><span class="line">                    j++;</span><br><span class="line">                &#125;</span><br><span class="line">                ans +=k-j;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åé€ä¸ªéå†å³å¯</p><p>ç„¶åå½“å¤§äºäº†ä¹Ÿå°±è¯´å½“å‰çš„bå¤ªå°äº†ï¼Œj++</p><p>æœ€åçš„æ•°ç›®æ˜¯c-b</p><h2 id="581-æœ€çŸ­æ— åºè¿ç»­å­æ•°ç»„"><a href="#581-æœ€çŸ­æ— åºè¿ç»­å­æ•°ç»„" class="headerlink" title="581. æœ€çŸ­æ— åºè¿ç»­å­æ•°ç»„"></a><a href="https://leetcode.cn/problems/shortest-unsorted-continuous-subarray/">581. æœ€çŸ­æ— åºè¿ç»­å­æ•°ç»„</a></h2><p>ä¸ªæ•´æ•°æ•°ç»„ <code>nums</code> ï¼Œä½ éœ€è¦æ‰¾å‡ºä¸€ä¸ª <strong>è¿ç»­å­æ•°ç»„</strong> ï¼Œå¦‚æœå¯¹è¿™ä¸ªå­æ•°ç»„è¿›è¡Œå‡åºæ’åºï¼Œé‚£ä¹ˆæ•´ä¸ªæ•°ç»„éƒ½ä¼šå˜ä¸ºå‡åºæ’åºã€‚</p><p>è¯·ä½ æ‰¾å‡ºç¬¦åˆé¢˜æ„çš„ <strong>æœ€çŸ­</strong> å­æ•°ç»„ï¼Œå¹¶è¾“å‡ºå®ƒçš„é•¿åº¦ã€‚</p><p>å¦‚æœè¿›å…¥äº†å³æ®µï¼Œå°±æ²¡æœ‰æ¯”æœ€å¤§å€¼å°çš„æ•°ï¼Œæ‰€ä»¥æœ€åä¸€ä¸ªæ¯”æœ€å¤§å€¼å°çš„æ•°å°±æ˜¯ä¸­æ®µçš„å³è¾¹ç•Œï¼ŒåŒç†ï¼Œå¦‚æœè¿›å…¥å·¦æ®µï¼Œå°±ä¸ä¼šå‡ºç°æ¯”æœ€å°å€¼æ›´å¤§çš„æƒ…å†µï¼Œæ‰€ä»¥æœ€åä¸€ä¸ªå‡ºç°å°±è§†ä¸ºä¸­æ®µå·¦è¾¹ç•Œ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">findUnsortedSubarray</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> nums.length;</span><br><span class="line">        <span class="type">int</span> <span class="variable">max</span> <span class="operator">=</span> Integer.MIN_VALUE;</span><br><span class="line">        <span class="type">int</span> <span class="variable">min</span> <span class="operator">=</span> Integer.MAX_VALUE;</span><br><span class="line">        <span class="type">int</span> <span class="variable">left</span> <span class="operator">=</span> -<span class="number">1</span>, right = -<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ä»å·¦å¾€å³æ‰¾å³è¾¹ç•Œ</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (nums[i] &gt;= max) &#123;</span><br><span class="line">                max = nums[i];</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                right = i; <span class="comment">// å½“å‰å€¼å°äº maxï¼Œè¯´æ˜ä¹±åº</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ä»å³å¾€å·¦æ‰¾å·¦è¾¹ç•Œ</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> n - <span class="number">1</span>; i &gt;= <span class="number">0</span>; i--) &#123;</span><br><span class="line">            <span class="keyword">if</span> (nums[i] &lt;= min) &#123;</span><br><span class="line">                min = nums[i];</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                left = i; <span class="comment">// å½“å‰å€¼å¤§äº minï¼Œè¯´æ˜ä¹±åº</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> right == -<span class="number">1</span> ? <span class="number">0</span> : right - left + <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="1574-åˆ é™¤æœ€çŸ­çš„å­æ•°ç»„ä½¿å‰©ä½™æ•°ç»„æœ‰åº"><a href="#1574-åˆ é™¤æœ€çŸ­çš„å­æ•°ç»„ä½¿å‰©ä½™æ•°ç»„æœ‰åº" class="headerlink" title="1574. åˆ é™¤æœ€çŸ­çš„å­æ•°ç»„ä½¿å‰©ä½™æ•°ç»„æœ‰åº"></a><a href="https://leetcode.cn/problems/shortest-subarray-to-be-removed-to-make-array-sorted/">1574. åˆ é™¤æœ€çŸ­çš„å­æ•°ç»„ä½¿å‰©ä½™æ•°ç»„æœ‰åº</a></h2><p>ç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„ <code>arr</code> ï¼Œè¯·ä½ åˆ é™¤ä¸€ä¸ªå­æ•°ç»„ï¼ˆå¯ä»¥ä¸ºç©ºï¼‰ï¼Œä½¿å¾— <code>arr</code> ä¸­å‰©ä¸‹çš„å…ƒç´ æ˜¯ <strong>éé€’å‡</strong> çš„ã€‚</p><p>ä¸€ä¸ªå­æ•°ç»„æŒ‡çš„æ˜¯åŸæ•°ç»„ä¸­è¿ç»­çš„ä¸€ä¸ªå­åºåˆ—ã€‚</p><p>è¯·ä½ è¿”å›æ»¡è¶³é¢˜ç›®è¦æ±‚çš„æœ€çŸ­å­æ•°ç»„çš„é•¿åº¦ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution1574</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">findLengthOfShortestSubarray</span><span class="params">(<span class="type">int</span>[] arr)</span>&#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">n</span>  <span class="operator">=</span>arr.length,right = n-<span class="number">1</span>;</span><br><span class="line">        <span class="comment">//æ‰¾åˆ°ç¬¬ä¸€ä¸ªä¸‹é™çš„ä½ç½®</span></span><br><span class="line">        <span class="keyword">while</span> (right&gt;<span class="number">0</span>&amp;&amp;arr[right-<span class="number">1</span>]&lt;=arr[right])&#123;</span><br><span class="line">            right--;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (right==<span class="number">0</span>) <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">ans</span> <span class="operator">=</span> right;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">left</span> <span class="operator">=</span> <span class="number">0</span>;left&lt;n ; ++left)&#123;</span><br><span class="line">            <span class="keyword">if</span> (left&gt;<span class="number">0</span>&amp;&amp;arr[left]&lt;arr[left-<span class="number">1</span>]) <span class="keyword">break</span>;<span class="comment">//ä¿è¯leftæ˜¯é€’å¢çš„</span></span><br><span class="line">            <span class="keyword">while</span> (right&lt;n&amp;&amp;arr[right]&lt;arr[left])&#123;</span><br><span class="line">                right++;<span class="comment">//æ‰¾åˆ°rightä¿è¯arr[left]&lt;=arr[right]</span></span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">//åˆ é™¤ arr[left+1..right-1] çš„é•¿åº¦ä¸º right - left - 1</span></span><br><span class="line">            ans = Math.min(ans,right-left-<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·çš„è¯0-leftæ˜¯å¢çš„ right-n-1æ˜¯å¢çš„</p><p>left-rightæ˜¯ arr[left]&lt;=arr[right]è¿™æ ·ä¿è¯ä»–ä»¬æ˜¯å¢çš„</p><p>åˆ é™¤ä¸­é—´çš„å°±æ˜¯ä¸€ä¸ªéé€’å‡çš„æ•°ç»„äº†</p><p>[left+1,right-1];</p><h1 id="èƒŒå‘åŒæŒ‡é’ˆ"><a href="#èƒŒå‘åŒæŒ‡é’ˆ" class="headerlink" title="èƒŒå‘åŒæŒ‡é’ˆ"></a>èƒŒå‘åŒæŒ‡é’ˆ</h1><h2 id="1793-å¥½å­æ•°ç»„çš„æœ€å¤§åˆ†æ•°"><a href="#1793-å¥½å­æ•°ç»„çš„æœ€å¤§åˆ†æ•°" class="headerlink" title="1793. å¥½å­æ•°ç»„çš„æœ€å¤§åˆ†æ•°"></a><a href="https://leetcode.cn/problems/maximum-score-of-a-good-subarray/">1793. å¥½å­æ•°ç»„çš„æœ€å¤§åˆ†æ•°</a></h2><p>ç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„ <code>nums</code> <strong>ï¼ˆä¸‹æ ‡ä» 0 å¼€å§‹ï¼‰</strong>å’Œä¸€ä¸ªæ•´æ•° <code>k</code> ã€‚</p><p>ä¸€ä¸ªå­æ•°ç»„ <code>(i, j)</code> çš„ <strong>åˆ†æ•°</strong> å®šä¹‰ä¸º <code>min(nums[i], nums[i+1], ..., nums[j]) * (j - i + 1)</code> ã€‚ä¸€ä¸ª <strong>å¥½</strong> å­æ•°ç»„çš„ä¸¤ä¸ªç«¯ç‚¹ä¸‹æ ‡éœ€è¦æ»¡è¶³ <code>i &lt;= k &lt;= j</code> ã€‚</p><p>è¯·ä½ è¿”å› <strong>å¥½</strong> å­æ•°ç»„çš„æœ€å¤§å¯èƒ½ <strong>åˆ†æ•°</strong> ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution1793</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">maximumScore</span><span class="params">(<span class="type">int</span>[] nums, <span class="type">int</span> k)</span>&#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">n</span>  <span class="operator">=</span> nums.length;</span><br><span class="line">        <span class="type">int</span> <span class="variable">ans</span> <span class="operator">=</span> nums[k],minH = nums[k];</span><br><span class="line">        <span class="type">int</span> i=k,j=k;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">t</span> <span class="operator">=</span> <span class="number">0</span>;t&lt;n-<span class="number">1</span>;t++)&#123;</span><br><span class="line">            <span class="keyword">if</span> (j==n-<span class="number">1</span>||i&gt;<span class="number">0</span>&amp;&amp;nums[i-<span class="number">1</span>]&gt;nums[j+<span class="number">1</span>])&#123;</span><br><span class="line">                minH = Math.min(minH,nums[--i]);</span><br><span class="line">            &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                minH = Math.min(minH,nums[++j]);</span><br><span class="line">            &#125;</span><br><span class="line">            ans = Math.max(ans,minH*(j-i+<span class="number">1</span>));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å°±æ˜¯iå’ŒjåŒæ—¶ä»kå‡ºå‘</p><p>â€”iå’Œ++j</p><p>æ¯”è¾ƒ <em>nums</em>[<em>i</em>âˆ’1] å’Œ <em>nums</em>[<em>j</em>+1] çš„å¤§å°ï¼Œè°å¤§å°±ç§»åŠ¨è°ï¼ˆä¸€æ ·å¤§ç§»åŠ¨å“ªä¸ªéƒ½å¯ä»¥ï¼‰ã€‚</p><blockquote><p>æŒ‰ç…§è¿™ç§ç§»åŠ¨æ–¹å¼ï¼Œä¸€å®šä¼šåœ¨æŸä¸ªæ—¶åˆ»æ°å¥½æ»¡è¶³ <em>i</em>=<em>L</em> ä¸” <em>j</em>=<em>R</em>ã€‚</p><p>å¦‚æœ i å…ˆåˆ°è¾¾ Lï¼Œé‚£ä¹ˆæ­¤æ—¶ j&lt;Rã€‚è®¾ L åˆ° R ä¹‹é—´çš„æœ€å°å…ƒç´ ä¸º mï¼Œåœ¨æ–¹æ³•ä¸€ä¸­æˆ‘ä»¬çŸ¥é“ nums[Lâˆ’1]&lt;mï¼Œç”±äº nums[iâˆ’1]=nums[Lâˆ’1]&lt;mâ‰¤nums[j+1]ï¼Œé‚£ä¹ˆåç»­ä¸€å®šæ˜¯ j ä¸€ç›´å‘å³ç§»åŠ¨åˆ° Rã€‚å¯¹äº j å…ˆåˆ°è¾¾ R çš„æƒ…å†µä¹ŸåŒç†ã€‚æ‰€ä»¥ä¸€å®šä¼šåœ¨æŸä¸ªæ—¶åˆ»æ°å¥½æ»¡è¶³ i=L ä¸” j=Rã€‚</p></blockquote><h1 id="åŸåœ°ä¿®æ”¹ï¼ˆæ ˆçš„æ€æƒ³ï¼‰"><a href="#åŸåœ°ä¿®æ”¹ï¼ˆæ ˆçš„æ€æƒ³ï¼‰" class="headerlink" title="åŸåœ°ä¿®æ”¹ï¼ˆæ ˆçš„æ€æƒ³ï¼‰"></a>åŸåœ°ä¿®æ”¹ï¼ˆæ ˆçš„æ€æƒ³ï¼‰</h1><p><a href="https://leetcode.cn/problems/remove-element/">27. ç§»é™¤å…ƒç´ </a></p><p>ç»™ä½ ä¸€ä¸ªæ•°ç»„ <code>nums</code> å’Œä¸€ä¸ªå€¼ <code>val</code>ï¼Œä½ éœ€è¦ <strong><a href="https://baike.baidu.com/item/åŸåœ°ç®—æ³•">åŸåœ°</a></strong> ç§»é™¤æ‰€æœ‰æ•°å€¼ç­‰äº <code>val</code> çš„å…ƒç´ ã€‚å…ƒç´ çš„é¡ºåºå¯èƒ½å‘ç”Ÿæ”¹å˜ã€‚ç„¶åè¿”å› <code>nums</code> ä¸­ä¸ <code>val</code> ä¸åŒçš„å…ƒç´ çš„æ•°é‡ã€‚</p><p>å‡è®¾ <code>nums</code> ä¸­ä¸ç­‰äº <code>val</code> çš„å…ƒç´ æ•°é‡ä¸º <code>k</code>ï¼Œè¦é€šè¿‡æ­¤é¢˜ï¼Œæ‚¨éœ€è¦æ‰§è¡Œä»¥ä¸‹æ“ä½œï¼š</p><ul><li>æ›´æ”¹ <code>nums</code> æ•°ç»„ï¼Œä½¿ <code>nums</code> çš„å‰ <code>k</code> ä¸ªå…ƒç´ åŒ…å«ä¸ç­‰äº <code>val</code> çš„å…ƒç´ ã€‚<code>nums</code> çš„å…¶ä½™å…ƒç´ å’Œ <code>nums</code> çš„å¤§å°å¹¶ä¸é‡è¦ã€‚</li><li>è¿”å› <code>k</code>ã€‚</li></ul><p><strong>æŠŠ <em>nums</em> è§†ä½œä¸€ä¸ªæ ˆï¼ŒæŠŠä¸ç­‰äº <em>val</em> çš„å…ƒç´ å…¥æ ˆï¼Œæœ€åè¿”å›æ ˆçš„å¤§å°ã€‚</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution27</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">removeElement</span><span class="params">(<span class="type">int</span>[] nums, <span class="type">int</span> val)</span>&#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">stackSize</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> x:nums)&#123;</span><br><span class="line">            <span class="keyword">if</span> (x!=val)&#123;</span><br><span class="line">                nums[stackSize++] =x;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> stackSize;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç»å…¸ï¼Œä¸ç­‰äºçš„å°±å…¥æ ˆï¼Œç„¶åé•¿åº¦++</p><p>æœ€åè¿”å›size</p><h2 id="26-åˆ é™¤æœ‰åºæ•°ç»„ä¸­çš„é‡å¤é¡¹"><a href="#26-åˆ é™¤æœ‰åºæ•°ç»„ä¸­çš„é‡å¤é¡¹" class="headerlink" title="26. åˆ é™¤æœ‰åºæ•°ç»„ä¸­çš„é‡å¤é¡¹"></a><a href="https://leetcode.cn/problems/remove-duplicates-from-sorted-array/">26. åˆ é™¤æœ‰åºæ•°ç»„ä¸­çš„é‡å¤é¡¹</a></h2><p>ç»™ä½ ä¸€ä¸ª <strong>éä¸¥æ ¼é€’å¢æ’åˆ—</strong> çš„æ•°ç»„ <code>nums</code> ï¼Œè¯·ä½ <strong><a href="http://baike.baidu.com/item/åŸåœ°ç®—æ³•"> åŸåœ°</a></strong> åˆ é™¤é‡å¤å‡ºç°çš„å…ƒç´ ï¼Œä½¿æ¯ä¸ªå…ƒç´  <strong>åªå‡ºç°ä¸€æ¬¡</strong> ï¼Œè¿”å›åˆ é™¤åæ•°ç»„çš„æ–°é•¿åº¦ã€‚å…ƒç´ çš„ <strong>ç›¸å¯¹é¡ºåº</strong> åº”è¯¥ä¿æŒ <strong>ä¸€è‡´</strong> ã€‚ç„¶åè¿”å› <code>nums</code> ä¸­å”¯ä¸€å…ƒç´ çš„ä¸ªæ•°ã€‚</p><p>è€ƒè™‘ <code>nums</code> çš„å”¯ä¸€å…ƒç´ çš„æ•°é‡ä¸º <code>k</code> ï¼Œä½ éœ€è¦åšä»¥ä¸‹äº‹æƒ…ç¡®ä¿ä½ çš„é¢˜è§£å¯ä»¥è¢«é€šè¿‡ï¼š</p><ul><li>æ›´æ”¹æ•°ç»„ <code>nums</code> ï¼Œä½¿ <code>nums</code> çš„å‰ <code>k</code> ä¸ªå…ƒç´ åŒ…å«å”¯ä¸€å…ƒç´ ï¼Œå¹¶æŒ‰ç…§å®ƒä»¬æœ€åˆåœ¨ <code>nums</code> ä¸­å‡ºç°çš„é¡ºåºæ’åˆ—ã€‚<code>nums</code> çš„å…¶ä½™å…ƒç´ ä¸ <code>nums</code> çš„å¤§å°ä¸é‡è¦ã€‚</li><li>è¿”å› <code>k</code> ã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution26A</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">removeDuplicates</span><span class="params">(<span class="type">int</span>[] nums)</span>&#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">k</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span><span class="number">1</span>;i&lt;nums.length;i++)&#123;</span><br><span class="line">            <span class="keyword">if</span> (nums[i]!=nums[i-<span class="number">1</span>])&#123;</span><br><span class="line">                nums[k++] = nums[i];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> k;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç®€å•çš„éå†</p><h2 id="80-åˆ é™¤æœ‰åºæ•°ç»„ä¸­çš„é‡å¤é¡¹-II"><a href="#80-åˆ é™¤æœ‰åºæ•°ç»„ä¸­çš„é‡å¤é¡¹-II" class="headerlink" title="80. åˆ é™¤æœ‰åºæ•°ç»„ä¸­çš„é‡å¤é¡¹ II"></a><a href="https://leetcode.cn/problems/remove-duplicates-from-sorted-array-ii/">80. åˆ é™¤æœ‰åºæ•°ç»„ä¸­çš„é‡å¤é¡¹ II</a></h2><p>ç»™ä½ ä¸€ä¸ªæœ‰åºæ•°ç»„ <code>nums</code> ï¼Œè¯·ä½ <strong><a href="http://baike.baidu.com/item/åŸåœ°ç®—æ³•"> åŸåœ°</a></strong> åˆ é™¤é‡å¤å‡ºç°çš„å…ƒç´ ï¼Œä½¿å¾—å‡ºç°æ¬¡æ•°è¶…è¿‡ä¸¤æ¬¡çš„å…ƒç´ <strong>åªå‡ºç°ä¸¤æ¬¡</strong> ï¼Œè¿”å›åˆ é™¤åæ•°ç»„çš„æ–°é•¿åº¦ã€‚</p><p>ä¸è¦ä½¿ç”¨é¢å¤–çš„æ•°ç»„ç©ºé—´ï¼Œä½ å¿…é¡»åœ¨ <strong><a href="https://baike.baidu.com/item/åŸåœ°ç®—æ³•">åŸåœ° </a>ä¿®æ”¹è¾“å…¥æ•°ç»„</strong> å¹¶åœ¨ä½¿ç”¨ O(1) é¢å¤–ç©ºé—´çš„æ¡ä»¶ä¸‹å®Œæˆã€‚</p><p>ä½¿ç”¨æ ˆçš„æ€æƒ³å»ä½¿ç”¨</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution80A</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">removeDuplicates</span><span class="params">(<span class="type">int</span>[] nums)</span>&#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">stackSize</span> <span class="operator">=</span> <span class="number">2</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span><span class="number">2</span>;i&lt;nums.length;i++)&#123;</span><br><span class="line">            <span class="keyword">if</span> (nums[i]!=nums[stackSize-<span class="number">2</span>])&#123;</span><br><span class="line">                nums[stackSize++] = nums[i];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> Math.min(stackSize,nums.length);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å› ä¸ºæ˜¯ä¸èƒ½å¤šäºä¸¤æ¬¡ï¼Œæ‰€ä»¥æ˜¯å’Œæ ˆé¡¶-2çš„å…ƒç´ å»æ¯”è¾ƒ</p><h2 id="283-ç§»åŠ¨é›¶"><a href="#283-ç§»åŠ¨é›¶" class="headerlink" title="283. ç§»åŠ¨é›¶"></a><a href="https://leetcode.cn/problems/move-zeroes/">283. ç§»åŠ¨é›¶</a></h2><p>ç»™å®šä¸€ä¸ªæ•°ç»„ <code>nums</code>ï¼Œç¼–å†™ä¸€ä¸ªå‡½æ•°å°†æ‰€æœ‰ <code>0</code> ç§»åŠ¨åˆ°æ•°ç»„çš„æœ«å°¾ï¼ŒåŒæ—¶ä¿æŒéé›¶å…ƒç´ çš„ç›¸å¯¹é¡ºåºã€‚</p><p><strong>è¯·æ³¨æ„</strong> ï¼Œå¿…é¡»åœ¨ä¸å¤åˆ¶æ•°ç»„çš„æƒ…å†µä¸‹åŸåœ°å¯¹æ•°ç»„è¿›è¡Œæ“ä½œã€‚</p><p>äº¤æ¢æ’åºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">moveZeroes</span><span class="params">(<span class="type">int</span>[] nums)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (nums == <span class="literal">null</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span><span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>;i&lt;nums.length;i++)&#123;</span><br><span class="line">            <span class="keyword">if</span> (nums[i]!=<span class="number">0</span>)&#123;</span><br><span class="line">                <span class="type">int</span> <span class="variable">tmp</span> <span class="operator">=</span> nums[i];</span><br><span class="line">                nums[i] = nums[j];</span><br><span class="line">                nums[j++] = tmp;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é‡åˆ°0å°±äº¤æ¢</p><p>æ ˆçš„æ€æƒ³ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution283</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">moveZeroes</span><span class="params">(<span class="type">int</span>[] nums)</span>&#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">stackSize</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> x:nums)&#123;</span><br><span class="line">            <span class="keyword">if</span> (x!=<span class="number">0</span>)&#123;</span><br><span class="line">                nums[stackSize++] = x;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        Arrays.fill(nums,stackSize,nums.length,<span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="1089-å¤å†™é›¶"><a href="#1089-å¤å†™é›¶" class="headerlink" title="1089. å¤å†™é›¶"></a><a href="https://leetcode.cn/problems/duplicate-zeros/">1089. å¤å†™é›¶</a></h2><p>ç»™ä½ ä¸€ä¸ªé•¿åº¦å›ºå®šçš„æ•´æ•°æ•°ç»„ <code>arr</code> ï¼Œè¯·ä½ å°†è¯¥æ•°ç»„ä¸­å‡ºç°çš„æ¯ä¸ªé›¶éƒ½å¤å†™ä¸€éï¼Œå¹¶å°†å…¶ä½™çš„å…ƒç´ å‘å³å¹³ç§»ã€‚</p><p>æ³¨æ„ï¼šè¯·ä¸è¦åœ¨è¶…è¿‡è¯¥æ•°ç»„é•¿åº¦çš„ä½ç½®å†™å…¥å…ƒç´ ã€‚è¯·å¯¹è¾“å…¥çš„æ•°ç»„ <strong>å°±åœ°</strong> è¿›è¡Œä¸Šè¿°ä¿®æ”¹ï¼Œä¸è¦ä»å‡½æ•°è¿”å›ä»»ä½•ä¸œè¥¿ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution1089</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">duplicateZeros</span><span class="params">(<span class="type">int</span>[] arr)</span>&#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">n</span>  <span class="operator">=</span> arr.length;</span><br><span class="line">        <span class="type">int</span> <span class="variable">countZeros</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span><span class="number">0</span>;i&lt;n;i++)&#123;</span><br><span class="line">            <span class="keyword">if</span> (arr[i] ==<span class="number">0</span>)&#123;</span><br><span class="line">                countZeros++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> n-<span class="number">1</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> n+countZeros-<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span> (i&gt;=<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span> (arr[i]==<span class="number">0</span>)&#123;</span><br><span class="line">                <span class="keyword">if</span> (j&lt;n) arr[j] = <span class="number">0</span>;</span><br><span class="line">                j--;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (j&lt;n)&#123;</span><br><span class="line">                arr[j] = arr[i];</span><br><span class="line">            &#125;</span><br><span class="line">            i--;</span><br><span class="line">            j--;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å…ˆå»ç»Ÿè®¡0çš„æ¬¡æ•°</p><p>ç„¶åiä¸ºåŸæ•°ç»„çš„æœ€åä¸€ä½</p><p>jä¸ºæ–°æ•°ç»„çš„æœ€åä¸€ä½</p><p>i&gt;=0æ—¶ä¸”è¿™ä¸ªä½ä¸º0çš„è¯</p><p>ç„¶åå°†é›¶å¤åˆ¶åˆ°ç›®æ ‡ä½ç½®ï¼Œå¹¶ä¸”ç›®æ ‡ä½ç½®è¦å‰ç§»ä¸¤ä½</p><p>å°†éé›¶å…ƒç´ å¤åˆ¶åˆ°ç›®æ ‡ä½ç½®ï¼Œå¹¶ä¸”ç›®æ ‡ä½ç½®å‰ç§»ä¸€ä½</p><p>è¿™ä¸ªå†å›¾ä¸Šç”»ä¸€ä¸‹å°±å¥½ç†è§£å¤šäº†</p><h2 id="442-æ•°ç»„ä¸­é‡å¤çš„æ•°æ®"><a href="#442-æ•°ç»„ä¸­é‡å¤çš„æ•°æ®" class="headerlink" title="442. æ•°ç»„ä¸­é‡å¤çš„æ•°æ®"></a><a href="https://leetcode.cn/problems/find-all-duplicates-in-an-array/">442. æ•°ç»„ä¸­é‡å¤çš„æ•°æ®</a></h2><p>ç»™ä½ ä¸€ä¸ªé•¿åº¦ä¸º <code>n</code> çš„æ•´æ•°æ•°ç»„ <code>nums</code> ï¼Œå…¶ä¸­ <code>nums</code> çš„æ‰€æœ‰æ•´æ•°éƒ½åœ¨èŒƒå›´ <code>[1, n]</code> å†…ï¼Œä¸”æ¯ä¸ªæ•´æ•°å‡ºç° <strong>æœ€å¤š**</strong>ä¸¤æ¬¡<strong> ã€‚è¯·ä½ æ‰¾å‡ºæ‰€æœ‰å‡ºç° </strong>ä¸¤æ¬¡** çš„æ•´æ•°ï¼Œå¹¶ä»¥æ•°ç»„å½¢å¼è¿”å›ã€‚</p><p>ä½ å¿…é¡»è®¾è®¡å¹¶å®ç°ä¸€ä¸ªæ—¶é—´å¤æ‚åº¦ä¸º <code>O(n)</code> ä¸”ä»…ä½¿ç”¨å¸¸é‡é¢å¤–ç©ºé—´ï¼ˆä¸åŒ…æ‹¬å­˜å‚¨è¾“å‡ºæ‰€éœ€çš„ç©ºé—´ï¼‰çš„ç®—æ³•è§£å†³æ­¤é—®é¢˜ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> List&lt;Integer&gt; <span class="title function_">findDuplicates</span><span class="params">(<span class="type">int</span>[] nums)</span> &#123;</span><br><span class="line">        <span class="comment">// åŸåœ°æ•°ç»„æ³•</span></span><br><span class="line">        <span class="comment">// List&lt;Integer&gt; list = new ArrayList&lt;&gt;();</span></span><br><span class="line">        <span class="comment">// for(int i = 0;i &lt; nums.length;i++)&#123;</span></span><br><span class="line">        <span class="comment">//     int cur = Math.abs(nums[i]);</span></span><br><span class="line">        <span class="comment">//     int index = cur - 1;</span></span><br><span class="line">        <span class="comment">//     if(nums[index] &lt; 0)&#123;</span></span><br><span class="line">        <span class="comment">//         list.add(cur);</span></span><br><span class="line">        <span class="comment">//     &#125;else&#123;</span></span><br><span class="line">        <span class="comment">//         nums[index] *= -1;</span></span><br><span class="line">        <span class="comment">//     &#125;</span></span><br><span class="line">        <span class="comment">// &#125;</span></span><br><span class="line">        <span class="comment">// return list;</span></span><br><span class="line"></span><br><span class="line">        <span class="type">int</span>[] map = <span class="keyword">new</span> <span class="title class_">int</span>[nums.length + <span class="number">1</span>];</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> item : nums) &#123;</span><br><span class="line">            map[item]++;</span><br><span class="line">        &#125;</span><br><span class="line">        List&lt;Integer&gt; res=<span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; map.length; ++i) &#123;</span><br><span class="line">            <span class="keyword">if</span> (map[i] == <span class="number">2</span>) &#123;</span><br><span class="line">                res.add(i);</span><br><span class="line"></span><br><span class="line">            &#125;</span><br></pre></td></tr></table></figure><p>hashè¡¨æ˜¯å¯ä»¥çš„å“ˆå“ˆ</p><h2 id="448-æ‰¾åˆ°æ‰€æœ‰æ•°ç»„ä¸­æ¶ˆå¤±çš„æ•°å­—"><a href="#448-æ‰¾åˆ°æ‰€æœ‰æ•°ç»„ä¸­æ¶ˆå¤±çš„æ•°å­—" class="headerlink" title="448. æ‰¾åˆ°æ‰€æœ‰æ•°ç»„ä¸­æ¶ˆå¤±çš„æ•°å­—"></a><a href="https://leetcode.cn/problems/find-all-numbers-disappeared-in-an-array/">448. æ‰¾åˆ°æ‰€æœ‰æ•°ç»„ä¸­æ¶ˆå¤±çš„æ•°å­—</a></h2><p>ç»™ä½ ä¸€ä¸ªå« <code>n</code> ä¸ªæ•´æ•°çš„æ•°ç»„ <code>nums</code> ï¼Œå…¶ä¸­ <code>nums[i]</code> åœ¨åŒºé—´ <code>[1, n]</code> å†…ã€‚è¯·ä½ æ‰¾å‡ºæ‰€æœ‰åœ¨ <code>[1, n]</code> èŒƒå›´å†…ä½†æ²¡æœ‰å‡ºç°åœ¨ <code>nums</code> ä¸­çš„æ•°å­—ï¼Œå¹¶ä»¥æ•°ç»„çš„å½¢å¼è¿”å›ç»“æœã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution448</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> List&lt;Integer&gt; <span class="title function_">findDisappearedNumbers</span><span class="params">(<span class="type">int</span>[] nums)</span>&#123;</span><br><span class="line">        List&lt;Integer&gt; res = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;Integer&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span><span class="number">0</span>;i&lt; nums.length;++i)&#123;</span><br><span class="line">            <span class="type">int</span> index= Math.abs(nums[i])-<span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span> (nums[index]&gt;<span class="number">0</span>)&#123;</span><br><span class="line">                nums[index] *=-<span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>;i&lt;nums.length;++i)&#123;</span><br><span class="line">            <span class="keyword">if</span> (nums[i]&gt;<span class="number">0</span>)&#123;</span><br><span class="line">                res.add(i+<span class="number">1</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨è¿™é‡Œå’Œä¸Šé¢é‚£ä¸ªé¢˜éƒ½ç”¨åˆ°äº†åŒä¸€ä¸ªæ–¹æ³•</p><p>å°±æ˜¯ä¸‹æ ‡çš„é—®é¢˜</p><p>å¦‚æœæ˜¯é¡ºåºæ’åºï¼Œä¸ç¼ºå°‘å…ƒç´ çš„è¯ï¼Œ</p><p>|nums[i]| = index+1 é˜²æ­¢è´Ÿæ•°å“ˆ</p><p>ç„¶åå¦‚æœæ˜¯ä¹±åºçš„è¯ï¼Œä¹Ÿæ˜¯å¯ä»¥å¯¹åº”èµ·æ¥çš„çš„ </p><p>å¦‚æœif (nums[index]&gt;0){<br>                nums[index] *=-1;<br>            }</p><p>çš„è¯ï¼Œç¼ºå°‘çš„é‚£ä¸ªæ­£å¥½æ˜¯æ­£æ•°</p><p>ç„¶åè¦è¿”å›é‚£ä¸ªæ•°çš„è¯ï¼Œi+1å³å¯</p><p>ä¸Šé¢é‚£ä¸ªé¢˜ï¼Œå‡ºç°ä¸¤æ¬¡è·Ÿè¿™ä¸ªç¼ºå°‘æ˜¯ä¸€æ ·çš„</p><p>ä¼šæŠŠindexå˜ä¸ºè´Ÿçš„</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">1. å€¼åŸŸæ˜¯ [1, n]ï¼Œè€ƒè™‘ nums[i] - 1 åšä¸‹æ ‡</span><br><span class="line">2. æ ‡è®°ï¼šå°† nums[nums[i] - 1] *= -1</span><br><span class="line">3. æŸ¥è¯¢ï¼š</span><br><span class="line">   - æ‰¾ç¼ºå¤± âœ å“ªäº› index ä¸Šè¿˜ä¸ºæ­£ï¼Œå¯¹åº”å€¼å°±æ˜¯ç¼ºå¤±çš„ i+1</span><br><span class="line">   - æ‰¾é‡å¤ âœ å“ªäº› index ç¬¬ä¸€æ¬¡è®¿é—®æ—¶å°±å·²ç»æ˜¯è´Ÿæ•°</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ğŸ‘†</p><h1 id="åŒåºåˆ—åŒæŒ‡é’ˆ"><a href="#åŒåºåˆ—åŒæŒ‡é’ˆ" class="headerlink" title="åŒåºåˆ—åŒæŒ‡é’ˆ"></a>åŒåºåˆ—åŒæŒ‡é’ˆ</h1><h2 id="2109-å‘å­—ç¬¦ä¸²æ·»åŠ ç©ºæ ¼"><a href="#2109-å‘å­—ç¬¦ä¸²æ·»åŠ ç©ºæ ¼" class="headerlink" title="2109. å‘å­—ç¬¦ä¸²æ·»åŠ ç©ºæ ¼"></a><a href="https://leetcode.cn/problems/adding-spaces-to-a-string/">2109. å‘å­—ç¬¦ä¸²æ·»åŠ ç©ºæ ¼</a></h2><p>ç»™ä½ ä¸€ä¸ªä¸‹æ ‡ä» <strong>0</strong> å¼€å§‹çš„å­—ç¬¦ä¸² <code>s</code> ï¼Œä»¥åŠä¸€ä¸ªä¸‹æ ‡ä» <strong>0</strong> å¼€å§‹çš„æ•´æ•°æ•°ç»„ <code>spaces</code> ã€‚</p><p>æ•°ç»„ <code>spaces</code> æè¿°åŸå­—ç¬¦ä¸²ä¸­éœ€è¦æ·»åŠ ç©ºæ ¼çš„ä¸‹æ ‡ã€‚æ¯ä¸ªç©ºæ ¼éƒ½åº”è¯¥æ’å…¥åˆ°ç»™å®šç´¢å¼•å¤„çš„å­—ç¬¦å€¼ <strong>ä¹‹å‰</strong> ã€‚</p><ul><li>ä¾‹å¦‚ï¼Œ<code>s = &quot;EnjoyYourCoffee&quot;</code> ä¸” <code>spaces = [5, 9]</code> ï¼Œé‚£ä¹ˆæˆ‘ä»¬éœ€è¦åœ¨ <code>&#39;Y&#39;</code> å’Œ <code>&#39;C&#39;</code> ä¹‹å‰æ·»åŠ ç©ºæ ¼ï¼Œè¿™ä¸¤ä¸ªå­—ç¬¦åˆ†åˆ«ä½äºä¸‹æ ‡ <code>5</code> å’Œä¸‹æ ‡ <code>9</code> ã€‚å› æ­¤ï¼Œæœ€ç»ˆå¾—åˆ° <code>&quot;Enjoy ***Y***our ***C***offee&quot;</code> ã€‚</li></ul><p>è¯·ä½ æ·»åŠ ç©ºæ ¼ï¼Œå¹¶è¿”å›ä¿®æ”¹åçš„å­—ç¬¦ä¸²<em>ã€‚</em></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span>  <span class="title class_">Solution2109</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">addSpaces</span><span class="params">(String s, <span class="type">int</span>[] spaces)</span>&#123;</span><br><span class="line">        <span class="type">StringBuilder</span> <span class="variable">ans</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>(s.length()+spaces.length);</span><br><span class="line">        <span class="type">int</span> j= <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>;i&lt;s.length();i++)&#123;</span><br><span class="line">            <span class="keyword">if</span> (j&lt;spaces.length&amp;&amp;spaces[j]==i)&#123;</span><br><span class="line">                ans.append(<span class="string">&#x27; &#x27;</span>);</span><br><span class="line">                j++;</span><br><span class="line">            &#125;</span><br><span class="line">            ans.append(s.charAt(i));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ans.toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å°±æ˜¯ä¸¤ä¸ªæŒ‡é’ˆï¼ŒIæŒ‡é’ˆæŒ‡å‘çš„æ˜¯å­—ç¬¦ä¸²s,ç„¶åJæŒ‡é’ˆæŒ‡å‘çš„æ˜¯æ•°ç»„</p><p>å½“j&lt;spaces.lenghtä¸”spaces[j]==içš„æ—¶å€™</p><p>è¿™ä¸ªæ—¶å€™åŠ å…¥â€™ â€˜ï¼›</p><p>ç„¶åå†å°±åŠ å…¥s[i]ï¼›</p><p><strong>over</strong></p><h2 id="2540-æœ€å°å…¬å…±å€¼"><a href="#2540-æœ€å°å…¬å…±å€¼" class="headerlink" title="2540. æœ€å°å…¬å…±å€¼"></a><a href="https://leetcode.cn/problems/minimum-common-value/">2540. æœ€å°å…¬å…±å€¼</a></h2><p>ç»™ä½ ä¸¤ä¸ªæ•´æ•°æ•°ç»„ <code>nums1</code> å’Œ <code>nums2</code> ï¼Œå®ƒä»¬å·²ç»æŒ‰éé™åºæ’åºï¼Œè¯·ä½ è¿”å›ä¸¤ä¸ªæ•°ç»„çš„ <strong>æœ€å°å…¬å…±æ•´æ•°</strong> ã€‚å¦‚æœä¸¤ä¸ªæ•°ç»„ <code>nums1</code> å’Œ <code>nums2</code> æ²¡æœ‰å…¬å…±æ•´æ•°ï¼Œè¯·ä½ è¿”å› <code>-1</code> ã€‚</p><p>å¦‚æœä¸€ä¸ªæ•´æ•°åœ¨ä¸¤ä¸ªæ•°ç»„ä¸­éƒ½ <strong>è‡³å°‘å‡ºç°ä¸€æ¬¡</strong> ï¼Œé‚£ä¹ˆè¿™ä¸ªæ•´æ•°æ˜¯æ•°ç»„ <code>nums1</code> å’Œ <code>nums2</code> <strong>å…¬å…±</strong> çš„ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution2540</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getCommon</span><span class="params">(<span class="type">int</span>[] nums1, <span class="type">int</span>[] nums2)</span>&#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span><span class="number">0</span>,j=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (i&lt;nums1.length&amp;&amp;j&lt;nums2.length)&#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">a</span> <span class="operator">=</span> nums1[i],b = nums2[j];</span><br><span class="line">            <span class="keyword">if</span> (a==b) <span class="keyword">return</span> a;</span><br><span class="line">            <span class="keyword">if</span> (a&lt;b) i++;</span><br><span class="line">            <span class="keyword">else</span> j++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åŒæŒ‡é’ˆå†™æ³•ï¼Œä¸€ä¸ªéå†nums1ï¼Œä¸€ä¸ªéå†nums2</p><p>ç„¶åç›¸ç­‰å°±è¿”å›ï¼Œå› ä¸ºæ˜¯æŒ‰é¡ºåºæ’åˆ—çš„ï¼Œæ‰€ä»¥ç¬¬ä¸€ä¸ªè¿”å›çš„å°±æ˜¯æœ€å°çš„</p><p>ç„¶åç›´æ¥è¿”å›å°±è¡Œ</p><p>ç„¶åæ ¹æ®æƒ…å†µç§»åŠ¨æŒ‡é’ˆ</p><h2 id="88-åˆå¹¶ä¸¤ä¸ªæœ‰åºæ•°ç»„"><a href="#88-åˆå¹¶ä¸¤ä¸ªæœ‰åºæ•°ç»„" class="headerlink" title="88. åˆå¹¶ä¸¤ä¸ªæœ‰åºæ•°ç»„"></a><a href="https://leetcode.cn/problems/merge-sorted-array/">88. åˆå¹¶ä¸¤ä¸ªæœ‰åºæ•°ç»„</a></h2><p>ç»™ä½ ä¸¤ä¸ªæŒ‰ <strong>éé€’å‡é¡ºåº</strong> æ’åˆ—çš„æ•´æ•°æ•°ç»„ <code>nums1</code> å’Œ <code>nums2</code>ï¼Œå¦æœ‰ä¸¤ä¸ªæ•´æ•° <code>m</code> å’Œ <code>n</code> ï¼Œåˆ†åˆ«è¡¨ç¤º <code>nums1</code> å’Œ <code>nums2</code> ä¸­çš„å…ƒç´ æ•°ç›®ã€‚</p><p>è¯·ä½  <strong>åˆå¹¶</strong> <code>nums2</code> åˆ° <code>nums1</code> ä¸­ï¼Œä½¿åˆå¹¶åçš„æ•°ç»„åŒæ ·æŒ‰ <strong>éé€’å‡é¡ºåº</strong> æ’åˆ—ã€‚</p><p><strong>æ³¨æ„ï¼š</strong>æœ€ç»ˆï¼Œåˆå¹¶åæ•°ç»„ä¸åº”ç”±å‡½æ•°è¿”å›ï¼Œè€Œæ˜¯å­˜å‚¨åœ¨æ•°ç»„ <code>nums1</code> ä¸­ã€‚ä¸ºäº†åº”å¯¹è¿™ç§æƒ…å†µï¼Œ<code>nums1</code> çš„åˆå§‹é•¿åº¦ä¸º <code>m + n</code>ï¼Œå…¶ä¸­å‰ <code>m</code> ä¸ªå…ƒç´ è¡¨ç¤ºåº”åˆå¹¶çš„å…ƒç´ ï¼Œå <code>n</code> ä¸ªå…ƒç´ ä¸º <code>0</code> ï¼Œåº”å¿½ç•¥ã€‚<code>nums2</code> çš„é•¿åº¦ä¸º <code>n</code> ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution88</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">merge</span><span class="params">(<span class="type">int</span>[] nums1, <span class="type">int</span> m, <span class="type">int</span>[] nums2, <span class="type">int</span> n)</span>&#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">p1</span> <span class="operator">=</span> m-<span class="number">1</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">p2</span> <span class="operator">=</span> n-<span class="number">1</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">p</span> <span class="operator">=</span> m+n-<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span> (p2&gt;=<span class="number">0</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span> (p1&gt;=<span class="number">0</span>&amp;&amp;nums1[p1]&gt;nums2[p2])&#123;</span><br><span class="line">                nums1[p--] = nums1[p1--];</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                nums1[p--] = nums2[p2--];</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆå¹¶çš„æ—¶å€™ä»åé¢å¼€å§‹çœ‹</p><p>å¤§çš„å…ˆæ’è¿›å»å°±è¡Œ</p><p>ç„¶åæŒ‡é’ˆç§»åŠ¨</p><h2 id="LCP-18-æ—©é¤ç»„åˆ"><a href="#LCP-18-æ—©é¤ç»„åˆ" class="headerlink" title="LCP 18. æ—©é¤ç»„åˆ"></a><a href="https://leetcode.cn/problems/2vYnGI/">LCP 18. æ—©é¤ç»„åˆ</a></h2><p>å°æ‰£åœ¨ç§‹æ—¥å¸‚é›†é€‰æ‹©äº†ä¸€å®¶æ—©é¤æ‘Šä½ï¼Œä¸€ç»´æ•´å‹æ•°ç»„ <code>staple</code> ä¸­è®°å½•äº†æ¯ç§ä¸»é£Ÿçš„ä»·æ ¼ï¼Œä¸€ç»´æ•´å‹æ•°ç»„ <code>drinks</code> ä¸­è®°å½•äº†æ¯ç§é¥®æ–™çš„ä»·æ ¼ã€‚å°æ‰£çš„è®¡åˆ’é€‰æ‹©ä¸€ä»½ä¸»é£Ÿå’Œä¸€æ¬¾é¥®æ–™ï¼Œä¸”èŠ±è´¹ä¸è¶…è¿‡ <code>x</code> å…ƒã€‚è¯·è¿”å›å°æ‰£å…±æœ‰å¤šå°‘ç§è´­ä¹°æ–¹æ¡ˆã€‚</p><p>æ³¨æ„ï¼šç­”æ¡ˆéœ€è¦ä»¥ <code>1e9 + 7 (1000000007)</code> ä¸ºåº•å–æ¨¡ï¼Œå¦‚ï¼šè®¡ç®—åˆå§‹ç»“æœä¸ºï¼š<code>1000000008</code>ï¼Œè¯·è¿”å› <code>1</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">SolutionLCP88</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">breakfastNumber</span><span class="params">(<span class="type">int</span>[] staple, <span class="type">int</span>[] drinks, <span class="type">int</span> x)</span>&#123;</span><br><span class="line">        Arrays.sort(staple);</span><br><span class="line">        Arrays.sort(drinks);</span><br><span class="line">        <span class="type">int</span> <span class="variable">mod</span> <span class="operator">=</span> <span class="number">1_000_000_007</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">res</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">j</span>  <span class="operator">=</span> drinks.length-<span class="number">1</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">0</span>;i&lt;staple.length;i++)&#123;</span><br><span class="line">            <span class="keyword">if</span> (staple[i]&gt;x) <span class="keyword">break</span>;</span><br><span class="line">            <span class="keyword">while</span> (j&gt;=<span class="number">0</span>&amp;&amp;staple[i]+drinks[j]&gt;x)&#123;</span><br><span class="line">                j--;</span><br><span class="line">            &#125;</span><br><span class="line">            res = (res+(j+<span class="number">1</span>))%mod;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å°±åŒæŒ‡é’ˆéå†</p><p>ä½¿s[i]+d[j]&lt;=x</p><p>ç„¶åæ­¤æ—¶ j+1 ä¸ªé¥®æ–™éƒ½èƒ½ä¸ staple[i] æ­é…</p><h2 id="1855-ä¸‹æ ‡å¯¹ä¸­çš„æœ€å¤§è·ç¦»"><a href="#1855-ä¸‹æ ‡å¯¹ä¸­çš„æœ€å¤§è·ç¦»" class="headerlink" title="1855. ä¸‹æ ‡å¯¹ä¸­çš„æœ€å¤§è·ç¦»"></a><a href="https://leetcode.cn/problems/maximum-distance-between-a-pair-of-values/">1855. ä¸‹æ ‡å¯¹ä¸­çš„æœ€å¤§è·ç¦»</a></h2><p>ç»™ä½ ä¸¤ä¸ª <strong>éé€’å¢</strong> çš„æ•´æ•°æ•°ç»„ <code>nums1</code> å’Œ <code>nums2</code> ï¼Œæ•°ç»„ä¸‹æ ‡å‡ <strong>ä» 0 å¼€å§‹</strong> è®¡æ•°ã€‚</p><p>ä¸‹æ ‡å¯¹ <code>(i, j)</code> ä¸­ <code>0 &lt;= i &lt; nums1.length</code> ä¸” <code>0 &lt;= j &lt; nums2.length</code> ã€‚å¦‚æœè¯¥ä¸‹æ ‡å¯¹åŒæ—¶æ»¡è¶³ <code>i &lt;= j</code> ä¸” <code>nums1[i] &lt;= nums2[j]</code> ï¼Œåˆ™ç§°ä¹‹ä¸º <strong>æœ‰æ•ˆ</strong> ä¸‹æ ‡å¯¹ï¼Œè¯¥ä¸‹æ ‡å¯¹çš„ <strong>è·ç¦»</strong> ä¸º <code>j - i</code> ã€‚</p><p>è¿”å›æ‰€æœ‰ <strong>æœ‰æ•ˆ</strong> ä¸‹æ ‡å¯¹ <code>(i, j)</code> ä¸­çš„ <strong>æœ€å¤§è·ç¦»</strong> ã€‚å¦‚æœä¸å­˜åœ¨æœ‰æ•ˆä¸‹æ ‡å¯¹ï¼Œè¿”å› <code>0</code> ã€‚</p><p>ä¸€ä¸ªæ•°ç»„ <code>arr</code> ï¼Œå¦‚æœæ¯ä¸ª <code>1 &lt;= i &lt; arr.length</code> å‡æœ‰ <code>arr[i-1] &gt;= arr[i]</code> æˆç«‹ï¼Œé‚£ä¹ˆè¯¥æ•°ç»„æ˜¯ä¸€ä¸ª <strong>éé€’å¢</strong> æ•°ç»„ã€‚</p><p>ç®€å•çš„åŒæŒ‡é’ˆ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution1855</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">maxDistance</span><span class="params">(<span class="type">int</span>[] nums1, <span class="type">int</span>[] nums2)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">p1</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">p2</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">res</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (p1 &lt; nums1.length &amp;&amp; p2 &lt;nums2.length)&#123;</span><br><span class="line">            <span class="keyword">if</span>(nums1[p1] &gt; nums2[p2])&#123;  <span class="comment">//æ— æ•ˆ</span></span><br><span class="line">                <span class="keyword">if</span>(p1 == p2)&#123;</span><br><span class="line">                    p1++;</span><br><span class="line">                    p2++;</span><br><span class="line">                &#125;<span class="keyword">else</span> p1++;</span><br><span class="line">            &#125;<span class="keyword">else</span> &#123;     <span class="comment">//æœ‰æ•ˆ</span></span><br><span class="line">                res =Math.max(res,p2-p1);</span><br><span class="line">                p2++;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="925-é•¿æŒ‰é”®å…¥"><a href="#925-é•¿æŒ‰é”®å…¥" class="headerlink" title="925. é•¿æŒ‰é”®å…¥"></a><a href="https://leetcode.cn/problems/long-pressed-name/">925. é•¿æŒ‰é”®å…¥</a></h2><p>ä½ çš„æœ‹å‹æ­£åœ¨ä½¿ç”¨é”®ç›˜è¾“å…¥ä»–çš„åå­— <code>name</code>ã€‚å¶å°”ï¼Œåœ¨é”®å…¥å­—ç¬¦ <code>c</code> æ—¶ï¼ŒæŒ‰é”®å¯èƒ½ä¼šè¢«<em>é•¿æŒ‰</em>ï¼Œè€Œå­—ç¬¦å¯èƒ½è¢«è¾“å…¥ 1 æ¬¡æˆ–å¤šæ¬¡ã€‚</p><p>ä½ å°†ä¼šæ£€æŸ¥é”®ç›˜è¾“å…¥çš„å­—ç¬¦ <code>typed</code>ã€‚å¦‚æœå®ƒå¯¹åº”çš„å¯èƒ½æ˜¯ä½ çš„æœ‹å‹çš„åå­—ï¼ˆå…¶ä¸­ä¸€äº›å­—ç¬¦å¯èƒ½è¢«é•¿æŒ‰ï¼‰ï¼Œé‚£ä¹ˆå°±è¿”å› <code>True</code></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution925</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isLongPressedName</span><span class="params">(String name, String typed)</span>&#123;</span><br><span class="line">        <span class="type">int</span> i=<span class="number">0</span>,j=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (j&lt;typed.length())&#123;</span><br><span class="line">            <span class="keyword">if</span> (i&lt;name.length()&amp;&amp;typed.charAt(j) ==name.charAt(i))&#123;</span><br><span class="line">                i++;</span><br><span class="line">                j++;</span><br><span class="line">            &#125;<span class="keyword">else</span> <span class="keyword">if</span> (j&gt;<span class="number">0</span>&amp;&amp;typed.charAt(j)==typed.charAt(j-<span class="number">1</span>))&#123;</span><br><span class="line">                j++;</span><br><span class="line">            &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> i ==name.length();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç®€å•çš„åŒæŒ‡é’ˆé—®é¢˜ï¼Œä¸€ä¸ªæŒ‡é’ˆåœ¨nameä¸€ä¸ªåœ¨type</p><p>å¦‚æœi=jçš„è¯ï¼Œå°±ç»§ç»­</p><p>å¦‚æœj=j-1çš„è¯ï¼Œè¯´æ˜é‡å¤äº†ï¼Œè·³è¿‡è¿™ä¸ªç»§ç»­éå†</p><p>æœ€åi=name.lengthè¯´æ˜éå†å®Œæ­£å¥½è¿™é•¿åº¦ï¼Œè¿”å›true</p><p>ä¸æ˜¯çš„è¯è¿”å›false</p><h2 id="2337-ç§»åŠ¨ç‰‡æ®µå¾—åˆ°å­—ç¬¦ä¸²"><a href="#2337-ç§»åŠ¨ç‰‡æ®µå¾—åˆ°å­—ç¬¦ä¸²" class="headerlink" title="2337. ç§»åŠ¨ç‰‡æ®µå¾—åˆ°å­—ç¬¦ä¸²"></a><a href="https://leetcode.cn/problems/move-pieces-to-obtain-a-string/">2337. ç§»åŠ¨ç‰‡æ®µå¾—åˆ°å­—ç¬¦ä¸²</a></h2><p>ç»™ä½ ä¸¤ä¸ªå­—ç¬¦ä¸² <code>start</code> å’Œ <code>target</code> ï¼Œé•¿åº¦å‡ä¸º <code>n</code> ã€‚æ¯ä¸ªå­—ç¬¦ä¸² <strong>ä»…</strong> ç”±å­—ç¬¦ <code>&#39;L&#39;</code>ã€<code>&#39;R&#39;</code> å’Œ <code>&#39;_&#39;</code> ç»„æˆï¼Œå…¶ä¸­ï¼š</p><ul><li>å­—ç¬¦ <code>&#39;L&#39;</code> å’Œ <code>&#39;R&#39;</code> è¡¨ç¤ºç‰‡æ®µï¼Œå…¶ä¸­ç‰‡æ®µ <code>&#39;L&#39;</code> åªæœ‰åœ¨å…¶å·¦ä¾§ç›´æ¥å­˜åœ¨ä¸€ä¸ª <strong>ç©ºä½</strong> æ—¶æ‰èƒ½å‘ <strong>å·¦</strong> ç§»åŠ¨ï¼Œè€Œç‰‡æ®µ <code>&#39;R&#39;</code> åªæœ‰åœ¨å…¶å³ä¾§ç›´æ¥å­˜åœ¨ä¸€ä¸ª <strong>ç©ºä½</strong> æ—¶æ‰èƒ½å‘ <strong>å³</strong> ç§»åŠ¨ã€‚</li><li>å­—ç¬¦ <code>&#39;_&#39;</code> è¡¨ç¤ºå¯ä»¥è¢« <strong>ä»»æ„</strong> <code>&#39;L&#39;</code> æˆ– <code>&#39;R&#39;</code> ç‰‡æ®µå æ®çš„ç©ºä½ã€‚</li></ul><p>å¦‚æœåœ¨ç§»åŠ¨å­—ç¬¦ä¸² <code>start</code> ä¸­çš„ç‰‡æ®µä»»æ„æ¬¡ä¹‹åå¯ä»¥å¾—åˆ°å­—ç¬¦ä¸² <code>target</code> ï¼Œè¿”å› <code>true</code> ï¼›å¦åˆ™ï¼Œè¿”å› <code>false</code> ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution2337</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">canChange</span><span class="params">(String start, String target)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!start.replace(<span class="string">&quot;_&quot;</span>,<span class="string">&quot;&quot;</span>).equals(target.replace(<span class="string">&quot;_&quot;</span>,<span class="string">&quot;&quot;</span>)))&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span><span class="number">0</span>,j=<span class="number">0</span>;i&lt;start.length();i++)&#123;</span><br><span class="line">            <span class="keyword">if</span> (start.charAt(i)==<span class="string">&#x27;_&#x27;</span>)&#123;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">while</span> (target.charAt(j)==<span class="string">&#x27;_&#x27;</span>)&#123;</span><br><span class="line">                j++;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (i!=j&amp;&amp;(start.charAt(i)==<span class="string">&#x27;L&#x27;</span>)==(i&lt;j))&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            j++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·æ­£è¿‡æ¥æƒ³ï¼Œæ˜¯æœ‰äº›å›°éš¾çš„ã€‚é‚£ä¹ˆæˆ‘ä»¬å¯ä»¥åè¿‡æ¥æ€è€ƒï¼Œè¦ä»–ä»¬ç›¸ç­‰çš„è¯ï¼Œå»æ‰_åº”è¯¥æ˜¯ç›¸åŒçš„ï¼Œå¦‚æœä¸ç›¸åŒè¿”å›false</p><p>ç„¶åè¿›è¡ŒåŒåºåˆ—åŒæŒ‡é’ˆéå†</p><p>å¦‚æœæ˜¯Lä¸”i&lt;j Lä¸èƒ½å¾€å³ç§»åŠ¨ï¼Œä¸èƒ½i==jæ‰€ä»¥è¿”å›false</p><p>å¦‚æœæ˜¯Rï¼Œä¸”i&gt;j Rä¸èƒ½å¾€å·¦ç§»åŠ¨ï¼Œä¸èƒ½i==jï¼Œè¿”å›false</p><p>è¿™æ ·æ£€æŸ¥å®Œï¼Œå¦‚æœå¯ä»¥çš„è¯ï¼Œå°±è¿”å›true</p><p>åœ¨è¿™é‡Œçš„è¯ï¼Œ(start.charAt(i)==â€™Lâ€™)====(i&lt;j)è¿™ä¸€ä¸ªå¥å­åŒ…æ‹¬äº†Lçš„æƒ…å†µå’ŒRçš„æƒ…å†µ</p><h1 id="åˆ¤æ–­å­åºåˆ—"><a href="#åˆ¤æ–­å­åºåˆ—" class="headerlink" title="åˆ¤æ–­å­åºåˆ—"></a>åˆ¤æ–­å­åºåˆ—</h1><h2 id="392-åˆ¤æ–­å­åºåˆ—"><a href="#392-åˆ¤æ–­å­åºåˆ—" class="headerlink" title="392. åˆ¤æ–­å­åºåˆ—"></a><a href="https://leetcode.cn/problems/is-subsequence/">392. åˆ¤æ–­å­åºåˆ—</a></h2><p>ç»™å®šå­—ç¬¦ä¸² <strong>s</strong> å’Œ <strong>t</strong> ï¼Œåˆ¤æ–­ <strong>s</strong> æ˜¯å¦ä¸º <strong>t</strong> çš„å­åºåˆ—ã€‚</p><p>å­—ç¬¦ä¸²çš„ä¸€ä¸ªå­åºåˆ—æ˜¯åŸå§‹å­—ç¬¦ä¸²åˆ é™¤ä¸€äº›ï¼ˆä¹Ÿå¯ä»¥ä¸åˆ é™¤ï¼‰å­—ç¬¦è€Œä¸æ”¹å˜å‰©ä½™å­—ç¬¦ç›¸å¯¹ä½ç½®å½¢æˆçš„æ–°å­—ç¬¦ä¸²ã€‚ï¼ˆä¾‹å¦‚ï¼Œ<code>&quot;ace&quot;</code>æ˜¯<code>&quot;abcde&quot;</code>çš„ä¸€ä¸ªå­åºåˆ—ï¼Œè€Œ<code>&quot;aec&quot;</code>ä¸æ˜¯ï¼‰ã€‚</p><p><strong>è¿›é˜¶ï¼š</strong></p><p>å¦‚æœæœ‰å¤§é‡è¾“å…¥çš„ Sï¼Œç§°ä½œ S1, S2, â€¦ , Sk å…¶ä¸­ k &gt;= 10äº¿ï¼Œä½ éœ€è¦ä¾æ¬¡æ£€æŸ¥å®ƒä»¬æ˜¯å¦ä¸º T çš„å­åºåˆ—ã€‚åœ¨è¿™ç§æƒ…å†µä¸‹ï¼Œä½ ä¼šæ€æ ·æ”¹å˜ä»£ç ï¼Ÿ</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution392</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isSubsequence</span><span class="params">(String s, String t)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (s.isEmpty()) <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">char</span> c:t.toCharArray())&#123;</span><br><span class="line">            <span class="keyword">if</span> (s.charAt(i)==c&amp;&amp;++i==s.length())&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å°±æ˜¯ç®€å•çš„åŒæŒ‡é’ˆï¼Œä½†æ˜¯çµç¥è¿™ä¸ªæ–¹æ³•ä¹Ÿå¤ªç®€å•äº†å§å“ˆå“ˆ</p><h2 id="524-é€šè¿‡åˆ é™¤å­—æ¯åŒ¹é…åˆ°å­—å…¸é‡Œæœ€é•¿å•è¯"><a href="#524-é€šè¿‡åˆ é™¤å­—æ¯åŒ¹é…åˆ°å­—å…¸é‡Œæœ€é•¿å•è¯" class="headerlink" title="524. é€šè¿‡åˆ é™¤å­—æ¯åŒ¹é…åˆ°å­—å…¸é‡Œæœ€é•¿å•è¯"></a><a href="https://leetcode.cn/problems/longest-word-in-dictionary-through-deleting/">524. é€šè¿‡åˆ é™¤å­—æ¯åŒ¹é…åˆ°å­—å…¸é‡Œæœ€é•¿å•è¯</a></h2><p>ç»™ä½ ä¸€ä¸ªå­—ç¬¦ä¸² <code>s</code> å’Œä¸€ä¸ªå­—ç¬¦ä¸²æ•°ç»„ <code>dictionary</code> ï¼Œæ‰¾å‡ºå¹¶è¿”å› <code>dictionary</code> ä¸­æœ€é•¿çš„å­—ç¬¦ä¸²ï¼Œè¯¥å­—ç¬¦ä¸²å¯ä»¥é€šè¿‡åˆ é™¤ <code>s</code> ä¸­çš„æŸäº›å­—ç¬¦å¾—åˆ°ã€‚</p><p>å¦‚æœç­”æ¡ˆä¸æ­¢ä¸€ä¸ªï¼Œè¿”å›é•¿åº¦æœ€é•¿ä¸”å­—æ¯åºæœ€å°çš„å­—ç¬¦ä¸²ã€‚å¦‚æœç­”æ¡ˆä¸å­˜åœ¨ï¼Œåˆ™è¿”å›ç©ºå­—ç¬¦ä¸²ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution524</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isSubsequence</span><span class="params">(String t, String s)</span>&#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">indext</span> <span class="operator">=</span> <span class="number">0</span>,indexs=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (indext&lt;t.length()&amp;&amp;indexs&lt;s.length())&#123;</span><br><span class="line">            <span class="keyword">if</span> (t.charAt(indext)==s.charAt(indexs))&#123;</span><br><span class="line">                indext++;</span><br><span class="line">            &#125;</span><br><span class="line">            indexs++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> indext ==t.length();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">findLongestWord</span><span class="params">(String s, List&lt;String&gt; d)</span>&#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">result</span> <span class="operator">=</span> <span class="string">&quot;&quot;</span>;</span><br><span class="line">        <span class="keyword">for</span> (String t:d)&#123;</span><br><span class="line">            <span class="keyword">if</span> (isSubsequence(t,s))&#123;</span><br><span class="line">                <span class="keyword">if</span> (result.length()&lt;t.length()||(result.length()==t.length()&amp;&amp;result.compareTo(t)&gt;<span class="number">0</span>)) &#123;</span><br><span class="line">                    result = t;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ä½¿ç”¨åŒæŒ‡é’ˆæ¥åšçš„è¯ï¼Œé‡åˆ°ç›¸åŒçš„å°±ç»§ç»­æ£€æŸ¥ä¸‹ä¸€ä¸ªï¼Œå¤§å®¶æŒ‡é’ˆéƒ½ç§»åŠ¨ï¼Œä¸ç›¸åŒå°±å­—å…¸çš„è‡ªå·±ç§»åŠ¨ã€‚æœ€åè¿”å›æ˜¯å¦èƒ½æ£€æŸ¥å®Œï¼Œå°±æ˜¯æŒ‡é’ˆåˆ°æœ€åçš„æœ«å°¾äº†</p><p>ç„¶åç¼–å†™ä¸»æ–¹æ³•ï¼Œéå†å­—ç¬¦ï¼Œåœ¨result&gt;0ä¸ä¸ºç©ºçš„æ—¶å€™è¾“å‡º</p><h2 id="2486-è¿½åŠ å­—ç¬¦ä»¥è·å¾—å­åºåˆ—"><a href="#2486-è¿½åŠ å­—ç¬¦ä»¥è·å¾—å­åºåˆ—" class="headerlink" title="2486. è¿½åŠ å­—ç¬¦ä»¥è·å¾—å­åºåˆ—"></a><a href="https://leetcode.cn/problems/append-characters-to-string-to-make-subsequence/">2486. è¿½åŠ å­—ç¬¦ä»¥è·å¾—å­åºåˆ—</a></h2><p>ç»™ä½ ä¸¤ä¸ªä»…ç”±å°å†™è‹±æ–‡å­—æ¯ç»„æˆçš„å­—ç¬¦ä¸² <code>s</code> å’Œ <code>t</code> ã€‚</p><p>ç°åœ¨éœ€è¦é€šè¿‡å‘ <code>s</code> æœ«å°¾è¿½åŠ å­—ç¬¦çš„æ–¹å¼ä½¿ <code>t</code> å˜æˆ <code>s</code> çš„ä¸€ä¸ª <strong>å­åºåˆ—</strong> ï¼Œè¿”å›éœ€è¦è¿½åŠ çš„æœ€å°‘å­—ç¬¦æ•°ã€‚</p><p>å­åºåˆ—æ˜¯ä¸€ä¸ªå¯ä»¥ç”±å…¶ä»–å­—ç¬¦ä¸²åˆ é™¤éƒ¨åˆ†ï¼ˆæˆ–ä¸åˆ é™¤ï¼‰å­—ç¬¦ä½†ä¸æ”¹å˜å‰©ä¸‹å­—ç¬¦é¡ºåºå¾—åˆ°çš„å­—ç¬¦ä¸²ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution2486</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">appendCharacters</span><span class="params">(String s, String t)</span>&#123;</span><br><span class="line">        <span class="type">char</span>[]cp = t.toCharArray();</span><br><span class="line">        <span class="type">char</span>[]cs = s.toCharArray();</span><br><span class="line">        <span class="type">int</span> <span class="variable">k</span> <span class="operator">=</span><span class="number">0</span>,n=cp.length;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">char</span> c:cs)&#123;</span><br><span class="line">            <span class="keyword">if</span> (k&lt;n&amp;&amp;cp[k]==c) k++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> n-k;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æŠŠä»–ä»¬éƒ½è½¬ä¸ºæ•°ç»„ï¼Œç„¶åéå†ï¼Œå¦‚æœcp[k]=csé‡Œé¢çš„cçš„è¯ï¼Œè®¡æ•°å™¨k++;</p><p>ç„¶ååˆ°æœ€åä¸€ä¸ªç›¸ç­‰çš„åœ°æ–¹ï¼Œç„¶ån-kå°±æ˜¯éœ€è¦è¿½åŠ çš„æ•°é‡</p><h2 id="2825-å¾ªç¯å¢é•¿ä½¿å­—ç¬¦ä¸²å­åºåˆ—ç­‰äºå¦ä¸€ä¸ªå­—ç¬¦ä¸²"><a href="#2825-å¾ªç¯å¢é•¿ä½¿å­—ç¬¦ä¸²å­åºåˆ—ç­‰äºå¦ä¸€ä¸ªå­—ç¬¦ä¸²" class="headerlink" title="2825. å¾ªç¯å¢é•¿ä½¿å­—ç¬¦ä¸²å­åºåˆ—ç­‰äºå¦ä¸€ä¸ªå­—ç¬¦ä¸²"></a><a href="https://leetcode.cn/problems/make-string-a-subsequence-using-cyclic-increments/">2825. å¾ªç¯å¢é•¿ä½¿å­—ç¬¦ä¸²å­åºåˆ—ç­‰äºå¦ä¸€ä¸ªå­—ç¬¦ä¸²</a></h2><p>ç»™ä½ ä¸€ä¸ªä¸‹æ ‡ä» <strong>0</strong> å¼€å§‹çš„å­—ç¬¦ä¸² <code>str1</code> å’Œ <code>str2</code> ã€‚</p><p>ä¸€æ¬¡æ“ä½œä¸­ï¼Œä½ é€‰æ‹© <code>str1</code> ä¸­çš„è‹¥å¹²ä¸‹æ ‡ã€‚å¯¹äºé€‰ä¸­çš„æ¯ä¸€ä¸ªä¸‹æ ‡ <code>i</code> ï¼Œä½ å°† <code>str1[i]</code> <strong>å¾ªç¯</strong> é€’å¢ï¼Œå˜æˆä¸‹ä¸€ä¸ªå­—ç¬¦ã€‚ä¹Ÿå°±æ˜¯è¯´ <code>&#39;a&#39;</code> å˜æˆ <code>&#39;b&#39;</code> ï¼Œ<code>&#39;b&#39;</code> å˜æˆ <code>&#39;c&#39;</code> ï¼Œä»¥æ­¤ç±»æ¨ï¼Œ<code>&#39;z&#39;</code> å˜æˆ <code>&#39;a&#39;</code> ã€‚</p><p>å¦‚æœæ‰§è¡Œä»¥ä¸Šæ“ä½œ <strong>è‡³å¤šä¸€æ¬¡</strong> ï¼Œå¯ä»¥è®© <code>str2</code> æˆä¸º <code>str1</code> çš„å­åºåˆ—ï¼Œè¯·ä½ è¿”å› <code>true</code> ï¼Œå¦åˆ™è¿”å› <code>false</code> ã€‚</p><p><strong>æ³¨æ„ï¼š</strong>ä¸€ä¸ªå­—ç¬¦ä¸²çš„å­åºåˆ—æŒ‡çš„æ˜¯ä»åŸå­—ç¬¦ä¸²ä¸­åˆ é™¤ä¸€äº›ï¼ˆå¯ä»¥ä¸€ä¸ªå­—ç¬¦ä¹Ÿä¸åˆ ï¼‰å­—ç¬¦åï¼Œå‰©ä¸‹å­—ç¬¦æŒ‰ç…§åŸæœ¬å…ˆåé¡ºåºç»„æˆçš„æ–°å­—ç¬¦ä¸²ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">canMakeSubsequence</span><span class="params">(String str1, String str2)</span>&#123;</span><br><span class="line">        <span class="type">char</span>[] s1  = str1.toCharArray();</span><br><span class="line">        <span class="type">char</span>[] s2 = str2.toCharArray();</span><br><span class="line">        <span class="type">int</span> i=<span class="number">0</span>,j=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (i&lt;s1.length&amp;&amp;j&lt;s2.length)&#123;</span><br><span class="line">            <span class="type">char</span> <span class="variable">a</span>  <span class="operator">=</span>s1[i];</span><br><span class="line">            <span class="type">char</span> <span class="variable">b</span> <span class="operator">=</span> s2[j];</span><br><span class="line">            <span class="keyword">if</span> (a==b||(a-<span class="string">&#x27;a&#x27;</span>+<span class="number">1</span>)%<span class="number">26</span>==(b-<span class="string">&#x27;a&#x27;</span>))&#123;</span><br><span class="line">                j++;</span><br><span class="line">            &#125;</span><br><span class="line">            i++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> j==s2.length;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿˜æ˜¯æ ‡å‡†çš„å­åºåˆ—é—®é¢˜ï¼Œä¸¤ä¸ªæŒ‡é’ˆç§»åŠ¨ï¼Œå½“æ»¡è¶³æ¡ä»¶çš„æ—¶å€™å­åºåˆ—çš„æŒ‡é’ˆç§»åŠ¨</p><p>ç„¶åå­—å…¸çš„ä¸€ç›´ç§»åŠ¨</p><p>çœ‹æœ€åå­åºåˆ—çš„æŒ‡é’ˆèƒ½ä¸èƒ½åˆ°æœ«å°¾ï¼Œåˆ°äº†å°±è¯´æ˜æ˜¯ï¼Œååˆ™ä¸æ˜¯</p><h2 id="1023-é©¼å³°å¼åŒ¹é…"><a href="#1023-é©¼å³°å¼åŒ¹é…" class="headerlink" title="1023. é©¼å³°å¼åŒ¹é…"></a><a href="https://leetcode.cn/problems/camelcase-matching/">1023. é©¼å³°å¼åŒ¹é…</a></h2><p>ç»™ä½ ä¸€ä¸ªå­—ç¬¦ä¸²æ•°ç»„ <code>queries</code>ï¼Œå’Œä¸€ä¸ªè¡¨ç¤ºæ¨¡å¼çš„å­—ç¬¦ä¸² <code>pattern</code>ï¼Œè¯·ä½ è¿”å›ä¸€ä¸ªå¸ƒå°”æ•°ç»„ <code>answer</code> ã€‚åªæœ‰åœ¨å¾…æŸ¥é¡¹ <code>queries[i]</code> ä¸æ¨¡å¼ä¸² <code>pattern</code> åŒ¹é…æ—¶ï¼Œ <code>answer[i]</code> æ‰ä¸º <code>true</code>ï¼Œå¦åˆ™ä¸º <code>false</code>ã€‚</p><p>å¦‚æœå¯ä»¥å°† <strong>å°å†™å­—æ¯</strong> æ’å…¥æ¨¡å¼ä¸² <code>pattern</code> å¾—åˆ°å¾…æŸ¥è¯¢é¡¹ <code>queries[i]</code>ï¼Œé‚£ä¹ˆå¾…æŸ¥è¯¢é¡¹ä¸ç»™å®šæ¨¡å¼ä¸²åŒ¹é…ã€‚æ‚¨å¯ä»¥åœ¨æ¨¡å¼ä¸²ä¸­çš„ä»»ä½•ä½ç½®æ’å…¥å­—ç¬¦ï¼Œä¹Ÿå¯ä»¥é€‰æ‹©ä¸æ’å…¥ä»»ä½•å­—ç¬¦ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution1023</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">check</span><span class="params">(String s,String t)</span>&#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">m</span> <span class="operator">=</span> s.length(),n = t.length();</span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span>  <span class="operator">=</span><span class="number">0</span>,j=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (;j&lt;n;++i,++j)&#123;</span><br><span class="line">            <span class="keyword">while</span> (i&lt;m&amp;&amp;s.charAt(i)!=t.charAt(j)&amp;&amp;Character.isLowerCase(s.charAt(i)))&#123;</span><br><span class="line">                ++i;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (i==m||s.charAt(i)!=t.charAt(j))&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">while</span> (i&lt;m&amp;&amp;Character.isLowerCase(s.charAt(i)))&#123;</span><br><span class="line">            ++i;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> i==m;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> List&lt;Boolean&gt; <span class="title function_">camelMatch</span><span class="params">(String[] queries, String pattern)</span>&#123;</span><br><span class="line">        List&lt;Boolean&gt; ans  = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (String q:queries)&#123;</span><br><span class="line">            ans.add(check(q,pattern));</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å°±åˆ†åˆ«å–æ£€æµ‹æ¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œcheckè¿™ä¸ªæ˜¯ä¸æ˜¯èƒ½ç¬¦åˆå­åºåˆ—çš„è¦æ±‚</p><p>ç„¶åcheckæ£€æµ‹å­åºåˆ—</p><p>ä¸ç›¸ç­‰ï¼Œæ²¡åˆ°sçš„æœ«å°¾ï¼Œå°å†™çš„åŒ–ï¼ŒæŒ‡é’ˆç§»åŠ¨è·³è¿‡</p><p>ç„¶åæŒ‡é’ˆåˆ°äº†æœ«å°¾ï¼Œå¦‚æœä¸ç›¸ç­‰çš„åŒ–å°±è¿”å›false</p><p>æœ€åçœ‹æŒ‡é’ˆæ˜¯ä¸æ˜¯åœ¨æœ«å°¾äº†</p><h2 id="522-æœ€é•¿ç‰¹æ®Šåºåˆ—-II"><a href="#522-æœ€é•¿ç‰¹æ®Šåºåˆ—-II" class="headerlink" title="522. æœ€é•¿ç‰¹æ®Šåºåˆ— II"></a><a href="https://leetcode.cn/problems/longest-uncommon-subsequence-ii/">522. æœ€é•¿ç‰¹æ®Šåºåˆ— II</a></h2><p>ç»™å®šå­—ç¬¦ä¸²åˆ—è¡¨ <code>strs</code> ï¼Œè¿”å›å…¶ä¸­ <strong>æœ€é•¿çš„ç‰¹æ®Šåºåˆ—</strong> çš„é•¿åº¦ã€‚å¦‚æœæœ€é•¿ç‰¹æ®Šåºåˆ—ä¸å­˜åœ¨ï¼Œè¿”å› <code>-1</code> ã€‚</p><p><strong>ç‰¹æ®Šåºåˆ—</strong> å®šä¹‰å¦‚ä¸‹ï¼šè¯¥åºåˆ—ä¸ºæŸå­—ç¬¦ä¸² <strong>ç‹¬æœ‰çš„å­åºåˆ—ï¼ˆå³ä¸èƒ½æ˜¯å…¶ä»–å­—ç¬¦ä¸²çš„å­åºåˆ—ï¼‰</strong>ã€‚</p><p> <code>s</code> çš„ <strong>å­åºåˆ—</strong>å¯ä»¥é€šè¿‡åˆ å»å­—ç¬¦ä¸² <code>s</code> ä¸­çš„æŸäº›å­—ç¬¦å®ç°ã€‚</p><ul><li>ä¾‹å¦‚ï¼Œ<code>&quot;abc&quot;</code> æ˜¯ <code>&quot;aebdc&quot;</code> çš„å­åºåˆ—ï¼Œå› ä¸ºæ‚¨å¯ä»¥åˆ é™¤<code>&quot;aebdc&quot;</code>ä¸­çš„ä¸‹åˆ’çº¿å­—ç¬¦æ¥å¾—åˆ° <code>&quot;abc&quot;</code> ã€‚<code>&quot;aebdc&quot;</code>çš„å­åºåˆ—è¿˜åŒ…æ‹¬<code>&quot;aebdc&quot;</code>ã€ <code>&quot;aeb&quot;</code> å’Œ â€œâ€ (ç©ºå­—ç¬¦ä¸²)ã€‚</li></ul><p>å› ä¸ºå­åºåˆ—è¶Šé•¿ï¼Œè¶Šä¸å¯èƒ½æ˜¯å…¶å®ƒå­—ç¬¦ä¸²çš„å­åºåˆ—</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">isSubseq</span><span class="params">(String s, String t)</span>&#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span><span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">char</span> c:t.toCharArray())&#123;</span><br><span class="line">            <span class="keyword">if</span> (s.charAt(i)==c&amp;&amp;++i==s.length())&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>åˆ¤æ–­å­åºåˆ—çš„ç®€å•ç®—æ³•</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution522</span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">isSubseq</span><span class="params">(String s, String t)</span>&#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span><span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">char</span> c:t.toCharArray())&#123;</span><br><span class="line">            <span class="keyword">if</span> (s.charAt(i)==c&amp;&amp;++i==s.length())&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">findLUSlength</span><span class="params">(String[] strs)</span>&#123;</span><br><span class="line">        Arrays.sort(strs,(a,b)-&gt;b.length()-a.length());</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span><span class="number">0</span>;i&lt;strs.length;i++)&#123;</span><br><span class="line">            <span class="type">boolean</span> <span class="variable">isSub</span> <span class="operator">=</span> <span class="literal">false</span>;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span>  <span class="operator">=</span> <span class="number">0</span>;j&lt;strs.length;j++)&#123;</span><br><span class="line">                <span class="keyword">if</span> (i==j) <span class="keyword">continue</span>;</span><br><span class="line">                <span class="keyword">if</span> (isSubseq(strs[i],strs[j]))&#123;</span><br><span class="line">                    isSub  = <span class="literal">true</span>;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (!isSub) <span class="keyword">return</span> strs[i].length();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> -<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å°±å»éå†æ•´ä¸ª</p><p>i==jç»§ç»­</p><p>ç„¶åå¦‚æœæ˜¯å­åºåˆ—çš„åŒ–ï¼Œisè®¾ä¸ºtrue</p><p>ç„¶åå¦‚æœif (!isSub) return strs[i].length();</p><p>æ‰¾åˆ°ä¸æ˜¯ä»»ä½•äººçš„å­åºåˆ—</p><p>å°±è¿”å›-1</p><p>ç„¶åå¯ä»¥è¿”å›æ•°é‡</p><h1 id="ä¸‰æŒ‡é’ˆ"><a href="#ä¸‰æŒ‡é’ˆ" class="headerlink" title="ä¸‰æŒ‡é’ˆ"></a>ä¸‰æŒ‡é’ˆ</h1><h2 id="2367-ç­‰å·®ä¸‰å…ƒç»„çš„æ•°ç›®"><a href="#2367-ç­‰å·®ä¸‰å…ƒç»„çš„æ•°ç›®" class="headerlink" title="2367. ç­‰å·®ä¸‰å…ƒç»„çš„æ•°ç›®"></a><a href="https://leetcode.cn/problems/number-of-arithmetic-triplets/">2367. ç­‰å·®ä¸‰å…ƒç»„çš„æ•°ç›®</a></h2><p>ç»™ä½ ä¸€ä¸ªä¸‹æ ‡ä» <strong>0</strong> å¼€å§‹ã€<strong>ä¸¥æ ¼é€’å¢</strong> çš„æ•´æ•°æ•°ç»„ <code>nums</code> å’Œä¸€ä¸ªæ­£æ•´æ•° <code>diff</code> ã€‚å¦‚æœæ»¡è¶³ä¸‹è¿°å…¨éƒ¨æ¡ä»¶ï¼Œåˆ™ä¸‰å…ƒç»„ <code>(i, j, k)</code> å°±æ˜¯ä¸€ä¸ª <strong>ç­‰å·®ä¸‰å…ƒç»„</strong> ï¼š</p><ul><li><code>i &lt; j &lt; k</code> ï¼Œ</li><li><code>nums[j] - nums[i] == diff</code> ä¸”</li><li><code>nums[k] - nums[j] == diff</code></li></ul><p>è¿”å›ä¸åŒ <strong>ç­‰å·®ä¸‰å…ƒç»„</strong> çš„æ•°ç›®<em>ã€‚</em></p><p>hashè¡¨æ³•å…ˆæ¥ä¸ªï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution2367</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">arithmeticTriplets</span><span class="params">(<span class="type">int</span>[] nums, <span class="type">int</span> diff)</span>&#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">ans</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">HashSet</span> <span class="variable">set</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;Integer&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> x:nums) set.add(x);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> x:nums)&#123;</span><br><span class="line">            <span class="keyword">if</span> (set.contains(x-diff)&amp;&amp;set.contains(x+diff))</span><br><span class="line">                ++ans;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç®€å•çš„hashsetå®ç°</p><p>ä¸‰æŒ‡é’ˆï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution2367</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">arithmeticTripletsA</span><span class="params">(<span class="type">int</span>[] nums, <span class="type">int</span> diff)</span>&#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">ans</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">HashSet</span> <span class="variable">set</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HashSet</span>&lt;Integer&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> x:nums) set.add(x);</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> x:nums)&#123;</span><br><span class="line">            <span class="keyword">if</span> (set.contains(x-diff)&amp;&amp;set.contains(x+diff))</span><br><span class="line">                ++ans;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">arithmeticTriplets</span><span class="params">(<span class="type">int</span>[] nums, <span class="type">int</span> diff)</span>&#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">ans</span> <span class="operator">=</span> <span class="number">0</span>,i=<span class="number">0</span>,j=<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> x:nums)&#123;</span><br><span class="line">            <span class="keyword">while</span> (nums[j]+diff&lt;x)&#123;</span><br><span class="line">                ++j;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (nums[j]+diff&gt;x)&#123;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">while</span> (nums[i]+diff*<span class="number">2</span>&lt;x)&#123;</span><br><span class="line">                ++i;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (nums[i]+diff*<span class="number">2</span>==x)&#123;</span><br><span class="line">                ++ans;</span><br><span class="line">            &#125;</span><br><span class="line">           </span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="2563-ç»Ÿè®¡å…¬å¹³æ•°å¯¹çš„æ•°ç›®"><a href="#2563-ç»Ÿè®¡å…¬å¹³æ•°å¯¹çš„æ•°ç›®" class="headerlink" title="2563. ç»Ÿè®¡å…¬å¹³æ•°å¯¹çš„æ•°ç›®"></a><a href="https://leetcode.cn/problems/count-the-number-of-fair-pairs/">2563. ç»Ÿè®¡å…¬å¹³æ•°å¯¹çš„æ•°ç›®</a></h2><p>ç»™ä½ ä¸€ä¸ªä¸‹æ ‡ä» <strong>0</strong> å¼€å§‹ã€é•¿åº¦ä¸º <code>n</code> çš„æ•´æ•°æ•°ç»„ <code>nums</code> ï¼Œå’Œä¸¤ä¸ªæ•´æ•° <code>lower</code> å’Œ <code>upper</code> ï¼Œè¿”å› <strong>å…¬å¹³æ•°å¯¹çš„æ•°ç›®</strong> ã€‚</p><p>å¦‚æœ <code>(i, j)</code> æ•°å¯¹æ»¡è¶³ä»¥ä¸‹æƒ…å†µï¼Œåˆ™è®¤ä¸ºå®ƒæ˜¯ä¸€ä¸ª <strong>å…¬å¹³æ•°å¯¹</strong> ï¼š</p><ul><li><code>0 &lt;= i &lt; j &lt; n</code>ï¼Œä¸”</li><li><code>lower &lt;= nums[i] + nums[j] &lt;= upper</code></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution2536</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">long</span> <span class="title function_">countFairPairs</span><span class="params">(<span class="type">int</span>[] nums, <span class="type">int</span> lower, <span class="type">int</span> upper)</span>&#123;</span><br><span class="line">        Arrays.sort(nums);</span><br><span class="line">        <span class="type">long</span> <span class="variable">ans</span>  <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">l</span>  <span class="operator">=</span> nums.length;</span><br><span class="line">        <span class="type">int</span> <span class="variable">r</span>  <span class="operator">=</span> nums.length;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span><span class="number">0</span>;j&lt;nums.length;j++)&#123;</span><br><span class="line">            <span class="keyword">while</span> (r&gt;<span class="number">0</span>&amp;&amp;nums[r-<span class="number">1</span>]&gt;upper-nums[j])&#123;</span><br><span class="line">                r--;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">while</span> (l&gt;<span class="number">0</span>&amp;&amp;nums[l-<span class="number">1</span>]&gt;=lower-nums[j])&#123;</span><br><span class="line">                l--;</span><br><span class="line">            &#125;</span><br><span class="line">            ans +=Math.min(r,j)-Math.min(l,j);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸‰æŒ‡é’ˆå†™æ³•ï¼Œã€</p><p>æ‰¾ &gt;<em>upper</em>âˆ’<em>nums</em>[<em>j</em>] çš„ç¬¬ä¸€ä¸ªæ•°</p><p>æ‰¾ â‰¥<em>lower</em>âˆ’<em>nums</em>[<em>j</em>] çš„ç¬¬ä¸€ä¸ªæ•°</p><p>ä½¿ç”¨äºŒåˆ†æŸ¥æ‰¾çš„è¯ä¹Ÿæ˜¯æ‰¾è¿™ä¸¤ä¸ªæ•°</p><p>æ‰¾åˆ°è¿™ä¸¤ä¸ªæ•°</p><p>ä»–ä»¬ä¹‹é—´çš„æ•°é‡å°±æ˜¯æ•°ç›®æœ€åçš„ç­”æ¡ˆ</p><p>ç„¶åç´¯åŠ å³å¯</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">while (r&gt;0&amp;&amp;nums[r-1]&gt;upper-nums[j])&#123;</span><br><span class="line">                r--;</span><br><span class="line">            &#125;</span><br><span class="line">            while (l&gt;0&amp;&amp;nums[l-1]&gt;=lower-nums[j])&#123;</span><br><span class="line">                l--;</span><br><span class="line">            &#125;</span><br></pre></td></tr></table></figure><p>åšåˆ°äº†ç±»ä¼¼äºŒåˆ†æŸ¥æ‰¾çš„åŠŸèƒ½</p><h1 id="åˆ†ç»„å¾ªç¯"><a href="#åˆ†ç»„å¾ªç¯" class="headerlink" title="åˆ†ç»„å¾ªç¯"></a>åˆ†ç»„å¾ªç¯</h1><p><strong>é€‚ç”¨åœºæ™¯</strong>ï¼šæŒ‰ç…§é¢˜ç›®è¦æ±‚ï¼Œæ•°ç»„ä¼šè¢«åˆ†å‰²æˆè‹¥å¹²ç»„ï¼Œæ¯ä¸€ç»„çš„åˆ¤æ–­/å¤„ç†é€»è¾‘æ˜¯ç›¸åŒçš„ã€‚</p><p>æ ¸å¿ƒæ€æƒ³ï¼š</p><p>å¤–å±‚å¾ªç¯è´Ÿè´£éå†ç»„ä¹‹å‰çš„å‡†å¤‡å·¥ä½œï¼ˆè®°å½•å¼€å§‹ä½ç½®ï¼‰ï¼Œå’Œéå†ç»„ä¹‹åçš„ç»Ÿè®¡å·¥ä½œï¼ˆæ›´æ–°ç­”æ¡ˆæœ€å¤§å€¼ï¼‰ã€‚<br>å†…å±‚å¾ªç¯è´Ÿè´£éå†ç»„ï¼Œæ‰¾å‡ºè¿™ä¸€ç»„æœ€è¿œåœ¨å“ªç»“æŸã€‚<br>è¿™ä¸ªå†™æ³•çš„å¥½å¤„æ˜¯ï¼Œå„ä¸ªé€»è¾‘å—åˆ†å·¥æ˜ç¡®ï¼Œä¹Ÿä¸éœ€è¦ç‰¹åˆ¤æœ€åä¸€ç»„ï¼ˆæ˜“é”™ç‚¹ï¼‰ã€‚ä»¥æˆ‘çš„ç»éªŒï¼Œè¿™ä¸ªå†™æ³•æ˜¯æ‰€æœ‰å†™æ³•ä¸­æœ€ä¸å®¹æ˜“å‡º bug çš„ï¼Œæ¨èå¤§å®¶è®°ä½ã€‚</p><h2 id="1446-è¿ç»­å­—ç¬¦"><a href="#1446-è¿ç»­å­—ç¬¦" class="headerlink" title="1446. è¿ç»­å­—ç¬¦"></a><a href="https://leetcode.cn/problems/consecutive-characters/">1446. è¿ç»­å­—ç¬¦</a></h2><p>ç»™ä½ ä¸€ä¸ªå­—ç¬¦ä¸² <code>s</code> ï¼Œå­—ç¬¦ä¸²çš„<strong>ã€Œèƒ½é‡ã€</strong>å®šä¹‰ä¸ºï¼šåªåŒ…å«ä¸€ç§å­—ç¬¦çš„æœ€é•¿éç©ºå­å­—ç¬¦ä¸²çš„é•¿åº¦ã€‚</p><p>è¯·ä½ è¿”å›å­—ç¬¦ä¸² <code>s</code> çš„ <strong>èƒ½é‡</strong>ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution1446</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">maxPower</span><span class="params">(String s)</span> &#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span> s.length(), ans = <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; n;) &#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span> i;</span><br><span class="line">            <span class="comment">// å†…å±‚å¾ªç¯æ‰¾å‡ºä» i å¼€å§‹è¿™ä¸€ç»„å­—ç¬¦æœ€è¿œèƒ½å»¶ä¼¸åˆ°å“ªé‡Œ</span></span><br><span class="line">            <span class="keyword">while</span> (j &lt; n &amp;&amp; s.charAt(j) == s.charAt(i)) &#123;</span><br><span class="line">                j++;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// ç»Ÿè®¡è¿™ä¸€ç»„çš„é•¿åº¦ï¼Œæ›´æ–°æœ€å¤§å€¼</span></span><br><span class="line">            ans = Math.max(ans, j - i);</span><br><span class="line">            <span class="comment">// i æŒ‡å‘ä¸‹ä¸€ç»„çš„å¼€å¤´</span></span><br><span class="line">            i = j;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h2 id="1869-å“ªç§è¿ç»­å­å­—ç¬¦ä¸²æ›´é•¿"><a href="#1869-å“ªç§è¿ç»­å­å­—ç¬¦ä¸²æ›´é•¿" class="headerlink" title="1869. å“ªç§è¿ç»­å­å­—ç¬¦ä¸²æ›´é•¿"></a><a href="https://leetcode.cn/problems/longer-contiguous-segments-of-ones-than-zeros/">1869. å“ªç§è¿ç»­å­å­—ç¬¦ä¸²æ›´é•¿</a></h2><p>ç»™ä½ ä¸€ä¸ªäºŒè¿›åˆ¶å­—ç¬¦ä¸² <code>s</code> ã€‚å¦‚æœå­—ç¬¦ä¸²ä¸­ç”± <code>1</code> ç»„æˆçš„ <strong>æœ€é•¿</strong> è¿ç»­å­å­—ç¬¦ä¸² <strong>ä¸¥æ ¼é•¿äº</strong> ç”± <code>0</code> ç»„æˆçš„ <strong>æœ€é•¿</strong> è¿ç»­å­å­—ç¬¦ä¸²ï¼Œè¿”å› <code>true</code> ï¼›å¦åˆ™ï¼Œè¿”å› <code>false</code> ã€‚</p><ul><li>ä¾‹å¦‚ï¼Œ<code>s = &quot;**11**01**000**10&quot;</code> ä¸­ï¼Œç”± <code>1</code> ç»„æˆçš„æœ€é•¿è¿ç»­å­å­—ç¬¦ä¸²çš„é•¿åº¦æ˜¯ <code>2</code> ï¼Œç”± <code>0</code> ç»„æˆçš„æœ€é•¿è¿ç»­å­å­—ç¬¦ä¸²çš„é•¿åº¦æ˜¯ <code>3</code> ã€‚</li></ul><p>æ³¨æ„ï¼Œå¦‚æœå­—ç¬¦ä¸²ä¸­ä¸å­˜åœ¨ <code>0</code> ï¼Œæ­¤æ—¶è®¤ä¸ºç”± <code>0</code> ç»„æˆçš„æœ€é•¿è¿ç»­å­å­—ç¬¦ä¸²çš„é•¿åº¦æ˜¯ <code>0</code> ã€‚å­—ç¬¦ä¸²ä¸­ä¸å­˜åœ¨ <code>1</code> çš„æƒ…å†µä¹Ÿé€‚ç”¨æ­¤è§„åˆ™ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution1869</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">checkZeroOnes</span><span class="params">(String s)</span>&#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">n</span>  <span class="operator">=</span> s.length();</span><br><span class="line">        <span class="type">int</span> max1=  <span class="number">0</span>,max0=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span><span class="number">0</span>;i&lt;n;)&#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">j</span> <span class="operator">=</span>i;</span><br><span class="line">            <span class="keyword">while</span> (j&lt;n&amp;&amp;s.charAt(j)==s.charAt(i)) j++;</span><br><span class="line">            <span class="type">int</span> len=  j-i;</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (s.charAt(i)==<span class="number">1</span>)&#123;</span><br><span class="line">                max1 = Math.max(max1,len);</span><br><span class="line">            &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                max0=Math.max(max0,len);</span><br><span class="line">            &#125;</span><br><span class="line">            i=j;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> max1&gt;max0;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿˜æ˜¯ç®€å•çš„ç»Ÿè®¡é•¿åº¦ï¼Œæ˜¯1å°±å½’ä¸º1ï¼Œæ˜¯0å°±å½’ä¸º0</p><p>æ›´æ–°æœ€å¤§å€¼</p><p>ç„¶åæœ€åçœ‹æ˜¯ä¸æ˜¯å¤§äºã€‚</p><h2 id="2414-æœ€é•¿çš„å­—æ¯åºè¿ç»­å­å­—ç¬¦ä¸²çš„é•¿åº¦"><a href="#2414-æœ€é•¿çš„å­—æ¯åºè¿ç»­å­å­—ç¬¦ä¸²çš„é•¿åº¦" class="headerlink" title="2414. æœ€é•¿çš„å­—æ¯åºè¿ç»­å­å­—ç¬¦ä¸²çš„é•¿åº¦"></a><a href="https://leetcode.cn/problems/length-of-the-longest-alphabetical-continuous-substring/">2414. æœ€é•¿çš„å­—æ¯åºè¿ç»­å­å­—ç¬¦ä¸²çš„é•¿åº¦</a></h2><p><strong>å­—æ¯åºè¿ç»­å­—ç¬¦ä¸²</strong> æ˜¯ç”±å­—æ¯è¡¨ä¸­è¿ç»­å­—æ¯ç»„æˆçš„å­—ç¬¦ä¸²ã€‚æ¢å¥è¯è¯´ï¼Œå­—ç¬¦ä¸² <code>&quot;abcdefghijklmnopqrstuvwxyz&quot;</code> çš„ä»»æ„å­å­—ç¬¦ä¸²éƒ½æ˜¯ <strong>å­—æ¯åºè¿ç»­å­—ç¬¦ä¸²</strong> ã€‚</p><ul><li>ä¾‹å¦‚ï¼Œ<code>&quot;abc&quot;</code> æ˜¯ä¸€ä¸ªå­—æ¯åºè¿ç»­å­—ç¬¦ä¸²ï¼Œè€Œ <code>&quot;acb&quot;</code> å’Œ <code>&quot;za&quot;</code> ä¸æ˜¯ã€‚</li></ul><p>ç»™ä½ ä¸€ä¸ªä»…ç”±å°å†™è‹±æ–‡å­—æ¯ç»„æˆçš„å­—ç¬¦ä¸² <code>s</code> ï¼Œè¿”å›å…¶ <strong>æœ€é•¿</strong> çš„ å­—æ¯åºè¿ç»­å­å­—ç¬¦ä¸² çš„é•¿åº¦ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution2414</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">longestContinuousSubstring</span><span class="params">(String S)</span>&#123;</span><br><span class="line">        <span class="type">char</span>[] s = S.toCharArray();</span><br><span class="line">        <span class="type">int</span> <span class="variable">ans</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">cnt</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> i=<span class="number">1</span>;i&lt;s.length;i++)&#123;</span><br><span class="line">            <span class="keyword">if</span> (s[i-<span class="number">1</span>]+<span class="number">1</span>==s[i])&#123;</span><br><span class="line">                ans = Math.max(ans,++cnt);</span><br><span class="line">            &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                cnt = <span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç›´æ¥éå†ï¼Œå¦‚æœs[i-1]+1==s[i]å°±cnt+1,ç„¶åæ‰¾å‡ºanså³å¯</p><h2 id="1957-åˆ é™¤å­—ç¬¦ä½¿å­—ç¬¦ä¸²å˜å¥½"><a href="#1957-åˆ é™¤å­—ç¬¦ä½¿å­—ç¬¦ä¸²å˜å¥½" class="headerlink" title="1957. åˆ é™¤å­—ç¬¦ä½¿å­—ç¬¦ä¸²å˜å¥½"></a><a href="https://leetcode.cn/problems/delete-characters-to-make-fancy-string/">1957. åˆ é™¤å­—ç¬¦ä½¿å­—ç¬¦ä¸²å˜å¥½</a></h2><p>ä¸€ä¸ªå­—ç¬¦ä¸²å¦‚æœæ²¡æœ‰ <strong>ä¸‰ä¸ªè¿ç»­</strong> ç›¸åŒå­—ç¬¦ï¼Œé‚£ä¹ˆå®ƒå°±æ˜¯ä¸€ä¸ª <strong>å¥½å­—ç¬¦ä¸²</strong> ã€‚</p><p>ç»™ä½ ä¸€ä¸ªå­—ç¬¦ä¸² <code>s</code> ï¼Œè¯·ä½ ä» <code>s</code> åˆ é™¤ <strong>æœ€å°‘</strong> çš„å­—ç¬¦ï¼Œä½¿å®ƒå˜æˆä¸€ä¸ª <strong>å¥½å­—ç¬¦ä¸²</strong> ã€‚</p><p>è¯·ä½ è¿”å›åˆ é™¤åçš„å­—ç¬¦ä¸²ã€‚é¢˜ç›®æ•°æ®ä¿è¯ç­”æ¡ˆæ€»æ˜¯ <strong>å”¯ä¸€çš„</strong> ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution1957</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">makeFancyString</span><span class="params">(String s)</span>&#123;</span><br><span class="line">        <span class="type">StringBuilder</span> <span class="variable">res</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">StringBuilder</span>();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">char</span> ch:s.toCharArray())&#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">n</span> <span class="operator">=</span>res.length();</span><br><span class="line">            <span class="keyword">if</span> (n&gt;=<span class="number">2</span>&amp;&amp;ch==res.charAt(n-<span class="number">1</span>)&amp;&amp;ch==res.charAt(n-<span class="number">2</span>))&#123;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            res.append(ch);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> res.toString();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸€å¼€å§‹æˆ‘æƒ³çš„æ˜¯é‡åˆ°3ä¸ªè¿ç»­çš„å°±ä¸ç®¡ï¼Œç»Ÿè®¡ä»–ä»¬æ•°ç›®ï¼Œä¸€çœ‹ä¸æ˜¯æ•°ç›®</p><p>å“ˆå“ˆå°±å˜æˆäº†æ˜¯3ä¸ªè¿ç»­çš„å°±ä¸è¿›å…¥</p><h2 id="674-æœ€é•¿è¿ç»­é€’å¢åºåˆ—"><a href="#674-æœ€é•¿è¿ç»­é€’å¢åºåˆ—" class="headerlink" title="674. æœ€é•¿è¿ç»­é€’å¢åºåˆ—"></a><a href="https://leetcode.cn/problems/longest-continuous-increasing-subsequence/">674. æœ€é•¿è¿ç»­é€’å¢åºåˆ—</a></h2><p>ç»™å®šä¸€ä¸ªæœªç»æ’åºçš„æ•´æ•°æ•°ç»„ï¼Œæ‰¾åˆ°æœ€é•¿ä¸” <strong>è¿ç»­é€’å¢çš„å­åºåˆ—</strong>ï¼Œå¹¶è¿”å›è¯¥åºåˆ—çš„é•¿åº¦ã€‚</p><p><strong>è¿ç»­é€’å¢çš„å­åºåˆ—</strong> å¯ä»¥ç”±ä¸¤ä¸ªä¸‹æ ‡ <code>l</code> å’Œ <code>r</code>ï¼ˆ<code>l &lt; r</code>ï¼‰ç¡®å®šï¼Œå¦‚æœå¯¹äºæ¯ä¸ª <code>l &lt;= i &lt; r</code>ï¼Œéƒ½æœ‰ <code>nums[i] &lt; nums[i + 1]</code> ï¼Œé‚£ä¹ˆå­åºåˆ— <code>[nums[l], nums[l + 1], ..., nums[r - 1], nums[r]]</code> å°±æ˜¯è¿ç»­é€’å¢å­åºåˆ—ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution674</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">findLengthOfLCIS</span><span class="params">(<span class="type">int</span>[] nums)</span>&#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">l</span> <span class="operator">=</span><span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">r</span>  <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">len</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (r&lt;nums.length)&#123;</span><br><span class="line">            <span class="keyword">if</span> (r==l||nums[r-<span class="number">1</span>]&lt;nums[r])&#123;</span><br><span class="line">                len = Math.max(len,r-l+<span class="number">1</span>);</span><br><span class="line">                r++;</span><br><span class="line">            &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                l = r;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> len;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å°±æ˜¯æ¯”è¾ƒå‰é¢ä¸€ä¸ªå¤§äºåé¢çš„å°±ç§»åŠ¨ï¼Œä¸­æ–­äº†å°±ä»å½“å‰è¿™ä¸ªå¼€å§‹</p><p>å°±è·Ÿä¸ªæ»‘åŠ¨çª—å£ä¼¼çš„</p><h2 id="978-æœ€é•¿æ¹æµå­æ•°ç»„"><a href="#978-æœ€é•¿æ¹æµå­æ•°ç»„" class="headerlink" title="978. æœ€é•¿æ¹æµå­æ•°ç»„"></a><a href="https://leetcode.cn/problems/longest-turbulent-subarray/">978. æœ€é•¿æ¹æµå­æ•°ç»„</a></h2><p>ç»™å®šä¸€ä¸ªæ•´æ•°æ•°ç»„ <code>arr</code> ï¼Œè¿”å› <code>arr</code> çš„ <em>æœ€å¤§æ¹æµå­æ•°ç»„çš„<strong>é•¿åº¦</strong></em> ã€‚</p><p>å¦‚æœæ¯”è¾ƒç¬¦å·åœ¨å­æ•°ç»„ä¸­çš„æ¯ä¸ªç›¸é‚»å…ƒç´ å¯¹ä¹‹é—´ç¿»è½¬ï¼Œåˆ™è¯¥å­æ•°ç»„æ˜¯ <strong>æ¹æµå­æ•°ç»„</strong> ã€‚</p><p>æ›´æ­£å¼åœ°æ¥è¯´ï¼Œå½“ <code>arr</code> çš„å­æ•°ç»„ <code>A[i], A[i+1], ..., A[j]</code> æ»¡è¶³ä»…æ»¡è¶³ä¸‹åˆ—æ¡ä»¶æ—¶ï¼Œæˆ‘ä»¬ç§°å…¶ä¸º<em>æ¹æµå­æ•°ç»„</em>ï¼š</p><ul><li><p>è‹¥ </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">i &lt;= k &lt; j</span><br></pre></td></tr></table></figure><p> ï¼š</p><ul><li>å½“ <code>k</code> ä¸ºå¥‡æ•°æ—¶ï¼Œ <code>A[k] &gt; A[k+1]</code>ï¼Œä¸”</li><li>å½“ <code>k</code> ä¸ºå¶æ•°æ—¶ï¼Œ<code>A[k] &lt; A[k+1]</code>ï¼›</li></ul></li><li><p>æˆ– </p><p>è‹¥ </p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">i &lt;= k &lt; j</span><br></pre></td></tr></table></figure><p> ï¼š</p><ul><li>å½“ <code>k</code> ä¸ºå¶æ•°æ—¶ï¼Œ<code>A[k] &gt; A[k+1]</code> ï¼Œä¸”</li><li>å½“ <code>k</code> ä¸ºå¥‡æ•°æ—¶ï¼Œ <code>A[k] &lt; A[k+1]</code>ã€‚</li></ul></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution978</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">maxTurbulenceSize</span><span class="params">(<span class="type">int</span>[] arr)</span>&#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">ans</span> <span class="operator">=</span> <span class="number">1</span>, left = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">right</span> <span class="operator">=</span> <span class="number">1</span>;right&lt;arr.length;right++)&#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">c</span> <span class="operator">=</span> Integer.compare(arr[right-<span class="number">1</span>],arr[right]);</span><br><span class="line">            <span class="keyword">if</span> (right==arr.length-<span class="number">1</span>||c*Integer.compare(arr[right],arr[right+<span class="number">1</span>])!=-<span class="number">1</span>)&#123;</span><br><span class="line">                <span class="keyword">if</span> (c!=<span class="number">0</span>)&#123;</span><br><span class="line">                    ans = Math.max(ans,right-left+<span class="number">1</span>);</span><br><span class="line">                &#125;</span><br><span class="line">                left = right;</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªé¢˜ç›®å’Œä¸Šä¸ªé¢˜ç›®ç±»ä¼¼ï¼Œåªä¸è¿‡æ˜¯å¥‡æ•°çš„æ—¶å€™å‰é¢å¤§ï¼Œå¶æ•°çš„æ—¶å€™åé¢çš„å¤§ã€‚æˆ–è€…ç›¸åï¼Œå°±æ˜¯ç±»ä¼¼æ³¢æµªçš„æ„Ÿè§‰</p><p>æ‰€ä»¥è¦æ˜¯è¿™æ ·çš„è¯ï¼Œä¸­é—´çš„rightå°±æ˜¯æœ€å°æˆ–è€…æœ€å¤§çš„ï¼Œåœ¨æ³¢ä¹‹ä¸­</p><p>è¿™æ ·çš„è¯è¯´æ˜å­æ•°ç»„è¯¥ç»“æŸäº†ï¼Œçª—å£çš„å¤§å°å°±æ˜¯å­æ•°ç»„çš„é•¿åº¦</p><h2 id="2110-è‚¡ç¥¨å¹³æ»‘ä¸‹è·Œé˜¶æ®µçš„æ•°ç›®"><a href="#2110-è‚¡ç¥¨å¹³æ»‘ä¸‹è·Œé˜¶æ®µçš„æ•°ç›®" class="headerlink" title="2110. è‚¡ç¥¨å¹³æ»‘ä¸‹è·Œé˜¶æ®µçš„æ•°ç›®"></a><a href="https://leetcode.cn/problems/number-of-smooth-descent-periods-of-a-stock/">2110. è‚¡ç¥¨å¹³æ»‘ä¸‹è·Œé˜¶æ®µçš„æ•°ç›®</a></h2><p>ç»™ä½ ä¸€ä¸ªæ•´æ•°æ•°ç»„ <code>prices</code> ï¼Œè¡¨ç¤ºä¸€æ”¯è‚¡ç¥¨çš„å†å²æ¯æ—¥è‚¡ä»·ï¼Œå…¶ä¸­ <code>prices[i]</code> æ˜¯è¿™æ”¯è‚¡ç¥¨ç¬¬ <code>i</code> å¤©çš„ä»·æ ¼ã€‚</p><p>ä¸€ä¸ª <strong>å¹³æ»‘ä¸‹é™çš„é˜¶æ®µ</strong> å®šä¹‰ä¸ºï¼šå¯¹äº <strong>è¿ç»­ä¸€å¤©æˆ–è€…å¤šå¤©</strong> ï¼Œæ¯æ—¥è‚¡ä»·éƒ½æ¯” <strong>å‰ä¸€æ—¥è‚¡ä»·æ°å¥½å°‘</strong> <code>1</code> ï¼Œè¿™ä¸ªé˜¶æ®µç¬¬ä¸€å¤©çš„è‚¡ä»·æ²¡æœ‰é™åˆ¶ã€‚</p><p>è¯·ä½ è¿”å› <strong>å¹³æ»‘ä¸‹é™é˜¶æ®µ</strong> çš„æ•°ç›®ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution2110</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">long</span> <span class="title function_">getDescentPeriods</span><span class="params">(<span class="type">int</span>[] prices)</span>&#123;</span><br><span class="line">        <span class="type">long</span> <span class="variable">ans</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">right</span> <span class="operator">=</span> <span class="number">0</span>,left = <span class="number">0</span>;right&lt;prices.length;right++)&#123;</span><br><span class="line">            <span class="keyword">while</span> (left!=right&amp;&amp;prices[right]-prices[right-<span class="number">1</span>]!=-<span class="number">1</span>)&#123;</span><br><span class="line">                left  =right;</span><br><span class="line">            &#125;</span><br><span class="line">            ans +=right-left+<span class="number">1L</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªé¢˜ç›®ä¹Ÿæ˜¯ç±»ä¼¼æ»‘åŠ¨çª—å£ã€‚</p><p>å½“ä¸æ˜¯ä¸‹é™çš„æ—¶å€™ï¼Œç›´æ¥ç»“æŸè¿™ä¸ªå­æ•°ç»„</p><h2 id="2765-æœ€é•¿äº¤æ›¿å­æ•°ç»„"><a href="#2765-æœ€é•¿äº¤æ›¿å­æ•°ç»„" class="headerlink" title="2765. æœ€é•¿äº¤æ›¿å­æ•°ç»„"></a><a href="https://leetcode.cn/problems/longest-alternating-subarray/">2765. æœ€é•¿äº¤æ›¿å­æ•°ç»„</a></h2><p>ç»™ä½ ä¸€ä¸ªä¸‹æ ‡ä» <strong>0</strong> å¼€å§‹çš„æ•´æ•°æ•°ç»„ <code>nums</code> ã€‚å¦‚æœ <code>nums</code> ä¸­é•¿åº¦ä¸º <code>m</code> çš„å­æ•°ç»„ <code>s</code> æ»¡è¶³ä»¥ä¸‹æ¡ä»¶ï¼Œæˆ‘ä»¬ç§°å®ƒæ˜¯ä¸€ä¸ª <strong>äº¤æ›¿å­æ•°ç»„</strong> ï¼š</p><ul><li><code>m</code> å¤§äº <code>1</code> ã€‚</li><li><code>s1 = s0 + 1</code> ã€‚</li><li>ä¸‹æ ‡ä» <strong>0</strong> å¼€å§‹çš„å­æ•°ç»„ <code>s</code> ä¸æ•°ç»„ <code>[s0, s1, s0, s1,...,s(m-1) % 2]</code> ä¸€æ ·ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œ<code>s1 - s0 = 1</code> ï¼Œ<code>s2 - s1 = -1</code> ï¼Œ<code>s3 - s2 = 1</code> ï¼Œ<code>s4 - s3 = -1</code> ï¼Œä»¥æ­¤ç±»æ¨ï¼Œç›´åˆ° <code>s[m - 1] - s[m - 2] = (-1)m</code> ã€‚</li></ul><p>è¯·ä½ è¿”å› <code>nums</code> ä¸­æ‰€æœ‰ <strong>äº¤æ›¿</strong> å­æ•°ç»„ä¸­ï¼Œæœ€é•¿çš„é•¿åº¦ï¼Œå¦‚æœä¸å­˜åœ¨äº¤æ›¿å­æ•°ç»„ï¼Œè¯·ä½ è¿”å› <code>-1</code> ã€‚</p><p>å­æ•°ç»„æ˜¯ä¸€ä¸ªæ•°ç»„ä¸­ä¸€æ®µè¿ç»­ <strong>éç©º</strong> çš„å…ƒç´ åºåˆ—ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution2765</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">alternatingSubarray</span><span class="params">(<span class="type">int</span>[] nums)</span>&#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">ans</span> <span class="operator">=</span> -<span class="number">1</span>,i=<span class="number">0</span>,n = nums.length;</span><br><span class="line">        <span class="keyword">while</span> (i&lt;n-<span class="number">1</span>)&#123;</span><br><span class="line">            <span class="keyword">if</span> (nums[i+<span class="number">1</span>]-nums[i]!=<span class="number">1</span>)&#123;</span><br><span class="line">                i++;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="type">int</span> <span class="variable">i0</span> <span class="operator">=</span> i;</span><br><span class="line">            i +=<span class="number">2</span>;</span><br><span class="line">            <span class="keyword">while</span> (i&lt;n&amp;&amp;nums[i]==nums[i-<span class="number">2</span>])&#123;</span><br><span class="line">                i++;</span><br><span class="line">            &#125;</span><br><span class="line">            ans = Math.max(ans,i-i0);</span><br><span class="line">            i--;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…ˆè®©å…¶å‰æ˜¯åçš„1çš„æƒ…å†µï¼Œç„¶åå†è€ƒè™‘æä¸€ä¸ªè¦ç›¸ç­‰çš„æƒ…å†µï¼Œæœ€åç»Ÿè®¡æ•°ç›®</p><p>ä¸€èˆ¬æ¥è¯´ï¼Œåˆ†ç»„å¾ªç¯çš„æ¨¡æ¿å¦‚ä¸‹ï¼ˆå¯æ ¹æ®é¢˜ç›®è°ƒæ•´ï¼‰ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">n = len(nums)</span><br><span class="line">i = 0</span><br><span class="line">while i &lt; n:</span><br><span class="line">    start = i</span><br><span class="line">    while i &lt; n and ...:</span><br><span class="line">        i += 1</span><br><span class="line">    # ä» start åˆ° i-1 æ˜¯ä¸€ç»„</span><br><span class="line">    # ä¸‹ä¸€ç»„ä» i å¼€å§‹ï¼Œæ— éœ€ i += 1</span><br></pre></td></tr></table></figure><p>å•Š</p>]]></content:encoded>
      
      
      <category domain="https://blog.tokenlen.top/categories/java/">java</category>
      
      
      <category domain="https://blog.tokenlen.top/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/">æ•°æ®ç»“æ„</category>
      
      <category domain="https://blog.tokenlen.top/tags/%E7%AE%97%E6%B3%95/">ç®—æ³•</category>
      
      <category domain="https://blog.tokenlen.top/tags/java/">java</category>
      
      <category domain="https://blog.tokenlen.top/tags/leetcode/">leetcode</category>
      
      
      <comments>https://blog.tokenlen.top/2025/05/12/leetcode/leetcode3/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>JUC-çº¿ç¨‹æ± </title>
      <link>https://blog.tokenlen.top/2025/05/09/java-stack/juc1/</link>
      <guid>https://blog.tokenlen.top/2025/05/09/java-stack/juc1/</guid>
      <pubDate>Thu, 08 May 2025 16:00:00 GMT</pubDate>
      
        
        
          
          
      <description>&lt;h1 id=&quot;å‰ç½®çŸ¥è¯†&quot;&gt;&lt;a href=&quot;#å‰ç½®çŸ¥è¯†&quot; class=&quot;headerlink&quot;</description>
          
        
      
      
      
      <content:encoded><![CDATA[<h1 id="å‰ç½®çŸ¥è¯†"><a href="#å‰ç½®çŸ¥è¯†" class="headerlink" title="å‰ç½®çŸ¥è¯†"></a>å‰ç½®çŸ¥è¯†</h1><p>JUCæ˜¯java.util.concurrentåŒ…çš„ç®€ç§°ï¼Œåœ¨Java5.0æ·»åŠ ï¼Œç›®çš„å°±æ˜¯ä¸ºäº†æ›´å¥½çš„æ”¯æŒ<strong>é«˜å¹¶å‘</strong>ä»»åŠ¡ã€‚è®©å¼€å‘è€…è¿›è¡Œå¤šçº¿ç¨‹ç¼–ç¨‹æ—¶å‡å°‘ç«äº‰æ¡ä»¶å’Œæ­»é”çš„é—®é¢˜ï¼</p><p>è¿›ç¨‹ï¼š<strong>ä¸€ä¸ªè¿è¡Œä¸­çš„ç¨‹åºçš„é›†åˆ</strong>; ä¸€ä¸ªè¿›ç¨‹å¾€å¾€å¯ä»¥åŒ…å«å¤šä¸ªçº¿ç¨‹,è‡³å°‘åŒ…å«ä¸€ä¸ªçº¿ç¨‹</p><p>Javaé»˜è®¤æœ‰å‡ ä¸ªçº¿ç¨‹? ä¸¤ä¸ª mainçº¿ç¨‹ gcçº¿ç¨‹</p><p>çº¿ç¨‹ï¼šçº¿ç¨‹ï¼ˆthreadï¼‰æ˜¯æ“ä½œç³»ç»Ÿèƒ½å¤Ÿè¿›è¡Œè¿ç®—è°ƒåº¦çš„æœ€å°å•ä½ã€‚</p><p>å¹¶å‘(å¤šçº¿ç¨‹æ“ä½œåŒä¸€ä¸ªèµ„æº,äº¤æ›¿æ‰§è¡Œ)<br>CPUä¸€æ ¸, æ¨¡æ‹Ÿå‡ºæ¥å¤šæ¡çº¿ç¨‹,å¤©ä¸‹æ­¦åŠŸ,å”¯å¿«ä¸ç ´,å¿«é€Ÿäº¤æ›¿<br>å¹¶è¡Œ(å¤šä¸ªäººä¸€èµ·è¡Œèµ°, åŒæ—¶è¿›è¡Œ)<br>CPUå¤šæ ¸,å¤šä¸ªçº¿ç¨‹åŒæ—¶è¿›è¡Œ ; ä½¿ç”¨çº¿ç¨‹æ± æ“ä½œ</p><p>çº¿ç¨‹å®ç°ä¸»è¦åˆ†ä¸ºä¸‰ç±»:<strong>ç”¨æˆ·çº§çº¿ç¨‹(ULT)ã€å†…æ ¸çº§çº¿ç¨‹(KLT)å’Œæ··åˆå‹çº¿ç¨‹</strong>å®ç°ã€‚</p><p>çº¿ç¨‹å®ç°ä¸»è¦åˆ†ä¸ºä¸‰ç±»:ç”¨æˆ·çº§çº¿ç¨‹(ULT)ã€å†…æ ¸çº§çº¿ç¨‹(KLT)å’Œæ··åˆå‹çº¿ç¨‹å®ç°ã€‚è½»é‡çº§è¿›ç¨‹(LWP)ä¸æ˜¯çº¿ç¨‹çš„å®ç°æ–¹å¼,è€Œæ˜¯æ“ä½œç³»ç»Ÿå†…æ ¸ç”¨æ¥æ”¯æŒçº¿ç¨‹è¿è¡Œçš„ä¸€ç§æœºåˆ¶ã€‚</p><p>åˆ†æä¸‰ç§çº¿ç¨‹å®ç°æ–¹å¼:</p><p>\1. ç”¨æˆ·çº§çº¿ç¨‹(ULT):<br>- çº¿ç¨‹çš„åˆ›å»ºã€è°ƒåº¦å’Œç®¡ç†éƒ½ç”±ç”¨æˆ·ç¨‹åºå®Œæˆ<br>- æ“ä½œç³»ç»Ÿå¯¹çº¿ç¨‹ä¸€æ— æ‰€çŸ¥<br>- ä¼˜ç‚¹æ˜¯åˆ‡æ¢å¼€é”€å°,ç¼ºç‚¹æ˜¯æ— æ³•åˆ©ç”¨å¤šå¤„ç†å™¨</p><p>\2. å†…æ ¸çº§çº¿ç¨‹(KLT):<br>- çº¿ç¨‹çš„åˆ›å»ºã€è°ƒåº¦å’Œç®¡ç†éƒ½ç”±å†…æ ¸å®Œæˆ<br>- æ“ä½œç³»ç»Ÿç›´æ¥å¯¹çº¿ç¨‹è¿›è¡Œè°ƒåº¦<br>- ä¼˜ç‚¹æ˜¯å¯ä»¥åˆ©ç”¨å¤šå¤„ç†å™¨,ç¼ºç‚¹æ˜¯ç³»ç»Ÿè°ƒç”¨å¼€é”€å¤§</p><p>\3. æ··åˆçº¿ç¨‹:<br>- ç»“åˆäº†ULTå’ŒKLTçš„ä¼˜ç‚¹<br>- ç”¨æˆ·çº§çº¿ç¨‹ä¸å†…æ ¸çº§çº¿ç¨‹è¿›è¡Œå¤šå¯¹å¤šæ˜ å°„<br>- æ—¢ä¿è¯äº†ç³»ç»Ÿè°ƒç”¨çš„æ•ˆç‡,åˆå¯ä»¥å……åˆ†åˆ©ç”¨å¤šå¤„ç†å™¨</p><p>çº¿ç¨‹çš„å…­ç§çŠ¶æ€ï¼š</p><p><strong>new runnable blocked waiting time_waiting terminated</strong></p><p><strong>waitå’Œsleepçš„åŒºåˆ«ï¼š</strong></p><ol><li>æ¥è‡ªä¸åŒçš„ç±»ï¼š waitæ¥è‡ªobjectç±», sleepæ¥è‡ªçº¿ç¨‹ç±»</li><li>å…³äºé”çš„é‡Šæ”¾ï¼šwaitä¼šé‡Šæ”¾é”, sleepä¸ä¼šé‡Šæ”¾é”</li><li>ä½¿ç”¨çš„èŒƒå›´ä¸åŒï¼š waitå¿…é¡»åœ¨åŒæ­¥ä»£ç å—ä¸­ï¼Œ sleepå¯ä»¥åœ¨ä»»ä½•åœ°æ–¹ç¡çœ </li></ol><h2 id="çº¿ç¨‹çš„æ–¹æ³•"><a href="#çº¿ç¨‹çš„æ–¹æ³•" class="headerlink" title="çº¿ç¨‹çš„æ–¹æ³•"></a>çº¿ç¨‹çš„æ–¹æ³•</h2><p>æ–°å»ºçº¿ç¨‹è°ƒç”¨<strong>start()æ–¹æ³•å</strong>ï¼Œçº¿ç¨‹å¹¶ä¸ä¼šç«‹å³è¿›å…¥è¿è¡ŒçŠ¶æ€ã€‚çº¿ç¨‹çš„çŠ¶æ€å˜åŒ–æ˜¯ï¼š<strong>æ–°å»ºâ†’å°±ç»ªâ†’è¿è¡Œ</strong>ã€‚è°ƒç”¨start()æ–¹æ³•åï¼Œçº¿ç¨‹ä¼šè¿›å…¥å°±ç»ªçŠ¶æ€ï¼Œç­‰å¾…CPUè°ƒåº¦æ‰èƒ½è¿›å…¥è¿è¡ŒçŠ¶æ€ã€‚è¿™å–å†³äºçº¿ç¨‹è°ƒåº¦å™¨çš„è°ƒåº¦ç­–ç•¥ã€‚start()æ–¹æ³•ä¼š<strong>åˆ›å»ºæ–°çš„çº¿ç¨‹å¹¶æ‰§è¡Œrun()æ–¹æ³•</strong>ï¼Œè€Œç›´æ¥è°ƒç”¨run()æ–¹æ³•åªä¼šåœ¨<strong>å½“å‰çº¿ç¨‹ä¸­æ‰§è¡Œ</strong>ï¼Œä¸ä¼šå¯åŠ¨æ–°çº¿ç¨‹ã€‚</p><p><img src="https://uploadfiles.nowcoder.com/images/20250422/59_1745314586904/AB85F6C1A80F74538F959A181704EA92" alt=""></p><p>runï¼ˆï¼‰æ–¹æ³•æ˜¯å®šä¹‰çº¿ç¨‹æ‰§è¡Œä½“çš„æ ¸å¿ƒæ–¹æ³•ã€‚å½“æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªçº¿ç¨‹ç±»æ—¶,å¿…é¡»é‡å†™Threadç±»çš„run()æ–¹æ³•æˆ–å®ç°Runnableæ¥å£çš„run()æ–¹æ³•,åœ¨å…¶ä¸­ç¼–å†™å…·ä½“çš„çº¿ç¨‹æ‰§è¡Œé€»è¾‘ã€‚</p><p>å¯ä»¥å®ç°çº¿ç¨‹ä¹‹é—´é€šçŸ¥å’Œå”¤é†’çš„æ–¹æ³•æ˜¯ï¼š</p><p>Object.wait/notify/notifyAll</p><p>Condition.await/signal/signalAll</p><p><strong>shutdownæ–¹æ³•ï¼š</strong>shutdown()æ–¹æ³•ä¼šè®©çº¿ç¨‹æ± è¿›å…¥â€å…³é—­â€çŠ¶æ€,<strong>æ­¤æ—¶ä¸å†æ¥å—æ–°çš„ä»»åŠ¡æäº¤,ä½†ä¼šç»§ç»­æ‰§è¡Œé˜Ÿåˆ—ä¸­çš„ä»»åŠ¡ç›´åˆ°å®Œæˆã€‚è¿™æ˜¯ä¸€ç§å¹³ç¼“çš„å…³é—­æ–¹å¼ã€‚</strong></p><p>å¦‚æœéœ€è¦ç­‰å¾…ä»»åŠ¡æ‰§è¡Œå®Œæˆ,éœ€è¦é…åˆä½¿ç”¨a<strong>waitTermination()</strong>æ–¹æ³•</p><p>shutdownNOw()ç«‹åˆ»ç»ˆæ­¢æ­£åœ¨æ‰§è¡Œçš„æ‰€æœ‰ä»»åŠ¡ï¼Œå¹¶è¿”å›ç­‰å¾…æ‰§è¡Œçš„ä»»åŠ¡åˆ—è¡¨(List)ã€‚è¿™äº›ä»»åŠ¡æ˜¯å°šæœªå¼€å§‹æ‰§è¡Œçš„ä»»åŠ¡ã€‚</p><p><strong>awaitTermination</strong>(long timeout, TimeUnit unit)æ˜¯é˜»å¡æ–¹æ³•,å®ƒä¼šç­‰å¾…ç›´åˆ°ä»¥ä¸‹ä¸‰ç§æƒ…å†µä¹‹ä¸€å‘ç”Ÿ:<br>- æ‰€æœ‰ä»»åŠ¡æ‰§è¡Œå®Œæˆ<br>- åˆ°è¾¾æŒ‡å®šçš„è¶…æ—¶æ—¶é—´<br>- å½“å‰çº¿ç¨‹è¢«ä¸­æ–­<br>è¿™ä¸ªæ–¹æ³•å¸¸ç”¨äºç¡®ä¿çº¿ç¨‹æ± å®Œå…¨å…³é—­ã€‚</p><h1 id="JUCç»“æ„"><a href="#JUCç»“æ„" class="headerlink" title="JUCç»“æ„"></a>JUCç»“æ„</h1><p>Javaå¤šçº¿ç¨‹å®ç°æœ‰ä¸¤ç§ä¸»è¦æ–¹å¼:<strong>ç»§æ‰¿Threadç±»å’Œå®ç°Runnableæ¥å£</strong></p><p>ç»§æ‰¿Threadç±»<br>- ç›´æ¥ç»§æ‰¿Threadç±»<br>- é‡å†™run()æ–¹æ³•<br>- åˆ›å»ºçº¿ç¨‹å¯¹è±¡åè°ƒç”¨start()æ–¹æ³•å¯åŠ¨çº¿ç¨‹<br>- ä¼˜ç‚¹æ˜¯ç¼–ç ç®€å•ç›´è§‚<br>- ç¼ºç‚¹æ˜¯Javaä¸æ”¯æŒå¤šç»§æ‰¿,å¦‚æœç±»å·²ç»ç»§æ‰¿äº†å…¶ä»–ç±»å°±ä¸èƒ½å†ç»§æ‰¿Thread</p><p>å®ç°Runnableæ¥å£<br>- å®ç°Runnableæ¥å£<br>- å®ç°run()æ–¹æ³•<br>- å°†å®ç°ç±»å®ä¾‹ä¼ å…¥Threadæ„é€ å‡½æ•°åˆ›å»ºçº¿ç¨‹å¯¹è±¡<br>- è°ƒç”¨start()æ–¹æ³•å¯åŠ¨çº¿ç¨‹<br>- ä¼˜ç‚¹æ˜¯å¯ä»¥é¿å…å•ç»§æ‰¿é™åˆ¶,æ›´é€‚åˆå¤šä¸ªçº¿ç¨‹å…±äº«åŒä¸€ä¸ªèµ„æºçš„æƒ…å†µ<br>- <strong>è¿™æ˜¯æ›´å¸¸ç”¨çš„æ–¹å¼</strong></p><h2 id="tool"><a href="#tool" class="headerlink" title="tool"></a>tool</h2><p>åˆç§°â€œä¿¡å·é‡ä¸‰å…„å¼Ÿâ€ï¼Œåˆ†ä¸ºä¸‰ä¸ª</p><p><strong>CountDownLatchï¼ˆé—­é”ï¼‰</strong></p><ul><li>æ˜¯ä¸€ä¸ªåŒæ­¥è¾…åŠ©ç±»ï¼Œåœ¨<strong>å®Œæˆä¸€ç»„çº¿ç¨‹æ“ä½œä¹‹å‰</strong>ï¼Œå…è®¸<strong>ä¸€ä¸ªæˆ–å¤šä¸ªçº¿ç¨‹ç­‰å¾…</strong>ã€‚</li><li><strong>å…¸å‹åº”ç”¨ï¼šå¹¶å‘æ‰§è¡Œå¤šä¸ªä»»åŠ¡åç»Ÿä¸€æ±‡æ€»ç»“æœã€‚</strong></li></ul><p><strong>CyclicBarrierï¼ˆæ …æ ï¼‰</strong></p><ul><li>å…è®¸ä¸€ç»„çº¿ç¨‹äº’ç›¸ç­‰å¾…ï¼Œç›´åˆ°<strong>éƒ½è¾¾åˆ°ä¸€ä¸ªå…¬å…±å±éšœç‚¹</strong>ã€‚</li><li><strong>æ”¯æŒå¾ªç¯ä½¿ç”¨</strong>ï¼ˆé‡Šæ”¾åå¯é‡ç”¨ï¼‰ã€‚</li><li><strong>å…¸å‹åº”ç”¨ï¼šåˆ†å¸ƒå¼è®¡ç®—ä¸­ä»»åŠ¡æ‹†åˆ†ååˆå¹¶ã€‚</strong></li></ul><p><strong>Semaphoreï¼ˆä¿¡å·é‡ï¼‰</strong></p><ul><li>æ§åˆ¶å¯¹æŸä¸ªèµ„æºçš„<strong>è®¿é—®çº¿ç¨‹æ•°é‡</strong>ï¼Œç›¸å½“äºâ€œå…±äº«é”â€ã€‚</li><li>æä¾›æ–¹æ³•ï¼š<ul><li><code>acquire()</code>ï¼šå°è¯•è·å–è®¸å¯ï¼Œ<strong>æ— åˆ™é˜»å¡ç­‰å¾…</strong>ã€‚</li><li><code>release()</code>ï¼šé‡Šæ”¾æŒæœ‰çš„è®¸å¯ã€‚</li></ul></li><li><strong>å…¸å‹åº”ç”¨ï¼šé™åˆ¶å¹¶å‘è®¿é—®æ•°ï¼Œæ¯”å¦‚æ§åˆ¶æ•°æ®åº“è¿æ¥æ± æ•°é‡ã€‚</strong></li></ul><h2 id="executor"><a href="#executor" class="headerlink" title="executor"></a>executor</h2><p>æ˜¯Javaé‡Œé¢çº¿ç¨‹æ± çš„é¡¶çº§æ¥å£ï¼Œä½†å®ƒåªæ˜¯ä¸€ä¸ªæ‰§è¡Œçº¿ç¨‹çš„å·¥å…·ï¼ŒçœŸæ­£çš„çº¿ç¨‹æ± æ¥å£æ˜¯<strong>ExecutorService</strong>ï¼Œé‡Œé¢åŒ…å«çš„ç±»æœ‰ï¼š</p><p>1ï¼‰ScheduledExecutorService è§£å†³é‚£äº›éœ€è¦ä»»åŠ¡é‡å¤æ‰§è¡Œçš„é—®é¢˜</p><p><strong>å‘¨æœŸæ€§æ‰§è¡Œæˆ–è€…å»¶è¿Ÿä»»åŠ¡</strong></p><p>2ï¼‰ScheduledThreadPoolExecutor å‘¨æœŸæ€§ä»»åŠ¡è°ƒåº¦çš„ç±»å®ç°</p><p><strong>å®šæ—¶ä»»åŠ¡è°ƒåº¦</strong></p><h2 id="atomic"><a href="#atomic" class="headerlink" title="atomic"></a>atomic</h2><p>æ˜¯JDKæä¾›çš„ä¸€ç»„åŸå­æ“ä½œç±»ï¼Œ</p><p>åŒ…å«æœ‰AtomicBooleanã€AtomicIntegerã€AtomicIntegerArrayç­‰åŸå­å˜é‡ç±»ï¼Œä»–ä»¬çš„å®ç°åŸç†å¤§å¤šæ˜¯<strong>æŒæœ‰å®ƒä»¬å„è‡ªçš„å¯¹åº”çš„ç±»å‹å˜é‡valueï¼Œè€Œä¸”è¢«volatileå…³é”®å­—ä¿®é¥°äº†</strong>ã€‚å€ŸåŠ© <code>Unsafe</code> ç±» + CAS å®ç°åŸå­æ€§ã€‚å› ä¸ºvolatileå¹¶ä¸èƒ½ä¿è¯åŸå­æ€§ï¼Œè¿™æ ·æ¥ä¿è¯æ¯æ¬¡ä¸€ä¸ªçº¿ç¨‹è¦ä½¿ç”¨å®ƒéƒ½ä¼šæ‹¿åˆ°<strong>æœ€æ–°çš„å€¼ã€‚</strong></p><p>volatileå˜é‡åœ¨æ¯æ¬¡è¢«çº¿ç¨‹è®¿é—®æ—¶ï¼Œ<strong>éƒ½å¼ºåˆ¶ä»ä¸»å†…å­˜ä¸­é‡æ–°è¯»å–æœ€æ–°å€¼ï¼Œè€Œä¸æ˜¯ä½¿ç”¨çº¿ç¨‹å·¥ä½œå†…å­˜ä¸­çš„å€¼ã€‚è¿™ç¡®ä¿äº†å˜é‡çš„å¯è§æ€§ã€‚</strong></p><h2 id="locks"><a href="#locks" class="headerlink" title="locks"></a>locks</h2><p>æ ¹æ®çº¿ç¨‹è·å–<strong>é”çš„æŠ¢å æœºåˆ¶</strong>,é”å¯ä»¥åˆ†ä¸º<strong>å…¬å¹³é”å’Œéå…¬å¹³é”</strong>ã€‚æ ¹æ®é”åªèƒ½è¢«å•ä¸ªçº¿ç¨‹<strong>æŒæœ‰è¿˜æ˜¯èƒ½è¢«å¤šä¸ªçº¿ç¨‹å…±åŒæŒæœ‰</strong>ï¼Œé”å¯ä»¥åˆ†ä¸º<strong>ç‹¬å é”å’Œå…±äº«é”ã€‚</strong></p><p>å½“çº¿ç¨‹å› ä¸ºæŠ¢å å¼è°ƒåº¦è€Œåœæ­¢è¿è¡Œæ—¶,<strong>ä¼šè¢«æ”¾å…¥å¯è¿è¡Œé˜Ÿåˆ—çš„å‰é¢</strong>ã€‚è¿™æ˜¯ä¸ºäº†ä¿è¯è¢«æŠ¢å çš„çº¿ç¨‹èƒ½å¤Ÿä¼˜å…ˆå¾—åˆ°ä¸‹ä¸€æ¬¡æ‰§è¡Œæœºä¼š,<strong>ä½“ç°äº†è°ƒåº¦çš„å…¬å¹³æ€§ã€‚</strong></p><p>æ˜¯JDKæä¾›çš„é”æœºåˆ¶ï¼Œç›¸æ¯”synchronizedå…³é”®å­—æ¥è¿›è¡ŒåŒæ­¥é”ï¼ŒåŠŸèƒ½æ›´åŠ å¼ºå¤§ï¼Œå®ƒä¸ºé”æä¾›äº†ä¸€ä¸ªæ¡†æ¶ï¼Œè¯¥æ¡†æ¶å…è®¸æ›´çµæ´»åœ°ä½¿ç”¨é”åŒ…å«çš„å®ç°ç±»æœ‰ï¼š</p><p>1ï¼‰<strong>ReentrantLock</strong> å®ƒæ˜¯<strong>ç‹¬å é”</strong>ï¼Œæ˜¯æŒ‡åªèƒ½è¢«ç‹¬è‡ªå é¢†ï¼Œå³åŒä¸€ä¸ªæ—¶é—´ç‚¹åªèƒ½è¢«ä¸€ä¸ªçº¿ç¨‹é”è·å–åˆ°çš„é”ã€‚å¯ä»¥è¢«ä¸»åŠ¨æ‰“æ–­ï¼Œå¯ä»¥è°ƒç”¨<strong>newCondition</strong>æ–¹æ³•å®ç°å¤šä¸ªæ¡ä»¶å˜é‡ã€‚å¯ä»¥é‡å…¥ï¼Œæœ‰å…¬å¹³å’Œéå…¬å¹³æ¨¡å¼</p><p>2ï¼‰<strong>ReentrantReadWriteLock</strong> å®ƒåŒ…æ‹¬å­ç±»ReadLockå’ŒWriteLockã€‚ReadLockæ˜¯å…±äº«é”ï¼Œè€ŒWriteLockæ˜¯ç‹¬å é”ã€‚</p><p>ğŸ” <strong>è¯»é”ï¼ˆå…±äº«é”ï¼‰</strong>ï¼šå¤šä¸ªçº¿ç¨‹å¯ä»¥<strong>åŒæ—¶è¯»</strong>ï¼Œä¸ä¼šäº’ç›¸å½±å“ã€‚</p><p>âœï¸ <strong>å†™é”ï¼ˆç‹¬å é”ï¼‰</strong>ï¼šå†™çº¿ç¨‹æ˜¯<strong>æ’ä»–çš„</strong>ï¼Œå†™çš„æ—¶å€™ä¸èƒ½è¯»ä¹Ÿä¸èƒ½å†™ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ReadWriteLockDemo</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">MyCache</span> <span class="variable">myCache</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MyCache</span>();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å†™çº¿ç¨‹</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= <span class="number">5</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">final</span> <span class="type">int</span> <span class="variable">temp</span> <span class="operator">=</span> i;</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">                myCache.put(temp + <span class="string">&quot;&quot;</span>, temp + <span class="string">&quot;&quot;</span>);</span><br><span class="line">            &#125;, <span class="string">&quot;å†™çº¿ç¨‹&quot;</span> + i).start();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// è¯»çº¿ç¨‹</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">1</span>; i &lt;= <span class="number">5</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">final</span> <span class="type">int</span> <span class="variable">temp</span> <span class="operator">=</span> i;</span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">                myCache.get(temp + <span class="string">&quot;&quot;</span>);</span><br><span class="line">            &#125;, <span class="string">&quot;è¯»çº¿ç¨‹&quot;</span> + i).start();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç¼“å­˜ç±»ï¼Œä½¿ç”¨è¯»å†™é”ä¿è¯çº¿ç¨‹å®‰å…¨</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyCache</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Map&lt;String, String&gt; map = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="type">ReentrantReadWriteLock</span> <span class="variable">rwLock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReentrantReadWriteLock</span>();</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å†™æ“ä½œï¼šåŠ å†™é”</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">put</span><span class="params">(String key, String value)</span> &#123;</span><br><span class="line">        rwLock.writeLock().lock();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot; å†™å…¥ &quot;</span> + key);</span><br><span class="line">            TimeUnit.MILLISECONDS.sleep(<span class="number">300</span>);</span><br><span class="line">            map.put(key, value);</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot; å†™å…¥å®Œæˆ&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            rwLock.writeLock().unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// è¯»æ“ä½œï¼šåŠ è¯»é”</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">get</span><span class="params">(String key)</span> &#123;</span><br><span class="line">        rwLock.readLock().lock();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot; è¯»å– &quot;</span> + key);</span><br><span class="line">            TimeUnit.MILLISECONDS.sleep(<span class="number">300</span>);</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot; è¯»å–å®Œæˆ: &quot;</span> + map.get(key));</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            rwLock.readLock().unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>3ï¼‰<strong>LockSupport</strong> å®ƒå…·<strong>å¤‡é˜»å¡çº¿ç¨‹å’Œè§£é™¤é˜»å¡çº¿ç¨‹</strong>çš„åŠŸèƒ½ï¼Œå¹¶ä¸”ä¸ä¼šå¼•å‘æ­»é”ã€‚</p><h2 id="collection"><a href="#collection" class="headerlink" title="collection"></a>collection</h2><p>ä¸»è¦æ˜¯æä¾›çº¿ç¨‹å®‰å…¨çš„é›†åˆï¼Œ æ¯”å¦‚ï¼š</p><p>1ï¼‰ArrayListå¯¹åº”çš„é«˜å¹¶å‘ç±»æ˜¯<strong>CopyOnWrite</strong>ArrayListï¼Œ</p><p>2ï¼‰HashSetå¯¹åº”çš„é«˜å¹¶å‘ç±»æ˜¯ CopyOnWriteArraySetï¼Œ</p><p>3ï¼‰HashMapå¯¹åº”çš„é«˜å¹¶å‘ç±»æ˜¯ConcurrentHashMap</p><p>4ï¼‰Queueå¯¹åº”çš„é«˜å¹¶å‘ç±»æ˜¯ConcurrentLinkedQueue</p><p>è¿™é‡Œè¿˜æœ‰ä¸€ç±»ç‰¹æ®Šçš„é›†åˆï¼Œå†…éƒ¨åŸºäº<strong><code>ReentrantLock</code></strong> å’Œ <strong><code>Condition</code></strong> æ§åˆ¶çº¿ç¨‹å®‰å…¨å’Œé˜»å¡æ“ä½œã€‚</p><p>å®ƒä»¬éƒ½å±äº <strong>é˜»å¡é˜Ÿåˆ—ï¼ˆBlocking Queueï¼‰çš„ä¸€ç§å®ç°</strong>ï¼Œé€‚ç”¨äºå¤šçº¿ç¨‹ç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å‹ã€‚</p><p>ä¸¤è€…æ„é€ æ–¹æ³•ä¸­å¯ä»¥è®¾ç½®<strong>å®¹é‡ä¸Šé™</strong>ï¼ˆæœ‰ç•Œï¼‰ã€‚</p><ul><li><code>new LinkedBlockingQueue&lt;&gt;(1000)</code> é™å®šæœ€å¤§å®¹é‡ä¸º 1000ã€‚</li></ul><p>å¦‚æœä½¿ç”¨æ— å‚æ„é€ ï¼Œé»˜è®¤å®¹é‡æ˜¯ï¼š<code>Integer.MAX_VALUE</code>ï¼Œ<strong>ç†è®ºä¸Šæ— ç•Œ</strong>ã€‚</p><p>æ‰€ä»¥ <strong>ä»é»˜è®¤è¡Œä¸ºçœ‹æ˜¯æ— ç•Œçš„</strong>ï¼Œä½†å®é™…ä¸Š <strong>å¯ä»¥è®¾ç½®ä¸ºæœ‰ç•Œé˜Ÿåˆ—</strong>ã€‚</p><hr><p>LinkedBlockingQueue</p><ul><li><strong>é˜»å¡é˜Ÿåˆ—ï¼Œçº¿ç¨‹å®‰å…¨</strong></li><li><strong>åŸºäºé“¾è¡¨ç»“æ„</strong></li><li><strong>æ”¯æŒ FIFOï¼ˆå…ˆè¿›å…ˆå‡ºï¼‰æ“ä½œ</strong></li><li>æ’å…¥æ»¡äº†ä¼šé˜»å¡ï¼Œç§»é™¤ç©ºäº†ä¹Ÿä¼šé˜»å¡</li><li><strong>å¸¸ç”¨äºç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å‹</strong></li><li>æ”¯æŒä¸€ä¸ªæ–¹å‘çš„æ’å…¥å’Œç§»é™¤ï¼ˆå¤´å‡ºå°¾è¿›ï¼‰ã€‚</li></ul><p>ä½¿ç”¨ <strong><code>ReentrantLock</code></strong> å®ç°çº¿ç¨‹å®‰å…¨</p><p>ä½¿ç”¨ä¸¤ä¸ªé”ï¼š<strong>takeLockã€putLock</strong>ï¼Œé¿å…å…¥é˜Ÿå’Œå‡ºé˜Ÿç›¸äº’é˜»å¡</p><p>LinkedBlockingDeque</p><p><strong>çº¿ç¨‹å®‰å…¨</strong></p><p><strong>åŸºäºé“¾è¡¨ç»“æ„</strong></p><p><strong>åŒç«¯é˜»å¡é˜Ÿåˆ—</strong>ï¼ˆæ”¯æŒä¸¤ç«¯æ“ä½œï¼‰</p><p>æ—¢å¯ä»¥ä½œä¸º <strong>é˜Ÿåˆ—ï¼ˆFIFOï¼‰</strong>ï¼Œä¹Ÿå¯ä»¥ä½œä¸º <strong>æ ˆï¼ˆLIFOï¼‰</strong> ä½¿ç”¨</p><p>èƒ½å®ç° <strong>é˜Ÿåˆ—æ¨¡å‹</strong>ï¼ˆtail addï¼Œhead removeï¼‰</p><p>ä¹Ÿèƒ½å®ç° <strong>æ ˆæ¨¡å‹</strong>ï¼ˆhead addï¼Œhead removeï¼‰</p><h1 id="lockï¼ˆtopï¼‰"><a href="#lockï¼ˆtopï¼‰" class="headerlink" title="lockï¼ˆtopï¼‰"></a>lockï¼ˆtopï¼‰</h1><h2 id="synchronized"><a href="#synchronized" class="headerlink" title="synchronized"></a>synchronized</h2><p>synchronizedæ˜¯Javaä¸­çš„å…³é”®å­—,æ˜¯ä¸€ç§<strong>å†…ç½®çš„åŒæ­¥é”</strong>ï¼Œç”¨äºå®ç°çº¿ç¨‹é—´çš„äº’æ–¥è®¿é—®ã€‚</p><p>å¯ä»¥ä¿®é¥°ï¼šï¼šï¼šï¼šï¼š</p><ol><li>ä¿®é¥°ä¸€ä¸ªä»£ç å—ï¼Œ<strong>è¢«ä¿®é¥°çš„ä»£ç å—ç§°ä¸ºåŒæ­¥è¯­å¥å—</strong>ï¼Œå…¶ä½œç”¨çš„èŒƒå›´æ˜¯å¤§æ‹¬å·{}æ‹¬èµ·æ¥çš„ä»£ç ï¼Œ<strong>ä½œç”¨çš„å¯¹è±¡æ˜¯è°ƒç”¨è¿™ä¸ªä»£ç å—çš„å¯¹è±¡</strong>ï¼›<br>ã€€ã€€2. ä¿®é¥°ä¸€ä¸ªæ–¹æ³•ï¼Œè¢«ä¿®é¥°çš„æ–¹æ³•ç§°ä¸º<strong>åŒæ­¥æ–¹æ³•</strong>ï¼Œå…¶ä½œç”¨çš„èŒƒå›´æ˜¯æ•´ä¸ªæ–¹æ³•ï¼Œä½œç”¨çš„å¯¹è±¡æ˜¯<strong>è°ƒç”¨è¿™ä¸ªæ–¹æ³•çš„å¯¹è±¡</strong>ï¼›<br>ã€€ã€€3. ä¿®æ”¹ä¸€ä¸ªé™æ€çš„æ–¹æ³•ï¼Œ<strong>å…¶ä½œç”¨çš„èŒƒå›´æ˜¯æ•´ä¸ªé™æ€æ–¹æ³•</strong>ï¼Œä½œç”¨çš„å¯¹è±¡æ˜¯<strong>è¿™ä¸ªç±»çš„æ‰€æœ‰å¯¹è±¡ï¼›</strong><ol><li>ä¿®æ”¹ä¸€ä¸ªç±»ï¼Œå…¶ä½œç”¨çš„èŒƒå›´æ˜¯synchronizedåé¢æ‹¬å·æ‹¬èµ·æ¥çš„éƒ¨åˆ†ï¼Œ<strong>ä½œç”¨ä¸»çš„å¯¹è±¡æ˜¯è¿™ä¸ªç±»çš„æ‰€æœ‰å¯¹è±¡ã€‚</strong></li></ol></li></ol><p>JDK æä¾›çš„æ˜¾ç¤ºé”æœºåˆ¶ï¼Œä½¿ç”¨æ—¶éœ€æ˜¾å¼åœ°åŠ é”å’Œé‡Šæ”¾é”ã€‚</p><p>å®ç°ç±»ï¼š<strong><code>ReentrantLock</code></strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ„é€ å™¨</span></span><br><span class="line"><span class="keyword">public</span> <span class="title function_">ReentrantLock</span><span class="params">()</span> &#123;</span><br><span class="line">    sync = <span class="keyword">new</span> <span class="title class_">NonfairSync</span>();  <span class="comment">// é»˜è®¤æ˜¯éå…¬å¹³é”</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">public</span> <span class="title function_">ReentrantLock</span><span class="params">(<span class="type">boolean</span> fair)</span> &#123;</span><br><span class="line">    sync = fair ? <span class="keyword">new</span> <span class="title class_">FairSync</span>() : <span class="keyword">new</span> <span class="title class_">NonfairSync</span>();  <span class="comment">// å¯è®¾ç½®æ˜¯å¦å…¬å¹³</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><div class="table-container"><table><thead><tr><th>ç±»å‹</th><th>ç‰¹ç‚¹</th></tr></thead><tbody><tr><td>å…¬å¹³é”</td><td><strong>å…ˆè¿›å…ˆå‡ºæ’é˜Ÿæœºåˆ¶ï¼Œè°å…ˆæ¥è°å…ˆå¾—</strong></td></tr><tr><td>éå…¬å¹³é”</td><td><strong>å¯èƒ½æ’é˜Ÿï¼Œæ€§èƒ½æ›´å¥½ï¼ˆé»˜è®¤ï¼‰</strong></td></tr></tbody></table></div><p>å®ä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SaleTicketDemo</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">Ticket</span> <span class="variable">ticket</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Ticket</span>();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123; <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">40</span>; i++) ticket.sale(); &#125;, <span class="string">&quot;a&quot;</span>).start();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123; <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">40</span>; i++) ticket.sale(); &#125;, <span class="string">&quot;b&quot;</span>).start();</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123; <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">40</span>; i++) ticket.sale(); &#125;, <span class="string">&quot;c&quot;</span>).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">Ticket</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">ticketNum</span> <span class="operator">=</span> <span class="number">30</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">Lock</span> <span class="variable">lock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReentrantLock</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sale</span><span class="params">()</span> &#123;</span><br><span class="line">        lock.lock();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (ticketNum &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                System.out.println(Thread.currentThread().getName() + <span class="string">&quot; è´­å¾—ç¬¬ &quot;</span> + ticketNum-- + <span class="string">&quot; å¼ ç¥¨, å‰©ä½™ &quot;</span> + ticketNum + <span class="string">&quot; å¼ ç¥¨&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">            Thread.sleep(<span class="number">10</span>); <span class="comment">// æ¨¡æ‹Ÿå¼‚å¸¸æƒ…å†µï¼Œå¢åŠ çº¿ç¨‹äº¤æ›¿</span></span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><h3 id="synchronized-vs-Lock-åŒºåˆ«æ€»ç»“-top"><a href="#synchronized-vs-Lock-åŒºåˆ«æ€»ç»“-top" class="headerlink" title="synchronized vs Lock åŒºåˆ«æ€»ç»“(top)"></a><strong><code>synchronized</code> vs <code>Lock</code> åŒºåˆ«æ€»ç»“</strong>(top)</h3><div class="table-container"><table><thead><tr><th>æ¯”è¾ƒç‚¹</th><th><code>synchronized</code></th><th><code>Lock</code>ï¼ˆå¦‚ <code>ReentrantLock</code>ï¼‰</th></tr></thead><tbody><tr><td></td><td></td></tr></tbody></table></div><div class="table-container"><table><thead><tr><th>æœ¬è´¨</th><th>Java å…³é”®å­—</th><th>Java ç±»ï¼ˆæ¥å£ï¼‰</th></tr></thead><tbody><tr><td></td><td></td></tr></tbody></table></div><div class="table-container"><table><thead><tr><th>è·å–é”çŠ¶æ€</th><th>âŒ æ— æ³•åˆ¤æ–­</th><th>âœ… å¯ä»¥ç”¨ <code>tryLock()</code> åˆ¤æ–­æ˜¯å¦è·å–æˆåŠŸ</th></tr></thead><tbody><tr><td></td><td></td></tr></tbody></table></div><div class="table-container"><table><thead><tr><th>è‡ªåŠ¨é‡Šæ”¾é”</th><th>âœ… å‡ºç°å¼‚å¸¸æ—¶è‡ªåŠ¨é‡Šæ”¾</th><th>âŒ å¿…é¡»æ‰‹åŠ¨ <code>unlock()</code>ï¼Œå¦åˆ™æ˜“æ­»é”</th></tr></thead><tbody><tr><td></td><td></td></tr></tbody></table></div><div class="table-container"><table><thead><tr><th>å¯ä¸­æ–­æ€§</th><th>âŒ ä¸æ”¯æŒä¸­æ–­ç­‰å¾…é”</th><th>âœ… æ”¯æŒï¼ˆ<code>lockInterruptibly()</code>ï¼‰</th></tr></thead><tbody><tr><td></td><td></td></tr></tbody></table></div><div class="table-container"><table><thead><tr><th>å…¬å¹³æ€§æ”¯æŒ</th><th>âŒ é»˜è®¤éå…¬å¹³</th><th>âœ… å¯é€‰å…¬å¹³/éå…¬å¹³</th></tr></thead><tbody><tr><td></td><td></td></tr></tbody></table></div><div class="table-container"><table><thead><tr><th>é€‚ç”¨èŒƒå›´</th><th>å°‘é‡ä»£ç åŒæ­¥åœºæ™¯</th><th>æ›´å¤æ‚ã€çµæ´»çš„å¹¶å‘æ§åˆ¶åœºæ™¯</th></tr></thead><tbody><tr><td></td><td></td></tr></tbody></table></div><div class="table-container"><table><thead><tr><th>æ¡ä»¶å˜é‡æ”¯æŒ</th><th>âŒ ä¸æ”¯æŒæ¡ä»¶é˜Ÿåˆ—</th><th>âœ… æ”¯æŒå¤šä¸ª <code>Condition</code>ï¼Œå¯ç²¾ç¡®å”¤é†’</th></tr></thead><tbody><tr><td></td><td></td></tr></tbody></table></div><div class="table-container"><table><thead><tr><th>ç‰¹æ€§ / ç±»å‹</th><th><code>synchronized</code></th><th><code>Lock</code>ï¼ˆReentrantLockï¼‰</th><th><code>ReadWriteLock</code>ï¼ˆReentrantReadWriteLockï¼‰</th></tr></thead><tbody><tr><td>æ˜¯å¦å¯é‡å…¥</td><td>âœ… æ˜¯</td><td>âœ… æ˜¯</td><td>âœ… æ˜¯ï¼ˆè¯»é”å’Œå†™é”éƒ½æ”¯æŒï¼‰</td></tr><tr><td>å…¬å¹³æ€§é€‰æ‹©</td><td>âŒ å¦ï¼ˆé»˜è®¤éå…¬å¹³ï¼‰</td><td>âœ… å¯é€‰ï¼ˆæ„é€ å‡½æ•°å¯è®¾ï¼‰</td><td>âœ… å¯é€‰ï¼ˆæ„é€ å‡½æ•°å¯è®¾ï¼‰</td></tr><tr><td>æ˜¯å¦æ”¯æŒä¸­æ–­</td><td>âŒ ä¸æ”¯æŒ</td><td>âœ… æ”¯æŒ <code>lockInterruptibly()</code></td><td>âœ… æ”¯æŒï¼ˆè¯»/å†™é”éƒ½æ”¯æŒä¸­æ–­ï¼‰</td></tr><tr><td>æ˜¯å¦æ”¯æŒè¶…æ—¶å°è¯•è·å–é”</td><td>âŒ ä¸æ”¯æŒ</td><td>âœ… æ”¯æŒ <code>tryLock(timeout)</code></td><td>âœ… æ”¯æŒ</td></tr><tr><td>æ˜¯å¦ä¸ºè¯»å†™åˆ†ç¦»</td><td>âŒ ä¸æ”¯æŒ</td><td>âŒ ä¸æ”¯æŒ</td><td>âœ… æ”¯æŒï¼Œè¯»é”å…±äº«ï¼Œå†™é”ç‹¬å </td></tr><tr><td>æ˜¯å¦éœ€è¦æ‰‹åŠ¨é‡Šæ”¾</td><td>âŒ ä¸éœ€è¦ï¼ˆè‡ªåŠ¨é‡Šæ”¾ï¼‰</td><td>âœ… éœ€è¦ <code>unlock()</code></td><td>âœ… éœ€è¦åˆ†åˆ«é‡Šæ”¾è¯»é”å’Œå†™é”</td></tr><tr><td>æ€§èƒ½</td><td>ä¸­ï¼ˆJVM ä¼˜åŒ–è¾ƒå¥½ï¼‰</td><td>é«˜ï¼ˆæ›´çµæ´»ï¼Œé€‚åˆå¤æ‚æ§åˆ¶ï¼‰</td><td>éå¸¸é«˜ï¼ˆè¯»å¤šå†™å°‘çš„åœºæ™¯æ€§èƒ½æœ€å¥½ï¼‰</td></tr><tr><td>ä½¿ç”¨ç®€å•æ€§</td><td>âœ… éå¸¸ç®€å•</td><td>â›” ç›¸å¯¹å¤æ‚ï¼ˆéœ€è¦æ‰‹åŠ¨é‡Šæ”¾ï¼‰</td><td>â›” æ›´å¤æ‚ï¼ˆéœ€åŒºåˆ†è¯»å†™é”ï¼‰</td></tr></tbody></table></div><h3 id="Condition-ç²¾å‡†çº¿ç¨‹é€šä¿¡ï¼ˆç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å‹ï¼‰"><a href="#Condition-ç²¾å‡†çº¿ç¨‹é€šä¿¡ï¼ˆç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å‹ï¼‰" class="headerlink" title="Condition ç²¾å‡†çº¿ç¨‹é€šä¿¡ï¼ˆç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å‹ï¼‰"></a><code>Condition</code> ç²¾å‡†çº¿ç¨‹é€šä¿¡ï¼ˆç”Ÿäº§è€…-æ¶ˆè´¹è€…æ¨¡å‹ï¼‰</h3><div class="table-container"><table><thead><tr><th>Objectæ–¹æ³•</th><th>Conditionå¯¹åº”æ–¹æ³•</th></tr></thead><tbody><tr><td><code>wait()</code></td><td><code>await()</code></td></tr><tr><td><code>notify()</code></td><td><code>signal()</code></td></tr><tr><td><code>notifyAll()</code></td><td><code>signalAll()</code></td></tr></tbody></table></div><p>Conditionæ˜¯ä¸ªæ¥å£ï¼ŒåŸºæœ¬çš„æ–¹æ³•å°±æ˜¯await()å’Œsignal()æ–¹æ³•ï¼›</p><p>è°ƒç”¨Conditionçš„await()å’Œsignal()æ–¹æ³•ï¼Œéƒ½å¿…é¡»åœ¨lockä¿æŠ¤ä¹‹å†…ï¼Œå°±æ˜¯è¯´å¿…é¡»åœ¨<strong>lock.lock()å’Œlock.unlock</strong>ä¹‹é—´æ‰å¯ä»¥ä½¿ç”¨</p><p>å¸¸ç”¨try tatch finallyä¸­</p><p>tryä¸­æ˜¯æ¡ä»¶ï¼Œcatchæ•æ‰å¼‚å¸¸ï¼Œfinallyæ‰§è¡Œè§£é”</p><p>å®ä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">SharedResource</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="variable">number</span> <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">Lock</span> <span class="variable">lock</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ReentrantLock</span>();</span><br><span class="line">    <span class="keyword">private</span> <span class="type">Condition</span> <span class="variable">condition</span> <span class="operator">=</span> lock.newCondition();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">increment</span><span class="params">()</span> &#123;</span><br><span class="line">        lock.lock();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">while</span> (number != <span class="number">0</span>) &#123;</span><br><span class="line">                condition.await();<span class="comment">//wait</span></span><br><span class="line">            &#125;</span><br><span class="line">            number++;</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot; &gt;&gt; &quot;</span> + number);</span><br><span class="line">            condition.signalAll();<span class="comment">//å”¤é†’å…¶ä»–ç­‰å¾…çº¿ç¨‹</span></span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            lock.unlock();<span class="comment">// å¿…é¡»é‡Šæ”¾é”</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">decrement</span><span class="params">()</span> &#123;</span><br><span class="line">        lock.lock();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">while</span> (number != <span class="number">1</span>) &#123;</span><br><span class="line">                condition.await();</span><br><span class="line">            &#125;</span><br><span class="line">            number--;</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot; &gt;&gt; &quot;</span> + number);</span><br><span class="line">            condition.signalAll();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>çº¿ç¨‹ä¹‹é—´ä½¿ç”¨ <code>Condition</code> ç²¾å‡†æ§åˆ¶ç­‰å¾…å’Œå”¤é†’</p><h1 id="çº¿ç¨‹å…±äº«å’Œçº¿ç¨‹å®‰å…¨"><a href="#çº¿ç¨‹å…±äº«å’Œçº¿ç¨‹å®‰å…¨" class="headerlink" title="çº¿ç¨‹å…±äº«å’Œçº¿ç¨‹å®‰å…¨"></a>çº¿ç¨‹å…±äº«å’Œçº¿ç¨‹å®‰å…¨</h1><h2 id="çº¿ç¨‹å®‰å…¨"><a href="#çº¿ç¨‹å®‰å…¨" class="headerlink" title="çº¿ç¨‹å®‰å…¨"></a>çº¿ç¨‹å®‰å…¨</h2><h3 id="list"><a href="#list" class="headerlink" title="list"></a>list</h3><p>ä½¿ç”¨ <code>Vector</code>ï¼ˆçº¿ç¨‹å®‰å…¨ï¼Œæ•ˆç‡ä½ï¼‰</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;String&gt; list = new Vector&lt;&gt;();</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨åŒæ­¥åŒ…è£…å™¨ï¼ˆJDK æä¾›çš„å·¥å…·ç±»ï¼‰</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">List&lt;String&gt; list = Collections.synchronizedList(new ArrayList&lt;&gt;());</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ <strong>CopyOnWriteArrayList</strong> âœ… æ¨èï¼</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">List&lt;String&gt; list = new CopyOnWriteArrayList&lt;&gt;();</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>æ ¸å¿ƒæœºåˆ¶ï¼šå†™æ—¶å¤åˆ¶ï¼ˆCopy-On-Writeï¼Œç®€ç§° COWï¼‰</strong></p><ul><li>å†™æ•°æ®æ—¶ï¼šå…ˆå¤åˆ¶å‡ºä¸€ä¸ªæ–°æ•°ç»„ï¼ŒæŠŠæ•°æ®æ·»åŠ åˆ°æ–°æ•°ç»„ï¼Œ<strong>ç„¶åå†ç”¨æ–°æ•°ç»„æ›¿æ¢åŸæ•°ç»„</strong></li><li>è¯»æ•°æ®æ—¶ï¼šç›´æ¥è¯»æ—§æ•°ç»„ï¼Œä¸ä¼šå—å†™æ“ä½œå½±å“ï¼Œåšåˆ°äº†<strong>è¯»å†™åˆ†ç¦»</strong></li></ul><h3 id="set"><a href="#set" class="headerlink" title="set"></a>set</h3><p><code>HashSet</code> åº•å±‚å°±æ˜¯ <code>HashMap</code>ï¼Œè€Œ <code>HashMap</code> çº¿ç¨‹ä¸å®‰å…¨ï¼Œå› æ­¤ <code>HashSet</code> ä¹Ÿä¸å®‰å…¨</p><p>ä½¿ç”¨Collections.synchronizedSet</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Set&lt;String&gt; set = Collections.synchronizedSet(new HashSet&lt;&gt;());</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨ CopyOnWriteArraySetï¼ˆçº¿ç¨‹å®‰å…¨ï¼‰</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Set&lt;String&gt; set = new CopyOnWriteArraySet&lt;&gt;();</span><br></pre></td></tr></table></figure><h3 id="hashmap"><a href="#hashmap" class="headerlink" title="hashmap"></a>hashmap</h3><p>ä¸æ˜¯çº¿ç¨‹å®‰å…¨çš„ï¼Œå¹¶å‘ç¯å¢ƒä¸­ï¼Œ<code>HashMap</code> å®¹æ˜“å‡ºç°ï¼š</p><ul><li>æ­»å¾ªç¯ï¼ˆJDK 1.7ï¼‰</li><li>æ•°æ®ä¸¢å¤±</li><li>é”®å€¼è¦†ç›–</li></ul><p>æ¨èä½¿ç”¨ConcurrentHashMap</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Map&lt;String, String&gt; map = new ConcurrentHashMap&lt;&gt;();</span><br></pre></td></tr></table></figure><p>åˆ†æ®µé”æœºåˆ¶ï¼ˆJDK 1.7ï¼‰â†’ JDK 1.8 åä½¿ç”¨ <strong>CAS + synchronized</strong> ä¼˜åŒ–</p><p>æ”¯æŒé«˜å¹¶å‘åœºæ™¯ï¼Œæ€§èƒ½è¿œä¼˜äº <code>Hashtable</code></p><p>æˆ–è€…æ˜¯ä½¿ç”¨<code>Collections.synchronizedMap</code></p><p>è¿˜æœ‰Hashtable</p><p>è€ç‰ˆæœ¬çš„ Map å®ç°ï¼Œ<strong>çº¿ç¨‹å®‰å…¨</strong>ï¼Œæ‰€æœ‰æ–¹æ³•éƒ½è¢« <code>synchronized</code> ä¿®é¥°ã€‚</p><p>ä¸å…è®¸ <strong>null é”®æˆ– null å€¼</strong>ã€‚</p><p><strong>ä¸ä¿è¯é¡ºåº</strong>ã€‚</p><p>å·²è¢« <code>ConcurrentHashMap</code> æ›¿ä»£ï¼Œåœ¨ç°ä»£é¡¹ç›®ä¸­å·²å¾ˆå°‘ä½¿ç”¨ã€‚</p><h3 id="å•çº¿ç¨‹"><a href="#å•çº¿ç¨‹" class="headerlink" title="å•çº¿ç¨‹"></a>å•çº¿ç¨‹</h3><p><strong>çº¿ç¨‹ç¯å¢ƒæ˜¯çº¿ç¨‹å®‰å…¨çš„</strong>ï¼ˆå› ä¸ºæ²¡æœ‰ç«äº‰ï¼‰</p><p><strong>å•ä¾‹æ¨¡å¼ä¸­çš„åŒé‡æ£€æŸ¥ï¼ˆDCLï¼‰</strong>ï¼š</p><ul><li>éœ€è¦ <code>volatile</code> ä¿®é¥°å˜é‡ï¼Œé˜²æ­¢ <strong>æŒ‡ä»¤é‡æ’åº</strong>ã€‚</li></ul><p><strong>SimpleDateFormat æ˜¯éçº¿ç¨‹å®‰å…¨çš„</strong>ï¼š</p><p>å½“å¤šä¸ªçº¿ç¨‹åŒæ—¶ä½¿ç”¨åŒä¸€ä¸ªSimpleDateFormatå¯¹è±¡æ—¶,å¯èƒ½ä¼šå¯¼è‡´è§£æå’Œæ ¼å¼åŒ–é”™è¯¯ã€‚è¿™æ˜¯å› ä¸ºSimpleDateFormatçš„è®¾è®¡ä¸­åŒ…å«äº†å¯å˜çš„æˆå‘˜å˜é‡,åœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹ä¼šç›¸äº’å½±å“ã€‚</p><ul><li>æ¨èï¼šæ¯çº¿ç¨‹ä¸€ä¸ªå®ä¾‹ or ä½¿ç”¨ <code>ThreadLocal&lt;SimpleDateFormat&gt;</code>ã€‚</li></ul><h2 id="çº¿ç¨‹å…±äº«"><a href="#çº¿ç¨‹å…±äº«" class="headerlink" title="çº¿ç¨‹å…±äº«"></a>çº¿ç¨‹å…±äº«</h2><p><strong>çº¿ç¨‹å…±äº«åŒºåŸŸï¼š</strong></p><ul><li><strong>æ–¹æ³•åŒº</strong>ï¼šç±»å‹ä¿¡æ¯ã€é™æ€å˜é‡ã€å¸¸é‡ç­‰ã€‚</li><li><strong>Java å †</strong>ï¼šå¯¹è±¡å®ä¾‹çš„ä¸»è¦å†…å­˜åŒºåŸŸã€‚</li></ul><p><strong>çº¿ç¨‹ç§æœ‰åŒºåŸŸï¼š</strong></p><ul><li><strong>ç¨‹åºè®¡æ•°å™¨</strong>ï¼šè®°å½•å½“å‰çº¿ç¨‹æ‰§è¡Œä½ç½®ã€‚</li><li><strong>è™šæ‹Ÿæœºæ ˆ</strong>ï¼šæ¯ä¸ªçº¿ç¨‹æœ‰ç‹¬ç«‹æ–¹æ³•æ ˆï¼Œå­˜å±€éƒ¨å˜é‡ç­‰ä¿¡æ¯ã€‚</li></ul><h1 id="callable"><a href="#callable" class="headerlink" title="callable"></a>callable</h1><p>å¤šçº¿ç¨‹çš„å¦ä¸€ç§å®éªŒæ–¹å¼</p><p><strong>è¿˜å¯ä»¥ä½¿ç”¨ä½¿ç”¨Callableæ¥å£</strong>ï¼ŒCallableæ¥å£çš„<strong>call()æ–¹æ³•ç¡®å®å¯ä»¥è¿”å›å€¼ï¼Œå¹¶ä¸”èƒ½å¤ŸæŠ›å‡ºå¼‚å¸¸</strong>ã€‚è¿™æ˜¯å®ƒåŒºåˆ«äºRunnableæ¥å£run()æ–¹æ³•çš„é‡è¦ç‰¹å¾ã€‚run()æ–¹æ³•æ—¢ä¸èƒ½è¿”å›å€¼ï¼Œä¹Ÿä¸èƒ½æŠ›å‡ºå—æ£€å¼‚å¸¸ã€‚</p><p>å®ä¾‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.util.concurrent.Callable;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.ExecutionException;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.FutureTask;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CallableTest</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ExecutionException, InterruptedException &#123;</span><br><span class="line">        <span class="comment">// åˆ›å»ºä¸€ä¸ª FutureTaskï¼ŒåŒ…è£…ä¸€ä¸ª Callable å¯¹è±¡</span></span><br><span class="line">        FutureTask&lt;Integer&gt; futureTask = <span class="keyword">new</span> <span class="title class_">FutureTask</span>&lt;&gt;(<span class="keyword">new</span> <span class="title class_">MyThread</span>());</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å¯åŠ¨çº¿ç¨‹ï¼Œå®é™…æ‰§è¡Œçš„æ˜¯ futureTask.run()ï¼Œå†…éƒ¨ä¼šè°ƒç”¨ call() æ–¹æ³•</span></span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(futureTask, <span class="string">&quot;a&quot;</span>).start();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// é˜»å¡ç­‰å¾… call() æ‰§è¡Œç»“æœè¿”å›</span></span><br><span class="line">        System.out.println(futureTask.get());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è‡ªå®šä¹‰ä¸€ä¸ªçº¿ç¨‹ä»»åŠ¡ï¼Œå®ç° Callable æ¥å£</span></span><br><span class="line"><span class="keyword">class</span> <span class="title class_">MyThread</span> <span class="keyword">implements</span> <span class="title class_">Callable</span>&lt;Integer&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Integer <span class="title function_">call</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        System.out.println(Thread.currentThread().getName() + <span class="string">&quot; æ­£åœ¨æ‰§è¡Œ&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="number">123</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><div class="table-container"><table><thead><tr><th>ç‰¹æ€§</th><th>Runnable</th><th>Callable</th></tr></thead><tbody><tr><td></td><td></td></tr></tbody></table></div><div class="table-container"><table><thead><tr><th>æ˜¯å¦æœ‰è¿”å›å€¼</th><th>âŒ æ²¡æœ‰</th><th>âœ… æœ‰è¿”å›å€¼</th></tr></thead><tbody><tr><td></td><td></td></tr></tbody></table></div><div class="table-container"><table><thead><tr><th>æ˜¯å¦æŠ›å¼‚å¸¸</th><th>âŒ ä¸èƒ½æŠ› checked å¼‚å¸¸</th><th>âœ… å¯ä»¥æŠ›å¼‚å¸¸</th></tr></thead><tbody><tr><td></td><td></td></tr></tbody></table></div><div class="table-container"><table><thead><tr><th>æ–¹æ³•å</th><th><code>run()</code></th><th><code>call()</code></th></tr></thead><tbody><tr><td></td><td></td></tr></tbody></table></div><div class="table-container"><table><thead><tr><th>æ‰§è¡Œæ–¹å¼</th><th><code>Thread</code> / <code>ExecutorService</code></th><th>ä¸€èˆ¬é…åˆ <code>FutureTask</code> ä½¿ç”¨</th></tr></thead><tbody><tr><td></td><td></td></tr></tbody></table></div><h2 id="FutureTask"><a href="#FutureTask" class="headerlink" title="FutureTask"></a><code>FutureTask</code></h2><ul><li>æ˜¯ <code>Runnable</code> + <code>Future</code> çš„å®ç°ç±»</li><li>å¯ä»¥ä¼ å…¥ä¸€ä¸ª <code>Callable</code>ï¼Œé€šè¿‡ <code>Thread</code> æ‰§è¡Œå®ƒ</li><li>å¯ä»¥ç”¨ <code>.get()</code> è·å–è¿”å›å€¼ï¼Œ<strong>è¯¥æ–¹æ³•ä¼šé˜»å¡ï¼Œç›´åˆ°ä»»åŠ¡æ‰§è¡Œå®Œæ¯•</strong></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BigStar</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ExecutionException, InterruptedException &#123;</span><br><span class="line">        Callable&lt;String&gt; callable = <span class="keyword">new</span> <span class="title class_">Test</span>(<span class="number">100</span>);</span><br><span class="line">        FutureTask&lt;String&gt; futureTask = <span class="keyword">new</span> <span class="title class_">FutureTask</span>&lt;&gt;(callable);</span><br><span class="line">        <span class="keyword">new</span> <span class="title class_">Thread</span>(futureTask).start();</span><br><span class="line">        <span class="type">String</span> <span class="variable">rs</span> <span class="operator">=</span> futureTask.get();</span><br><span class="line">        System.out.println(rs);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="è¾…åŠ©ç±»â€”tool"><a href="#è¾…åŠ©ç±»â€”tool" class="headerlink" title="è¾…åŠ©ç±»â€”tool"></a>è¾…åŠ©ç±»â€”tool</h1><h2 id="CountDownLatchï¼ˆå€’è®¡æ—¶é”ï¼‰"><a href="#CountDownLatchï¼ˆå€’è®¡æ—¶é”ï¼‰" class="headerlink" title="CountDownLatchï¼ˆå€’è®¡æ—¶é”ï¼‰"></a><code>CountDownLatch</code>ï¼ˆå€’è®¡æ—¶é”ï¼‰</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">CountDownLatch</span> <span class="variable">latch</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CountDownLatch</span>(<span class="number">5</span>); <span class="comment">// åˆå§‹åŒ–è®¡æ•°å™¨ä¸º5</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">        <span class="comment">// æ‰§è¡Œå®Œåè°ƒç”¨ countDown</span></span><br><span class="line">        latch.countDown();</span><br><span class="line">    &#125;).start();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">latch.await(); <span class="comment">// ç­‰å¾…è®¡æ•°å™¨å½’é›¶</span></span><br><span class="line">System.out.println(<span class="string">&quot;mainçº¿ç¨‹ç»§ç»­æ‰§è¡Œ&quot;</span>);</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><code>countDown()</code>ï¼šæ¯è°ƒç”¨ä¸€æ¬¡ï¼Œè®¡æ•°å™¨å‡1ã€‚</p><p><code>await()</code>ï¼šé˜»å¡ç­‰å¾…ï¼Œç›´åˆ°è®¡æ•°å™¨ä¸º0å†å¾€ä¸‹æ‰§è¡Œã€‚</p><p>å¤šä¸ªå­ä»»åŠ¡å®Œæˆåä¸»çº¿ç¨‹æ‰æ‰§è¡Œï¼ˆæ¯”å¦‚ï¼šå¹¶è¡ŒåŠ è½½èµ„æº â†’ å…¨éƒ¨å®Œæˆ â†’ ä¸»çº¿ç¨‹ç»§ç»­ï¼‰ã€‚</p><h2 id="CyclicBarrierï¼ˆå¾ªç¯å±éšœï¼‰"><a href="#CyclicBarrierï¼ˆå¾ªç¯å±éšœï¼‰" class="headerlink" title="CyclicBarrierï¼ˆå¾ªç¯å±éšœï¼‰"></a><code>CyclicBarrier</code>ï¼ˆå¾ªç¯å±éšœï¼‰</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">CyclicBarrier</span> <span class="variable">barrier</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">CyclicBarrier</span>(<span class="number">7</span>, () -&gt; &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;å¬å”¤ç¥é¾™æˆåŠŸï¼&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">7</span>; i++) &#123;</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">        barrier.await(); <span class="comment">// ç­‰å¾…æ‰€æœ‰çº¿ç¨‹åˆ°é½</span></span><br><span class="line">    &#125;).start();</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æ‰€æœ‰çº¿ç¨‹éƒ½è°ƒç”¨ <code>await()</code>ï¼Œç­‰æ•°é‡æ»¡åè§¦å‘å›è°ƒï¼ˆå¯é€‰ï¼‰ï¼Œ<strong>åŒæ—¶é‡Šæ”¾æ‰€æœ‰çº¿ç¨‹</strong>ã€‚</p><p><strong>å¯ä»¥é‡å¤ä½¿ç”¨ï¼ˆå¾ªç¯å±éšœï¼‰</strong>ã€‚</p><p>å¤šä¸ªçº¿ç¨‹<strong>å¹¶å‘é˜¶æ®µæ€§åŒæ­¥</strong>ï¼Œå¦‚ï¼šå¤šçº¿ç¨‹åˆ†æ‰¹å†™å…¥æ•°æ®åº“ï¼Œæ¯æ‰¹å®Œæˆåç»Ÿä¸€æäº¤ã€‚</p><h2 id="Semaphoreï¼ˆä¿¡å·é‡ï¼‰"><a href="#Semaphoreï¼ˆä¿¡å·é‡ï¼‰" class="headerlink" title="Semaphoreï¼ˆä¿¡å·é‡ï¼‰"></a><code>Semaphore</code>ï¼ˆä¿¡å·é‡ï¼‰</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Semaphore</span> <span class="variable">semaphore</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Semaphore</span>(<span class="number">3</span>); <span class="comment">// åŒæ—¶åªèƒ½æœ‰3ä¸ªçº¿ç¨‹è®¿é—®</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt; <span class="number">6</span>; i++) &#123;</span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">        semaphore.acquire(); <span class="comment">// è¯·æ±‚è®¸å¯ï¼ˆå å‘ï¼‰</span></span><br><span class="line">        <span class="comment">// æ‰§è¡Œä¸šåŠ¡é€»è¾‘</span></span><br><span class="line">        semaphore.release(); <span class="comment">// é‡Šæ”¾è®¸å¯ï¼ˆç¦»å¼€ï¼‰</span></span><br><span class="line">    &#125;).start();</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><code>acquire()</code>ï¼šç”³è¯·èµ„æºï¼Œæ²¡èµ„æºå°±é˜»å¡ã€‚</p><p><code>release()</code>ï¼šé‡Šæ”¾èµ„æºï¼Œå”¤é†’ç­‰å¾…çš„çº¿ç¨‹ã€‚</p><p>æ§åˆ¶åŒæ—¶è®¿é—®èµ„æºçš„çº¿ç¨‹æ•°ï¼Œæ¯”å¦‚ï¼šé™æµã€æ•°æ®åº“è¿æ¥æ± ã€åœè½¦åœº3ä¸ªè½¦ä½6è¾†è½¦ç¤ºä¾‹ç­‰ã€‚</p><p><strong>CyclicBarrierå’ŒCountDownLatch</strong>ç¡®å®éƒ½å¯ä»¥è®©<strong>ä¸€ç»„çº¿ç¨‹ç­‰å¾…å…¶ä»–çº¿ç¨‹</strong>ã€‚CyclicBarrierç”¨äºè®©ä¸€ç»„çº¿ç¨‹äº’ç›¸ç­‰å¾…ï¼Œç›´åˆ°æ‰€æœ‰çº¿ç¨‹éƒ½åˆ°è¾¾æŸä¸ªå…¬å…±å±éšœç‚¹ã€‚CountDownLatchåˆ™å…è®¸ä¸€ä¸ªæˆ–å¤šä¸ªçº¿ç¨‹ç­‰å¾…å…¶ä»–çº¿ç¨‹å®Œæˆä¸€ç»„æ“ä½œã€‚</p><h1 id="é˜»å¡"><a href="#é˜»å¡" class="headerlink" title="é˜»å¡"></a>é˜»å¡</h1><h2 id="æ¦‚å¿µ"><a href="#æ¦‚å¿µ" class="headerlink" title="æ¦‚å¿µ"></a>æ¦‚å¿µ</h2><ul><li><strong>æ¥å£</strong>ï¼š<code>java.util.concurrent.BlockingQueue&lt;E&gt;</code></li><li><strong>ç‰¹ç‚¹</strong>ï¼šå½“é˜Ÿåˆ—ç©ºæ—¶ï¼Œå–å…ƒç´ çš„æ“ä½œä¼š<strong>é˜»å¡ç­‰å¾…</strong>ï¼›å½“é˜Ÿåˆ—æ»¡æ—¶ï¼Œå­˜å…ƒç´ çš„æ“ä½œä¼š<strong>é˜»å¡ç­‰å¾…</strong>ã€‚</li><li><strong>å…¸å‹åœºæ™¯</strong>ï¼šç”Ÿäº§è€…â€“æ¶ˆè´¹è€…æ¨¡å‹ã€çº¿ç¨‹æ± å†…éƒ¨ä»»åŠ¡é˜Ÿåˆ—ã€å¹¶å‘é™æµï¼ˆä»¤ç‰Œæ¡¶ï¼‰ç­‰ã€‚</li></ul><p>é˜Ÿæ»¡é˜Ÿç©ºçš„æ—¶å€™ä¼šé˜»å¡</p><h2 id="å››ç±»API"><a href="#å››ç±»API" class="headerlink" title="å››ç±»API"></a>å››ç±»API</h2><div class="table-container"><table><thead><tr><th>åˆ†ç»„</th><th>æ’å…¥ï¼ˆAddï¼‰</th><th>ç§»é™¤ï¼ˆRemoveï¼‰</th><th>æ£€æŸ¥ï¼ˆExamineï¼‰</th></tr></thead><tbody><tr><td><strong>1. æŠ›å¼‚å¸¸</strong></td><td><code>add(e)</code></td><td><code>remove()</code> / <code>remove(e)</code></td><td><code>element()</code></td></tr><tr><td><strong>2. ç‰¹æ®Šå€¼</strong></td><td><code>offer(e)</code></td><td><code>poll()</code></td><td><code>peek()</code></td></tr><tr><td><strong>3. é˜»å¡</strong></td><td><code>put(e)</code></td><td><code>take()</code></td><td>â€”</td></tr><tr><td><strong>4. è¶…æ—¶é˜»å¡</strong></td><td><code>offer(e, timeout)</code></td><td><code>poll(timeout)</code></td><td>â€”</td></tr></tbody></table></div><p>æŠ›å¼‚å¸¸ç»„ï¼š</p><p><strong><code>add(e)</code></strong>ï¼šé˜Ÿæ»¡æ—¶æŠ› <code>IllegalStateException</code></p><p><strong><code>remove()</code></strong>ï¼šé˜Ÿç©ºæ—¶æŠ› <code>NoSuchElementException</code></p><p><strong><code>element()</code></strong>ï¼šé˜Ÿç©ºæ—¶æŠ› <code>NoSuchElementException</code></p><p>ç‰¹æ®Šå€¼ç»„ï¼š</p><p><strong><code>offer(e)</code></strong>ï¼šé˜Ÿæ»¡æ—¶è¿”å› <code>false</code>ï¼Œå¦åˆ™è¿”å› <code>true</code></p><p><strong><code>poll()</code></strong>ï¼šé˜Ÿç©ºæ—¶è¿”å› <code>null</code></p><p><strong><code>peek()</code></strong>ï¼šé˜Ÿç©ºæ—¶è¿”å› <code>null</code></p><p>é˜»å¡ç»„ï¼š</p><p><strong><code>put(e)</code></strong>ï¼šé˜Ÿæ»¡æ—¶<strong>é˜»å¡</strong>ç›´åˆ°æœ‰ç©ºé—´</p><p><strong><code>take()</code></strong>ï¼šé˜Ÿç©ºæ—¶<strong>é˜»å¡</strong>ç›´åˆ°æœ‰å…ƒç´ </p><p>è¶…æ—¶é˜»å¡ç»„ï¼š</p><ul><li><strong><code>offer(e, timeout, unit)</code></strong>ï¼šç­‰å¾…æŒ‡å®šæ—¶é—´ä»æ»¡åˆ™è¿”å› <code>false</code></li><li><strong><code>poll(timeout, unit)</code></strong>ï¼šç­‰å¾…æŒ‡å®šæ—¶é—´ä»ç©ºåˆ™è¿”å› <code>null</code></li></ul><h2 id="å¸¸è§å®ç°ç±»"><a href="#å¸¸è§å®ç°ç±»" class="headerlink" title="å¸¸è§å®ç°ç±»"></a>å¸¸è§å®ç°ç±»</h2><div class="table-container"><table><thead><tr><th>å®ç°ç±»</th><th>ç‰¹ç‚¹</th></tr></thead><tbody><tr><td><code>ArrayBlockingQueue</code></td><td><strong>æœ‰ç•Œ</strong>é˜»å¡é˜Ÿåˆ—ï¼ŒåŸºäºæ•°ç»„ï¼Œ<strong>FIFO</strong></td></tr><tr><td><code>LinkedBlockingQueue</code></td><td>å¯é€‰æœ‰ç•Œ/æ— ç•Œï¼ŒåŸºäºåŒå‘é“¾è¡¨ï¼Œ<strong>ååé‡é«˜</strong></td></tr><tr><td><code>PriorityBlockingQueue</code></td><td><strong>æ— ç•Œ</strong>ï¼Œæ”¯æŒ<strong>ä¼˜å…ˆçº§æ’åº</strong>ï¼Œä¸å…è®¸null</td></tr><tr><td><code>DelayQueue</code></td><td><strong>å»¶è¿Ÿé˜Ÿåˆ—</strong>ï¼Œå…ƒç´ åªæœ‰åˆ°æœŸåæ‰èƒ½å–å‡º</td></tr><tr><td><code>SynchronousQueue</code></td><td><strong>é›¶å®¹é‡</strong>é˜Ÿåˆ—ï¼Œæ¯ä¸ª <code>put</code> å¿…é¡»ç­‰å¾… <code>take</code></td></tr><tr><td><code>LinkedTransferQueue</code></td><td>æ”¯æŒ <strong>transfer</strong> æ“ä½œçš„æ— ç•Œé˜Ÿåˆ—</td></tr></tbody></table></div><p><strong>SynchronousQueueï¼š</strong></p><p><strong>å®¹é‡ä¸º 0</strong>ï¼Œä¸å­˜å‚¨å…ƒç´ ã€‚</p><p>æ¯ä¸€æ¬¡ <code>put(e)</code> å¿…é¡»ç­‰å¾…å¦ä¸€ä¸ªçº¿ç¨‹æ¥ <code>take()</code>ï¼Œå¦åˆ™<strong>ä¸€ç›´é˜»å¡</strong>ã€‚</p><p>å…¸å‹ç”¨äº<strong>ç›´æ¥äº¤æ›¿</strong>çš„åœºæ™¯ï¼Œä¾‹å¦‚ï¼šçº¿ç¨‹é—´<strong>ç›´æ¥äº¤æ¢æ•°æ®</strong>ï¼Œæˆ–çº¿ç¨‹æ± çš„æ‰‹åŠ¨åˆ‡æ¢ç­–ç•¥ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">SynchronousQueue&lt;String&gt; queue = <span class="keyword">new</span> <span class="title class_">SynchronousQueue</span>&lt;&gt;();</span><br><span class="line"><span class="comment">// ç”Ÿäº§çº¿ç¨‹</span></span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;T1 put 1&quot;</span>);</span><br><span class="line">    queue.put(<span class="string">&quot;1&quot;</span>);   <span class="comment">// é˜»å¡ç›´åˆ°è¢«å–</span></span><br><span class="line">    System.out.println(<span class="string">&quot;T1 put 2&quot;</span>);</span><br><span class="line">    queue.put(<span class="string">&quot;2&quot;</span>);</span><br><span class="line">&#125;, <span class="string">&quot;T1&quot;</span>).start();</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ¶ˆè´¹çº¿ç¨‹</span></span><br><span class="line"><span class="keyword">new</span> <span class="title class_">Thread</span>(() -&gt; &#123;</span><br><span class="line">    TimeUnit.SECONDS.sleep(<span class="number">3</span>);</span><br><span class="line">    System.out.println(<span class="string">&quot;T2 take=&gt; &quot;</span> + queue.take());</span><br><span class="line">    TimeUnit.SECONDS.sleep(<span class="number">3</span>);</span><br><span class="line">    System.out.println(<span class="string">&quot;T2 take=&gt; &quot;</span> + queue.take());</span><br><span class="line">&#125;, <span class="string">&quot;T2&quot;</span>).start();</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æ„æ€å°±æ˜¯ç”Ÿæˆå®Œä¸æ¶ˆè´¹çš„è¯ï¼Œå°±ä¼šä¸€ç›´block</p><h2 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h2><p><strong>çº¿ç¨‹æ± </strong>ï¼š<code>ThreadPoolExecutor</code> å†…éƒ¨ä½¿ç”¨ <code>BlockingQueue&lt;Runnable&gt;</code> æ¥ç¼“å­˜ä»»åŠ¡ã€‚</p><p><strong>ç”Ÿäº§è€…â€“æ¶ˆè´¹è€…</strong>ï¼šé«˜æ•ˆçš„çº¿ç¨‹é—´ä¼ é€’æ•°æ®ã€‚</p><p><strong>é™æµ/ä»¤ç‰Œæ¡¶</strong>ï¼šæ§åˆ¶å¹¶å‘é‡æˆ–é€Ÿç‡ã€‚</p><p><strong>ç›´æ¥äº¤äº’</strong>ï¼š<code>SynchronousQueue</code> åšå¿«é€Ÿäº¤æ›¿ä¼ é€’ã€‚</p><h1 id="TLS"><a href="#TLS" class="headerlink" title="TLS"></a>TLS</h1><p>TLS(çº¿ç¨‹å±€éƒ¨å­˜å‚¨)æ˜¯ä¸€ç§ç‰¹æ®Šçš„å­˜å‚¨æœºåˆ¶ï¼Œå®ƒä¸ºæ¯ä¸ªçº¿ç¨‹æä¾›<strong>ç‹¬ç«‹çš„å˜é‡å‰¯æœ¬</strong></p><p>é¿å…å¤šçº¿ç¨‹è®¿é—®å†²çª</p><p>æ¯ä¸ªçº¿ç¨‹åªèƒ½è®¿é—®è‡ªå·±çš„å˜é‡å‰¯æœ¬ï¼Œ<strong>å…¶ä»–çº¿ç¨‹æ— æ³•è®¿é—®</strong>ã€‚</p><p>æ³¨æ„ï¼šå¦‚æœå˜é‡æ“ä½œæ¶‰åŠå¤šä¸ªæ­¥éª¤æˆ–è®¿é—®å…±äº«èµ„æºï¼Œ<strong>ä»ç„¶éœ€è¦åŒæ­¥æœºåˆ¶</strong>ã€‚</p><p>Java ä¸­çš„ <strong><code>ThreadLocal</code></strong> æ˜¯ TLS çš„å…·ä½“å®ç°ã€‚</p><h2 id="ThreadLocal"><a href="#ThreadLocal" class="headerlink" title="ThreadLocal"></a>ThreadLocal</h2><p><code>ThreadLocal</code> æ˜¯ Java å®ç° <strong>çº¿ç¨‹æœ¬åœ°å­˜å‚¨</strong> çš„é‡è¦æœºåˆ¶ã€‚è®¾è®¡çš„ç›®çš„æ˜¯ä¸ºäº†ä¿è¯çº¿ç¨‹å®‰å…¨</p><p>æ¯ä¸ªçº¿ç¨‹å†…éƒ¨ç»´æŠ¤ä¸€ä¸ª <strong><code>ThreadLocalMap</code> å“ˆå¸Œè¡¨</strong>ï¼Œå­˜å‚¨è‡ªå·±çš„å˜é‡å‰¯æœ¬ã€‚</p><p>æœ¬è´¨ï¼š<strong>é¿å…å¤šçº¿ç¨‹å…±äº«æ•°æ®</strong>ï¼Œæ¯ä¸ªçº¿ç¨‹æœ‰è‡ªå·±çš„æ•°æ®å‰¯æœ¬ï¼Œå®ç°æ•°æ®éš”ç¦»ã€‚</p><p>æ¯ä¸ªçº¿ç¨‹è®¿é—®ThreadLocalå˜é‡æ—¶ï¼Œå®é™…æ˜¯åœ¨<strong>æ“ä½œè‡ªå·±çš„ThreadLocalMapä¸­çš„å‰¯æœ¬ã€‚</strong></p><p><code>ThreadLocal</code>ï¼š</p><ul><li><strong>ä¸æ˜¯ç»§æ‰¿ Thread ç±»</strong></li><li><strong>ä¸å®ç° Runnable æ¥å£</strong></li></ul><p>ä½¿ç”¨äº† <strong>å¼€æ”¾å®šå€æ³•</strong> è§£å†³å“ˆå¸Œå†²çªã€‚</p><h1 id="çº¿ç¨‹æ± "><a href="#çº¿ç¨‹æ± " class="headerlink" title="çº¿ç¨‹æ± "></a>çº¿ç¨‹æ± </h1><p>å°±æ˜¯ä¸€ä¸ªå¯ä»¥<strong>å¤ç”¨çº¿ç¨‹</strong>çš„æŠ€æœ¯</p><p>åŸç†ï¼š</p><p>åˆ†ä¸ºå·¥ä½œçº¿ç¨‹å’Œä»»åŠ¡é˜Ÿåˆ—ä¸¤éƒ¨åˆ†</p><p>ä»»åŠ¡æ˜¯ä¸€ä¸ªå®ç°Runnableæˆ–è€…Callableçš„å¯¹è±¡</p><p>ä¼šæ§åˆ¶ä»»åŠ¡çš„æ•°é‡å’Œçº¿ç¨‹çš„æ•°é‡ï¼Œä¸ä¼šå ç”¨è¿‡å¤šçš„èµ„æº</p><h2 id="3å¤§åˆ›å»ºæ–¹å¼"><a href="#3å¤§åˆ›å»ºæ–¹å¼" class="headerlink" title="3å¤§åˆ›å»ºæ–¹å¼"></a>3å¤§åˆ›å»ºæ–¹å¼</h2><div class="table-container"><table><thead><tr><th>æ–¹æ³•</th><th>å«ä¹‰</th><th>ç‰¹ç‚¹</th></tr></thead><tbody><tr><td><code>Executors.newFixedThreadPool(int n)</code></td><td>å›ºå®šå¤§å°çº¿ç¨‹æ± </td><td>æ ¸å¿ƒçº¿ç¨‹æ•°å›ºå®šï¼Œä»»åŠ¡é˜Ÿåˆ—æ— ç•Œï¼Œ<strong>å®¹æ˜“ OOM</strong></td></tr><tr><td><code>Executors.newSingleThreadExecutor()</code></td><td>å•çº¿ç¨‹çº¿ç¨‹æ± </td><td>ä¸€ä¸ªæ ¸å¿ƒçº¿ç¨‹ï¼Œé¡ºåºæ‰§è¡Œï¼Œ<strong>ä¸²è¡Œä»»åŠ¡æ‰§è¡Œ</strong></td></tr><tr><td><code>Executors.newCachedThreadPool()</code></td><td>å¯ä¼¸ç¼©çº¿ç¨‹æ± </td><td>æ— é™çº¿ç¨‹æ•°ï¼Œæœ‰ç©ºçº¿ç¨‹å°±å¤ç”¨ï¼Œ<strong>å®¹æ˜“çº¿ç¨‹çˆ†ç‚¸</strong></td></tr></tbody></table></div><p>è¿™ä¸‰ç§æ–¹æ³•ä¸æ¨èåœ¨ç”Ÿäº§ä½¿ç”¨ï¼å› ä¸ºï¼š</p><ul><li>é˜Ÿåˆ—æ˜¯æ— ç•Œçš„ï¼Œå®¹æ˜“å¯¼è‡´ <strong>å†…å­˜æº¢å‡º</strong></li><li>ç¼ºå°‘å‚æ•°æ§åˆ¶ï¼Œç»´æŠ¤å›°éš¾</li></ul><h2 id="æ‰‹åŠ¨åˆ›å»º"><a href="#æ‰‹åŠ¨åˆ›å»º" class="headerlink" title="æ‰‹åŠ¨åˆ›å»º"></a>æ‰‹åŠ¨åˆ›å»º</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="title function_">ThreadPoolExecutor</span><span class="params">(</span></span><br><span class="line"><span class="params">    <span class="type">int</span> corePoolSize,              // <span class="number">1.</span> æ ¸å¿ƒçº¿ç¨‹æ•°</span></span><br><span class="line"><span class="params">    <span class="type">int</span> maximumPoolSize,           // <span class="number">2.</span> æœ€å¤§çº¿ç¨‹æ•°</span></span><br><span class="line"><span class="params">    <span class="type">long</span> keepAliveTime,            // <span class="number">3.</span> çº¿ç¨‹æœ€å¤§ç©ºé—²æ—¶é—´</span></span><br><span class="line"><span class="params">    TimeUnit unit,                 // <span class="number">4.</span> æ—¶é—´å•ä½</span></span><br><span class="line"><span class="params">    BlockingQueue&lt;Runnable&gt; workQueue, // <span class="number">5.</span> ä»»åŠ¡é˜Ÿåˆ—</span></span><br><span class="line"><span class="params">    ThreadFactory threadFactory,   // <span class="number">6.</span> çº¿ç¨‹å·¥å‚ï¼ˆå¯é€‰ï¼šè‡ªå®šä¹‰å‘½åï¼‰</span></span><br><span class="line"><span class="params">    RejectedExecutionHandler handler // <span class="number">7.</span> æ‹’ç»ç­–ç•¥</span></span><br><span class="line"><span class="params">)</span></span><br></pre></td></tr></table></figure><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BigStar</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="comment">// åˆ›å»ºçº¿ç¨‹æ± ï¼Œæ ¸å¿ƒçº¿ç¨‹æ•°ä¸º2ï¼Œæœ€å¤§çº¿ç¨‹æ•°ä¸º4ï¼Œä¿æŒç©ºé—²çº¿ç¨‹æ—¶é—´ä¸º60ç§’ï¼Œä»»åŠ¡é˜Ÿåˆ—å®¹é‡ä¸º10</span></span><br><span class="line">        <span class="type">ThreadPoolExecutor</span> <span class="variable">executor</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ThreadPoolExecutor</span>(</span><br><span class="line">                <span class="number">2</span>, <span class="comment">// æ ¸å¿ƒçº¿ç¨‹æ•°</span></span><br><span class="line">                <span class="number">4</span>, <span class="comment">// æœ€å¤§çº¿ç¨‹æ•°</span></span><br><span class="line">                <span class="number">60</span>, <span class="comment">// çº¿ç¨‹ç©ºé—²ä¿æŒæ—¶é—´</span></span><br><span class="line">                TimeUnit.SECONDS, <span class="comment">// æ—¶é—´å•ä½</span></span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">ArrayBlockingQueue</span>&lt;&gt;(<span class="number">10</span>) <span class="comment">// é˜»å¡é˜Ÿåˆ—å®¹é‡ä¸º10</span></span><br><span class="line">        );</span><br><span class="line"></span><br><span class="line">        <span class="comment">// æäº¤ä»»åŠ¡åˆ°çº¿ç¨‹æ± </span></span><br><span class="line">        executor.execute(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt;= <span class="number">5</span>; i++) &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;aaa&quot;</span> + i);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        executor.execute(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt;= <span class="number">5</span>; i++) &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;bbb&quot;</span> + i);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        executor.execute(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span> <span class="number">0</span>; i &lt;= <span class="number">5</span>; i++) &#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;ccc&quot;</span> + i);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// å…³é—­çº¿ç¨‹æ± ï¼Œé˜²æ­¢æ–°ä»»åŠ¡æäº¤ï¼Œä½†ä¼šæ‰§è¡Œå®Œå·²æäº¤çš„ä»»åŠ¡</span></span><br><span class="line">        executor.shutdown();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// ç­‰å¾…çº¿ç¨‹æ± ä¸­ä»»åŠ¡å®Œæˆ</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (!executor.awaitTermination(<span class="number">60</span>, TimeUnit.SECONDS)) &#123;</span><br><span class="line">                executor.shutdownNow();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            executor.shutdownNow();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®æˆ˜æ¨¡æ¿ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ExecutorService</span> <span class="variable">threadPool</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ThreadPoolExecutor</span>(</span><br><span class="line">    <span class="number">2</span>, <span class="comment">// corePoolSize</span></span><br><span class="line">    <span class="number">5</span>, <span class="comment">// maximumPoolSize</span></span><br><span class="line">    <span class="number">3</span>, TimeUnit.SECONDS, <span class="comment">// keepAliveTime</span></span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">LinkedBlockingQueue</span>&lt;&gt;(<span class="number">3</span>), <span class="comment">// workQueue å®¹é‡ä¸º3</span></span><br><span class="line">    Executors.defaultThreadFactory(), <span class="comment">// threadFactory</span></span><br><span class="line">    <span class="keyword">new</span> <span class="title class_">ThreadPoolExecutor</span>.CallerRunsPolicy() <span class="comment">// æ‹’ç»ç­–ç•¥</span></span><br><span class="line">);</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>æ³¨æ„äº‹é¡¹ï¼š</p><ul><li><strong>ä¸´æ—¶çº¿ç¨‹ä»€ä¹ˆæ—¶å€™åˆ›å»º</strong>ï¼Ÿæ–°ä»»åŠ¡æäº¤çš„æ—¶å€™æ ¸å¿ƒçº¿ç¨‹éƒ½åœ¨å¿™ï¼Œä»»åŠ¡é˜Ÿåˆ—æ»¡äº†ï¼Œå¹¶è¿˜å¯ä»¥åˆ›å»ºæ–°çš„ä¸´æ—¶çº¿ç¨‹ï¼Œæ‰ä¼šåˆ›å»ºä¸´æ—¶çº¿ç¨‹</li><li><strong>ä»€ä¹ˆæ—¶å€™ä¼šå¼€å§‹æ‹’ç»æ–°ä»»åŠ¡</strong>ï¼Ÿæ ¸å¿ƒçº¿ç¨‹å’Œä¸´æ—¶çº¿ç¨‹éƒ½åœ¨å¿™ï¼Œä»»åŠ¡é˜Ÿåˆ—ä¹Ÿæ»¡äº†ï¼Œæ–°çš„ä»»åŠ¡æ‰ä¼šå¼€å§‹æ‹’ç»æ–°ä»»åŠ¡</li></ul><p>æ ¸å¿ƒçº¿ç¨‹æ•°é‡åº”è¯¥æ˜¯å¤šå°‘ï¼Ÿ</p><ul><li>è®¡ç®—å¯†é›†çš„ cpu+1</li><li>IOå¯†é›†çš„ cpu*2</li></ul><h2 id="å…³é—­ç­–ç•¥"><a href="#å…³é—­ç­–ç•¥" class="headerlink" title="å…³é—­ç­–ç•¥"></a>å…³é—­ç­–ç•¥</h2><p>shutdown()æ–¹æ³•ä¼šè®©çº¿ç¨‹æ± è¿›å…¥â€å…³é—­â€çŠ¶æ€,æ­¤æ—¶ä¸å†æ¥å—æ–°çš„ä»»åŠ¡æäº¤,ä½†ä¼šç»§ç»­æ‰§è¡Œé˜Ÿåˆ—ä¸­çš„ä»»åŠ¡ç›´åˆ°å®Œæˆã€‚è¿™æ˜¯ä¸€ç§<strong>å¹³ç¼“çš„å…³é—­æ–¹å¼ã€‚</strong></p><p>shutdownNow()æ–¹æ³•ä¼š<strong>å°è¯•ç»ˆæ­¢æ‰€æœ‰æ­£åœ¨æ‰§è¡Œçš„ä»»åŠ¡,å¹¶è¿”å›ç­‰å¾…æ‰§è¡Œçš„ä»»åŠ¡åˆ—è¡¨(List)</strong>ã€‚è¿™äº›ä»»åŠ¡æ˜¯å°šæœªå¼€å§‹æ‰§è¡Œçš„ä»»åŠ¡ã€‚</p><p>awaitTermination(long timeout, TimeUnit unit)æ˜¯é˜»å¡æ–¹æ³•,å®ƒä¼šç­‰å¾…ç›´åˆ°ä»¥ä¸‹ä¸‰ç§æƒ…å†µä¹‹ä¸€å‘ç”Ÿ:<br>- æ‰€æœ‰ä»»åŠ¡æ‰§è¡Œå®Œæˆ<br>- åˆ°è¾¾æŒ‡å®šçš„è¶…æ—¶æ—¶é—´<br>- å½“å‰çº¿ç¨‹è¢«ä¸­æ–­<br>è¿™ä¸ªæ–¹æ³•å¸¸ç”¨äº<strong>ç¡®ä¿çº¿ç¨‹æ± å®Œå…¨å…³é—­</strong>ã€‚</p><h2 id="å››å¤§æ‹’ç»ç­–ç•¥"><a href="#å››å¤§æ‹’ç»ç­–ç•¥" class="headerlink" title="å››å¤§æ‹’ç»ç­–ç•¥"></a>å››å¤§æ‹’ç»ç­–ç•¥</h2><div class="table-container"><table><thead><tr><th>ç­–ç•¥ç±»</th><th>ç­–ç•¥è¯´æ˜</th></tr></thead><tbody><tr><td><code>AbortPolicy</code>ï¼ˆé»˜è®¤ï¼‰</td><td>æŠ›å‡º <code>RejectedExecutionException</code> å¼‚å¸¸</td></tr><tr><td><code>CallerRunsPolicy</code></td><td><strong>è°æäº¤è°æ‰§è¡Œ</strong>ï¼ˆå›é€€ç»™è°ƒç”¨çº¿ç¨‹ï¼‰</td></tr><tr><td><code>DiscardPolicy</code></td><td>ç›´æ¥ä¸¢å¼ƒä»»åŠ¡ï¼Œä¸æŠ›å¼‚å¸¸</td></tr><tr><td><code>DiscardOldestPolicy</code></td><td>ä¸¢å¼ƒæœ€æ—©çš„ä»»åŠ¡ï¼Œç„¶åå°è¯•åŠ å…¥æ–°ä»»åŠ¡</td></tr></tbody></table></div><h2 id="å¸¸è§é¢è¯•é—®é¢˜"><a href="#å¸¸è§é¢è¯•é—®é¢˜" class="headerlink" title="å¸¸è§é¢è¯•é—®é¢˜"></a>å¸¸è§é¢è¯•é—®é¢˜</h2><p><strong>çº¿ç¨‹æ± æ‰§è¡Œæµç¨‹</strong>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (å½“å‰çº¿ç¨‹æ•° &lt; corePoolSize)</span><br><span class="line">    åˆ›å»ºæ–°çº¿ç¨‹æ‰§è¡Œä»»åŠ¡</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (é˜Ÿåˆ—æœªæ»¡)</span><br><span class="line">    æ”¾å…¥é˜»å¡é˜Ÿåˆ—</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (å½“å‰çº¿ç¨‹æ•° &lt; maximumPoolSize)</span><br><span class="line">    åˆ›å»ºéæ ¸å¿ƒçº¿ç¨‹å¤„ç†</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">    å¯åŠ¨æ‹’ç»ç­–ç•¥</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><strong>ä¸ºä»€ä¹ˆä¸ç”¨ Executors åˆ›å»ºçº¿ç¨‹æ± ï¼Ÿ</strong></p><p><code>Executors.newFixedThreadPool</code> å’Œ <code>newSingleThreadExecutor</code> ä½¿ç”¨çš„éƒ½æ˜¯<strong>æ— ç•Œé˜»å¡é˜Ÿåˆ—</strong>ï¼ˆå¦‚ <code>LinkedBlockingQueue</code>ï¼‰ï¼Œåœ¨ä»»åŠ¡ç§¯å‹æ—¶ä¼šæ— é™æ·»åŠ ä»»åŠ¡å¯¼è‡´å†…å­˜æº¢å‡ºï¼ˆOOMï¼‰</p><p><code>newCachedThreadPool</code> ä½¿ç”¨çš„æ˜¯<strong>æ— ç•Œçº¿ç¨‹æ•°</strong>ï¼ŒçŸ­æ—¶é—´å¤§é‡ä»»åŠ¡å¯èƒ½åˆ›å»ºæµ·é‡çº¿ç¨‹ï¼Œå¯¼è‡´ <strong>CPU è¢«æ‰“çˆ†æˆ–å†…å­˜æº¢å‡º</strong>ã€‚å› æ­¤ç”Ÿäº§æ¨èä½¿ç”¨ <code>ThreadPoolExecutor</code> å¹¶æŒ‡å®šå‚æ•°</p><p>ç”¨æ‰‹åŠ¨åˆ›å»ºæ›´å¥½</p><p><strong>æ ¸å¿ƒçº¿ç¨‹ä¸æœ€å¤§çº¿ç¨‹çš„åŒºåˆ«ï¼Ÿ</strong></p><p><code>corePoolSize</code> æ˜¯æ ¸å¿ƒçº¿ç¨‹æ•°ï¼Œçº¿ç¨‹æ± åˆ›å»ºå<strong>ä¼˜å…ˆä½¿ç”¨æ ¸å¿ƒçº¿ç¨‹</strong>ï¼›æ ¸å¿ƒçº¿ç¨‹é»˜è®¤æ˜¯å¸¸é©»çº¿ç¨‹ï¼Œå³ä½¿ç©ºé—²ä¹Ÿä¸å›æ”¶ï¼ˆé™¤éè®¾ç½® <code>allowCoreThreadTimeOut(true)</code>ï¼‰ã€‚<br><code>maximumPoolSize</code> æ˜¯çº¿ç¨‹æ± èƒ½å®¹çº³çš„<strong>æœ€å¤§çº¿ç¨‹æ•°</strong>ï¼Œå½“æ ¸å¿ƒçº¿ç¨‹+é˜Ÿåˆ—éƒ½æ»¡åæ‰ä¼šåˆ›å»ºéæ ¸å¿ƒçº¿ç¨‹ï¼Œè¶…è¿‡è¯¥æ•°é‡åå†æœ‰ä»»åŠ¡å°±è§¦å‘æ‹’ç»ç­–ç•¥ã€‚</p><p><strong>çº¿ç¨‹æ± å¦‚ä½•é¿å…èµ„æºè€—å°½ï¼Ÿ</strong></p><p>1ï¼‰åˆç†è®¾ç½® <code>corePoolSize</code> å’Œ <code>maximumPoolSize</code>ï¼›<br>2ï¼‰åˆç†è®¾ç½®é˜Ÿåˆ—å¤§å°ï¼ˆå¦‚ <code>ArrayBlockingQueue</code>ï¼‰ï¼›<br>3ï¼‰é€‰æ‹©åˆé€‚çš„ <code>RejectedExecutionHandler</code> æ‹’ç»ç­–ç•¥ï¼ˆå¦‚ <code>CallerRunsPolicy</code> å¯å›é€€æ‰§è¡Œï¼‰ï¼›<br>4ï¼‰é™åˆ¶ä»»åŠ¡æäº¤é€Ÿç‡ï¼ˆé™æµï¼‰æˆ–å¢åŠ ç›‘æ§æŠ¥è­¦æœºåˆ¶ã€‚</p><p><strong>çº¿ç¨‹æ± ä¸ºä»€ä¹ˆéœ€è¦ keepAliveTimeï¼Ÿ</strong></p><p><code>keepAliveTime</code> ç”¨äºæ§åˆ¶<strong>éæ ¸å¿ƒçº¿ç¨‹çš„ç”Ÿå­˜æ—¶é—´</strong>ï¼šçº¿ç¨‹åœ¨ç©ºé—²è¶…è¿‡è¿™ä¸ªæ—¶é—´åä¼šè¢«å›æ”¶ï¼Œé¿å…çº¿ç¨‹é•¿æ—¶é—´é—²ç½®æµªè´¹èµ„æºã€‚å¯é€šè¿‡ <code>allowCoreThreadTimeOut(true)</code> è®©æ ¸å¿ƒçº¿ç¨‹ä¹Ÿå‚ä¸è¶…æ—¶æœºåˆ¶ï¼Œæå‡èµ„æºåˆ©ç”¨ç‡ã€‚</p><p><strong>å¦‚ä½•å®šä½çº¿ç¨‹æ± æ»¡çš„æƒ…å†µï¼Ÿ</strong></p><p>å¯ä»ä»¥ä¸‹å‡ ä¸ªæ–¹é¢è¿›è¡Œæ’æŸ¥ï¼š<br>1ï¼‰æ—¥å¿—ä¸­ä¼šæŠ›å‡º <code>RejectedExecutionException</code>ï¼ˆé»˜è®¤æ‹’ç»ç­–ç•¥ï¼‰ï¼›<br>2ï¼‰è®¾ç½®è‡ªå®šä¹‰æ‹’ç»ç­–ç•¥ä¸­è®°å½•æ—¥å¿—æˆ–å‘Šè­¦ï¼›<br>3ï¼‰ä½¿ç”¨çº¿ç¨‹æ± ç›‘æ§å·¥å…·å¦‚ <strong>Arthas</strong>ã€<strong>JFR (Java Flight Recorder)</strong>ã€<strong>VisualVM</strong>ï¼ŒæŸ¥çœ‹çº¿ç¨‹æ± çŠ¶æ€ï¼šæ´»è·ƒçº¿ç¨‹æ•°ã€ä»»åŠ¡é˜Ÿåˆ—é•¿åº¦ç­‰ï¼›<br>4ï¼‰é€šè¿‡ <code>ThreadPoolExecutor</code> çš„ <code>getPoolSize()</code>ã€<code>getActiveCount()</code>ã€<code>getQueue().size()</code> ç­‰æ–¹æ³•åŠ¨æ€é‡‡é›†æŒ‡æ ‡å¹¶å†™å…¥ç›‘æ§ç³»ç»Ÿï¼ˆå¦‚ Prometheus + Grafanaï¼‰ã€‚</p><h1 id="CAS"><a href="#CAS" class="headerlink" title="CAS"></a>CAS</h1><p><strong>CASï¼ˆCompare And Swapï¼‰</strong> æ˜¯ä¸€ç§ <strong>æ— é”çš„å¹¶å‘åŸå­æ“ä½œ</strong>ï¼Œç”¨äºåœ¨å¤šçº¿ç¨‹ç¯å¢ƒä¸‹å®‰å…¨åœ°æ›´æ–°å˜é‡å€¼ï¼Œé¿å…ä½¿ç”¨ä¼ ç»Ÿçš„åŠ é”æœºåˆ¶ã€‚</p><p>CAS æœ‰ä¸‰ä¸ªæ“ä½œæ•°ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CAS(V, E, N)</span><br></pre></td></tr></table></figure><ul><li><strong>V</strong>ï¼šè¦æ›´æ–°çš„å˜é‡ï¼ˆå†…å­˜å€¼ï¼‰</li><li><strong>E</strong>ï¼šé¢„æœŸå€¼ï¼ˆExpectedï¼‰</li><li><strong>N</strong>ï¼šæ–°å€¼ï¼ˆNewï¼‰</li></ul><p>å®ƒçš„é€»è¾‘æ˜¯ï¼š</p><blockquote><p>å¦‚æœå˜é‡å½“å‰å€¼ == é¢„æœŸå€¼ Eï¼Œå°±å°†å…¶æ›´æ–°ä¸ºæ–°å€¼ Nï¼Œè¿”å› trueï¼›<br> å¦åˆ™è¯´æ˜åˆ«çš„çº¿ç¨‹å·²ç»ä¿®æ”¹äº†è¿™ä¸ªå€¼ï¼Œä¸åšæ“ä½œï¼Œè¿”å› falseã€‚</p></blockquote><p>Java çš„ <code>Unsafe</code> ç±»ã€<code>AtomicInteger</code>ã€<code>ConcurrentHashMap</code> ç­‰åº•å±‚éƒ½ç”¨äº† CASï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">AtomicInteger</span> <span class="variable">ai</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AtomicInteger</span>(<span class="number">0</span>);</span><br><span class="line">ai.compareAndSet(<span class="number">0</span>, <span class="number">1</span>); <span class="comment">// å¦‚æœå½“å‰å€¼ä¸º 0ï¼Œåˆ™è®¾ä¸º 1</span></span><br></pre></td></tr></table></figure><p>è¿™æ˜¯ä¸€ä¸ªå…¸å‹çš„ <strong>CAS æ“ä½œï¼šåŸå­åœ°æ¯”è¾ƒå¹¶æ›´æ–°</strong>ã€‚</p>]]></content:encoded>
      
      
      <category domain="https://blog.tokenlen.top/categories/%E6%8A%80%E6%9C%AF%E6%A0%88/">æŠ€æœ¯æ ˆ</category>
      
      
      <category domain="https://blog.tokenlen.top/tags/java/">java</category>
      
      <category domain="https://blog.tokenlen.top/tags/juc/">juc</category>
      
      
      <comments>https://blog.tokenlen.top/2025/05/09/java-stack/juc1/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>Leetcodeå„ç±»é¢˜ç›®æ¨¡æ¿åˆ†æé¢˜ç›®æ€»ç»“</title>
      <link>https://blog.tokenlen.top/2025/05/09/leetcode/leetcodetotal/</link>
      <guid>https://blog.tokenlen.top/2025/05/09/leetcode/leetcodetotal/</guid>
      <pubDate>Thu, 08 May 2025 16:00:00 GMT</pubDate>
      
        
        
          
          
      <description>&lt;h1 id=&quot;æ»‘åŠ¨çª—å£&quot;&gt;&lt;a href=&quot;#æ»‘åŠ¨çª—å£&quot; class=&quot;headerlink&quot; title=&quot;æ»‘åŠ¨çª—å£&quot;&gt;&lt;/a&gt;æ»‘åŠ¨çª—å£&lt;/h1&gt;&lt;p&gt;çœ‹åˆ°ä¸€ä¸²æ•°ç»„ï¼Œè¦æ±‚æ•°é‡çš„æ—¶å€™ï¼Œå¯èƒ½å°±ä¼šç”¨åˆ°æ»‘åŠ¨çª—å£&lt;/p&gt;
&lt;h2 id=&quot;å®šé•¿&quot;&gt;&lt;a href=&quot;#å®šé•¿&quot;</description>
          
        
      
      
      
      <content:encoded><![CDATA[<h1 id="æ»‘åŠ¨çª—å£"><a href="#æ»‘åŠ¨çª—å£" class="headerlink" title="æ»‘åŠ¨çª—å£"></a>æ»‘åŠ¨çª—å£</h1><p>çœ‹åˆ°ä¸€ä¸²æ•°ç»„ï¼Œè¦æ±‚æ•°é‡çš„æ—¶å€™ï¼Œå¯èƒ½å°±ä¼šç”¨åˆ°æ»‘åŠ¨çª—å£</p><h2 id="å®šé•¿"><a href="#å®šé•¿" class="headerlink" title="å®šé•¿"></a>å®šé•¿</h2><p>åªéœ€è¦è€ƒè™‘è¿›å‡ºå³å¯</p><p>ç„¶åè€ƒè™‘çª—å£å¤§å°ä¸è¶³çš„æ—¶å€™,continue</p><p>æ¨¡æ¿ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution643</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">double</span> <span class="title function_">findMaxAverage</span><span class="params">(<span class="type">int</span>[] nums, <span class="type">int</span> k)</span>&#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">maxS</span> <span class="operator">=</span> Integer.MIN_VALUE;</span><br><span class="line">        <span class="type">int</span> s=  <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span><span class="number">0</span>;i&lt;nums.length;i++)&#123;</span><br><span class="line">            s +=nums[i];</span><br><span class="line">            <span class="keyword">if</span> (i&lt;k-<span class="number">1</span>)&#123;</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            maxS = Math.max(maxS,s);</span><br><span class="line">            s -=nums[i-k+<span class="number">1</span>];</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> (<span class="type">double</span>) maxS/k;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¤´è¿›å°¾éƒ¨å‡ºï¼Œç„¶åè€ƒè™‘å˜åŒ–</p><h2 id="ä¸å®šé•¿"><a href="#ä¸å®šé•¿" class="headerlink" title="ä¸å®šé•¿"></a>ä¸å®šé•¿</h2><p>ä¸å®šé•¿çš„åŸºæœ¬å°±æ˜¯è€ƒè™‘çª—å£çš„ç¼©å°ã€‚</p><h3 id="æ±‚æœ€å€¼"><a href="#æ±‚æœ€å€¼" class="headerlink" title="æ±‚æœ€å€¼"></a>æ±‚æœ€å€¼</h3><p>æ¨¡æ¿ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution2958</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">maxSubarrayLength</span><span class="params">(<span class="type">int</span>[] nums, <span class="type">int</span> k)</span>&#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">ans</span> <span class="operator">=</span> <span class="number">0</span>, left= <span class="number">0</span>;</span><br><span class="line">        Map&lt;Integer,Integer&gt; cnt = <span class="keyword">new</span> <span class="title class_">HashMap</span>&lt;&gt;();</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">right</span> <span class="operator">=</span> <span class="number">0</span>;right&lt;nums.length;right++)&#123;</span><br><span class="line">            cnt.merge(nums[right],<span class="number">1</span>,Integer::sum);</span><br><span class="line">            <span class="keyword">while</span> (cnt.get(nums[right])&gt;k)&#123;</span><br><span class="line">                cnt.merge(nums[left++],-<span class="number">1</span>,Integer::sum);</span><br><span class="line">            &#125;</span><br><span class="line">            ans = Math.max(ans,right-left+<span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å°±æ˜¯å³è¾¹è¿›å…¥äº†ï¼Œç„¶åcheckä¸€ä¸‹ï¼Œç„¶åè¿›è¡ŒæŸäº›æ“ä½œï¼Œç„¶åå·¦è¾¹å‡ºå»</p><p>ä¸€èˆ¬åˆ°æœ€åéœ€è¦çš„éƒ½æ˜¯çª—å£çš„é•¿åº¦right-left+1</p><h3 id="æ±‚æ•°ç›®"><a href="#æ±‚æ•°ç›®" class="headerlink" title="æ±‚æ•°ç›®"></a>æ±‚æ•°ç›®</h3><p>åˆ†ä¸ºè¶Šé•¿è¶Šåˆæ³•ï¼Œè¶ŠçŸ­è¶Šåˆæ³•å’Œ<strong>æ°å¥½å½¢</strong></p><p><strong>è¶Šé•¿è¶Šåˆæ³•</strong>æ˜¯æŒ‡</p><p>[left,right] è¿™ä¸ªå­æ•°ç»„æ˜¯ä¸æ»¡è¶³é¢˜ç›®è¦æ±‚çš„ï¼Œä½†åœ¨é€€å‡ºå¾ªç¯ä¹‹å‰çš„æœ€åä¸€è½®å¾ªç¯ï¼Œ<strong>[leftâˆ’1,right]</strong> æ˜¯æ»¡è¶³é¢˜ç›®è¦æ±‚çš„ã€‚ç”±äºå­æ•°ç»„è¶Šé•¿ï¼Œè¶Šèƒ½æ»¡è¶³é¢˜ç›®è¦æ±‚ï¼Œæ‰€ä»¥é™¤äº† [leftâˆ’1,right]ï¼Œè¿˜æœ‰ [leftâˆ’2,right],[leftâˆ’3,right],â€¦,[0,right] éƒ½æ˜¯æ»¡è¶³è¦æ±‚çš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå½“å³ç«¯ç‚¹å›ºå®šåœ¨ right æ—¶ï¼Œå·¦ç«¯ç‚¹åœ¨ 0,1,2,â€¦,leftâˆ’1 çš„æ‰€æœ‰å­æ•°ç»„éƒ½æ˜¯æ»¡è¶³è¦æ±‚çš„ï¼Œè¿™ä¸€å…±æœ‰ <strong>left</strong> ä¸ªã€‚</p><p><strong>è¶ŠçŸ­è¶Šåˆæ³•</strong>æ˜¯æŒ‡ï¼š</p><p>[left,right] è¿™ä¸ªå­æ•°ç»„æ˜¯æ»¡è¶³é¢˜ç›®è¦æ±‚çš„ã€‚ç”±äºå­æ•°ç»„è¶ŠçŸ­ï¼Œè¶Šèƒ½æ»¡è¶³é¢˜ç›®è¦æ±‚ï¼Œæ‰€ä»¥é™¤äº† [left,right]ï¼Œè¿˜æœ‰ <strong>[left+1,right]</strong>,[left+2,right],â€¦,[right,right] éƒ½æ˜¯æ»¡è¶³è¦æ±‚çš„ã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œå½“å³ç«¯ç‚¹å›ºå®šåœ¨ right æ—¶ï¼Œå·¦ç«¯ç‚¹åœ¨ left,left+1,left+2,â€¦,right çš„æ‰€æœ‰å­æ•°ç»„éƒ½æ˜¯æ»¡è¶³è¦æ±‚çš„ï¼Œè¿™ä¸€å…±æœ‰ <strong>rightâˆ’left+1</strong> ä¸ªã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution713</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">numSubarrayProductLessThanK</span><span class="params">(<span class="type">int</span>[] nums, <span class="type">int</span> k)</span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (k&lt;=<span class="number">1</span>)&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="type">int</span> ans= <span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">x</span> <span class="operator">=</span> <span class="number">1</span>;</span><br><span class="line">        <span class="type">int</span> <span class="variable">left</span>  <span class="operator">=</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">right</span> <span class="operator">=</span> <span class="number">0</span>;right&lt;nums.length;right++)&#123;</span><br><span class="line">            x *=nums[right];</span><br><span class="line">            <span class="keyword">while</span> (x&gt;=k)&#123;</span><br><span class="line">                x /=nums[left++];</span><br><span class="line">            &#125;</span><br><span class="line">            ans +=right-left+<span class="number">1</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åŸºæœ¬å·®ä¸å¤šï¼Œéƒ½æ˜¯å³è¾¹è¿›å»äº†ï¼Œï¼Œç„¶åç»è¿‡checkï¼Œç„¶åå·¦è¾¹å‡ºå»ï¼Œçª—å£ç¼©å°ã€‚â€˜</p><p>åªä¸è¿‡è¿”å›çš„ä¸åŒç½¢äº†</p><p><strong>æ°å¥½</strong>å°±æ˜¯æ­£å¥½ä¸ºè¿™ä¸ªçš„æ•°ç›®</p><p>ä¾‹å¦‚ï¼Œè¦è®¡ç®—æœ‰å¤šå°‘ä¸ªå…ƒç´ å’Œæ°å¥½ç­‰äº k çš„å­æ•°ç»„ï¼Œå¯ä»¥æŠŠé—®é¢˜å˜æˆï¼š</p><p>è®¡ç®—æœ‰å¤šå°‘ä¸ªå…ƒç´ å’Œ â‰¥k çš„å­æ•°ç»„ã€‚<br>è®¡ç®—æœ‰å¤šå°‘ä¸ªå…ƒç´ å’Œ &gt;kï¼Œä¹Ÿå°±æ˜¯ â‰¥k+1 çš„å­æ•°ç»„ã€‚<br>ç­”æ¡ˆå°±æ˜¯å…ƒç´ å’Œ â‰¥k çš„å­æ•°ç»„ä¸ªæ•°ï¼Œå‡å»å…ƒç´ å’Œ â‰¥k+1 çš„å­æ•°ç»„ä¸ªæ•°ã€‚è¿™é‡ŒæŠŠ &gt; è½¬æ¢æˆ â‰¥ï¼Œä»è€Œå¯ä»¥æŠŠæ»‘çª—é€»è¾‘å°è£…æˆä¸€ä¸ªå‡½æ•° fï¼Œç„¶åç”¨ <strong>f(k) - f(k + 1)</strong> è®¡ç®—ï¼Œæ— éœ€ç¼–å†™ä¸¤ä»½æ»‘çª—ä»£ç ã€‚</p><p>æ€»ç»“ï¼š<strong>ã€Œæ°å¥½ã€å¯ä»¥æ‹†åˆ†æˆä¸¤ä¸ªã€Œè‡³å°‘ã€ï¼Œä¹Ÿå°±æ˜¯ä¸¤ä¸ªã€Œè¶Šé•¿è¶Šåˆæ³•ã€çš„æ»‘çª—é—®é¢˜ã€‚</strong></p><p>æ³¨ï¼šä¹Ÿå¯ä»¥æŠŠé—®é¢˜å˜æˆ <strong>â‰¤k å‡å» â‰¤kâˆ’1ï¼ˆä¸¤ä¸ªè‡³å¤šï¼‰ã€‚å¯æ ¹æ®é¢˜ç›®é€‰æ‹©åˆé€‚çš„å˜å½¢æ–¹å¼ã€‚</strong></p><p>ä¹Ÿå¯ä»¥æŠŠä¸¤ä¸ªæ»‘åŠ¨çª—å£åˆå¹¶èµ·æ¥ï¼Œç»´æŠ¤åŒä¸€ä¸ªå³ç«¯ç‚¹ <em>right</em> å’Œä¸¤ä¸ªå·¦ç«¯ç‚¹ <em>left</em>1 å’Œ <em>left</em>2ï¼Œæˆ‘æŠŠè¿™ç§å†™æ³•å«åš<strong>ä¸‰æŒ‡é’ˆæ»‘åŠ¨çª—å£</strong>ã€‚</p><p>ä¸€èˆ¬æ¥è¯´ä¸€ä¸ªå‡½æ•°å†™f(k) - f(k + 1)</p><p>å¦ä¸€ä¸ªå‡½æ•°å®ç°æ»‘åŠ¨çª—å£ï¼Œå°±è¶³å¤Ÿäº†ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution930</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">numSubarraysWithSumA</span><span class="params">(<span class="type">int</span>[] nums, <span class="type">int</span> goal)</span>&#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">ans1</span> <span class="operator">=</span> <span class="number">0</span>, left1=<span class="number">0</span>,left2=<span class="number">0</span>,ans2=<span class="number">0</span>;</span><br><span class="line">        <span class="type">int</span> sum1=<span class="number">0</span>,sum2=<span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">right</span> <span class="operator">=</span> <span class="number">0</span>;right&lt;nums.length;right++)&#123;</span><br><span class="line">            sum1 +=nums[right];</span><br><span class="line">            <span class="keyword">while</span> (sum1&gt;=goal&amp;&amp;left1&lt;=right)&#123;</span><br><span class="line">                sum1 -=nums[left1++];</span><br><span class="line">            &#125;</span><br><span class="line">            ans1 +=left1;</span><br><span class="line">            sum2 +=nums[right];</span><br><span class="line">            <span class="keyword">while</span> (sum2&gt;=goal+<span class="number">1</span>&amp;&amp;left2&lt;=right)&#123;</span><br><span class="line">                sum2 -=nums[left2++];</span><br><span class="line">            &#125;</span><br><span class="line">            ans2 +=left2;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ans1-ans2;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">numSubarraysWithSum</span><span class="params">(<span class="type">int</span>[] nums, <span class="type">int</span> goal)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> atMost(nums,goal)-atMost(nums,goal+<span class="number">1</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> <span class="title function_">atMost</span><span class="params">(<span class="type">int</span>[] nums, <span class="type">int</span> goal)</span>&#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">ans</span> <span class="operator">=</span> <span class="number">0</span>,left = <span class="number">0</span>,sum = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">int</span> <span class="variable">right</span> <span class="operator">=</span> <span class="number">0</span>;right&lt;nums.length;right++)&#123;</span><br><span class="line">            sum +=nums[right];</span><br><span class="line">            <span class="keyword">while</span> (sum&gt;=goal&amp;&amp;left&lt;=right)&#123;</span><br><span class="line">                sum -=nums[left++];</span><br><span class="line">            &#125;</span><br><span class="line">            ans +=left;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> ans;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h1 id="äºŒåˆ†æŸ¥æ‰¾"><a href="#äºŒåˆ†æŸ¥æ‰¾" class="headerlink" title="äºŒåˆ†æŸ¥æ‰¾"></a>äºŒåˆ†æŸ¥æ‰¾</h1><p>äºŒåˆ†æŸ¥æ‰¾çš„åŸç†å°±æ˜¯å–ä¸€ä¸ªä¸­é—´å€¼ï¼Œç„¶åé‚£ä¸­é—´å€¼å’Œç›®æ ‡å€¼è¿›è¡Œæ¯”è¾ƒã€‚</p><p>å¦‚æœæ¯”ç›®æ ‡å€¼å¤§çš„è¯ï¼Œè¯´æ˜ç›®æ ‡å€¼åœ¨å·¦è¾¹ï¼Œä¸­é—´å€¼midå°±å˜ä¸ºå³è¾¹right</p><p>ç›¸å¯¹åº”çš„ï¼Œå°äºç›®æ ‡å€¼çš„è¯ï¼Œè¯´æ˜ç›®æ ‡å€¼åœ¨å³è¾¹ï¼Œä¸­é—´å€¼midå°±å˜ä¸ºleft</p><p>äºŒåˆ†æŸ¥æ‰¾çš„æ€»ç»“ï¼š</p><p>å¿…é¡»æ•°ç»„/åºåˆ—æ˜¯<strong>æœ‰åºçš„</strong>ï¼ŒäºŒåˆ†å‰å¿…é¡»å…ˆè¿›è¡Œæ’åºã€‚</p><p>è¦ç¡®å®šæœç´¢åŒºé—´å¸¸è§å½¢å¼ï¼š<code>[lo, hi]</code>ã€<code>[lo, hi)</code>ã€<code>(lo, hi]</code>ã€<code>(lo, hi)</code></p><p>ç¡®å®šå¼€åŒºé—´é—­åŒºé—´</p><p>å¼€åŒºé—´ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="type">int</span> <span class="title function_">lowerBound</span><span class="params">(<span class="type">int</span>[] nums,<span class="type">int</span> right,<span class="type">int</span> target)</span>&#123;</span><br><span class="line">        <span class="type">int</span> left=-<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span> (left+<span class="number">1</span>&lt;right)&#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">mid</span> <span class="operator">=</span> (left+right)&gt;&gt;&gt;<span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span> (nums[mid]&gt;=target)&#123;</span><br><span class="line">                right=mid;</span><br><span class="line">            &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                left=mid;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> right;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>é—­åŒºé—´ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> <span class="title class_">Solution</span>&#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">searchInsert</span><span class="params">(<span class="type">int</span>[] nums,<span class="type">int</span> target)</span>&#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">left</span> <span class="operator">=</span> <span class="number">0</span>,right = nums.length-<span class="number">1</span>;</span><br><span class="line">        <span class="keyword">while</span> (left&lt;=right)&#123;</span><br><span class="line">            <span class="type">int</span> <span class="variable">mid</span> <span class="operator">=</span> (left+right)/<span class="number">2</span>;</span><br><span class="line">            <span class="keyword">if</span> (nums[mid] == target)&#123;</span><br><span class="line">                <span class="keyword">return</span> mid;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (nums[mid]&lt;target)&#123;</span><br><span class="line">                left =mid+<span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">else</span> &#123;</span><br><span class="line">                right = mid-<span class="number">1</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> left;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>midçš„å–å€¼ï¼šé€šå¸¸ç”¨ <code>mid = lo + (hi - lo) / 2</code>ï¼ˆæˆ–æ— ç¬¦å·å³ç§» <code>&gt;&gt;&gt; 1</code>ï¼‰è¿™æ ·æ¥é˜²æ­¢æº¢å‡º</p><p>è¿˜è¦è®¾è®¡checkæ¡ä»¶ï¼š</p><p>å°†é—®é¢˜è½¬åŒ–ä¸ºä¸€ä¸ªå¸ƒå°”å‡½æ•° <code>check(mid)</code>ï¼Œèƒ½å‡†ç¡®å‘Šè¯‰ä½ â€œmid æ˜¯å¦æ»¡è¶³æŸä¾§æ¡ä»¶â€ã€‚</p><p>æ ¹æ® <code>check(mid)</code> ç»“æœï¼ŒæŠŠ <code>lo</code> æˆ– <code>hi</code> ç¼©åˆ° <code>mid</code> åŠå…¶å·¦ï¼å³ä¸€ä¾§ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">int</span> <span class="variable">lo</span> <span class="operator">=</span> L, hi = R;</span><br><span class="line"><span class="keyword">while</span> (lo &lt; hi) &#123;</span><br><span class="line">    <span class="type">int</span> <span class="variable">mid</span> <span class="operator">=</span> lo + (hi - lo) / <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">if</span> (check(mid)) &#123;</span><br><span class="line">        hi = mid;      <span class="comment">// ä¿ç•™ mid</span></span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        lo = mid + <span class="number">1</span>;  <span class="comment">// ä¸¢å¼ƒ mid</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> lo;</span><br><span class="line"></span><br></pre></td></tr></table></figure><p><code>lowerBound</code>: æ‰¾åˆ°<strong>ç¬¬ä¸€ä¸ª â‰¥ target</strong> çš„ç´¢å¼•</p><p><code>upperBound</code>: æ‰¾åˆ°<strong>ç¬¬ä¸€ä¸ª &gt; target</strong> çš„ç´¢å¼•</p><div class="table-container"><table><thead><tr><th>åœºæ™¯</th><th>åŒºé—´å½¢å¼</th><th>å¤‡æ³¨</th></tr></thead><tbody><tr><td>æŸ¥æ‰¾æŸå€¼ / æ’å…¥ä½ç½®</td><td><code>[0, n-1]</code></td><td>ç»å…¸é—­åŒºé—´ï¼›æ‰¾ä¸åˆ°æ—¶è¿”å› <code>lo</code> ä½œä¸ºæ’å…¥ç‚¹</td></tr><tr><td>lowerBound / upperBound</td><td><code>(-1, n]</code></td><td>å¼€åŒºé—´ï¼›<code>left = -1, right = n</code></td></tr><tr><td>æœ€æ¥è¿‘å…ƒç´ ï¼ˆå·®å€¼æ¯”è¾ƒï¼‰</td><td><code>[0, n-k]</code></td><td>çª—å£é•¿åº¦ä¸º <code>k</code>ï¼Œæ¯”è¾ƒå·¦å³è¾¹ç•Œè·ç¦»å–å†³äºå·®å€¼å¤§å°</td></tr><tr><td>åŒæŒ‡é’ˆå¯¹æ’</td><td><code>lo &lt; hi</code></td><td>ä¾‹å¦‚æ‰¾æœ€å¤§æ»¡è¶³æ¡ä»¶çš„ä¸‹æ ‡</td></tr></tbody></table></div><p><strong>å¯ä»¥ä½¿ç”¨æŸ¥æ‰¾æŸäº›å€¼çš„é—®é¢˜ï¼Œçœå»äº†éå†</strong></p><h1 id="åŒæŒ‡é’ˆ"><a href="#åŒæŒ‡é’ˆ" class="headerlink" title="åŒæŒ‡é’ˆ"></a>åŒæŒ‡é’ˆ</h1><h2 id="å•åºåˆ—"><a href="#å•åºåˆ—" class="headerlink" title="å•åºåˆ—"></a>å•åºåˆ—</h2><p>ç›¸å‘åŒæŒ‡é’ˆï¼šä¸¤ä¸ªæŒ‡é’ˆ <em>left</em>=0, <em>right</em>=<em>n</em>âˆ’1ï¼Œä»æ•°ç»„çš„ä¸¤ç«¯å¼€å§‹ï¼Œå‘ä¸­é—´ç§»åŠ¨ï¼Œè¿™å«<strong>ç›¸å‘åŒæŒ‡é’ˆ</strong>ã€‚ä¸Šé¢çš„æ»‘åŠ¨çª—å£ç›¸å½“äº<strong>åŒå‘åŒæŒ‡é’ˆ</strong>ã€‚</p><p>ç„¶ååˆ°ä¸­é—´å»æ±‡èš</p><p>ä¸€èˆ¬æ¥è¯´æ¡ä»¶æ˜¯left&lt;right</p><p>ç„¶åè¿›è¡Œè¿è¡Œ</p><h3 id="åŒå‘åŒæŒ‡é’ˆ"><a href="#åŒå‘åŒæŒ‡é’ˆ" class="headerlink" title="åŒå‘åŒæŒ‡é’ˆ"></a><strong>åŒå‘åŒæŒ‡é’ˆ</strong></h3><p>ä¸¤ä¸ªæŒ‡é’ˆçš„ç§»åŠ¨æ–¹å‘ç›¸åŒï¼ˆéƒ½å‘å³ï¼Œæˆ–è€…éƒ½å‘å·¦ï¼‰ã€‚</p><p>ä»åŒä¸€ä¸ªæ–¹å‘å¼€å§‹</p><p>å¤–å±‚å¾ªç¯æ§åˆ¶å³æŒ‡é’ˆï¼Œå†…å±‚æ¡ä»¶æ»¡è¶³æ—¶ç§»åŠ¨å·¦æŒ‡é’ˆæ”¶ç¼©çª—å£</p><p>å°±æ˜¯æ»‘åŠ¨çª—å£å“ˆå“ˆ</p><h3 id="èƒŒå‘åŒæŒ‡é’ˆ"><a href="#èƒŒå‘åŒæŒ‡é’ˆ" class="headerlink" title="èƒŒå‘åŒæŒ‡é’ˆ"></a>èƒŒå‘åŒæŒ‡é’ˆ</h3><p>ä»ä¸­é—´å¼€å§‹å¾€ä¸¤è¾¹</p><h3 id="åŸåœ°ä¿®æ”¹ï¼š"><a href="#åŸåœ°ä¿®æ”¹ï¼š" class="headerlink" title="åŸåœ°ä¿®æ”¹ï¼š"></a><strong>åŸåœ°ä¿®æ”¹ï¼š</strong></h3><p>ä¸»è¦æ˜¯è¿ç”¨åˆ°äº†æ ˆçš„æ€æƒ³</p><p>å¸¸ç”¨äºæ•°ç»„åŸåœ°ä¿®æ”¹ï¼Œæ…¢æŒ‡é’ˆæ ‡è®°â€œç»“æœåŒºåŸŸâ€ï¼Œå¿«æŒ‡é’ˆç”¨äºæ‰«æ</p><p><strong>åŸåœ°ä¿®æ”¹+ä¸‹æ ‡</strong></p><p>å°±æ˜¯ä¸‹æ ‡çš„é—®é¢˜</p><p>å¦‚æœæ˜¯é¡ºåºæ’åºï¼Œä¸ç¼ºå°‘å…ƒç´ çš„è¯ï¼Œ</p><p>|nums[i]| = index+1 é˜²æ­¢è´Ÿæ•°å“ˆ</p><p>ç„¶åå¦‚æœæ˜¯ä¹±åºçš„è¯ï¼Œä¹Ÿæ˜¯å¯ä»¥å¯¹åº”èµ·æ¥çš„çš„ </p><p>å¦‚æœif (nums[index]&gt;0){<br>                nums[index] *=-1;<br>            }</p><p>çš„è¯ï¼Œç¼ºå°‘çš„é‚£ä¸ªæ­£å¥½æ˜¯æ­£æ•°</p><p>ç„¶åè¦è¿”å›é‚£ä¸ªæ•°çš„è¯ï¼Œi+1å³å¯</p><p>ä¸Šé¢é‚£ä¸ªé¢˜ï¼Œå‡ºç°ä¸¤æ¬¡è·Ÿè¿™ä¸ªç¼ºå°‘æ˜¯ä¸€æ ·çš„</p><p>ä¼šæŠŠindexå˜ä¸ºè´Ÿçš„</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">1. å€¼åŸŸæ˜¯ [1, n]ï¼Œè€ƒè™‘ nums[i] - 1 åšä¸‹æ ‡</span><br><span class="line">2. æ ‡è®°ï¼šå°† nums[nums[i] - 1] *= -1</span><br><span class="line">3. æŸ¥è¯¢ï¼š</span><br><span class="line">   - æ‰¾ç¼ºå¤± âœ å“ªäº› index ä¸Šè¿˜ä¸ºæ­£ï¼Œå¯¹åº”å€¼å°±æ˜¯ç¼ºå¤±çš„ i+1</span><br><span class="line">   - æ‰¾é‡å¤ âœ å“ªäº› index ç¬¬ä¸€æ¬¡è®¿é—®æ—¶å°±å·²ç»æ˜¯è´Ÿæ•°</span><br><span class="line"></span><br></pre></td></tr></table></figure><p>ğŸ‘†</p><h2 id="åŒåºåˆ—"><a href="#åŒåºåˆ—" class="headerlink" title="åŒåºåˆ—"></a>åŒåºåˆ—</h2><h3 id="å­åºåˆ—é—®é¢˜"><a href="#å­åºåˆ—é—®é¢˜" class="headerlink" title="å­åºåˆ—é—®é¢˜"></a>å­åºåˆ—é—®é¢˜</h3><p>è¿˜æ˜¯æ ‡å‡†çš„å­åºåˆ—é—®é¢˜ï¼Œä¸¤ä¸ªæŒ‡é’ˆç§»åŠ¨ï¼Œå½“æ»¡è¶³æ¡ä»¶çš„æ—¶å€™å­åºåˆ—çš„æŒ‡é’ˆç§»åŠ¨</p><p>ç„¶åå­—å…¸çš„ä¸€ç›´ç§»åŠ¨</p><p>çœ‹æœ€åå­åºåˆ—çš„æŒ‡é’ˆèƒ½ä¸èƒ½åˆ°æœ«å°¾ï¼Œåˆ°äº†å°±è¯´æ˜æ˜¯ï¼Œååˆ™ä¸æ˜¯</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="type">boolean</span> <span class="title function_">isSubseq</span><span class="params">(String s, String t)</span>&#123;</span><br><span class="line">        <span class="type">int</span> <span class="variable">i</span> <span class="operator">=</span><span class="number">0</span>;</span><br><span class="line">        <span class="keyword">for</span> (<span class="type">char</span> c:t.toCharArray())&#123;</span><br><span class="line">            <span class="keyword">if</span> (s.charAt(i)==c&amp;&amp;++i==s.length())&#123;</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>]]></content:encoded>
      
      
      <category domain="https://blog.tokenlen.top/categories/java/">java</category>
      
      
      <category domain="https://blog.tokenlen.top/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/">æ•°æ®ç»“æ„</category>
      
      <category domain="https://blog.tokenlen.top/tags/%E7%AE%97%E6%B3%95/">ç®—æ³•</category>
      
      <category domain="https://blog.tokenlen.top/tags/java/">java</category>
      
      <category domain="https://blog.tokenlen.top/tags/leetcode/">leetcode</category>
      
      
      <comments>https://blog.tokenlen.top/2025/05/09/leetcode/leetcodetotal/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>Springé¢è¯•é¢˜hot</title>
      <link>https://blog.tokenlen.top/2025/05/05/java-stack/spring2/</link>
      <guid>https://blog.tokenlen.top/2025/05/05/java-stack/spring2/</guid>
      <pubDate>Sun, 04 May 2025 16:00:00 GMT</pubDate>
      
        
        
          
          
      <description>&lt;h1 id=&quot;äº‹åŠ¡&quot;&gt;&lt;a href=&quot;#äº‹åŠ¡&quot; class=&quot;headerlink&quot; title=&quot;äº‹åŠ¡&quot;&gt;&lt;/a&gt;äº‹åŠ¡&lt;/h1&gt;&lt;h2 id=&quot;1-spring-äº‹åŠ¡å¤±æ•ˆçš„åœºæ™¯æœ‰å“ªäº›ï¼Ÿ&quot;&gt;&lt;a href=&quot;#1-spring-äº‹åŠ¡å¤±æ•ˆçš„åœºæ™¯æœ‰å“ªäº›ï¼Ÿ&quot;</description>
          
        
      
      
      
      <content:encoded><![CDATA[<h1 id="äº‹åŠ¡"><a href="#äº‹åŠ¡" class="headerlink" title="äº‹åŠ¡"></a>äº‹åŠ¡</h1><h2 id="1-spring-äº‹åŠ¡å¤±æ•ˆçš„åœºæ™¯æœ‰å“ªäº›ï¼Ÿ"><a href="#1-spring-äº‹åŠ¡å¤±æ•ˆçš„åœºæ™¯æœ‰å“ªäº›ï¼Ÿ" class="headerlink" title="1.spring äº‹åŠ¡å¤±æ•ˆçš„åœºæ™¯æœ‰å“ªäº›ï¼Ÿ"></a>1.spring äº‹åŠ¡å¤±æ•ˆçš„åœºæ™¯æœ‰å“ªäº›ï¼Ÿ</h2><p>Spring Booté€šè¿‡Springæ¡†æ¶çš„äº‹åŠ¡ç®¡ç†æ¨¡å—æ¥æ”¯æŒäº‹åŠ¡æ“ä½œã€‚äº‹åŠ¡ç®¡ç†åœ¨Spring Bootä¸­é€šå¸¸æ˜¯é€šè¿‡ <strong>@Transactional</strong> æ³¨è§£æ¥å®ç°çš„ã€‚äº‹åŠ¡å¯èƒ½ä¼šå¤±æ•ˆçš„ä¸€äº›å¸¸è§æƒ…å†µåŒ…æ‹¬:</p><p><strong>æœªæ•è·å¼‚å¸¸</strong>: å¦‚æœä¸€ä¸ªäº‹åŠ¡æ–¹æ³•ä¸­å‘ç”Ÿäº†æœªæ•è·çš„å¼‚å¸¸ï¼Œå¹¶ä¸”å¼‚å¸¸æœªè¢«å¤„ç†æˆ–ä¼ æ’­åˆ°äº‹åŠ¡è¾¹ç•Œä¹‹å¤–ï¼Œé‚£ä¹ˆäº‹åŠ¡ä¼šå¤±æ•ˆï¼Œæ‰€æœ‰çš„æ•°æ®åº“æ“ä½œä¼šå›æ»šã€‚</p><p><strong>éå—æ£€å¼‚å¸¸</strong>: é»˜è®¤æƒ…å†µä¸‹ï¼ŒSpringå¯¹<strong>éå—æ£€å¼‚å¸¸ï¼ˆRuntimeExceptionæˆ–å…¶å­ç±»ï¼‰è¿›è¡Œå›æ»šå¤„ç†</strong>ï¼Œè¿™æ„å‘³ç€å½“äº‹åŠ¡æ–¹æ³•ä¸­æŠ›å‡ºè¿™äº›å¼‚å¸¸æ—¶ï¼Œäº‹åŠ¡ä¼šå›æ»šã€‚</p><p><strong>äº‹åŠ¡ä¼ æ’­å±æ€§è®¾ç½®ä¸å½“</strong>: å¦‚æœåœ¨å¤šä¸ªäº‹åŠ¡ä¹‹é—´å­˜åœ¨äº‹åŠ¡åµŒå¥—ï¼Œä¸”äº‹åŠ¡ä¼ æ’­å±æ€§é…ç½®ä¸æ­£ç¡®ï¼Œå¯èƒ½å¯¼è‡´äº‹åŠ¡å¤±æ•ˆã€‚ç‰¹åˆ«æ˜¯åœ¨æ–¹æ³•å†…éƒ¨è°ƒç”¨æœ‰ @Transactional æ³¨è§£çš„æ–¹æ³•æ—¶è¦ç‰¹åˆ«æ³¨æ„ã€‚</p><p><strong>å¤šæ•°æ®æºçš„äº‹åŠ¡ç®¡ç†</strong>: å¦‚æœåœ¨ä½¿ç”¨å¤šæ•°æ®æºæ—¶ï¼Œäº‹åŠ¡ç®¡ç†æ²¡æœ‰æ­£ç¡®é…ç½®æˆ–è€…å­˜åœ¨å¤šä¸ª @Transactional æ³¨è§£æ—¶ï¼Œå¯èƒ½ä¼šå¯¼è‡´äº‹åŠ¡å¤±æ•ˆã€‚</p><p><strong>è·¨æ–¹æ³•è°ƒç”¨äº‹åŠ¡é—®é¢˜</strong>: å¦‚æœä¸€ä¸ªäº‹åŠ¡æ–¹æ³•å†…éƒ¨è°ƒç”¨å¦ä¸€ä¸ªæ–¹æ³•ï¼Œè€Œè¿™ä¸ªè¢«è°ƒç”¨çš„æ–¹æ³•æ²¡æœ‰ @Transactional æ³¨è§£ï¼Œè¿™ç§æƒ…å†µä¸‹å¤–å±‚äº‹åŠ¡å¯èƒ½ä¼šå¤±æ•ˆï¼Œè°ƒç”¨è‡ªèº«çš„æ–¹æ³•ä¹Ÿä¼šå¤±æ•ˆã€‚</p><p><strong>äº‹åŠ¡åœ¨éå…¬å¼€æ–¹æ³•ä¸­å¤±æ•ˆ</strong>: å¦‚æœ @Transactional æ³¨è§£æ ‡æ³¨åœ¨<strong>ç§æœ‰æ–¹æ³•ä¸Šæˆ–è€…é public</strong> æ–¹æ³•ä¸Šï¼Œäº‹åŠ¡ä¹Ÿä¼šå¤±æ•ˆã€‚</p><p>æ•°æ®åº“ä¸æ”¯æŒäº‹åŠ¡çš„æ—¶å€™ï¼Œspringäº‹åŠ¡ä¹Ÿä¼šå¤±æ•ˆ</p><p>å¤šçº¿ç¨‹æƒ…å†µä¸‹ã€‚äº‹åŠ¡ä¸Šä¸‹æ–‡ä¸èƒ½ä¼ æ’­åˆ°æ–°çº¿ç¨‹ï¼ˆå¦‚ <code>@Async</code> æ–¹æ³•ï¼‰ã€‚</p><h2 id="2-Springçš„äº‹åŠ¡ï¼Œä½¿ç”¨thisè°ƒç”¨æ˜¯å¦ç”Ÿæ•ˆï¼Ÿ"><a href="#2-Springçš„äº‹åŠ¡ï¼Œä½¿ç”¨thisè°ƒç”¨æ˜¯å¦ç”Ÿæ•ˆï¼Ÿ" class="headerlink" title="2.Springçš„äº‹åŠ¡ï¼Œä½¿ç”¨thisè°ƒç”¨æ˜¯å¦ç”Ÿæ•ˆï¼Ÿ"></a>2.Springçš„äº‹åŠ¡ï¼Œä½¿ç”¨thisè°ƒç”¨æ˜¯å¦ç”Ÿæ•ˆï¼Ÿ</h2><p>ä¸èƒ½ç”Ÿæ•ˆã€‚</p><p>å› ä¸ºSpringäº‹åŠ¡æ˜¯é€šè¿‡ä»£ç†å¯¹è±¡æ¥æ§åˆ¶çš„ï¼Œåªæœ‰é€šè¿‡ä»£ç†å¯¹è±¡çš„æ–¹æ³•è°ƒç”¨æ‰ä¼šåº”ç”¨äº‹åŠ¡ç®¡ç†çš„ç›¸å…³è§„åˆ™ã€‚å½“ä½¿ç”¨<code>this</code>ç›´æ¥è°ƒç”¨æ—¶ï¼Œæ˜¯ç»•è¿‡äº†Springçš„ä»£ç†æœºåˆ¶ï¼Œå› æ­¤ä¸ä¼šåº”ç”¨äº‹åŠ¡è®¾ç½®ã€‚</p><h2 id="3-è°ˆä¸€ä¸‹springäº‹åŠ¡"><a href="#3-è°ˆä¸€ä¸‹springäº‹åŠ¡" class="headerlink" title="3.è°ˆä¸€ä¸‹springäº‹åŠ¡"></a>3.è°ˆä¸€ä¸‹springäº‹åŠ¡</h2><p>Spring æä¾›äº† <strong>ç»Ÿä¸€çš„äº‹åŠ¡ç®¡ç†æŠ½è±¡</strong>ï¼Œæ—¢æ”¯æŒç¼–ç¨‹å¼äº‹åŠ¡ï¼Œä¹Ÿæ”¯æŒå£°æ˜å¼äº‹åŠ¡ï¼ˆAOPï¼‰ã€‚æ ¸å¿ƒç›®çš„æ˜¯æ§åˆ¶æ•°æ®çš„ä¸€è‡´æ€§ä¸å®Œæ•´æ€§ã€‚</p><p>å¤šä¸ªæ•°æ®åº“æ“ä½œè¦ä¹ˆéƒ½æˆåŠŸï¼Œè¦ä¹ˆéƒ½å¤±è´¥ï¼ˆå›æ»šï¼‰</p><p><strong>@Transactional</strong></p><p>æ”¾åœ¨ç±»ä¸Šï¼šè¡¨ç¤ºè¯¥ç±»çš„æ‰€æœ‰æ–¹æ³•é»˜è®¤ä½¿ç”¨äº‹åŠ¡ã€‚</p><p>æ”¾åœ¨æ–¹æ³•ä¸Šï¼šè¡¨ç¤ºè¯¥æ–¹æ³•å¯ç”¨äº‹åŠ¡ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Transactional(</span></span><br><span class="line"><span class="meta">    propagation = Propagation.REQUIRED,</span></span><br><span class="line"><span class="meta">    isolation = Isolation.READ_COMMITTED,</span></span><br><span class="line"><span class="meta">    rollbackFor = Exception.class</span></span><br><span class="line"><span class="meta">)</span></span><br><span class="line"></span><br></pre></td></tr></table></figure><p>å¸¸ç”¨å±æ€§ï¼Œç”¨æ¥æŒ‡æ˜ä¿¡æ¯ã€‚</p><p>ACIDå’Œäº‹åŠ¡çš„éš”ç¦»çº§åˆ«å’Œmysqlä¸€æ ·</p><div class="table-container"><table><thead><tr><th>ä¼ æ’­è¡Œä¸º</th><th>å«ä¹‰</th></tr></thead><tbody><tr><td>REQUIRED</td><td>é»˜è®¤å€¼ï¼Œ<strong>å½“å‰å­˜åœ¨äº‹åŠ¡å°±åŠ å…¥</strong>ï¼Œå¦åˆ™æ–°å»ºäº‹åŠ¡</td></tr><tr><td>REQUIRES_NEW</td><td>æ¯æ¬¡éƒ½æ–°å»ºäº‹åŠ¡ï¼ŒæŒ‚èµ·å½“å‰äº‹åŠ¡</td></tr><tr><td>NESTED</td><td>å¦‚æœå­˜åœ¨äº‹åŠ¡ï¼Œå°±åµŒå¥—æ‰§è¡Œä¸€ä¸ªå­äº‹åŠ¡ï¼ˆsavepointï¼‰</td></tr><tr><td>SUPPORTS</td><td>æœ‰äº‹åŠ¡å°±åŠ å…¥ï¼Œæ— äº‹åŠ¡å°±éäº‹åŠ¡æ‰§è¡Œ</td></tr><tr><td>NOT_SUPPORTED</td><td>å§‹ç»ˆéäº‹åŠ¡æ‰§è¡Œï¼ŒæŒ‚èµ·ç°æœ‰äº‹åŠ¡</td></tr><tr><td>NEVER</td><td>éäº‹åŠ¡æ‰§è¡Œï¼Œ<strong>å­˜åœ¨äº‹åŠ¡åˆ™æŠ›å¼‚å¸¸</strong></td></tr><tr><td>MANDATORY</td><td>å¿…é¡»åœ¨äº‹åŠ¡ä¸­è¿è¡Œï¼Œå¦åˆ™æŠ›å¼‚å¸¸</td></tr></tbody></table></div><h1 id="Spring"><a href="#Spring" class="headerlink" title="Spring"></a>Spring</h1><h2 id="1-è¯´ä¸€ä¸‹ä½ å¯¹-Spring-çš„ç†è§£"><a href="#1-è¯´ä¸€ä¸‹ä½ å¯¹-Spring-çš„ç†è§£" class="headerlink" title="1.è¯´ä¸€ä¸‹ä½ å¯¹ Spring çš„ç†è§£"></a>1.è¯´ä¸€ä¸‹ä½ å¯¹ Spring çš„ç†è§£</h2><p><img src="https://cdn.xiaolincoding.com//picgo/1712650311366-b499469c-5afd-4be9-bad3-d787de86bf98.png" alt=""></p><p>Springæ¡†æ¶æ ¸å¿ƒç‰¹æ€§åŒ…æ‹¬ï¼š</p><ul><li><strong>IoCå®¹å™¨</strong>ï¼šSpringé€šè¿‡<strong>æ§åˆ¶åè½¬</strong>å®ç°äº†<strong>å¯¹è±¡çš„åˆ›å»ºå’Œå¯¹è±¡é—´çš„ä¾èµ–å…³ç³»ç®¡ç†</strong>ã€‚å¼€å‘è€…åªéœ€è¦å®šä¹‰å¥½BeanåŠå…¶ä¾èµ–å…³ç³»ï¼ŒSpringå®¹å™¨è´Ÿè´£åˆ›å»ºå’Œç»„è£…è¿™äº›å¯¹è±¡ã€‚</li><li><strong>AOP</strong>ï¼šé¢å‘åˆ‡é¢ç¼–ç¨‹ï¼Œå…è®¸å¼€å‘è€…å®šä¹‰æ¨ªåˆ‡å…³æ³¨ç‚¹ï¼Œä¾‹å¦‚<strong>äº‹åŠ¡ç®¡ç†ã€å®‰å…¨æ§åˆ¶</strong>ç­‰ï¼Œç‹¬ç«‹äºä¸šåŠ¡é€»è¾‘çš„ä»£ç ã€‚é€šè¿‡AOPï¼Œå¯ä»¥å°†è¿™äº›å…³æ³¨ç‚¹æ¨¡å—åŒ–ï¼Œ<strong>æé«˜ä»£ç çš„å¯ç»´æŠ¤æ€§å’Œå¯é‡ç”¨æ€§ã€‚</strong></li><li><strong>äº‹åŠ¡ç®¡ç†</strong>ï¼šSpringæä¾›äº†ä¸€è‡´çš„äº‹åŠ¡ç®¡ç†æ¥å£ï¼Œ<strong>æ”¯æŒå£°æ˜å¼å’Œç¼–ç¨‹å¼äº‹åŠ¡</strong>ã€‚å¼€å‘è€…å¯ä»¥è½»æ¾åœ°è¿›è¡Œäº‹åŠ¡ç®¡ç†ï¼Œè€Œæ— éœ€å…³å¿ƒå…·ä½“çš„äº‹åŠ¡APIã€‚</li><li><strong>MVCæ¡†æ¶</strong>ï¼šSpring <strong>MVCæ˜¯ä¸€ä¸ªåŸºäºServlet APIæ„å»ºçš„Webæ¡†æ¶ï¼Œé‡‡ç”¨äº†æ¨¡å‹-è§†å›¾-æ§åˆ¶å™¨ï¼ˆMVCï¼‰æ¶æ„ã€‚</strong>å®ƒæ”¯æŒçµæ´»çš„URLåˆ°é¡µé¢æ§åˆ¶å™¨çš„æ˜ å°„ï¼Œä»¥åŠå¤šç§è§†å›¾æŠ€æœ¯ã€‚</li></ul><h2 id="2-springçš„æ ¸å¿ƒæ€æƒ³è¯´è¯´ä½ çš„ç†è§£ï¼Ÿ"><a href="#2-springçš„æ ¸å¿ƒæ€æƒ³è¯´è¯´ä½ çš„ç†è§£ï¼Ÿ" class="headerlink" title="2.springçš„æ ¸å¿ƒæ€æƒ³è¯´è¯´ä½ çš„ç†è§£ï¼Ÿ"></a>2.springçš„æ ¸å¿ƒæ€æƒ³è¯´è¯´ä½ çš„ç†è§£ï¼Ÿ</h2><div class="table-container"><table><thead><tr><th><strong>æ ¸å¿ƒæ€æƒ³</strong></th><th><strong>è§£å†³çš„é—®é¢˜</strong></th><th><strong>å®ç°æ‰‹æ®µ</strong></th><th><strong>å…¸å‹åº”ç”¨åœºæ™¯</strong></th></tr></thead><tbody><tr><td><strong>IOC</strong></td><td>å¯¹è±¡åˆ›å»ºä¸ä¾èµ–ç®¡ç†çš„é«˜è€¦åˆ</td><td>å®¹å™¨ç®¡ç†Beanç”Ÿå‘½å‘¨æœŸ</td><td>åŠ¨æ€æ›¿æ¢æ•°æ®åº“å®ç°ã€æœåŠ¡ç»„è£…</td></tr><tr><td><strong>DI</strong></td><td>ä¾èµ–å…³ç³»çš„ç¡¬ç¼–ç é—®é¢˜</td><td>Setter/æ„é€ å™¨/æ³¨è§£æ³¨å…¥</td><td>æ³¨å…¥æ•°æ®æºã€æœåŠ¡å±‚ä¾èµ–DAOå±‚</td></tr><tr><td><strong>AOP</strong></td><td>æ¨ªåˆ‡é€»è¾‘åˆ†æ•£åœ¨ä¸šåŠ¡ä»£ç ä¸­</td><td>åŠ¨æ€ä»£ç†ä¸åˆ‡é¢é…ç½®</td><td>æ—¥å¿—ã€äº‹åŠ¡ã€æƒé™æ ¡éªŒç»Ÿä¸€å¤„ç†</td></tr></tbody></table></div><p>Springé€šè¿‡è¿™IOCã€DIã€AOPä¸‰å¤§æ ¸å¿ƒæ€æƒ³ï¼Œå®ç°äº†è½»é‡çº§ã€é«˜å†…èšä½è€¦åˆçš„ä¼ä¸šçº§åº”ç”¨å¼€å‘æ¡†æ¶ï¼Œæˆä¸ºJavaç”Ÿæ€ä¸­ä¸å¯æˆ–ç¼ºçš„åŸºçŸ³ã€‚</p><h2 id="3-Spring-IoCå’ŒAOP-ä»‹ç»ä¸€ä¸‹"><a href="#3-Spring-IoCå’ŒAOP-ä»‹ç»ä¸€ä¸‹" class="headerlink" title="3.Spring IoCå’ŒAOP ä»‹ç»ä¸€ä¸‹"></a>3.Spring IoCå’ŒAOP ä»‹ç»ä¸€ä¸‹</h2><ul><li><strong>IoC</strong>ï¼šå³æ§åˆ¶åè½¬çš„æ„æ€ï¼Œå®ƒæ˜¯ä¸€ç§<strong>åˆ›å»ºå’Œè·å–å¯¹è±¡</strong>çš„æŠ€æœ¯æ€æƒ³ï¼Œ<strong>ä¾èµ–æ³¨å…¥(DI)æ˜¯å®ç°è¿™ç§æŠ€æœ¯çš„ä¸€ç§æ–¹å¼ã€‚</strong>ä¼ ç»Ÿå¼€å‘è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬éœ€è¦é€šè¿‡newå…³é”®å­—æ¥åˆ›å»ºå¯¹è±¡ã€‚ä½¿ç”¨IoCæ€æƒ³å¼€å‘æ–¹å¼çš„è¯ï¼Œæˆ‘ä»¬ä¸é€šè¿‡newå…³é”®å­—åˆ›å»ºå¯¹è±¡ï¼Œ<strong>è€Œæ˜¯é€šè¿‡IoCå®¹å™¨æ¥å¸®æˆ‘ä»¬å®ä¾‹åŒ–å¯¹è±¡ã€‚ é€šè¿‡IoCçš„æ–¹å¼ï¼Œå¯ä»¥å¤§å¤§é™ä½å¯¹è±¡ä¹‹é—´çš„è€¦åˆåº¦ã€‚</strong></li><li><strong>AOP</strong>ï¼šæ˜¯é¢å‘åˆ‡é¢ç¼–ç¨‹ï¼Œèƒ½å¤Ÿå°†é‚£äº›<strong>ä¸ä¸šåŠ¡æ— å…³ï¼Œå´ä¸ºä¸šåŠ¡æ¨¡å—æ‰€å…±åŒè°ƒç”¨çš„é€»è¾‘å°è£…èµ·æ¥ï¼Œä»¥å‡å°‘ç³»ç»Ÿçš„é‡å¤ä»£ç ï¼Œé™ä½æ¨¡å—é—´çš„è€¦åˆåº¦ã€‚</strong>Spring AOP å°±æ˜¯åŸºäºåŠ¨æ€ä»£ç†çš„ï¼Œå¦‚æœè¦ä»£ç†çš„å¯¹è±¡ï¼Œå®ç°äº†æŸä¸ªæ¥å£ï¼Œé‚£ä¹ˆ Spring AOP <strong>ä¼šä½¿ç”¨ JDK Proxy</strong>ï¼Œå»åˆ›å»ºä»£ç†å¯¹è±¡ï¼Œè€Œå¯¹äºæ²¡æœ‰<strong>å®ç°æ¥å£çš„å¯¹è±¡</strong>ï¼Œå°±æ— æ³•ä½¿ç”¨ JDK Proxy å»è¿›è¡Œä»£ç†äº†ï¼Œ<strong>è¿™æ—¶å€™ Spring AOP ä¼šä½¿ç”¨ Cglib ç”Ÿæˆä¸€ä¸ªè¢«ä»£ç†å¯¹è±¡çš„å­ç±»æ¥ä½œä¸ºä»£ç†ã€‚</strong></li></ul><p>åœ¨ Spring æ¡†æ¶ä¸­ï¼ŒIOC å’Œ AOP ç»“åˆä½¿ç”¨ï¼Œå¯ä»¥æ›´å¥½åœ°å®ç°ä»£ç çš„æ¨¡å—åŒ–å’Œåˆ†å±‚ç®¡ç†ã€‚ä¾‹å¦‚ï¼š</p><ul><li>é€šè¿‡ IOC å®¹å™¨ç®¡ç†å¯¹è±¡çš„ä¾èµ–å…³ç³»ï¼Œç„¶åé€šè¿‡ AOP å°†æ¨ªåˆ‡å…³æ³¨ç‚¹ç»Ÿä¸€åˆ‡å…¥åˆ°éœ€è¦çš„ä¸šåŠ¡é€»è¾‘ä¸­ã€‚</li><li>ä½¿ç”¨ IOC å®¹å™¨ç®¡ç† Service å±‚å’Œ DAO å±‚çš„ä¾èµ–å…³ç³»ï¼Œç„¶åé€šè¿‡ AOP åœ¨ Service å±‚å®ç°äº‹åŠ¡ç®¡ç†ã€æ—¥å¿—è®°å½•ç­‰æ¨ªåˆ‡åŠŸèƒ½ï¼Œä½¿å¾—ä¸šåŠ¡é€»è¾‘æ›´åŠ æ¸…æ™°å’Œå¯ç»´æŠ¤ã€‚</li></ul><h2 id="4-Springçš„aopä»‹ç»ä¸€ä¸‹"><a href="#4-Springçš„aopä»‹ç»ä¸€ä¸‹" class="headerlink" title="4.Springçš„aopä»‹ç»ä¸€ä¸‹"></a>4.Springçš„aopä»‹ç»ä¸€ä¸‹</h2><p>Spring AOPæ˜¯Springæ¡†æ¶ä¸­çš„ä¸€ä¸ªé‡è¦æ¨¡å—ï¼Œç”¨äºå®ç°é¢å‘åˆ‡é¢ç¼–ç¨‹ã€‚</p><p>æˆ‘ä»¬çŸ¥é“ï¼ŒJava å°±æ˜¯ä¸€é—¨é¢å‘å¯¹è±¡ç¼–ç¨‹çš„è¯­è¨€ï¼Œåœ¨ OOP ä¸­æœ€å°çš„å•å…ƒå°±æ˜¯â€œClass å¯¹è±¡â€ï¼Œä½†æ˜¯åœ¨ AOP ä¸­æœ€å°çš„å•å…ƒæ˜¯â€œåˆ‡é¢â€ã€‚ä¸€ä¸ªâ€œåˆ‡é¢â€å¯ä»¥åŒ…å«å¾ˆå¤šç§ç±»å‹å’Œå¯¹è±¡ï¼Œå¯¹å®ƒä»¬è¿›è¡Œæ¨¡å—åŒ–ç®¡ç†ï¼Œä¾‹å¦‚äº‹åŠ¡ç®¡ç†ã€‚</p><p>åœ¨é¢å‘åˆ‡é¢ç¼–ç¨‹çš„æ€æƒ³é‡Œé¢ï¼ŒæŠŠåŠŸèƒ½åˆ†ä¸ºä¸¤ç§</p><ul><li><strong>æ ¸å¿ƒä¸šåŠ¡</strong>ï¼šç™»é™†ã€æ³¨å†Œã€å¢ã€åˆ ã€æ”¹ã€æŸ¥ã€éƒ½å«æ ¸å¿ƒä¸šåŠ¡</li><li><strong>å‘¨è¾¹åŠŸèƒ½</strong>ï¼šæ—¥å¿—ã€äº‹åŠ¡ç®¡ç†è¿™äº›æ¬¡è¦çš„ä¸ºå‘¨è¾¹ä¸šåŠ¡</li></ul><p>åœ¨é¢å‘åˆ‡é¢ç¼–ç¨‹ä¸­ï¼Œæ ¸å¿ƒä¸šåŠ¡åŠŸèƒ½å’Œå‘¨è¾¹åŠŸèƒ½æ˜¯åˆ†åˆ«ç‹¬ç«‹è¿›è¡Œå¼€å‘ï¼Œä¸¤è€…ä¸æ˜¯è€¦åˆçš„ï¼Œç„¶åæŠŠåˆ‡é¢åŠŸèƒ½å’Œæ ¸å¿ƒä¸šåŠ¡åŠŸèƒ½ â€œç¼–ç»‡â€ åœ¨ä¸€èµ·ï¼Œè¿™å°±å«AOPã€‚</p><p>AOPèƒ½å¤Ÿå°†é‚£äº›ä¸ä¸šåŠ¡æ— å…³ï¼Œ<strong>å´ä¸ºä¸šåŠ¡æ¨¡å—æ‰€å…±åŒè°ƒç”¨çš„é€»è¾‘æˆ–è´£ä»»ï¼ˆä¾‹å¦‚äº‹åŠ¡å¤„ç†ã€æ—¥å¿—ç®¡ç†ã€æƒé™æ§åˆ¶ç­‰ï¼‰å°è£…èµ·æ¥</strong>ï¼Œä¾¿äº<strong>å‡å°‘ç³»ç»Ÿçš„é‡å¤ä»£ç </strong>ï¼Œ<strong>é™ä½æ¨¡å—é—´çš„è€¦åˆåº¦</strong>ï¼Œå¹¶<strong>æœ‰åˆ©äºæœªæ¥çš„å¯æ‹“å±•æ€§å’Œå¯ç»´æŠ¤æ€§</strong>ã€‚</p><p>åœ¨ AOP ä¸­æœ‰ä»¥ä¸‹å‡ ä¸ªæ¦‚å¿µï¼š</p><ul><li><strong>AspectJ</strong>ï¼šåˆ‡é¢ï¼Œåªæ˜¯ä¸€ä¸ªæ¦‚å¿µï¼Œæ²¡æœ‰å…·ä½“çš„æ¥å£æˆ–ç±»ä¸ä¹‹å¯¹åº”ï¼Œæ˜¯ Join pointï¼ŒAdvice å’Œ Pointcut çš„ä¸€ä¸ªç»Ÿç§°ã€‚</li><li><strong>Join point</strong>ï¼šè¿æ¥ç‚¹ï¼ŒæŒ‡ç¨‹åºæ‰§è¡Œè¿‡ç¨‹ä¸­çš„ä¸€ä¸ªç‚¹ï¼Œä¾‹å¦‚æ–¹æ³•è°ƒç”¨ã€å¼‚å¸¸å¤„ç†ç­‰ã€‚åœ¨ Spring AOP ä¸­ï¼Œä»…æ”¯æŒæ–¹æ³•çº§åˆ«çš„è¿æ¥ç‚¹ã€‚</li><li><strong>Advice</strong>ï¼šé€šçŸ¥ï¼Œå³æˆ‘ä»¬å®šä¹‰çš„ä¸€ä¸ªåˆ‡é¢ä¸­çš„æ¨ªåˆ‡é€»è¾‘ï¼Œæœ‰â€œaroundâ€ï¼Œâ€œbeforeâ€å’Œâ€œafterâ€ä¸‰ç§ç±»å‹ã€‚åœ¨å¾ˆå¤šçš„ AOP å®ç°æ¡†æ¶ä¸­ï¼ŒAdvice é€šå¸¸ä½œä¸ºä¸€ä¸ªæ‹¦æˆªå™¨ï¼Œä¹Ÿå¯ä»¥åŒ…å«è®¸å¤šä¸ªæ‹¦æˆªå™¨ä½œä¸ºä¸€æ¡é“¾è·¯å›´ç»•ç€ Join point è¿›è¡Œå¤„ç†ã€‚</li><li><strong>Pointcut</strong>ï¼šåˆ‡ç‚¹ï¼Œç”¨äºåŒ¹é…è¿æ¥ç‚¹ï¼Œä¸€ä¸ª AspectJ ä¸­åŒ…å«å“ªäº› Join point éœ€è¦ç”± Pointcut è¿›è¡Œç­›é€‰ã€‚</li><li><strong>Introduction</strong>ï¼šå¼•ä»‹ï¼Œè®©ä¸€ä¸ªåˆ‡é¢å¯ä»¥å£°æ˜è¢«é€šçŸ¥çš„å¯¹è±¡å®ç°ä»»ä½•ä»–ä»¬æ²¡æœ‰çœŸæ­£å®ç°çš„é¢å¤–çš„æ¥å£ã€‚ä¾‹å¦‚å¯ä»¥è®©ä¸€ä¸ªä»£ç†å¯¹è±¡ä»£ç†ä¸¤ä¸ªç›®æ ‡ç±»ã€‚</li><li><strong>Weaving</strong>ï¼šç»‡å…¥ï¼Œåœ¨æœ‰äº†è¿æ¥ç‚¹ã€åˆ‡ç‚¹ã€é€šçŸ¥ä»¥åŠåˆ‡é¢ï¼Œå¦‚ä½•å°†å®ƒä»¬åº”ç”¨åˆ°ç¨‹åºä¸­å‘¢ï¼Ÿæ²¡é”™ï¼Œå°±æ˜¯ç»‡å…¥ï¼Œåœ¨åˆ‡ç‚¹çš„å¼•å¯¼ä¸‹ï¼Œå°†é€šçŸ¥é€»è¾‘æ’å…¥åˆ°ç›®æ ‡æ–¹æ³•ä¸Šï¼Œä½¿å¾—æˆ‘ä»¬çš„é€šçŸ¥é€»è¾‘åœ¨æ–¹æ³•è°ƒç”¨æ—¶å¾—ä»¥æ‰§è¡Œã€‚</li><li><strong>AOP proxy</strong>ï¼šAOP ä»£ç†ï¼ŒæŒ‡åœ¨ AOP å®ç°æ¡†æ¶ä¸­å®ç°åˆ‡é¢åè®®çš„å¯¹è±¡ã€‚åœ¨ Spring AOP ä¸­æœ‰ä¸¤ç§ä»£ç†ï¼Œåˆ†åˆ«æ˜¯ JDK åŠ¨æ€ä»£ç†å’Œ CGLIB åŠ¨æ€ä»£ç†ã€‚</li><li><strong>Target object</strong>ï¼šç›®æ ‡å¯¹è±¡ï¼Œå°±æ˜¯è¢«ä»£ç†çš„å¯¹è±¡ã€‚</li></ul><p>Spring AOP æ˜¯åŸºäº <strong>JDK åŠ¨æ€ä»£ç†å’Œ Cglib æå‡</strong>å®ç°çš„ï¼Œä¸¤ç§ä»£ç†æ–¹å¼éƒ½å±äºè¿è¡Œæ—¶çš„ä¸€ä¸ªæ–¹å¼ï¼Œæ‰€ä»¥å®ƒæ²¡æœ‰ç¼–è¯‘æ—¶çš„ä¸€ä¸ªå¤„ç†ï¼Œé‚£ä¹ˆå› æ­¤ Spring æ˜¯é€šè¿‡ Java ä»£ç å®ç°çš„ã€‚</p><h2 id="5-IOCå’ŒAOPæ˜¯é€šè¿‡ä»€ä¹ˆæœºåˆ¶æ¥å®ç°çš„"><a href="#5-IOCå’ŒAOPæ˜¯é€šè¿‡ä»€ä¹ˆæœºåˆ¶æ¥å®ç°çš„" class="headerlink" title="5.IOCå’ŒAOPæ˜¯é€šè¿‡ä»€ä¹ˆæœºåˆ¶æ¥å®ç°çš„?"></a>5.IOCå’ŒAOPæ˜¯é€šè¿‡ä»€ä¹ˆæœºåˆ¶æ¥å®ç°çš„?</h2><blockquote><p>Spring IOC å®ç°æœºåˆ¶</p></blockquote><ul><li><strong>åå°„</strong>ï¼šSpring IOCå®¹å™¨åˆ©ç”¨Javaçš„åå°„æœºåˆ¶åŠ¨æ€åœ°åŠ è½½ç±»ã€åˆ›å»ºå¯¹è±¡å®ä¾‹åŠè°ƒç”¨å¯¹è±¡æ–¹æ³•ï¼Œåå°„å…è®¸åœ¨è¿è¡Œæ—¶æ£€æŸ¥ç±»ã€æ–¹æ³•ã€å±æ€§ç­‰ä¿¡æ¯ï¼Œä»è€Œå®ç°çµæ´»çš„å¯¹è±¡å®ä¾‹åŒ–å’Œç®¡ç†ã€‚</li><li><strong>ä¾èµ–æ³¨å…¥</strong>ï¼šIOCçš„æ ¸å¿ƒæ¦‚å¿µæ˜¯<strong>ä¾èµ–æ³¨å…¥</strong>ï¼Œå³å®¹å™¨è´Ÿè´£ç®¡ç†åº”ç”¨ç¨‹åºç»„ä»¶ä¹‹é—´çš„ä¾èµ–å…³ç³»ã€‚Springé€šè¿‡æ„é€ å‡½æ•°æ³¨å…¥ã€å±æ€§æ³¨å…¥æˆ–æ–¹æ³•æ³¨å…¥ï¼Œå°†ç»„ä»¶ä¹‹é—´çš„ä¾èµ–å…³ç³»æè¿°åœ¨é…ç½®æ–‡ä»¶ä¸­æˆ–ä½¿ç”¨æ³¨è§£ã€‚</li><li><strong>è®¾è®¡æ¨¡å¼ - å·¥å‚æ¨¡å¼</strong>ï¼šSpring IOCå®¹å™¨é€šå¸¸é‡‡ç”¨<strong>å·¥å‚æ¨¡å¼æ¥ç®¡ç†å¯¹è±¡çš„åˆ›å»ºå’Œç”Ÿå‘½å‘¨æœŸã€‚</strong>å®¹å™¨ä½œä¸ºå·¥å‚è´Ÿè´£å®ä¾‹åŒ–Beanå¹¶ç®¡ç†å®ƒä»¬çš„ç”Ÿå‘½å‘¨æœŸï¼Œå°†Beançš„å®ä¾‹åŒ–è¿‡ç¨‹äº¤ç»™å®¹å™¨æ¥ç®¡ç†ã€‚</li><li><strong>å®¹å™¨å®ç°</strong>ï¼šSpring IOCå®¹å™¨æ˜¯å®ç°IOCçš„æ ¸å¿ƒï¼Œé€šå¸¸ä½¿ç”¨BeanFactoryæˆ–ApplicationContextæ¥ç®¡ç†Beanã€‚<strong>BeanFactoryæ˜¯IOCå®¹å™¨çš„åŸºæœ¬å½¢å¼ï¼Œæä¾›åŸºæœ¬çš„IOCåŠŸèƒ½</strong>ï¼›ApplicationContextæ˜¯BeanFactoryçš„æ‰©å±•ï¼Œå¹¶æä¾›æ›´å¤šä¼ä¸šçº§åŠŸèƒ½ã€‚</li></ul><blockquote><p>Spring AOP å®ç°æœºåˆ¶</p></blockquote><p>Spring AOPçš„å®ç°ä¾èµ–äº<strong>åŠ¨æ€ä»£ç†æŠ€æœ¯</strong>ã€‚åŠ¨æ€ä»£ç†æ˜¯åœ¨è¿è¡Œæ—¶åŠ¨æ€ç”Ÿæˆä»£ç†å¯¹è±¡ï¼Œè€Œä¸æ˜¯åœ¨ç¼–è¯‘æ—¶ã€‚å®ƒå…è®¸å¼€å‘è€…åœ¨è¿è¡Œæ—¶æŒ‡å®šè¦ä»£ç†çš„æ¥å£å’Œè¡Œä¸ºï¼Œä»è€Œå®ç°åœ¨ä¸ä¿®æ”¹æºç çš„æƒ…å†µä¸‹å¢å¼ºæ–¹æ³•çš„åŠŸèƒ½ã€‚</p><p>Spring AOPæ”¯æŒä¸¤ç§åŠ¨æ€ä»£ç†ï¼š</p><ul><li><strong>åŸºäºJDKçš„åŠ¨æ€ä»£ç†</strong>ï¼šä½¿ç”¨<strong>java.lang.reflect.Proxy</strong>ç±»å’Œ<strong>java.lang.reflect.InvocationHandler</strong>æ¥å£å®ç°ã€‚è¿™ç§æ–¹å¼éœ€è¦ä»£ç†çš„ç±»å®ç°ä¸€ä¸ªæˆ–å¤šä¸ªæ¥å£ã€‚</li><li><strong>åŸºäºCGLIBçš„åŠ¨æ€ä»£ç†</strong>ï¼šå½“è¢«ä»£ç†çš„ç±»æ²¡æœ‰å®ç°æ¥å£æ—¶ï¼ŒSpringä¼š<strong>ä½¿ç”¨CGLIBåº“</strong>ç”Ÿæˆä¸€ä¸ªè¢«ä»£ç†ç±»çš„å­ç±»ä½œä¸ºä»£ç†ã€‚CGLIBï¼ˆCode Generation Libraryï¼‰æ˜¯ä¸€ä¸ªç¬¬ä¸‰æ–¹ä»£ç ç”Ÿæˆåº“ï¼Œé€šè¿‡ç»§æ‰¿æ–¹å¼å®ç°ä»£ç†ã€‚</li></ul><h2 id="6-æ€ä¹ˆç†è§£SpringIocï¼Ÿ"><a href="#6-æ€ä¹ˆç†è§£SpringIocï¼Ÿ" class="headerlink" title="6.æ€ä¹ˆç†è§£SpringIocï¼Ÿ"></a>6.æ€ä¹ˆç†è§£SpringIocï¼Ÿ</h2><p><strong>IOC</strong>ï¼šInversion Of Controlï¼Œå³æ§åˆ¶åè½¬ï¼Œæ˜¯ä¸€ç§è®¾è®¡æ€æƒ³ã€‚åœ¨ä¼ ç»Ÿçš„ Java SE ç¨‹åºè®¾è®¡ä¸­ï¼Œæˆ‘ä»¬ç›´æ¥åœ¨å¯¹è±¡å†…éƒ¨é€šè¿‡ new çš„æ–¹å¼æ¥åˆ›å»ºå¯¹è±¡ï¼Œæ˜¯ç¨‹åºä¸»åŠ¨åˆ›å»ºä¾èµ–å¯¹è±¡ï¼›</p><p><img src="https://cdn.xiaolincoding.com//picgo/1716790809843-e520e960-fb95-4511-aa30-73966361320a.webp" alt="img"></p><p>è€Œåœ¨Springç¨‹åºè®¾è®¡ä¸­ï¼ŒIOC æ˜¯æœ‰ä¸“é—¨çš„å®¹å™¨å»æ§åˆ¶å¯¹è±¡ã€‚</p><p><img src="https://cdn.xiaolincoding.com//picgo/1716790809860-74256f8b-3a96-485c-8aa1-11fa5dfb7640.webp" alt="img"></p><p><strong>æ‰€è°“æ§åˆ¶</strong>å°±æ˜¯å¯¹è±¡çš„åˆ›å»ºã€åˆå§‹åŒ–ã€é”€æ¯ã€‚</p><ul><li>åˆ›å»ºå¯¹è±¡ï¼šåŸæ¥æ˜¯ new ä¸€ä¸ªï¼Œç°åœ¨æ˜¯ç”± Spring å®¹å™¨åˆ›å»ºã€‚</li><li>åˆå§‹åŒ–å¯¹è±¡ï¼šåŸæ¥æ˜¯å¯¹è±¡è‡ªå·±é€šè¿‡æ„é€ å™¨æˆ–è€… setter æ–¹æ³•ç»™ä¾èµ–çš„å¯¹è±¡èµ‹å€¼ï¼Œç°åœ¨æ˜¯ç”± Spring å®¹å™¨è‡ªåŠ¨æ³¨å…¥ã€‚</li><li>é”€æ¯å¯¹è±¡ï¼šåŸæ¥æ˜¯ç›´æ¥ç»™å¯¹è±¡èµ‹å€¼ null æˆ–åšä¸€äº›é”€æ¯æ“ä½œï¼Œç°åœ¨æ˜¯ Spring å®¹å™¨ç®¡ç†ç”Ÿå‘½å‘¨æœŸè´Ÿè´£é”€æ¯å¯¹è±¡ã€‚</li></ul><p>æ€»ç»“ï¼šIOC è§£å†³äº†ç¹ççš„å¯¹è±¡ç”Ÿå‘½å‘¨æœŸçš„æ“ä½œï¼Œè§£è€¦äº†æˆ‘ä»¬çš„ä»£ç ã€‚<strong>æ‰€è°“åè½¬</strong>ï¼šå…¶å®æ˜¯åè½¬çš„æ§åˆ¶æƒï¼Œå‰é¢æåˆ°æ˜¯<strong>ç”± Spring æ¥æ§åˆ¶å¯¹è±¡çš„ç”Ÿå‘½å‘¨æœŸ</strong>ï¼Œé‚£ä¹ˆå¯¹è±¡çš„æ§åˆ¶å°±å®Œå…¨è„±ç¦»äº†æˆ‘ä»¬çš„æ§åˆ¶ï¼Œæ§åˆ¶æƒäº¤ç»™äº† Spring ã€‚è¿™ä¸ªåè½¬æ˜¯æŒ‡ï¼šæˆ‘ä»¬ç”±å¯¹è±¡çš„æ§åˆ¶è€…å˜æˆäº† IOC çš„è¢«åŠ¨æ§åˆ¶è€…ã€‚</p><h2 id="7-ä¾èµ–å€’ç½®ï¼Œä¾èµ–æ³¨å…¥ï¼Œæ§åˆ¶åè½¬åˆ†åˆ«æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#7-ä¾èµ–å€’ç½®ï¼Œä¾èµ–æ³¨å…¥ï¼Œæ§åˆ¶åè½¬åˆ†åˆ«æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="7.ä¾èµ–å€’ç½®ï¼Œä¾èµ–æ³¨å…¥ï¼Œæ§åˆ¶åè½¬åˆ†åˆ«æ˜¯ä»€ä¹ˆï¼Ÿ"></a>7.ä¾èµ–å€’ç½®ï¼Œä¾èµ–æ³¨å…¥ï¼Œæ§åˆ¶åè½¬åˆ†åˆ«æ˜¯ä»€ä¹ˆï¼Ÿ</h2><ul><li>æ§åˆ¶åè½¬ï¼šâ€œæ§åˆ¶â€æŒ‡çš„æ˜¯å¯¹ç¨‹åºæ‰§è¡Œæµç¨‹çš„æ§åˆ¶ï¼Œè€Œâ€œåè½¬â€æŒ‡çš„æ˜¯åœ¨æ²¡æœ‰ä½¿ç”¨æ¡†æ¶ä¹‹å‰ï¼Œç¨‹åºå‘˜è‡ªå·±æ§åˆ¶æ•´ä¸ªç¨‹åºçš„æ‰§è¡Œã€‚åœ¨ä½¿ç”¨æ¡†æ¶ä¹‹åï¼Œæ•´ä¸ªç¨‹åºçš„æ‰§è¡Œæµç¨‹é€šè¿‡æ¡†æ¶æ¥æ§åˆ¶ã€‚æµç¨‹çš„æ§åˆ¶æƒä»ç¨‹åºå‘˜â€œåè½¬â€ç»™äº†æ¡†æ¶ã€‚</li><li>ä¾èµ–æ³¨å…¥ï¼šä¾èµ–æ³¨å…¥å’Œæ§åˆ¶åè½¬æ°æ°ç›¸åï¼Œå®ƒæ˜¯ä¸€ç§å…·ä½“çš„ç¼–ç æŠ€å·§ã€‚æˆ‘ä»¬ä¸é€šè¿‡ new çš„æ–¹å¼åœ¨ç±»å†…éƒ¨åˆ›å»ºä¾èµ–ç±»çš„å¯¹è±¡ï¼Œè€Œæ˜¯å°†<strong>ä¾èµ–çš„ç±»å¯¹è±¡åœ¨å¤–éƒ¨åˆ›å»ºå¥½ä¹‹åï¼Œé€šè¿‡æ„é€ å‡½æ•°ã€å‡½æ•°å‚æ•°ç­‰æ–¹å¼ä¼ é€’ï¼ˆæˆ–æ³¨å…¥ï¼‰ç»™ç±»æ¥ä½¿ç”¨ã€‚</strong></li><li>ä¾èµ–å€’ç½®ï¼šè¿™æ¡åŸåˆ™è·Ÿæ§åˆ¶åè½¬æœ‰ç‚¹ç±»ä¼¼ï¼Œä¸»è¦ç”¨æ¥æŒ‡å¯¼æ¡†æ¶å±‚é¢çš„è®¾è®¡ã€‚<strong>é«˜å±‚æ¨¡å—ä¸ä¾èµ–ä½å±‚æ¨¡å—ï¼Œå®ƒä»¬å…±åŒä¾èµ–åŒä¸€ä¸ªæŠ½è±¡ã€‚æŠ½è±¡ä¸è¦ä¾èµ–å…·ä½“å®ç°ç»†èŠ‚ï¼Œå…·ä½“å®ç°ç»†èŠ‚ä¾èµ–æŠ½è±¡ã€‚</strong></li></ul><h2 id="8-ä¾èµ–æ³¨å…¥äº†è§£å—ï¼Ÿæ€ä¹ˆå®ç°ä¾èµ–æ³¨å…¥çš„ï¼Ÿ"><a href="#8-ä¾èµ–æ³¨å…¥äº†è§£å—ï¼Ÿæ€ä¹ˆå®ç°ä¾èµ–æ³¨å…¥çš„ï¼Ÿ" class="headerlink" title="8.ä¾èµ–æ³¨å…¥äº†è§£å—ï¼Ÿæ€ä¹ˆå®ç°ä¾èµ–æ³¨å…¥çš„ï¼Ÿ"></a>8.ä¾èµ–æ³¨å…¥äº†è§£å—ï¼Ÿæ€ä¹ˆå®ç°ä¾èµ–æ³¨å…¥çš„ï¼Ÿ</h2><p>åœ¨ä¼ ç»Ÿç¼–ç¨‹ä¸­ï¼Œå½“ä¸€ä¸ªç±»éœ€è¦ä½¿ç”¨å¦ä¸€ä¸ªç±»çš„å¯¹è±¡æ—¶ï¼Œé€šå¸¸ä¼šåœ¨è¯¥ç±»å†…éƒ¨é€šè¿‡<code>new</code>å…³é”®å­—æ¥åˆ›å»ºä¾èµ–å¯¹è±¡ï¼Œè¿™ä½¿å¾—ç±»ä¸ç±»ä¹‹é—´çš„è€¦åˆåº¦è¾ƒé«˜ã€‚</p><p>è€Œä¾èµ–æ³¨å…¥åˆ™æ˜¯å°†<strong>å¯¹è±¡çš„åˆ›å»ºå’Œä¾èµ–å…³ç³»çš„ç®¡ç†äº¤ç»™ Spring å®¹å™¨æ¥å®Œæˆ</strong>ï¼Œç±»åªéœ€è¦å£°æ˜è‡ªå·±æ‰€ä¾èµ–çš„å¯¹è±¡ï¼Œå®¹å™¨ä¼šåœ¨è¿è¡Œæ—¶å°†è¿™äº›ä¾èµ–å¯¹è±¡æ³¨å…¥åˆ°ç±»ä¸­ï¼Œä»è€Œé™ä½äº†ç±»ä¸ç±»ä¹‹é—´çš„è€¦åˆåº¦ï¼Œæé«˜äº†ä»£ç çš„å¯ç»´æŠ¤æ€§å’Œå¯æµ‹è¯•æ€§ã€‚</p><p>å…·ä½“åˆ°Springä¸­ï¼Œå¸¸è§çš„ä¾èµ–æ³¨å…¥çš„å®ç°æ–¹å¼ï¼Œæ¯”å¦‚<strong>æ„é€ å™¨æ³¨å…¥ã€Setteræ–¹æ³•æ³¨å…¥ï¼Œè¿˜æœ‰å­—æ®µæ³¨å…¥ã€‚</strong></p><ul><li><strong>æ„é€ å™¨æ³¨å…¥ï¼š</strong>é€šè¿‡æ„é€ å‡½æ•°ä¼ é€’ä¾èµ–å¯¹è±¡ï¼Œä¿è¯å¯¹è±¡åˆå§‹åŒ–æ—¶ä¾èµ–å·²å°±ç»ªã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> UserRepository userRepository;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ„é€ å™¨æ³¨å…¥ï¼ˆSpring 4.3+ è‡ªåŠ¨è¯†åˆ«å•æ„é€ å™¨ï¼Œæ— éœ€æ˜¾å¼@Autowiredï¼‰</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">UserService</span><span class="params">(UserRepository userRepository)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.userRepository = userRepository;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><strong>Setter æ–¹æ³•æ³¨å…¥ï¼š</strong>é€šè¿‡ Setter æ–¹æ³•è®¾ç½®ä¾èµ–ï¼Œçµæ´»æ€§é«˜ï¼Œä½†ä¾èµ–å¯èƒ½æœªå®Œå…¨åˆå§‹åŒ–ã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PaymentService</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> PaymentGateway gateway;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setGateway</span><span class="params">(PaymentGateway gateway)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.gateway = gateway;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><strong>å­—æ®µæ³¨å…¥ï¼š</strong>ç›´æ¥é€šè¿‡ <code>@Autowired</code> æ³¨è§£å­—æ®µï¼Œä»£ç ç®€æ´ä½†éšè—ä¾èµ–å…³ç³»ï¼Œä¸æ¨èç”Ÿäº§ä»£ç ã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OrderService</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> OrderRepository orderRepository;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="9-å¦‚æœè®©ä½ è®¾è®¡ä¸€ä¸ªSpringIocï¼Œä½ è§‰å¾—ä¼šä»å“ªäº›æ–¹é¢è€ƒè™‘è¿™ä¸ªè®¾è®¡ï¼Ÿ"><a href="#9-å¦‚æœè®©ä½ è®¾è®¡ä¸€ä¸ªSpringIocï¼Œä½ è§‰å¾—ä¼šä»å“ªäº›æ–¹é¢è€ƒè™‘è¿™ä¸ªè®¾è®¡ï¼Ÿ" class="headerlink" title="9.å¦‚æœè®©ä½ è®¾è®¡ä¸€ä¸ªSpringIocï¼Œä½ è§‰å¾—ä¼šä»å“ªäº›æ–¹é¢è€ƒè™‘è¿™ä¸ªè®¾è®¡ï¼Ÿ"></a>9.å¦‚æœè®©ä½ è®¾è®¡ä¸€ä¸ªSpringIocï¼Œä½ è§‰å¾—ä¼šä»å“ªäº›æ–¹é¢è€ƒè™‘è¿™ä¸ªè®¾è®¡ï¼Ÿ</h2><ul><li>Beançš„ç”Ÿå‘½å‘¨æœŸç®¡ç†ï¼šéœ€è¦<strong>è®¾è®¡Bean</strong>çš„åˆ›å»ºã€åˆå§‹åŒ–ã€é”€æ¯ç­‰ç”Ÿå‘½å‘¨æœŸç®¡ç†æœºåˆ¶ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨å·¥å‚æ¨¡å¼å’Œå•ä¾‹æ¨¡å¼æ¥å®ç°ã€‚</li><li>ä¾èµ–æ³¨å…¥ï¼šéœ€è¦å®ç°ä¾èµ–æ³¨å…¥çš„åŠŸèƒ½ï¼ŒåŒ…æ‹¬å±æ€§æ³¨å…¥ã€æ„é€ å‡½æ•°æ³¨å…¥ã€æ–¹æ³•æ³¨å…¥ç­‰ï¼Œ<strong>å¯ä»¥è€ƒè™‘ä½¿ç”¨åå°„æœºåˆ¶å’ŒXMLé…ç½®æ–‡ä»¶æ¥å®ç°ã€‚</strong></li><li>Beançš„ä½œç”¨åŸŸï¼šéœ€è¦<strong>æ”¯æŒå¤šç§Beanä½œç”¨åŸŸ</strong>ï¼Œæ¯”å¦‚å•ä¾‹ã€åŸå‹ã€ä¼šè¯ã€è¯·æ±‚ç­‰ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨Mapæ¥å­˜å‚¨ä¸åŒä½œç”¨åŸŸçš„Beanå®ä¾‹ã€‚</li><li>AOPåŠŸèƒ½çš„æ”¯æŒï¼šéœ€è¦æ”¯æŒAOPåŠŸèƒ½ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨<strong>åŠ¨æ€ä»£ç†æœºåˆ¶å’Œåˆ‡é¢ç¼–ç¨‹</strong>æ¥å®ç°ã€‚</li><li>å¼‚å¸¸å¤„ç†ï¼šéœ€è¦è€ƒè™‘å¼‚å¸¸å¤„ç†æœºåˆ¶ï¼ŒåŒ…æ‹¬Beanåˆ›å»ºå¼‚å¸¸ã€ä¾èµ–æ³¨å…¥å¼‚å¸¸ç­‰ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨try-catchæœºåˆ¶æ¥å¤„ç†å¼‚å¸¸ã€‚</li><li>é…ç½®æ–‡ä»¶åŠ è½½ï¼šéœ€è¦æ”¯æŒä»ä¸åŒçš„é…ç½®æ–‡ä»¶ä¸­åŠ è½½Beançš„ç›¸å…³ä¿¡æ¯ï¼Œå¯ä»¥è€ƒè™‘ä½¿ç”¨XMLã€æ³¨è§£æˆ–è€…Javaé…ç½®ç±»æ¥å®ç°ã€‚</li></ul><h2 id="10-SpringAOPä¸»è¦æƒ³è§£å†³ä»€ä¹ˆé—®é¢˜"><a href="#10-SpringAOPä¸»è¦æƒ³è§£å†³ä»€ä¹ˆé—®é¢˜" class="headerlink" title="10.SpringAOPä¸»è¦æƒ³è§£å†³ä»€ä¹ˆé—®é¢˜"></a>10.SpringAOPä¸»è¦æƒ³è§£å†³ä»€ä¹ˆé—®é¢˜</h2><p>å®ƒçš„ç›®çš„æ˜¯å¯¹äºé¢å‘å¯¹è±¡æ€ç»´çš„ä¸€ç§è¡¥å……ï¼Œè€Œä¸æ˜¯åƒå¼•å…¥å‘½ä»¤å¼ã€å‡½æ•°å¼ç¼–ç¨‹æ€ç»´è®©ä»–é¡ºåº”å¦ä¸€ç§å¼€å‘åœºæ™¯ã€‚åœ¨æˆ‘ä¸ªäººçš„ç†è§£ä¸‹AOPæ›´åƒæ˜¯ä¸€ç§å¯¹äºä¸æ”¯æŒå¤šç»§æ‰¿çš„å¼¥è¡¥ï¼Œé™¤å¼€å¯¹è±¡çš„ä¸»è¦ç‰¹å¾ï¼ˆæˆ‘æ›´å–œæ¬¢å«â€œå¼ºå…±æ€§â€ï¼‰è¢«æŠ½è±¡ä¸ºäº†ä¸€æ¡ç»§æ‰¿é“¾è·¯ï¼Œå¯¹äºä¸€äº›â€œå¼±å…±æ€§â€ï¼ŒAOPå¯ä»¥ç»Ÿä¸€å¯¹ä»–ä»¬è¿›è¡ŒæŠ½è±¡å’Œé›†ä¸­å¤„ç†ã€‚</p><p>ä¸¾ä¸€ä¸ªç®€å•çš„ä¾‹å­ï¼Œæ‰“å°æ—¥å¿—ã€‚éœ€è¦æ‰“å°æ—¥å¿—å¯èƒ½æ˜¯è®¸å¤šå¯¹è±¡çš„ä¸€ä¸ª<strong>å…±æ€§</strong>ï¼Œè¿™åœ¨ä¼ä¸šçº§å¼€å‘ä¸­ååˆ†å¸¸è§ï¼Œä½†æ˜¯æ—¥å¿—çš„æ‰“å°å¹¶ä¸ååº”è¿™ä¸ªå¯¹è±¡çš„ä¸»è¦å…±æ€§ã€‚è€Œæ—¥å¿—çš„æ‰“å°åˆæ˜¯ä¸€ä¸ªå…·ä½“çš„å†…å®¹ï¼Œå®ƒå¹¶ä¸æŠ½è±¡ï¼Œæ‰€ä»¥å®ƒçš„å·¥ä½œä¹Ÿä¸å¯ä»¥ç”¨æ¥å£æ¥å®Œæˆã€‚è€Œå¦‚æœåˆ©ç”¨ç»§æ‰¿ï¼Œæ‰“å°æ—¥å¿—çš„å·¥ä½œåˆæ¨ªè·¨ç»§æ‰¿æ ‘ä¸‹é¢çš„å¤šä¸ªåŒçº§å­èŠ‚ç‚¹ï¼Œå¼ºè¡Œä¾µå…¥åˆ°ç»§æ‰¿æ ‘å†…è¿›è¡Œå½’çº³ä¼šå¹²æ‰°è¿™äº›å¼ºå…±æ€§çš„åŒºåˆ†ã€‚</p><p>è¿™æ—¶å€™ï¼Œæˆ‘ä»¬å°±éœ€è¦AOPäº†ã€‚AOPé¦–å…ˆåœ¨<strong>ä¸€ä¸ªAspectï¼ˆåˆ‡é¢ï¼‰é‡Œå®šä¹‰äº†ä¸€äº›Adviceï¼ˆå¢å¼ºï¼‰ï¼Œå…¶ä¸­åŒ…å«å…·ä½“å®ç°çš„ä»£ç ï¼ŒåŒæ—¶æ•´ç†äº†åˆ‡å…¥ç‚¹ï¼Œåˆ‡å…¥ç‚¹çš„ç²’åº¦æ˜¯æ–¹æ³•ã€‚</strong>æœ€åï¼Œæˆ‘ä»¬å°†è¿™äº›Adviceç»‡å…¥åˆ°å¯¹è±¡çš„æ–¹æ³•ä¸Šï¼Œå½¢æˆäº†æœ€åæ‰§è¡Œæ–¹æ³•æ—¶é¢å¯¹çš„å®Œæ•´æ–¹æ³•ã€‚</p><p><img src="https://cdn.xiaolincoding.com//picgo/1716791217083-132fe2ba-706a-4d8d-aef3-1617a2046585.png" alt="img"></p><h2 id="11-SpringAOPçš„åŸç†äº†è§£å—"><a href="#11-SpringAOPçš„åŸç†äº†è§£å—" class="headerlink" title="11.SpringAOPçš„åŸç†äº†è§£å—"></a>11.SpringAOPçš„åŸç†äº†è§£å—</h2><p>Spring AOPçš„å®ç°ä¾èµ–äº<strong>åŠ¨æ€ä»£ç†æŠ€æœ¯</strong>ã€‚åŠ¨æ€ä»£ç†æ˜¯åœ¨è¿è¡Œæ—¶åŠ¨æ€ç”Ÿæˆä»£ç†å¯¹è±¡ï¼Œè€Œä¸æ˜¯åœ¨ç¼–è¯‘æ—¶ã€‚å®ƒå…è®¸å¼€å‘è€…åœ¨è¿è¡Œæ—¶æŒ‡å®šè¦ä»£ç†çš„æ¥å£å’Œè¡Œä¸ºï¼Œä»è€Œå®ç°åœ¨ä¸ä¿®æ”¹æºç çš„æƒ…å†µä¸‹å¢å¼ºæ–¹æ³•çš„åŠŸèƒ½ã€‚</p><p>Spring AOPæ”¯æŒä¸¤ç§åŠ¨æ€ä»£ç†ï¼š</p><ul><li><strong>åŸºäºJDKçš„åŠ¨æ€ä»£ç†</strong>ï¼šä½¿ç”¨java.lang.reflect.Proxyç±»å’Œjava.lang.reflect.InvocationHandleræ¥å£å®ç°ã€‚è¿™ç§æ–¹å¼éœ€è¦ä»£ç†çš„ç±»å®ç°ä¸€ä¸ªæˆ–å¤šä¸ªæ¥å£ã€‚</li><li><strong>åŸºäºCGLIBçš„åŠ¨æ€ä»£ç†</strong>ï¼šå½“è¢«ä»£ç†çš„ç±»æ²¡æœ‰å®ç°æ¥å£æ—¶ï¼ŒSpringä¼šä½¿ç”¨CGLIBåº“ç”Ÿæˆä¸€ä¸ªè¢«ä»£ç†ç±»çš„å­ç±»ä½œä¸ºä»£ç†ã€‚CGLIBï¼ˆCode Generation Libraryï¼‰æ˜¯ä¸€ä¸ªç¬¬ä¸‰æ–¹ä»£ç ç”Ÿæˆåº“ï¼Œé€šè¿‡ç»§æ‰¿æ–¹å¼å®ç°ä»£ç†ã€‚</li></ul><h2 id="12-åŠ¨æ€ä»£ç†æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#12-åŠ¨æ€ä»£ç†æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="12.åŠ¨æ€ä»£ç†æ˜¯ä»€ä¹ˆï¼Ÿ"></a>12.åŠ¨æ€ä»£ç†æ˜¯ä»€ä¹ˆï¼Ÿ</h2><p>avaçš„åŠ¨æ€ä»£ç†æ˜¯ä¸€ç§åœ¨è¿è¡Œæ—¶åŠ¨æ€åˆ›å»ºä»£ç†å¯¹è±¡çš„æœºåˆ¶ï¼Œä¸»è¦ç”¨äºåœ¨ä¸ä¿®æ”¹åŸå§‹ç±»çš„æƒ…å†µä¸‹å¯¹æ–¹æ³•è°ƒç”¨è¿›è¡Œæ‹¦æˆªå’Œå¢å¼ºã€‚</p><p>JavaåŠ¨æ€ä»£ç†ä¸»è¦åˆ†ä¸ºä¸¤ç§ç±»å‹ï¼š</p><ul><li><strong>åŸºäºæ¥å£çš„ä»£ç†</strong>ï¼ˆJDKåŠ¨æ€ä»£ç†ï¼‰ï¼š è¿™ç§ç±»å‹çš„ä»£ç†è¦æ±‚ç›®æ ‡å¯¹è±¡å¿…é¡»å®ç°è‡³å°‘ä¸€ä¸ªæ¥å£ã€‚JavaåŠ¨æ€ä»£ç†ä¼šåˆ›å»ºä¸€ä¸ªå®ç°äº†ç›¸åŒæ¥å£çš„ä»£ç†ç±»ï¼Œç„¶ååœ¨è¿è¡Œæ—¶åŠ¨æ€ç”Ÿæˆè¯¥ç±»çš„å®ä¾‹ã€‚è¿™ç§ä»£ç†çš„å®ç°æ ¸å¿ƒæ˜¯<code>java.lang.reflect.Proxy</code>ç±»å’Œ<code>java.lang.reflect.InvocationHandler</code>æ¥å£ã€‚æ¯ä¸€ä¸ª<strong>åŠ¨æ€ä»£ç†ç±»éƒ½å¿…é¡»å®ç°<code>InvocationHandler</code>æ¥å£ï¼Œå¹¶ä¸”æ¯ä¸ªä»£ç†ç±»çš„å®ä¾‹éƒ½å…³è”åˆ°ä¸€ä¸ª<code>handler</code>ã€‚</strong>å½“é€šè¿‡ä»£ç†å¯¹è±¡è°ƒç”¨ä¸€ä¸ªæ–¹æ³•æ—¶ï¼Œè¿™ä¸ªæ–¹æ³•çš„è°ƒç”¨ä¼šè¢«è½¬å‘ä¸ºç”±<code>InvocationHandler</code><strong>æ¥å£çš„<code>invoke()</code>æ–¹æ³•æ¥è¿›è¡Œè°ƒç”¨ã€‚</strong></li><li><strong>åŸºäºç±»çš„ä»£ç†</strong>ï¼ˆCGLIBåŠ¨æ€ä»£ç†ï¼‰ï¼š CGLIBï¼ˆCode Generation Libraryï¼‰æ˜¯ä¸€ä¸ªå¼ºå¤§çš„é«˜æ€§èƒ½çš„ä»£ç ç”Ÿæˆåº“ï¼Œå®ƒå¯ä»¥åœ¨è¿è¡Œæ—¶åŠ¨æ€ç”Ÿæˆä¸€ä¸ªç›®æ ‡ç±»çš„å­ç±»ã€‚CGLIBä»£ç†ä¸éœ€è¦ç›®æ ‡ç±»å®ç°æ¥å£ï¼Œè€Œæ˜¯é€šè¿‡ç»§æ‰¿çš„æ–¹å¼åˆ›å»ºä»£ç†ç±»ã€‚å› æ­¤ï¼Œå¦‚æœç›®æ ‡å¯¹è±¡æ²¡æœ‰å®ç°ä»»ä½•æ¥å£ï¼Œå¯ä»¥ä½¿ç”¨CGLIBæ¥åˆ›å»ºåŠ¨æ€ä»£ç†ã€‚</li></ul><h2 id="13-åŠ¨æ€ä»£ç†å’Œé™æ€ä»£ç†çš„åŒºåˆ«"><a href="#13-åŠ¨æ€ä»£ç†å’Œé™æ€ä»£ç†çš„åŒºåˆ«" class="headerlink" title="13.åŠ¨æ€ä»£ç†å’Œé™æ€ä»£ç†çš„åŒºåˆ«"></a>13.åŠ¨æ€ä»£ç†å’Œé™æ€ä»£ç†çš„åŒºåˆ«</h2><p>ä»£ç†æ˜¯ä¸€ç§å¸¸ç”¨çš„è®¾è®¡æ¨¡å¼ï¼Œç›®çš„æ˜¯ï¼š<strong>ä¸ºå…¶ä»–å¯¹è±¡æä¾›ä¸€ä¸ªä»£ç†ä»¥æ§åˆ¶å¯¹æŸä¸ªå¯¹è±¡çš„è®¿é—®ï¼Œå°†ä¸¤ä¸ªç±»çš„å…³ç³»è§£è€¦ã€‚</strong>ä»£ç†ç±»å’Œå§”æ‰˜ç±»éƒ½è¦å®ç°ç›¸åŒçš„æ¥å£ï¼Œå› ä¸ºä»£ç†çœŸæ­£è°ƒç”¨çš„æ˜¯å§”æ‰˜ç±»çš„æ–¹æ³•ã€‚</p><p>åŒºåˆ«ï¼š</p><ul><li>é™æ€ä»£ç†ï¼šç”±ç¨‹åºå‘˜åˆ›å»ºæˆ–è€…æ˜¯ç”±ç‰¹å®šå·¥å…·åˆ›å»ºï¼Œåœ¨ä»£ç ç¼–è¯‘æ—¶å°±ç¡®å®šäº†è¢«ä»£ç†çš„ç±»æ˜¯ä¸€ä¸ªé™æ€ä»£ç†ã€‚é™æ€ä»£ç†é€šå¸¸åªä»£ç†ä¸€ä¸ªç±»ï¼›</li><li>åŠ¨æ€ä»£ç†ï¼šåœ¨ä»£ç è¿è¡ŒæœŸé—´ï¼Œè¿ç”¨<strong>åå°„æœºåˆ¶</strong>åŠ¨æ€åˆ›å»ºç”Ÿæˆã€‚åŠ¨æ€ä»£ç†ä»£ç†çš„æ˜¯<strong>ä¸€ä¸ªæ¥å£ä¸‹çš„å¤šä¸ªå®ç°ç±»ã€‚</strong></li></ul><h2 id="14-AOPå®ç°æœ‰å“ªäº›æ³¨è§£ï¼Ÿ"><a href="#14-AOPå®ç°æœ‰å“ªäº›æ³¨è§£ï¼Ÿ" class="headerlink" title="14.AOPå®ç°æœ‰å“ªäº›æ³¨è§£ï¼Ÿ"></a>14.AOPå®ç°æœ‰å“ªäº›æ³¨è§£ï¼Ÿ</h2><p>å¸¸ç”¨çš„æ³¨è§£åŒ…æ‹¬ï¼š</p><ul><li>@Aspectï¼šç”¨äºå®šä¹‰åˆ‡é¢ï¼Œæ ‡æ³¨åœ¨åˆ‡é¢ç±»ä¸Šã€‚</li><li>@Pointcutï¼šå®šä¹‰åˆ‡ç‚¹ï¼Œæ ‡æ³¨åœ¨æ–¹æ³•ä¸Šï¼Œç”¨äºæŒ‡å®šè¿æ¥ç‚¹ã€‚</li><li>@Beforeï¼šåœ¨æ–¹æ³•æ‰§è¡Œä¹‹å‰æ‰§è¡Œé€šçŸ¥ã€‚</li><li>@Afterï¼šåœ¨æ–¹æ³•æ‰§è¡Œä¹‹åæ‰§è¡Œé€šçŸ¥ã€‚</li><li>@Aroundï¼šåœ¨æ–¹æ³•æ‰§è¡Œå‰åéƒ½æ‰§è¡Œé€šçŸ¥ã€‚</li><li>@AfterReturningï¼šåœ¨æ–¹æ³•æ‰§è¡Œåè¿”å›ç»“æœåæ‰§è¡Œé€šçŸ¥ã€‚</li><li>@AfterThrowingï¼šåœ¨æ–¹æ³•æŠ›å‡ºå¼‚å¸¸åæ‰§è¡Œé€šçŸ¥ã€‚</li><li>@Adviceï¼šé€šç”¨çš„é€šçŸ¥ç±»å‹ï¼Œå¯ä»¥æ›¿ä»£@Beforeã€@Afterç­‰ã€‚</li></ul><h2 id="15-ä»€ä¹ˆæ˜¯åå°„ï¼Ÿæœ‰å“ªäº›ä½¿ç”¨åœºæ™¯ï¼Ÿ"><a href="#15-ä»€ä¹ˆæ˜¯åå°„ï¼Ÿæœ‰å“ªäº›ä½¿ç”¨åœºæ™¯ï¼Ÿ" class="headerlink" title="15.ä»€ä¹ˆæ˜¯åå°„ï¼Ÿæœ‰å“ªäº›ä½¿ç”¨åœºæ™¯ï¼Ÿ"></a>15.ä»€ä¹ˆæ˜¯åå°„ï¼Ÿæœ‰å“ªäº›ä½¿ç”¨åœºæ™¯ï¼Ÿ</h2><p>å°„æœºåˆ¶æ˜¯æŒ‡ç¨‹åºåœ¨è¿è¡ŒçŠ¶æ€ä¸‹ï¼Œ<strong>å¯¹äºä»»æ„ä¸€ä¸ªç±»ï¼Œéƒ½èƒ½å¤Ÿè·å–è¿™ä¸ªç±»çš„æ‰€æœ‰å±æ€§å’Œæ–¹æ³•ï¼›å¯¹äºä»»æ„ä¸€ä¸ªå¯¹è±¡ï¼Œéƒ½èƒ½å¤Ÿè°ƒç”¨å®ƒçš„ä»»æ„å±æ€§å’Œæ–¹æ³•ã€‚</strong>ä¹Ÿå°±æ˜¯è¯´ï¼ŒJava åå°„å…è®¸åœ¨è¿è¡Œæ—¶è·å–ç±»çš„ä¿¡æ¯å¹¶åŠ¨æ€æ“ä½œå¯¹è±¡ï¼Œå³ä½¿åœ¨ç¼–è¯‘æ—¶ä¸çŸ¥é“å…·ä½“çš„ç±»ä¹Ÿèƒ½å®ç°ã€‚</p><p>åå°„å…·æœ‰ä»¥ä¸‹ç‰¹æ€§ï¼š</p><ol><li><strong>è¿è¡Œæ—¶ç±»ä¿¡æ¯è®¿é—®</strong>ï¼šåå°„æœºåˆ¶å…è®¸ç¨‹åºåœ¨è¿è¡Œæ—¶è·å–ç±»çš„å®Œæ•´ç»“æ„ä¿¡æ¯ï¼ŒåŒ…æ‹¬ç±»åã€åŒ…åã€çˆ¶ç±»ã€å®ç°çš„æ¥å£ã€æ„é€ å‡½æ•°ã€æ–¹æ³•å’Œå­—æ®µç­‰ã€‚</li><li><strong>åŠ¨æ€å¯¹è±¡åˆ›å»º</strong>ï¼šå¯ä»¥ä½¿ç”¨åå°„APIåŠ¨æ€åœ°åˆ›å»ºå¯¹è±¡å®ä¾‹ï¼Œå³ä½¿åœ¨ç¼–è¯‘æ—¶ä¸çŸ¥é“å…·ä½“çš„ç±»åã€‚è¿™æ˜¯é€šè¿‡Classç±»çš„newInstance()æ–¹æ³•æˆ–Constructorå¯¹è±¡çš„newInstance()æ–¹æ³•å®ç°çš„ã€‚</li><li><strong>åŠ¨æ€æ–¹æ³•è°ƒç”¨</strong>ï¼šå¯ä»¥åœ¨è¿è¡Œæ—¶åŠ¨æ€åœ°è°ƒç”¨å¯¹è±¡çš„æ–¹æ³•ï¼ŒåŒ…æ‹¬ç§æœ‰æ–¹æ³•ã€‚è¿™é€šè¿‡Methodç±»çš„invoke()æ–¹æ³•å®ç°ï¼Œå…è®¸ä½ ä¼ å…¥å¯¹è±¡å®ä¾‹å’Œå‚æ•°å€¼æ¥æ‰§è¡Œæ–¹æ³•ã€‚</li><li><strong>è®¿é—®å’Œä¿®æ”¹å­—æ®µå€¼</strong>ï¼šåå°„è¿˜å…è®¸ç¨‹åºåœ¨è¿è¡Œæ—¶è®¿é—®å’Œä¿®æ”¹å¯¹è±¡çš„å­—æ®µå€¼ï¼Œå³ä½¿æ˜¯ç§æœ‰çš„ã€‚è¿™æ˜¯é€šè¿‡Fieldç±»çš„get()å’Œset()æ–¹æ³•å®Œæˆçš„ã€‚</li></ol><p><img src="https://cdn.xiaolincoding.com//picgo/1718957173277-863d2ec6-a754-423b-9066-9f28610d1a31-20240725232406027.png" alt="img"></p><p>Javaåå°„æœºåˆ¶åœ¨springæ¡†æ¶ä¸­ï¼Œå¾ˆå¤šåœ°æ–¹éƒ½ç”¨åˆ°äº†åå°„ï¼Œè®©æˆ‘ä»¬æ¥çœ‹çœ‹Springçš„IoCå’ŒAOPæ˜¯å¦‚ä½•ä½¿ç”¨åå°„æŠ€æœ¯çš„ã€‚</p><blockquote><p>1ã€Springæ¡†æ¶çš„ä¾èµ–æ³¨å…¥ï¼ˆDIï¼‰å’Œæ§åˆ¶åè½¬ï¼ˆIoCï¼‰</p></blockquote><p>Spring <strong>ä½¿ç”¨åå°„æ¥å®ç°å…¶æ ¸å¿ƒç‰¹æ€§</strong>ï¼šä¾èµ–æ³¨å…¥ã€‚</p><p>åœ¨Springä¸­ï¼Œå¼€å‘è€…å¯ä»¥é€šè¿‡XMLé…ç½®æ–‡ä»¶æˆ–è€…åŸºäºæ³¨è§£çš„æ–¹å¼å£°æ˜ç»„ä»¶ä¹‹é—´çš„ä¾èµ–å…³ç³»ã€‚å½“åº”ç”¨ç¨‹åºå¯åŠ¨æ—¶ï¼ŒSpringå®¹å™¨ä¼šæ‰«æè¿™äº›é…ç½®æˆ–æ³¨è§£ï¼Œç„¶ååˆ©ç”¨<strong>åå°„æ¥å®ä¾‹åŒ–Bean</strong>ï¼ˆå³Javaå¯¹è±¡ï¼‰ï¼Œå¹¶æ ¹æ®é…ç½®è‡ªåŠ¨è£…é…å®ƒä»¬çš„ä¾èµ–ã€‚</p><p>ä¾‹å¦‚<strong>ï¼Œå½“ä¸€ä¸ªServiceç±»éœ€è¦ä¾èµ–å¦ä¸€ä¸ªDAOç±»æ—¶ï¼Œå¼€å‘è€…å¯ä»¥åœ¨Serviceç±»ä¸­ä½¿ç”¨@Autowiredæ³¨è§£ï¼Œè€Œæ— éœ€è‡ªå·±ç¼–å†™åˆ›å»ºDAOå®ä¾‹çš„ä»£ç ã€‚</strong>Springå®¹å™¨ä¼šåœ¨è¿è¡Œæ—¶è§£æè¿™ä¸ªæ³¨è§£ï¼Œ<strong>é€šè¿‡åå°„æ‰¾åˆ°å¯¹åº”çš„DAOç±»ï¼Œå®ä¾‹åŒ–å®ƒï¼Œå¹¶å°†å…¶æ³¨å…¥åˆ°Serviceç±»ä¸­ã€‚</strong>è¿™æ ·ä¸ä»…é™ä½äº†ç»„ä»¶ä¹‹é—´çš„è€¦åˆåº¦ï¼Œä¹Ÿæå¤§åœ°å¢å¼ºäº†ä»£ç çš„å¯ç»´æŠ¤æ€§å’Œå¯æµ‹è¯•æ€§ã€‚</p><blockquote><p>2ã€åŠ¨æ€ä»£ç†çš„å®ç°</p></blockquote><p>åœ¨éœ€è¦å¯¹ç°æœ‰ç±»çš„æ–¹æ³•è°ƒç”¨<strong>è¿›è¡Œæ‹¦æˆªã€è®°å½•æ—¥å¿—ã€æƒé™æ§åˆ¶æˆ–æ˜¯äº‹åŠ¡ç®¡ç†</strong>ç­‰åœºæ™¯ä¸­ï¼Œåå°„ç»“åˆåŠ¨æ€ä»£ç†æŠ€æœ¯è¢«å¹¿æ³›åº”ç”¨ã€‚</p><p>ä¸€ä¸ªå…¸å‹çš„ä¾‹å­æ˜¯Spring AOPï¼ˆé¢å‘åˆ‡é¢ç¼–ç¨‹ï¼‰çš„å®ç°ã€‚Spring AOPå…è®¸å¼€å‘è€…å®šä¹‰åˆ‡é¢ï¼ˆAspectï¼‰ï¼Œè¿™äº›åˆ‡é¢å¯ä»¥æ¨ªåˆ‡å…³æ³¨ç‚¹ï¼ˆå¦‚æ—¥å¿—è®°å½•ã€äº‹åŠ¡ç®¡ç†ï¼‰ï¼Œå¹¶å°†å…¶æ’å…¥åˆ°ä¸šåŠ¡é€»è¾‘ä¸­ï¼Œè€Œä¸éœ€è¦ä¿®æ”¹ä¸šåŠ¡é€»è¾‘ä»£ç ã€‚</p><p>ä¾‹å¦‚ï¼Œä¸ºäº†ç»™æ‰€æœ‰çš„æœåŠ¡å±‚æ–¹æ³•æ·»åŠ æ—¥å¿—è®°å½•åŠŸèƒ½ï¼Œå¯ä»¥å®šä¹‰ä¸€ä¸ªåˆ‡é¢ï¼Œåœ¨è¿™ä¸ªåˆ‡é¢ä¸­ï¼Œ<strong>Springä¼šä½¿ç”¨JDKåŠ¨æ€ä»£ç†æˆ–CGLIBï¼ˆå¦‚æœç›®æ ‡ç±»æ²¡æœ‰å®ç°æ¥å£ï¼‰æ¥åˆ›å»ºç›®æ ‡ç±»çš„ä»£ç†å¯¹è±¡ã€‚</strong>è¿™ä¸ªä»£ç†å¯¹è±¡åœ¨è°ƒç”¨<strong>ä»»ä½•æ–¹æ³•å‰æˆ–å</strong>ï¼Œéƒ½ä¼šæ‰§è¡Œåˆ‡é¢ä¸­å®šä¹‰çš„ä»£ç é€»è¾‘ï¼ˆå¦‚è®°å½•æ—¥å¿—ï¼‰ï¼Œè€Œè¿™ä¸€åˆ‡éƒ½æ˜¯åœ¨è¿è¡Œæ—¶é€šè¿‡åå°„æ¥åŠ¨æ€æ„å»ºå’Œæ‰§è¡Œçš„ï¼Œæ— éœ€ç¡¬ç¼–ç åˆ°æ¯ä¸ªæ–¹æ³•è°ƒç”¨ä¸­ã€‚</p><p>è¿™ä¸¤ä¸ªä¾‹å­å±•ç¤ºäº†åå°„æœºåˆ¶å¦‚ä½•åœ¨å®é™…å·¥ç¨‹ä¸­ä¿ƒè¿›<strong>æ¾è€¦åˆã€é«˜å†…èš</strong>çš„è®¾è®¡ï¼Œä»¥åŠå¦‚ä½•æä¾›åŠ¨æ€ã€çµæ´»çš„ç¼–ç¨‹èƒ½åŠ›ï¼Œç‰¹åˆ«æ˜¯åœ¨æ¡†æ¶å±‚é¢å’Œè§£å†³è·¨åˆ‡é¢é—®é¢˜æ—¶ã€‚</p><h2 id="16-springæ˜¯å¦‚ä½•è§£å†³å¾ªç¯ä¾èµ–çš„ï¼Ÿ"><a href="#16-springæ˜¯å¦‚ä½•è§£å†³å¾ªç¯ä¾èµ–çš„ï¼Ÿ" class="headerlink" title="16.springæ˜¯å¦‚ä½•è§£å†³å¾ªç¯ä¾èµ–çš„ï¼Ÿ"></a>16.springæ˜¯å¦‚ä½•è§£å†³å¾ªç¯ä¾èµ–çš„ï¼Ÿ</h2><p>å¾ªç¯ä¾èµ–æŒ‡çš„æ˜¯ä¸¤ä¸ªç±»ä¸­çš„å±æ€§ç›¸äº’ä¾èµ–å¯¹æ–¹ï¼šä¾‹å¦‚ A ç±»ä¸­æœ‰ B å±æ€§ï¼ŒB ç±»ä¸­æœ‰ Aå±æ€§ï¼Œä»è€Œå½¢æˆäº†ä¸€ä¸ªä¾èµ–é—­ç¯ï¼Œå¦‚ä¸‹å›¾ã€‚</p><p><img src="https://cdn.xiaolincoding.com//picgo/1720684589425-d06727ba-bf03-484a-b656-c225554b5b49.png" alt="img"></p><p>å¾ªç¯ä¾èµ–é—®é¢˜åœ¨Springä¸­ä¸»è¦æœ‰ä¸‰ç§æƒ…å†µï¼š</p><ul><li>ç¬¬ä¸€ç§ï¼šé€šè¿‡æ„é€ æ–¹æ³•è¿›è¡Œä¾èµ–æ³¨å…¥æ—¶äº§ç”Ÿçš„å¾ªç¯ä¾èµ–é—®é¢˜ã€‚</li><li>ç¬¬äºŒç§ï¼šé€šè¿‡setteræ–¹æ³•è¿›è¡Œä¾èµ–æ³¨å…¥ä¸”æ˜¯åœ¨å¤šä¾‹ï¼ˆåŸå‹ï¼‰æ¨¡å¼ä¸‹äº§ç”Ÿçš„å¾ªç¯ä¾èµ–é—®é¢˜ã€‚</li><li>ç¬¬ä¸‰ç§ï¼š<strong>é€šè¿‡setteræ–¹æ³•è¿›è¡Œä¾èµ–æ³¨å…¥ä¸”æ˜¯åœ¨å•ä¾‹æ¨¡å¼ä¸‹äº§ç”Ÿçš„å¾ªç¯ä¾èµ–é—®é¢˜ã€‚</strong></li></ul><p>åªæœ‰ã€ç¬¬ä¸‰ç§æ–¹å¼ã€‘çš„å¾ªç¯ä¾èµ–é—®é¢˜è¢« Spring è§£å†³äº†ï¼Œå…¶ä»–ä¸¤ç§æ–¹å¼åœ¨é‡åˆ°å¾ªç¯ä¾èµ–é—®é¢˜æ—¶ï¼ŒSpringéƒ½ä¼šäº§ç”Ÿå¼‚å¸¸ã€‚</p><p>Spring è§£å†³å•ä¾‹æ¨¡å¼ä¸‹çš„setterå¾ªç¯ä¾èµ–é—®é¢˜çš„ä¸»è¦æ–¹å¼æ˜¯é€šè¿‡<strong>ä¸‰çº§ç¼“å­˜</strong>è§£å†³å¾ªç¯ä¾èµ–ã€‚ä¸‰çº§ç¼“å­˜æŒ‡çš„æ˜¯ Spring åœ¨åˆ›å»º Bean çš„è¿‡ç¨‹ä¸­ï¼Œé€šè¿‡ä¸‰çº§ç¼“å­˜æ¥ç¼“å­˜æ­£åœ¨åˆ›å»ºçš„ Beanï¼Œä»¥åŠå·²ç»åˆ›å»ºå®Œæˆçš„ Bean å®ä¾‹ã€‚å…·ä½“æ­¥éª¤å¦‚ä¸‹ï¼š</p><ul><li><strong>å®ä¾‹åŒ– Bean</strong>ï¼šSpring åœ¨å®ä¾‹åŒ– Bean æ—¶ï¼Œ<strong>ä¼šå…ˆåˆ›å»ºä¸€ä¸ªç©ºçš„ Bean å¯¹è±¡ï¼Œå¹¶å°†å…¶æ”¾å…¥ä¸€çº§ç¼“å­˜ä¸­ã€‚</strong></li><li><strong>å±æ€§èµ‹å€¼</strong>ï¼šSpring å¼€å§‹å¯¹ Bean è¿›è¡Œå±æ€§èµ‹å€¼ï¼Œå¦‚æœå‘ç°å¾ªç¯ä¾èµ–ï¼Œä¼šå°†å½“å‰ Bean å¯¹è±¡æå‰æš´éœ²ç»™åç»­éœ€è¦ä¾èµ–çš„ Beanï¼ˆ<strong>é€šè¿‡æå‰æš´éœ²çš„æ–¹å¼è§£å†³å¾ªç¯ä¾èµ–</strong>ï¼‰ã€‚</li><li><strong>åˆå§‹åŒ– Bean</strong>ï¼šå®Œæˆå±æ€§èµ‹å€¼åï¼ŒSpring å°† Bean è¿›è¡Œåˆå§‹åŒ–ï¼Œå¹¶å°†å…¶æ”¾<strong>å…¥äºŒçº§ç¼“å­˜</strong>ä¸­ã€‚</li><li><strong>æ³¨å…¥ä¾èµ–</strong>ï¼šSpring ç»§ç»­å¯¹ Bean è¿›è¡Œä¾èµ–æ³¨å…¥ï¼Œ<strong>å¦‚æœå‘ç°å¾ªç¯ä¾èµ–ï¼Œä¼šä»äºŒçº§ç¼“å­˜ä¸­è·å–å·²ç»å®Œæˆåˆå§‹åŒ–çš„ Bean å®ä¾‹ã€‚</strong></li></ul><p>é€šè¿‡ä¸‰çº§ç¼“å­˜çš„æœºåˆ¶ï¼ŒSpring èƒ½å¤Ÿåœ¨å¤„ç†å¾ªç¯ä¾èµ–æ—¶ï¼Œ<strong>ç¡®ä¿åŠæ—¶æš´éœ²æ­£åœ¨åˆ›å»ºçš„ Bean å¯¹è±¡ï¼Œå¹¶èƒ½å¤Ÿæ­£ç¡®åœ°æ³¨å…¥å·²ç»åˆå§‹åŒ–çš„ Bean å®ä¾‹ï¼Œä»è€Œè§£å†³å¾ªç¯ä¾èµ–é—®é¢˜ï¼Œä¿è¯åº”ç”¨ç¨‹åºçš„æ­£å¸¸è¿è¡Œã€‚</strong></p><h2 id="17-springä¸‰çº§ç¼“å­˜çš„æ•°æ®ç»“æ„æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#17-springä¸‰çº§ç¼“å­˜çš„æ•°æ®ç»“æ„æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="17.springä¸‰çº§ç¼“å­˜çš„æ•°æ®ç»“æ„æ˜¯ä»€ä¹ˆï¼Ÿ"></a>17.springä¸‰çº§ç¼“å­˜çš„æ•°æ®ç»“æ„æ˜¯ä»€ä¹ˆï¼Ÿ</h2><p>éƒ½æ˜¯ Mapç±»å‹çš„ç¼“å­˜ï¼Œæ¯”å¦‚Map {k:name; v:bean}ã€‚</p><ol><li><strong>ä¸€çº§ç¼“å­˜ï¼ˆSingleton Objectsï¼‰</strong>ï¼šè¿™æ˜¯ä¸€ä¸ª<strong>Mapç±»å‹</strong>çš„ç¼“å­˜ï¼Œå­˜å‚¨çš„æ˜¯å·²ç»å®Œå…¨åˆå§‹åŒ–å¥½çš„beanï¼Œå³å®Œå…¨å‡†å¤‡å¥½å¯ä»¥ä½¿ç”¨çš„beanå®ä¾‹ã€‚<strong>é”®æ˜¯beançš„åç§°ï¼Œå€¼æ˜¯beançš„å®ä¾‹ã€‚</strong>è¿™ä¸ªç¼“å­˜åœ¨<code>DefaultSingletonBeanRegistry</code>ç±»ä¸­çš„<code>singletonObjects</code>å±æ€§ä¸­ã€‚</li><li><strong>äºŒçº§ç¼“å­˜ï¼ˆEarly Singleton Objectsï¼‰</strong>ï¼šè¿™åŒæ ·æ˜¯ä¸€ä¸ªMapç±»å‹çš„ç¼“å­˜ï¼Œ<strong>å­˜å‚¨çš„æ˜¯æ—©æœŸçš„beanå¼•ç”¨ï¼Œå³å·²ç»å®ä¾‹åŒ–ä½†è¿˜æœªå®Œå…¨åˆå§‹åŒ–çš„beanã€‚</strong>è¿™äº›beanå·²ç»è¢«å®ä¾‹åŒ–ï¼Œ<strong>ä½†æ˜¯å¯èƒ½è¿˜æ²¡æœ‰è¿›è¡Œå±æ€§æ³¨å…¥ç­‰æ“ä½œã€‚</strong>è¿™ä¸ªç¼“å­˜åœ¨<code>DefaultSingletonBeanRegistry</code>ç±»ä¸­çš„<code>earlySingletonObjects</code>å±æ€§ä¸­ã€‚</li><li><strong>ä¸‰çº§ç¼“å­˜ï¼ˆSingleton Factoriesï¼‰</strong>ï¼šè¿™ä¹Ÿæ˜¯ä¸€ä¸ªMapç±»å‹çš„ç¼“å­˜ï¼Œå­˜å‚¨çš„æ˜¯<strong>ObjectFactoryå¯¹è±¡</strong>ï¼Œè¿™äº›å¯¹è±¡å¯ä»¥ç”Ÿæˆæ—©æœŸçš„beanå¼•ç”¨ã€‚<strong>å½“ä¸€ä¸ªbeanæ­£åœ¨åˆ›å»ºè¿‡ç¨‹ä¸­ï¼Œå¦‚æœå®ƒè¢«å…¶ä»–beanä¾èµ–ï¼Œé‚£ä¹ˆè¿™ä¸ªæ­£åœ¨åˆ›å»ºçš„beanå°±ä¼šé€šè¿‡è¿™ä¸ªObjectFactoryæ¥åˆ›å»ºä¸€ä¸ªæ—©æœŸå¼•ç”¨ï¼Œä»è€Œè§£å†³å¾ªç¯ä¾èµ–çš„é—®é¢˜ã€‚</strong>è¿™ä¸ªç¼“å­˜åœ¨<code>DefaultSingletonBeanRegistry</code>ç±»ä¸­çš„<code>singletonFactories</code>å±æ€§ä¸­ã€‚</li></ol><p>æ ¸å¿ƒæœºåˆ¶æ˜¯æå‰æš´éœ²Beançš„æ—©æœŸå¼•ç”¨ï¼Œå…è®¸åœ¨ä¾èµ–æ³¨å…¥é˜¶æ®µä½¿ç”¨æœªå®Œå…¨åˆå§‹åŒ–çš„Beanã€‚</p><p>ä»…æ”¯æŒå•ä¾‹ä½œç”¨åŸŸå’Œsetter/å­—æ®µæ³¨å…¥çš„å¾ªç¯ä¾èµ–ï¼Œæ„é€ å‡½æ•°æ³¨å…¥å’ŒåŸå‹ä½œç”¨åŸŸæ— æ³•è‡ªåŠ¨è§£å†³ã€‚</p><p><strong>ä¼˜å…ˆé€‰æ‹©</strong>ï¼š<strong>ä½¿ç”¨setteræ³¨å…¥æˆ–@Lazyæ³¨è§£è§£å†³å¾ªç¯ä¾èµ–ã€‚</strong></p><p><strong>æœ€ä½³å®è·µ</strong>ï¼šé€šè¿‡é‡æ„ä»£ç ï¼ˆå¦‚æå–å…¬å…±Beanã€ä½¿ç”¨äº‹ä»¶æœºåˆ¶ï¼‰ä»æ ¹æœ¬ä¸Šæ¶ˆé™¤å¾ªç¯ä¾èµ–ã€‚</p><p><strong>ç¦ç”¨å¾ªç¯ä¾èµ–</strong>ï¼šåœ¨æ˜ç¡®ä¸éœ€è¦å¾ªç¯ä¾èµ–æ—¶ï¼Œç¦ç”¨Springçš„å¾ªç¯ä¾èµ–æ”¯æŒä»¥æé«˜ä»£ç å¥å£®æ€§ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BeanA</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> BeanB beanB;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">BeanA</span><span class="params">(<span class="meta">@Lazy</span> BeanB beanB)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.beanB = beanB;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="18-springæ¡†æ¶ä¸­éƒ½ç”¨åˆ°äº†å“ªäº›è®¾è®¡æ¨¡å¼"><a href="#18-springæ¡†æ¶ä¸­éƒ½ç”¨åˆ°äº†å“ªäº›è®¾è®¡æ¨¡å¼" class="headerlink" title="18.springæ¡†æ¶ä¸­éƒ½ç”¨åˆ°äº†å“ªäº›è®¾è®¡æ¨¡å¼"></a>18.springæ¡†æ¶ä¸­éƒ½ç”¨åˆ°äº†å“ªäº›è®¾è®¡æ¨¡å¼</h2><ul><li><strong>å·¥å‚è®¾è®¡æ¨¡å¼</strong> : Springä½¿ç”¨å·¥å‚æ¨¡å¼é€šè¿‡ BeanFactoryã€ApplicationContext åˆ›å»º bean å¯¹è±¡ã€‚</li><li><strong>ä»£ç†è®¾è®¡æ¨¡å¼</strong> : Spring AOP åŠŸèƒ½çš„å®ç°ã€‚</li><li><strong>å•ä¾‹è®¾è®¡æ¨¡å¼</strong> : Spring ä¸­çš„ <strong>Bean é»˜è®¤éƒ½æ˜¯å•ä¾‹çš„</strong>ã€‚</li><li><strong>æ¨¡æ¿æ–¹æ³•æ¨¡å¼</strong> : Spring ä¸­ jdbcTemplateã€hibernateTemplate ç­‰ä»¥ Template ç»“å°¾çš„å¯¹æ•°æ®åº“æ“ä½œçš„ç±»ï¼Œå®ƒä»¬å°±ä½¿ç”¨åˆ°äº†æ¨¡æ¿æ¨¡å¼ã€‚</li><li><strong>åŒ…è£…å™¨è®¾è®¡æ¨¡å¼</strong> : æˆ‘ä»¬çš„é¡¹ç›®éœ€è¦è¿æ¥å¤šä¸ªæ•°æ®åº“ï¼Œè€Œä¸”ä¸åŒçš„å®¢æˆ·åœ¨æ¯æ¬¡è®¿é—®ä¸­æ ¹æ®éœ€è¦ä¼šå»è®¿é—®ä¸åŒçš„æ•°æ®åº“ã€‚<strong>è¿™ç§æ¨¡å¼è®©æˆ‘ä»¬å¯ä»¥æ ¹æ®å®¢æˆ·çš„éœ€æ±‚èƒ½å¤ŸåŠ¨æ€åˆ‡æ¢ä¸åŒçš„æ•°æ®æºã€‚</strong></li><li><strong>è§‚å¯Ÿè€…æ¨¡å¼:</strong> <strong>Spring äº‹ä»¶é©±åŠ¨æ¨¡å‹</strong>å°±æ˜¯è§‚å¯Ÿè€…æ¨¡å¼å¾ˆç»å…¸çš„ä¸€ä¸ªåº”ç”¨ã€‚</li><li><strong>é€‚é…å™¨æ¨¡å¼</strong> :Spring AOP çš„å¢å¼ºæˆ–é€šçŸ¥(Advice)ä½¿ç”¨åˆ°äº†é€‚é…å™¨æ¨¡å¼ã€spring MVC ä¸­ä¹Ÿæ˜¯ç”¨åˆ°äº†é€‚é…å™¨æ¨¡å¼é€‚é…Controllerã€‚</li></ul><h2 id="19-spring-å¸¸ç”¨æ³¨è§£æœ‰ä»€ä¹ˆï¼Ÿ"><a href="#19-spring-å¸¸ç”¨æ³¨è§£æœ‰ä»€ä¹ˆï¼Ÿ" class="headerlink" title="19.spring å¸¸ç”¨æ³¨è§£æœ‰ä»€ä¹ˆï¼Ÿ"></a>19.spring <strong>å¸¸ç”¨æ³¨è§£æœ‰ä»€ä¹ˆï¼Ÿ</strong></h2><blockquote><p>@Autowired æ³¨è§£</p></blockquote><p>@Autowiredï¼šä¸»è¦ç”¨äº<strong>è‡ªåŠ¨è£…é…bean</strong>ã€‚å½“Spring<a href="https://cloud.tencent.com/product/tke?from_column=20065&amp;from=20065">å®¹å™¨ (opens new window)</a>ä¸­å­˜åœ¨ä¸è¦æ³¨å…¥çš„å±æ€§ç±»å‹åŒ¹é…çš„beanæ—¶ï¼Œå®ƒä¼šè‡ªåŠ¨å°†beanæ³¨å…¥åˆ°å±æ€§ä¸­ã€‚å°±è·Ÿæˆ‘ä»¬new å¯¹è±¡ä¸€æ ·ã€‚</p><p>ç”¨æ³•å¾ˆç®€å•ï¼Œå¦‚ä¸‹ç¤ºä¾‹ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyService</span> &#123;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyController</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> MyService myService;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä»£ç ä¸­ï¼ŒMyControllerç±»ä¸­çš„myServiceå±æ€§è¢«@Autowiredæ³¨è§£æ ‡è®°ï¼ŒSpringä¼šè‡ªåŠ¨å°†MyServiceç±»å‹çš„beanæ³¨å…¥åˆ°myServiceå±æ€§ä¸­ã€‚</p><blockquote><p>@Component</p></blockquote><p>è¿™ä¸ªæ³¨è§£ç”¨äº<strong>æ ‡è®°ä¸€ä¸ªç±»ä½œä¸ºSpringçš„bean</strong>ã€‚å½“ä¸€ä¸ªç±»è¢«@Componentæ³¨è§£æ ‡è®°æ—¶ï¼ŒSpringä¼šå°†å…¶å®ä¾‹åŒ–ä¸ºä¸€ä¸ªbeanï¼Œå¹¶å°†å…¶æ·»åŠ åˆ°Springå®¹å™¨ä¸­ã€‚åœ¨ä¸Šé¢è®²è§£@Autowiredçš„æ—¶å€™ä¹Ÿçœ‹åˆ°äº†ï¼Œç¤ºä¾‹ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyComponent</span> &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä»£ç ä¸­ï¼ŒMyComponentç±»è¢«@Componentæ³¨è§£æ ‡è®°ï¼ŒSpringä¼šå°†å…¶å®ä¾‹åŒ–ä¸ºä¸€ä¸ªbeanï¼Œå¹¶å°†å…¶æ·»åŠ åˆ°Springå®¹å™¨ä¸­ã€‚</p><blockquote><p>@Configuration</p></blockquote><p>@Configurationï¼Œæ³¨è§£ç”¨äº<strong>æ ‡è®°ä¸€ä¸ªç±»ä½œä¸ºSpringçš„é…ç½®ç±»</strong>ã€‚é…ç½®ç±»å¯ä»¥åŒ…å«@Beanæ³¨è§£çš„æ–¹æ³•ï¼Œç”¨äºå®šä¹‰å’Œé…ç½®beanï¼Œä½œä¸ºå…¨å±€é…ç½®ã€‚ç¤ºä¾‹ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyConfiguration</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> MyBean <span class="title function_">myBean</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">MyBean</span>();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>@Bean</p></blockquote><p>@Beanæ³¨è§£ç”¨äº<strong>æ ‡è®°ä¸€ä¸ªæ–¹æ³•ä½œä¸ºSpringçš„beanå·¥å‚æ–¹æ³•</strong>ã€‚å½“ä¸€ä¸ªæ–¹æ³•è¢«@Beanæ³¨è§£æ ‡è®°æ—¶ï¼ŒSpringä¼šå°†è¯¥æ–¹æ³•çš„è¿”å›å€¼ä½œä¸ºä¸€ä¸ªbeanï¼Œå¹¶å°†å…¶æ·»åŠ åˆ°Springå®¹å™¨ä¸­ï¼Œå¦‚æœè‡ªå®šä¹‰é…ç½®ï¼Œç»å¸¸ç”¨åˆ°è¿™ä¸ªæ³¨è§£ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyConfiguration</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> MyBean <span class="title function_">myBean</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">MyBean</span>();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>@Service</p></blockquote><p>@Serviceï¼Œè¿™ä¸ªæ³¨è§£ç”¨äºæ ‡è®°ä¸€ä¸ªç±»ä½œä¸ºæœåŠ¡å±‚çš„ç»„ä»¶ã€‚å®ƒæ˜¯@Componentæ³¨è§£çš„ç‰¹ä¾‹ï¼Œç”¨äºæ ‡è®°æœåŠ¡å±‚çš„beanï¼Œä¸€èˆ¬æ ‡è®°åœ¨ä¸šåŠ¡serviceçš„å®ç°ç±»ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyServiceImpl</span> &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>@Repository</p></blockquote><p>@Repositoryæ³¨è§£<strong>ç”¨äºæ ‡è®°ä¸€ä¸ªç±»ä½œä¸ºæ•°æ®è®¿é—®å±‚çš„ç»„ä»¶</strong>ã€‚å®ƒä¹Ÿæ˜¯@Componentæ³¨è§£çš„ç‰¹ä¾‹ï¼Œç”¨äºæ ‡è®°æ•°æ®è®¿é—®å±‚çš„beanã€‚è¿™ä¸ªæ³¨è§£å¾ˆå®¹æ˜“è¢«å¿½ç•¥ï¼Œå¯¼è‡´æ•°æ®åº“æ— æ³•è®¿é—®ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyRepository</span> &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä»£ç ä¸­ï¼ŒMyRepositoryç±»è¢«@Repositoryæ³¨è§£æ ‡è®°ï¼ŒSpringä¼šå°†å…¶å®ä¾‹åŒ–ä¸ºä¸€ä¸ªbeanï¼Œå¹¶å°†å…¶æ·»åŠ åˆ°Springå®¹å™¨ä¸­ã€‚</p><blockquote><p>@Controller</p></blockquote><p>@Controlleræ³¨è§£ç”¨äºæ ‡è®°ä¸€ä¸ªç±»ä½œä¸ºæ§åˆ¶å±‚çš„ç»„ä»¶ã€‚å®ƒä¹Ÿæ˜¯@Componentæ³¨è§£çš„ç‰¹ä¾‹ï¼Œç”¨äºæ ‡è®°æ§åˆ¶å±‚çš„beanã€‚è¿™æ˜¯MVCç»“æ„çš„å¦ä¸€ä¸ªéƒ¨åˆ†ï¼ŒåŠ åœ¨æ§åˆ¶å±‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyController</span> &#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ä¸Šé¢çš„ç¤ºä¾‹ä»£ç ä¸­ï¼ŒMyControllerç±»è¢«@Controlleræ³¨è§£æ ‡è®°ï¼ŒSpringä¼šå°†å…¶å®ä¾‹åŒ–ä¸ºä¸€ä¸ªbeanï¼Œå¹¶å°†å…¶æ·»åŠ åˆ°Springå®¹å™¨ä¸­ã€‚</p><h1 id="Bean"><a href="#Bean" class="headerlink" title="Bean"></a>Bean</h1><h2 id="1-Beançš„ç”Ÿå‘½å‘¨æœŸè¯´ä¸€ä¸‹ï¼Ÿ"><a href="#1-Beançš„ç”Ÿå‘½å‘¨æœŸè¯´ä¸€ä¸‹ï¼Ÿ" class="headerlink" title="1.Beançš„ç”Ÿå‘½å‘¨æœŸè¯´ä¸€ä¸‹ï¼Ÿ"></a>1.Beançš„ç”Ÿå‘½å‘¨æœŸè¯´ä¸€ä¸‹ï¼Ÿ</h2><p><img src="https://cdn.xiaolincoding.com//picgo/1719570477922-ad595a67-be98-4272-9e13-8ad73dd75c13.png" alt="img"></p><ol><li>Springå¯åŠ¨ï¼ŒæŸ¥æ‰¾å¹¶åŠ è½½éœ€è¦è¢«Springç®¡ç†çš„beanï¼Œè¿›è¡ŒBeançš„å®ä¾‹åŒ–</li><li>Beanå®ä¾‹åŒ–åå¯¹<strong>å°†Beançš„å¼•å…¥å’Œå€¼</strong>æ³¨å…¥åˆ°Beançš„å±æ€§ä¸­</li><li>å¦‚æœBeanå®ç°äº†<strong>BeanNameAware</strong>æ¥å£çš„è¯ï¼ŒSpringå°†Beançš„Idä¼ é€’ç»™setBeanName()æ–¹æ³•</li><li>å¦‚æœBeanå®ç°äº†<strong>BeanFactoryAware</strong>æ¥å£çš„è¯ï¼ŒS<strong>pringå°†è°ƒç”¨setBeanFactory()æ–¹æ³•ï¼Œå°†BeanFactoryå®¹å™¨å®ä¾‹ä¼ å…¥</strong></li><li>å¦‚æœBeanå®ç°äº†ApplicationContextAwareæ¥å£çš„è¯ï¼Œ<strong>Springå°†è°ƒç”¨Beançš„setApplicationContext()æ–¹æ³•ï¼Œå°†beanæ‰€åœ¨åº”ç”¨ä¸Šä¸‹æ–‡å¼•ç”¨ä¼ å…¥è¿›æ¥</strong>ã€‚</li><li>å¦‚æœBeanå®ç°äº†BeanPostProcessoræ¥å£ï¼ŒSpringå°±å°†è°ƒç”¨ä»–ä»¬çš„<strong>postProcessBeforeInitialization()æ–¹æ³•ã€‚</strong></li><li>å¦‚æœBean å®ç°äº†InitializingBeanæ¥å£ï¼ŒSpringå°†è°ƒç”¨ä»–ä»¬çš„<strong>afterPropertiesSet()æ–¹æ³•ã€‚ç±»ä¼¼çš„ï¼Œå¦‚æœbeanä½¿ç”¨init-methodå£°æ˜äº†åˆå§‹åŒ–æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¹Ÿä¼šè¢«è°ƒç”¨</strong></li><li>å¦‚æœBean å®ç°äº†BeanPostProcessoræ¥å£ï¼ŒSpringå°±å°†è°ƒç”¨ä»–ä»¬çš„postProcessAfterInitialization()æ–¹æ³•ã€‚</li><li>æ­¤æ—¶ï¼ŒBeanå·²ç»å‡†å¤‡å°±ç»ªï¼Œå¯ä»¥è¢«åº”ç”¨ç¨‹åºä½¿ç”¨äº†ã€‚ä»–ä»¬å°†ä¸€ç›´é©»ç•™åœ¨åº”ç”¨ä¸Šä¸‹æ–‡ä¸­ï¼Œç›´åˆ°åº”ç”¨ä¸Šä¸‹æ–‡è¢«é”€æ¯ã€‚</li><li>å¦‚æœbeanå®ç°äº†DisposableBeanæ¥å£ï¼ŒSpringå°†è°ƒç”¨å®ƒçš„destory()æ¥å£æ–¹æ³•ï¼ŒåŒæ ·ï¼Œå¦‚æœbeanä½¿ç”¨äº†destory-method å£°æ˜é”€æ¯æ–¹æ³•ï¼Œè¯¥æ–¹æ³•ä¹Ÿä¼šè¢«è°ƒç”¨ã€‚</li></ol><h2 id="2-Beanæ˜¯å¦å•ä¾‹ï¼Ÿ"><a href="#2-Beanæ˜¯å¦å•ä¾‹ï¼Ÿ" class="headerlink" title="2.Beanæ˜¯å¦å•ä¾‹ï¼Ÿ"></a>2.Beanæ˜¯å¦å•ä¾‹ï¼Ÿ</h2><p>Spring ä¸­çš„ Bean <strong>é»˜è®¤éƒ½æ˜¯å•ä¾‹çš„</strong>ã€‚</p><p>å°±æ˜¯è¯´ï¼Œ<strong>æ¯ä¸ªBeançš„å®ä¾‹åªä¼šè¢«åˆ›å»ºä¸€æ¬¡ï¼Œå¹¶ä¸”ä¼šè¢«å­˜å‚¨åœ¨Springå®¹å™¨çš„ç¼“å­˜ä¸­ï¼Œä»¥ä¾¿åœ¨åç»­çš„è¯·æ±‚ä¸­é‡å¤ä½¿ç”¨ã€‚è¿™ç§å•ä¾‹æ¨¡å¼å¯ä»¥æé«˜åº”ç”¨ç¨‹åºçš„æ€§èƒ½å’Œå†…å­˜æ•ˆç‡ã€‚</strong></p><p>ä½†æ˜¯ï¼ŒSpringä¹Ÿæ”¯æŒå°†Beanè®¾ç½®ä¸ºå¤šä¾‹æ¨¡å¼ï¼Œå³<strong>æ¯æ¬¡è¯·æ±‚éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„Beanå®ä¾‹ã€‚è¦å°†Beanè®¾ç½®ä¸ºå¤šä¾‹æ¨¡å¼ï¼Œå¯ä»¥åœ¨Beanå®šä¹‰ä¸­é€šè¿‡è®¾ç½®scopeå±æ€§ä¸ºâ€prototypeâ€æ¥å®ç°ã€‚</strong></p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œè™½ç„¶Springçš„é»˜è®¤è¡Œä¸ºæ˜¯å°†Beanè®¾ç½®ä¸ºå•ä¾‹æ¨¡å¼ï¼Œä½†åœ¨ä¸€äº›æƒ…å†µä¸‹ï¼Œä½¿ç”¨å¤šä¾‹æ¨¡å¼æ˜¯æ›´ä¸ºåˆé€‚çš„ï¼Œ<strong>ä¾‹å¦‚åœ¨åˆ›å»ºçŠ¶æ€ä¸å¯å˜çš„Beanæˆ–æœ‰çŠ¶æ€Beanæ—¶ã€‚æ­¤å¤–ï¼Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œå¦‚æœBeanå•ä¾‹æ˜¯æœ‰çŠ¶æ€çš„ï¼Œé‚£ä¹ˆåœ¨ä½¿ç”¨æ—¶éœ€è¦è€ƒè™‘çº¿ç¨‹å®‰å…¨æ€§é—®é¢˜ã€‚</strong></p><h2 id="3-Beançš„å•ä¾‹å’Œéå•ä¾‹ï¼Œç”Ÿå‘½å‘¨æœŸæ˜¯å¦ä¸€æ ·"><a href="#3-Beançš„å•ä¾‹å’Œéå•ä¾‹ï¼Œç”Ÿå‘½å‘¨æœŸæ˜¯å¦ä¸€æ ·" class="headerlink" title="3.Beançš„å•ä¾‹å’Œéå•ä¾‹ï¼Œç”Ÿå‘½å‘¨æœŸæ˜¯å¦ä¸€æ ·"></a>3.Beançš„å•ä¾‹å’Œéå•ä¾‹ï¼Œç”Ÿå‘½å‘¨æœŸæ˜¯å¦ä¸€æ ·</h2><p>ä¸ä¸€æ ·çš„ï¼ŒSpring Bean çš„ç”Ÿå‘½å‘¨æœŸå®Œå…¨ç”± IoC å®¹å™¨æ§åˆ¶ã€‚Spring åªå¸®æˆ‘ä»¬ç®¡ç†å•ä¾‹æ¨¡å¼ Bean çš„å®Œæ•´ç”Ÿå‘½å‘¨æœŸï¼Œå¯¹äº <code>prototype</code> çš„ Beanï¼ŒSpring åœ¨åˆ›å»ºå¥½äº¤ç»™ä½¿ç”¨è€…ä¹‹åï¼Œåˆ™ä¸ä¼šå†ç®¡ç†åç»­çš„ç”Ÿå‘½å‘¨æœŸã€‚</p><p>å…·ä½“åŒºåˆ«å¦‚ä¸‹ï¼š</p><div class="table-container"><table><thead><tr><th style="text-align:left"><strong>é˜¶æ®µ</strong></th><th style="text-align:left"><strong>å•ä¾‹ï¼ˆSingletonï¼‰</strong></th><th style="text-align:left"><strong>éå•ä¾‹ï¼ˆå¦‚Prototypeï¼‰</strong></th></tr></thead><tbody><tr><td style="text-align:left"><strong>åˆ›å»ºæ—¶æœº</strong></td><td style="text-align:left">å®¹å™¨å¯åŠ¨æ—¶åˆ›å»ºï¼ˆæˆ–é¦–æ¬¡è¯·æ±‚æ—¶ï¼Œå–å†³äºé…ç½®ï¼‰ã€‚</td><td style="text-align:left">æ¯æ¬¡è¯·æ±‚æ—¶åˆ›å»ºæ–°å®ä¾‹ã€‚</td></tr><tr><td style="text-align:left"><strong>åˆå§‹åŒ–æµç¨‹</strong></td><td style="text-align:left">å®Œæ•´æ‰§è¡Œç”Ÿå‘½å‘¨æœŸæµç¨‹ï¼ˆå±æ€§æ³¨å…¥ã€Awareæ¥å£ã€åˆå§‹åŒ–æ–¹æ³•ç­‰ï¼‰ã€‚</td><td style="text-align:left">æ¯æ¬¡åˆ›å»ºæ–°å®ä¾‹æ—¶éƒ½ä¼šå®Œæ•´æ‰§è¡Œç”Ÿå‘½å‘¨æœŸæµç¨‹ï¼ˆä»…åˆ°åˆå§‹åŒ–å®Œæˆï¼‰ã€‚</td></tr><tr><td style="text-align:left"><strong>é”€æ¯æ—¶æœº</strong></td><td style="text-align:left">å®¹å™¨å…³é—­æ—¶é”€æ¯ï¼Œè§¦å‘<code>DisposableBean</code>æˆ–<code>destroy-method</code>ã€‚</td><td style="text-align:left"><strong>å®¹å™¨ä¸ç®¡ç†é”€æ¯</strong>ï¼Œéœ€ç”±è°ƒç”¨è€…è‡ªè¡Œé‡Šæ”¾èµ„æºï¼ˆSpringä¸è·Ÿè¸ªå®ä¾‹ï¼‰ã€‚</td></tr><tr><td style="text-align:left"><strong>å†…å­˜å ç”¨</strong></td><td style="text-align:left">å•å®ä¾‹å¸¸é©»å†…å­˜ï¼Œé«˜æ•ˆä½†éœ€æ³¨æ„çº¿ç¨‹å®‰å…¨ã€‚</td><td style="text-align:left">æ¯æ¬¡è¯·æ±‚ç”Ÿæˆæ–°å®ä¾‹ï¼Œå†…å­˜å¼€é”€è¾ƒå¤§ï¼Œéœ€æ‰‹åŠ¨ç®¡ç†èµ„æºé‡Šæ”¾ã€‚</td></tr><tr><td style="text-align:left"><strong>é€‚ç”¨åœºæ™¯</strong></td><td style="text-align:left">æ— çŠ¶æ€æœåŠ¡ï¼ˆå¦‚Serviceã€DAOå±‚ï¼‰ã€‚</td><td style="text-align:left">æœ‰çŠ¶æ€å¯¹è±¡ï¼ˆå¦‚ç”¨æˆ·ä¼šè¯ã€ä¸´æ—¶è®¡ç®—å¯¹è±¡ï¼‰ã€‚</td></tr></tbody></table></div><h2 id="4-Spring-beançš„ä½œç”¨åŸŸæœ‰å“ªäº›ï¼Ÿ"><a href="#4-Spring-beançš„ä½œç”¨åŸŸæœ‰å“ªäº›ï¼Ÿ" class="headerlink" title="4.Spring beançš„ä½œç”¨åŸŸæœ‰å“ªäº›ï¼Ÿ"></a>4.Spring beançš„ä½œç”¨åŸŸæœ‰å“ªäº›ï¼Ÿ</h2><p>Springæ¡†æ¶ä¸­çš„Beanä½œç”¨åŸŸï¼ˆScopeï¼‰å®šä¹‰äº†Beançš„ç”Ÿå‘½å‘¨æœŸå’Œå¯è§æ€§ã€‚ä¸åŒçš„ä½œç”¨åŸŸå½±å“ç€Springå®¹å™¨å¦‚ä½•ç®¡ç†è¿™äº›Beançš„å®ä¾‹ï¼ŒåŒ…æ‹¬å®ƒä»¬å¦‚ä½•è¢«åˆ›å»ºã€å¦‚ä½•è¢«é”€æ¯ä»¥åŠå®ƒä»¬æ˜¯å¦å¯ä»¥è¢«å¤šä¸ªç”¨æˆ·å…±äº«ã€‚</p><p>Springæ”¯æŒå‡ ç§ä¸åŒçš„ä½œç”¨åŸŸï¼Œä»¥æ»¡è¶³ä¸åŒçš„åº”ç”¨åœºæ™¯éœ€æ±‚ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›ä¸»è¦çš„Beanä½œç”¨åŸŸï¼š</p><ul><li><strong>Singletonï¼ˆå•ä¾‹ï¼‰</strong>ï¼šåœ¨æ•´ä¸ªåº”ç”¨ç¨‹åºä¸­<strong>åªå­˜åœ¨ä¸€ä¸ª Bean å®ä¾‹</strong>ã€‚é»˜è®¤ä½œç”¨åŸŸï¼ŒSpring å®¹å™¨ä¸­åªä¼šåˆ›å»ºä¸€ä¸ª Bean å®ä¾‹ï¼Œå¹¶åœ¨å®¹å™¨çš„æ•´ä¸ªç”Ÿå‘½å‘¨æœŸä¸­å…±äº«è¯¥å®ä¾‹ã€‚</li><li><strong>Prototypeï¼ˆåŸå‹ï¼‰</strong>ï¼š<strong>æ¯æ¬¡è¯·æ±‚æ—¶éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ Bean å®ä¾‹ã€‚æ¬¡ä»å®¹å™¨ä¸­è·å–è¯¥ Bean æ—¶éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°å®ä¾‹ï¼Œé€‚ç”¨äºçŠ¶æ€éå¸¸ç¬æ—¶çš„ Beanã€‚</strong></li><li><strong>Requestï¼ˆè¯·æ±‚ï¼‰</strong>ï¼š<strong>æ¯ä¸ª HTTP è¯·æ±‚éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ Bean å®ä¾‹ã€‚</strong>ä»…åœ¨ Spring Web åº”ç”¨ç¨‹åºä¸­æœ‰æ•ˆï¼Œæ¯ä¸ª HTTP è¯·æ±‚éƒ½ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„ Bean å®ä¾‹ï¼Œé€‚ç”¨äº Web åº”ç”¨ä¸­éœ€æ±‚å±€éƒ¨æ€§çš„ Beanã€‚</li><li><strong>Sessionï¼ˆä¼šè¯ï¼‰</strong>ï¼š<strong>Session èŒƒå›´å†…åªä¼šåˆ›å»ºä¸€ä¸ª Bean å®ä¾‹</strong>ã€‚è¯¥ Bean å®ä¾‹åœ¨ç”¨æˆ·ä¼šè¯èŒƒå›´å†…å…±äº«ï¼Œä»…åœ¨ Spring Web åº”ç”¨ç¨‹åºä¸­æœ‰æ•ˆï¼Œé€‚ç”¨äºä¸ç”¨æˆ·ä¼šè¯ç›¸å…³çš„ Beanã€‚</li><li><strong>Application</strong>ï¼š<strong>å½“å‰ ServletContext ä¸­åªå­˜åœ¨ä¸€ä¸ª Bean å®ä¾‹ã€‚</strong>ä»…åœ¨ Spring Web åº”ç”¨ç¨‹åºä¸­æœ‰æ•ˆï¼Œè¯¥ Bean å®ä¾‹åœ¨æ•´ä¸ª ServletContext èŒƒå›´å†…å…±äº«ï¼Œé€‚ç”¨äºåº”ç”¨ç¨‹åºèŒƒå›´å†…å…±äº«çš„ Beanã€‚</li><li><strong>WebSocketï¼ˆWebå¥—æ¥å­—ï¼‰</strong>ï¼š<strong>åœ¨ WebSocket èŒƒå›´å†…åªå­˜åœ¨ä¸€ä¸ª Bean å®ä¾‹ã€‚</strong>ä»…åœ¨æ”¯æŒ WebSocket çš„åº”ç”¨ç¨‹åºä¸­æœ‰æ•ˆï¼Œè¯¥ Bean å®ä¾‹åœ¨ WebSocket ä¼šè¯èŒƒå›´å†…å…±äº«ï¼Œé€‚ç”¨äº WebSocket ä¼šè¯èŒƒå›´å†…å…±äº«çš„ Beanã€‚</li><li><strong>Custom scopesï¼ˆè‡ªå®šä¹‰ä½œç”¨åŸŸï¼‰</strong>ï¼š<strong>Spring å…è®¸å¼€å‘è€…å®šä¹‰è‡ªå®šä¹‰çš„ä½œç”¨åŸŸï¼Œé€šè¿‡å®ç° Scope æ¥å£æ¥åˆ›å»ºæ–°çš„ Bean ä½œç”¨åŸŸã€‚</strong></li></ul><p>åœ¨Springé…ç½®æ–‡ä»¶ä¸­ï¼Œå¯ä»¥é€šè¿‡æ ‡ç­¾çš„scopeå±æ€§æ¥æŒ‡å®šBeançš„ä½œç”¨åŸŸã€‚ä¾‹å¦‚ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;myBean&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.example.MyBeanClass&quot;</span> <span class="attr">scope</span>=<span class="string">&quot;singleton&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure><p>åœ¨Spring Bootæˆ–åŸºäºJavaçš„é…ç½®ä¸­ï¼Œå¯ä»¥é€šè¿‡@Scopeæ³¨è§£æ¥æŒ‡å®šBeançš„ä½œç”¨åŸŸã€‚ä¾‹å¦‚ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span>  </span><br><span class="line"><span class="meta">@Scope(&quot;prototype&quot;)</span>  </span><br><span class="line"><span class="keyword">public</span> MyBeanClass <span class="title function_">myBean</span><span class="params">()</span> &#123;  </span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">MyBeanClass</span>();  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="5-Springå®¹å™¨é‡Œå­˜çš„æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#5-Springå®¹å™¨é‡Œå­˜çš„æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="5.Springå®¹å™¨é‡Œå­˜çš„æ˜¯ä»€ä¹ˆï¼Ÿ"></a>5.Springå®¹å™¨é‡Œå­˜çš„æ˜¯ä»€ä¹ˆï¼Ÿ</h2><p>åœ¨Springå®¹å™¨ä¸­ï¼Œå­˜å‚¨çš„<strong>ä¸»è¦æ˜¯Beanå¯¹è±¡</strong>ã€‚</p><p>Beanæ˜¯Springæ¡†æ¶ä¸­çš„åŸºæœ¬ç»„ä»¶ï¼Œ<strong>ç”¨äºè¡¨ç¤ºåº”ç”¨ç¨‹åºä¸­çš„å„ç§å¯¹è±¡ã€‚</strong>å½“åº”ç”¨ç¨‹åºå¯åŠ¨æ—¶ï¼ŒSpringå®¹å™¨ä¼šæ ¹æ®é…ç½®æ–‡ä»¶æˆ–æ³¨è§£çš„æ–¹å¼åˆ›å»ºå’Œç®¡ç†è¿™äº›Beanå¯¹è±¡ã€‚Springå®¹å™¨ä¼šè´Ÿè´£åˆ›å»ºã€åˆå§‹åŒ–ã€æ³¨å…¥ä¾èµ–ä»¥åŠé”€æ¯Beanå¯¹è±¡ã€‚</p><h2 id="6-åœ¨Springä¸­ï¼Œåœ¨beanåŠ è½½-é”€æ¯å‰åï¼Œå¦‚æœæƒ³å®ç°æŸäº›é€»è¾‘ï¼Œå¯ä»¥æ€ä¹ˆåš"><a href="#6-åœ¨Springä¸­ï¼Œåœ¨beanåŠ è½½-é”€æ¯å‰åï¼Œå¦‚æœæƒ³å®ç°æŸäº›é€»è¾‘ï¼Œå¯ä»¥æ€ä¹ˆåš" class="headerlink" title="6.åœ¨Springä¸­ï¼Œåœ¨beanåŠ è½½/é”€æ¯å‰åï¼Œå¦‚æœæƒ³å®ç°æŸäº›é€»è¾‘ï¼Œå¯ä»¥æ€ä¹ˆåš"></a>6.åœ¨Springä¸­ï¼Œåœ¨beanåŠ è½½/é”€æ¯å‰åï¼Œå¦‚æœæƒ³å®ç°æŸäº›é€»è¾‘ï¼Œå¯ä»¥æ€ä¹ˆåš</h2><p>åœ¨Springæ¡†æ¶ä¸­ï¼Œå¦‚æœä½ å¸Œæœ›åœ¨<strong>BeanåŠ è½½ï¼ˆå³å®ä¾‹åŒ–ã€å±æ€§èµ‹å€¼ã€åˆå§‹åŒ–ç­‰è¿‡ç¨‹å®Œæˆåï¼‰æˆ–é”€æ¯å‰åæ‰§è¡ŒæŸäº›é€»è¾‘ï¼Œ</strong>ä½ å¯ä»¥ä½¿ç”¨<strong>Springçš„ç”Ÿå‘½å‘¨æœŸå›è°ƒæ¥å£æˆ–æ³¨è§£</strong>ã€‚è¿™äº›æ¥å£å’Œæ³¨è§£å…è®¸ä½ å®šä¹‰åœ¨Beanç”Ÿå‘½å‘¨æœŸçš„å…³é”®ç‚¹æ‰§è¡Œçš„ä»£ç ã€‚</p><blockquote><p>ä½¿ç”¨init-methodå’Œdestroy-method</p></blockquote><p>åœ¨XMLé…ç½®ä¸­ï¼Œä½ å¯ä»¥é€šè¿‡<strong>init-methodå’Œdestroy-methodå±æ€§</strong>æ¥æŒ‡å®šBeanåˆå§‹åŒ–åå’Œé”€æ¯å‰éœ€è¦è°ƒç”¨çš„æ–¹æ³•ã€‚</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;myBean&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.example.MyBeanClass&quot;</span>  </span></span><br><span class="line"><span class="tag">      <span class="attr">init-method</span>=<span class="string">&quot;init&quot;</span> <span class="attr">destroy-method</span>=<span class="string">&quot;destroy&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure><p>ç„¶åï¼Œåœ¨ä½ çš„Beanç±»ä¸­å®ç°è¿™äº›æ–¹æ³•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyBeanClass</span> &#123;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span> &#123;  </span><br><span class="line">        <span class="comment">// åˆå§‹åŒ–é€»è¾‘  </span></span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">destroy</span><span class="params">()</span> &#123;  </span><br><span class="line">        <span class="comment">// é”€æ¯é€»è¾‘  </span></span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p><strong>å®ç°InitializingBeanå’ŒDisposableBeanæ¥å£</strong></p></blockquote><p>ä½ çš„Beanç±»å¯ä»¥å®ç°org.springframework.beans.factory.InitializingBeanå’Œorg.springframework.beans.factory.DisposableBeanæ¥å£ï¼Œå¹¶åˆ†åˆ«å®ç°<strong>afterPropertiesSetå’Œdestroy</strong>æ–¹æ³•ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.DisposableBean;  </span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.InitializingBean;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyBeanClass</span> <span class="keyword">implements</span> <span class="title class_">InitializingBean</span>, DisposableBean &#123;  </span><br><span class="line">  </span><br><span class="line">    <span class="meta">@Override</span>  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">afterPropertiesSet</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;  </span><br><span class="line">        <span class="comment">// åˆå§‹åŒ–é€»è¾‘  </span></span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="meta">@Override</span>  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">destroy</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;  </span><br><span class="line">        <span class="comment">// é”€æ¯é€»è¾‘  </span></span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>ä½¿ç”¨@PostConstructå’Œ@PreDestroyæ³¨è§£</p></blockquote><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> javax.annotation.PostConstruct;  </span><br><span class="line"><span class="keyword">import</span> javax.annotation.PreDestroy;  </span><br><span class="line">  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyBeanClass</span> &#123;  </span><br><span class="line">  </span><br><span class="line">    <span class="meta">@PostConstruct</span>  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span> &#123;  </span><br><span class="line">        <span class="comment">// åˆå§‹åŒ–é€»è¾‘  </span></span><br><span class="line">    &#125;  </span><br><span class="line">  </span><br><span class="line">    <span class="meta">@PreDestroy</span>  </span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">destroy</span><span class="params">()</span> &#123;  </span><br><span class="line">        <span class="comment">// é”€æ¯é€»è¾‘  </span></span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>ä½¿ç”¨@Beanæ³¨è§£çš„initMethodå’ŒdestroyMethodå±æ€§</p></blockquote><p>åœ¨åŸºäºJavaçš„é…ç½®ä¸­ï¼Œ<strong>ä½ è¿˜å¯ä»¥åœ¨@Beanæ³¨è§£ä¸­æŒ‡å®šinitMethodå’ŒdestroyMethodå±æ€§ã€‚</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span>  </span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AppConfig</span> &#123;  </span><br><span class="line">  </span><br><span class="line">    <span class="meta">@Bean(initMethod = &quot;init&quot;, destroyMethod = &quot;destroy&quot;)</span>  </span><br><span class="line">    <span class="keyword">public</span> MyBeanClass <span class="title function_">myBean</span><span class="params">()</span> &#123;  </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">MyBeanClass</span>();  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="7-Beanæ³¨å…¥å’Œxmlæ³¨å…¥æœ€ç»ˆå¾—åˆ°äº†ç›¸åŒçš„æ•ˆæœï¼Œå®ƒä»¬åœ¨åº•å±‚æ˜¯æ€æ ·åšçš„"><a href="#7-Beanæ³¨å…¥å’Œxmlæ³¨å…¥æœ€ç»ˆå¾—åˆ°äº†ç›¸åŒçš„æ•ˆæœï¼Œå®ƒä»¬åœ¨åº•å±‚æ˜¯æ€æ ·åšçš„" class="headerlink" title="7.Beanæ³¨å…¥å’Œxmlæ³¨å…¥æœ€ç»ˆå¾—åˆ°äº†ç›¸åŒçš„æ•ˆæœï¼Œå®ƒä»¬åœ¨åº•å±‚æ˜¯æ€æ ·åšçš„"></a>7.Beanæ³¨å…¥å’Œxmlæ³¨å…¥æœ€ç»ˆå¾—åˆ°äº†ç›¸åŒçš„æ•ˆæœï¼Œå®ƒä»¬åœ¨åº•å±‚æ˜¯æ€æ ·åšçš„</h2><p>åœ¨Springæ¡†æ¶ä¸­ï¼Œ<strong>åŸºäºæ³¨è§£çš„Beanæ³¨å…¥ï¼ˆå¦‚<code>@Autowired</code>ã€<code>@Resource</code>ï¼‰å’ŒåŸºäºXMLçš„ä¾èµ–æ³¨å…¥</strong>è™½ç„¶åœ¨é…ç½®æ–¹å¼ä¸Šä¸åŒï¼Œ<strong>ä½†åœ¨åº•å±‚æœ€ç»ˆéƒ½é€šè¿‡Springå®¹å™¨çš„ç»Ÿä¸€æœºåˆ¶å®ç°ä¾èµ–æ³¨å…¥</strong>ã€‚å®ƒä»¬çš„æ ¸å¿ƒæµç¨‹å¯ä»¥å½’çº³ä¸ºä»¥ä¸‹æ­¥éª¤ï¼š</p><div class="table-container"><table><thead><tr><th style="text-align:left"><strong>é˜¶æ®µ</strong></th><th style="text-align:left"><strong>æ³¨è§£æ³¨å…¥</strong></th><th style="text-align:left"><strong>XMLæ³¨å…¥</strong></th></tr></thead><tbody><tr><td style="text-align:left"><strong>é…ç½®è§£æ</strong></td><td style="text-align:left">é€šè¿‡æ³¨è§£å¤„ç†å™¨æ‰«æç±»è·¯å¾„ï¼Œè§£æ<code>@Component</code>ã€<code>@Autowired</code>ç­‰æ³¨è§£ã€‚</td><td style="text-align:left">è§£æXMLæ–‡ä»¶ä¸­çš„<code>&lt;bean&gt;</code>ã€<code>&lt;property&gt;</code>ã€<code>&lt;constructor-arg&gt;</code>æ ‡ç­¾ã€‚</td></tr><tr><td style="text-align:left"><strong>ç”ŸæˆBeanDefinition</strong></td><td style="text-align:left">å°†æ³¨è§£ä¿¡æ¯è½¬æ¢ä¸º<code>AnnotatedBeanDefinition</code>ã€‚</td><td style="text-align:left">å°†XMLé…ç½®è½¬æ¢ä¸º<code>GenericBeanDefinition</code>ã€‚</td></tr><tr><td style="text-align:left"><strong>ä¾èµ–æ³¨å…¥</strong></td><td style="text-align:left">ç”±<code>AutowiredAnnotationBeanPostProcessor</code>ç­‰åå¤„ç†å™¨å¤„ç†ã€‚</td><td style="text-align:left">åœ¨BeanDefinitionä¸­ç›´æ¥è®°å½•å±æ€§æˆ–æ„é€ å™¨å‚æ•°ï¼Œç”±å®¹å™¨ç›´æ¥æ³¨å…¥ã€‚</td></tr><tr><td style="text-align:left"><strong>æœ€ç»ˆç»“æœ</strong></td><td style="text-align:left">ç”Ÿæˆå®Œæ•´çš„Beanå®ä¾‹ï¼Œå®Œæˆä¾èµ–æ³¨å…¥ã€‚</td><td style="text-align:left">ç”Ÿæˆå®Œæ•´çš„Beanå®ä¾‹ï¼Œå®Œæˆä¾èµ–æ³¨å…¥ã€‚</td></tr></tbody></table></div><blockquote><p>XML æ³¨å…¥</p></blockquote><p>ä½¿ç”¨ XML æ–‡ä»¶è¿›è¡Œ Bean æ³¨å…¥æ—¶ï¼Œ<strong>Spring åœ¨å¯åŠ¨æ—¶ä¼šè¯»å– XML é…ç½®æ–‡ä»¶ï¼Œä»¥ä¸‹æ˜¯å…¶åº•å±‚æ­¥éª¤ï¼š</strong></p><ul><li><strong>Bean å®šä¹‰è§£æ</strong>ï¼šSpring å®¹å™¨é€šè¿‡ <code>XmlBeanDefinitionReader</code> ç±»è§£æ XML é…ç½®æ–‡ä»¶ï¼Œè¯»å–å…¶ä¸­çš„ <code>&lt;bean&gt;</code> æ ‡ç­¾ä»¥è·å– Bean çš„å®šä¹‰ä¿¡æ¯ã€‚</li><li><strong>æ³¨å†Œ Bean å®šä¹‰</strong>ï¼šè§£æåçš„ Bean ä¿¡æ¯è¢«æ³¨å†Œåˆ° <code>BeanDefinitionRegistry</code>ï¼ˆå¦‚ <code>DefaultListableBeanFactory</code>ï¼‰ä¸­ï¼ŒåŒ…æ‹¬ Bean çš„ç±»ã€ä½œç”¨åŸŸã€ä¾èµ–å…³ç³»ã€åˆå§‹åŒ–å’Œé”€æ¯æ–¹æ³•ç­‰ã€‚</li><li>å®ä¾‹åŒ–å’Œä¾èµ–æ³¨å…¥ï¼šå½“åº”ç”¨ç¨‹åºè¯·æ±‚æŸä¸ª Bean æ—¶ï¼ŒSpring å®¹å™¨ä¼šæ ¹æ®å·²ç»æ³¨å†Œçš„ Bean å®šä¹‰ï¼š<ul><li>é¦–å…ˆï¼Œ<strong>ä½¿ç”¨åå°„æœºåˆ¶åˆ›å»ºè¯¥ Bean çš„å®ä¾‹</strong>ã€‚</li><li>ç„¶åï¼Œæ ¹æ® Bean å®šä¹‰ä¸­çš„é…ç½®ï¼Œé€šè¿‡ setter æ–¹æ³•ã€æ„é€ å‡½æ•°æˆ–æ–¹æ³•æ³¨å…¥æ‰€éœ€çš„ä¾èµ– Beanã€‚</li></ul></li></ul><blockquote><p>æ³¨è§£æ³¨å…¥</p></blockquote><p>ä½¿ç”¨æ³¨è§£è¿›è¡Œ Bean æ³¨å…¥æ—¶ï¼ŒSpring çš„å¤„ç†è¿‡ç¨‹å¦‚ä¸‹ï¼š</p><ul><li><strong>ç±»è·¯å¾„æ‰«æ</strong>ï¼šå½“ Spring å®¹å™¨å¯åŠ¨æ—¶ï¼Œå®ƒé¦–å…ˆä¼šè¿›è¡Œç±»è·¯å¾„æ‰«æï¼Œ<strong>æŸ¥æ‰¾å¸¦æœ‰ç‰¹å®šæ³¨è§£</strong>ï¼ˆå¦‚ <code>@Component</code>ã€<code>@Service</code>ã€<code>@Repository</code> å’Œ <code>@Controller</code>ï¼‰çš„ç±»ã€‚</li><li><strong>æ³¨å†Œ Bean å®šä¹‰</strong>ï¼šæ‰¾åˆ°çš„ç±»ä¼šè¢«æ³¨å†Œåˆ° <code>BeanDefinitionRegistry</code> ä¸­ï¼ŒSpring å®¹å™¨å°†ä¸ºå…¶ç”Ÿæˆ Bean å®šä¹‰ä¿¡æ¯ã€‚<strong>è¿™é€šå¸¸é€šè¿‡ <code>AnnotatedBeanDefinitionReader</code> ç±»æ¥å®ç°ã€‚</strong></li><li><strong>ä¾èµ–æ³¨å…¥</strong>ï¼šä¸ XML æ³¨å…¥ç±»ä¼¼ï¼ŒSpring åœ¨å®ä¾‹åŒ– Bean æ—¶ï¼Œä¹Ÿä¼šæ£€æŸ¥å­—æ®µä¸Šæ˜¯å¦æœ‰ <code>@Autowired</code>ã€<code>@Inject</code> æˆ– <code>@Resource</code> æ³¨è§£ã€‚å¦‚æœæœ‰ï¼Œ<strong>Spring ä¼šæ ¹æ®æ³¨è§£çš„ä¿¡æ¯è¿›è¡Œä¾èµ–æ³¨å…¥ã€‚</strong></li></ul><p>å°½ç®¡ä½¿ç”¨çš„æ–¹å¼ä¸åŒï¼Œä½† XML æ³¨å…¥å’Œæ³¨è§£æ³¨å…¥åœ¨åº•å±‚çš„å®ç°æœºåˆ¶æ˜¯ç›¸ä¼¼çš„ï¼Œä¸»è¦ä½“ç°åœ¨ä»¥ä¸‹å‡ ä¸ªæ–¹é¢ï¼š</p><ol><li><strong>BeanDefinition</strong>ï¼šæ— è®ºæ˜¯ XML è¿˜æ˜¯æ³¨è§£ï¼Œæœ€ç»ˆéƒ½ä¼šç”Ÿæˆ <code>BeanDefinition</code> å¯¹è±¡ï¼Œå¹¶å­˜å‚¨åœ¨åŒä¸€ä¸ª <code>BeanDefinitionRegistry</code> ä¸­ã€‚</li><li>åå¤„ç†å™¨ï¼š<ul><li><strong>Spring æä¾›äº†å¤šä¸ª Bean åå¤„ç†å™¨ï¼ˆ</strong>å¦‚ <code>AutowiredAnnotationBeanPostProcessor</code>ï¼‰ï¼Œç”¨äºå¤„ç†æ³¨è§£ï¼ˆå¦‚ <code>@Autowired</code>ï¼‰çš„ä¾èµ–æ³¨å…¥ã€‚</li><li>å¯¹äº XMLï¼ŒSpring ä¹Ÿæœ‰ç›¸åº”çš„åå¤„ç†å™¨æ¥å¤„ç† XML é…ç½®çš„ä¾èµ–æ³¨å…¥ã€‚</li></ul></li><li><strong>ä¾èµ–æŸ¥æ‰¾</strong>ï¼šåœ¨ä¾èµ–æ³¨å…¥æ—¶ï¼ŒSpring å®¹å™¨ä¼šé€šè¿‡ <code>ApplicationContext</code> ä¸­çš„ BeanFactory æ–¹æ³•æ¥æŸ¥æ‰¾å’Œæ³¨å…¥ä¾èµ–ï¼Œæ— è®ºæ˜¯é€šè¿‡ XML è¿˜æ˜¯æ³¨è§£ï¼Œéƒ½ä¼šè°ƒç”¨ç±»ä¼¼çš„æŸ¥æ‰¾æ–¹æ³•ã€‚</li></ol><h2 id="8-Springç»™æˆ‘ä»¬æä¾›äº†å¾ˆå¤šæ‰©å±•ç‚¹ï¼Œè¿™äº›æœ‰äº†è§£å—ï¼Ÿ"><a href="#8-Springç»™æˆ‘ä»¬æä¾›äº†å¾ˆå¤šæ‰©å±•ç‚¹ï¼Œè¿™äº›æœ‰äº†è§£å—ï¼Ÿ" class="headerlink" title="8.Springç»™æˆ‘ä»¬æä¾›äº†å¾ˆå¤šæ‰©å±•ç‚¹ï¼Œè¿™äº›æœ‰äº†è§£å—ï¼Ÿ"></a>8.Springç»™æˆ‘ä»¬æä¾›äº†å¾ˆå¤šæ‰©å±•ç‚¹ï¼Œè¿™äº›æœ‰äº†è§£å—ï¼Ÿ</h2><p>Springæ¡†æ¶æä¾›äº†è®¸å¤šæ‰©å±•ç‚¹ï¼Œä½¿å¾—å¼€å‘è€…å¯ä»¥æ ¹æ®éœ€æ±‚å®šåˆ¶å’Œæ‰©å±•Springçš„åŠŸèƒ½ã€‚ä»¥ä¸‹æ˜¯ä¸€äº›å¸¸ç”¨çš„æ‰©å±•ç‚¹ï¼š</p><ol><li>BeanFactoryPostProcessorï¼šå…è®¸åœ¨Springå®¹å™¨å®ä¾‹åŒ–beanä¹‹å‰ä¿®æ”¹beançš„å®šä¹‰ã€‚å¸¸ç”¨äºä¿®æ”¹beanå±æ€§æˆ–æ”¹å˜beançš„ä½œç”¨åŸŸã€‚</li><li>BeanPostProcessorï¼šå¯ä»¥åœ¨beanå®ä¾‹åŒ–ã€é…ç½®ä»¥åŠåˆå§‹åŒ–ä¹‹åå¯¹å…¶è¿›è¡Œé¢å¤–å¤„ç†ã€‚å¸¸ç”¨äºä»£ç†beanã€ä¿®æ”¹beanå±æ€§ç­‰ã€‚</li><li>PropertySourceï¼šç”¨äºå®šä¹‰ä¸åŒçš„å±æ€§æºï¼Œå¦‚æ–‡ä»¶ã€æ•°æ®åº“ç­‰ï¼Œä»¥ä¾¿åœ¨Springåº”ç”¨ä¸­ä½¿ç”¨ã€‚</li><li>ImportSelectorå’ŒImportBeanDefinitionRegistrarï¼šç”¨äºæ ¹æ®æ¡ä»¶åŠ¨æ€æ³¨å†Œbeanå®šä¹‰ï¼Œå®ç°é…ç½®ç±»çš„æ¨¡å—åŒ–ã€‚</li><li>Spring MVCä¸­çš„HandlerInterceptorï¼šç”¨äºæ‹¦æˆªå¤„ç†è¯·æ±‚ï¼Œå¯ä»¥åœ¨è¯·æ±‚å¤„ç†å‰ã€å¤„ç†ä¸­å’Œå¤„ç†åæ‰§è¡Œç‰¹å®šé€»è¾‘ã€‚</li><li>Spring MVCä¸­çš„ControllerAdviceï¼šç”¨äºå…¨å±€å¤„ç†æ§åˆ¶å™¨çš„å¼‚å¸¸ã€æ•°æ®ç»‘å®šå’Œæ•°æ®æ ¡éªŒã€‚</li><li>Spring Bootçš„è‡ªåŠ¨é…ç½®ï¼šé€šè¿‡åˆ›å»ºè‡ªå®šä¹‰çš„è‡ªåŠ¨é…ç½®ç±»ï¼Œå¯ä»¥å®ç°å¯¹æ¡†æ¶å’Œç¬¬ä¸‰æ–¹åº“çš„è‡ªåŠ¨é…ç½®ã€‚</li><li>è‡ªå®šä¹‰æ³¨è§£ï¼šåˆ›å»ºè‡ªå®šä¹‰æ³¨è§£ï¼Œç”¨äºå®ç°ç‰¹å®šåŠŸèƒ½æˆ–çº¦å®šï¼Œå¦‚æƒé™æ§åˆ¶ã€æ—¥å¿—è®°å½•ç­‰ã€‚</li></ol><h1 id="MVC"><a href="#MVC" class="headerlink" title="MVC"></a>MVC</h1><h2 id="1-MVCåˆ†å±‚ä»‹ç»ä¸€ä¸‹"><a href="#1-MVCåˆ†å±‚ä»‹ç»ä¸€ä¸‹" class="headerlink" title="1.MVCåˆ†å±‚ä»‹ç»ä¸€ä¸‹"></a>1.MVCåˆ†å±‚ä»‹ç»ä¸€ä¸‹</h2><p>MVCå…¨åæ˜¯Model View Controllerï¼Œæ˜¯æ¨¡å‹(model)ï¼è§†å›¾(view)ï¼æ§åˆ¶å™¨(controller)çš„ç¼©å†™ï¼Œä¸€ç§è½¯ä»¶è®¾è®¡å…¸èŒƒï¼Œç”¨ä¸€ç§ä¸šåŠ¡é€»è¾‘ã€æ•°æ®ã€ç•Œé¢æ˜¾ç¤ºåˆ†ç¦»çš„æ–¹æ³•ç»„ç»‡ä»£ç ï¼Œå°†ä¸šåŠ¡é€»è¾‘èšé›†åˆ°ä¸€ä¸ªéƒ¨ä»¶é‡Œé¢ï¼Œåœ¨æ”¹è¿›å’Œä¸ªæ€§åŒ–å®šåˆ¶ç•Œé¢åŠç”¨æˆ·äº¤äº’çš„åŒæ—¶ï¼Œä¸éœ€è¦é‡æ–°ç¼–å†™ä¸šåŠ¡é€»è¾‘ã€‚</p><ul><li><strong>è§†å›¾(view)ï¼š ä¸ºç”¨æˆ·æä¾›ä½¿ç”¨ç•Œé¢ï¼Œä¸ç”¨æˆ·ç›´æ¥è¿›è¡Œäº¤äº’ã€‚</strong></li><li><strong>æ¨¡å‹(model)ï¼š ä»£è¡¨ä¸€ä¸ªå­˜å–æ•°æ®çš„å¯¹è±¡æˆ– JAVA POJOï¼ˆPlain Old Java Objectï¼Œç®€å•javaå¯¹è±¡ï¼‰ã€‚å®ƒä¹Ÿå¯ä»¥å¸¦æœ‰é€»è¾‘ï¼Œä¸»è¦ç”¨äºæ‰¿è½½æ•°æ®ï¼Œå¹¶å¯¹ç”¨æˆ·æäº¤è¯·æ±‚è¿›è¡Œè®¡ç®—çš„æ¨¡å—ã€‚æ¨¡å‹åˆ†ä¸ºä¸¤ç±»ï¼Œä¸€ç±»ç§°ä¸ºæ•°æ®æ‰¿è½½ Beanï¼Œä¸€ç±»ç§°ä¸ºä¸šåŠ¡å¤„ç†Beanã€‚æ‰€è°“æ•°æ®æ‰¿è½½ Bean æ˜¯æŒ‡å®ä½“ç±»ï¼ˆå¦‚ï¼šUserç±»ï¼‰ï¼Œä¸“é—¨ä¸ºç”¨æˆ·æ‰¿è½½ä¸šåŠ¡æ•°æ®çš„ï¼›è€Œä¸šåŠ¡å¤„ç† Bean åˆ™æ˜¯æŒ‡Service æˆ– Dao å¯¹è±¡ï¼Œ ä¸“é—¨ç”¨äºå¤„ç†ç”¨æˆ·æäº¤è¯·æ±‚çš„ã€‚</strong></li><li><strong>æ§åˆ¶å™¨(controller)ï¼š ç”¨äºå°†ç”¨æˆ·è¯·æ±‚è½¬å‘ç»™ç›¸åº”çš„ Model è¿›è¡Œå¤„ç†ï¼Œå¹¶æ ¹æ® Model çš„è®¡ç®—ç»“æœå‘ç”¨æˆ·æä¾›ç›¸åº”å“åº”ã€‚å®ƒä½¿è§†å›¾ä¸æ¨¡å‹åˆ†ç¦»ã€‚</strong></li></ul><p><img src="https://cdn.xiaolincoding.com//picgo/1713944902120-e35c2b4f-e290-4973-aa1a-3193af3bb371.png" alt="img"></p><p>æµç¨‹æ­¥éª¤ï¼š</p><ol><li><strong>ç”¨æˆ·é€šè¿‡View é¡µé¢å‘æœåŠ¡ç«¯æå‡ºè¯·æ±‚ï¼Œå¯ä»¥æ˜¯è¡¨å•è¯·æ±‚ã€è¶…é“¾æ¥è¯·æ±‚ã€AJAX è¯·æ±‚ç­‰ï¼›</strong></li><li><strong>æœåŠ¡ç«¯ Controller æ§åˆ¶å™¨æ¥æ”¶åˆ°è¯·æ±‚åå¯¹è¯·æ±‚è¿›è¡Œè§£æï¼Œæ‰¾åˆ°ç›¸åº”çš„Modelï¼Œå¯¹ç”¨æˆ·è¯·æ±‚è¿›è¡Œå¤„ç†Model å¤„ç†ï¼›</strong></li><li><strong>å°†å¤„ç†ç»“æœå†äº¤ç»™ Controllerï¼ˆæ§åˆ¶å™¨å…¶å®åªæ˜¯èµ·åˆ°äº†æ‰¿ä¸Šå¯ä¸‹çš„ä½œç”¨ï¼‰ï¼›</strong></li><li><strong>æ ¹æ®å¤„ç†ç»“æœæ‰¾åˆ°è¦ä½œä¸ºå‘å®¢æˆ·ç«¯å‘å›çš„å“åº”View é¡µé¢ï¼Œé¡µé¢ç»æ¸²æŸ“åå‘é€ç»™å®¢æˆ·ç«¯ã€‚</strong></li></ol><p>view-&gt;model-&gt;controller</p><h2 id="2-äº†è§£SpringMVCçš„å¤„ç†æµç¨‹å—ï¼Ÿ"><a href="#2-äº†è§£SpringMVCçš„å¤„ç†æµç¨‹å—ï¼Ÿ" class="headerlink" title="2.äº†è§£SpringMVCçš„å¤„ç†æµç¨‹å—ï¼Ÿ"></a>2.äº†è§£SpringMVCçš„å¤„ç†æµç¨‹å—ï¼Ÿ</h2><p><img src="https://cdn.xiaolincoding.com//picgo/1716791047520-ac0d9673-be0a-4005-8732-30bdedc8f1af.webp" alt="img"></p><p>Spring MVCçš„å·¥ä½œæµç¨‹å¦‚ä¸‹ï¼š</p><ol><li>ç”¨æˆ·å‘é€è¯·æ±‚è‡³å‰ç«¯æ§åˆ¶å™¨DispatcherServlet</li><li>DispatcherServletæ”¶åˆ°è¯·æ±‚è°ƒç”¨å¤„ç†å™¨æ˜ å°„å™¨HandlerMappingã€‚</li><li>å¤„ç†å™¨æ˜ å°„å™¨æ ¹æ®è¯·æ±‚urlæ‰¾åˆ°å…·ä½“çš„å¤„ç†å™¨ï¼Œç”Ÿæˆå¤„ç†å™¨æ‰§è¡Œé“¾HandlerExecutionChain(åŒ…æ‹¬å¤„ç†å™¨å¯¹è±¡å’Œå¤„ç†å™¨æ‹¦æˆªå™¨)ä¸€å¹¶è¿”å›ç»™DispatcherServletã€‚</li><li>DispatcherServletæ ¹æ®å¤„ç†å™¨Handlerè·å–å¤„ç†å™¨é€‚é…å™¨HandlerAdapteræ‰§è¡ŒHandlerAdapterå¤„ç†ä¸€ç³»åˆ—çš„æ“ä½œï¼Œå¦‚ï¼šå‚æ•°å°è£…ï¼Œæ•°æ®æ ¼å¼è½¬æ¢ï¼Œæ•°æ®éªŒè¯ç­‰æ“ä½œ</li><li>æ‰§è¡Œå¤„ç†å™¨Handler(Controllerï¼Œä¹Ÿå«é¡µé¢æ§åˆ¶å™¨)ã€‚</li><li>Handleræ‰§è¡Œå®Œæˆè¿”å›ModelAndView</li><li>HandlerAdapterå°†Handleræ‰§è¡Œç»“æœModelAndViewè¿”å›åˆ°DispatcherServlet</li><li>DispatcherServletå°†ModelAndViewä¼ ç»™ViewResloverè§†å›¾è§£æå™¨</li><li>ViewResloverè§£æåè¿”å›å…·ä½“View</li><li>DispatcherServletå¯¹Viewè¿›è¡Œæ¸²æŸ“è§†å›¾ï¼ˆå³å°†æ¨¡å‹æ•°æ®modelå¡«å……è‡³è§†å›¾ä¸­ï¼‰ã€‚</li><li>DispatcherServletå“åº”ç”¨æˆ·ã€‚</li></ol><p>è¯·æ±‚-&gt;å‰ç«¯æ§åˆ¶å™¨-&gt;mapping-&gt;è¿”å›æ‰§è¡Œé“¾ç»™å‰ç«¯æ§åˆ¶å™¨-&gt;è¯·æ±‚å¤„ç†å™¨é€‚é…å™¨-&gt;controller-&gt;è¿”å›modelview-&gt;å‰ç«¯æ§åˆ¶å™¨ç»™ä¼ è¾“ç»™è§†å›¾è§£æå™¨ï¼Œè§£æå®Œè¿”å›ç»™å‰ç«¯æ§åˆ¶å™¨-&gt;æ¸²æŸ“ä¸€ä¸‹åˆ°requeståŸŸ-&gt;å½¢æˆview</p><h2 id="3-Handlermapping-å’Œ-handleradapteræœ‰äº†è§£å—ï¼Ÿ"><a href="#3-Handlermapping-å’Œ-handleradapteræœ‰äº†è§£å—ï¼Ÿ" class="headerlink" title="3.Handlermapping å’Œ handleradapteræœ‰äº†è§£å—ï¼Ÿ"></a>3.Handlermapping å’Œ handleradapteræœ‰äº†è§£å—ï¼Ÿ</h2><p>HandlerMappingï¼š</p><ul><li><strong>ä½œç”¨</strong>ï¼šHandlerMapping<strong>è´Ÿè´£å°†è¯·æ±‚æ˜ å°„åˆ°å¤„ç†å™¨</strong>ï¼ˆControllerï¼‰ã€‚</li><li><strong>åŠŸèƒ½</strong>ï¼šæ ¹æ®è¯·æ±‚çš„URLã€è¯·æ±‚å‚æ•°ç­‰ä¿¡æ¯ï¼Œæ‰¾åˆ°å¤„ç†è¯·æ±‚çš„ Controllerã€‚</li><li><strong>ç±»å‹</strong>ï¼šSpringæä¾›äº†å¤šç§HandlerMappingå®ç°ï¼Œå¦‚BeanNameUrlHandlerMappingã€RequestMappingHandlerMappingç­‰ã€‚</li><li><strong>å·¥ä½œæµç¨‹</strong>ï¼šæ ¹æ®è¯·æ±‚ä¿¡æ¯ç¡®å®šè¦è¯·æ±‚çš„å¤„ç†å™¨(Controller)ã€‚HandlerMappingå¯ä»¥æ ¹æ®URLã€è¯·æ±‚å‚æ•°ç­‰è§„åˆ™ç¡®å®šå¯¹åº”çš„å¤„ç†å™¨ã€‚</li></ul><p>HandlerAdapterï¼š</p><ul><li><strong>ä½œç”¨</strong>ï¼šHandlerAdapterè´Ÿè´£<strong>è°ƒç”¨å¤„ç†å™¨(Controller)æ¥å¤„ç†è¯·æ±‚</strong>ã€‚</li><li><strong>åŠŸèƒ½</strong>ï¼šå¤„ç†å™¨(Controller)å¯èƒ½æœ‰ä¸åŒçš„æ¥å£ç±»å‹ï¼ˆControlleræ¥å£ã€HttpRequestHandleræ¥å£ç­‰ï¼‰ï¼ŒHandlerAdapteræ ¹æ®å¤„ç†å™¨çš„ç±»å‹æ¥é€‰æ‹©åˆé€‚çš„æ–¹æ³•æ¥è°ƒç”¨å¤„ç†å™¨ã€‚</li><li><strong>ç±»å‹</strong>ï¼šSpringæä¾›äº†å¤šä¸ªHandlerAdapterå®ç°ï¼Œç”¨äºé€‚é…ä¸åŒç±»å‹çš„å¤„ç†å™¨ã€‚</li><li><strong>å·¥ä½œæµç¨‹</strong>ï¼šæ ¹æ®å¤„ç†å™¨çš„æ¥å£ç±»å‹ï¼Œé€‰æ‹©ç›¸åº”çš„HandlerAdapteræ¥è°ƒç”¨å¤„ç†å™¨ã€‚</li></ul><p>å·¥ä½œæµç¨‹ï¼š</p><ol><li>å½“å®¢æˆ·ç«¯å‘é€è¯·æ±‚æ—¶ï¼ŒHandlerMappingæ ¹æ®è¯·æ±‚ä¿¡æ¯æ‰¾<strong>åˆ°å¯¹åº”çš„å¤„ç†å™¨</strong>(Controller)ã€‚</li><li>HandlerAdapteræ ¹æ®<strong>å¤„ç†å™¨çš„ç±»å‹é€‰æ‹©åˆé€‚çš„æ–¹æ³•æ¥è°ƒç”¨å¤„ç†å™¨ã€‚</strong></li><li>å¤„ç†å™¨æ‰§è¡Œç›¸åº”çš„ä¸šåŠ¡é€»è¾‘ï¼Œç”ŸæˆModelAndViewã€‚</li><li>HandlerAdapterå°†å¤„ç†å™¨çš„æ‰§è¡Œç»“æœåŒ…è£…æˆModelAndViewã€‚</li><li>è§†å›¾è§£æå™¨æ ¹æ®ModelAndViewæ‰¾åˆ°å¯¹åº”çš„è§†å›¾è¿›è¡Œæ¸²æŸ“ã€‚</li><li>å°†æ¸²æŸ“åçš„è§†å›¾è¿”å›ç»™å®¢æˆ·ç«¯ã€‚</li></ol><p>HandlerMappingå’ŒHandlerAdapterååŒå·¥ä½œï¼Œé€šè¿‡å°†è¯·æ±‚æ˜ å°„åˆ°å¤„ç†å™¨ï¼Œå¹¶è°ƒç”¨å¤„ç†å™¨æ¥å¤„ç†è¯·æ±‚ï¼Œå®ç°äº†è¯·æ±‚å¤„ç†çš„æµç¨‹ã€‚å®ƒä»¬çš„çµæ´»æ€§ä½¿å¾—åœ¨Spring MVCä¸­å¯ä»¥æ”¯æŒå¤šç§å¤„ç†å™¨å’Œå¤„ç†æ–¹å¼ï¼Œæé«˜äº†æ¡†æ¶çš„æ‰©å±•æ€§å’Œé€‚åº”æ€§ã€‚</p><h1 id="Springboot"><a href="#Springboot" class="headerlink" title="Springboot"></a>Springboot</h1><h2 id="1-ä¸ºä»€ä¹ˆä½¿ç”¨springboot"><a href="#1-ä¸ºä»€ä¹ˆä½¿ç”¨springboot" class="headerlink" title="1.ä¸ºä»€ä¹ˆä½¿ç”¨springboot"></a>1.ä¸ºä»€ä¹ˆä½¿ç”¨springboot</h2><ul><li>ç®€åŒ–å¼€å‘ï¼šSpring Booté€šè¿‡æä¾›ä¸€ç³»åˆ—çš„<strong>å¼€ç®±å³ç”¨çš„ç»„ä»¶å’Œè‡ªåŠ¨é…ç½®</strong>ï¼Œç®€åŒ–äº†é¡¹ç›®çš„é…ç½®å’Œå¼€å‘è¿‡ç¨‹ï¼Œå¼€å‘äººå‘˜å¯ä»¥æ›´ä¸“æ³¨äºä¸šåŠ¡é€»è¾‘çš„å®ç°ï¼Œè€Œä¸éœ€è¦èŠ±è´¹è¿‡å¤šæ—¶é—´åœ¨ç¹ççš„é…ç½®ä¸Šã€‚</li><li>å¿«é€Ÿå¯åŠ¨ï¼šSpring Bootæä¾›äº†å¿«é€Ÿçš„åº”ç”¨ç¨‹åºå¯åŠ¨æ–¹å¼ï¼Œ<strong>å¯é€šè¿‡å†…åµŒçš„Tomcatã€Jettyæˆ–Undertowç­‰å®¹å™¨å¿«é€Ÿå¯åŠ¨åº”ç”¨ç¨‹åº</strong>ï¼Œæ— éœ€é¢å¤–çš„éƒ¨ç½²æ­¥éª¤ï¼Œæ–¹ä¾¿å¿«æ·ã€‚</li><li>è‡ªåŠ¨åŒ–é…ç½®ï¼šSpring Booté€šè¿‡è‡ªåŠ¨é…ç½®åŠŸèƒ½ï¼Œæ ¹æ®<strong>é¡¹ç›®ä¸­çš„ä¾èµ–å…³ç³»å’Œçº¦å®šä¿—æˆçš„è§„åˆ™æ¥é…ç½®åº”ç”¨ç¨‹åº</strong>ï¼Œå‡å°‘äº†é…ç½®çš„å¤æ‚æ€§ï¼Œä½¿å¼€å‘è€…æ›´å®¹æ˜“å®ç°åº”ç”¨çš„æœ€ä½³å®è·µã€‚</li></ul><h2 id="2-SpringBootæ¯”Springå¥½åœ¨å“ªé‡Œ"><a href="#2-SpringBootæ¯”Springå¥½åœ¨å“ªé‡Œ" class="headerlink" title="2.SpringBootæ¯”Springå¥½åœ¨å“ªé‡Œ"></a>2.SpringBootæ¯”Springå¥½åœ¨å“ªé‡Œ</h2><ul><li>Spring Boot æä¾›äº†è‡ªåŠ¨åŒ–é…ç½®ï¼Œå¤§å¤§ç®€åŒ–äº†é¡¹ç›®çš„é…ç½®è¿‡ç¨‹ã€‚é€šè¿‡çº¦å®šä¼˜äºé…ç½®çš„åŸåˆ™ï¼Œå¾ˆå¤šå¸¸ç”¨çš„é…ç½®å¯ä»¥è‡ªåŠ¨å®Œæˆï¼Œå¼€å‘è€…å¯ä»¥ä¸“æ³¨äºä¸šåŠ¡é€»è¾‘çš„å®ç°ã€‚</li><li>Spring Boot æä¾›äº†å¿«é€Ÿçš„é¡¹ç›®å¯åŠ¨å™¨ï¼Œé€šè¿‡<strong>å¼•å…¥ä¸åŒçš„ Starterï¼Œå¯ä»¥å¿«é€Ÿé›†æˆå¸¸ç”¨çš„æ¡†æ¶å’Œåº“ï¼ˆå¦‚æ•°æ®åº“ã€æ¶ˆæ¯é˜Ÿåˆ—ã€Web å¼€å‘ç­‰ï¼‰</strong>ï¼Œæå¤§åœ°æé«˜äº†å¼€å‘æ•ˆç‡ã€‚</li><li>Spring Boot é»˜è®¤é›†æˆäº†<strong>å¤šç§å†…åµŒæœåŠ¡å™¨ï¼ˆå¦‚Tomcatã€Jettyã€Undertowï¼‰</strong>ï¼Œæ— éœ€é¢å¤–é…ç½®ï¼Œå³å¯å°†åº”ç”¨æ‰“åŒ…æˆå¯æ‰§è¡Œçš„ JAR æ–‡ä»¶ï¼Œæ–¹ä¾¿éƒ¨ç½²å’Œè¿è¡Œã€‚</li></ul><h2 id="3-SpringBootç”¨åˆ°å“ªäº›è®¾è®¡æ¨¡å¼ï¼Ÿ"><a href="#3-SpringBootç”¨åˆ°å“ªäº›è®¾è®¡æ¨¡å¼ï¼Ÿ" class="headerlink" title="3.SpringBootç”¨åˆ°å“ªäº›è®¾è®¡æ¨¡å¼ï¼Ÿ"></a>3.SpringBootç”¨åˆ°å“ªäº›è®¾è®¡æ¨¡å¼ï¼Ÿ</h2><ul><li><strong>ä»£ç†æ¨¡å¼</strong>ï¼šSpring çš„ AOP é€šè¿‡åŠ¨æ€ä»£ç†å®ç°æ–¹æ³•çº§åˆ«çš„åˆ‡é¢å¢å¼ºï¼Œæœ‰é™æ€å’ŒåŠ¨æ€ä¸¤ç§ä»£ç†æ–¹å¼ï¼Œé‡‡ç”¨åŠ¨æ€ä»£ç†æ–¹å¼ã€‚</li><li><strong>ç­–ç•¥æ¨¡å¼</strong>ï¼šSpring AOP æ”¯æŒ JDK å’Œ Cglib ä¸¤ç§åŠ¨æ€ä»£ç†å®ç°æ–¹å¼ï¼Œé€šè¿‡ç­–ç•¥æ¥å£å’Œä¸åŒç­–ç•¥ç±»ï¼Œè¿è¡Œæ—¶åŠ¨æ€é€‰æ‹©ï¼Œå…¶åˆ›å»ºä¸€èˆ¬é€šè¿‡å·¥å‚æ–¹æ³•å®ç°ã€‚</li><li><strong>è£…é¥°å™¨æ¨¡å¼</strong>ï¼šSpring ç”¨ TransactionAwareCacheDecorator è§£å†³ç¼“å­˜ä¸æ•°æ®åº“äº‹åŠ¡é—®é¢˜å¢åŠ å¯¹äº‹åŠ¡çš„æ”¯æŒã€‚</li><li><strong>å•ä¾‹æ¨¡å¼</strong>ï¼šSpring Bean <strong>é»˜è®¤æ˜¯å•ä¾‹æ¨¡å¼</strong>ï¼Œé€šè¿‡å•ä¾‹æ³¨å†Œè¡¨ï¼ˆå¦‚ HashMapï¼‰å®ç°ã€‚</li><li><strong>ç®€å•å·¥å‚æ¨¡å¼</strong>ï¼šSpring ä¸­çš„ BeanFactory æ˜¯ç®€å•å·¥å‚æ¨¡å¼çš„ä½“ç°ï¼Œé€šè¿‡å·¥å‚ç±»æ–¹æ³•è·å– Bean å®ä¾‹ã€‚</li><li><strong>å·¥å‚æ–¹æ³•æ¨¡å¼</strong>ï¼šSpringä¸­çš„ FactoryBean ä½“ç°å·¥å‚æ–¹æ³•æ¨¡å¼ï¼Œä¸ºä¸åŒäº§å“æä¾›ä¸åŒå·¥å‚ã€‚</li><li><strong>è§‚å¯Ÿè€…æ¨¡å¼</strong>ï¼šSpring è§‚å¯Ÿè€…æ¨¡å¼åŒ…å« <strong>Event äº‹ä»¶ã€Listener ç›‘å¬è€…ã€Publisher å‘é€è€…</strong>ï¼Œé€šè¿‡å®šä¹‰äº‹ä»¶ã€ç›‘å¬å™¨å’Œå‘é€è€…å®ç°ï¼Œè§‚å¯Ÿè€…æ³¨å†Œåœ¨ <strong>ApplicationContext ä¸­ï¼Œæ¶ˆæ¯å‘é€ç”± ApplicationEventMulticaster å®Œæˆã€‚</strong></li><li><strong>æ¨¡æ¿æ¨¡å¼</strong>ï¼šSpring Bean çš„åˆ›å»ºè¿‡ç¨‹æ¶‰åŠæ¨¡æ¿æ¨¡å¼ï¼Œä½“ç°æ‰©å±•æ€§ï¼Œç±»ä¼¼ Callback å›è°ƒå®ç°æ–¹å¼ã€‚</li><li><strong>é€‚é…å™¨æ¨¡å¼</strong>ï¼šSpring MVC ä¸­é’ˆå¯¹ä¸åŒæ–¹å¼å®šä¹‰çš„ Controllerï¼Œåˆ©ç”¨é€‚é…å™¨æ¨¡å¼ç»Ÿä¸€å‡½æ•°å®šä¹‰ï¼Œå®šä¹‰äº†ç»Ÿä¸€æ¥å£ HandlerAdapter åŠå¯¹åº”é€‚é…å™¨ç±»ã€‚</li></ul><h2 id="4-æ€ä¹ˆç†è§£SpringBootä¸­çš„çº¦å®šå¤§äºé…ç½®"><a href="#4-æ€ä¹ˆç†è§£SpringBootä¸­çš„çº¦å®šå¤§äºé…ç½®" class="headerlink" title="4.æ€ä¹ˆç†è§£SpringBootä¸­çš„çº¦å®šå¤§äºé…ç½®"></a>4.æ€ä¹ˆç†è§£SpringBootä¸­çš„çº¦å®šå¤§äºé…ç½®</h2><p>çº¦å®šå¤§äºé…ç½®æ˜¯Spring Bootçš„æ ¸å¿ƒè®¾è®¡ç†å¿µï¼Œå®ƒé€šè¿‡<strong>é¢„è®¾åˆç†çš„é»˜è®¤è¡Œä¸ºå’Œé¡¹ç›®è§„èŒƒ</strong>ï¼Œå¤§å¹…å‡å°‘å¼€å‘è€…éœ€è¦æ‰‹åŠ¨é…ç½®çš„æ­¥éª¤ï¼Œä»è€Œæå‡å¼€å‘æ•ˆç‡å’Œé¡¹ç›®æ ‡å‡†åŒ–ç¨‹åº¦ã€‚</p><p>ç†è§£ Spring Boot ä¸­çš„â€œçº¦å®šå¤§äºé…ç½®â€åŸåˆ™ï¼Œå¯ä»¥ä»ä»¥ä¸‹å‡ ä¸ªæ–¹é¢æ¥è§£é‡Šï¼š</p><ul><li><strong>è‡ªåŠ¨åŒ–é…ç½®</strong>ï¼šSpring Boot æä¾›äº†<strong>å¤§é‡çš„è‡ªåŠ¨åŒ–é…ç½®</strong>ï¼Œé€šè¿‡åˆ†æé¡¹ç›®çš„ä¾èµ–å’Œç¯å¢ƒï¼Œè‡ªåŠ¨é…ç½®åº”ç”¨ç¨‹åºçš„è¡Œä¸ºã€‚å¼€å‘è€…æ— éœ€æ˜¾å¼åœ°é…ç½®æ¯ä¸ªç»†èŠ‚ï¼Œå¤§éƒ¨åˆ†å¸¸ç”¨çš„é…ç½®éƒ½å·²ç»é¢„è®¾å¥½äº†ã€‚ä¾‹å¦‚ï¼Œå¼•å…¥<code>spring-boot-starter-web</code>åï¼ŒSpring Bootä¼šè‡ªåŠ¨é…ç½®å†…åµŒTomcatå’ŒSpring MVCï¼Œæ— éœ€æ‰‹åŠ¨ç¼–å†™XMLã€‚</li><li><strong>é»˜è®¤é…ç½®</strong>ï¼šSpring Boot ä¸ºè¯¸å¤šæ–¹é¢æä¾›<strong>å¤§é‡é»˜è®¤é…ç½®</strong>ï¼Œå¦‚è¿æ¥æ•°æ®åº“ã€è®¾ç½® Web æœåŠ¡å™¨ã€å¤„ç†æ—¥å¿—ç­‰ã€‚å¼€å‘äººå‘˜æ— éœ€æ‰‹åŠ¨é…ç½®è¿™äº›å¸¸è§å†…å®¹ï¼Œæ¡†æ¶å·²åšå¥½å†³ç­–ã€‚ä¾‹å¦‚ï¼Œé»˜è®¤çš„æ—¥å¿—é…ç½®å¯è®©åº”ç”¨ç¨‹åºå¿«é€Ÿè¾“å‡ºæ—¥å¿—ä¿¡æ¯ï¼Œæ— éœ€å¼€å‘è€…é¢å¤–ç¹çé…ç½®æ—¥å¿—çº§åˆ«ã€è¾“å‡ºæ ¼å¼ä¸ä½ç½®ç­‰ã€‚</li><li><strong>çº¦å®šçš„é¡¹ç›®ç»“æ„</strong>ï¼šSpring Boot æå€¡<strong>ç‰¹å®šé¡¹ç›®ç»“</strong>æ„ï¼Œé€šå¸¸ä¸»åº”ç”¨ç¨‹åºç±»ï¼ˆå« main æ–¹æ³•ï¼‰ç½®äºæ ¹åŒ…ï¼Œæ§åˆ¶å™¨ç±»ã€æœåŠ¡ç±»ã€æ•°æ®è®¿é—®ç±»ç­‰åˆ†åˆ«æ”¾åœ¨ç›¸åº”å­åŒ…ï¼Œå¦‚<code>com.example.demo.controller</code>æ”¾æ§åˆ¶å™¨ç±»ï¼Œ<code>com.example.demo.service</code>æ”¾æœåŠ¡ç±»ç­‰ã€‚æ­¤çº¦å®šä½¿å›¢é˜Ÿæˆå‘˜æ›´æ˜“ç†è§£é¡¹ç›®ç»“æ„ä¸ç»„ç»‡ï¼Œæ–°æˆå‘˜åŠ å…¥é¡¹ç›®æ—¶èƒ½å¿«é€Ÿå®šä½å„åŠŸèƒ½ä»£ç ä½ç½®ï¼Œæå‡åä½œæ•ˆç‡ã€‚</li></ul><h2 id="5-SpringBootçš„é¡¹ç›®ç»“æ„æ˜¯æ€ä¹ˆæ ·çš„ï¼Ÿ"><a href="#5-SpringBootçš„é¡¹ç›®ç»“æ„æ˜¯æ€ä¹ˆæ ·çš„ï¼Ÿ" class="headerlink" title="5.SpringBootçš„é¡¹ç›®ç»“æ„æ˜¯æ€ä¹ˆæ ·çš„ï¼Ÿ"></a>5.SpringBootçš„é¡¹ç›®ç»“æ„æ˜¯æ€ä¹ˆæ ·çš„ï¼Ÿ</h2><p>ä¸€ä¸ªæ­£å¸¸çš„ä¼ä¸šé¡¹ç›®é‡Œä¸€ç§é€šç”¨çš„é¡¹ç›®ç»“æ„å’Œä»£ç å±‚çº§åˆ’åˆ†çš„æŒ‡å¯¼æ„è§ã€‚æŒ‰è¿™ã€Šé˜¿é‡Œå·´å·´Javaå¼€å‘æ‰‹å†Œã€‹æ—¶æœ¬ä¹¦ä¸Šè¯´çš„ï¼Œä¸€èˆ¬åˆ†ä¸ºå¦‚ä¸‹å‡ å±‚ï¼š</p><p><img src="https://cdn.xiaolincoding.com//picgo/1721712085278-f25ffdd1-26bc-4a7c-928a-42e48501b285.png" alt="img"></p><ul><li>å¼€æ”¾æ¥å£å±‚ï¼šå¯ç›´æ¥<strong>å°è£… Service æ¥å£æš´éœ²æˆ RPC æ¥å£</strong>ï¼›é€šè¿‡ Web å°è£…æˆ http æ¥å£ï¼›ç½‘å…³æ§åˆ¶å±‚ç­‰ã€‚</li><li>ç»ˆç«¯æ˜¾ç¤ºå±‚ï¼šå„ä¸ªç«¯çš„æ¨¡æ¿æ¸²æŸ“å¹¶æ‰§è¡Œæ˜¾ç¤ºçš„å±‚ã€‚å½“å‰ä¸»è¦æ˜¯ velocity æ¸²æŸ“ï¼ŒJS æ¸²æŸ“ï¼ŒJSP æ¸²æŸ“ï¼Œç§»åŠ¨ç«¯å±•ç¤ºç­‰ã€‚</li><li>Web å±‚ï¼šä¸»è¦æ˜¯å¯¹è®¿é—®æ§åˆ¶è¿›è¡Œè½¬å‘ï¼Œå„ç±»åŸºæœ¬å‚æ•°æ ¡éªŒï¼Œæˆ–è€…ä¸å¤ç”¨çš„ä¸šåŠ¡ç®€å•å¤„ç†ç­‰ã€‚</li><li>Service å±‚ï¼šç›¸å¯¹å…·ä½“çš„ä¸šåŠ¡é€»è¾‘æœåŠ¡å±‚ã€‚</li><li>Manager å±‚ï¼šé€šç”¨ä¸šåŠ¡å¤„ç†å±‚ï¼Œå®ƒæœ‰å¦‚ä¸‹ç‰¹å¾ï¼š<ul><li>1ï¼‰å¯¹ç¬¬ä¸‰æ–¹å¹³å°å°è£…çš„å±‚ï¼Œé¢„å¤„ç†è¿”å›ç»“æœåŠè½¬åŒ–å¼‚å¸¸ä¿¡æ¯ï¼Œé€‚é…ä¸Šå±‚æ¥å£ã€‚</li><li>2ï¼‰å¯¹ Service å±‚é€šç”¨èƒ½åŠ›çš„ä¸‹æ²‰ï¼Œå¦‚ç¼“å­˜æ–¹æ¡ˆã€ä¸­é—´ä»¶é€šç”¨å¤„ç†ã€‚</li><li>3ï¼‰ä¸ DAO å±‚äº¤äº’ï¼Œå¯¹å¤šä¸ª DAO çš„ç»„åˆå¤ç”¨ã€‚</li></ul></li><li>DAO å±‚ï¼šæ•°æ®è®¿é—®å±‚ï¼Œä¸åº•å±‚ MySQLã€Oracleã€Hbaseã€OceanBase ç­‰è¿›è¡Œæ•°æ®äº¤äº’ã€‚</li><li>ç¬¬ä¸‰æ–¹æœåŠ¡ï¼šåŒ…æ‹¬å…¶å®ƒéƒ¨é—¨ RPC æœåŠ¡æ¥å£ï¼ŒåŸºç¡€å¹³å°ï¼Œå…¶å®ƒå…¬å¸çš„ HTTP æ¥å£ï¼Œå¦‚æ·˜å®å¼€æ”¾å¹³å°ã€æ”¯ä»˜å®ä»˜æ¬¾æœåŠ¡ã€é«˜å¾·åœ°å›¾æœåŠ¡ç­‰ã€‚</li><li>å¤–éƒ¨æ¥å£ï¼šå¤–éƒ¨ï¼ˆåº”ç”¨ï¼‰æ•°æ®å­˜å‚¨æœåŠ¡æä¾›çš„æ¥å£ï¼Œå¤šè§äºæ•°æ®è¿ç§»åœºæ™¯ä¸­ã€‚</li></ul><p>å¦‚æœä»ä¸€ä¸ªç”¨æˆ·è®¿é—®ä¸€ä¸ªç½‘ç«™çš„æƒ…å†µæ¥çœ‹ï¼Œå¯¹åº”ç€ä¸Šé¢çš„é¡¹ç›®ä»£ç ç»“æ„æ¥åˆ†æï¼Œå¯ä»¥è´¯ç©¿æ•´ä¸ªä»£ç åˆ†å±‚ï¼š</p><p><img src="https://cdn.xiaolincoding.com//picgo/1721712159282-79195670-9acf-4bfb-93b1-47d089a4bc1c.png" alt="img"></p><p>å¯¹åº”ä»£ç ç›®å½•çš„æµè½¬é€»è¾‘å°±æ˜¯ï¼š</p><p><img src="https://cdn.xiaolincoding.com//picgo/1721712166152-4774fdac-cb1e-4fb1-929e-3ae130145aa8.png" alt="img"></p><p>æ‰€ä»¥ï¼Œä»¥åæ¯å½“æˆ‘ä»¬æ‹¿åˆ°ä¸€ä¸ªæ–°çš„é¡¹ç›®åˆ°æ‰‹æ—¶ï¼Œåªè¦æŒ‰ç…§è¿™ä¸ªæ€è·¯å»çœ‹åˆ«äººé¡¹ç›®çš„ä»£ç ï¼Œåº”è¯¥åŸºæœ¬éƒ½æ˜¯èƒ½ç†å¾—é¡ºçš„</p><h2 id="6-SpringBootè‡ªåŠ¨è£…é…åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#6-SpringBootè‡ªåŠ¨è£…é…åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="6.SpringBootè‡ªåŠ¨è£…é…åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ"></a>6.SpringBootè‡ªåŠ¨è£…é…åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ</h2><blockquote><p>ä»€ä¹ˆæ˜¯è‡ªåŠ¨è£…é…ï¼Ÿ</p></blockquote><p>SpringBoot çš„è‡ªåŠ¨è£…é…åŸç†æ˜¯<strong>åŸºäºSpring Frameworkçš„æ¡ä»¶åŒ–é…ç½®å’Œ@EnableAutoConfigurationæ³¨è§£å®ç°çš„ã€‚</strong>è¿™ç§æœºåˆ¶å…è®¸å¼€å‘è€…åœ¨é¡¹ç›®ä¸­å¼•å…¥ç›¸å…³çš„ä¾èµ–ï¼ŒSpringBoot å°†æ ¹æ®è¿™äº›ä¾èµ–è‡ªåŠ¨é…ç½®åº”ç”¨ç¨‹åºçš„ä¸Šä¸‹æ–‡å’ŒåŠŸèƒ½ã€‚</p><p>SpringBoot å®šä¹‰äº†ä¸€å¥—æ¥å£è§„èŒƒï¼Œè¿™å¥—è§„èŒƒè§„å®šï¼šSpringBoot åœ¨å¯åŠ¨æ—¶ä¼šæ‰«æå¤–éƒ¨å¼•ç”¨ jar åŒ…ä¸­çš„META-INF/spring.factoriesæ–‡ä»¶ï¼Œå°†æ–‡ä»¶ä¸­é…ç½®çš„ç±»å‹ä¿¡æ¯åŠ è½½åˆ° Spring å®¹å™¨ï¼ˆæ­¤å¤„æ¶‰åŠåˆ° JVM ç±»åŠ è½½æœºåˆ¶ä¸ Spring çš„å®¹å™¨çŸ¥è¯†ï¼‰ï¼Œå¹¶æ‰§è¡Œç±»ä¸­å®šä¹‰çš„å„ç§æ“ä½œã€‚å¯¹äºå¤–éƒ¨ jar æ¥è¯´ï¼Œåªéœ€è¦æŒ‰ç…§ SpringBoot å®šä¹‰çš„æ ‡å‡†ï¼Œå°±èƒ½å°†è‡ªå·±çš„åŠŸèƒ½è£…ç½®è¿› SpringBootã€‚</p><p>é€šä¿—æ¥è®²ï¼Œ<strong>è‡ªåŠ¨è£…é…å°±æ˜¯é€šè¿‡æ³¨è§£æˆ–ä¸€äº›ç®€å•çš„é…ç½®å°±å¯ä»¥åœ¨SpringBootçš„å¸®åŠ©ä¸‹å¼€å¯å’Œé…ç½®å„ç§åŠŸèƒ½ï¼Œæ¯”å¦‚æ•°æ®åº“è®¿é—®ã€Webå¼€å‘ã€‚</strong></p><blockquote><p>SpringBootè‡ªåŠ¨è£…é…åŸç†</p></blockquote><p>é¦–å…ˆç‚¹è¿› <code>@SpringBootApplication</code> æ³¨è§£çš„å†…éƒ¨</p><p><img src="https://cdn.xiaolincoding.com//picgo/1719493065090-4ce24f82-8f39-4aa6-b399-671e68e9c18f.png" alt="img"></p><p>æ¥ä¸‹æ¥å°†é€ä¸ªè§£é‡Šè¿™äº›æ³¨è§£çš„ä½œç”¨ï¼š</p><ul><li><code>@Target(&#123;ElementType.TYPE&#125;)</code>: è¯¥æ³¨è§£æŒ‡å®šäº†è¿™ä¸ªæ³¨è§£å¯ä»¥ç”¨æ¥æ ‡è®°åœ¨ç±»ä¸Šã€‚åœ¨è¿™ä¸ªç‰¹å®šçš„ä¾‹å­ä¸­ï¼Œè¿™è¡¨ç¤ºè¯¥æ³¨è§£ç”¨äºæ ‡è®°é…ç½®ç±»ã€‚</li><li><code>@Retention(RetentionPolicy.RUNTIME)</code>: è¿™ä¸ªæ³¨è§£æŒ‡å®šäº†æ³¨è§£çš„ç”Ÿå‘½å‘¨æœŸï¼Œå³åœ¨è¿è¡Œæ—¶ä¿ç•™ã€‚è¿™æ˜¯å› ä¸º Spring Boot åœ¨è¿è¡Œæ—¶æ‰«æç±»è·¯å¾„ä¸Šçš„æ³¨è§£æ¥å®ç°è‡ªåŠ¨é…ç½®ï¼Œæ‰€ä»¥è¿™é‡Œä½¿ç”¨äº† RUNTIME ä¿ç•™ç­–ç•¥ã€‚</li><li><code>@Documented</code>: è¯¥æ³¨è§£è¡¨ç¤ºè¿™ä¸ªæ³¨è§£åº”è¯¥è¢«åŒ…å«åœ¨ Java æ–‡æ¡£ä¸­ã€‚å®ƒæ˜¯ç”¨äºç”Ÿæˆæ–‡æ¡£çš„æ ‡è®°ï¼Œä½¿å¼€å‘è€…èƒ½å¤Ÿçœ‹åˆ°è¿™ä¸ªæ³¨è§£çš„ç›¸å…³ä¿¡æ¯ã€‚</li><li><code>@Inherited</code>: è¿™ä¸ªæ³¨è§£æŒ‡ç¤ºä¸€ä¸ªè¢«æ ‡æ³¨çš„ç±»å‹æ˜¯è¢«ç»§æ‰¿çš„ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œå®ƒè¡¨æ˜è¿™ä¸ªæ³¨è§£å¯ä»¥è¢«ç»§æ‰¿ï¼Œå¦‚æœä¸€ä¸ªç±»ç»§æ‰¿äº†å¸¦æœ‰è¿™ä¸ªæ³¨è§£çš„ç±»ï¼Œå®ƒä¹Ÿä¼šç»§æ‰¿è¿™ä¸ªæ³¨è§£ã€‚</li><li><code>@SpringBootConfiguration</code>: è¿™ä¸ªæ³¨è§£è¡¨æ˜è¿™æ˜¯ä¸€ä¸ª Spring Boot é…ç½®ç±»ã€‚å¦‚æœç‚¹è¿›è¿™ä¸ªæ³¨è§£å†…éƒ¨ä¼šå‘ç°ä¸æ ‡å‡†çš„ @Configuration æ²¡å•¥åŒºåˆ«ï¼Œåªæ˜¯ä¸ºäº†è¡¨æ˜è¿™æ˜¯ä¸€ä¸ªä¸“é—¨ç”¨äº SpringBoot çš„é…ç½®ã€‚</li><li><code>@EnableAutoConfiguration</code>: è¿™ä¸ªæ³¨è§£æ˜¯ Spring Boot è‡ªåŠ¨è£…é…çš„æ ¸å¿ƒã€‚å®ƒå‘Šè¯‰ Spring oot å¯ç”¨è‡ªåŠ¨é…ç½®æœºåˆ¶ï¼Œæ ¹æ®é¡¹ç›®çš„ä¾èµ–å’Œé…ç½®è‡ªåŠ¨é…ç½®åº”ç”¨ç¨‹åºçš„ä¸Šä¸‹æ–‡ã€‚é€šè¿‡è¿™ä¸ªæ³¨è§£ï¼ŒSpringBoot å°†å°è¯•æ ¹æ®ç±»è·¯å¾„ä¸Šçš„ä¾èµ–è‡ªåŠ¨é…ç½®åº”ç”¨ç¨‹åºã€‚</li><li><code>@ComponentScan</code>: è¿™ä¸ªæ³¨è§£ç”¨äºé…ç½®ç»„ä»¶æ‰«æçš„è§„åˆ™ã€‚åœ¨è¿™é‡Œï¼Œå®ƒå‘Šè¯‰ SpringBoot åœ¨æŒ‡å®šçš„åŒ…åŠå…¶å­åŒ…ä¸­æŸ¥æ‰¾ç»„ä»¶ï¼Œè¿™äº›ç»„ä»¶åŒ…æ‹¬è¢«æ³¨è§£çš„ç±»ã€@Component æ³¨è§£çš„ç±»ç­‰ã€‚å…¶ä¸­çš„ excludeFilters å‚æ•°ç”¨äºæŒ‡å®šæ’é™¤å“ªäº›ç»„ä»¶ï¼Œè¿™é‡Œä½¿ç”¨äº†ä¸¤ä¸ªè‡ªå®šä¹‰çš„è¿‡æ»¤å™¨ï¼Œåˆ†åˆ«æ˜¯ TypeExcludeFilter å’Œ AutoConfigurationExcludeFilterã€‚</li></ul><p><strong><code>@EnableAutoConfiguration</code> è¿™ä¸ªæ³¨è§£æ˜¯å®ç°è‡ªåŠ¨è£…é…çš„æ ¸å¿ƒæ³¨è§£</strong></p><p><img src="https://cdn.xiaolincoding.com//picgo/1719495511568-bc5f9e21-9e2c-4888-91a8-4048058ff408.png" alt="img"></p><ul><li>@AutoConfigurationPackageï¼Œå°†é¡¹ç›®srcä¸­mainåŒ…ä¸‹çš„æ‰€æœ‰ç»„ä»¶æ³¨å†Œåˆ°å®¹å™¨ä¸­ï¼Œä¾‹å¦‚æ ‡æ³¨äº†Componentæ³¨è§£çš„ç±»ç­‰</li><li>@Import({AutoConfigurationImportSelector.class})ï¼Œæ˜¯è‡ªåŠ¨è£…é…çš„æ ¸å¿ƒï¼Œæ¥ä¸‹æ¥åˆ†æä¸€ä¸‹è¿™ä¸ªæ³¨è§£</li></ul><p>AutoConfigurationImportSelector æ˜¯ Spring Boot ä¸­ä¸€ä¸ªé‡è¦çš„ç±»ï¼Œå®ƒå®ç°äº† ImportSelector æ¥å£ï¼Œç”¨äºå®ç°è‡ªåŠ¨é…ç½®çš„é€‰æ‹©å’Œå¯¼å…¥ã€‚å…·ä½“æ¥è¯´ï¼Œå®ƒé€šè¿‡åˆ†æé¡¹ç›®çš„ç±»è·¯å¾„å’Œæ¡ä»¶æ¥å†³å®šåº”è¯¥å¯¼å…¥å“ªäº›è‡ªåŠ¨é…ç½®ç±»ã€‚</p><p>ä»£ç å¤ªå¤šï¼Œé€‰å–éƒ¨åˆ†ä¸»è¦åŠŸèƒ½çš„ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AutoConfigurationImportSelector</span> <span class="keyword">implements</span> <span class="title class_">DeferredImportSelector</span>, BeanClassLoaderAware,</span><br><span class="line">ResourceLoaderAware, BeanFactoryAware, EnvironmentAware, Ordered &#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ... ï¼ˆå…¶ä»–æ–¹æ³•å’Œå±æ€§ï¼‰</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// è·å–æ‰€æœ‰ç¬¦åˆæ¡ä»¶çš„ç±»çš„å…¨é™å®šç±»åï¼Œä¾‹å¦‚RedisTemplateçš„å…¨é™å®šç±»å(org.springframework.data.redis.core.RedisTemplate;)ï¼Œè¿™äº›ç±»éœ€è¦è¢«åŠ è½½åˆ° IoC å®¹å™¨ä¸­ã€‚</span></span><br><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">public</span> String[] selectImports(AnnotationMetadata annotationMetadata) &#123;</span><br><span class="line"><span class="comment">// æ‰«æç±»è·¯å¾„ä¸Šçš„ META-INF/spring.factories æ–‡ä»¶ï¼Œè·å–æ‰€æœ‰å®ç°äº† AutoConfiguration æ¥å£çš„è‡ªåŠ¨é…ç½®ç±»</span></span><br><span class="line">List&lt;String&gt; configurations = getCandidateConfigurations(annotationMetadata, attributes);</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¿‡æ»¤æ‰ä¸æ»¡è¶³æ¡ä»¶çš„è‡ªåŠ¨é…ç½®ç±»ï¼Œæ¯”å¦‚ä¸€äº›è‡ªåŠ¨è£…é…ç±»</span></span><br><span class="line">configurations = filter(configurations, annotationMetadata, attributes);</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ’åºè‡ªåŠ¨é…ç½®ç±»ï¼Œæ ¹æ® @AutoConfigureOrder å’Œ @AutoConfigureAfter/@AutoConfigureBefore æ³¨è§£æŒ‡å®šçš„é¡ºåº</span></span><br><span class="line">sort(configurations, annotationMetadata, attributes);</span><br><span class="line"></span><br><span class="line"><span class="comment">// å°†æ»¡è¶³æ¡ä»¶çš„è‡ªåŠ¨é…ç½®ç±»çš„ç±»åæ•°ç»„è¿”å›ï¼Œè¿™äº›ç±»å°†è¢«å¯¼å…¥åˆ°åº”ç”¨ç¨‹åºä¸Šä¸‹æ–‡ä¸­</span></span><br><span class="line"><span class="keyword">return</span> StringUtils.toStringArray(configurations);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ... ï¼ˆå…¶ä»–æ–¹æ³•ï¼‰</span></span><br><span class="line"><span class="keyword">protected</span> List&lt;String&gt; <span class="title function_">getCandidateConfigurations</span><span class="params">(AnnotationMetadata metadata, AnnotationAttributes attributes)</span> &#123;</span><br><span class="line"><span class="comment">// è·å–è‡ªåŠ¨é…ç½®ç±»çš„å€™é€‰åˆ—è¡¨ï¼Œä» META-INF/spring.factories æ–‡ä»¶ä¸­è¯»å–</span></span><br><span class="line"><span class="comment">// é€šè¿‡ç±»åŠ è½½å™¨åŠ è½½æ‰€æœ‰å€™é€‰ç±»</span></span><br><span class="line">List&lt;String&gt; configurations = SpringFactoriesLoader.loadFactoryNames(getSpringFactoriesLoaderFactoryClass(),</span><br><span class="line">getBeanClassLoader());</span><br><span class="line"></span><br><span class="line"><span class="comment">// è¿‡æ»¤å‡ºå®ç°äº† AutoConfiguration æ¥å£çš„è‡ªåŠ¨é…ç½®ç±»</span></span><br><span class="line">configurations = configurations.stream()</span><br><span class="line">.filter(<span class="built_in">this</span>::isEnabled)</span><br><span class="line">.collect(Collectors.toList());</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¯¹äº Spring Boot 1.x ç‰ˆæœ¬ï¼Œè¿˜éœ€è¦æ·»åŠ  spring-boot-autoconfigure åŒ…ä¸­çš„è‡ªåŠ¨é…ç½®ç±»</span></span><br><span class="line"><span class="comment">// configurations.addAll(getAutoConfigEntry(getAutoConfigurationEntry(metadata)));</span></span><br><span class="line"><span class="keyword">return</span> configurations;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ... ï¼ˆå…¶ä»–æ–¹æ³•ï¼‰</span></span><br><span class="line"><span class="keyword">protected</span> List&lt;String&gt; <span class="title function_">filter</span><span class="params">(List&lt;String&gt; configurations, AnnotationMetadata metadata,</span></span><br><span class="line"><span class="params">AnnotationAttributes attributes)</span> &#123;</span><br><span class="line"><span class="comment">// ä½¿ç”¨æ¡ä»¶åˆ¤æ–­æœºåˆ¶ï¼Œè¿‡æ»¤æ‰ä¸æ»¡è¶³æ¡ä»¶çš„è‡ªåŠ¨é…ç½®ç±»</span></span><br><span class="line">configurations = configurations.stream()</span><br><span class="line">.filter(configuration -&gt; isConfigurationCandidate(configuration, metadata, attributes))</span><br><span class="line">.collect(Collectors.toList());</span><br><span class="line"><span class="keyword">return</span> configurations;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ... ï¼ˆå…¶ä»–æ–¹æ³•ï¼‰</span></span><br><span class="line"><span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">sort</span><span class="params">(List&lt;String&gt; configurations, AnnotationMetadata metadata,</span></span><br><span class="line"><span class="params">AnnotationAttributes attributes)</span> &#123;</span><br><span class="line"><span class="comment">// æ ¹æ® @AutoConfigureOrder å’Œ @AutoConfigureAfter/@AutoConfigureBefore æ³¨è§£æŒ‡å®šçš„é¡ºåºå¯¹è‡ªåŠ¨é…ç½®ç±»è¿›è¡Œæ’åº</span></span><br><span class="line">configurations.sort((o1, o2) -&gt; &#123;</span><br><span class="line"><span class="type">int</span> <span class="variable">i1</span> <span class="operator">=</span> getAutoConfigurationOrder(o1, metadata, attributes);</span><br><span class="line"><span class="type">int</span> <span class="variable">i2</span> <span class="operator">=</span> getAutoConfigurationOrder(o2, metadata, attributes);</span><br><span class="line"><span class="keyword">return</span> Integer.compare(i1, i2);</span><br><span class="line">&#125;);</span><br><span class="line">&#125;</span><br><span class="line">  </span><br><span class="line">  <span class="comment">// ... ï¼ˆå…¶ä»–æ–¹æ³•ï¼‰</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¢³ç†ä¸€ä¸‹ï¼Œä»¥ä¸‹æ˜¯<code>AutoConfigurationImportSelector</code>çš„ä¸»è¦å·¥ä½œï¼š</p><ul><li>æ‰«æç±»è·¯å¾„: åœ¨åº”ç”¨ç¨‹åºå¯åŠ¨æ—¶ï¼Œ<code>AutoConfigurationImportSelector</code> ä¼šæ‰«æç±»è·¯å¾„ä¸Šçš„ <code>META-INF/spring.factories</code> æ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶ä¸­åŒ…å«äº†å„ç§ Spring é…ç½®å’Œæ‰©å±•çš„å®šä¹‰ã€‚åœ¨è¿™é‡Œï¼Œå®ƒä¼šæŸ¥æ‰¾æ‰€æœ‰å®ç°äº† <code>AutoConfiguration</code> æ¥å£çš„ç±»,å…·ä½“çš„å®ç°ä¸º<code>getCandidateConfigurations</code>æ–¹æ³•ã€‚</li><li>æ¡ä»¶åˆ¤æ–­: å¯¹äºæ¯ä¸€ä¸ªå‘ç°çš„è‡ªåŠ¨é…ç½®ç±»ï¼Œ<code>AutoConfigurationImportSelector</code> ä¼šä½¿ç”¨æ¡ä»¶åˆ¤æ–­æœºåˆ¶ï¼ˆé€šå¸¸æ˜¯é€šè¿‡ <code>@ConditionalOnXxx</code>æ³¨è§£ï¼‰æ¥ç¡®å®šæ˜¯å¦æ»¡è¶³å¯¼å…¥æ¡ä»¶ã€‚è¿™äº›æ¡ä»¶å¯ä»¥æ˜¯é…ç½®å±æ€§ã€ç±»æ˜¯å¦å­˜åœ¨ã€Beanæ˜¯å¦å­˜åœ¨ç­‰ç­‰ã€‚</li><li>æ ¹æ®æ¡ä»¶å¯¼å…¥è‡ªåŠ¨é…ç½®ç±»: æ»¡è¶³æ¡ä»¶çš„è‡ªåŠ¨é…ç½®ç±»å°†è¢«å¯¼å…¥åˆ°åº”ç”¨ç¨‹åºçš„ä¸Šä¸‹æ–‡ä¸­ã€‚è¿™æ„å‘³ç€å®ƒä»¬ä¼šè¢«å®ä¾‹åŒ–å¹¶åº”ç”¨äºåº”ç”¨ç¨‹åºçš„é…ç½®ã€‚</li></ul><h2 id="7-è¯´å‡ ä¸ªå¯åŠ¨å™¨ï¼ˆstarter-ï¼Ÿ"><a href="#7-è¯´å‡ ä¸ªå¯åŠ¨å™¨ï¼ˆstarter-ï¼Ÿ" class="headerlink" title="7.è¯´å‡ ä¸ªå¯åŠ¨å™¨ï¼ˆstarter)ï¼Ÿ"></a>7.è¯´å‡ ä¸ªå¯åŠ¨å™¨ï¼ˆstarter)ï¼Ÿ</h2><ul><li><strong>spring-boot-starter-web</strong>ï¼šè¿™æ˜¯æœ€å¸¸ç”¨çš„èµ·æ­¥ä¾èµ–ä¹‹ä¸€ï¼Œå®ƒåŒ…å«äº†Spring MVCå’ŒTomcatåµŒå…¥å¼æœåŠ¡å™¨ï¼Œç”¨äºå¿«é€Ÿæ„å»ºWebåº”ç”¨ç¨‹åºã€‚</li><li><strong>spring-boot-starter-security</strong>ï¼šæä¾›äº†<strong>Spring Security</strong>çš„åŸºæœ¬é…ç½®ï¼Œå¸®åŠ©å¼€å‘è€…å¿«é€Ÿå®ç°åº”ç”¨çš„å®‰å…¨æ€§ï¼ŒåŒ…æ‹¬è®¤è¯å’ŒæˆæƒåŠŸèƒ½ã€‚</li><li><strong>mybatis-spring-boot-starter</strong>ï¼šè¿™ä¸ªStarteræ˜¯ç”±MyBatiså›¢é˜Ÿæä¾›çš„ï¼Œç”¨äºç®€åŒ–åœ¨Spring Bootåº”ç”¨ä¸­é›†æˆMyBatisçš„è¿‡ç¨‹ã€‚å®ƒè‡ªåŠ¨é…ç½®äº†MyBatisçš„ç›¸å…³ç»„ä»¶ï¼ŒåŒ…æ‹¬SqlSessionFactoryã€MapperScannerConfigurerç­‰ï¼Œä½¿å¾—å¼€å‘è€…èƒ½å¤Ÿå¿«é€Ÿåœ°å¼€å§‹ä½¿ç”¨MyBatisè¿›è¡Œæ•°æ®åº“æ“ä½œã€‚</li><li><strong>spring-boot-starter-data-jpa</strong> æˆ– <strong>spring-boot-starter-jdbc</strong>ï¼šå¦‚æœä½¿ç”¨çš„æ˜¯Java Persistence API (JPA)è¿›è¡Œæ•°æ®åº“æ“ä½œï¼Œé‚£ä¹ˆåº”è¯¥ä½¿ç”¨spring-boot-starter-data-jpaã€‚è¿™ä¸ªStarteråŒ…å«äº†Hibernateç­‰JPAå®ç°ä»¥åŠæ•°æ®åº“è¿æ¥æ± ç­‰å¿…è¦çš„åº“ï¼Œå¯ä»¥è®©ä½ è½»æ¾åœ°ä¸MySQLæ•°æ®åº“è¿›è¡Œäº¤äº’ã€‚ä½ éœ€è¦åœ¨application.propertiesæˆ–application.ymlä¸­é…ç½®MySQLçš„è¿æ¥ä¿¡æ¯ã€‚å¦‚æœå€¾å‘äºç›´æ¥ä½¿ç”¨JDBCè€Œä¸é€šè¿‡JPAï¼Œé‚£ä¹ˆå¯ä»¥ä½¿ç”¨spring-boot-starter-jdbcï¼Œå®ƒæä¾›äº†åŸºæœ¬çš„JDBCæ”¯æŒã€‚</li><li><strong>spring-boot-starter-data-redis</strong>ï¼šç”¨äºé›†æˆRedisç¼“å­˜å’Œæ•°æ®å­˜å‚¨æœåŠ¡ã€‚è¿™ä¸ªStarteråŒ…å«äº†ä¸Redisäº¤äº’æ‰€éœ€çš„å®¢æˆ·ç«¯ï¼ˆé»˜è®¤æ˜¯Jediså®¢æˆ·ç«¯ï¼Œä¹Ÿå¯ä»¥é…ç½®ä¸ºLettuceå®¢æˆ·ç«¯ï¼‰ï¼Œä»¥åŠSpring Data Redisçš„æ”¯æŒï¼Œä½¿å¾—åœ¨Spring Bootåº”ç”¨ä¸­ä½¿ç”¨Rediså˜å¾—éå¸¸ä¾¿æ·ã€‚åŒæ ·åœ°ï¼Œéœ€è¦åœ¨é…ç½®æ–‡ä»¶ä¸­è®¾ç½®RedisæœåŠ¡å™¨çš„è¿æ¥è¯¦æƒ…ã€‚</li><li><strong>spring-boot-starter-test</strong>ï¼šåŒ…å«äº†å•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•æ‰€éœ€çš„åº“ï¼Œå¦‚JUnit, Spring Test, AssertJç­‰ï¼Œä¾¿äºè¿›è¡Œæµ‹è¯•é©±åŠ¨å¼€å‘(TDD)ã€‚</li></ul><h2 id="8-å†™è¿‡SpringBoot-starterå—"><a href="#8-å†™è¿‡SpringBoot-starterå—" class="headerlink" title="8.å†™è¿‡SpringBoot starterå—?"></a>8.å†™è¿‡SpringBoot starterå—?</h2><blockquote><p>æ­¥éª¤1: åˆ›å»ºMavené¡¹ç›®</p></blockquote><p>é¦–å…ˆï¼Œéœ€è¦åˆ›å»ºä¸€ä¸ªæ–°çš„Mavené¡¹ç›®ã€‚åœ¨pom.xmlä¸­æ·»åŠ Spring Bootçš„starter parentå’Œä¸€äº›å¿…è¦çš„ä¾èµ–ã€‚ä¾‹å¦‚ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&lt;parent&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-starter-parent&lt;/artifactId&gt;</span><br><span class="line">    &lt;version&gt;<span class="number">2.7</span><span class="number">.0</span>&lt;/version&gt;</span><br><span class="line">    &lt;relativePath/&gt; &lt;!-- lookup parent from repository --&gt;</span><br><span class="line">&lt;/parent&gt;</span><br><span class="line"></span><br><span class="line">&lt;dependencies&gt;</span><br><span class="line">    &lt;dependency&gt;</span><br><span class="line">        &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">        &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;</span><br><span class="line">    &lt;/dependency&gt;</span><br><span class="line">&lt;/dependencies&gt;</span><br></pre></td></tr></table></figure><blockquote><p>æ­¥éª¤2: æ·»åŠ è‡ªåŠ¨é…ç½®</p></blockquote><p><strong>åœ¨src/main/resources/META-INF/spring.factoriesä¸­æ·»åŠ è‡ªåŠ¨é…ç½®çš„å…ƒæ•°æ®</strong>ã€‚ä¾‹å¦‚ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">org.springframework.boot.autoconfigure.EnableAutoConfiguration = com.example.starter.MyAutoConfiguration</span><br></pre></td></tr></table></figure><p>ç„¶åï¼Œ<strong>åˆ›å»ºMyAutoConfigurationç±»ï¼Œè¯¥ç±»éœ€è¦@Configurationå’Œ@EnableConfigurationPropertiesæ³¨è§£</strong>ã€‚@EnableConfigurationPropertiesç”¨äºå¯ç”¨ä½ å®šä¹‰çš„é…ç½®å±æ€§ç±»ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableConfigurationProperties(MyProperties.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyAutoConfiguration</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> MyProperties properties;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="keyword">public</span> MyService <span class="title function_">myService</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">MyServiceImpl</span>(properties);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>æ­¥éª¤3: åˆ›å»ºé…ç½®å±æ€§ç±»</p></blockquote><p>åˆ›å»ºä¸€ä¸ªé…ç½®å±æ€§ç±»ï¼Œä½¿ç”¨@ConfigurationPropertiesæ³¨è§£æ¥ç»‘å®šé…ç½®æ–‡ä»¶ä¸­çš„å±æ€§ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;my&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyProperties</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="comment">// getters and setters</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>æ­¥éª¤4: åˆ›å»ºæœåŠ¡å’Œæ§åˆ¶å™¨</p></blockquote><p>åˆ›å»ºä¸€ä¸ªæœåŠ¡ç±»å’ŒæœåŠ¡å®ç°ç±»ï¼Œä»¥åŠä¸€ä¸ªæ§åˆ¶å™¨æ¥å±•ç¤ºä½ çš„starterçš„åŠŸèƒ½ã€‚</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">MyService</span> &#123;</span><br><span class="line">    String <span class="title function_">getName</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">MyService</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> MyProperties properties;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MyServiceImpl</span><span class="params">(MyProperties properties)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.properties = properties;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> properties.getName();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyController</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> MyService myService;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">MyController</span><span class="params">(MyService myService)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.myService = myService;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/name&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getName</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> myService.getName();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><blockquote><p>æ­¥éª¤5: å‘å¸ƒStarter</p></blockquote><p>å°†ä½ çš„starterå‘å¸ƒåˆ°Mavenä»“åº“ï¼Œæ— è®ºæ˜¯ç§æœ‰çš„è¿˜æ˜¯å…¬å…±çš„ï¼Œå¦‚Nexusæˆ–Maven Centralã€‚</p><blockquote><p>æ­¥éª¤6: ä½¿ç”¨Starter</p></blockquote><p>åœ¨ä½ çš„ä¸»åº”ç”¨çš„pom.xmlä¸­æ·»åŠ ä½ çš„starterä¾èµ–ï¼Œ<strong>ç„¶ååœ¨application.ymlæˆ–application.propertiesä¸­é…ç½®ä½ çš„å±æ€§ã€‚</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">my:</span><br><span class="line">    name: Hello World</span><br></pre></td></tr></table></figure><h2 id="9-SpringBooté‡Œé¢æœ‰å“ªäº›é‡è¦çš„æ³¨è§£ï¼Ÿè¿˜æœ‰ä¸€ä¸ªé…ç½®ç›¸å…³çš„æ³¨è§£æ˜¯å“ªä¸ªï¼Ÿ"><a href="#9-SpringBooté‡Œé¢æœ‰å“ªäº›é‡è¦çš„æ³¨è§£ï¼Ÿè¿˜æœ‰ä¸€ä¸ªé…ç½®ç›¸å…³çš„æ³¨è§£æ˜¯å“ªä¸ªï¼Ÿ" class="headerlink" title="9.SpringBooté‡Œé¢æœ‰å“ªäº›é‡è¦çš„æ³¨è§£ï¼Ÿè¿˜æœ‰ä¸€ä¸ªé…ç½®ç›¸å…³çš„æ³¨è§£æ˜¯å“ªä¸ªï¼Ÿ"></a>9.SpringBooté‡Œé¢æœ‰å“ªäº›é‡è¦çš„æ³¨è§£ï¼Ÿè¿˜æœ‰ä¸€ä¸ªé…ç½®ç›¸å…³çš„æ³¨è§£æ˜¯å“ªä¸ªï¼Ÿ</h2><p>Spring Boot ä¸­ä¸€äº›å¸¸ç”¨çš„æ³¨è§£åŒ…æ‹¬ï¼š</p><ul><li><strong>@SpringBootApplication</strong>ï¼šç”¨äºæ ‡æ³¨ä¸»åº”ç”¨ç¨‹åºç±»ï¼Œæ ‡è¯†ä¸€ä¸ªSpring Bootåº”ç”¨ç¨‹åºçš„å…¥å£ç‚¹ï¼ŒåŒæ—¶å¯ç”¨è‡ªåŠ¨é…ç½®å’Œç»„ä»¶æ‰«æã€‚</li><li><strong>@Controller</strong>ï¼šæ ‡è¯†æ§åˆ¶å™¨ç±»ï¼Œå¤„ç†HTTPè¯·æ±‚ã€‚</li><li><strong>@RestController</strong>ï¼šç»“åˆ@Controllerå’Œ@ResponseBodyï¼Œè¿”å›RESTfulé£æ ¼çš„æ•°æ®ã€‚</li><li><strong>@Service</strong>ï¼šæ ‡è¯†æœåŠ¡ç±»ï¼Œé€šå¸¸ç”¨äºæ ‡è®°ä¸šåŠ¡é€»è¾‘å±‚ã€‚</li><li><strong>@Repository</strong>ï¼šæ ‡è¯†æ•°æ®è®¿é—®ç»„ä»¶ï¼Œé€šå¸¸ç”¨äºæ ‡è®°æ•°æ®è®¿é—®å±‚ã€‚</li><li><strong>@Component</strong>ï¼šé€šç”¨çš„Springç»„ä»¶æ³¨è§£ï¼Œè¡¨ç¤ºä¸€ä¸ªå—Springç®¡ç†çš„ç»„ä»¶ã€‚</li><li><strong>@Autowired</strong>ï¼šç”¨äºè‡ªåŠ¨è£…é…Spring Beanã€‚</li><li><strong>@Value</strong>ï¼šç”¨äºæ³¨å…¥é…ç½®å±æ€§å€¼ã€‚</li><li><strong>@RequestMapping</strong>ï¼šç”¨äºæ˜ å°„HTTPè¯·æ±‚è·¯å¾„åˆ°Controllerçš„å¤„ç†æ–¹æ³•ã€‚</li><li><strong>@GetMapping</strong>ã€@PostMappingã€@PutMappingã€@DeleteMappingï¼šç®€åŒ–@RequestMappingçš„GETã€POSTã€PUTå’ŒDELETEè¯·æ±‚ã€‚</li></ul><p>å¦å¤–ï¼Œä¸€ä¸ªä¸é…ç½®ç›¸å…³çš„é‡è¦æ³¨è§£æ˜¯ï¼š</p><ul><li><strong>@Configuration</strong>ï¼šç”¨äºæŒ‡å®šä¸€ä¸ªç±»ä¸ºé…ç½®ç±»ï¼Œå…¶ä¸­å®šä¹‰çš„beanä¼šè¢«Springå®¹å™¨ç®¡ç†ã€‚<strong>é€šå¸¸ä¸@Beané…åˆä½¿ç”¨ï¼Œ@Beanç”¨äºå£°æ˜ä¸€ä¸ªBeanå®ä¾‹ï¼Œç”±Springå®¹å™¨è¿›è¡Œç®¡ç†ã€‚</strong></li></ul><h2 id="10-springbootæ€ä¹ˆå¼€å¯äº‹åŠ¡ï¼Ÿ"><a href="#10-springbootæ€ä¹ˆå¼€å¯äº‹åŠ¡ï¼Ÿ" class="headerlink" title="10.springbootæ€ä¹ˆå¼€å¯äº‹åŠ¡ï¼Ÿ"></a>10.springbootæ€ä¹ˆå¼€å¯äº‹åŠ¡ï¼Ÿ</h2><p>åœ¨ Spring Boot ä¸­å¼€å¯äº‹åŠ¡éå¸¸ç®€å•ï¼Œåªéœ€åœ¨æœåŠ¡å±‚çš„æ–¹æ³•ä¸Šæ·»åŠ  <code>@Transactional</code> æ³¨è§£å³å¯ã€‚</p><p>ä¾‹å¦‚ï¼Œå‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ª UserService æ¥å£ï¼Œå…¶ä¸­æœ‰ä¸€ä¸ªä¿å­˜ç”¨æˆ·çš„æ–¹æ³• saveUser()ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">saveUser</span><span class="params">(User user)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å¸Œæœ›åœ¨è¿™ä¸ªæ–¹æ³•ä¸­å¼€å¯äº‹åŠ¡ï¼Œåªéœ€åœ¨è¯¥æ–¹æ³•ä¸Šæ·»åŠ  <code>@Transactional</code> æ³¨è§£ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserServiceImpl</span> <span class="keyword">implements</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> UserRepository userRepository;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">saveUser</span><span class="params">(User user)</span> &#123;</span><br><span class="line">        userRepository.save(user);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·ï¼Œå½“è°ƒç”¨ saveUser() æ–¹æ³•æ—¶ï¼ŒSpring å°±ä¼šè‡ªåŠ¨ä¸ºè¯¥æ–¹æ³•å¼€å¯ä¸€ä¸ªäº‹åŠ¡ã€‚<strong>å¦‚æœæ–¹æ³•æ‰§è¡ŒæˆåŠŸï¼Œäº‹åŠ¡ä¼šè‡ªåŠ¨æäº¤ï¼›å¦‚æœæ–¹æ³•æ‰§è¡Œå¤±è´¥ï¼Œäº‹åŠ¡ä¼šè‡ªåŠ¨å›æ»šã€‚</strong></p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure><h2 id="11-Springbootæ€ä¹ˆåšåˆ°å¯¼å…¥å°±å¯ä»¥ç›´æ¥ä½¿ç”¨çš„ï¼Ÿ"><a href="#11-Springbootæ€ä¹ˆåšåˆ°å¯¼å…¥å°±å¯ä»¥ç›´æ¥ä½¿ç”¨çš„ï¼Ÿ" class="headerlink" title="11.Springbootæ€ä¹ˆåšåˆ°å¯¼å…¥å°±å¯ä»¥ç›´æ¥ä½¿ç”¨çš„ï¼Ÿ"></a>11.Springbootæ€ä¹ˆåšåˆ°å¯¼å…¥å°±å¯ä»¥ç›´æ¥ä½¿ç”¨çš„ï¼Ÿ</h2><p>è¿™ä¸ªä¸»è¦ä¾èµ–äºè‡ªåŠ¨é…ç½®ã€èµ·æ­¥ä¾èµ–å’Œæ¡ä»¶æ³¨è§£ç­‰ç‰¹æ€§ã€‚</p><blockquote><p>èµ·æ­¥ä¾èµ–</p></blockquote><p>èµ·æ­¥ä¾èµ–æ˜¯ä¸€ç§ç‰¹æ®Šçš„ Maven æˆ– Gradle ä¾èµ–ï¼Œå®ƒå°†<strong>é¡¹ç›®æ‰€éœ€çš„ä¸€ç³»åˆ—ä¾èµ–æ‰“åŒ…åœ¨ä¸€èµ·ã€‚ä¾‹å¦‚ï¼Œ<code>spring-boot-starter-web</code> è¿™ä¸ªèµ·æ­¥ä¾èµ–å°±åŒ…å«äº† Spring Web MVCã€Tomcat ç­‰æ„å»º Web åº”ç”¨æ‰€éœ€çš„æ ¸å¿ƒä¾èµ–ã€‚</strong></p><p>å¼€å‘è€…åªéœ€åœ¨é¡¹ç›®ä¸­æ·»åŠ ä¸€ä¸ªèµ·æ­¥ä¾èµ–ï¼ŒMaven æˆ– Gradle å°±ä¼šè‡ªåŠ¨ä¸‹è½½å¹¶ç®¡ç†ä¸ä¹‹å…³è”çš„æ‰€æœ‰ä¾èµ–ï¼Œé¿å…äº†æ‰‹åŠ¨æ·»åŠ å¤§é‡ä¾èµ–çš„ç¹çè¿‡ç¨‹ã€‚</p><p>æ¯”å¦‚ï¼Œåœ¨ <code>pom.xml</code> ä¸­æ·»åŠ  <code>spring-boot-starter-web</code> ä¾èµ–ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.springframework.boot&lt;/groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;spring-boot-starter-web&lt;/artifactId&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure><blockquote><p>è‡ªåŠ¨é…ç½®</p></blockquote><p>Spring Boot çš„è‡ªåŠ¨é…ç½®æœºåˆ¶ä¼šæ ¹æ®ç±»è·¯å¾„ä¸‹çš„ä¾èµ–å’Œå¼€å‘è€…çš„é…ç½®ï¼Œè‡ªåŠ¨åˆ›å»ºå’Œé…ç½®åº”ç”¨æ‰€éœ€çš„ Beanã€‚<strong>å®ƒé€šè¿‡ <code>@EnableAutoConfiguration</code> æ³¨è§£å¯ç”¨</strong>ï¼Œ<strong>è¯¥æ³¨è§£ä¼šè§¦å‘ Spring Boot å»æŸ¥æ‰¾ <code>META - INF/spring.factories</code> æ–‡ä»¶ã€‚</strong></p><p><code>spring.factories</code> æ–‡ä»¶ä¸­å®šä¹‰äº†ä¸€ç³»åˆ—è‡ªåŠ¨é…ç½®ç±»ï¼ŒSpring Boot ä¼šæ ¹æ®å½“å‰é¡¹ç›®çš„ä¾èµ–æƒ…å†µï¼Œé€‰æ‹©åˆé€‚çš„è‡ªåŠ¨é…ç½®ç±»è¿›è¡ŒåŠ è½½ã€‚ä¾‹å¦‚ï¼Œå¦‚æœé¡¹ç›®ä¸­åŒ…å« <code>spring-boot-starter-web</code> ä¾èµ–ï¼ŒSpring Boot ä¼šåŠ è½½ <code>WebMvcAutoConfiguration</code> ç±»ï¼Œè¯¥ç±»ä¼šè‡ªåŠ¨é…ç½® Spring MVC çš„ç›¸å…³ç»„ä»¶ï¼Œå¦‚ DispatcherServletã€è§†å›¾è§£æå™¨ç­‰ã€‚</p><p>å¼€å‘è€…å¯ä»¥é€šè¿‡è‡ªå®šä¹‰é…ç½®æ¥è¦†ç›–è‡ªåŠ¨é…ç½®çš„é»˜è®¤è¡Œä¸ºã€‚å¦‚æœå¼€å‘è€…åœ¨ <code>application.properties</code> æˆ– <code>application.yml</code> ä¸­å®šä¹‰äº†ç‰¹å®šçš„é…ç½®ï¼Œæˆ–è€…åœ¨ä»£ç ä¸­å®šä¹‰äº†åŒåçš„ Beanï¼ŒSpring Boot ä¼šä¼˜å…ˆä½¿ç”¨å¼€å‘è€…çš„é…ç½®ã€‚</p><blockquote><p>æ¡ä»¶æ³¨è§£</p></blockquote><p>æ¡ä»¶æ³¨è§£ç”¨äºæ§åˆ¶ Bean çš„åˆ›å»ºå’ŒåŠ è½½ï¼Œåªæœ‰åœ¨æ»¡è¶³ç‰¹å®šæ¡ä»¶æ—¶ï¼Œæ‰ä¼šåˆ›å»ºç›¸åº”çš„ Beanã€‚Spring Boot çš„è‡ªåŠ¨é…ç½®ç±»ä¸­å¹¿æ³›ä½¿ç”¨äº†æ¡ä»¶æ³¨è§£ï¼Œ<strong>å¦‚ <code>@ConditionalOnClass</code>ã€<code>@ConditionalOnMissingBean</code> ç­‰ã€‚</strong></p><p>æ¯”å¦‚ï¼Œ<code>@ConditionalOnClass</code> è¡¨ç¤ºåªæœ‰å½“ç±»è·¯å¾„ä¸­å­˜åœ¨æŒ‡å®šçš„ç±»æ—¶ï¼Œæ‰ä¼šåˆ›å»ºè¯¥ Beanã€‚ä¾‹å¦‚ï¼Œåœ¨ <code>WebMvcAutoConfiguration</code> ç±»ä¸­ï¼Œå¯èƒ½ä¼šæœ‰å¦‚ä¸‹ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ConditionalOnClass(&#123; Servlet.class, DispatcherServlet.class, WebMvcConfigurer.class &#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">WebMvcAutoConfiguration</span> &#123;</span><br><span class="line">    <span class="comment">// é…ç½®ç›¸å…³çš„ Bean</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ®µä»£ç è¡¨ç¤ºåªæœ‰å½“ç±»è·¯å¾„ä¸­å­˜åœ¨ <code>Servlet</code>ã€<code>DispatcherServlet</code> å’Œ <code>WebMvcConfigurer</code> ç±»æ—¶ï¼Œæ‰ä¼šåŠ è½½ <code>WebMvcAutoConfiguration</code> ç±»ä¸­çš„é…ç½®ã€‚</p><h2 id="12-SpringBoot-è¿‡æ»¤å™¨å’Œæ‹¦æˆªå™¨è¯´ä¸€ä¸‹ï¼Ÿ"><a href="#12-SpringBoot-è¿‡æ»¤å™¨å’Œæ‹¦æˆªå™¨è¯´ä¸€ä¸‹ï¼Ÿ" class="headerlink" title="12.SpringBoot è¿‡æ»¤å™¨å’Œæ‹¦æˆªå™¨è¯´ä¸€ä¸‹ï¼Ÿ"></a>12.SpringBoot è¿‡æ»¤å™¨å’Œæ‹¦æˆªå™¨è¯´ä¸€ä¸‹ï¼Ÿ</h2><p>åœ¨ Spring Boot ä¸­ï¼Œè¿‡æ»¤å™¨ï¼ˆFilterï¼‰å’Œæ‹¦æˆªå™¨ï¼ˆInterceptorï¼‰æ˜¯ç”¨äºå¤„ç†è¯·æ±‚å’Œå“åº”çš„ä¸¤ç§ä¸åŒæœºåˆ¶ã€‚</p><div class="table-container"><table><thead><tr><th><strong>ç‰¹æ€§</strong></th><th><strong>è¿‡æ»¤å™¨ï¼ˆFilterï¼‰</strong></th><th><strong>æ‹¦æˆªå™¨ï¼ˆInterceptorï¼‰</strong></th></tr></thead><tbody><tr><td><strong>è§„èŒƒ/æ¡†æ¶</strong></td><td>Servletè§„èŒƒï¼ˆ<code>javax.servlet.Filter</code>ï¼‰</td><td>Spring MVCæ¡†æ¶ï¼ˆ<code>org.springframework.web.servlet.HandlerInterceptor</code>ï¼‰</td></tr><tr><td><strong>ä½œç”¨èŒƒå›´</strong></td><td>å…¨å±€ï¼ˆæ‰€æœ‰è¯·æ±‚ã€é™æ€èµ„æºï¼‰</td><td>Controllerå±‚ï¼ˆä»…æ‹¦æˆªSpringç®¡ç†çš„è¯·æ±‚ï¼‰</td></tr><tr><td><strong>æ‰§è¡Œé¡ºåº</strong></td><td>åœ¨Servletä¹‹å‰æ‰§è¡Œ</td><td>åœ¨DispatcherServletä¹‹åã€Controlleræ–¹æ³•å‰åæ‰§è¡Œ</td></tr><tr><td><strong>ä¾èµ–æ³¨å…¥æ”¯æŒ</strong></td><td>æ— æ³•ç›´æ¥æ³¨å…¥Spring Beanï¼ˆéœ€é—´æ¥è·å–ï¼‰</td><td>æ”¯æŒè‡ªåŠ¨æ³¨å…¥Spring Bean</td></tr><tr><td><strong>è§¦å‘æ—¶æœº</strong></td><td><code>doFilter()</code>åœ¨è¯·æ±‚å‰/å“åº”åè¢«è°ƒç”¨</td><td><code>preHandle</code>ã€<code>postHandle</code>ã€<code>afterCompletion</code>åˆ†é˜¶æ®µè§¦å‘</td></tr><tr><td><strong>é€‚ç”¨åœºæ™¯</strong></td><td>å…¨å±€è¯·æ±‚å¤„ç†ï¼ˆç¼–ç ã€æ—¥å¿—ã€å®‰å…¨ï¼‰</td><td>ä¸šåŠ¡é€»è¾‘ç›¸å…³çš„å¤„ç†ï¼ˆæƒé™ã€å‚æ•°æ ¡éªŒï¼‰</td></tr></tbody></table></div><p>è¿‡æ»¤å™¨æ˜¯ Java Servlet è§„èŒƒä¸­çš„ä¸€éƒ¨åˆ†ï¼Œ<strong>å®ƒå¯ä»¥å¯¹è¿›å…¥ Servlet å®¹å™¨çš„è¯·æ±‚å’Œå“åº”è¿›è¡Œé¢„å¤„ç†å’Œåå¤„ç†ã€‚è¿‡æ»¤å™¨é€šè¿‡å®ç° <code>javax.servlet.Filter</code> æ¥å£ï¼Œå¹¶é‡å†™å…¶ä¸­çš„ <code>init</code>ã€<code>doFilter</code> å’Œ <code>destroy</code> æ–¹æ³•æ¥å®Œæˆç›¸åº”çš„é€»è¾‘ã€‚</strong>å½“è¯·æ±‚è¿›å…¥ Servlet å®¹å™¨æ—¶ï¼Œä¼šæŒ‰ç…§é…ç½®çš„é¡ºåºä¾æ¬¡ç»è¿‡å„ä¸ªè¿‡æ»¤å™¨ï¼Œç„¶åå†åˆ°è¾¾ç›®æ ‡ Servlet æˆ–æ§åˆ¶å™¨ï¼›å“åº”è¿”å›æ—¶ï¼Œä¹Ÿä¼šæŒ‰ç…§ç›¸åçš„é¡ºåºå†æ¬¡ç»è¿‡è¿™äº›è¿‡æ»¤å™¨ã€‚</p><p>æ‹¦æˆªå™¨æ˜¯ Spring æ¡†æ¶æä¾›çš„ä¸€ç§æœºåˆ¶ï¼Œå®ƒå¯ä»¥å¯¹æ§åˆ¶å™¨æ–¹æ³•çš„æ‰§è¡Œè¿›è¡Œæ‹¦æˆªã€‚<strong>æ‹¦æˆªå™¨é€šè¿‡å®ç° <code>org.springframework.web.servlet.HandlerInterceptor</code> æ¥å£ï¼Œå¹¶é‡å†™å…¶ä¸­çš„ <code>preHandle</code>ã€<code>postHandle</code> å’Œ <code>afterCompletion</code> æ–¹æ³•æ¥å®Œæˆç›¸åº”çš„é€»è¾‘ã€‚</strong>å½“è¯·æ±‚åˆ°è¾¾æ§åˆ¶å™¨æ—¶ï¼Œä¼šå…ˆç»è¿‡æ‹¦æˆªå™¨çš„ <code>preHandle</code> æ–¹æ³•ï¼Œå¦‚æœè¯¥æ–¹æ³•è¿”å› <code>true</code>ï¼Œåˆ™ç»§ç»­æ‰§è¡Œåç»­çš„æ§åˆ¶å™¨æ–¹æ³•å’Œå…¶ä»–æ‹¦æˆªå™¨ï¼›åœ¨æ§åˆ¶å™¨æ–¹æ³•æ‰§è¡Œå®Œæˆåï¼Œä¼šè°ƒç”¨æ‹¦æˆªå™¨çš„ <code>postHandle</code> æ–¹æ³•ï¼›æœ€åï¼Œåœ¨è¯·æ±‚å¤„ç†å®Œæˆåï¼Œä¼šè°ƒç”¨æ‹¦æˆªå™¨çš„ <code>afterCompletion</code> æ–¹æ³•ã€‚</p><p>è¿‡æ»¤å™¨å’Œæ‹¦æˆªå™¨çš„åŒºåˆ«å¦‚ä¸‹ï¼š</p><ul><li><strong>æ‰€å±è§„èŒƒ</strong>ï¼šè¿‡æ»¤å™¨æ˜¯ Java Servlet è§„èŒƒçš„ä¸€éƒ¨åˆ†ï¼Œè€Œæ‹¦æˆªå™¨æ˜¯ Spring æ¡†æ¶æä¾›çš„æœºåˆ¶ã€‚</li><li><strong>æ‰§è¡Œé¡ºåº</strong>ï¼šè¿‡æ»¤å™¨åœ¨è¯·æ±‚è¿›å…¥ Servlet å®¹å™¨åï¼Œåœ¨åˆ°è¾¾ç›®æ ‡ Servlet æˆ–æ§åˆ¶å™¨ä¹‹å‰æ‰§è¡Œï¼›æ‹¦æˆªå™¨åœ¨è¯·æ±‚åˆ°è¾¾æ§åˆ¶å™¨ä¹‹åï¼Œåœ¨æ§åˆ¶å™¨æ–¹æ³•æ‰§è¡Œå‰åæ‰§è¡Œã€‚</li><li><strong>ä½¿ç”¨èŒƒå›´</strong>ï¼šè¿‡æ»¤å™¨å¯ä»¥å¯¹æ‰€æœ‰ç±»å‹çš„è¯·æ±‚è¿›è¡Œè¿‡æ»¤ï¼ŒåŒ…æ‹¬é™æ€èµ„æºè¯·æ±‚ï¼›æ‹¦æˆªå™¨åªèƒ½å¯¹ Spring MVC æ§åˆ¶å™¨çš„è¯·æ±‚è¿›è¡Œæ‹¦æˆªã€‚</li><li><strong>åŠŸèƒ½ç‰¹æ€§</strong>ï¼šè¿‡æ»¤å™¨ä¸»è¦ç”¨äºå¯¹è¯·æ±‚å’Œå“åº”è¿›è¡Œé¢„å¤„ç†å’Œåå¤„ç†ï¼Œå¦‚å­—ç¬¦ç¼–ç å¤„ç†ã€è¯·æ±‚æ—¥å¿—è®°å½•ç­‰ï¼›æ‹¦æˆªå™¨å¯ä»¥æ›´ç»†ç²’åº¦åœ°æ§åˆ¶æ§åˆ¶å™¨æ–¹æ³•çš„æ‰§è¡Œï¼Œå¦‚æƒé™éªŒè¯ã€æ€§èƒ½ç›‘æ§ç­‰ã€‚</li></ul><h1 id="Mybatis"><a href="#Mybatis" class="headerlink" title="Mybatis"></a>Mybatis</h1><h2 id="1-ä¸ä¼ ç»Ÿçš„JDBCç›¸æ¯”ï¼ŒMyBatisçš„ä¼˜ç‚¹ï¼Ÿ"><a href="#1-ä¸ä¼ ç»Ÿçš„JDBCç›¸æ¯”ï¼ŒMyBatisçš„ä¼˜ç‚¹ï¼Ÿ" class="headerlink" title="1.ä¸ä¼ ç»Ÿçš„JDBCç›¸æ¯”ï¼ŒMyBatisçš„ä¼˜ç‚¹ï¼Ÿ"></a>1.ä¸ä¼ ç»Ÿçš„JDBCç›¸æ¯”ï¼ŒMyBatisçš„ä¼˜ç‚¹ï¼Ÿ</h2><ul><li>åŸºäº SQL è¯­å¥ç¼–ç¨‹ï¼Œç›¸å½“çµæ´»ï¼Œä¸ä¼šå¯¹åº”ç”¨ç¨‹åºæˆ–è€…æ•°æ®åº“çš„ç°æœ‰è®¾è®¡é€ æˆä»» ä½•å½±å“ï¼ŒSQL å†™åœ¨ XML é‡Œï¼Œè§£é™¤ sql ä¸ç¨‹åºä»£ç çš„è€¦åˆï¼Œä¾¿äºç»Ÿä¸€ç®¡ç†ï¼›æä¾› XML æ ‡ç­¾ï¼Œæ”¯æŒç¼–å†™åŠ¨æ€ SQL è¯­å¥ï¼Œå¹¶å¯é‡ç”¨ã€‚</li><li>ä¸ JDBC ç›¸æ¯”ï¼Œå‡å°‘äº† 50%ä»¥ä¸Šçš„ä»£ç é‡ï¼Œæ¶ˆé™¤äº† JDBC å¤§é‡å†—ä½™çš„ä»£ç ï¼Œä¸ éœ€è¦æ‰‹åŠ¨å¼€å…³è¿æ¥ï¼›</li><li>å¾ˆå¥½çš„ä¸å„ç§æ•°æ®åº“å…¼å®¹ï¼Œå› ä¸º MyBatis ä½¿ç”¨ JDBC æ¥è¿æ¥æ•°æ®åº“ï¼Œæ‰€ä»¥åªè¦ JDBC æ”¯æŒçš„æ•°æ®åº“ MyBatis éƒ½æ”¯æŒã€‚</li><li>èƒ½å¤Ÿä¸ Spring å¾ˆå¥½çš„é›†æˆï¼Œå¼€å‘æ•ˆç‡é«˜</li><li>æä¾›æ˜ å°„æ ‡ç­¾ï¼Œæ”¯æŒå¯¹è±¡ä¸æ•°æ®åº“çš„ ORM å­—æ®µå…³ç³»æ˜ å°„ï¼›æä¾›å¯¹è±¡å…³ç³»æ˜ å°„ æ ‡ç­¾ï¼Œæ”¯æŒå¯¹è±¡å…³ç³»ç»„ä»¶ç»´æŠ¤ã€‚</li></ul><h2 id="2-MyBatisè§‰å¾—åœ¨å“ªæ–¹é¢åšçš„æ¯”è¾ƒå¥½ï¼Ÿ"><a href="#2-MyBatisè§‰å¾—åœ¨å“ªæ–¹é¢åšçš„æ¯”è¾ƒå¥½ï¼Ÿ" class="headerlink" title="2.MyBatisè§‰å¾—åœ¨å“ªæ–¹é¢åšçš„æ¯”è¾ƒå¥½ï¼Ÿ"></a>2.MyBatisè§‰å¾—åœ¨å“ªæ–¹é¢åšçš„æ¯”è¾ƒå¥½ï¼Ÿ</h2><p>MyBatis åœ¨ <strong>SQL çµæ´»æ€§</strong>ã€<strong>åŠ¨æ€ SQL æ”¯æŒ</strong>ã€<strong>ç»“æœé›†æ˜ å°„</strong>å’Œ<strong>ä¸ Spring æ•´åˆ</strong>æ–¹é¢è¡¨ç°å“è¶Šï¼Œå°¤å…¶é€‚åˆé‡è§† SQL å¯æ§æ€§çš„é¡¹ç›®ã€‚</p><ul><li>SQL ä¸ä»£ç è§£è€¦ï¼Œçµæ´»å¯æ§ï¼š<strong>MyBatis å…è®¸å¼€å‘è€…ç›´æ¥ç¼–å†™å’Œä¼˜åŒ– SQL</strong>ï¼Œç›¸æ¯”å…¨è‡ªåŠ¨ ORMï¼ˆå¦‚ Hibernateï¼‰ï¼ŒMyBatis è®©å¼€å‘è€…æ˜ç¡®çŸ¥é“æ¯æ¡ SQL çš„æ‰§è¡Œé€»è¾‘ï¼Œä¾¿äºæ€§èƒ½è°ƒä¼˜ã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">&lt;!-- ç¤ºä¾‹ï¼šXML ä¸­å®šä¹‰ SQL --&gt;</span><br><span class="line">&lt;select id=<span class="string">&quot;findUserWithRole&quot;</span> resultMap=<span class="string">&quot;userRoleMap&quot;</span>&gt;</span><br><span class="line">    SELECT u.*, r.role_name </span><br><span class="line">    FROM user u </span><br><span class="line">    LEFT JOIN user_role ur ON u.id = ur.user_id</span><br><span class="line">    LEFT JOIN role r ON ur.role_id = r.id </span><br><span class="line">    WHERE u.id = #&#123;userId&#125;</span><br><span class="line">&lt;/select&gt;</span><br></pre></td></tr></table></figure><ul><li>åŠ¨æ€ SQL çš„å¼ºå¤§æ”¯æŒï¼šæ¯”å¦‚å¯ä»¥åŠ¨æ€æ‹¼æ¥SQLï¼Œé€šè¿‡ <code>&lt;if&gt;</code>, <code>&lt;choose&gt;</code>, <code>&lt;foreach&gt;</code> ç­‰æ ‡ç­¾åŠ¨æ€ç”Ÿæˆ SQLï¼Œé¿å… Java ä»£ç ä¸­ç¹ççš„å­—ç¬¦ä¸²æ‹¼æ¥ã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;select id=<span class="string">&quot;searchUsers&quot;</span> resultType=<span class="string">&quot;User&quot;</span>&gt;</span><br><span class="line">    SELECT * FROM user</span><br><span class="line">    &lt;where&gt;</span><br><span class="line">        &lt;<span class="keyword">if</span> test=<span class="string">&quot;name != null&quot;</span>&gt;AND name LIKE #&#123;name&#125;&lt;/<span class="keyword">if</span>&gt;</span><br><span class="line">        &lt;<span class="keyword">if</span> test=<span class="string">&quot;status != null&quot;</span>&gt;<span class="type">AND</span> <span class="variable">status</span> <span class="operator">=</span> #&#123;status&#125;&lt;/<span class="keyword">if</span>&gt;</span><br><span class="line">    &lt;/where&gt;</span><br><span class="line">&lt;/select&gt;</span><br></pre></td></tr></table></figure><ul><li>è‡ªåŠ¨æ˜ å°„ä¸è‡ªå®šä¹‰æ˜ å°„ç»“åˆï¼šè‡ªåŠ¨å°†æŸ¥è¯¢ç»“æœå­—æ®µåä¸å¯¹è±¡å±æ€§ååŒ¹é…ï¼ˆå¦‚é©¼å³°è½¬æ¢ï¼‰ã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&lt;resultMap id=<span class="string">&quot;userRoleMap&quot;</span> type=<span class="string">&quot;User&quot;</span>&gt;</span><br><span class="line">    &lt;id property=<span class="string">&quot;id&quot;</span> column=<span class="string">&quot;user_id&quot;</span>/&gt;</span><br><span class="line">    &lt;result property=<span class="string">&quot;name&quot;</span> column=<span class="string">&quot;user_name&quot;</span>/&gt;</span><br><span class="line">    &lt;collection property=<span class="string">&quot;roles&quot;</span> ofType=<span class="string">&quot;Role&quot;</span>&gt;</span><br><span class="line">        &lt;result property=<span class="string">&quot;roleName&quot;</span> column=<span class="string">&quot;role_name&quot;</span>/&gt;</span><br><span class="line">    &lt;/collection&gt;</span><br><span class="line">&lt;/resultMap&gt;</span><br></pre></td></tr></table></figure><ul><li>æ’ä»¶æ‰©å±•æœºåˆ¶ï¼šå¯ç¼–å†™<strong>æ’ä»¶æ‹¦æˆª SQL æ‰§è¡Œè¿‡ç¨‹ï¼Œå®ç°åˆ†é¡µã€æ€§èƒ½ç›‘æ§ã€SQL æ”¹å†™ç­‰é€šç”¨é€»è¾‘ã€‚</strong></li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Intercepts(&#123;</span></span><br><span class="line"><span class="meta">    @Signature(type=Executor.class, method=&quot;query&quot;, args=&#123;...&#125;)</span></span><br><span class="line"><span class="meta">&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PaginationPlugin</span> <span class="keyword">implements</span> <span class="title class_">Interceptor</span> &#123;</span><br><span class="line">    <span class="comment">// å®ç°åˆ†é¡µé€»è¾‘</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>ä¸ Spring ç”Ÿæ€æ— ç¼é›†æˆï¼šé€šè¿‡ <code>@MapperScan</code> å¿«é€Ÿæ‰«æ Mapper æ¥å£ï¼Œç»“åˆ Spring äº‹åŠ¡ç®¡ç†ï¼Œé…ç½®ç®€æ´é«˜æ•ˆã€‚</li></ul><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@MapperScan(&quot;com.example.mapper&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MyBatisConfig</span> &#123;</span><br><span class="line">    <span class="comment">// æ•°æ®æºå’Œ SqlSessionFactory é…ç½®</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="3-è¿˜è®°å¾—JDBCè¿æ¥æ•°æ®åº“çš„æ­¥éª¤å—ï¼Ÿ"><a href="#3-è¿˜è®°å¾—JDBCè¿æ¥æ•°æ®åº“çš„æ­¥éª¤å—ï¼Ÿ" class="headerlink" title="3.è¿˜è®°å¾—JDBCè¿æ¥æ•°æ®åº“çš„æ­¥éª¤å—ï¼Ÿ"></a>3.è¿˜è®°å¾—JDBCè¿æ¥æ•°æ®åº“çš„æ­¥éª¤å—ï¼Ÿ</h2><p>ä½¿ç”¨Java JDBCè¿æ¥æ•°æ®åº“çš„ä¸€èˆ¬æ­¥éª¤å¦‚ä¸‹ï¼š</p><ol><li><strong>åŠ è½½æ•°æ®åº“é©±åŠ¨ç¨‹åº</strong>ï¼šåœ¨ä½¿ç”¨JDBCè¿æ¥æ•°æ®åº“ä¹‹å‰ï¼Œéœ€è¦åŠ è½½ç›¸åº”çš„<strong>æ•°æ®åº“é©±åŠ¨ç¨‹åºã€‚å¯ä»¥é€šè¿‡ Class.forName(â€œcom.mysql.jdbc.Driverâ€) æ¥åŠ è½½MySQLæ•°æ®åº“çš„é©±åŠ¨ç¨‹åºã€‚</strong>ä¸åŒæ•°æ®åº“çš„é©±åŠ¨ç±»åä¼šæœ‰æ‰€ä¸åŒã€‚</li><li><strong>å»ºç«‹æ•°æ®åº“è¿æ¥</strong>ï¼šä½¿ç”¨ DriverManager ç±»çš„ <strong>getConnection(url, username, password) æ–¹æ³•æ¥è¿æ¥æ•°æ®åº“ï¼Œ</strong>å…¶ä¸­urlæ˜¯æ•°æ®åº“çš„è¿æ¥å­—ç¬¦ä¸²ï¼ˆåŒ…æ‹¬æ•°æ®åº“ç±»å‹ã€ä¸»æœºã€ç«¯å£ç­‰ï¼‰ã€usernameæ˜¯æ•°æ®åº“ç”¨æˆ·åï¼Œpasswordæ˜¯å¯†ç ã€‚</li><li><strong>åˆ›å»º Statement å¯¹è±¡</strong>ï¼šé€šè¿‡ <strong>Connection å¯¹è±¡çš„ createStatement() æ–¹æ³•åˆ›å»ºä¸€ä¸ª Statement å¯¹è±¡ï¼Œç”¨äºæ‰§è¡Œ SQL æŸ¥è¯¢æˆ–æ›´æ–°æ“ä½œã€‚</strong></li><li><strong>æ‰§è¡Œ SQL æŸ¥è¯¢æˆ–æ›´æ–°æ“ä½œ</strong>ï¼šä½¿ç”¨ Statement å¯¹è±¡çš„ executeQuery(sql) æ–¹æ³•æ¥æ‰§è¡Œ SELECT æŸ¥è¯¢æ“ä½œï¼Œæˆ–è€…ä½¿ç”¨ executeUpdate(sql) æ–¹æ³•æ¥æ‰§è¡Œ INSERTã€UPDATE æˆ– DELETE æ“ä½œã€‚</li><li><strong>å¤„ç†æŸ¥è¯¢ç»“æœ</strong>ï¼šå¦‚æœæ˜¯ SELECT æŸ¥è¯¢æ“ä½œï¼Œé€šè¿‡ ResultSet å¯¹è±¡æ¥å¤„ç†æŸ¥è¯¢ç»“æœã€‚å¯ä»¥ä½¿ç”¨ ResultSet çš„ next() æ–¹æ³•éå†æŸ¥è¯¢ç»“æœé›†ï¼Œç„¶åé€šè¿‡ getXXX() æ–¹æ³•è·å–å„ä¸ªå­—æ®µçš„å€¼ã€‚</li><li><strong>å…³é—­è¿æ¥</strong>ï¼šåœ¨å®Œæˆæ•°æ®åº“æ“ä½œåï¼Œéœ€è¦é€çº§å…³é—­æ•°æ®åº“è¿æ¥ç›¸å…³å¯¹è±¡ï¼Œå³å…ˆå…³é—­ ResultSetï¼Œå†å…³é—­ Statementï¼Œæœ€åå…³é—­ Connectionã€‚</li></ol><p>ä»¥ä¸‹æ˜¯ä¸€ä¸ªç®€å•çš„ç¤ºä¾‹ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.sql.*;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Main</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// åŠ è½½æ•°æ®åº“é©±åŠ¨ç¨‹åº</span></span><br><span class="line">            Class.forName(<span class="string">&quot;com.mysql.cj.jdbc.Driver&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// å»ºç«‹æ•°æ®åº“è¿æ¥</span></span><br><span class="line">            <span class="type">Connection</span> <span class="variable">connection</span> <span class="operator">=</span> DriverManager.getConnection(<span class="string">&quot;jdbc:mysql://localhost:3306/mydatabase&quot;</span>, <span class="string">&quot;username&quot;</span>, <span class="string">&quot;password&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// åˆ›å»º Statement å¯¹è±¡</span></span><br><span class="line">            <span class="type">Statement</span> <span class="variable">statement</span> <span class="operator">=</span> connection.createStatement();</span><br><span class="line"></span><br><span class="line">            <span class="comment">// æ‰§è¡Œ SQL æŸ¥è¯¢</span></span><br><span class="line">            <span class="type">ResultSet</span> <span class="variable">resultSet</span> <span class="operator">=</span> statement.executeQuery(<span class="string">&quot;SELECT * FROM mytable&quot;</span>);</span><br><span class="line"></span><br><span class="line">            <span class="comment">// å¤„ç†æŸ¥è¯¢ç»“æœ</span></span><br><span class="line">            <span class="keyword">while</span> (resultSet.next()) &#123;</span><br><span class="line">              <span class="comment">// å¤„ç†æ¯ä¸€è¡Œæ•°æ®</span></span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// å…³é—­èµ„æº</span></span><br><span class="line">            resultSet.close();</span><br><span class="line">            statement.close();</span><br><span class="line">            connection.close();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¯·æ³¨æ„ï¼Œåœ¨å®é™…åº”ç”¨ä¸­ï¼Œéœ€è¦è¿›è¡Œå¼‚å¸¸å¤„ç†ä»¥ç¡®ä¿èµ„æºçš„æ­£ç¡®é‡Šæ”¾ï¼Œä»¥åŠä½¿ç”¨ try-with-resources æ¥ç®€åŒ–ä»£ç å’Œç¡®ä¿èµ„æºçš„åŠæ—¶å…³é—­ã€‚</p><h2 id="4-å¦‚æœé¡¹ç›®ä¸­è¦ç”¨åˆ°åŸç”Ÿçš„mybatiså»æŸ¥è¯¢ï¼Œè¯¥æ€æ ·å†™ï¼Ÿ"><a href="#4-å¦‚æœé¡¹ç›®ä¸­è¦ç”¨åˆ°åŸç”Ÿçš„mybatiså»æŸ¥è¯¢ï¼Œè¯¥æ€æ ·å†™ï¼Ÿ" class="headerlink" title="4.å¦‚æœé¡¹ç›®ä¸­è¦ç”¨åˆ°åŸç”Ÿçš„mybatiså»æŸ¥è¯¢ï¼Œè¯¥æ€æ ·å†™ï¼Ÿ"></a>4.å¦‚æœé¡¹ç›®ä¸­è¦ç”¨åˆ°åŸç”Ÿçš„mybatiså»æŸ¥è¯¢ï¼Œè¯¥æ€æ ·å†™ï¼Ÿ</h2><p>æ­¥éª¤æ¦‚è¿°ï¼š</p><ol><li><strong>é…ç½®MyBatisï¼š</strong> åœ¨é¡¹ç›®ä¸­é…ç½®MyBatisçš„æ•°æ®æºã€SQLæ˜ å°„æ–‡ä»¶ç­‰ã€‚</li><li><strong>åˆ›å»ºå®ä½“ç±»ï¼š</strong> åˆ›å»ºç”¨äºæ˜ å°„æ•°æ®åº“è¡¨çš„å®ä½“ç±»ã€‚</li><li><strong>ç¼–å†™SQLæ˜ å°„æ–‡ä»¶ï¼š</strong> åˆ›å»ºXMLæ–‡ä»¶ï¼Œå®šä¹‰SQLè¯­å¥å’Œæ˜ å°„å…³ç³»ã€‚</li><li><strong>ç¼–å†™DAOæ¥å£ï¼š</strong> åˆ›å»ºDAOæ¥å£ï¼Œå®šä¹‰æ•°æ®åº“æ“ä½œçš„æ–¹æ³•ã€‚</li><li><strong>ç¼–å†™å…·ä½“çš„SQLæŸ¥è¯¢è¯­å¥ï¼š</strong> åœ¨DAOæ¥å£ä¸­å®šä¹‰æŸ¥è¯¢æ–¹æ³•ï¼Œå¹¶åœ¨XMLæ–‡ä»¶ä¸­ç¼–å†™å¯¹åº”çš„SQLè¯­å¥ã€‚</li><li><strong>è°ƒç”¨æŸ¥è¯¢æ–¹æ³•ï¼š</strong> åœ¨æœåŠ¡å±‚æˆ–æ§åˆ¶å±‚è°ƒç”¨DAOæ¥å£ä¸­çš„æ–¹æ³•è¿›è¡ŒæŸ¥è¯¢ã€‚</li></ol><p>è¯¦ç»†æ­¥éª¤ï¼š</p><ol><li><strong>é…ç½®MyBatisï¼š</strong> åœ¨é…ç½®æ–‡ä»¶ä¸­é…ç½®æ•°æ®æºã€MyBatisçš„Mapperæ–‡ä»¶ä½ç½®ç­‰ä¿¡æ¯ã€‚</li><li><strong>åˆ›å»ºå®ä½“ç±»ï¼š</strong> åˆ›å»ºä¸æ•°æ®åº“è¡¨å¯¹åº”çš„å®ä½“ç±»ï¼Œå­—æ®µåå’Œç±»å‹éœ€ä¸æ•°æ®åº“è¡¨ä¿æŒä¸€è‡´ã€‚</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">User</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String username;</span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line">    <span class="comment">// Getters and setters</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li><strong>ç¼–å†™SQLæ˜ å°„æ–‡ä»¶ï¼š</strong> åœ¨resourcesç›®å½•ä¸‹åˆ›å»ºXMLæ–‡ä»¶ï¼Œå®šä¹‰SQLè¯­å¥å’Œæ˜ å°„å…³ç³»ã€‚</li></ol><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- userMapper.xml --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.example.dao.UserMapper&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectUserById&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.example.model.User&quot;</span>&gt;</span></span><br><span class="line">        SELECT * FROM users WHERE id = #&#123;id&#125;</span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure><ol><li><strong>ç¼–å†™DAOæ¥å£ï¼š</strong> åˆ›å»ºDAOæ¥å£ï¼Œå®šä¹‰æŸ¥è¯¢æ–¹æ³•ã€‚</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">UserMapper</span> &#123;</span><br><span class="line">    User <span class="title function_">selectUserById</span><span class="params">(Long id)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ol><li><strong>ç¼–å†™å…·ä½“çš„SQLæŸ¥è¯¢è¯­å¥ï¼š</strong> åœ¨XMLæ–‡ä»¶ä¸­ç¼–å†™å¯¹åº”çš„SQLè¯­å¥ã€‚</li><li><strong>è°ƒç”¨æŸ¥è¯¢æ–¹æ³•ï¼š</strong> åœ¨æœåŠ¡å±‚æˆ–æ§åˆ¶å±‚ä¸­è°ƒç”¨DAOæ¥å£ä¸­çš„æ–¹æ³•è¿›è¡ŒæŸ¥è¯¢ã€‚</li></ol><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åœ¨Serviceå±‚ä¸­è°ƒç”¨</span></span><br><span class="line"><span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userMapper.selectUserById(<span class="number">1</span>);</span><br></pre></td></tr></table></figure><p>é€šè¿‡ä»¥ä¸Šæ­¥éª¤ï¼Œä½ å¯ä»¥åˆ©ç”¨åŸç”Ÿçš„MyBatisæ¡†æ¶æ¥è¿›è¡Œæ•°æ®åº“æŸ¥è¯¢æ“ä½œã€‚è¯·ç¡®ä¿é…ç½®æ­£ç¡®ã€SQLè¯­å¥å‡†ç¡®å¹¶ä¸æ•°æ®åº“å­—æ®µåŒ¹é…ï¼Œä»¥ç¡®ä¿æŸ¥è¯¢çš„å‡†ç¡®æ€§å’Œé«˜æ•ˆæ€§ã€‚</p><h2 id="5-Mybatisé‡Œçš„-å’Œ-çš„åŒºåˆ«ï¼Ÿ"><a href="#5-Mybatisé‡Œçš„-å’Œ-çš„åŒºåˆ«ï¼Ÿ" class="headerlink" title="5.Mybatisé‡Œçš„ # å’Œ $ çš„åŒºåˆ«ï¼Ÿ"></a>5.Mybatisé‡Œçš„ # å’Œ $ çš„åŒºåˆ«ï¼Ÿ</h2><ul><li>Mybatis åœ¨å¤„ç† #{} æ—¶ï¼Œä¼šåˆ›å»ºé¢„ç¼–è¯‘çš„ SQL è¯­å¥ï¼Œå°† SQL ä¸­çš„ #{} æ›¿æ¢ä¸º ? å·ï¼Œ<strong>åœ¨æ‰§è¡Œ SQL æ—¶ä¼šä¸ºé¢„ç¼–è¯‘ SQL ä¸­çš„å ä½ç¬¦ï¼ˆ?ï¼‰èµ‹å€¼ï¼Œè°ƒç”¨ PreparedStatement çš„ set æ–¹æ³•æ¥èµ‹å€¼ï¼Œé¢„ç¼–è¯‘çš„ SQL è¯­å¥æ‰§è¡Œæ•ˆç‡é«˜ï¼Œå¹¶ä¸”å¯ä»¥é˜²æ­¢SQL æ³¨å…¥ï¼Œ</strong>æä¾›æ›´é«˜çš„å®‰å…¨æ€§ï¼Œé€‚åˆä¼ é€’å‚æ•°å€¼ã€‚</li><li>Mybatis åœ¨å¤„ç† ${} æ—¶ï¼Œåªæ˜¯åˆ›å»ºæ™®é€šçš„ SQL è¯­å¥ï¼Œç„¶ååœ¨æ‰§è¡Œ SQL è¯­å¥æ—¶ MyBatis å°†å‚æ•°ç›´æ¥æ‹¼å…¥åˆ° SQL é‡Œï¼Œ<strong>ä¸èƒ½é˜²æ­¢ SQL æ³¨å…¥ï¼Œå› ä¸ºå‚æ•°ç›´æ¥æ‹¼æ¥åˆ° SQL è¯­å¥ä¸­ï¼Œå¦‚æœå‚æ•°æœªç»è¿‡éªŒè¯ã€è¿‡æ»¤ï¼Œå¯èƒ½ä¼šå¯¼è‡´å®‰å…¨é—®é¢˜ã€‚</strong></li></ul><h2 id="6-MybatisPluså’ŒMybatisçš„åŒºåˆ«ï¼Ÿ"><a href="#6-MybatisPluså’ŒMybatisçš„åŒºåˆ«ï¼Ÿ" class="headerlink" title="6.MybatisPluså’ŒMybatisçš„åŒºåˆ«ï¼Ÿ"></a>6.MybatisPluså’ŒMybatisçš„åŒºåˆ«ï¼Ÿ</h2><p>MybatisPlusæ˜¯ä¸€ä¸ªåŸºäºMyBatisçš„å¢å¼ºå·¥å…·åº“ï¼Œæ—¨åœ¨ç®€åŒ–å¼€å‘å¹¶æé«˜æ•ˆç‡ã€‚ä»¥ä¸‹æ˜¯MybatisPluså’ŒMyBatisä¹‹é—´çš„ä¸€äº›ä¸»è¦åŒºåˆ«ï¼š</p><ul><li><strong>CRUDæ“ä½œ</strong>ï¼šMybatisPlusé€šè¿‡ç»§æ‰¿BaseMapperæ¥å£ï¼Œæä¾›äº†ä¸€ç³»åˆ—å†…ç½®çš„å¿«æ·æ–¹æ³•ï¼Œä½¿å¾—CRUDæ“ä½œæ›´åŠ ç®€å•ï¼Œæ— éœ€ç¼–å†™é‡å¤çš„SQLè¯­å¥ã€‚</li><li><strong>ä»£ç ç”Ÿæˆå™¨</strong>ï¼šMybatisPlusæä¾›äº†<strong>ä»£ç ç”Ÿæˆå™¨åŠŸèƒ½</strong>ï¼Œå¯ä»¥æ ¹æ®æ•°æ®åº“è¡¨ç»“æ„è‡ªåŠ¨ç”Ÿæˆå®ä½“ç±»ã€Mapperæ¥å£ä»¥åŠXMLæ˜ å°„æ–‡ä»¶ï¼Œå‡å°‘äº†æ‰‹åŠ¨ç¼–å†™çš„å·¥ä½œé‡ã€‚</li><li><strong>é€šç”¨æ–¹æ³•å°è£…</strong>ï¼šMybatisPluså°è£…äº†è®¸å¤šå¸¸ç”¨çš„æ–¹æ³•ï¼Œå¦‚æ¡ä»¶æ„é€ å™¨ã€æ’åºã€åˆ†é¡µæŸ¥è¯¢ç­‰ï¼Œç®€åŒ–äº†å¼€å‘è¿‡ç¨‹ï¼Œæé«˜äº†å¼€å‘æ•ˆç‡ã€‚</li><li><strong>åˆ†é¡µæ’ä»¶</strong>ï¼šMybatisPlus<strong>å†…ç½®äº†åˆ†é¡µæ’ä»¶</strong>ï¼Œæ”¯æŒå„ç§æ•°æ®åº“çš„åˆ†é¡µæŸ¥è¯¢ï¼Œå¼€å‘è€…å¯ä»¥è½»æ¾å®ç°åˆ†é¡µåŠŸèƒ½ï¼Œè€Œåœ¨ä¼ ç»Ÿçš„MyBatisä¸­ï¼Œéœ€è¦å¼€å‘è€…è‡ªå·±æ‰‹åŠ¨å®ç°åˆ†é¡µé€»è¾‘ã€‚</li><li><strong>å¤šç§Ÿæˆ·æ”¯æŒ</strong>ï¼šMybatisPlusæä¾›äº†å¤šç§Ÿæˆ·çš„æ”¯æŒï¼Œå¯ä»¥è½»æ¾å®ç°å¤šç§Ÿæˆ·æ•°æ®éš”ç¦»çš„åŠŸèƒ½ã€‚</li><li><strong>æ³¨è§£æ”¯æŒ</strong>ï¼šMybatisPluså¼•å…¥äº†æ›´å¤šçš„æ³¨è§£æ”¯æŒï¼Œä½¿å¾—å¼€å‘è€…å¯ä»¥é€šè¿‡æ³¨è§£æ¥é…ç½®å®ä½“ä¸æ•°æ®åº“è¡¨ä¹‹é—´çš„æ˜ å°„å…³ç³»ï¼Œå‡å°‘äº†XMLé…ç½®æ–‡ä»¶çš„ç¼–å†™ã€‚</li></ul><h2 id="7-MyBatisè¿ç”¨äº†å“ªäº›å¸¸è§çš„è®¾è®¡æ¨¡å¼ï¼Ÿ"><a href="#7-MyBatisè¿ç”¨äº†å“ªäº›å¸¸è§çš„è®¾è®¡æ¨¡å¼ï¼Ÿ" class="headerlink" title="7.MyBatisè¿ç”¨äº†å“ªäº›å¸¸è§çš„è®¾è®¡æ¨¡å¼ï¼Ÿ"></a>7.MyBatisè¿ç”¨äº†å“ªäº›å¸¸è§çš„è®¾è®¡æ¨¡å¼ï¼Ÿ</h2><ul><li>å»ºé€ è€…æ¨¡å¼ï¼ˆBuilderï¼‰ï¼Œå¦‚ï¼šSqlSessionFactoryBuilderã€XMLConfigBuilderã€XMLMapperBuilderã€XMLStatementBuilderã€CacheBuilderç­‰ï¼›</li><li>å·¥å‚æ¨¡å¼ï¼Œå¦‚ï¼šSqlSessionFactoryã€ObjectFactoryã€MapperProxyFactoryï¼›</li><li>å•ä¾‹æ¨¡å¼ï¼Œä¾‹å¦‚ErrorContextå’ŒLogFactoryï¼›</li><li>ä»£ç†æ¨¡å¼ï¼ŒMybatiså®ç°çš„æ ¸å¿ƒï¼Œæ¯”å¦‚MapperProxyã€ConnectionLoggerï¼Œç”¨çš„jdkçš„åŠ¨æ€ä»£ç†ï¼›è¿˜æœ‰executor.loaderåŒ…ä½¿ç”¨äº†cglibæˆ–è€…javassistè¾¾åˆ°å»¶è¿ŸåŠ è½½çš„æ•ˆæœï¼›</li><li>ç»„åˆæ¨¡å¼ï¼Œä¾‹å¦‚SqlNodeå’Œå„ä¸ªå­ç±»ChooseSqlNodeç­‰ï¼›</li><li>æ¨¡æ¿æ–¹æ³•æ¨¡å¼ï¼Œä¾‹å¦‚BaseExecutorå’ŒSimpleExecutorï¼Œè¿˜æœ‰BaseTypeHandlerå’Œæ‰€æœ‰çš„å­ç±»ä¾‹å¦‚IntegerTypeHandlerï¼›</li><li>é€‚é…å™¨æ¨¡å¼ï¼Œä¾‹å¦‚Logçš„Mybatisæ¥å£å’Œå®ƒå¯¹jdbcã€log4jç­‰å„ç§æ—¥å¿—æ¡†æ¶çš„é€‚é…å®ç°ï¼›</li><li>è£…é¥°è€…æ¨¡å¼ï¼Œä¾‹å¦‚CacheåŒ…ä¸­çš„cache.decoratorså­åŒ…ä¸­ç­‰å„ä¸ªè£…é¥°è€…çš„å®ç°ï¼›</li><li>è¿­ä»£å™¨æ¨¡å¼ï¼Œä¾‹å¦‚è¿­ä»£å™¨æ¨¡å¼PropertyTokenizerï¼›</li></ul><h2 id="8-MyBatis-çš„ä¸¤çº§ç¼“å­˜åŠå…¶ç‰¹ç‚¹æ˜¯ä»€ä¹ˆï¼Ÿ"><a href="#8-MyBatis-çš„ä¸¤çº§ç¼“å­˜åŠå…¶ç‰¹ç‚¹æ˜¯ä»€ä¹ˆï¼Ÿ" class="headerlink" title="8.MyBatis çš„ä¸¤çº§ç¼“å­˜åŠå…¶ç‰¹ç‚¹æ˜¯ä»€ä¹ˆï¼Ÿ"></a>8.MyBatis çš„ä¸¤çº§ç¼“å­˜åŠå…¶ç‰¹ç‚¹æ˜¯ä»€ä¹ˆï¼Ÿ</h2><p>MyBatis çš„ä¸¤çº§ç¼“å­˜åŒ…æ‹¬ä¸€çº§ç¼“å­˜å’ŒäºŒçº§ç¼“å­˜ã€‚ä¸€çº§ç¼“å­˜æ˜¯ <strong>SqlSession çº§åˆ«çš„æœ¬åœ°ç¼“å­˜</strong>ï¼Œé»˜è®¤å¼€å¯ï¼Œä»…åœ¨åŒä¸€ä¸ªä¼šè¯ä¸­æœ‰æ•ˆï¼Œç”¨äºé¿å…é‡å¤æŸ¥è¯¢ï¼ŒåŒä¸€ä¸ªæŸ¥è¯¢åœ¨ä¼šè¯ä¸­åªè®¿é—®ä¸€æ¬¡æ•°æ®åº“ï¼›<strong>ä½†åœ¨æ‰§è¡Œæ›´æ–°æ“ä½œæˆ–å…³é—­ä¼šè¯åä¼šå¤±æ•ˆ</strong>ï¼Œä¸”ä¸èƒ½è·¨çº¿ç¨‹ã€è·¨è¯·æ±‚ã€‚äºŒçº§ç¼“å­˜æ˜¯ <strong>Mapper çº§åˆ«çš„å…¨å±€ç¼“å­˜</strong>ï¼Œé»˜è®¤å…³é—­ï¼Œéœ€è¦åœ¨å…¨å±€é…ç½®ä¸­å¼€å¯å¹¶åœ¨å¯¹åº”çš„ Mapper ä¸­ä½¿ç”¨ <code>&lt;cache /&gt;</code> æ ‡ç­¾å£°æ˜ï¼Œå®ƒ<strong>æ”¯æŒå¤šä¸ª SqlSession å…±äº«ç¼“å­˜</strong>ï¼Œé€šå¸¸ç”¨äº<strong>è¯»å¤šå†™å°‘</strong>çš„åœºæ™¯ï¼Œå¦‚å•†å“ä¿¡æ¯ã€å­—å…¸æ•°æ®ç­‰ã€‚ä¸€çº§ç¼“å­˜ç”Ÿå‘½å‘¨æœŸçŸ­ã€çº¿ç¨‹ä¸å®‰å…¨ï¼Œé€‚åˆå•æ¬¡è¯·æ±‚ä¼˜åŒ–ï¼›<strong>äºŒçº§ç¼“å­˜ç”Ÿå‘½å‘¨æœŸé•¿ã€çº¿ç¨‹å®‰å…¨ï¼Œé€‚åˆå…¨å±€æ•°æ®å…±äº«</strong>ï¼Œä½†éœ€æ³¨æ„ç¼“å­˜å¤±æ•ˆå’Œä¸€è‡´æ€§æ§åˆ¶ã€‚</p>]]></content:encoded>
      
      
      <category domain="https://blog.tokenlen.top/categories/%E6%8A%80%E6%9C%AF%E6%A0%88/">æŠ€æœ¯æ ˆ</category>
      
      
      <category domain="https://blog.tokenlen.top/tags/java/">java</category>
      
      <category domain="https://blog.tokenlen.top/tags/%E9%9D%A2%E8%AF%95/">é¢è¯•</category>
      
      <category domain="https://blog.tokenlen.top/tags/spring/">spring</category>
      
      
      <comments>https://blog.tokenlen.top/2025/05/05/java-stack/spring2/#disqus_thread</comments>
      
    </item>
    
    <item>
      <title>SpringåŸºç¡€</title>
      <link>https://blog.tokenlen.top/2025/05/05/java-stack/spring1/</link>
      <guid>https://blog.tokenlen.top/2025/05/05/java-stack/spring1/</guid>
      <pubDate>Sun, 04 May 2025 16:00:00 GMT</pubDate>
      
        
        
          
          
      <description>&lt;h1 id=&quot;ç®€ä»‹&quot;&gt;&lt;a href=&quot;#ç®€ä»‹&quot; class=&quot;headerlink&quot; title=&quot;ç®€ä»‹&quot;&gt;&lt;/a&gt;ç®€ä»‹&lt;/h1&gt;&lt;p&gt;Springæ˜¯ä¸€ä¸ªæ”¯æŒå¿«é€Ÿå¼€å‘Java</description>
          
        
      
      
      
      <content:encoded><![CDATA[<h1 id="ç®€ä»‹"><a href="#ç®€ä»‹" class="headerlink" title="ç®€ä»‹"></a>ç®€ä»‹</h1><p>Springæ˜¯ä¸€ä¸ªæ”¯æŒå¿«é€Ÿå¼€å‘Java EEåº”ç”¨ç¨‹åºçš„æ¡†æ¶ã€‚å®ƒæä¾›äº†ä¸€ç³»åˆ—åº•å±‚å®¹å™¨å’ŒåŸºç¡€è®¾æ–½ï¼Œå¹¶å¯ä»¥å’Œå¤§é‡å¸¸ç”¨çš„å¼€æºæ¡†æ¶æ— ç¼é›†æˆï¼Œå¯ä»¥è¯´æ˜¯å¼€å‘Java EEåº”ç”¨ç¨‹åºçš„å¿…å¤‡ã€‚</p><p>Spring Frameworkä¸»è¦åŒ…æ‹¬å‡ ä¸ªæ¨¡å—ï¼š</p><ul><li>æ”¯æŒIoCå’ŒAOPçš„å®¹å™¨ï¼›</li><li>æ”¯æŒJDBCå’ŒORMçš„æ•°æ®è®¿é—®æ¨¡å—ï¼›</li><li>æ”¯æŒå£°æ˜å¼äº‹åŠ¡çš„æ¨¡å—ï¼›</li><li>æ”¯æŒåŸºäºServletçš„MVCå¼€å‘ï¼›</li><li>æ”¯æŒåŸºäºReactiveçš„Webå¼€å‘ï¼›</li><li>ä»¥åŠé›†æˆJMSã€JavaMailã€JMXã€ç¼“å­˜ç­‰å…¶ä»–æ¨¡å—ã€‚</li></ul><h1 id="Iocå®¹å™¨"><a href="#Iocå®¹å™¨" class="headerlink" title="Iocå®¹å™¨"></a>Iocå®¹å™¨</h1><p>åœ¨å­¦ä¹ Springæ¡†æ¶æ—¶ï¼Œæˆ‘ä»¬é‡åˆ°çš„ç¬¬ä¸€ä¸ªä¹Ÿæ˜¯æœ€æ ¸å¿ƒçš„æ¦‚å¿µå°±æ˜¯<strong>å®¹å™¨ã€‚</strong></p><p>ä»€ä¹ˆæ˜¯å®¹å™¨ï¼Ÿå®¹å™¨æ˜¯<strong>ä¸€ç§ä¸ºæŸç§ç‰¹å®šç»„ä»¶çš„è¿è¡Œæä¾›å¿…è¦æ”¯æŒçš„ä¸€ä¸ªè½¯ä»¶ç¯å¢ƒ</strong>ã€‚ä¾‹å¦‚ï¼ŒTomcatå°±æ˜¯ä¸€ä¸ªServletå®¹å™¨ï¼Œå®ƒå¯ä»¥ä¸ºServletçš„è¿è¡Œæä¾›è¿è¡Œç¯å¢ƒã€‚ç±»ä¼¼Dockerè¿™æ ·çš„è½¯ä»¶ä¹Ÿæ˜¯ä¸€ä¸ªå®¹å™¨ï¼Œå®ƒæä¾›äº†å¿…è¦çš„Linuxç¯å¢ƒä»¥ä¾¿è¿è¡Œä¸€ä¸ªç‰¹å®šçš„Linuxè¿›ç¨‹ã€‚</p><p>é€šå¸¸æ¥è¯´ï¼Œä½¿ç”¨å®¹å™¨è¿è¡Œç»„ä»¶ï¼Œé™¤äº†æä¾›ä¸€ä¸ªç»„ä»¶è¿è¡Œç¯å¢ƒä¹‹å¤–ï¼Œå®¹å™¨è¿˜æä¾›äº†è®¸å¤šåº•å±‚æœåŠ¡ã€‚ä¾‹å¦‚ï¼ŒServletå®¹å™¨åº•å±‚å®ç°äº†TCPè¿æ¥ï¼Œè§£æHTTPåè®®ç­‰éå¸¸å¤æ‚çš„æœåŠ¡ï¼Œå¦‚æœæ²¡æœ‰å®¹å™¨æ¥æä¾›è¿™äº›æœåŠ¡ï¼Œæˆ‘ä»¬å°±æ— æ³•ç¼–å†™åƒServletè¿™æ ·ä»£ç ç®€å•ï¼ŒåŠŸèƒ½å¼ºå¤§çš„ç»„ä»¶ã€‚æ—©æœŸçš„JavaEEæœåŠ¡å™¨æä¾›çš„EJBå®¹å™¨æœ€é‡è¦çš„åŠŸèƒ½å°±æ˜¯é€šè¿‡å£°æ˜å¼äº‹åŠ¡æœåŠ¡ï¼Œä½¿å¾—EJBç»„ä»¶çš„å¼€å‘äººå‘˜ä¸å¿…è‡ªå·±ç¼–å†™å†—é•¿çš„äº‹åŠ¡å¤„ç†ä»£ç ï¼Œæ‰€ä»¥æå¤§åœ°ç®€åŒ–äº†äº‹åŠ¡å¤„ç†ã€‚</p><p>Springçš„æ ¸å¿ƒå°±æ˜¯æä¾›äº†ä¸€ä¸ª<strong>IoCå®¹å™¨</strong>ï¼Œå®ƒå¯ä»¥<strong>ç®¡ç†æ‰€æœ‰è½»é‡çº§çš„JavaBeanç»„ä»¶</strong>ï¼Œæä¾›çš„åº•å±‚æœåŠ¡åŒ…æ‹¬<strong>ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸç®¡ç†ã€é…ç½®å’Œç»„è£…æœåŠ¡ã€AOPæ”¯æŒï¼Œä»¥åŠå»ºç«‹åœ¨AOPåŸºç¡€ä¸Šçš„å£°æ˜å¼äº‹åŠ¡æœåŠ¡ç­‰ã€‚</strong></p><h2 id="IocåŸç†"><a href="#IocåŸç†" class="headerlink" title="IocåŸç†"></a>IocåŸç†</h2><p>IoCå…¨ç§°Inversion of Controlï¼Œç›´è¯‘ä¸ºæ§åˆ¶åè½¬ã€‚é‚£ä¹ˆä½•è°“IoCï¼Ÿåœ¨ç†è§£IoCä¹‹å‰ï¼Œæˆ‘ä»¬å…ˆçœ‹çœ‹é€šå¸¸çš„Javaç»„ä»¶æ˜¯å¦‚ä½•åä½œçš„ã€‚</p><p>æˆ‘ä»¬å‡å®šä¸€ä¸ªåœ¨çº¿ä¹¦åº—ï¼Œé€šè¿‡<code>BookService</code>è·å–ä¹¦ç±ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookService</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">HikariConfig</span> <span class="variable">config</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HikariConfig</span>();</span><br><span class="line">    <span class="keyword">private</span> <span class="type">DataSource</span> <span class="variable">dataSource</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HikariDataSource</span>(config);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> Book <span class="title function_">getBook</span><span class="params">(<span class="type">long</span> bookId)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> (<span class="type">Connection</span> <span class="variable">conn</span> <span class="operator">=</span> dataSource.getConnection()) &#123;</span><br><span class="line">            ...</span><br><span class="line">            <span class="keyword">return</span> book;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸ºäº†ä»æ•°æ®åº“æŸ¥è¯¢ä¹¦ç±ï¼Œ<code>BookService</code>æŒæœ‰ä¸€ä¸ª<code>DataSource</code>ã€‚ä¸ºäº†å®ä¾‹åŒ–ä¸€ä¸ª<code>HikariDataSource</code>ï¼Œåˆä¸å¾—ä¸å®ä¾‹åŒ–ä¸€ä¸ª<code>HikariConfig</code>ã€‚</p><p>ç°åœ¨ï¼Œæˆ‘ä»¬ç»§ç»­ç¼–å†™<code>UserService</code>è·å–ç”¨æˆ·ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">HikariConfig</span> <span class="variable">config</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HikariConfig</span>();</span><br><span class="line">    <span class="keyword">private</span> <span class="type">DataSource</span> <span class="variable">dataSource</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">HikariDataSource</span>(config);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">getUser</span><span class="params">(<span class="type">long</span> userId)</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> (<span class="type">Connection</span> <span class="variable">conn</span> <span class="operator">=</span> dataSource.getConnection()) &#123;</span><br><span class="line">            ...</span><br><span class="line">            <span class="keyword">return</span> user;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å› ä¸º<code>UserService</code>ä¹Ÿéœ€è¦è®¿é—®æ•°æ®åº“ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬ä¸å¾—ä¸ä¹Ÿå®ä¾‹åŒ–ä¸€ä¸ª<code>HikariDataSource</code>ã€‚</p><p>åœ¨å¤„ç†ç”¨æˆ·è´­ä¹°çš„<code>CartServlet</code>ä¸­ï¼Œæˆ‘ä»¬éœ€è¦å®ä¾‹åŒ–<code>UserService</code>å’Œ<code>BookService</code>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">CartServlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">BookService</span> <span class="variable">bookService</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BookService</span>();</span><br><span class="line">    <span class="keyword">private</span> <span class="type">UserService</span> <span class="variable">userService</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserService</span>();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">protected</span> <span class="keyword">void</span> <span class="title function_">doGet</span><span class="params">(HttpServletRequest req, HttpServletResponse resp)</span> <span class="keyword">throws</span> ServletException, IOException &#123;</span><br><span class="line">        <span class="type">long</span> <span class="variable">currentUserId</span> <span class="operator">=</span> getFromCookie(req);</span><br><span class="line">        <span class="type">User</span> <span class="variable">currentUser</span> <span class="operator">=</span> userService.getUser(currentUserId);</span><br><span class="line">        <span class="type">Book</span> <span class="variable">book</span> <span class="operator">=</span> bookService.getBook(req.getParameter(<span class="string">&quot;bookId&quot;</span>));</span><br><span class="line">        cartService.addToCart(currentUser, book);</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç±»ä¼¼çš„ï¼Œåœ¨è´­ä¹°å†å²<code>HistoryServlet</code>ä¸­ï¼Œä¹Ÿéœ€è¦å®ä¾‹åŒ–<code>UserService</code>å’Œ<code>BookService</code>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">HistoryServlet</span> <span class="keyword">extends</span> <span class="title class_">HttpServlet</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">BookService</span> <span class="variable">bookService</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BookService</span>();</span><br><span class="line">    <span class="keyword">private</span> <span class="type">UserService</span> <span class="variable">userService</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserService</span>();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šè¿°æ¯ä¸ªç»„ä»¶éƒ½é‡‡ç”¨äº†ä¸€ç§ç®€å•çš„é€šè¿‡<code>new</code>åˆ›å»ºå®ä¾‹å¹¶æŒæœ‰çš„æ–¹å¼ã€‚ä»”ç»†è§‚å¯Ÿï¼Œä¼šå‘ç°ä»¥ä¸‹ç¼ºç‚¹ï¼š</p><ol><li>å®ä¾‹åŒ–ä¸€ä¸ªç»„ä»¶å…¶å®å¾ˆéš¾ï¼Œä¾‹å¦‚ï¼Œ<code>BookService</code>å’Œ<code>UserService</code>è¦åˆ›å»º<code>HikariDataSource</code>ï¼Œå®é™…ä¸Šéœ€è¦è¯»å–é…ç½®ï¼Œæ‰èƒ½å…ˆå®ä¾‹åŒ–<code>HikariConfig</code>ï¼Œå†å®ä¾‹åŒ–<code>HikariDataSource</code>ã€‚</li><li>æ²¡æœ‰å¿…è¦è®©<code>BookService</code>å’Œ<code>UserService</code>åˆ†åˆ«åˆ›å»º<code>DataSource</code>å®ä¾‹ï¼Œå®Œå…¨å¯ä»¥å…±äº«åŒä¸€ä¸ª<code>DataSource</code>ï¼Œä½†è°è´Ÿè´£åˆ›å»º<code>DataSource</code>ï¼Œè°è´Ÿè´£è·å–å…¶ä»–ç»„ä»¶å·²ç»åˆ›å»ºçš„<code>DataSource</code>ï¼Œä¸å¥½å¤„ç†ã€‚ç±»ä¼¼çš„ï¼Œ<code>CartServlet</code>å’Œ<code>HistoryServlet</code>ä¹Ÿåº”å½“å…±äº«<code>BookService</code>å®ä¾‹å’Œ<code>UserService</code>å®ä¾‹ï¼Œä½†ä¹Ÿä¸å¥½å¤„ç†ã€‚</li><li>å¾ˆå¤šç»„ä»¶éœ€è¦é”€æ¯ä»¥ä¾¿é‡Šæ”¾èµ„æºï¼Œä¾‹å¦‚<code>DataSource</code>ï¼Œä½†å¦‚æœè¯¥ç»„ä»¶è¢«å¤šä¸ªç»„ä»¶å…±äº«ï¼Œå¦‚ä½•ç¡®ä¿å®ƒçš„ä½¿ç”¨æ–¹éƒ½å·²ç»å…¨éƒ¨è¢«é”€æ¯ï¼Ÿ</li><li>éšç€æ›´å¤šçš„ç»„ä»¶è¢«å¼•å…¥ï¼Œä¾‹å¦‚ï¼Œä¹¦ç±è¯„è®ºï¼Œéœ€è¦å…±äº«çš„ç»„ä»¶å†™èµ·æ¥ä¼šæ›´å›°éš¾ï¼Œè¿™äº›ç»„ä»¶çš„ä¾èµ–å…³ç³»ä¼šè¶Šæ¥è¶Šå¤æ‚ã€‚</li><li>æµ‹è¯•æŸä¸ªç»„ä»¶ï¼Œä¾‹å¦‚<code>BookService</code>ï¼Œæ˜¯å¤æ‚çš„ï¼Œå› ä¸ºå¿…é¡»è¦åœ¨çœŸå®çš„æ•°æ®åº“ç¯å¢ƒä¸‹æ‰§è¡Œã€‚</li></ol><p>ä»ä¸Šé¢çš„ä¾‹å­å¯ä»¥çœ‹å‡ºï¼Œå¦‚æœ<strong>ä¸€ä¸ªç³»ç»Ÿæœ‰å¤§é‡çš„ç»„ä»¶</strong>ï¼Œå…¶ç”Ÿå‘½å‘¨æœŸå’Œç›¸äº’ä¹‹é—´çš„ä¾èµ–å…³ç³»<strong>å¦‚æœç”±ç»„ä»¶è‡ªèº«æ¥ç»´æŠ¤ï¼Œä¸ä½†å¤§å¤§å¢åŠ äº†ç³»ç»Ÿçš„å¤æ‚åº¦ï¼Œè€Œä¸”ä¼šå¯¼è‡´ç»„ä»¶ä¹‹é—´æä¸ºç´§å¯†çš„è€¦åˆï¼Œç»§è€Œç»™æµ‹è¯•å’Œç»´æŠ¤å¸¦æ¥äº†æå¤§çš„å›°éš¾ã€‚</strong></p><p>å› æ­¤ï¼Œæ ¸å¿ƒé—®é¢˜æ˜¯ï¼š</p><ol><li>è°è´Ÿè´£åˆ›å»ºç»„ä»¶ï¼Ÿ</li><li>è°è´Ÿè´£æ ¹æ®ä¾èµ–å…³ç³»ç»„è£…ç»„ä»¶ï¼Ÿ</li><li>é”€æ¯æ—¶ï¼Œå¦‚ä½•æŒ‰ä¾èµ–é¡ºåºæ­£ç¡®é”€æ¯ï¼Ÿ</li></ol><p>è§£å†³è¿™ä¸€é—®é¢˜çš„æ ¸å¿ƒæ–¹æ¡ˆå°±æ˜¯IoCã€‚</p><p>åœ¨IoCæ¨¡å¼ä¸‹ï¼Œæ§åˆ¶æƒå‘ç”Ÿäº†åè½¬ï¼Œå³ä»åº”ç”¨ç¨‹åºè½¬ç§»åˆ°äº†IoCå®¹å™¨ï¼Œ<strong>æ‰€æœ‰ç»„ä»¶ä¸å†ç”±åº”ç”¨ç¨‹åºè‡ªå·±åˆ›å»ºå’Œé…ç½®ï¼Œè€Œæ˜¯ç”±IoCå®¹å™¨è´Ÿè´£</strong>ï¼Œè¿™æ ·ï¼Œåº”ç”¨ç¨‹åºåªéœ€è¦ç›´æ¥ä½¿ç”¨å·²ç»åˆ›å»ºå¥½å¹¶ä¸”é…ç½®å¥½çš„ç»„ä»¶ã€‚ä¸ºäº†èƒ½è®©ç»„ä»¶åœ¨IoCå®¹å™¨ä¸­è¢«â€œè£…é…â€å‡ºæ¥ï¼Œéœ€è¦æŸç§â€œæ³¨å…¥â€æœºåˆ¶ï¼Œä¾‹å¦‚ï¼Œ<code>BookService</code>è‡ªå·±å¹¶ä¸ä¼šåˆ›å»º<code>DataSource</code>ï¼Œè€Œæ˜¯ç­‰å¾…å¤–éƒ¨é€šè¿‡<code>setDataSource()</code>æ–¹æ³•æ¥æ³¨å…¥ä¸€ä¸ª<code>DataSource</code>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookService</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> DataSource dataSource;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setDataSource</span><span class="params">(DataSource dataSource)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.dataSource = dataSource;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸ç›´æ¥<code>new</code>ä¸€ä¸ª<code>DataSource</code>ï¼Œè€Œæ˜¯æ³¨å…¥ä¸€ä¸ª<code>DataSource</code>ï¼Œè¿™ä¸ªå°å°çš„æ”¹åŠ¨è™½ç„¶ç®€å•ï¼Œå´å¸¦æ¥äº†ä¸€ç³»åˆ—å¥½å¤„ï¼š</p><ol><li><code>BookService</code>ä¸å†å…³å¿ƒå¦‚ä½•åˆ›å»º<code>DataSource</code>ï¼Œå› æ­¤ï¼Œä¸å¿…ç¼–å†™è¯»å–æ•°æ®åº“é…ç½®ä¹‹ç±»çš„ä»£ç ï¼›</li><li><code>DataSource</code>å®ä¾‹è¢«æ³¨å…¥åˆ°<code>BookService</code>ï¼ŒåŒæ ·ä¹Ÿå¯ä»¥æ³¨å…¥åˆ°<code>UserService</code>ï¼Œå› æ­¤ï¼Œå…±äº«ä¸€ä¸ªç»„ä»¶éå¸¸ç®€å•ï¼›</li><li>æµ‹è¯•<code>BookService</code>æ›´å®¹æ˜“ï¼Œå› ä¸ºæ³¨å…¥çš„æ˜¯<code>DataSource</code>ï¼Œå¯ä»¥ä½¿ç”¨å†…å­˜æ•°æ®åº“ï¼Œè€Œä¸æ˜¯çœŸå®çš„MySQLé…ç½®ã€‚</li></ol><p>IoCåˆç§°ä¸º<strong>ä¾èµ–æ³¨å…¥</strong>ï¼ˆDIï¼šDependency Injectionï¼‰ï¼Œå®ƒè§£å†³äº†ä¸€ä¸ªæœ€ä¸»è¦çš„é—®é¢˜ï¼š<strong>å°†ç»„ä»¶çš„åˆ›å»º+é…ç½®ä¸ç»„ä»¶çš„ä½¿ç”¨ç›¸åˆ†ç¦»ï¼Œå¹¶ä¸”ï¼Œç”±IoCå®¹å™¨è´Ÿè´£ç®¡ç†ç»„ä»¶çš„ç”Ÿå‘½å‘¨æœŸã€‚</strong></p><p>å› ä¸ºIoCå®¹å™¨è¦è´Ÿè´£å®ä¾‹åŒ–æ‰€æœ‰çš„ç»„ä»¶ï¼Œå› æ­¤ï¼Œæœ‰å¿…è¦å‘Šè¯‰å®¹å™¨å¦‚ä½•åˆ›å»ºç»„ä»¶ï¼Œä»¥åŠå„ç»„ä»¶çš„ä¾èµ–å…³ç³»ã€‚ä¸€ç§æœ€ç®€å•çš„é…ç½®æ˜¯é€šè¿‡XMLæ–‡ä»¶æ¥å®ç°ï¼Œä¾‹å¦‚ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">beans</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">class</span>=<span class="string">&quot;HikariDataSource&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;bookService&quot;</span> <span class="attr">class</span>=<span class="string">&quot;BookService&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userService&quot;</span> <span class="attr">class</span>=<span class="string">&quot;UserService&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure><p>ä¸Šè¿°XMLé…ç½®æ–‡ä»¶æŒ‡ç¤ºIoCå®¹å™¨åˆ›å»º3ä¸ªJavaBeanç»„ä»¶ï¼Œå¹¶æŠŠidä¸º<code>dataSource</code>çš„ç»„ä»¶é€šè¿‡å±æ€§<code>dataSource</code>ï¼ˆå³è°ƒç”¨<code>setDataSource()</code>æ–¹æ³•ï¼‰æ³¨å…¥åˆ°å¦å¤–ä¸¤ä¸ªç»„ä»¶ä¸­ã€‚</p><p>åœ¨Springçš„IoCå®¹å™¨ä¸­ï¼Œæˆ‘ä»¬æŠŠ<strong>æ‰€æœ‰ç»„ä»¶ç»Ÿç§°ä¸ºJavaBeanï¼Œå³é…ç½®ä¸€ä¸ªç»„ä»¶å°±æ˜¯é…ç½®ä¸€ä¸ªBeanã€‚</strong></p><p>æˆ‘ä»¬ä»ä¸Šé¢çš„ä»£ç å¯ä»¥çœ‹åˆ°ï¼Œä¾èµ–æ³¨å…¥å¯ä»¥é€šè¿‡<code>set()</code>æ–¹æ³•å®ç°ã€‚<strong>ä½†ä¾èµ–æ³¨å…¥ä¹Ÿå¯ä»¥é€šè¿‡æ„é€ æ–¹æ³•å®ç°ã€‚</strong></p><p>å¾ˆå¤šJavaç±»éƒ½å…·æœ‰å¸¦å‚æ•°çš„æ„é€ æ–¹æ³•ï¼Œå¦‚æœæˆ‘ä»¬æŠŠ<code>BookService</code>æ”¹é€ ä¸ºé€šè¿‡æ„é€ æ–¹æ³•æ³¨å…¥ï¼Œé‚£ä¹ˆå®ç°ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">BookService</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> DataSource dataSource;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">BookService</span><span class="params">(DataSource dataSource)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.dataSource = dataSource;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>Springçš„IoCå®¹å™¨åŒæ—¶æ”¯æŒå±æ€§æ³¨å…¥å’Œæ„é€ æ–¹æ³•æ³¨å…¥ï¼Œå¹¶å…è®¸æ··åˆä½¿ç”¨ã€‚</strong></p><p>Springçš„IoCå®¹å™¨æ˜¯ä¸€ä¸ª<strong>é«˜åº¦å¯æ‰©å±•çš„æ— ä¾µå…¥å®¹å™¨</strong>ã€‚æ‰€è°“æ— ä¾µå…¥ï¼Œ<strong>æ˜¯æŒ‡åº”ç”¨ç¨‹åºçš„ç»„ä»¶æ— éœ€å®ç°Springçš„ç‰¹å®šæ¥å£ï¼Œ</strong>æˆ–è€…è¯´ï¼Œç»„ä»¶æ ¹æœ¬ä¸çŸ¥é“è‡ªå·±åœ¨Springçš„å®¹å™¨ä¸­è¿è¡Œã€‚è¿™ç§æ— ä¾µå…¥çš„è®¾è®¡æœ‰ä»¥ä¸‹å¥½å¤„ï¼š</p><ol><li>åº”ç”¨ç¨‹åºç»„ä»¶æ—¢å¯ä»¥åœ¨Springçš„IoCå®¹å™¨ä¸­è¿è¡Œï¼Œä¹Ÿå¯ä»¥è‡ªå·±ç¼–å†™ä»£ç è‡ªè¡Œç»„è£…é…ç½®ï¼›</li><li><p>æµ‹è¯•çš„æ—¶å€™å¹¶ä¸ä¾èµ–Springå®¹å™¨ï¼Œå¯å•ç‹¬è¿›è¡Œæµ‹è¯•ï¼Œå¤§å¤§æé«˜äº†å¼€å‘æ•ˆç‡ã€‚</p><p><strong>å°ç»“ï¼š</strong></p></li></ol><p>IoCæ˜¯ä¸€ç§è®¾è®¡åŸåˆ™ï¼Œå…¶æ ¸å¿ƒæ€æƒ³æ˜¯<strong>å°†å¯¹è±¡çš„åˆ›å»ºå’Œç®¡ç†çš„æ§åˆ¶æƒä»ç¨‹åºä»£ç è½¬ç§»åˆ°å¤–éƒ¨å®¹å™¨</strong>ï¼Œè¿™ä¸ªå¤–éƒ¨å®¹å™¨é€šå¸¸æ˜¯ä¸€ä¸ªæ¡†æ¶ã€‚è¿™æ ·åšçš„ç›®çš„æ˜¯ä¸ºäº†<strong>é™ä½ç¨‹åºä»£ç ä¹‹é—´çš„è€¦åˆåº¦ï¼Œæé«˜ä»£ç çš„æ¨¡å—åŒ–å’Œå¯ç»´æŠ¤æ€§ã€‚</strong></p><h2 id="è£…é…Bean"><a href="#è£…é…Bean" class="headerlink" title="è£…é…Bean"></a>è£…é…Bean</h2><p>å› ä¸ºè®©å®¹å™¨æ¥ä¸ºæˆ‘ä»¬åˆ›å»ºå¹¶è£…é…Beanèƒ½è·å¾—å¾ˆå¤§çš„å¥½å¤„ï¼Œé‚£ä¹ˆåˆ°åº•å¦‚ä½•ä½¿ç”¨IoCå®¹å™¨ï¼Ÿè£…é…å¥½çš„Beanåˆå¦‚ä½•ä½¿ç”¨ï¼Ÿ</p><p>æˆ‘ä»¬æ¥çœ‹ä¸€ä¸ªå…·ä½“çš„ç”¨æˆ·æ³¨å†Œç™»å½•çš„ä¾‹å­ã€‚æ•´ä¸ªå·¥ç¨‹çš„ç»“æ„å¦‚ä¸‹ï¼š</p><p>é¦–å…ˆï¼Œæˆ‘ä»¬ç”¨Mavenåˆ›å»ºå·¥ç¨‹å¹¶å¼•å…¥<code>spring-context</code>ä¾èµ–ï¼š</p><ul><li>org.springframework:spring-context:6.0.0</li></ul><p>æˆ‘ä»¬å…ˆç¼–å†™ä¸€ä¸ª<code>MailService</code>ï¼Œç”¨äºåœ¨ç”¨æˆ·ç™»å½•å’Œæ³¨å†ŒæˆåŠŸåå‘é€é‚®ä»¶é€šçŸ¥ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MailService</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="type">ZoneId</span> <span class="variable">zoneId</span> <span class="operator">=</span> ZoneId.systemDefault();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setZoneId</span><span class="params">(ZoneId zoneId)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.zoneId = zoneId;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getTime</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> ZonedDateTime.now(<span class="built_in">this</span>.zoneId).format(DateTimeFormatter.ISO_ZONED_DATE_TIME);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sendLoginMail</span><span class="params">(User user)</span> &#123;</span><br><span class="line">        System.err.println(String.format(<span class="string">&quot;Hi, %s! You are logged in at %s&quot;</span>, user.getName(), getTime()));</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">sendRegistrationMail</span><span class="params">(User user)</span> &#123;</span><br><span class="line">        System.err.println(String.format(<span class="string">&quot;Welcome, %s!&quot;</span>, user.getName()));</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å†ç¼–å†™ä¸€ä¸ª<code>UserService</code>ï¼Œå®ç°ç”¨æˆ·æ³¨å†Œå’Œç™»å½•ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> MailService mailService;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">setMailService</span><span class="params">(MailService mailService)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.mailService = mailService;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> List&lt;User&gt; users = <span class="keyword">new</span> <span class="title class_">ArrayList</span>&lt;&gt;(List.of( <span class="comment">// users:</span></span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">User</span>(<span class="number">1</span>, <span class="string">&quot;bob@example.com&quot;</span>, <span class="string">&quot;password&quot;</span>, <span class="string">&quot;Bob&quot;</span>), <span class="comment">// bob</span></span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">User</span>(<span class="number">2</span>, <span class="string">&quot;alice@example.com&quot;</span>, <span class="string">&quot;password&quot;</span>, <span class="string">&quot;Alice&quot;</span>), <span class="comment">// alice</span></span><br><span class="line">            <span class="keyword">new</span> <span class="title class_">User</span>(<span class="number">3</span>, <span class="string">&quot;tom@example.com&quot;</span>, <span class="string">&quot;password&quot;</span>, <span class="string">&quot;Tom&quot;</span>))); <span class="comment">// tom</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">login</span><span class="params">(String email, String password)</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (User user : users) &#123;</span><br><span class="line">            <span class="keyword">if</span> (user.getEmail().equalsIgnoreCase(email) &amp;&amp; user.getPassword().equals(password)) &#123;</span><br><span class="line">                mailService.sendLoginMail(user);</span><br><span class="line">                <span class="keyword">return</span> user;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;login failed.&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">getUser</span><span class="params">(<span class="type">long</span> id)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span>.users.stream().filter(user -&gt; user.getId() == id).findFirst().orElseThrow();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">register</span><span class="params">(String email, String password, String name)</span> &#123;</span><br><span class="line">        users.forEach((user) -&gt; &#123;</span><br><span class="line">            <span class="keyword">if</span> (user.getEmail().equalsIgnoreCase(email)) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;email exist.&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">User</span>(users.stream().mapToLong(u -&gt; u.getId()).max().getAsLong() + <span class="number">1</span>, email, password, name);</span><br><span class="line">        users.add(user);</span><br><span class="line">        mailService.sendRegistrationMail(user);</span><br><span class="line">        <span class="keyword">return</span> user;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ³¨æ„åˆ°<code>UserService</code>é€šè¿‡<code>setMailService()</code>æ³¨å…¥äº†ä¸€ä¸ª<code>MailService</code>ã€‚</p><p>ç„¶åï¼Œæˆ‘ä»¬éœ€è¦ç¼–å†™ä¸€ä¸ªç‰¹å®šçš„<code>application.xml</code>é…ç½®æ–‡ä»¶ï¼Œå‘Šè¯‰Springçš„IoCå®¹å™¨åº”è¯¥å¦‚ä½•åˆ›å»ºå¹¶ç»„è£…Beanï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=<span class="string">&quot;1.0&quot;</span> encoding=<span class="string">&quot;UTF-8&quot;</span>?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="string"><span class="tag">        https://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;userService&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.itranswarp.learnjava.service.UserService&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;mailService&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;mailService&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;mailService&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.itranswarp.learnjava.service.MailService&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure><p>æ³¨æ„è§‚å¯Ÿä¸Šè¿°é…ç½®æ–‡ä»¶ï¼Œå…¶ä¸­ä¸XML Schemaç›¸å…³çš„éƒ¨åˆ†æ ¼å¼æ˜¯å›ºå®šçš„ï¼Œæˆ‘ä»¬åªå…³æ³¨ä¸¤ä¸ª<code>&lt;bean ...&gt;</code>çš„é…ç½®ï¼š</p><ul><li>æ¯ä¸ª<code>&lt;bean ...&gt;</code>éƒ½æœ‰ä¸€ä¸ª<code>id</code>æ ‡è¯†ï¼Œç›¸å½“äºBeançš„å”¯ä¸€IDï¼›</li><li>åœ¨<code>userService</code>Beanä¸­ï¼Œé€šè¿‡<code>&lt;property name=&quot;...&quot; ref=&quot;...&quot; /&gt;</code>æ³¨å…¥äº†å¦ä¸€ä¸ªBeanï¼›</li><li>Beançš„é¡ºåºä¸é‡è¦ï¼ŒSpringæ ¹æ®ä¾èµ–å…³ç³»ä¼šè‡ªåŠ¨æ­£ç¡®åˆå§‹åŒ–ã€‚</li></ul><p>æŠŠä¸Šè¿°XMLé…ç½®æ–‡ä»¶ç”¨Javaä»£ç å†™å‡ºæ¥ï¼Œå°±åƒè¿™æ ·ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">UserService</span> <span class="variable">userService</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">UserService</span>();</span><br><span class="line"><span class="type">MailService</span> <span class="variable">mailService</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MailService</span>();</span><br><span class="line">userService.setMailService(mailService);</span><br></pre></td></tr></table></figure><p>åªä¸è¿‡Springå®¹å™¨æ˜¯é€šè¿‡è¯»å–XMLæ–‡ä»¶åä½¿ç”¨åå°„å®Œæˆçš„ã€‚</p><p>å¦‚æœæ³¨å…¥çš„ä¸æ˜¯Beanï¼Œè€Œæ˜¯<code>boolean</code>ã€<code>int</code>ã€<code>String</code>è¿™æ ·çš„æ•°æ®ç±»å‹ï¼Œåˆ™é€šè¿‡<code>value</code>æ³¨å…¥ï¼Œä¾‹å¦‚ï¼Œåˆ›å»ºä¸€ä¸ª<code>HikariDataSource</code>ï¼š</p><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.zaxxer.hikari.HikariDataSource&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;jdbcUrl&quot;</span> <span class="attr">value</span>=<span class="string">&quot;jdbc:mysql://localhost:3306/test&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;password&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;maximumPoolSize&quot;</span> <span class="attr">value</span>=<span class="string">&quot;10&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;autoCommit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure><p>æœ€åä¸€æ­¥ï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºä¸€ä¸ªSpringçš„IoCå®¹å™¨å®ä¾‹ï¼Œç„¶ååŠ è½½é…ç½®æ–‡ä»¶ï¼Œè®©Springå®¹å™¨ä¸ºæˆ‘ä»¬åˆ›å»ºå¹¶è£…é…å¥½é…ç½®æ–‡ä»¶ä¸­æŒ‡å®šçš„æ‰€æœ‰Beanï¼Œè¿™åªéœ€è¦ä¸€è¡Œä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;application.xml&quot;</span>);</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±å¯ä»¥ä»Springå®¹å™¨ä¸­â€œå–å‡ºâ€è£…é…å¥½çš„Beanç„¶åä½¿ç”¨å®ƒï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è·å–Bean:</span></span><br><span class="line"><span class="type">UserService</span> <span class="variable">userService</span> <span class="operator">=</span> context.getBean(UserService.class);</span><br><span class="line"><span class="comment">// æ­£å¸¸è°ƒç”¨:</span></span><br><span class="line"><span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userService.login(<span class="string">&quot;bob@example.com&quot;</span>, <span class="string">&quot;password&quot;</span>);</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬ä»åˆ›å»ºSpringå®¹å™¨çš„ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">ClassPathXmlApplicationContext</span>(<span class="string">&quot;application.xml&quot;</span>);</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼ŒSpringå®¹å™¨å°±æ˜¯<code>ApplicationContext</code>ï¼Œå®ƒæ˜¯ä¸€ä¸ªæ¥å£ï¼Œæœ‰å¾ˆå¤šå®ç°ç±»ï¼Œè¿™é‡Œæˆ‘ä»¬é€‰æ‹©<code>ClassPathXmlApplicationContext</code>ï¼Œè¡¨ç¤ºå®ƒä¼šè‡ªåŠ¨ä»classpathä¸­æŸ¥æ‰¾æŒ‡å®šçš„XMLé…ç½®æ–‡ä»¶ã€‚</p><p>è·å¾—äº†<code>ApplicationContext</code>çš„å®ä¾‹ï¼Œå°±è·å¾—äº†IoCå®¹å™¨çš„å¼•ç”¨ã€‚ä»<code>ApplicationContext</code>ä¸­æˆ‘ä»¬å¯ä»¥æ ¹æ®Beançš„IDè·å–Beanï¼Œä½†æ›´å¤šçš„æ—¶å€™æˆ‘ä»¬æ ¹æ®Beançš„ç±»å‹è·å–Beançš„å¼•ç”¨ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">UserService</span> <span class="variable">userService</span> <span class="operator">=</span> context.getBean(UserService.class);</span><br></pre></td></tr></table></figure><p>Springè¿˜æä¾›å¦ä¸€ç§IoCå®¹å™¨å«<code>BeanFactory</code>ï¼Œä½¿ç”¨æ–¹å¼å’Œ<code>ApplicationContext</code>ç±»ä¼¼ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">BeanFactory</span> <span class="variable">factory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">XmlBeanFactory</span>(<span class="keyword">new</span> <span class="title class_">ClassPathResource</span>(<span class="string">&quot;application.xml&quot;</span>));</span><br><span class="line"><span class="type">MailService</span> <span class="variable">mailService</span> <span class="operator">=</span> factory.getBean(MailService.class);</span><br></pre></td></tr></table></figure><p><code>BeanFactory</code>å’Œ<code>ApplicationContext</code>çš„åŒºåˆ«åœ¨äºï¼Œ<code>BeanFactory</code>çš„å®ç°æ˜¯æŒ‰éœ€åˆ›å»ºï¼Œå³ç¬¬ä¸€æ¬¡è·å–Beanæ—¶æ‰åˆ›å»ºè¿™ä¸ªBeanï¼Œè€Œ<code>ApplicationContext</code>ä¼šä¸€æ¬¡æ€§åˆ›å»ºæ‰€æœ‰çš„Beanã€‚å®é™…ä¸Šï¼Œ<code>ApplicationContext</code>æ¥å£æ˜¯ä»<code>BeanFactory</code>æ¥å£ç»§æ‰¿è€Œæ¥çš„ï¼Œå¹¶ä¸”ï¼Œ<code>ApplicationContext</code>æä¾›äº†ä¸€äº›é¢å¤–çš„åŠŸèƒ½ï¼ŒåŒ…æ‹¬å›½é™…åŒ–æ”¯æŒã€äº‹ä»¶å’Œé€šçŸ¥æœºåˆ¶ç­‰ã€‚é€šå¸¸æƒ…å†µä¸‹ï¼Œ<strong>æˆ‘ä»¬æ€»æ˜¯ä½¿ç”¨<code>ApplicationContext</code>ï¼Œå¾ˆå°‘ä¼šè€ƒè™‘ä½¿ç”¨<code>BeanFactory</code>ã€‚</strong></p><p><strong>å°ç»“ï¼š</strong></p><p>Springçš„IoCå®¹å™¨æ¥å£æ˜¯<code>ApplicationContext</code>ï¼Œå¹¶æä¾›äº†å¤šç§å®ç°ç±»ï¼›</p><p>é€šè¿‡XMLé…ç½®æ–‡ä»¶åˆ›å»ºIoCå®¹å™¨æ—¶ï¼Œä½¿ç”¨<code>ClassPathXmlApplicationContext</code>ï¼›</p><p>æŒæœ‰IoCå®¹å™¨åï¼Œé€šè¿‡<code>getBean()</code>æ–¹æ³•è·å–Beançš„å¼•ç”¨ã€‚</p><h2 id="ä½¿ç”¨Annotationé…ç½®"><a href="#ä½¿ç”¨Annotationé…ç½®" class="headerlink" title="ä½¿ç”¨Annotationé…ç½®"></a>ä½¿ç”¨Annotationé…ç½®</h2><p>ä½¿ç”¨Springçš„IoCå®¹å™¨ï¼Œå®é™…ä¸Šå°±æ˜¯é€šè¿‡<strong>ç±»ä¼¼XMLè¿™æ ·çš„é…ç½®æ–‡ä»¶</strong>ï¼ŒæŠŠæˆ‘ä»¬è‡ªå·±çš„<strong>Beançš„ä¾èµ–å…³ç³»æè¿°å‡ºæ¥ï¼Œç„¶åè®©å®¹å™¨æ¥åˆ›å»ºå¹¶è£…é…Bean</strong>ã€‚ä¸€æ—¦å®¹å™¨åˆå§‹åŒ–å®Œæ¯•ï¼Œæˆ‘ä»¬å°±ç›´æ¥ä»å®¹å™¨ä¸­è·å–Beanä½¿ç”¨å®ƒä»¬ã€‚</p><p>æœ‰ï¼æˆ‘ä»¬å¯ä»¥ä½¿ç”¨Annotationé…ç½®ï¼Œå¯ä»¥å®Œå…¨ä¸éœ€è¦XMLï¼Œè®©Springè‡ªåŠ¨æ‰«æBeanå¹¶ç»„è£…å®ƒä»¬ã€‚</p><p>æˆ‘ä»¬æŠŠä¸Šä¸€èŠ‚çš„ç¤ºä¾‹æ”¹é€ ä¸€ä¸‹ï¼Œå…ˆåˆ é™¤XMLé…ç½®æ–‡ä»¶ï¼Œç„¶åï¼Œç»™<code>UserService</code>å’Œ<code>MailService</code>æ·»åŠ å‡ ä¸ªæ³¨è§£ã€‚</p><p>é¦–å…ˆï¼Œæˆ‘ä»¬ç»™<code>MailService</code>æ·»åŠ ä¸€ä¸ª<code>@Component</code>æ³¨è§£ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MailService</span> &#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ª<code>@Component</code>æ³¨è§£å°±ç›¸å½“äºå®šä¹‰äº†ä¸€ä¸ªBeanï¼Œå®ƒæœ‰ä¸€ä¸ªå¯é€‰çš„åç§°ï¼Œé»˜è®¤æ˜¯<code>mailService</code>ï¼Œå³å°å†™å¼€å¤´çš„ç±»åã€‚</p><p>ç„¶åï¼Œæˆ‘ä»¬ç»™<code>UserService</code>æ·»åŠ ä¸€ä¸ª<code>@Component</code>æ³¨è§£å’Œä¸€ä¸ª<code>@Autowired</code>æ³¨è§£ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    MailService mailService;</span><br><span class="line"></span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨<code>@Autowired</code>å°±ç›¸å½“äºæŠŠæŒ‡å®šç±»å‹çš„Beanæ³¨å…¥åˆ°æŒ‡å®šçš„å­—æ®µä¸­ã€‚å’ŒXMLé…ç½®ç›¸æ¯”ï¼Œ<code>@Autowired</code>å¤§å¹…ç®€åŒ–äº†æ³¨å…¥ï¼Œå› ä¸ºå®ƒä¸ä½†å¯ä»¥å†™åœ¨<code>set()</code>æ–¹æ³•ä¸Šï¼Œè¿˜å¯ä»¥ç›´æ¥å†™åœ¨å­—æ®µä¸Šï¼Œç”šè‡³å¯ä»¥å†™åœ¨æ„é€ æ–¹æ³•ä¸­ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    MailService mailService;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">UserService</span><span class="params">(<span class="meta">@Autowired</span> MailService mailService)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.mailService = mailService;</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬ä¸€èˆ¬æŠŠ<code>@Autowired</code>å†™åœ¨å­—æ®µä¸Šï¼Œé€šå¸¸ä½¿ç”¨packageæƒé™çš„å­—æ®µï¼Œä¾¿äºæµ‹è¯•ã€‚</p><p>æœ€åï¼Œç¼–å†™ä¸€ä¸ª<code>AppConfig</code>ç±»å¯åŠ¨å®¹å™¨ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AppConfig</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title function_">main</span><span class="params">(String[] args)</span> &#123;</span><br><span class="line">        <span class="type">ApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AnnotationConfigApplicationContext</span>(AppConfig.class);</span><br><span class="line">        <span class="type">UserService</span> <span class="variable">userService</span> <span class="operator">=</span> context.getBean(UserService.class);</span><br><span class="line">        <span class="type">User</span> <span class="variable">user</span> <span class="operator">=</span> userService.login(<span class="string">&quot;bob@example.com&quot;</span>, <span class="string">&quot;password&quot;</span>);</span><br><span class="line">        System.out.println(user.getName());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é™¤äº†<code>main()</code>æ–¹æ³•å¤–ï¼Œ<code>AppConfig</code>æ ‡æ³¨äº†<code>@Configuration</code>ï¼Œè¡¨ç¤ºå®ƒæ˜¯ä¸€ä¸ªé…ç½®ç±»ï¼Œå› ä¸ºæˆ‘ä»¬åˆ›å»º<code>ApplicationContext</code>æ—¶ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">ApplicationContext</span> <span class="variable">context</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">AnnotationConfigApplicationContext</span>(AppConfig.class);</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨çš„å®ç°ç±»æ˜¯<code>AnnotationConfigApplicationContext</code>ï¼Œ<strong>å¿…é¡»ä¼ å…¥ä¸€ä¸ªæ ‡æ³¨äº†<code>@Configuration</code>çš„ç±»åã€‚</strong></p><p>æ­¤å¤–ï¼Œ<code>AppConfig</code>è¿˜æ ‡æ³¨äº†<code>@ComponentScan</code>ï¼Œå®ƒå‘Šè¯‰å®¹å™¨ï¼Œè‡ªåŠ¨æœç´¢å½“å‰ç±»æ‰€åœ¨çš„åŒ…ä»¥åŠå­åŒ…ï¼ŒæŠŠæ‰€æœ‰æ ‡æ³¨ä¸º<code>@Component</code>çš„Beanè‡ªåŠ¨åˆ›å»ºå‡ºæ¥ï¼Œå¹¶æ ¹æ®<code>@Autowired</code>è¿›è¡Œè£…é…ã€‚</p><p>ä½¿ç”¨Annotationé…åˆè‡ªåŠ¨æ‰«æèƒ½å¤§å¹…ç®€åŒ–Springçš„é…ç½®ï¼Œæˆ‘ä»¬åªéœ€è¦ä¿è¯ï¼š</p><ul><li>æ¯ä¸ªBeanè¢«æ ‡æ³¨ä¸º<code>@Component</code>å¹¶æ­£ç¡®ä½¿ç”¨<code>@Autowired</code>æ³¨å…¥ï¼›</li><li>é…ç½®ç±»è¢«æ ‡æ³¨ä¸º<code>@Configuration</code>å’Œ<code>@ComponentScan</code>ï¼›</li><li>æ‰€æœ‰Beanå‡åœ¨æŒ‡å®šåŒ…ä»¥åŠå­åŒ…å†…ã€‚</li></ul><p>ä½¿ç”¨<code>@ComponentScan</code>éå¸¸æ–¹ä¾¿ï¼Œä½†æ˜¯ï¼Œæˆ‘ä»¬ä¹Ÿè¦ç‰¹åˆ«æ³¨æ„åŒ…çš„å±‚æ¬¡ç»“æ„ã€‚é€šå¸¸æ¥è¯´ï¼Œå¯åŠ¨é…ç½®<code>AppConfig</code>ä½äºè‡ªå®šä¹‰çš„é¡¶å±‚åŒ…ï¼ˆä¾‹å¦‚<code>com.itranswarp.learnjava</code>ï¼‰ï¼Œå…¶ä»–BeanæŒ‰ç±»åˆ«æ”¾å…¥å­åŒ…ã€‚</p><p><strong>å°ç»“ï¼š</strong></p><p>ä½¿ç”¨<strong>Annotationå¯ä»¥å¤§å¹…ç®€åŒ–é…ç½®ï¼Œæ¯ä¸ªBeané€šè¿‡<code>@Component</code>å’Œ<code>@Autowired</code>æ³¨å…¥ï¼›</strong></p><p>å¿…é¡»åˆç†è®¾è®¡åŒ…çš„å±‚æ¬¡ç»“æ„ï¼Œæ‰èƒ½å‘æŒ¥<code>@ComponentScan</code>çš„å¨åŠ›ã€‚</p><h2 id="å®šåˆ¶Bean"><a href="#å®šåˆ¶Bean" class="headerlink" title="å®šåˆ¶Bean"></a>å®šåˆ¶Bean</h2><p>å¯¹äºSpringå®¹å™¨æ¥è¯´ï¼Œå½“æˆ‘ä»¬æŠŠä¸€ä¸ªBeanæ ‡è®°ä¸º<code>@Component</code>åï¼Œå®ƒå°±ä¼šè‡ªåŠ¨ä¸ºæˆ‘ä»¬åˆ›å»ºä¸€ä¸ªå•ä¾‹ï¼ˆSingletonï¼‰ï¼Œå³å®¹å™¨åˆå§‹åŒ–æ—¶åˆ›å»ºBeanï¼Œå®¹å™¨å…³é—­å‰é”€æ¯Beanã€‚åœ¨å®¹å™¨è¿è¡ŒæœŸé—´ï¼Œæˆ‘ä»¬è°ƒç”¨<code>getBean(Class)</code>è·å–åˆ°çš„Beanæ€»æ˜¯åŒä¸€ä¸ªå®ä¾‹ã€‚</p><p>è¿˜æœ‰ä¸€ç§Beanï¼Œæˆ‘ä»¬æ¯æ¬¡è°ƒç”¨<code>getBean(Class)</code>ï¼Œå®¹å™¨éƒ½è¿”å›ä¸€ä¸ªæ–°çš„å®ä¾‹ï¼Œè¿™ç§Beanç§°ä¸ºPrototypeï¼ˆåŸå‹ï¼‰ï¼Œå®ƒçš„ç”Ÿå‘½å‘¨æœŸæ˜¾ç„¶å’ŒSingletonä¸åŒã€‚å£°æ˜ä¸€ä¸ªPrototypeçš„Beanæ—¶ï¼Œéœ€è¦æ·»åŠ ä¸€ä¸ªé¢å¤–çš„<code>@Scope</code>æ³¨è§£ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Scope(ConfigurableBeanFactory.SCOPE_PROTOTYPE)</span> <span class="comment">// @Scope(&quot;prototype&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MailSession</span> &#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ‰äº›æ—¶å€™ï¼Œæˆ‘ä»¬ä¼šæœ‰ä¸€ç³»åˆ—æ¥å£ç›¸åŒï¼Œä¸åŒå®ç°ç±»çš„Beanã€‚ä¾‹å¦‚ï¼Œæ³¨å†Œç”¨æˆ·æ—¶ï¼Œæˆ‘ä»¬è¦å¯¹emailã€passwordå’Œnameè¿™3ä¸ªå˜é‡è¿›è¡ŒéªŒè¯ã€‚ä¸ºäº†ä¾¿äºæ‰©å±•ï¼Œæˆ‘ä»¬å…ˆå®šä¹‰éªŒè¯æ¥å£ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">interface</span> <span class="title class_">Validator</span> &#123;</span><br><span class="line">    <span class="keyword">void</span> <span class="title function_">validate</span><span class="params">(String email, String password, String name)</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åï¼Œåˆ†åˆ«ä½¿ç”¨3ä¸ª<code>Validator</code>å¯¹ç”¨æˆ·å‚æ•°è¿›è¡ŒéªŒè¯ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EmailValidator</span> <span class="keyword">implements</span> <span class="title class_">Validator</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">validate</span><span class="params">(String email, String password, String name)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (!email.matches(<span class="string">&quot;^[a-z0-9]+\\@[a-z0-9]+\\.[a-z]&#123;2,10&#125;$&quot;</span>)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;invalid email: &quot;</span> + email);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PasswordValidator</span> <span class="keyword">implements</span> <span class="title class_">Validator</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">validate</span><span class="params">(String email, String password, String name)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (!password.matches(<span class="string">&quot;^.&#123;6,20&#125;$&quot;</span>)) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;invalid password&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">NameValidator</span> <span class="keyword">implements</span> <span class="title class_">Validator</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">validate</span><span class="params">(String email, String password, String name)</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (name == <span class="literal">null</span> || name.isBlank() || name.length() &gt; <span class="number">20</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">IllegalArgumentException</span>(<span class="string">&quot;invalid name: &quot;</span> + name);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ€åï¼Œæˆ‘ä»¬é€šè¿‡ä¸€ä¸ª<code>Validators</code>ä½œä¸ºå…¥å£è¿›è¡ŒéªŒè¯ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">Validators</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    List&lt;Validator&gt; validators;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">validate</span><span class="params">(String email, String password, String name)</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> validator : <span class="built_in">this</span>.validators) &#123;</span><br><span class="line">            validator.validate(email, password, name);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ³¨æ„åˆ°<code>Validators</code>è¢«æ³¨å…¥äº†ä¸€ä¸ª<code>List&lt;Validator&gt;</code>ï¼ŒSpringä¼šè‡ªåŠ¨æŠŠæ‰€æœ‰ç±»å‹ä¸º<code>Validator</code>çš„Beanè£…é…ä¸ºä¸€ä¸ª<code>List</code>æ³¨å…¥è¿›æ¥ï¼Œè¿™æ ·ä¸€æ¥ï¼Œæˆ‘ä»¬æ¯æ–°å¢ä¸€ä¸ª<code>Validator</code>ç±»å‹ï¼Œå°±è‡ªåŠ¨è¢«Springè£…é…åˆ°<code>Validators</code>ä¸­äº†ï¼Œéå¸¸æ–¹ä¾¿ã€‚</p><p>å› ä¸ºSpringæ˜¯é€šè¿‡æ‰«æclasspathè·å–åˆ°æ‰€æœ‰çš„Beanï¼Œè€Œ<code>List</code>æ˜¯æœ‰åºçš„ï¼Œè¦æŒ‡å®š<code>List</code>ä¸­Beançš„é¡ºåºï¼Œå¯ä»¥åŠ ä¸Š<code>@Order</code>æ³¨è§£ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Order(1)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">EmailValidator</span> <span class="keyword">implements</span> <span class="title class_">Validator</span> &#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Order(2)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PasswordValidator</span> <span class="keyword">implements</span> <span class="title class_">Validator</span> &#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Order(3)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">NameValidator</span> <span class="keyword">implements</span> <span class="title class_">Validator</span> &#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å¯é€‰æ³¨å…¥"><a href="#å¯é€‰æ³¨å…¥" class="headerlink" title="å¯é€‰æ³¨å…¥"></a>å¯é€‰æ³¨å…¥</h3><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œå½“æˆ‘ä»¬æ ‡è®°äº†ä¸€ä¸ª<code>@Autowired</code>åï¼ŒSpringå¦‚æœæ²¡æœ‰æ‰¾åˆ°å¯¹åº”ç±»å‹çš„Beanï¼Œå®ƒä¼šæŠ›å‡º<code>NoSuchBeanDefinitionException</code>å¼‚å¸¸ã€‚</p><p>å¯ä»¥ç»™<code>@Autowired</code>å¢åŠ ä¸€ä¸ª<code>required = false</code>çš„å‚æ•°ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MailService</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired(required = false)</span></span><br><span class="line">    <span class="type">ZoneId</span> <span class="variable">zoneId</span> <span class="operator">=</span> ZoneId.systemDefault();</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="åˆ›å»ºç¬¬ä¸‰æ–¹Bean"><a href="#åˆ›å»ºç¬¬ä¸‰æ–¹Bean" class="headerlink" title="åˆ›å»ºç¬¬ä¸‰æ–¹Bean"></a>åˆ›å»ºç¬¬ä¸‰æ–¹Bean</h3><p>è¿™ä¸ªå‚æ•°å‘Šè¯‰Springå®¹å™¨ï¼Œå¦‚æœæ‰¾åˆ°ä¸€ä¸ªç±»å‹ä¸º<code>ZoneId</code>çš„Beanï¼Œå°±æ³¨å…¥ï¼Œå¦‚æœæ‰¾ä¸åˆ°ï¼Œå°±å¿½ç•¥ã€‚</p><p>è¿™ç§æ–¹å¼éå¸¸é€‚åˆæœ‰å®šä¹‰å°±ä½¿ç”¨å®šä¹‰ï¼Œæ²¡æœ‰å°±ä½¿ç”¨é»˜è®¤å€¼çš„æƒ…å†µã€‚</p><p>å¦‚æœä¸€ä¸ªBeanä¸åœ¨æˆ‘ä»¬è‡ªå·±çš„packageç®¡ç†ä¹‹å†…ï¼Œä¾‹å¦‚<code>ZoneId</code>ï¼Œå¦‚ä½•åˆ›å»ºå®ƒï¼Ÿ</p><p>ç­”æ¡ˆæ˜¯æˆ‘ä»¬è‡ªå·±åœ¨<code>@Configuration</code>ç±»ä¸­ç¼–å†™ä¸€ä¸ªJavaæ–¹æ³•åˆ›å»ºå¹¶è¿”å›å®ƒï¼Œæ³¨æ„ç»™æ–¹æ³•æ ‡è®°ä¸€ä¸ª<code>@Bean</code>æ³¨è§£ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AppConfig</span> &#123;</span><br><span class="line">    <span class="comment">// åˆ›å»ºä¸€ä¸ªBean:</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    ZoneId <span class="title function_">createZoneId</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> ZoneId.of(<span class="string">&quot;Z&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Springå¯¹æ ‡è®°ä¸º<code>@Bean</code>çš„æ–¹æ³•åªè°ƒç”¨ä¸€æ¬¡ï¼Œå› æ­¤è¿”å›çš„Beanä»ç„¶æ˜¯å•ä¾‹ã€‚</p><h3 id="åˆå§‹åŒ–å’Œé”€æ¯"><a href="#åˆå§‹åŒ–å’Œé”€æ¯" class="headerlink" title="åˆå§‹åŒ–å’Œé”€æ¯"></a>åˆå§‹åŒ–å’Œé”€æ¯</h3><p>æœ‰äº›æ—¶å€™ï¼Œä¸€ä¸ªBeanåœ¨æ³¨å…¥å¿…è¦çš„ä¾èµ–åï¼Œéœ€è¦è¿›è¡Œåˆå§‹åŒ–ï¼ˆç›‘å¬æ¶ˆæ¯ç­‰ï¼‰ã€‚åœ¨å®¹å™¨å…³é—­æ—¶ï¼Œæœ‰æ—¶å€™è¿˜éœ€è¦æ¸…ç†èµ„æºï¼ˆå…³é—­è¿æ¥æ± ç­‰ï¼‰ã€‚æˆ‘ä»¬é€šå¸¸ä¼šå®šä¹‰ä¸€ä¸ª<code>init()</code>æ–¹æ³•è¿›è¡Œåˆå§‹åŒ–ï¼Œå®šä¹‰ä¸€ä¸ª<code>shutdown()</code>æ–¹æ³•è¿›è¡Œæ¸…ç†ï¼Œç„¶åï¼Œå¼•å…¥JSR-250å®šä¹‰çš„Annotationï¼š</p><ul><li>jakarta.annotation:jakarta.annotation-api:2.1.1</li></ul><p>åœ¨Beançš„åˆå§‹åŒ–å’Œæ¸…ç†æ–¹æ³•ä¸Šæ ‡è®°<code>@PostConstruct</code>å’Œ<code>@PreDestroy</code>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MailService</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired(required = false)</span></span><br><span class="line">    <span class="type">ZoneId</span> <span class="variable">zoneId</span> <span class="operator">=</span> ZoneId.systemDefault();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostConstruct</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Init mail service with zoneId = &quot;</span> + <span class="built_in">this</span>.zoneId);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PreDestroy</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">shutdown</span><span class="params">()</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;Shutdown mail service&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Springå®¹å™¨ä¼šå¯¹ä¸Šè¿°Beanåšå¦‚ä¸‹åˆå§‹åŒ–æµç¨‹ï¼š</p><ul><li>è°ƒç”¨æ„é€ æ–¹æ³•åˆ›å»º<code>MailService</code>å®ä¾‹ï¼›</li><li>æ ¹æ®<code>@Autowired</code>è¿›è¡Œæ³¨å…¥ï¼›</li><li>è°ƒç”¨æ ‡è®°æœ‰<code>@PostConstruct</code>çš„<code>init()</code>æ–¹æ³•è¿›è¡Œåˆå§‹åŒ–ã€‚</li></ul><p>è€Œé”€æ¯æ—¶ï¼Œå®¹å™¨ä¼šé¦–å…ˆè°ƒç”¨æ ‡è®°æœ‰<code>@PreDestroy</code>çš„<code>shutdown()</code>æ–¹æ³•ã€‚</p><p>Springåªæ ¹æ®AnnotationæŸ¥æ‰¾<em>æ— å‚æ•°</em>æ–¹æ³•ï¼Œå¯¹æ–¹æ³•åä¸ä½œè¦æ±‚ã€‚</p><h3 id="ä½¿ç”¨åˆ«å"><a href="#ä½¿ç”¨åˆ«å" class="headerlink" title="ä½¿ç”¨åˆ«å"></a>ä½¿ç”¨åˆ«å</h3><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œå¯¹ä¸€ç§ç±»å‹çš„Beanï¼Œå®¹å™¨åªåˆ›å»ºä¸€ä¸ªå®ä¾‹ã€‚ä½†æœ‰äº›æ—¶å€™ï¼Œæˆ‘ä»¬éœ€è¦å¯¹ä¸€ç§ç±»å‹çš„Beanåˆ›å»ºå¤šä¸ªå®ä¾‹ã€‚ä¾‹å¦‚ï¼ŒåŒæ—¶è¿æ¥å¤šä¸ªæ•°æ®åº“ï¼Œå°±å¿…é¡»åˆ›å»ºå¤šä¸ª<code>DataSource</code>å®ä¾‹ã€‚</p><p>å¦‚æœæˆ‘ä»¬åœ¨<code>@Configuration</code>ç±»ä¸­åˆ›å»ºäº†å¤šä¸ªåŒç±»å‹çš„Beanï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AppConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    ZoneId <span class="title function_">createZoneOfZ</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> ZoneId.of(<span class="string">&quot;Z&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    ZoneId <span class="title function_">createZoneOfUTC8</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> ZoneId.of(<span class="string">&quot;UTC+08:00&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Springä¼šæŠ¥<code>NoUniqueBeanDefinitionException</code>å¼‚å¸¸ï¼Œæ„æ€æ˜¯å‡ºç°äº†é‡å¤çš„Beanå®šä¹‰ã€‚</p><p>è¿™ä¸ªæ—¶å€™ï¼Œéœ€è¦ç»™æ¯ä¸ªBeanæ·»åŠ ä¸åŒçš„åå­—ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AppConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Bean(&quot;z&quot;)</span></span><br><span class="line">    ZoneId <span class="title function_">createZoneOfZ</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> ZoneId.of(<span class="string">&quot;Z&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@Qualifier(&quot;utc8&quot;)</span></span><br><span class="line">    ZoneId <span class="title function_">createZoneOfUTC8</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> ZoneId.of(<span class="string">&quot;UTC+08:00&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥ç”¨<code>@Bean(&quot;name&quot;)</code>æŒ‡å®šåˆ«åï¼Œä¹Ÿå¯ä»¥ç”¨<code>@Bean</code>+<code>@Qualifier(&quot;name&quot;)</code>æŒ‡å®šåˆ«åã€‚</p><p>å­˜åœ¨å¤šä¸ªåŒç±»å‹çš„Beanæ—¶ï¼Œæ³¨å…¥<code>ZoneId</code>åˆä¼šæŠ¥é”™ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">NoUniqueBeanDefinitionException: No qualifying bean of type &#x27;java.time.ZoneId&#x27; available: expected single matching bean but found 2</span><br></pre></td></tr></table></figure><p>æ„æ€æ˜¯æœŸå¾…æ‰¾åˆ°å”¯ä¸€çš„<code>ZoneId</code>ç±»å‹Beanï¼Œä½†æ˜¯æ‰¾åˆ°ä¸¤ã€‚å› æ­¤ï¼Œæ³¨å…¥æ—¶ï¼Œè¦æŒ‡å®šBeançš„åç§°ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MailService</span> &#123;</span><br><span class="line"><span class="meta">@Autowired(required = false)</span></span><br><span class="line"><span class="meta">@Qualifier(&quot;z&quot;)</span> <span class="comment">// æŒ‡å®šæ³¨å…¥åç§°ä¸º&quot;z&quot;çš„ZoneId</span></span><br><span class="line"><span class="type">ZoneId</span> <span class="variable">zoneId</span> <span class="operator">=</span> ZoneId.systemDefault();</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿˜æœ‰ä¸€ç§æ–¹æ³•æ˜¯æŠŠå…¶ä¸­æŸä¸ªBeanæŒ‡å®šä¸º<code>@Primary</code>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AppConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@Primary</span> <span class="comment">// æŒ‡å®šä¸ºä¸»è¦Bean</span></span><br><span class="line">    <span class="meta">@Qualifier(&quot;z&quot;)</span></span><br><span class="line">    ZoneId <span class="title function_">createZoneOfZ</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> ZoneId.of(<span class="string">&quot;Z&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@Qualifier(&quot;utc8&quot;)</span></span><br><span class="line">    ZoneId <span class="title function_">createZoneOfUTC8</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> ZoneId.of(<span class="string">&quot;UTC+08:00&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™æ ·ï¼Œåœ¨æ³¨å…¥æ—¶ï¼Œå¦‚æœæ²¡æœ‰æŒ‡å‡ºBeançš„åå­—ï¼ŒSpringä¼šæ³¨å…¥æ ‡è®°æœ‰<code>@Primary</code>çš„Beanã€‚è¿™ç§æ–¹å¼ä¹Ÿå¾ˆå¸¸ç”¨ã€‚ä¾‹å¦‚ï¼Œå¯¹äºä¸»ä»ä¸¤ä¸ªæ•°æ®æºï¼Œé€šå¸¸å°†ä¸»æ•°æ®æºå®šä¹‰ä¸º<code>@Primary</code>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AppConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@Primary</span></span><br><span class="line">    DataSource <span class="title function_">createMasterDataSource</span><span class="params">()</span> &#123;</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@Qualifier(&quot;slave&quot;)</span></span><br><span class="line">    DataSource <span class="title function_">createSlaveDataSource</span><span class="params">()</span> &#123;</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…¶ä»–Beané»˜è®¤æ³¨å…¥çš„å°±æ˜¯ä¸»æ•°æ®æºã€‚å¦‚æœè¦æ³¨å…¥ä»æ•°æ®æºï¼Œé‚£ä¹ˆåªéœ€è¦æŒ‡å®šåç§°å³å¯ã€‚</p><h3 id="ä½¿ç”¨FactoryBean"><a href="#ä½¿ç”¨FactoryBean" class="headerlink" title="ä½¿ç”¨FactoryBean"></a>ä½¿ç”¨FactoryBean</h3><p>æˆ‘ä»¬åœ¨è®¾è®¡æ¨¡å¼çš„<a href="https://liaoxuefeng.com/books/java/design-patterns/creational/factory-method/index.html">å·¥å‚æ–¹æ³•</a>ä¸­è®²åˆ°ï¼Œå¾ˆå¤šæ—¶å€™ï¼Œå¯ä»¥é€šè¿‡å·¥å‚æ¨¡å¼åˆ›å»ºå¯¹è±¡ã€‚Springä¹Ÿæä¾›äº†å·¥å‚æ¨¡å¼ï¼Œå…è®¸å®šä¹‰ä¸€ä¸ªå·¥å‚ï¼Œç„¶åç”±å·¥å‚åˆ›å»ºçœŸæ­£çš„Beanã€‚</p><p>ç”¨å·¥å‚æ¨¡å¼åˆ›å»ºBeanéœ€è¦å®ç°<code>FactoryBean</code>æ¥å£ã€‚æˆ‘ä»¬è§‚å¯Ÿä¸‹é¢çš„ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">ZoneIdFactoryBean</span> <span class="keyword">implements</span> <span class="title class_">FactoryBean</span>&lt;ZoneId&gt; &#123;</span><br><span class="line"></span><br><span class="line">    <span class="type">String</span> <span class="variable">zone</span> <span class="operator">=</span> <span class="string">&quot;Z&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> ZoneId <span class="title function_">getObject</span><span class="params">()</span> <span class="keyword">throws</span> Exception &#123;</span><br><span class="line">        <span class="keyword">return</span> ZoneId.of(zone);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Class&lt;?&gt; getObjectType() &#123;</span><br><span class="line">        <span class="keyword">return</span> ZoneId.class;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å½“ä¸€ä¸ªBeanå®ç°äº†<code>FactoryBean</code>æ¥å£åï¼ŒSpringä¼šå…ˆå®ä¾‹åŒ–è¿™ä¸ªå·¥å‚ï¼Œç„¶åè°ƒç”¨<code>getObject()</code>åˆ›å»ºçœŸæ­£çš„Beanã€‚<code>getObjectType()</code>å¯ä»¥æŒ‡å®šåˆ›å»ºçš„Beançš„ç±»å‹ï¼Œå› ä¸ºæŒ‡å®šç±»å‹ä¸ä¸€å®šä¸å®é™…ç±»å‹ä¸€è‡´ï¼Œå¯ä»¥æ˜¯æ¥å£æˆ–æŠ½è±¡ç±»ã€‚</p><p>å› æ­¤ï¼Œå¦‚æœå®šä¹‰äº†ä¸€ä¸ª<code>FactoryBean</code>ï¼Œè¦æ³¨æ„Springåˆ›å»ºçš„Beanå®é™…ä¸Šæ˜¯è¿™ä¸ª<code>FactoryBean</code>çš„<code>getObject()</code>æ–¹æ³•è¿”å›çš„Beanã€‚ä¸ºäº†å’Œæ™®é€šBeanåŒºåˆ†ï¼Œæˆ‘ä»¬é€šå¸¸éƒ½ä»¥<code>XxxFactoryBean</code>å‘½åã€‚</p><p>ç”±äºå¯ä»¥ç”¨<code>@Bean</code>æ–¹æ³•åˆ›å»ºç¬¬ä¸‰æ–¹Beanï¼Œæœ¬è´¨ä¸Š<code>@Bean</code>æ–¹æ³•å°±æ˜¯å·¥å‚æ–¹æ³•ï¼Œæ‰€ä»¥ï¼Œ<code>FactoryBean</code>å·²ç»ç”¨å¾—è¶Šæ¥è¶Šå°‘äº†ã€‚</p><p><strong>å°ç»“ï¼š</strong></p><p>Springé»˜è®¤ä½¿ç”¨Singletonåˆ›å»ºBeanï¼Œä¹Ÿå¯æŒ‡å®šScopeä¸ºPrototypeï¼›</p><p>å¯å°†ç›¸åŒç±»å‹çš„Beanæ³¨å…¥<code>List</code>æˆ–æ•°ç»„ï¼›</p><p>å¯ç”¨<code>@Autowired(required=false)</code>å…è®¸å¯é€‰æ³¨å…¥ï¼›</p><p>å¯ç”¨å¸¦<code>@Bean</code>æ ‡æ³¨çš„æ–¹æ³•åˆ›å»ºBeanï¼›</p><p>å¯ä½¿ç”¨<code>@PostConstruct</code>å’Œ<code>@PreDestroy</code>å¯¹Beanè¿›è¡Œåˆå§‹åŒ–å’Œæ¸…ç†ï¼›</p><p>ç›¸åŒç±»å‹çš„Beanåªèƒ½æœ‰ä¸€ä¸ªæŒ‡å®šä¸º<code>@Primary</code>ï¼Œå…¶ä»–å¿…é¡»ç”¨<code>@Qualifier(&quot;beanName&quot;)</code>æŒ‡å®šåˆ«åï¼›</p><p>æ³¨å…¥æ—¶ï¼Œå¯é€šè¿‡åˆ«å<code>@Qualifier(&quot;beanName&quot;)</code>æŒ‡å®šæŸä¸ªBeanï¼›</p><p>å¯ä»¥å®šä¹‰<code>FactoryBean</code>æ¥ä½¿ç”¨å·¥å‚æ¨¡å¼åˆ›å»ºBeanã€‚</p><h2 id="ä½¿ç”¨Resource"><a href="#ä½¿ç”¨Resource" class="headerlink" title="ä½¿ç”¨Resource"></a>ä½¿ç”¨Resource</h2><p>åœ¨Javaç¨‹åºä¸­ï¼Œæˆ‘ä»¬ç»å¸¸ä¼šè¯»å–é…ç½®æ–‡ä»¶ã€èµ„æºæ–‡ä»¶ç­‰ã€‚ä½¿ç”¨Springå®¹å™¨æ—¶ï¼Œæˆ‘ä»¬ä¹Ÿå¯ä»¥æŠŠâ€œæ–‡ä»¶â€æ³¨å…¥è¿›æ¥ï¼Œæ–¹ä¾¿ç¨‹åºè¯»å–ã€‚</p><p>ä¾‹å¦‚ï¼ŒAppServiceéœ€è¦è¯»å–<code>logo.txt</code>è¿™ä¸ªæ–‡ä»¶ï¼Œé€šå¸¸æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬éœ€è¦å†™å¾ˆå¤šç¹ççš„ä»£ç ï¼Œä¸»è¦æ˜¯ä¸ºäº†å®šä½æ–‡ä»¶ï¼Œæ‰“å¼€InputStreamã€‚</p><p>Springæä¾›äº†ä¸€ä¸ª<code>org.springframework.core.io.Resource</code>ï¼ˆæ³¨æ„ä¸æ˜¯<code>jarkata.annotation.Resource</code>æˆ–<code>javax.annotation.Resource</code>ï¼‰ï¼Œå®ƒå¯ä»¥åƒ<code>String</code>ã€<code>int</code>ä¸€æ ·ä½¿ç”¨<code>@Value</code>æ³¨å…¥ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AppService</span> &#123;</span><br><span class="line">    <span class="meta">@Value(&quot;classpath:/logo.txt&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Resource resource;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String logo;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostConstruct</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">init</span><span class="params">()</span> <span class="keyword">throws</span> IOException &#123;</span><br><span class="line">        <span class="keyword">try</span> (<span class="type">var</span> <span class="variable">reader</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">BufferedReader</span>(</span><br><span class="line">                <span class="keyword">new</span> <span class="title class_">InputStreamReader</span>(resource.getInputStream(), StandardCharsets.UTF_8))) &#123;</span><br><span class="line">            <span class="built_in">this</span>.logo = reader.lines().collect(Collectors.joining(<span class="string">&quot;\n&quot;</span>));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ³¨å…¥<code>Resource</code>æœ€å¸¸ç”¨çš„æ–¹å¼æ˜¯é€šè¿‡classpathï¼Œå³ç±»ä¼¼<code>classpath:/logo.txt</code>è¡¨ç¤ºåœ¨classpathä¸­æœç´¢<code>logo.txt</code>æ–‡ä»¶ï¼Œç„¶åï¼Œæˆ‘ä»¬ç›´æ¥è°ƒç”¨<code>Resource.getInputStream()</code>å°±å¯ä»¥è·å–åˆ°è¾“å…¥æµï¼Œé¿å…äº†è‡ªå·±æœç´¢æ–‡ä»¶çš„ä»£ç ã€‚</p><p>ä¹Ÿå¯ä»¥ç›´æ¥æŒ‡å®šæ–‡ä»¶çš„è·¯å¾„ï¼Œä¾‹å¦‚ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Value(&quot;file:/path/to/logo.txt&quot;)</span></span><br><span class="line"><span class="keyword">private</span> Resource resource;</span><br></pre></td></tr></table></figure><p>ä½†ä½¿ç”¨classpathæ˜¯æœ€ç®€å•çš„æ–¹å¼ã€‚ä¸Šè¿°å·¥ç¨‹ç»“æ„å¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">spring-ioc-resource</span><br><span class="line">â”œâ”€â”€ pom.xml</span><br><span class="line">â””â”€â”€ src</span><br><span class="line">    â””â”€â”€ main</span><br><span class="line">        â”œâ”€â”€ java</span><br><span class="line">        â”‚   â””â”€â”€ com</span><br><span class="line">        â”‚       â””â”€â”€ itranswarp</span><br><span class="line">        â”‚           â””â”€â”€ learnjava</span><br><span class="line">        â”‚               â”œâ”€â”€ AppConfig.java</span><br><span class="line">        â”‚               â””â”€â”€ AppService.java</span><br><span class="line">        â””â”€â”€ resources</span><br><span class="line">            â””â”€â”€ logo.txt</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨Mavençš„æ ‡å‡†ç›®å½•ç»“æ„ï¼Œæ‰€æœ‰èµ„æºæ–‡ä»¶æ”¾å…¥<code>src/main/resources</code>å³å¯ã€‚</p><p><strong>å°ç»“ï¼š</strong></p><p>Springæä¾›äº†Resourceç±»ä¾¿äºæ³¨å…¥èµ„æºæ–‡ä»¶ã€‚</p><p>æœ€å¸¸ç”¨çš„æ³¨å…¥æ˜¯é€šè¿‡classpathä»¥<code>classpath:/path/to/file</code>çš„å½¢å¼æ³¨å…¥</p><h2 id="æ³¨å…¥é…ç½®"><a href="#æ³¨å…¥é…ç½®" class="headerlink" title="æ³¨å…¥é…ç½®"></a>æ³¨å…¥é…ç½®</h2><p>åœ¨å¼€å‘åº”ç”¨ç¨‹åºæ—¶ï¼Œç»å¸¸éœ€è¦è¯»å–é…ç½®æ–‡ä»¶ã€‚æœ€å¸¸ç”¨çš„é…ç½®æ–¹æ³•æ˜¯ä»¥<code>key=value</code>çš„å½¢å¼å†™åœ¨<code>.properties</code>æ–‡ä»¶ä¸­ã€‚</p><p>ä¾‹å¦‚ï¼Œ<code>MailService</code>æ ¹æ®é…ç½®çš„<code>app.zone=Asia/Shanghai</code>æ¥å†³å®šä½¿ç”¨å“ªä¸ªæ—¶åŒºã€‚è¦è¯»å–é…ç½®æ–‡ä»¶ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä¸Šä¸€èŠ‚è®²åˆ°çš„<code>Resource</code>æ¥è¯»å–ä½äºclasspathä¸‹çš„ä¸€ä¸ª<code>app.properties</code>æ–‡ä»¶ã€‚ä½†æ˜¯ï¼Œè¿™æ ·ä»ç„¶æ¯”è¾ƒç¹çã€‚</p><p>Springå®¹å™¨è¿˜æä¾›äº†ä¸€ä¸ªæ›´ç®€å•çš„<code>@PropertySource</code>æ¥è‡ªåŠ¨è¯»å–é…ç½®æ–‡ä»¶ã€‚æˆ‘ä»¬åªéœ€è¦åœ¨<code>@Configuration</code>é…ç½®ç±»ä¸Šå†æ·»åŠ ä¸€ä¸ªæ³¨è§£ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan</span></span><br><span class="line"><span class="meta">@PropertySource(&quot;app.properties&quot;)</span> <span class="comment">// è¡¨ç¤ºè¯»å–classpathçš„app.properties</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AppConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;app.zone:Z&#125;&quot;)</span></span><br><span class="line">    String zoneId;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    ZoneId <span class="title function_">createZoneId</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> ZoneId.of(zoneId);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Springå®¹å™¨çœ‹åˆ°<code>@PropertySource(&quot;app.properties&quot;)</code>æ³¨è§£åï¼Œè‡ªåŠ¨è¯»å–è¿™ä¸ªé…ç½®æ–‡ä»¶ï¼Œç„¶åï¼Œæˆ‘ä»¬ä½¿ç”¨<code>@Value</code>æ­£å¸¸æ³¨å…¥ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Value(&quot;$&#123;app.zone:Z&#125;&quot;)</span></span><br><span class="line">String zoneId;</span><br></pre></td></tr></table></figure><p>æ³¨æ„æ³¨å…¥çš„å­—ç¬¦ä¸²è¯­æ³•ï¼Œå®ƒçš„æ ¼å¼å¦‚ä¸‹ï¼š</p><ul><li><code>&quot;$&#123;app.zone&#125;&quot;</code>è¡¨ç¤ºè¯»å–keyä¸º<code>app.zone</code>çš„valueï¼Œå¦‚æœkeyä¸å­˜åœ¨ï¼Œå¯åŠ¨å°†æŠ¥é”™ï¼›</li><li><code>&quot;$&#123;app.zone:Z&#125;&quot;</code>è¡¨ç¤ºè¯»å–keyä¸º<code>app.zone</code>çš„valueï¼Œä½†å¦‚æœkeyä¸å­˜åœ¨ï¼Œå°±ä½¿ç”¨é»˜è®¤å€¼<code>Z</code>ã€‚</li></ul><p>è¿™æ ·ä¸€æ¥ï¼Œæˆ‘ä»¬å°±å¯ä»¥æ ¹æ®<code>app.zone</code>çš„é…ç½®æ¥åˆ›å»º<code>ZoneId</code>ã€‚</p><p>è¿˜å¯ä»¥æŠŠæ³¨å…¥çš„æ³¨è§£å†™åˆ°æ–¹æ³•å‚æ•°ä¸­ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line">ZoneId <span class="title function_">createZoneId</span><span class="params">(<span class="meta">@Value(&quot;$&#123;app.zone:Z&#125;&quot;)</span> String zoneId)</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> ZoneId.of(zoneId);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯è§ï¼Œå…ˆä½¿ç”¨<code>@PropertySource</code>è¯»å–é…ç½®æ–‡ä»¶ï¼Œç„¶åé€šè¿‡<code>@Value</code>ä»¥<code>$&#123;key:defaultValue&#125;</code>çš„å½¢å¼æ³¨å…¥ï¼Œå¯ä»¥æå¤§åœ°ç®€åŒ–è¯»å–é…ç½®çš„éº»çƒ¦ã€‚</p><p>å¦ä¸€ç§æ³¨å…¥é…ç½®çš„æ–¹å¼æ˜¯å…ˆé€šè¿‡ä¸€ä¸ªç®€å•çš„JavaBeanæŒæœ‰æ‰€æœ‰çš„é…ç½®ï¼Œä¾‹å¦‚ï¼Œä¸€ä¸ª<code>SmtpConfig</code>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SmtpConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;smtp.host&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String host;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;smtp.port:25&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> port;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> String <span class="title function_">getHost</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> host;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="type">int</span> <span class="title function_">getPort</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> port;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åï¼Œåœ¨éœ€è¦è¯»å–çš„åœ°æ–¹ï¼Œä½¿ç”¨<code>#&#123;smtpConfig.host&#125;</code>æ³¨å…¥ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MailService</span> &#123;</span><br><span class="line">    <span class="meta">@Value(&quot;#&#123;smtpConfig.host&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String smtpHost;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Value(&quot;#&#123;smtpConfig.port&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="type">int</span> smtpPort;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ³¨æ„è§‚å¯Ÿ<code>#&#123;&#125;</code>è¿™ç§æ³¨å…¥è¯­æ³•ï¼Œå®ƒå’Œ<code>$&#123;key&#125;</code>ä¸åŒçš„æ˜¯ï¼Œ<code>#&#123;&#125;</code>è¡¨ç¤ºä»JavaBeanè¯»å–å±æ€§ã€‚<code>&quot;#&#123;smtpConfig.host&#125;&quot;</code>çš„æ„æ€æ˜¯ï¼Œä»åç§°ä¸º<code>smtpConfig</code>çš„Beanè¯»å–<code>host</code>å±æ€§ï¼Œå³è°ƒç”¨<code>getHost()</code>æ–¹æ³•ã€‚ä¸€ä¸ªClassåä¸º<code>SmtpConfig</code>çš„Beanï¼Œå®ƒåœ¨Springå®¹å™¨ä¸­çš„é»˜è®¤åç§°å°±æ˜¯<code>smtpConfig</code>ï¼Œé™¤éç”¨<code>@Qualifier</code>æŒ‡å®šäº†åç§°ã€‚</p><p>ä½¿ç”¨ä¸€ä¸ªç‹¬ç«‹çš„JavaBeanæŒæœ‰æ‰€æœ‰å±æ€§ï¼Œç„¶ååœ¨å…¶ä»–Beanä¸­ä»¥<code>#&#123;bean.property&#125;</code>æ³¨å…¥çš„å¥½å¤„æ˜¯ï¼Œå¤šä¸ªBeanéƒ½å¯ä»¥å¼•ç”¨åŒä¸€ä¸ªBeançš„æŸä¸ªå±æ€§ã€‚ä¾‹å¦‚ï¼Œå¦‚æœ<code>SmtpConfig</code>å†³å®šä»æ•°æ®åº“ä¸­è¯»å–ç›¸å…³é…ç½®é¡¹ï¼Œé‚£ä¹ˆ<code>MailService</code>æ³¨å…¥çš„<code>@Value(&quot;#&#123;smtpConfig.host&#125;&quot;)</code>ä»ç„¶å¯ä»¥ä¸ä¿®æ”¹æ­£å¸¸è¿è¡Œã€‚</p><p><strong>å°ç»“ï¼š</strong></p><p>Springå®¹å™¨å¯ä»¥é€šè¿‡<code>@PropertySource</code>è‡ªåŠ¨è¯»å–é…ç½®ï¼Œå¹¶ä»¥<code>@Value(&quot;$&#123;key&#125;&quot;)</code>çš„å½¢å¼æ³¨å…¥ï¼›</p><p>å¯ä»¥é€šè¿‡<code>$&#123;key:defaultValue&#125;</code>æŒ‡å®šé»˜è®¤å€¼ï¼›</p><p>ä»¥<code>#&#123;bean.property&#125;</code>å½¢å¼æ³¨å…¥æ—¶ï¼ŒSpringå®¹å™¨è‡ªåŠ¨æŠŠæŒ‡å®šBeançš„æŒ‡å®šå±æ€§å€¼æ³¨å…¥ã€‚</p><h2 id="ä½¿ç”¨æ¡ä»¶é…ç½®"><a href="#ä½¿ç”¨æ¡ä»¶é…ç½®" class="headerlink" title="ä½¿ç”¨æ¡ä»¶é…ç½®"></a>ä½¿ç”¨æ¡ä»¶é…ç½®</h2><p>å¼€å‘åº”ç”¨ç¨‹åºæ—¶ï¼Œæˆ‘ä»¬ä¼šä½¿ç”¨å¼€å‘ç¯å¢ƒï¼Œä¾‹å¦‚ï¼Œä½¿ç”¨å†…å­˜æ•°æ®åº“ä»¥ä¾¿å¿«é€Ÿå¯åŠ¨ã€‚è€Œè¿è¡Œåœ¨ç”Ÿäº§ç¯å¢ƒæ—¶ï¼Œæˆ‘ä»¬ä¼šä½¿ç”¨ç”Ÿäº§ç¯å¢ƒï¼Œä¾‹å¦‚ï¼Œä½¿ç”¨MySQLæ•°æ®åº“ã€‚å¦‚æœåº”ç”¨ç¨‹åºå¯ä»¥æ ¹æ®è‡ªèº«çš„ç¯å¢ƒåšä¸€äº›é€‚é…ï¼Œæ— ç–‘ä¼šæ›´åŠ çµæ´»ã€‚</p><p>Springä¸ºåº”ç”¨ç¨‹åºå‡†å¤‡äº†Profileè¿™ä¸€æ¦‚å¿µï¼Œç”¨æ¥è¡¨ç¤ºä¸åŒçš„ç¯å¢ƒã€‚ä¾‹å¦‚ï¼Œæˆ‘ä»¬åˆ†åˆ«å®šä¹‰å¼€å‘ã€æµ‹è¯•å’Œç”Ÿäº§è¿™3ä¸ªç¯å¢ƒï¼š</p><ul><li>native</li><li>test</li><li>production</li></ul><p>åˆ›å»ºæŸä¸ªBeanæ—¶ï¼ŒSpringå®¹å™¨å¯ä»¥æ ¹æ®æ³¨è§£<code>@Profile</code>æ¥å†³å®šæ˜¯å¦åˆ›å»ºã€‚ä¾‹å¦‚ï¼Œä»¥ä¸‹é…ç½®ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AppConfig</span> &#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@Profile(&quot;!test&quot;)</span></span><br><span class="line">    ZoneId <span class="title function_">createZoneId</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> ZoneId.systemDefault();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="meta">@Profile(&quot;test&quot;)</span></span><br><span class="line">    ZoneId <span class="title function_">createZoneIdForTest</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> ZoneId.of(<span class="string">&quot;America/New_York&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœå½“å‰çš„Profileè®¾ç½®ä¸º<code>test</code>ï¼Œåˆ™Springå®¹å™¨ä¼šè°ƒç”¨<code>createZoneIdForTest()</code>åˆ›å»º<code>ZoneId</code>ï¼Œå¦åˆ™ï¼Œè°ƒç”¨<code>createZoneId()</code>åˆ›å»º<code>ZoneId</code>ã€‚æ³¨æ„åˆ°<code>@Profile(&quot;!test&quot;)</code>è¡¨ç¤ºétestç¯å¢ƒã€‚</p><p>åœ¨è¿è¡Œç¨‹åºæ—¶ï¼ŒåŠ ä¸ŠJVMå‚æ•°<code>-Dspring.profiles.active=test</code>å°±å¯ä»¥æŒ‡å®šä»¥<code>test</code>ç¯å¢ƒå¯åŠ¨ã€‚</p><p>å®é™…ä¸Šï¼ŒSpringå…è®¸æŒ‡å®šå¤šä¸ªProfileï¼Œä¾‹å¦‚ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-Dspring.profiles.active=test,master</span><br></pre></td></tr></table></figure><p>å¯ä»¥è¡¨ç¤º<code>test</code>ç¯å¢ƒï¼Œå¹¶ä½¿ç”¨<code>master</code>åˆ†æ”¯ä»£ç ã€‚</p><p>è¦æ»¡è¶³å¤šä¸ªProfileæ¡ä»¶ï¼Œå¯ä»¥è¿™æ ·å†™ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="meta">@Profile(&#123; &quot;test&quot;, &quot;master&quot; &#125;)</span> <span class="comment">// æ»¡è¶³testæˆ–master</span></span><br><span class="line">ZoneId <span class="title function_">createZoneId</span><span class="params">()</span> &#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="ä½¿ç”¨Conditional"><a href="#ä½¿ç”¨Conditional" class="headerlink" title="ä½¿ç”¨Conditional"></a>ä½¿ç”¨Conditional</h3><p>é™¤äº†æ ¹æ®<code>@Profile</code>æ¡ä»¶æ¥å†³å®šæ˜¯å¦åˆ›å»ºæŸä¸ªBeanå¤–ï¼ŒSpringè¿˜å¯ä»¥æ ¹æ®<code>@Conditional</code>å†³å®šæ˜¯å¦åˆ›å»ºæŸä¸ªBeanã€‚</p><p>ä¾‹å¦‚ï¼Œæˆ‘ä»¬å¯¹<code>SmtpMailService</code>æ·»åŠ å¦‚ä¸‹æ³¨è§£ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Conditional(OnSmtpEnvCondition.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SmtpMailService</span> <span class="keyword">implements</span> <span class="title class_">MailService</span> &#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å®ƒçš„æ„æ€æ˜¯ï¼Œå¦‚æœæ»¡è¶³<code>OnSmtpEnvCondition</code>çš„æ¡ä»¶ï¼Œæ‰ä¼šåˆ›å»º<code>SmtpMailService</code>è¿™ä¸ªBeanã€‚<code>OnSmtpEnvCondition</code>çš„æ¡ä»¶æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿæˆ‘ä»¬çœ‹ä¸€ä¸‹ä»£ç ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">OnSmtpEnvCondition</span> <span class="keyword">implements</span> <span class="title class_">Condition</span> &#123;</span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">matches</span><span class="params">(ConditionContext context, AnnotatedTypeMetadata metadata)</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;true&quot;</span>.equalsIgnoreCase(System.getenv(<span class="string">&quot;smtp&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å› æ­¤ï¼Œ<code>OnSmtpEnvCondition</code>çš„æ¡ä»¶æ˜¯å­˜åœ¨ç¯å¢ƒå˜é‡<code>smtp</code>ï¼Œå€¼ä¸º<code>true</code>ã€‚è¿™æ ·ï¼Œæˆ‘ä»¬å°±å¯ä»¥é€šè¿‡ç¯å¢ƒå˜é‡æ¥æ§åˆ¶æ˜¯å¦åˆ›å»º<code>SmtpMailService</code>ã€‚</p><p>Springåªæä¾›äº†<code>@Conditional</code>æ³¨è§£ï¼Œå…·ä½“åˆ¤æ–­é€»è¾‘è¿˜éœ€è¦æˆ‘ä»¬è‡ªå·±å®ç°ã€‚Spring Bootæä¾›äº†æ›´å¤šä½¿ç”¨èµ·æ¥æ›´ç®€å•çš„æ¡ä»¶æ³¨è§£ï¼Œä¾‹å¦‚ï¼Œå¦‚æœé…ç½®æ–‡ä»¶ä¸­å­˜åœ¨<code>app.smtp=true</code>ï¼Œåˆ™åˆ›å»º<code>MailService</code>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@ConditionalOnProperty(name=&quot;app.smtp&quot;, havingValue=&quot;true&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MailService</span> &#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœå½“å‰classpathä¸­å­˜åœ¨ç±»<code>javax.mail.Transport</code>ï¼Œåˆ™åˆ›å»º<code>MailService</code>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@ConditionalOnClass(name = &quot;javax.mail.Transport&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MailService</span> &#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åç»­æˆ‘ä»¬ä¼šä»‹ç»Spring Bootçš„æ¡ä»¶è£…é…ã€‚æˆ‘ä»¬ä»¥æ–‡ä»¶å­˜å‚¨ä¸ºä¾‹ï¼Œå‡è®¾æˆ‘ä»¬éœ€è¦ä¿å­˜ç”¨æˆ·ä¸Šä¼ çš„å¤´åƒï¼Œå¹¶è¿”å›å­˜å‚¨è·¯å¾„ï¼Œåœ¨æœ¬åœ°å¼€å‘è¿è¡Œæ—¶ï¼Œæˆ‘ä»¬æ€»æ˜¯å­˜å‚¨åˆ°æ–‡ä»¶ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@ConditionalOnProperty(name = &quot;app.storage&quot;, havingValue = &quot;file&quot;, matchIfMissing = true)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">FileUploader</span> <span class="keyword">implements</span> <span class="title class_">Uploader</span> &#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨ç”Ÿäº§ç¯å¢ƒè¿è¡Œæ—¶ï¼Œæˆ‘ä»¬ä¼šæŠŠæ–‡ä»¶å­˜å‚¨åˆ°ç±»ä¼¼AWS S3ä¸Šï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@ConditionalOnProperty(name = &quot;app.storage&quot;, havingValue = &quot;s3&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">S3Uploader</span> <span class="keyword">implements</span> <span class="title class_">Uploader</span> &#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…¶ä»–éœ€è¦å­˜å‚¨çš„æœåŠ¡åˆ™æ³¨å…¥<code>Uploader</code>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserImageService</span> &#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    Uploader uploader;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å½“åº”ç”¨ç¨‹åºæ£€æµ‹åˆ°é…ç½®æ–‡ä»¶å­˜åœ¨<code>app.storage=s3</code>æ—¶ï¼Œè‡ªåŠ¨ä½¿ç”¨<code>S3Uploader</code>ï¼Œå¦‚æœå­˜åœ¨é…ç½®<code>app.storage=file</code>ï¼Œæˆ–è€…é…ç½®<code>app.storage</code>ä¸å­˜åœ¨ï¼Œåˆ™ä½¿ç”¨<code>FileUploader</code>ã€‚</p><p>å¯è§ï¼Œä½¿ç”¨æ¡ä»¶æ³¨è§£ï¼Œèƒ½æ›´çµæ´»åœ°è£…é…Beanã€‚</p><p>å°ç»“ï¼š</p><p>Springå…è®¸é€šè¿‡<code>@Profile</code>é…ç½®ä¸åŒçš„Beanï¼›</p><p>Springè¿˜æä¾›äº†<code>@Conditional</code>æ¥è¿›è¡Œæ¡ä»¶è£…é…ï¼ŒSpring Bootåœ¨æ­¤åŸºç¡€ä¸Šè¿›ä¸€æ­¥æä¾›äº†åŸºäºé…ç½®ã€Classã€Beanç­‰æ¡ä»¶è¿›è¡Œè£…é…ã€‚</p><h1 id="AOP"><a href="#AOP" class="headerlink" title="AOP"></a>AOP</h1><h2 id="ä»‹ç»"><a href="#ä»‹ç»" class="headerlink" title="ä»‹ç»"></a>ä»‹ç»</h2><p>AOPæ˜¯Aspect Oriented Programmingï¼Œå³<strong>é¢å‘åˆ‡é¢ç¼–ç¨‹ã€‚</strong></p><p>AOPæ˜¯ä¸€ç§æ–°çš„ç¼–ç¨‹æ–¹å¼ï¼Œå®ƒå’ŒOOPä¸åŒï¼ŒOOPæŠŠç³»ç»Ÿçœ‹ä½œå¤šä¸ªå¯¹è±¡çš„äº¤äº’ï¼ŒAOPæŠŠç³»ç»Ÿåˆ†è§£ä¸ºä¸åŒçš„å…³æ³¨ç‚¹ï¼Œæˆ–è€…ç§°ä¹‹ä¸ºåˆ‡é¢ï¼ˆAspectï¼‰ã€‚</p><p>å¯¹äºå®‰å…¨æ£€æŸ¥ã€æ—¥å¿—ã€äº‹åŠ¡ç­‰ä»£ç ï¼Œå®ƒä»¬ä¼šé‡å¤å‡ºç°åœ¨æ¯ä¸ªä¸šåŠ¡æ–¹æ³•ä¸­ã€‚ä½¿ç”¨OOPï¼Œæˆ‘ä»¬å¾ˆéš¾å°†è¿™äº›å››å¤„åˆ†æ•£çš„ä»£ç æ¨¡å—åŒ–ã€‚</p><p>è€ƒå¯Ÿä¸šåŠ¡æ¨¡å‹å¯ä»¥å‘ç°ï¼Œ<code>BookService</code>å…³å¿ƒçš„æ˜¯è‡ªèº«çš„æ ¸å¿ƒé€»è¾‘ï¼Œä½†æ•´ä¸ªç³»ç»Ÿè¿˜è¦æ±‚å…³æ³¨å®‰å…¨æ£€æŸ¥ã€æ—¥å¿—ã€äº‹åŠ¡ç­‰åŠŸèƒ½ï¼Œè¿™äº›åŠŸèƒ½å®é™…ä¸Šâ€œæ¨ªè·¨â€å¤šä¸ªä¸šåŠ¡æ–¹æ³•ï¼Œä¸ºäº†å®ç°è¿™äº›åŠŸèƒ½ï¼Œä¸å¾—ä¸åœ¨æ¯ä¸ªä¸šåŠ¡æ–¹æ³•ä¸Šé‡å¤ç¼–å†™ä»£ç ã€‚</p><p>ä¸€ç§å¯è¡Œçš„æ–¹å¼æ˜¯ä½¿ç”¨<a href="https://liaoxuefeng.com/books/java/design-patterns/structural/proxy/index.html">Proxyæ¨¡å¼</a>ï¼Œå°†æŸä¸ªåŠŸèƒ½ï¼Œä¾‹å¦‚ï¼Œæƒé™æ£€æŸ¥ï¼Œæ”¾å…¥Proxyä¸­ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SecurityCheckBookService</span> <span class="keyword">implements</span> <span class="title class_">BookService</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> BookService target;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">SecurityCheckBookService</span><span class="params">(BookService target)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.target = target;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">createBook</span><span class="params">(Book book)</span> &#123;</span><br><span class="line">        securityCheck();</span><br><span class="line">        target.createBook(book);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateBook</span><span class="params">(Book book)</span> &#123;</span><br><span class="line">        securityCheck();</span><br><span class="line">        target.updateBook(book);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">deleteBook</span><span class="params">(Book book)</span> &#123;</span><br><span class="line">        securityCheck();</span><br><span class="line">        target.deleteBook(book);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">void</span> <span class="title function_">securityCheck</span><span class="params">()</span> &#123;</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ç§æ–¹å¼çš„ç¼ºç‚¹æ˜¯æ¯”è¾ƒéº»çƒ¦ï¼Œå¿…é¡»å…ˆæŠ½å–æ¥å£ï¼Œç„¶åï¼Œé’ˆå¯¹æ¯ä¸ªæ–¹æ³•å®ç°Proxyã€‚</p><p>å¦ä¸€ç§æ–¹æ³•æ˜¯ï¼Œæ—¢ç„¶<code>SecurityCheckBookService</code>çš„ä»£ç éƒ½æ˜¯æ ‡å‡†çš„Proxyæ ·æ¿ä»£ç ï¼Œä¸å¦‚æŠŠæƒé™æ£€æŸ¥è§†ä½œä¸€ç§åˆ‡é¢ï¼ˆAspectï¼‰ï¼ŒæŠŠæ—¥å¿—ã€äº‹åŠ¡ä¹Ÿè§†ä¸ºåˆ‡é¢ï¼Œç„¶åï¼Œä»¥æŸç§è‡ªåŠ¨åŒ–çš„æ–¹å¼ï¼ŒæŠŠåˆ‡é¢ç»‡å…¥åˆ°æ ¸å¿ƒé€»è¾‘ä¸­ï¼Œå®ç°Proxyæ¨¡å¼ã€‚</p><p>å¦‚æœæˆ‘ä»¬ä»¥AOPçš„è§†è§’æ¥ç¼–å†™ä¸Šè¿°ä¸šåŠ¡ï¼Œå¯ä»¥ä¾æ¬¡å®ç°ï¼š</p><ol><li>æ ¸å¿ƒé€»è¾‘ï¼Œå³BookServiceï¼›</li><li>åˆ‡é¢é€»è¾‘ï¼Œå³ï¼š<ol><li>æƒé™æ£€æŸ¥çš„Aspectï¼›</li><li>æ—¥å¿—çš„Aspectï¼›</li><li>äº‹åŠ¡çš„Aspectã€‚</li></ol></li></ol><p>ç„¶åï¼Œä»¥æŸç§æ–¹å¼ï¼Œè®©æ¡†æ¶æ¥æŠŠä¸Šè¿°3ä¸ªAspectä»¥Proxyçš„æ–¹å¼â€œç»‡å…¥â€åˆ°<code>BookService</code>ä¸­ï¼Œè¿™æ ·ä¸€æ¥ï¼Œå°±ä¸å¿…ç¼–å†™å¤æ‚è€Œå†—é•¿çš„Proxyæ¨¡å¼ã€‚</p><p>åœ¨Javaå¹³å°ä¸Šï¼Œå¯¹äºAOPçš„ç»‡å…¥ï¼Œæœ‰3ç§æ–¹å¼ï¼š</p><ol><li>ç¼–è¯‘æœŸï¼šåœ¨ç¼–è¯‘æ—¶ï¼Œç”±ç¼–è¯‘å™¨æŠŠåˆ‡é¢è°ƒç”¨ç¼–è¯‘è¿›å­—èŠ‚ç ï¼Œè¿™ç§æ–¹å¼éœ€è¦å®šä¹‰æ–°çš„å…³é”®å­—å¹¶æ‰©å±•ç¼–è¯‘å™¨ï¼ŒAspectJå°±æ‰©å±•äº†Javaç¼–è¯‘å™¨ï¼Œä½¿ç”¨å…³é”®å­—aspectæ¥å®ç°ç»‡å…¥ï¼›<strong>ç¼–è¯‘æ—¶å¢å¼º</strong></li><li>ç±»åŠ è½½å™¨ï¼šåœ¨ç›®æ ‡ç±»è¢«è£…è½½åˆ°JVMæ—¶ï¼Œé€šè¿‡ä¸€ä¸ªç‰¹æ®Šçš„ç±»åŠ è½½å™¨ï¼Œ<strong>å¯¹ç›®æ ‡ç±»çš„å­—èŠ‚ç é‡æ–°â€œå¢å¼ºâ€ï¼›</strong></li><li>è¿è¡ŒæœŸï¼šç›®æ ‡å¯¹è±¡å’Œåˆ‡é¢éƒ½æ˜¯æ™®é€šJavaç±»ï¼Œ<strong>é€šè¿‡JVMçš„åŠ¨æ€ä»£ç†åŠŸèƒ½æˆ–è€…ç¬¬ä¸‰æ–¹åº“å®ç°è¿è¡ŒæœŸåŠ¨æ€ç»‡å…¥ã€‚</strong></li></ol><p>æœ€ç®€å•çš„æ–¹å¼æ˜¯ç¬¬ä¸‰ç§ï¼ŒSpringçš„AOPå®ç°å°±æ˜¯åŸºäºJVMçš„åŠ¨æ€ä»£ç†ã€‚ç”±äºJVMçš„åŠ¨æ€ä»£ç†è¦æ±‚å¿…é¡»å®ç°æ¥å£ï¼Œå¦‚æœä¸€ä¸ªæ™®é€šç±»æ²¡æœ‰ä¸šåŠ¡æ¥å£ï¼Œå°±éœ€è¦é€šè¿‡<a href="https://github.com/cglib/cglib">CGLIB</a>æˆ–è€…<a href="https://www.javassist.org/">Javassist</a>è¿™äº›ç¬¬ä¸‰æ–¹åº“å®ç°ã€‚</p><p>AOPæŠ€æœ¯çœ‹ä¸Šå»æ¯”è¾ƒç¥ç§˜ï¼Œä½†å®é™…ä¸Šï¼Œå®ƒæœ¬è´¨å°±æ˜¯ä¸€ä¸ªåŠ¨æ€ä»£ç†ï¼Œè®©æˆ‘ä»¬æŠŠä¸€äº›å¸¸ç”¨åŠŸèƒ½å¦‚æƒé™æ£€æŸ¥ã€æ—¥å¿—ã€äº‹åŠ¡ç­‰ï¼Œä»æ¯ä¸ªä¸šåŠ¡æ–¹æ³•ä¸­å‰¥ç¦»å‡ºæ¥ã€‚</p><p>éœ€è¦ç‰¹åˆ«æŒ‡å‡ºçš„æ˜¯ï¼ŒAOPå¯¹äºè§£å†³ç‰¹å®šé—®é¢˜ï¼Œä¾‹å¦‚äº‹åŠ¡ç®¡ç†éå¸¸æœ‰ç”¨ï¼Œè¿™æ˜¯å› ä¸ºåˆ†æ•£åœ¨å„å¤„çš„äº‹åŠ¡ä»£ç å‡ ä¹æ˜¯å®Œå…¨ç›¸åŒçš„ï¼Œå¹¶ä¸”å®ƒä»¬éœ€è¦çš„å‚æ•°ï¼ˆJDBCçš„Connectionï¼‰ä¹Ÿæ˜¯å›ºå®šçš„ã€‚å¦ä¸€äº›ç‰¹å®šé—®é¢˜ï¼Œå¦‚æ—¥å¿—ï¼Œå°±ä¸é‚£ä¹ˆå®¹æ˜“å®ç°ï¼Œå› ä¸ºæ—¥å¿—è™½ç„¶ç®€å•ï¼Œä½†æ‰“å°æ—¥å¿—çš„æ—¶å€™ï¼Œç»å¸¸éœ€è¦æ•è·å±€éƒ¨å˜é‡ï¼Œå¦‚æœä½¿ç”¨AOPå®ç°æ—¥å¿—ï¼Œæˆ‘ä»¬åªèƒ½è¾“å‡ºå›ºå®šæ ¼å¼çš„æ—¥å¿—ï¼Œå› æ­¤ï¼Œä½¿ç”¨AOPæ—¶ï¼Œå¿…é¡»é€‚åˆç‰¹å®šçš„åœºæ™¯ã€‚</p><h2 id="è£…é…AOP"><a href="#è£…é…AOP" class="headerlink" title="è£…é…AOP"></a>è£…é…AOP</h2><p>åœ¨AOPç¼–ç¨‹ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸ä¼šé‡åˆ°ä¸‹é¢çš„æ¦‚å¿µï¼š</p><ul><li>Aspectï¼šåˆ‡é¢ï¼Œå³ä¸€ä¸ªæ¨ªè·¨å¤šä¸ªæ ¸å¿ƒé€»è¾‘çš„åŠŸèƒ½ï¼Œæˆ–è€…ç§°ä¹‹ä¸ºç³»ç»Ÿå…³æ³¨ç‚¹ï¼›</li><li>Joinpointï¼šè¿æ¥ç‚¹ï¼Œå³å®šä¹‰åœ¨åº”ç”¨ç¨‹åºæµç¨‹çš„ä½•å¤„æ’å…¥åˆ‡é¢çš„æ‰§è¡Œï¼›</li><li>Pointcutï¼šåˆ‡å…¥ç‚¹ï¼Œå³ä¸€ç»„è¿æ¥ç‚¹çš„é›†åˆï¼›</li><li>Adviceï¼šå¢å¼ºï¼ŒæŒ‡ç‰¹å®šè¿æ¥ç‚¹ä¸Šæ‰§è¡Œçš„åŠ¨ä½œï¼›</li><li>Introductionï¼šå¼•ä»‹ï¼ŒæŒ‡ä¸ºä¸€ä¸ªå·²æœ‰çš„Javaå¯¹è±¡åŠ¨æ€åœ°å¢åŠ æ–°çš„æ¥å£ï¼›</li><li>Weavingï¼šç»‡å…¥ï¼ŒæŒ‡å°†åˆ‡é¢æ•´åˆåˆ°ç¨‹åºçš„æ‰§è¡Œæµç¨‹ä¸­ï¼›</li><li>Interceptorï¼šæ‹¦æˆªå™¨ï¼Œæ˜¯ä¸€ç§å®ç°å¢å¼ºçš„æ–¹å¼ï¼›</li><li>Target Objectï¼šç›®æ ‡å¯¹è±¡ï¼Œå³çœŸæ­£æ‰§è¡Œä¸šåŠ¡çš„æ ¸å¿ƒé€»è¾‘å¯¹è±¡ï¼›</li><li>AOP Proxyï¼šAOPä»£ç†ï¼Œæ˜¯å®¢æˆ·ç«¯æŒæœ‰çš„å¢å¼ºåçš„å¯¹è±¡å¼•ç”¨ã€‚</li></ul><p>çœ‹å®Œä¸Šè¿°æœ¯è¯­ï¼Œæ˜¯ä¸æ˜¯æ„Ÿè§‰å¯¹AOPæœ‰äº†è¿›ä¸€æ­¥çš„å›°æƒ‘ï¼Ÿå…¶å®ï¼Œæˆ‘ä»¬ä¸ç”¨å…³å¿ƒAOPåˆ›é€ çš„â€œæœ¯è¯­â€ï¼Œåªéœ€è¦ç†è§£AOPæœ¬è´¨ä¸Šåªæ˜¯ä¸€ç§ä»£ç†æ¨¡å¼çš„å®ç°æ–¹å¼ï¼Œåœ¨Springçš„å®¹å™¨ä¸­å®ç°AOPç‰¹åˆ«æ–¹ä¾¿ã€‚</p><p>æˆ‘ä»¬ä»¥<code>UserService</code>å’Œ<code>MailService</code>ä¸ºä¾‹ï¼Œè¿™ä¸¤ä¸ªå±äºæ ¸å¿ƒä¸šåŠ¡é€»è¾‘ï¼Œç°åœ¨ï¼Œæˆ‘ä»¬å‡†å¤‡ç»™<code>UserService</code>çš„æ¯ä¸ªä¸šåŠ¡æ–¹æ³•æ‰§è¡Œå‰æ·»åŠ æ—¥å¿—ï¼Œç»™<code>MailService</code>çš„æ¯ä¸ªä¸šåŠ¡æ–¹æ³•æ‰§è¡Œå‰åæ·»åŠ æ—¥å¿—ï¼Œåœ¨Springä¸­ï¼Œéœ€è¦ä»¥ä¸‹æ­¥éª¤ï¼š</p><p>é¦–å…ˆï¼Œæˆ‘ä»¬é€šè¿‡Mavenå¼•å…¥Springå¯¹AOPçš„æ”¯æŒï¼š</p><ul><li>org.springframework:spring-aspects:6.0.0</li></ul><p>ä¸Šè¿°ä¾èµ–ä¼šè‡ªåŠ¨å¼•å…¥AspectJï¼Œä½¿ç”¨AspectJå®ç°AOPæ¯”è¾ƒæ–¹ä¾¿ï¼Œå› ä¸ºå®ƒçš„å®šä¹‰æ¯”è¾ƒç®€å•ã€‚</p><p>ç„¶åï¼Œæˆ‘ä»¬å®šä¹‰ä¸€ä¸ª<code>LoggingAspect</code>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">LoggingAspect</span> &#123;</span><br><span class="line">    <span class="comment">// åœ¨æ‰§è¡ŒUserServiceçš„æ¯ä¸ªæ–¹æ³•å‰æ‰§è¡Œ:</span></span><br><span class="line">    <span class="meta">@Before(&quot;execution(public * com.itranswarp.learnjava.service.UserService.*(..))&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">doAccessCheck</span><span class="params">()</span> &#123;</span><br><span class="line">        System.err.println(<span class="string">&quot;[Before] do access check...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åœ¨æ‰§è¡ŒMailServiceçš„æ¯ä¸ªæ–¹æ³•å‰åæ‰§è¡Œ:</span></span><br><span class="line">    <span class="meta">@Around(&quot;execution(public * com.itranswarp.learnjava.service.MailService.*(..))&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">doLogging</span><span class="params">(ProceedingJoinPoint pjp)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        System.err.println(<span class="string">&quot;[Around] start &quot;</span> + pjp.getSignature());</span><br><span class="line">        <span class="type">Object</span> <span class="variable">retVal</span> <span class="operator">=</span> pjp.proceed();</span><br><span class="line">        System.err.println(<span class="string">&quot;[Around] done &quot;</span> + pjp.getSignature());</span><br><span class="line">        <span class="keyword">return</span> retVal;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è§‚å¯Ÿ<code>doAccessCheck()</code>æ–¹æ³•ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ª<code>@Before</code>æ³¨è§£ï¼Œåé¢çš„å­—ç¬¦ä¸²æ˜¯å‘Šè¯‰AspectJåº”è¯¥åœ¨ä½•å¤„æ‰§è¡Œè¯¥æ–¹æ³•ï¼Œè¿™é‡Œå†™çš„æ„æ€æ˜¯ï¼šæ‰§è¡Œ<code>UserService</code>çš„æ¯ä¸ª<code>public</code>æ–¹æ³•å‰æ‰§è¡Œ<code>doAccessCheck()</code>ä»£ç ã€‚</p><p>å†è§‚å¯Ÿ<code>doLogging()</code>æ–¹æ³•ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€ä¸ª<code>@Around</code>æ³¨è§£ï¼Œå®ƒå’Œ<code>@Before</code>ä¸åŒï¼Œ<code>@Around</code>å¯ä»¥å†³å®šæ˜¯å¦æ‰§è¡Œç›®æ ‡æ–¹æ³•ï¼Œå› æ­¤ï¼Œæˆ‘ä»¬åœ¨<code>doLogging()</code>å†…éƒ¨å…ˆæ‰“å°æ—¥å¿—ï¼Œå†è°ƒç”¨æ–¹æ³•ï¼Œæœ€åæ‰“å°æ—¥å¿—åè¿”å›ç»“æœã€‚</p><p>åœ¨<code>LoggingAspect</code>ç±»çš„å£°æ˜å¤„ï¼Œé™¤äº†ç”¨<code>@Component</code>è¡¨ç¤ºå®ƒæœ¬èº«ä¹Ÿæ˜¯ä¸€ä¸ªBeanå¤–ï¼Œæˆ‘ä»¬å†åŠ ä¸Š<code>@Aspect</code>æ³¨è§£ï¼Œè¡¨ç¤ºå®ƒçš„<code>@Before</code>æ ‡æ³¨çš„æ–¹æ³•éœ€è¦æ³¨å…¥åˆ°<code>UserService</code>çš„æ¯ä¸ª<code>public</code>æ–¹æ³•æ‰§è¡Œå‰ï¼Œ<code>@Around</code>æ ‡æ³¨çš„æ–¹æ³•éœ€è¦æ³¨å…¥åˆ°<code>MailService</code>çš„æ¯ä¸ª<code>public</code>æ–¹æ³•æ‰§è¡Œå‰åã€‚</p><p>ç´§æ¥ç€ï¼Œæˆ‘ä»¬éœ€è¦ç»™<code>@Configuration</code>ç±»åŠ ä¸Šä¸€ä¸ª<code>@EnableAspectJAutoProxy</code>æ³¨è§£ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan</span></span><br><span class="line"><span class="meta">@EnableAspectJAutoProxy</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">AppConfig</span> &#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Springçš„IoCå®¹å™¨çœ‹åˆ°è¿™ä¸ªæ³¨è§£ï¼Œå°±ä¼šè‡ªåŠ¨æŸ¥æ‰¾å¸¦æœ‰<code>@Aspect</code>çš„Beanï¼Œç„¶åæ ¹æ®æ¯ä¸ªæ–¹æ³•çš„<code>@Before</code>ã€<code>@Around</code>ç­‰æ³¨è§£æŠŠAOPæ³¨å…¥åˆ°ç‰¹å®šçš„Beanä¸­ã€‚æ‰§è¡Œä»£ç ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°ä»¥ä¸‹è¾“å‡ºï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[Before] do access check...</span><br><span class="line">[Around] start void com.itranswarp.learnjava.service.MailService.sendRegistrationMail(User)</span><br><span class="line">Welcome, test!</span><br><span class="line">[Around] done void com.itranswarp.learnjava.service.MailService.sendRegistrationMail(User)</span><br><span class="line">[Before] do access check...</span><br><span class="line">[Around] start void com.itranswarp.learnjava.service.MailService.sendLoginMail(User)</span><br><span class="line">Hi, Bob! You are logged in at 2020-02-14T23:13:52.167996+08:00[Asia/Shanghai]</span><br><span class="line">[Around] done void com.itranswarp.learnjava.service.MailService.sendLoginMail(User)</span><br></pre></td></tr></table></figure><p>è¿™è¯´æ˜æ‰§è¡Œä¸šåŠ¡é€»è¾‘å‰åï¼Œç¡®å®æ‰§è¡Œäº†æˆ‘ä»¬å®šä¹‰çš„Aspectï¼ˆå³<code>LoggingAspect</code>çš„æ–¹æ³•ï¼‰ã€‚</p><p>æœ‰äº›ç«¥é‹ä¼šé—®ï¼Œ<code>LoggingAspect</code>å®šä¹‰çš„æ–¹æ³•ï¼Œæ˜¯å¦‚ä½•æ³¨å…¥åˆ°å…¶ä»–Beançš„å‘¢ï¼Ÿ</p><p>å…¶å®AOPçš„åŸç†éå¸¸ç®€å•ã€‚æˆ‘ä»¬ä»¥<code>LoggingAspect.doAccessCheck()</code>ä¸ºä¾‹ï¼Œè¦æŠŠå®ƒæ³¨å…¥åˆ°<code>UserService</code>çš„æ¯ä¸ª<code>public</code>æ–¹æ³•ä¸­ï¼Œæœ€ç®€å•çš„æ–¹æ³•æ˜¯ç¼–å†™ä¸€ä¸ªå­ç±»ï¼Œå¹¶æŒæœ‰åŸå§‹å®ä¾‹çš„å¼•ç”¨ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> UserServiceAopProxy <span class="keyword">extends</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="keyword">private</span> UserService target;</span><br><span class="line">    <span class="keyword">private</span> LoggingAspect aspect;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="title function_">UserServiceAopProxy</span><span class="params">(UserService target, LoggingAspect aspect)</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.target = target;</span><br><span class="line">        <span class="built_in">this</span>.aspect = aspect;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">login</span><span class="params">(String email, String password)</span> &#123;</span><br><span class="line">        <span class="comment">// å…ˆæ‰§è¡ŒAspectçš„ä»£ç :</span></span><br><span class="line">        aspect.doAccessCheck();</span><br><span class="line">        <span class="comment">// å†æ‰§è¡ŒUserServiceçš„é€»è¾‘:</span></span><br><span class="line">        <span class="keyword">return</span> target.login(email, password);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">register</span><span class="params">(String email, String password, String name)</span> &#123;</span><br><span class="line">        aspect.doAccessCheck();</span><br><span class="line">        <span class="keyword">return</span> target.register(email, password, name);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™äº›éƒ½æ˜¯Springå®¹å™¨å¯åŠ¨æ—¶ä¸ºæˆ‘ä»¬è‡ªåŠ¨åˆ›å»ºçš„æ³¨å…¥äº†Aspectçš„å­ç±»ï¼Œå®ƒå–ä»£äº†åŸå§‹çš„<code>UserService</code>ï¼ˆåŸå§‹çš„<code>UserService</code>å®ä¾‹ä½œä¸ºå†…éƒ¨å˜é‡éšè—åœ¨<code>UserServiceAopProxy</code>ä¸­ï¼‰ã€‚å¦‚æœæˆ‘ä»¬æ‰“å°ä»Springå®¹å™¨è·å–çš„<code>UserService</code>å®ä¾‹ç±»å‹ï¼Œå®ƒç±»ä¼¼<code>UserService$$EnhancerBySpringCGLIB$$1f44e01c</code>ï¼Œå®é™…ä¸Šæ˜¯Springä½¿ç”¨CGLIBåŠ¨æ€åˆ›å»ºçš„å­ç±»ï¼Œä½†å¯¹äºè°ƒç”¨æ–¹æ¥è¯´ï¼Œæ„Ÿè§‰ä¸åˆ°ä»»ä½•åŒºåˆ«ã€‚</p><p><strong>Springå¯¹æ¥å£ç±»å‹ä½¿ç”¨JDKåŠ¨æ€ä»£ç†ï¼Œå¯¹æ™®é€šç±»ä½¿ç”¨CGLIBåˆ›å»ºå­ç±»ã€‚å¦‚æœä¸€ä¸ªBeançš„classæ˜¯finalï¼ŒSpringå°†æ— æ³•ä¸ºå…¶åˆ›å»ºå­ç±»ã€‚</strong></p><p>å¯è§ï¼Œè™½ç„¶Springå®¹å™¨å†…éƒ¨å®ç°AOPçš„é€»è¾‘æ¯”è¾ƒå¤æ‚ï¼ˆéœ€è¦ä½¿ç”¨AspectJè§£ææ³¨è§£ï¼Œå¹¶é€šè¿‡CGLIBå®ç°ä»£ç†ç±»ï¼‰ï¼Œä½†æˆ‘ä»¬ä½¿ç”¨AOPéå¸¸ç®€å•ï¼Œä¸€å…±éœ€è¦ä¸‰æ­¥ï¼š</p><ol><li>å®šä¹‰æ‰§è¡Œæ–¹æ³•ï¼Œå¹¶åœ¨æ–¹æ³•ä¸Šé€šè¿‡AspectJçš„æ³¨è§£å‘Šè¯‰Springåº”è¯¥åœ¨ä½•å¤„è°ƒç”¨æ­¤æ–¹æ³•ï¼›</li><li>æ ‡è®°<code>@Component</code>å’Œ<code>@Aspect</code>ï¼›</li><li>åœ¨<code>@Configuration</code>ç±»ä¸Šæ ‡æ³¨<code>@EnableAspectJAutoProxy</code>ã€‚</li></ol><p>æ‹¦æˆªå™¨ï¼Œå°±æ˜¯æ‹¦æˆªä»£ç çš„æ‰§è¡Œ</p><p>é¡¾åæ€ä¹‰ï¼Œæ‹¦æˆªå™¨æœ‰ä»¥ä¸‹ç±»å‹ï¼š</p><ul><li>@Beforeï¼šè¿™ç§æ‹¦æˆªå™¨<strong>å…ˆæ‰§è¡Œæ‹¦æˆªä»£ç ï¼Œ</strong>å†æ‰§è¡Œç›®æ ‡ä»£ç ã€‚å¦‚æœæ‹¦æˆªå™¨æŠ›å¼‚å¸¸ï¼Œé‚£ä¹ˆç›®æ ‡ä»£ç å°±ä¸æ‰§è¡Œäº†ï¼›</li><li>@Afterï¼šè¿™ç§æ‹¦æˆªå™¨<strong>å…ˆæ‰§è¡Œç›®æ ‡ä»£ç </strong>ï¼Œå†æ‰§è¡Œæ‹¦æˆªå™¨ä»£ç ã€‚æ— è®ºç›®æ ‡ä»£ç æ˜¯å¦æŠ›å¼‚å¸¸ï¼Œæ‹¦æˆªå™¨ä»£ç éƒ½ä¼šæ‰§è¡Œï¼›</li><li>@AfterReturningï¼šå’Œ@Afterä¸åŒçš„æ˜¯ï¼Œ<strong>åªæœ‰å½“ç›®æ ‡ä»£ç æ­£å¸¸è¿”å›æ—¶ï¼Œæ‰æ‰§è¡Œæ‹¦æˆªå™¨ä»£ç ï¼›</strong></li><li>@AfterThrowingï¼šå’Œ@Afterä¸åŒçš„æ˜¯ï¼Œ<strong>åªæœ‰å½“ç›®æ ‡ä»£ç æŠ›å‡ºäº†å¼‚å¸¸æ—¶ï¼Œæ‰æ‰§è¡Œæ‹¦æˆªå™¨ä»£ç ï¼›</strong></li><li>@Aroundï¼šèƒ½å®Œå…¨æ§åˆ¶ç›®æ ‡ä»£ç æ˜¯å¦æ‰§è¡Œï¼Œ<strong>å¹¶å¯ä»¥åœ¨æ‰§è¡Œå‰åã€æŠ›å¼‚å¸¸åæ‰§è¡Œä»»æ„æ‹¦æˆªä»£ç ï¼Œå¯ä»¥è¯´æ˜¯åŒ…å«äº†ä¸Šé¢æ‰€æœ‰åŠŸèƒ½ã€‚</strong></li></ul><h2 id="ä½¿ç”¨æ³¨è§£è£…é…AOP"><a href="#ä½¿ç”¨æ³¨è§£è£…é…AOP" class="headerlink" title="ä½¿ç”¨æ³¨è§£è£…é…AOP"></a>ä½¿ç”¨æ³¨è§£è£…é…AOP</h2><p>ä¸Šä¸€èŠ‚æˆ‘ä»¬è®²è§£äº†ä½¿ç”¨AspectJçš„æ³¨è§£ï¼Œå¹¶é…åˆä¸€ä¸ªå¤æ‚çš„<code>execution(* xxx.Xyz.*(..))</code>è¯­æ³•æ¥å®šä¹‰åº”è¯¥å¦‚ä½•è£…é…AOPã€‚</p><p>åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œè¿™ç§å†™æ³•å…¶å®å¾ˆå°‘ä½¿ç”¨ã€‚å‡è®¾ä½ å†™äº†ä¸€ä¸ª<code>SecurityAspect</code>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">SecurityAspect</span> &#123;</span><br><span class="line">    <span class="meta">@Before(&quot;execution(public * com.itranswarp.learnjava.service.*.*(..))&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">check</span><span class="params">()</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (SecurityContext.getCurrentUser() == <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="title class_">RuntimeException</span>(<span class="string">&quot;check failed&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åŸºæœ¬èƒ½å®ç°æ— å·®åˆ«å…¨è¦†ç›–ï¼Œå³æŸä¸ªåŒ…ä¸‹é¢çš„æ‰€æœ‰Beançš„æ‰€æœ‰æ–¹æ³•éƒ½ä¼šè¢«è¿™ä¸ª<code>check()</code>æ–¹æ³•æ‹¦æˆªã€‚</p><p>è¿˜æœ‰çš„ç«¥é‹å–œæ¬¢ç”¨æ–¹æ³•åå‰ç¼€è¿›è¡Œæ‹¦æˆªï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Around(&quot;execution(public * update*(..))&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Object <span class="title function_">doLogging</span><span class="params">(ProceedingJoinPoint pjp)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">    <span class="comment">// å¯¹updateå¼€å¤´çš„æ–¹æ³•åˆ‡æ¢æ•°æ®æº:</span></span><br><span class="line">    <span class="type">String</span> <span class="variable">old</span> <span class="operator">=</span> setCurrentDataSource(<span class="string">&quot;master&quot;</span>);</span><br><span class="line">    <span class="type">Object</span> <span class="variable">retVal</span> <span class="operator">=</span> pjp.proceed();</span><br><span class="line">    restoreCurrentDataSource(old);</span><br><span class="line">    <span class="keyword">return</span> retVal;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ç§éç²¾å‡†æ‰“å‡»è¯¯ä¼¤é¢æ›´å¤§ï¼Œå› ä¸ºä»æ–¹æ³•å‰ç¼€åŒºåˆ†æ˜¯å¦æ˜¯æ•°æ®åº“æ“ä½œæ˜¯éå¸¸ä¸å¯å–çš„ã€‚</p><p>æˆ‘ä»¬åœ¨ä½¿ç”¨AOPæ—¶ï¼Œè¦æ³¨æ„åˆ°è™½ç„¶Springå®¹å™¨å¯ä»¥æŠŠæŒ‡å®šçš„æ–¹æ³•é€šè¿‡AOPè§„åˆ™è£…é…åˆ°æŒ‡å®šçš„Beançš„æŒ‡å®šæ–¹æ³•å‰åï¼Œä½†æ˜¯ï¼Œå¦‚æœè‡ªåŠ¨è£…é…æ—¶ï¼Œå› ä¸ºä¸æ°å½“çš„èŒƒå›´ï¼Œå®¹æ˜“å¯¼è‡´æ„æƒ³ä¸åˆ°çš„ç»“æœï¼Œå³å¾ˆå¤šä¸éœ€è¦AOPä»£ç†çš„Beanä¹Ÿè¢«è‡ªåŠ¨ä»£ç†äº†ï¼Œå¹¶ä¸”ï¼Œåç»­æ–°å¢çš„Beanï¼Œå¦‚æœä¸æ¸…æ¥šç°æœ‰çš„AOPè£…é…è§„åˆ™ï¼Œå®¹æ˜“è¢«å¼ºè¿«è£…é…ã€‚</p><p>ä½¿ç”¨AOPæ—¶ï¼Œè¢«è£…é…çš„Beanæœ€å¥½è‡ªå·±èƒ½æ¸…æ¸…æ¥šæ¥šåœ°çŸ¥é“è‡ªå·±è¢«å®‰æ’äº†ã€‚ä¾‹å¦‚ï¼ŒSpringæä¾›çš„<code>@Transactional</code>å°±æ˜¯ä¸€ä¸ªéå¸¸å¥½çš„ä¾‹å­ã€‚å¦‚æœæˆ‘ä»¬è‡ªå·±å†™çš„Beanå¸Œæœ›åœ¨ä¸€ä¸ªæ•°æ®åº“äº‹åŠ¡ä¸­è¢«è°ƒç”¨ï¼Œå°±æ ‡æ³¨ä¸Š<code>@Transactional</code>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="comment">// æœ‰äº‹åŠ¡:</span></span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">createUser</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æ— äº‹åŠ¡:</span></span><br><span class="line">    <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">isValidName</span><span class="params">(String name)</span> &#123;</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// æœ‰äº‹åŠ¡:</span></span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">updateUser</span><span class="params">(User user)</span> &#123;</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ–è€…ç›´æ¥åœ¨classçº§åˆ«æ³¨è§£ï¼Œè¡¨ç¤ºâ€œæ‰€æœ‰publicæ–¹æ³•éƒ½è¢«å®‰æ’äº†â€ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Transactional</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€šè¿‡<code>@Transactional</code>ï¼ŒæŸä¸ªæ–¹æ³•æ˜¯å¦å¯ç”¨äº†äº‹åŠ¡å°±ä¸€æ¸…äºŒæ¥šäº†ã€‚å› æ­¤ï¼Œè£…é…AOPçš„æ—¶å€™ï¼Œä½¿ç”¨æ³¨è§£æ˜¯æœ€å¥½çš„æ–¹å¼ã€‚</p><h3 id="å®ä¾‹"><a href="#å®ä¾‹" class="headerlink" title="å®ä¾‹"></a>å®ä¾‹</h3><p>æˆ‘ä»¬ä»¥ä¸€ä¸ªå®é™…ä¾‹å­æ¼”ç¤ºå¦‚ä½•ä½¿ç”¨æ³¨è§£å®ç°AOPè£…é…ã€‚ä¸ºäº†ç›‘æ§åº”ç”¨ç¨‹åºçš„æ€§èƒ½ï¼Œæˆ‘ä»¬å®šä¹‰ä¸€ä¸ªæ€§èƒ½ç›‘æ§çš„æ³¨è§£ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Target(METHOD)</span></span><br><span class="line"><span class="meta">@Retention(RUNTIME)</span></span><br><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> MetricTime &#123;</span><br><span class="line">    String <span class="title function_">value</span><span class="params">()</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨éœ€è¦è¢«ç›‘æ§çš„å…³é”®æ–¹æ³•ä¸Šæ ‡æ³¨è¯¥æ³¨è§£ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">UserService</span> &#123;</span><br><span class="line">    <span class="comment">// ç›‘æ§register()æ–¹æ³•æ€§èƒ½:</span></span><br><span class="line">    <span class="meta">@MetricTime(&quot;register&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> User <span class="title function_">register</span><span class="params">(String email, String password, String name)</span> &#123;</span><br><span class="line">        ...</span><br><span class="line">    &#125;</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç„¶åï¼Œæˆ‘ä»¬å®šä¹‰<code>MetricAspect</code>ï¼š</p><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">MetricAspect</span> &#123;</span><br><span class="line">    <span class="meta">@Around(&quot;@annotation(metricTime)&quot;)</span></span><br><span class="line">    <span class="keyword">public</span> Object <span class="title function_">metric</span><span class="params">(ProceedingJoinPoint joinPoint, MetricTime metricTime)</span> <span class="keyword">throws</span> Throwable &#123;</span><br><span class="line">        <span class="type">String</span> <span class="variable">name</span> <span class="operator">=</span> metricTime.value();</span><br><span class="line">        <span class="type">long</span> <span class="variable">start</span> <span class="operator">=</span> System.currentTimeMillis();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> joinPoint.proceed();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="type">long</span> <span class="variable">t</span> <span class="operator">=</span> System.currentTimeMillis() - start;</span><br><span class="line">            <span class="comment">// å†™å…¥æ—¥å¿—æˆ–å‘é€è‡³JMX:</span></span><br><span class="line">            System.err.println(<span class="string">&quot;[Metrics] &quot;</span> + name + <span class="string">&quot;: &quot;</span> + t + <span class="string">&quot;ms&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ³¨æ„<code>metric()</code>æ–¹æ³•æ ‡æ³¨äº†<code>@Around(&quot;@annotation(metricTime)&quot;)</code>ï¼Œå®ƒçš„æ„æ€æ˜¯ï¼Œç¬¦åˆæ¡ä»¶çš„ç›®æ ‡æ–¹æ³•æ˜¯å¸¦æœ‰<code>@MetricTime</code>æ³¨è§£çš„æ–¹æ³•ï¼Œå› ä¸º<code>metric()</code>æ–¹æ³•å‚æ•°ç±»å‹æ˜¯<code>MetricTime</code>ï¼ˆæ³¨æ„å‚æ•°åæ˜¯<code>metricTime</code>ä¸æ˜¯<code>MetricTime</code>ï¼‰ï¼Œæˆ‘ä»¬é€šè¿‡å®ƒè·å–æ€§èƒ½ç›‘æ§çš„åç§°ã€‚</p><p>æœ‰äº†<code>@MetricTime</code>æ³¨è§£ï¼Œå†é…åˆ<code>MetricAspect</code>ï¼Œä»»ä½•Beanï¼Œåªè¦æ–¹æ³•æ ‡æ³¨äº†<code>@MetricTime</code>æ³¨è§£ï¼Œå°±å¯ä»¥è‡ªåŠ¨å®ç°æ€§èƒ½ç›‘æ§ã€‚è¿è¡Œä»£ç ï¼Œè¾“å‡ºç»“æœå¦‚ä¸‹ï¼š</p><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">Welcome, Bob!</span><br><span class="line">[Metrics] register: 16ms</span><br></pre></td></tr></table></figure><p>è¿˜æ˜¯ä¸€æ ·çš„æ­¥éª¤ï¼Œè°ƒç”¨AOP</p><ul><li><p>å†™ä¸€ä¸ªAspectç±»ï¼Œæ ‡æ³¨æ³¨è§£æ£€æŸ¥</p></li><li><pre><code class="lang-java">@Aspect@Component<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">- ä½¿ç”¨</span><br><span class="line"></span><br><span class="line">åœ¨`@Configuration`ç±»ä¸Šæ ‡æ³¨`@EnableAspectJAutoProxy`ã€‚</span><br><span class="line"></span><br><span class="line">å°ç»“ï¼š</span><br><span class="line"></span><br><span class="line">ä½¿ç”¨æ³¨è§£å®ç°AOPéœ€è¦å…ˆå®šä¹‰æ³¨è§£ï¼Œç„¶åä½¿ç”¨`@Around(&quot;@annotation(name)&quot;)`å®ç°è£…é…ï¼›</span><br><span class="line"></span><br><span class="line">ä½¿ç”¨æ³¨è§£æ—¢ç®€å•ï¼Œåˆèƒ½æ˜ç¡®æ ‡è¯†AOPè£…é…ï¼Œæ˜¯ä½¿ç”¨AOPæ¨èçš„æ–¹å¼ã€‚</span><br><span class="line"></span><br><span class="line">## ä½¿ç”¨æ¨¡æ¿</span><br><span class="line"></span><br><span class="line">æ³¨è§£å®šä¹‰ã€åˆ‡é¢å®ç°ã€æ–¹æ³•æ ‡æ³¨ã€å¼€å¯ä»£ç†ã€ç»„ä»¶æ‰«æã€‚</span><br><span class="line"></span><br><span class="line">### å®šä¹‰æ³¨è§£</span><br><span class="line"></span><br><span class="line">å¦‚æœä½ è¦é€šè¿‡æ³¨è§£ï¼ˆå¦‚ `@MetricTime`ï¼‰æ¥æ§åˆ¶å“ªäº›æ–¹æ³•éœ€è¦åˆ‡é¢å¢å¼ºï¼š</span><br><span class="line"></span><br></pre></td></tr></table></figure>@Target(ElementType.METHOD)@Retention(RetentionPolicy.RUNTIME)public @interface MetricTime &#123;  String value();&#125;<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">### åˆ‡é¢ç±»å®ç°</span><br><span class="line"></span><br></pre></td></tr></table></figure>@Aspect@Componentpublic class MetricAspect &#123;  @Around(&quot;@annotation(metricTime)&quot;) // åŒ¹é…ä½¿ç”¨äº† @MetricTime çš„æ–¹æ³•  public Object metric(ProceedingJoinPoint joinPoint, MetricTime metricTime) throws Throwable &#123;      String name = metricTime.value();      long start = System.currentTimeMillis();      try &#123;          return joinPoint.proceed(); // æ‰§è¡Œç›®æ ‡æ–¹æ³•      &#125; finally &#123;          long duration = System.currentTimeMillis() - start;          System.out.println(&quot;[Metrics] &quot; + name + &quot;: &quot; + duration + &quot;ms&quot;);      &#125;  &#125;&#125;<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">&gt; â˜‘ï¸ è®°å¾—ä½¿ç”¨ `@Aspect` å’Œ `@Component` æ ‡è®°ï¼ŒSpring æ‰ä¼šè¯†åˆ«è¿™æ˜¯ä¸€ä¸ªåˆ‡é¢ã€‚</span><br><span class="line"></span><br><span class="line">### æ³¨è§£ä½¿ç”¨å…·ä½“æ–¹æ³•</span><br><span class="line"></span><br></pre></td></tr></table></figure>@Componentpublic class UserService &#123;  @MetricTime(&quot;register&quot;) // è¡¨æ˜è¿™ä¸ªæ–¹æ³•éœ€è¦è®°å½•è€—æ—¶  public User register(String email, String password, String name) &#123;      // ä¸šåŠ¡é€»è¾‘  &#125;&#125;<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">### å¯ç”¨</span><br><span class="line"></span><br><span class="line">åœ¨ä½ çš„é…ç½®ç±»ï¼ˆé€šå¸¸æ˜¯å¯åŠ¨ç±»æˆ–é…ç½®ç±»ï¼‰ä¸ŠåŠ ï¼š</span><br><span class="line"></span><br></pre></td></tr></table></figure>@Configuration@EnableAspectJAutoProxypublic class AppConfig &#123;  // Bean é…ç½®ç­‰&#125;</code></pre></li></ul><h3 id="ä½¿ç”¨-ComponentScanæ‰«æåŒ…"><a href="#ä½¿ç”¨-ComponentScanæ‰«æåŒ…" class="headerlink" title="ä½¿ç”¨@ComponentScanæ‰«æåŒ…"></a><strong>ä½¿ç”¨@ComponentScanæ‰«æåŒ…</strong></h3><p>ç¡®ä¿ä½ çš„ <code>@Component</code> å’Œ <code>@Aspect</code> æ‰€åœ¨åŒ…èƒ½è¢« Spring æ‰«åˆ°ã€‚</p><p><strong>æ‰«æçš„æ—¶å€™æ‰«æçš„æ˜¯ä»–å’Œä»–çš„å­åŒ…é‡Œçš„bean</strong></p>]]></content:encoded>
      
      
      <category domain="https://blog.tokenlen.top/categories/%E6%8A%80%E6%9C%AF%E6%A0%88/">æŠ€æœ¯æ ˆ</category>
      
      
      <category domain="https://blog.tokenlen.top/tags/java/">java</category>
      
      <category domain="https://blog.tokenlen.top/tags/spring/">spring</category>
      
      
      <comments>https://blog.tokenlen.top/2025/05/05/java-stack/spring1/#disqus_thread</comments>
      
    </item>
    
  </channel>
</rss>
